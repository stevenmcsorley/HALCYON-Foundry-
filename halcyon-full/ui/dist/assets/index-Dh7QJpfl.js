var k3=Object.defineProperty;var T3=(e,t,r)=>t in e?k3(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var Pd=(e,t,r)=>T3(e,typeof t!="symbol"?t+"":t,r);function P3(e,t){for(var r=0;r<t.length;r++){const n=t[r];if(typeof n!="string"&&!Array.isArray(n)){for(const a in n)if(a!=="default"&&!(a in e)){const i=Object.getOwnPropertyDescriptor(n,a);i&&Object.defineProperty(e,a,i.get?i:{enumerable:!0,get:()=>n[a]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function r(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=r(a);fetch(a.href,i)}})();var I3=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function R2(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var sN={exports:{}},w0={},oN={exports:{}},zr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Dm=Symbol.for("react.element"),A3=Symbol.for("react.portal"),N3=Symbol.for("react.fragment"),M3=Symbol.for("react.strict_mode"),D3=Symbol.for("react.profiler"),z3=Symbol.for("react.provider"),R3=Symbol.for("react.context"),L3=Symbol.for("react.forward_ref"),B3=Symbol.for("react.suspense"),j3=Symbol.for("react.memo"),O3=Symbol.for("react.lazy"),dk=Symbol.iterator;function F3(e){return e===null||typeof e!="object"?null:(e=dk&&e[dk]||e["@@iterator"],typeof e=="function"?e:null)}var lN={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},uN=Object.assign,cN={};function Lh(e,t,r){this.props=e,this.context=t,this.refs=cN,this.updater=r||lN}Lh.prototype.isReactComponent={};Lh.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Lh.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function dN(){}dN.prototype=Lh.prototype;function L2(e,t,r){this.props=e,this.context=t,this.refs=cN,this.updater=r||lN}var B2=L2.prototype=new dN;B2.constructor=L2;uN(B2,Lh.prototype);B2.isPureReactComponent=!0;var hk=Array.isArray,hN=Object.prototype.hasOwnProperty,j2={current:null},fN={key:!0,ref:!0,__self:!0,__source:!0};function pN(e,t,r){var n,a={},i=null,u=null;if(t!=null)for(n in t.ref!==void 0&&(u=t.ref),t.key!==void 0&&(i=""+t.key),t)hN.call(t,n)&&!fN.hasOwnProperty(n)&&(a[n]=t[n]);var s=arguments.length-2;if(s===1)a.children=r;else if(1<s){for(var h=Array(s),p=0;p<s;p++)h[p]=arguments[p+2];a.children=h}if(e&&e.defaultProps)for(n in s=e.defaultProps,s)a[n]===void 0&&(a[n]=s[n]);return{$$typeof:Dm,type:e,key:i,ref:u,props:a,_owner:j2.current}}function $3(e,t){return{$$typeof:Dm,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function O2(e){return typeof e=="object"&&e!==null&&e.$$typeof===Dm}function V3(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var fk=/\/+/g;function Ib(e,t){return typeof e=="object"&&e!==null&&e.key!=null?V3(""+e.key):t.toString(36)}function Yv(e,t,r,n,a){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var u=!1;if(e===null)u=!0;else switch(i){case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case Dm:case A3:u=!0}}if(u)return u=e,a=a(u),e=n===""?"."+Ib(u,0):n,hk(a)?(r="",e!=null&&(r=e.replace(fk,"$&/")+"/"),Yv(a,t,r,"",function(p){return p})):a!=null&&(O2(a)&&(a=$3(a,r+(!a.key||u&&u.key===a.key?"":(""+a.key).replace(fk,"$&/")+"/")+e)),t.push(a)),1;if(u=0,n=n===""?".":n+":",hk(e))for(var s=0;s<e.length;s++){i=e[s];var h=n+Ib(i,s);u+=Yv(i,t,r,h,a)}else if(h=F3(e),typeof h=="function")for(e=h.call(e),s=0;!(i=e.next()).done;)i=i.value,h=n+Ib(i,s++),u+=Yv(i,t,r,h,a);else if(i==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return u}function av(e,t,r){if(e==null)return e;var n=[],a=0;return Yv(e,n,"","",function(i){return t.call(r,i,a++)}),n}function U3(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var ai={current:null},Jv={transition:null},q3={ReactCurrentDispatcher:ai,ReactCurrentBatchConfig:Jv,ReactCurrentOwner:j2};function mN(){throw Error("act(...) is not supported in production builds of React.")}zr.Children={map:av,forEach:function(e,t,r){av(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return av(e,function(){t++}),t},toArray:function(e){return av(e,function(t){return t})||[]},only:function(e){if(!O2(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};zr.Component=Lh;zr.Fragment=N3;zr.Profiler=D3;zr.PureComponent=L2;zr.StrictMode=M3;zr.Suspense=B3;zr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=q3;zr.act=mN;zr.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=uN({},e.props),a=e.key,i=e.ref,u=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,u=j2.current),t.key!==void 0&&(a=""+t.key),e.type&&e.type.defaultProps)var s=e.type.defaultProps;for(h in t)hN.call(t,h)&&!fN.hasOwnProperty(h)&&(n[h]=t[h]===void 0&&s!==void 0?s[h]:t[h])}var h=arguments.length-2;if(h===1)n.children=r;else if(1<h){s=Array(h);for(var p=0;p<h;p++)s[p]=arguments[p+2];n.children=s}return{$$typeof:Dm,type:e.type,key:a,ref:i,props:n,_owner:u}};zr.createContext=function(e){return e={$$typeof:R3,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:z3,_context:e},e.Consumer=e};zr.createElement=pN;zr.createFactory=function(e){var t=pN.bind(null,e);return t.type=e,t};zr.createRef=function(){return{current:null}};zr.forwardRef=function(e){return{$$typeof:L3,render:e}};zr.isValidElement=O2;zr.lazy=function(e){return{$$typeof:O3,_payload:{_status:-1,_result:e},_init:U3}};zr.memo=function(e,t){return{$$typeof:j3,type:e,compare:t===void 0?null:t}};zr.startTransition=function(e){var t=Jv.transition;Jv.transition={};try{e()}finally{Jv.transition=t}};zr.unstable_act=mN;zr.useCallback=function(e,t){return ai.current.useCallback(e,t)};zr.useContext=function(e){return ai.current.useContext(e)};zr.useDebugValue=function(){};zr.useDeferredValue=function(e){return ai.current.useDeferredValue(e)};zr.useEffect=function(e,t){return ai.current.useEffect(e,t)};zr.useId=function(){return ai.current.useId()};zr.useImperativeHandle=function(e,t,r){return ai.current.useImperativeHandle(e,t,r)};zr.useInsertionEffect=function(e,t){return ai.current.useInsertionEffect(e,t)};zr.useLayoutEffect=function(e,t){return ai.current.useLayoutEffect(e,t)};zr.useMemo=function(e,t){return ai.current.useMemo(e,t)};zr.useReducer=function(e,t,r){return ai.current.useReducer(e,t,r)};zr.useRef=function(e){return ai.current.useRef(e)};zr.useState=function(e){return ai.current.useState(e)};zr.useSyncExternalStore=function(e,t,r){return ai.current.useSyncExternalStore(e,t,r)};zr.useTransition=function(){return ai.current.useTransition()};zr.version="18.3.1";oN.exports=zr;var se=oN.exports;const Ke=R2(se),H3=P3({__proto__:null,default:Ke},[se]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var G3=se,W3=Symbol.for("react.element"),Z3=Symbol.for("react.fragment"),X3=Object.prototype.hasOwnProperty,K3=G3.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Y3={key:!0,ref:!0,__self:!0,__source:!0};function gN(e,t,r){var n,a={},i=null,u=null;r!==void 0&&(i=""+r),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(u=t.ref);for(n in t)X3.call(t,n)&&!Y3.hasOwnProperty(n)&&(a[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)a[n]===void 0&&(a[n]=t[n]);return{$$typeof:W3,type:e,key:i,ref:u,props:a,_owner:K3.current}}w0.Fragment=Z3;w0.jsx=gN;w0.jsxs=gN;sN.exports=w0;var w=sN.exports,vN={exports:{}},qi={},yN={exports:{}},xN={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(fe,de){var be=fe.length;fe.push(de);e:for(;0<be;){var ge=be-1>>>1,xe=fe[ge];if(0<a(xe,de))fe[ge]=de,fe[be]=xe,be=ge;else break e}}function r(fe){return fe.length===0?null:fe[0]}function n(fe){if(fe.length===0)return null;var de=fe[0],be=fe.pop();if(be!==de){fe[0]=be;e:for(var ge=0,xe=fe.length,Le=xe>>>1;ge<Le;){var Oe=2*(ge+1)-1,Fe=fe[Oe],et=Oe+1,nt=fe[et];if(0>a(Fe,be))et<xe&&0>a(nt,Fe)?(fe[ge]=nt,fe[et]=be,ge=et):(fe[ge]=Fe,fe[Oe]=be,ge=Oe);else if(et<xe&&0>a(nt,be))fe[ge]=nt,fe[et]=be,ge=et;else break e}}return de}function a(fe,de){var be=fe.sortIndex-de.sortIndex;return be!==0?be:fe.id-de.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;e.unstable_now=function(){return i.now()}}else{var u=Date,s=u.now();e.unstable_now=function(){return u.now()-s}}var h=[],p=[],g=1,v=null,x=3,S=!1,P=!1,N=!1,M=typeof setTimeout=="function"?setTimeout:null,I=typeof clearTimeout=="function"?clearTimeout:null,A=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function D(fe){for(var de=r(p);de!==null;){if(de.callback===null)n(p);else if(de.startTime<=fe)n(p),de.sortIndex=de.expirationTime,t(h,de);else break;de=r(p)}}function j(fe){if(N=!1,D(fe),!P)if(r(h)!==null)P=!0,ie(V);else{var de=r(p);de!==null&&ce(j,de.startTime-fe)}}function V(fe,de){P=!1,N&&(N=!1,I(W),W=-1),S=!0;var be=x;try{for(D(de),v=r(h);v!==null&&(!(v.expirationTime>de)||fe&&!Z());){var ge=v.callback;if(typeof ge=="function"){v.callback=null,x=v.priorityLevel;var xe=ge(v.expirationTime<=de);de=e.unstable_now(),typeof xe=="function"?v.callback=xe:v===r(h)&&n(h),D(de)}else n(h);v=r(h)}if(v!==null)var Le=!0;else{var Oe=r(p);Oe!==null&&ce(j,Oe.startTime-de),Le=!1}return Le}finally{v=null,x=be,S=!1}}var U=!1,$=null,W=-1,X=5,J=-1;function Z(){return!(e.unstable_now()-J<X)}function K(){if($!==null){var fe=e.unstable_now();J=fe;var de=!0;try{de=$(!0,fe)}finally{de?Y():(U=!1,$=null)}}else U=!1}var Y;if(typeof A=="function")Y=function(){A(K)};else if(typeof MessageChannel<"u"){var G=new MessageChannel,oe=G.port2;G.port1.onmessage=K,Y=function(){oe.postMessage(null)}}else Y=function(){M(K,0)};function ie(fe){$=fe,U||(U=!0,Y())}function ce(fe,de){W=M(function(){fe(e.unstable_now())},de)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(fe){fe.callback=null},e.unstable_continueExecution=function(){P||S||(P=!0,ie(V))},e.unstable_forceFrameRate=function(fe){0>fe||125<fe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):X=0<fe?Math.floor(1e3/fe):5},e.unstable_getCurrentPriorityLevel=function(){return x},e.unstable_getFirstCallbackNode=function(){return r(h)},e.unstable_next=function(fe){switch(x){case 1:case 2:case 3:var de=3;break;default:de=x}var be=x;x=de;try{return fe()}finally{x=be}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(fe,de){switch(fe){case 1:case 2:case 3:case 4:case 5:break;default:fe=3}var be=x;x=fe;try{return de()}finally{x=be}},e.unstable_scheduleCallback=function(fe,de,be){var ge=e.unstable_now();switch(typeof be=="object"&&be!==null?(be=be.delay,be=typeof be=="number"&&0<be?ge+be:ge):be=ge,fe){case 1:var xe=-1;break;case 2:xe=250;break;case 5:xe=1073741823;break;case 4:xe=1e4;break;default:xe=5e3}return xe=be+xe,fe={id:g++,callback:de,priorityLevel:fe,startTime:be,expirationTime:xe,sortIndex:-1},be>ge?(fe.sortIndex=be,t(p,fe),r(h)===null&&fe===r(p)&&(N?(I(W),W=-1):N=!0,ce(j,be-ge))):(fe.sortIndex=xe,t(h,fe),P||S||(P=!0,ie(V))),fe},e.unstable_shouldYield=Z,e.unstable_wrapCallback=function(fe){var de=x;return function(){var be=x;x=de;try{return fe.apply(this,arguments)}finally{x=be}}}})(xN);yN.exports=xN;var J3=yN.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Q3=se,Vi=J3;function Pt(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var bN=new Set,Hp={};function Pc(e,t){_h(e,t),_h(e+"Capture",t)}function _h(e,t){for(Hp[e]=t,e=0;e<t.length;e++)bN.add(t[e])}var Oo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),t1=Object.prototype.hasOwnProperty,e5=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,pk={},mk={};function t5(e){return t1.call(mk,e)?!0:t1.call(pk,e)?!1:e5.test(e)?mk[e]=!0:(pk[e]=!0,!1)}function r5(e,t,r,n){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function n5(e,t,r,n){if(t===null||typeof t>"u"||r5(e,t,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function ii(e,t,r,n,a,i,u){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=a,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=u}var Ta={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Ta[e]=new ii(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Ta[t]=new ii(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Ta[e]=new ii(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Ta[e]=new ii(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Ta[e]=new ii(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Ta[e]=new ii(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Ta[e]=new ii(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Ta[e]=new ii(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Ta[e]=new ii(e,5,!1,e.toLowerCase(),null,!1,!1)});var F2=/[\-:]([a-z])/g;function $2(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(F2,$2);Ta[t]=new ii(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(F2,$2);Ta[t]=new ii(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(F2,$2);Ta[t]=new ii(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Ta[e]=new ii(e,1,!1,e.toLowerCase(),null,!1,!1)});Ta.xlinkHref=new ii("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Ta[e]=new ii(e,1,!1,e.toLowerCase(),null,!0,!0)});function V2(e,t,r,n){var a=Ta.hasOwnProperty(t)?Ta[t]:null;(a!==null?a.type!==0:n||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(n5(t,r,a,n)&&(r=null),n||a===null?t5(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):a.mustUseProperty?e[a.propertyName]=r===null?a.type===3?!1:"":r:(t=a.attributeName,n=a.attributeNamespace,r===null?e.removeAttribute(t):(a=a.type,r=a===3||a===4&&r===!0?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}var Wo=Q3.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,iv=Symbol.for("react.element"),qd=Symbol.for("react.portal"),Hd=Symbol.for("react.fragment"),U2=Symbol.for("react.strict_mode"),r1=Symbol.for("react.profiler"),_N=Symbol.for("react.provider"),wN=Symbol.for("react.context"),q2=Symbol.for("react.forward_ref"),n1=Symbol.for("react.suspense"),a1=Symbol.for("react.suspense_list"),H2=Symbol.for("react.memo"),Nl=Symbol.for("react.lazy"),SN=Symbol.for("react.offscreen"),gk=Symbol.iterator;function Jf(e){return e===null||typeof e!="object"?null:(e=gk&&e[gk]||e["@@iterator"],typeof e=="function"?e:null)}var Mn=Object.assign,Ab;function _p(e){if(Ab===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);Ab=t&&t[1]||""}return`
`+Ab+e}var Nb=!1;function Mb(e,t){if(!e||Nb)return"";Nb=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(p){var n=p}Reflect.construct(e,[],t)}else{try{t.call()}catch(p){n=p}e.call(t.prototype)}else{try{throw Error()}catch(p){n=p}e()}}catch(p){if(p&&n&&typeof p.stack=="string"){for(var a=p.stack.split(`
`),i=n.stack.split(`
`),u=a.length-1,s=i.length-1;1<=u&&0<=s&&a[u]!==i[s];)s--;for(;1<=u&&0<=s;u--,s--)if(a[u]!==i[s]){if(u!==1||s!==1)do if(u--,s--,0>s||a[u]!==i[s]){var h=`
`+a[u].replace(" at new "," at ");return e.displayName&&h.includes("<anonymous>")&&(h=h.replace("<anonymous>",e.displayName)),h}while(1<=u&&0<=s);break}}}finally{Nb=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?_p(e):""}function a5(e){switch(e.tag){case 5:return _p(e.type);case 16:return _p("Lazy");case 13:return _p("Suspense");case 19:return _p("SuspenseList");case 0:case 2:case 15:return e=Mb(e.type,!1),e;case 11:return e=Mb(e.type.render,!1),e;case 1:return e=Mb(e.type,!0),e;default:return""}}function i1(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Hd:return"Fragment";case qd:return"Portal";case r1:return"Profiler";case U2:return"StrictMode";case n1:return"Suspense";case a1:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case wN:return(e.displayName||"Context")+".Consumer";case _N:return(e._context.displayName||"Context")+".Provider";case q2:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case H2:return t=e.displayName||null,t!==null?t:i1(e.type)||"Memo";case Nl:t=e._payload,e=e._init;try{return i1(e(t))}catch{}}return null}function i5(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return i1(t);case 8:return t===U2?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function nu(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function EN(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function s5(e){var t=EN(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var a=r.get,i=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(u){n=""+u,i.call(this,u)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(u){n=""+u},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function sv(e){e._valueTracker||(e._valueTracker=s5(e))}function CN(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=EN(e)?e.checked?"true":"false":e.value),e=n,e!==r?(t.setValue(e),!0):!1}function ky(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function s1(e,t){var r=t.checked;return Mn({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function vk(e,t){var r=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;r=nu(t.value!=null?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function kN(e,t){t=t.checked,t!=null&&V2(e,"checked",t,!1)}function o1(e,t){kN(e,t);var r=nu(t.value),n=t.type;if(r!=null)n==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?l1(e,t.type,r):t.hasOwnProperty("defaultValue")&&l1(e,t.type,nu(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function yk(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function l1(e,t,r){(t!=="number"||ky(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var wp=Array.isArray;function oh(e,t,r,n){if(e=e.options,t){t={};for(var a=0;a<r.length;a++)t["$"+r[a]]=!0;for(r=0;r<e.length;r++)a=t.hasOwnProperty("$"+e[r].value),e[r].selected!==a&&(e[r].selected=a),a&&n&&(e[r].defaultSelected=!0)}else{for(r=""+nu(r),t=null,a=0;a<e.length;a++){if(e[a].value===r){e[a].selected=!0,n&&(e[a].defaultSelected=!0);return}t!==null||e[a].disabled||(t=e[a])}t!==null&&(t.selected=!0)}}function u1(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Pt(91));return Mn({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function xk(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(Pt(92));if(wp(r)){if(1<r.length)throw Error(Pt(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:nu(r)}}function TN(e,t){var r=nu(t.value),n=nu(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),n!=null&&(e.defaultValue=""+n)}function bk(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function PN(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function c1(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?PN(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var ov,IN=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,n,a){MSApp.execUnsafeLocalFunction(function(){return e(t,r,n,a)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(ov=ov||document.createElement("div"),ov.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ov.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Gp(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var Mp={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},o5=["Webkit","ms","Moz","O"];Object.keys(Mp).forEach(function(e){o5.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Mp[t]=Mp[e]})});function AN(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||Mp.hasOwnProperty(e)&&Mp[e]?(""+t).trim():t+"px"}function NN(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var n=r.indexOf("--")===0,a=AN(r,t[r],n);r==="float"&&(r="cssFloat"),n?e.setProperty(r,a):e[r]=a}}var l5=Mn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function d1(e,t){if(t){if(l5[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Pt(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Pt(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Pt(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Pt(62))}}function h1(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var f1=null;function G2(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var p1=null,lh=null,uh=null;function _k(e){if(e=Lm(e)){if(typeof p1!="function")throw Error(Pt(280));var t=e.stateNode;t&&(t=T0(t),p1(e.stateNode,e.type,t))}}function MN(e){lh?uh?uh.push(e):uh=[e]:lh=e}function DN(){if(lh){var e=lh,t=uh;if(uh=lh=null,_k(e),t)for(e=0;e<t.length;e++)_k(t[e])}}function zN(e,t){return e(t)}function RN(){}var Db=!1;function LN(e,t,r){if(Db)return e(t,r);Db=!0;try{return zN(e,t,r)}finally{Db=!1,(lh!==null||uh!==null)&&(RN(),DN())}}function Wp(e,t){var r=e.stateNode;if(r===null)return null;var n=T0(r);if(n===null)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(Pt(231,t,typeof r));return r}var m1=!1;if(Oo)try{var Qf={};Object.defineProperty(Qf,"passive",{get:function(){m1=!0}}),window.addEventListener("test",Qf,Qf),window.removeEventListener("test",Qf,Qf)}catch{m1=!1}function u5(e,t,r,n,a,i,u,s,h){var p=Array.prototype.slice.call(arguments,3);try{t.apply(r,p)}catch(g){this.onError(g)}}var Dp=!1,Ty=null,Py=!1,g1=null,c5={onError:function(e){Dp=!0,Ty=e}};function d5(e,t,r,n,a,i,u,s,h){Dp=!1,Ty=null,u5.apply(c5,arguments)}function h5(e,t,r,n,a,i,u,s,h){if(d5.apply(this,arguments),Dp){if(Dp){var p=Ty;Dp=!1,Ty=null}else throw Error(Pt(198));Py||(Py=!0,g1=p)}}function Ic(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function BN(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function wk(e){if(Ic(e)!==e)throw Error(Pt(188))}function f5(e){var t=e.alternate;if(!t){if(t=Ic(e),t===null)throw Error(Pt(188));return t!==e?null:e}for(var r=e,n=t;;){var a=r.return;if(a===null)break;var i=a.alternate;if(i===null){if(n=a.return,n!==null){r=n;continue}break}if(a.child===i.child){for(i=a.child;i;){if(i===r)return wk(a),e;if(i===n)return wk(a),t;i=i.sibling}throw Error(Pt(188))}if(r.return!==n.return)r=a,n=i;else{for(var u=!1,s=a.child;s;){if(s===r){u=!0,r=a,n=i;break}if(s===n){u=!0,n=a,r=i;break}s=s.sibling}if(!u){for(s=i.child;s;){if(s===r){u=!0,r=i,n=a;break}if(s===n){u=!0,n=i,r=a;break}s=s.sibling}if(!u)throw Error(Pt(189))}}if(r.alternate!==n)throw Error(Pt(190))}if(r.tag!==3)throw Error(Pt(188));return r.stateNode.current===r?e:t}function jN(e){return e=f5(e),e!==null?ON(e):null}function ON(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=ON(e);if(t!==null)return t;e=e.sibling}return null}var FN=Vi.unstable_scheduleCallback,Sk=Vi.unstable_cancelCallback,p5=Vi.unstable_shouldYield,m5=Vi.unstable_requestPaint,jn=Vi.unstable_now,g5=Vi.unstable_getCurrentPriorityLevel,W2=Vi.unstable_ImmediatePriority,$N=Vi.unstable_UserBlockingPriority,Iy=Vi.unstable_NormalPriority,v5=Vi.unstable_LowPriority,VN=Vi.unstable_IdlePriority,S0=null,ro=null;function y5(e){if(ro&&typeof ro.onCommitFiberRoot=="function")try{ro.onCommitFiberRoot(S0,e,void 0,(e.current.flags&128)===128)}catch{}}var Ms=Math.clz32?Math.clz32:_5,x5=Math.log,b5=Math.LN2;function _5(e){return e>>>=0,e===0?32:31-(x5(e)/b5|0)|0}var lv=64,uv=4194304;function Sp(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Ay(e,t){var r=e.pendingLanes;if(r===0)return 0;var n=0,a=e.suspendedLanes,i=e.pingedLanes,u=r&268435455;if(u!==0){var s=u&~a;s!==0?n=Sp(s):(i&=u,i!==0&&(n=Sp(i)))}else u=r&~a,u!==0?n=Sp(u):i!==0&&(n=Sp(i));if(n===0)return 0;if(t!==0&&t!==n&&!(t&a)&&(a=n&-n,i=t&-t,a>=i||a===16&&(i&4194240)!==0))return t;if(n&4&&(n|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)r=31-Ms(t),a=1<<r,n|=e[r],t&=~a;return n}function w5(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function S5(e,t){for(var r=e.suspendedLanes,n=e.pingedLanes,a=e.expirationTimes,i=e.pendingLanes;0<i;){var u=31-Ms(i),s=1<<u,h=a[u];h===-1?(!(s&r)||s&n)&&(a[u]=w5(s,t)):h<=t&&(e.expiredLanes|=s),i&=~s}}function v1(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function UN(){var e=lv;return lv<<=1,!(lv&4194240)&&(lv=64),e}function zb(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function zm(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Ms(t),e[t]=r}function E5(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<r;){var a=31-Ms(r),i=1<<a;t[a]=0,n[a]=-1,e[a]=-1,r&=~i}}function Z2(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var n=31-Ms(r),a=1<<n;a&t|e[n]&t&&(e[n]|=t),r&=~a}}var rn=0;function qN(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var HN,X2,GN,WN,ZN,y1=!1,cv=[],Hl=null,Gl=null,Wl=null,Zp=new Map,Xp=new Map,Ll=[],C5="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ek(e,t){switch(e){case"focusin":case"focusout":Hl=null;break;case"dragenter":case"dragleave":Gl=null;break;case"mouseover":case"mouseout":Wl=null;break;case"pointerover":case"pointerout":Zp.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Xp.delete(t.pointerId)}}function ep(e,t,r,n,a,i){return e===null||e.nativeEvent!==i?(e={blockedOn:t,domEventName:r,eventSystemFlags:n,nativeEvent:i,targetContainers:[a]},t!==null&&(t=Lm(t),t!==null&&X2(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,a!==null&&t.indexOf(a)===-1&&t.push(a),e)}function k5(e,t,r,n,a){switch(t){case"focusin":return Hl=ep(Hl,e,t,r,n,a),!0;case"dragenter":return Gl=ep(Gl,e,t,r,n,a),!0;case"mouseover":return Wl=ep(Wl,e,t,r,n,a),!0;case"pointerover":var i=a.pointerId;return Zp.set(i,ep(Zp.get(i)||null,e,t,r,n,a)),!0;case"gotpointercapture":return i=a.pointerId,Xp.set(i,ep(Xp.get(i)||null,e,t,r,n,a)),!0}return!1}function XN(e){var t=nc(e.target);if(t!==null){var r=Ic(t);if(r!==null){if(t=r.tag,t===13){if(t=BN(r),t!==null){e.blockedOn=t,ZN(e.priority,function(){GN(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Qv(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=x1(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var n=new r.constructor(r.type,r);f1=n,r.target.dispatchEvent(n),f1=null}else return t=Lm(r),t!==null&&X2(t),e.blockedOn=r,!1;t.shift()}return!0}function Ck(e,t,r){Qv(e)&&r.delete(t)}function T5(){y1=!1,Hl!==null&&Qv(Hl)&&(Hl=null),Gl!==null&&Qv(Gl)&&(Gl=null),Wl!==null&&Qv(Wl)&&(Wl=null),Zp.forEach(Ck),Xp.forEach(Ck)}function tp(e,t){e.blockedOn===t&&(e.blockedOn=null,y1||(y1=!0,Vi.unstable_scheduleCallback(Vi.unstable_NormalPriority,T5)))}function Kp(e){function t(a){return tp(a,e)}if(0<cv.length){tp(cv[0],e);for(var r=1;r<cv.length;r++){var n=cv[r];n.blockedOn===e&&(n.blockedOn=null)}}for(Hl!==null&&tp(Hl,e),Gl!==null&&tp(Gl,e),Wl!==null&&tp(Wl,e),Zp.forEach(t),Xp.forEach(t),r=0;r<Ll.length;r++)n=Ll[r],n.blockedOn===e&&(n.blockedOn=null);for(;0<Ll.length&&(r=Ll[0],r.blockedOn===null);)XN(r),r.blockedOn===null&&Ll.shift()}var ch=Wo.ReactCurrentBatchConfig,Ny=!0;function P5(e,t,r,n){var a=rn,i=ch.transition;ch.transition=null;try{rn=1,K2(e,t,r,n)}finally{rn=a,ch.transition=i}}function I5(e,t,r,n){var a=rn,i=ch.transition;ch.transition=null;try{rn=4,K2(e,t,r,n)}finally{rn=a,ch.transition=i}}function K2(e,t,r,n){if(Ny){var a=x1(e,t,r,n);if(a===null)qb(e,t,n,My,r),Ek(e,n);else if(k5(a,e,t,r,n))n.stopPropagation();else if(Ek(e,n),t&4&&-1<C5.indexOf(e)){for(;a!==null;){var i=Lm(a);if(i!==null&&HN(i),i=x1(e,t,r,n),i===null&&qb(e,t,n,My,r),i===a)break;a=i}a!==null&&n.stopPropagation()}else qb(e,t,n,null,r)}}var My=null;function x1(e,t,r,n){if(My=null,e=G2(n),e=nc(e),e!==null)if(t=Ic(e),t===null)e=null;else if(r=t.tag,r===13){if(e=BN(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return My=e,null}function KN(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(g5()){case W2:return 1;case $N:return 4;case Iy:case v5:return 16;case VN:return 536870912;default:return 16}default:return 16}}var Ol=null,Y2=null,ey=null;function YN(){if(ey)return ey;var e,t=Y2,r=t.length,n,a="value"in Ol?Ol.value:Ol.textContent,i=a.length;for(e=0;e<r&&t[e]===a[e];e++);var u=r-e;for(n=1;n<=u&&t[r-n]===a[i-n];n++);return ey=a.slice(e,1<n?1-n:void 0)}function ty(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function dv(){return!0}function kk(){return!1}function Hi(e){function t(r,n,a,i,u){this._reactName=r,this._targetInst=a,this.type=n,this.nativeEvent=i,this.target=u,this.currentTarget=null;for(var s in e)e.hasOwnProperty(s)&&(r=e[s],this[s]=r?r(i):i[s]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?dv:kk,this.isPropagationStopped=kk,this}return Mn(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=dv)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=dv)},persist:function(){},isPersistent:dv}),t}var Bh={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},J2=Hi(Bh),Rm=Mn({},Bh,{view:0,detail:0}),A5=Hi(Rm),Rb,Lb,rp,E0=Mn({},Rm,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Q2,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==rp&&(rp&&e.type==="mousemove"?(Rb=e.screenX-rp.screenX,Lb=e.screenY-rp.screenY):Lb=Rb=0,rp=e),Rb)},movementY:function(e){return"movementY"in e?e.movementY:Lb}}),Tk=Hi(E0),N5=Mn({},E0,{dataTransfer:0}),M5=Hi(N5),D5=Mn({},Rm,{relatedTarget:0}),Bb=Hi(D5),z5=Mn({},Bh,{animationName:0,elapsedTime:0,pseudoElement:0}),R5=Hi(z5),L5=Mn({},Bh,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),B5=Hi(L5),j5=Mn({},Bh,{data:0}),Pk=Hi(j5),O5={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},F5={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},$5={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function V5(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=$5[e])?!!t[e]:!1}function Q2(){return V5}var U5=Mn({},Rm,{key:function(e){if(e.key){var t=O5[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=ty(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?F5[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Q2,charCode:function(e){return e.type==="keypress"?ty(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?ty(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),q5=Hi(U5),H5=Mn({},E0,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ik=Hi(H5),G5=Mn({},Rm,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Q2}),W5=Hi(G5),Z5=Mn({},Bh,{propertyName:0,elapsedTime:0,pseudoElement:0}),X5=Hi(Z5),K5=Mn({},E0,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Y5=Hi(K5),J5=[9,13,27,32],eS=Oo&&"CompositionEvent"in window,zp=null;Oo&&"documentMode"in document&&(zp=document.documentMode);var Q5=Oo&&"TextEvent"in window&&!zp,JN=Oo&&(!eS||zp&&8<zp&&11>=zp),Ak=" ",Nk=!1;function QN(e,t){switch(e){case"keyup":return J5.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function eM(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Gd=!1;function ej(e,t){switch(e){case"compositionend":return eM(t);case"keypress":return t.which!==32?null:(Nk=!0,Ak);case"textInput":return e=t.data,e===Ak&&Nk?null:e;default:return null}}function tj(e,t){if(Gd)return e==="compositionend"||!eS&&QN(e,t)?(e=YN(),ey=Y2=Ol=null,Gd=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return JN&&t.locale!=="ko"?null:t.data;default:return null}}var rj={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Mk(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!rj[e.type]:t==="textarea"}function tM(e,t,r,n){MN(n),t=Dy(t,"onChange"),0<t.length&&(r=new J2("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var Rp=null,Yp=null;function nj(e){hM(e,0)}function C0(e){var t=Xd(e);if(CN(t))return e}function aj(e,t){if(e==="change")return t}var rM=!1;if(Oo){var jb;if(Oo){var Ob="oninput"in document;if(!Ob){var Dk=document.createElement("div");Dk.setAttribute("oninput","return;"),Ob=typeof Dk.oninput=="function"}jb=Ob}else jb=!1;rM=jb&&(!document.documentMode||9<document.documentMode)}function zk(){Rp&&(Rp.detachEvent("onpropertychange",nM),Yp=Rp=null)}function nM(e){if(e.propertyName==="value"&&C0(Yp)){var t=[];tM(t,Yp,e,G2(e)),LN(nj,t)}}function ij(e,t,r){e==="focusin"?(zk(),Rp=t,Yp=r,Rp.attachEvent("onpropertychange",nM)):e==="focusout"&&zk()}function sj(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return C0(Yp)}function oj(e,t){if(e==="click")return C0(t)}function lj(e,t){if(e==="input"||e==="change")return C0(t)}function uj(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Ls=typeof Object.is=="function"?Object.is:uj;function Jp(e,t){if(Ls(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var a=r[n];if(!t1.call(t,a)||!Ls(e[a],t[a]))return!1}return!0}function Rk(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Lk(e,t){var r=Rk(e);e=0;for(var n;r;){if(r.nodeType===3){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=Rk(r)}}function aM(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?aM(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function iM(){for(var e=window,t=ky();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=ky(e.document)}return t}function tS(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function cj(e){var t=iM(),r=e.focusedElem,n=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&aM(r.ownerDocument.documentElement,r)){if(n!==null&&tS(r)){if(t=n.start,e=n.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var a=r.textContent.length,i=Math.min(n.start,a);n=n.end===void 0?i:Math.min(n.end,a),!e.extend&&i>n&&(a=n,n=i,i=a),a=Lk(r,i);var u=Lk(r,n);a&&u&&(e.rangeCount!==1||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==u.node||e.focusOffset!==u.offset)&&(t=t.createRange(),t.setStart(a.node,a.offset),e.removeAllRanges(),i>n?(e.addRange(t),e.extend(u.node,u.offset)):(t.setEnd(u.node,u.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var dj=Oo&&"documentMode"in document&&11>=document.documentMode,Wd=null,b1=null,Lp=null,_1=!1;function Bk(e,t,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;_1||Wd==null||Wd!==ky(n)||(n=Wd,"selectionStart"in n&&tS(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Lp&&Jp(Lp,n)||(Lp=n,n=Dy(b1,"onSelect"),0<n.length&&(t=new J2("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=Wd)))}function hv(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var Zd={animationend:hv("Animation","AnimationEnd"),animationiteration:hv("Animation","AnimationIteration"),animationstart:hv("Animation","AnimationStart"),transitionend:hv("Transition","TransitionEnd")},Fb={},sM={};Oo&&(sM=document.createElement("div").style,"AnimationEvent"in window||(delete Zd.animationend.animation,delete Zd.animationiteration.animation,delete Zd.animationstart.animation),"TransitionEvent"in window||delete Zd.transitionend.transition);function k0(e){if(Fb[e])return Fb[e];if(!Zd[e])return e;var t=Zd[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in sM)return Fb[e]=t[r];return e}var oM=k0("animationend"),lM=k0("animationiteration"),uM=k0("animationstart"),cM=k0("transitionend"),dM=new Map,jk="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function du(e,t){dM.set(e,t),Pc(t,[e])}for(var $b=0;$b<jk.length;$b++){var Vb=jk[$b],hj=Vb.toLowerCase(),fj=Vb[0].toUpperCase()+Vb.slice(1);du(hj,"on"+fj)}du(oM,"onAnimationEnd");du(lM,"onAnimationIteration");du(uM,"onAnimationStart");du("dblclick","onDoubleClick");du("focusin","onFocus");du("focusout","onBlur");du(cM,"onTransitionEnd");_h("onMouseEnter",["mouseout","mouseover"]);_h("onMouseLeave",["mouseout","mouseover"]);_h("onPointerEnter",["pointerout","pointerover"]);_h("onPointerLeave",["pointerout","pointerover"]);Pc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Pc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Pc("onBeforeInput",["compositionend","keypress","textInput","paste"]);Pc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Pc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Pc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ep="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),pj=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ep));function Ok(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,h5(n,t,void 0,e),e.currentTarget=null}function hM(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var n=e[r],a=n.event;n=n.listeners;e:{var i=void 0;if(t)for(var u=n.length-1;0<=u;u--){var s=n[u],h=s.instance,p=s.currentTarget;if(s=s.listener,h!==i&&a.isPropagationStopped())break e;Ok(a,s,p),i=h}else for(u=0;u<n.length;u++){if(s=n[u],h=s.instance,p=s.currentTarget,s=s.listener,h!==i&&a.isPropagationStopped())break e;Ok(a,s,p),i=h}}}if(Py)throw e=g1,Py=!1,g1=null,e}function xn(e,t){var r=t[k1];r===void 0&&(r=t[k1]=new Set);var n=e+"__bubble";r.has(n)||(fM(t,e,2,!1),r.add(n))}function Ub(e,t,r){var n=0;t&&(n|=4),fM(r,e,n,t)}var fv="_reactListening"+Math.random().toString(36).slice(2);function Qp(e){if(!e[fv]){e[fv]=!0,bN.forEach(function(r){r!=="selectionchange"&&(pj.has(r)||Ub(r,!1,e),Ub(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[fv]||(t[fv]=!0,Ub("selectionchange",!1,t))}}function fM(e,t,r,n){switch(KN(t)){case 1:var a=P5;break;case 4:a=I5;break;default:a=K2}r=a.bind(null,t,r,e),a=void 0,!m1||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(a=!0),n?a!==void 0?e.addEventListener(t,r,{capture:!0,passive:a}):e.addEventListener(t,r,!0):a!==void 0?e.addEventListener(t,r,{passive:a}):e.addEventListener(t,r,!1)}function qb(e,t,r,n,a){var i=n;if(!(t&1)&&!(t&2)&&n!==null)e:for(;;){if(n===null)return;var u=n.tag;if(u===3||u===4){var s=n.stateNode.containerInfo;if(s===a||s.nodeType===8&&s.parentNode===a)break;if(u===4)for(u=n.return;u!==null;){var h=u.tag;if((h===3||h===4)&&(h=u.stateNode.containerInfo,h===a||h.nodeType===8&&h.parentNode===a))return;u=u.return}for(;s!==null;){if(u=nc(s),u===null)return;if(h=u.tag,h===5||h===6){n=i=u;continue e}s=s.parentNode}}n=n.return}LN(function(){var p=i,g=G2(r),v=[];e:{var x=dM.get(e);if(x!==void 0){var S=J2,P=e;switch(e){case"keypress":if(ty(r)===0)break e;case"keydown":case"keyup":S=q5;break;case"focusin":P="focus",S=Bb;break;case"focusout":P="blur",S=Bb;break;case"beforeblur":case"afterblur":S=Bb;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":S=Tk;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":S=M5;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":S=W5;break;case oM:case lM:case uM:S=R5;break;case cM:S=X5;break;case"scroll":S=A5;break;case"wheel":S=Y5;break;case"copy":case"cut":case"paste":S=B5;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":S=Ik}var N=(t&4)!==0,M=!N&&e==="scroll",I=N?x!==null?x+"Capture":null:x;N=[];for(var A=p,D;A!==null;){D=A;var j=D.stateNode;if(D.tag===5&&j!==null&&(D=j,I!==null&&(j=Wp(A,I),j!=null&&N.push(em(A,j,D)))),M)break;A=A.return}0<N.length&&(x=new S(x,P,null,r,g),v.push({event:x,listeners:N}))}}if(!(t&7)){e:{if(x=e==="mouseover"||e==="pointerover",S=e==="mouseout"||e==="pointerout",x&&r!==f1&&(P=r.relatedTarget||r.fromElement)&&(nc(P)||P[Fo]))break e;if((S||x)&&(x=g.window===g?g:(x=g.ownerDocument)?x.defaultView||x.parentWindow:window,S?(P=r.relatedTarget||r.toElement,S=p,P=P?nc(P):null,P!==null&&(M=Ic(P),P!==M||P.tag!==5&&P.tag!==6)&&(P=null)):(S=null,P=p),S!==P)){if(N=Tk,j="onMouseLeave",I="onMouseEnter",A="mouse",(e==="pointerout"||e==="pointerover")&&(N=Ik,j="onPointerLeave",I="onPointerEnter",A="pointer"),M=S==null?x:Xd(S),D=P==null?x:Xd(P),x=new N(j,A+"leave",S,r,g),x.target=M,x.relatedTarget=D,j=null,nc(g)===p&&(N=new N(I,A+"enter",P,r,g),N.target=D,N.relatedTarget=M,j=N),M=j,S&&P)t:{for(N=S,I=P,A=0,D=N;D;D=Id(D))A++;for(D=0,j=I;j;j=Id(j))D++;for(;0<A-D;)N=Id(N),A--;for(;0<D-A;)I=Id(I),D--;for(;A--;){if(N===I||I!==null&&N===I.alternate)break t;N=Id(N),I=Id(I)}N=null}else N=null;S!==null&&Fk(v,x,S,N,!1),P!==null&&M!==null&&Fk(v,M,P,N,!0)}}e:{if(x=p?Xd(p):window,S=x.nodeName&&x.nodeName.toLowerCase(),S==="select"||S==="input"&&x.type==="file")var V=aj;else if(Mk(x))if(rM)V=lj;else{V=sj;var U=ij}else(S=x.nodeName)&&S.toLowerCase()==="input"&&(x.type==="checkbox"||x.type==="radio")&&(V=oj);if(V&&(V=V(e,p))){tM(v,V,r,g);break e}U&&U(e,x,p),e==="focusout"&&(U=x._wrapperState)&&U.controlled&&x.type==="number"&&l1(x,"number",x.value)}switch(U=p?Xd(p):window,e){case"focusin":(Mk(U)||U.contentEditable==="true")&&(Wd=U,b1=p,Lp=null);break;case"focusout":Lp=b1=Wd=null;break;case"mousedown":_1=!0;break;case"contextmenu":case"mouseup":case"dragend":_1=!1,Bk(v,r,g);break;case"selectionchange":if(dj)break;case"keydown":case"keyup":Bk(v,r,g)}var $;if(eS)e:{switch(e){case"compositionstart":var W="onCompositionStart";break e;case"compositionend":W="onCompositionEnd";break e;case"compositionupdate":W="onCompositionUpdate";break e}W=void 0}else Gd?QN(e,r)&&(W="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(W="onCompositionStart");W&&(JN&&r.locale!=="ko"&&(Gd||W!=="onCompositionStart"?W==="onCompositionEnd"&&Gd&&($=YN()):(Ol=g,Y2="value"in Ol?Ol.value:Ol.textContent,Gd=!0)),U=Dy(p,W),0<U.length&&(W=new Pk(W,e,null,r,g),v.push({event:W,listeners:U}),$?W.data=$:($=eM(r),$!==null&&(W.data=$)))),($=Q5?ej(e,r):tj(e,r))&&(p=Dy(p,"onBeforeInput"),0<p.length&&(g=new Pk("onBeforeInput","beforeinput",null,r,g),v.push({event:g,listeners:p}),g.data=$))}hM(v,t)})}function em(e,t,r){return{instance:e,listener:t,currentTarget:r}}function Dy(e,t){for(var r=t+"Capture",n=[];e!==null;){var a=e,i=a.stateNode;a.tag===5&&i!==null&&(a=i,i=Wp(e,r),i!=null&&n.unshift(em(e,i,a)),i=Wp(e,t),i!=null&&n.push(em(e,i,a))),e=e.return}return n}function Id(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function Fk(e,t,r,n,a){for(var i=t._reactName,u=[];r!==null&&r!==n;){var s=r,h=s.alternate,p=s.stateNode;if(h!==null&&h===n)break;s.tag===5&&p!==null&&(s=p,a?(h=Wp(r,i),h!=null&&u.unshift(em(r,h,s))):a||(h=Wp(r,i),h!=null&&u.push(em(r,h,s)))),r=r.return}u.length!==0&&e.push({event:t,listeners:u})}var mj=/\r\n?/g,gj=/\u0000|\uFFFD/g;function $k(e){return(typeof e=="string"?e:""+e).replace(mj,`
`).replace(gj,"")}function pv(e,t,r){if(t=$k(t),$k(e)!==t&&r)throw Error(Pt(425))}function zy(){}var w1=null,S1=null;function E1(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var C1=typeof setTimeout=="function"?setTimeout:void 0,vj=typeof clearTimeout=="function"?clearTimeout:void 0,Vk=typeof Promise=="function"?Promise:void 0,yj=typeof queueMicrotask=="function"?queueMicrotask:typeof Vk<"u"?function(e){return Vk.resolve(null).then(e).catch(xj)}:C1;function xj(e){setTimeout(function(){throw e})}function Hb(e,t){var r=t,n=0;do{var a=r.nextSibling;if(e.removeChild(r),a&&a.nodeType===8)if(r=a.data,r==="/$"){if(n===0){e.removeChild(a),Kp(t);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=a}while(r);Kp(t)}function Zl(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Uk(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var jh=Math.random().toString(36).slice(2),Qs="__reactFiber$"+jh,tm="__reactProps$"+jh,Fo="__reactContainer$"+jh,k1="__reactEvents$"+jh,bj="__reactListeners$"+jh,_j="__reactHandles$"+jh;function nc(e){var t=e[Qs];if(t)return t;for(var r=e.parentNode;r;){if(t=r[Fo]||r[Qs]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=Uk(e);e!==null;){if(r=e[Qs])return r;e=Uk(e)}return t}e=r,r=e.parentNode}return null}function Lm(e){return e=e[Qs]||e[Fo],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Xd(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Pt(33))}function T0(e){return e[tm]||null}var T1=[],Kd=-1;function hu(e){return{current:e}}function bn(e){0>Kd||(e.current=T1[Kd],T1[Kd]=null,Kd--)}function fn(e,t){Kd++,T1[Kd]=e.current,e.current=t}var au={},Ua=hu(au),Ei=hu(!1),mc=au;function wh(e,t){var r=e.type.contextTypes;if(!r)return au;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var a={},i;for(i in r)a[i]=t[i];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Ci(e){return e=e.childContextTypes,e!=null}function Ry(){bn(Ei),bn(Ua)}function qk(e,t,r){if(Ua.current!==au)throw Error(Pt(168));fn(Ua,t),fn(Ei,r)}function pM(e,t,r){var n=e.stateNode;if(t=t.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var a in n)if(!(a in t))throw Error(Pt(108,i5(e)||"Unknown",a));return Mn({},r,n)}function Ly(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||au,mc=Ua.current,fn(Ua,e),fn(Ei,Ei.current),!0}function Hk(e,t,r){var n=e.stateNode;if(!n)throw Error(Pt(169));r?(e=pM(e,t,mc),n.__reactInternalMemoizedMergedChildContext=e,bn(Ei),bn(Ua),fn(Ua,e)):bn(Ei),fn(Ei,r)}var No=null,P0=!1,Gb=!1;function mM(e){No===null?No=[e]:No.push(e)}function wj(e){P0=!0,mM(e)}function fu(){if(!Gb&&No!==null){Gb=!0;var e=0,t=rn;try{var r=No;for(rn=1;e<r.length;e++){var n=r[e];do n=n(!0);while(n!==null)}No=null,P0=!1}catch(a){throw No!==null&&(No=No.slice(e+1)),FN(W2,fu),a}finally{rn=t,Gb=!1}}return null}var Yd=[],Jd=0,By=null,jy=0,rs=[],ns=0,gc=null,Do=1,zo="";function Xu(e,t){Yd[Jd++]=jy,Yd[Jd++]=By,By=e,jy=t}function gM(e,t,r){rs[ns++]=Do,rs[ns++]=zo,rs[ns++]=gc,gc=e;var n=Do;e=zo;var a=32-Ms(n)-1;n&=~(1<<a),r+=1;var i=32-Ms(t)+a;if(30<i){var u=a-a%5;i=(n&(1<<u)-1).toString(32),n>>=u,a-=u,Do=1<<32-Ms(t)+a|r<<a|n,zo=i+e}else Do=1<<i|r<<a|n,zo=e}function rS(e){e.return!==null&&(Xu(e,1),gM(e,1,0))}function nS(e){for(;e===By;)By=Yd[--Jd],Yd[Jd]=null,jy=Yd[--Jd],Yd[Jd]=null;for(;e===gc;)gc=rs[--ns],rs[ns]=null,zo=rs[--ns],rs[ns]=null,Do=rs[--ns],rs[ns]=null}var Fi=null,Oi=null,kn=!1,Ps=null;function vM(e,t){var r=os(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function Gk(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Fi=e,Oi=Zl(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Fi=e,Oi=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=gc!==null?{id:Do,overflow:zo}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=os(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,Fi=e,Oi=null,!0):!1;default:return!1}}function P1(e){return(e.mode&1)!==0&&(e.flags&128)===0}function I1(e){if(kn){var t=Oi;if(t){var r=t;if(!Gk(e,t)){if(P1(e))throw Error(Pt(418));t=Zl(r.nextSibling);var n=Fi;t&&Gk(e,t)?vM(n,r):(e.flags=e.flags&-4097|2,kn=!1,Fi=e)}}else{if(P1(e))throw Error(Pt(418));e.flags=e.flags&-4097|2,kn=!1,Fi=e}}}function Wk(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Fi=e}function mv(e){if(e!==Fi)return!1;if(!kn)return Wk(e),kn=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!E1(e.type,e.memoizedProps)),t&&(t=Oi)){if(P1(e))throw yM(),Error(Pt(418));for(;t;)vM(e,t),t=Zl(t.nextSibling)}if(Wk(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Pt(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){Oi=Zl(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}Oi=null}}else Oi=Fi?Zl(e.stateNode.nextSibling):null;return!0}function yM(){for(var e=Oi;e;)e=Zl(e.nextSibling)}function Sh(){Oi=Fi=null,kn=!1}function aS(e){Ps===null?Ps=[e]:Ps.push(e)}var Sj=Wo.ReactCurrentBatchConfig;function np(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(Pt(309));var n=r.stateNode}if(!n)throw Error(Pt(147,e));var a=n,i=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===i?t.ref:(t=function(u){var s=a.refs;u===null?delete s[i]:s[i]=u},t._stringRef=i,t)}if(typeof e!="string")throw Error(Pt(284));if(!r._owner)throw Error(Pt(290,e))}return e}function gv(e,t){throw e=Object.prototype.toString.call(t),Error(Pt(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Zk(e){var t=e._init;return t(e._payload)}function xM(e){function t(I,A){if(e){var D=I.deletions;D===null?(I.deletions=[A],I.flags|=16):D.push(A)}}function r(I,A){if(!e)return null;for(;A!==null;)t(I,A),A=A.sibling;return null}function n(I,A){for(I=new Map;A!==null;)A.key!==null?I.set(A.key,A):I.set(A.index,A),A=A.sibling;return I}function a(I,A){return I=Jl(I,A),I.index=0,I.sibling=null,I}function i(I,A,D){return I.index=D,e?(D=I.alternate,D!==null?(D=D.index,D<A?(I.flags|=2,A):D):(I.flags|=2,A)):(I.flags|=1048576,A)}function u(I){return e&&I.alternate===null&&(I.flags|=2),I}function s(I,A,D,j){return A===null||A.tag!==6?(A=Qb(D,I.mode,j),A.return=I,A):(A=a(A,D),A.return=I,A)}function h(I,A,D,j){var V=D.type;return V===Hd?g(I,A,D.props.children,j,D.key):A!==null&&(A.elementType===V||typeof V=="object"&&V!==null&&V.$$typeof===Nl&&Zk(V)===A.type)?(j=a(A,D.props),j.ref=np(I,A,D),j.return=I,j):(j=ly(D.type,D.key,D.props,null,I.mode,j),j.ref=np(I,A,D),j.return=I,j)}function p(I,A,D,j){return A===null||A.tag!==4||A.stateNode.containerInfo!==D.containerInfo||A.stateNode.implementation!==D.implementation?(A=e_(D,I.mode,j),A.return=I,A):(A=a(A,D.children||[]),A.return=I,A)}function g(I,A,D,j,V){return A===null||A.tag!==7?(A=dc(D,I.mode,j,V),A.return=I,A):(A=a(A,D),A.return=I,A)}function v(I,A,D){if(typeof A=="string"&&A!==""||typeof A=="number")return A=Qb(""+A,I.mode,D),A.return=I,A;if(typeof A=="object"&&A!==null){switch(A.$$typeof){case iv:return D=ly(A.type,A.key,A.props,null,I.mode,D),D.ref=np(I,null,A),D.return=I,D;case qd:return A=e_(A,I.mode,D),A.return=I,A;case Nl:var j=A._init;return v(I,j(A._payload),D)}if(wp(A)||Jf(A))return A=dc(A,I.mode,D,null),A.return=I,A;gv(I,A)}return null}function x(I,A,D,j){var V=A!==null?A.key:null;if(typeof D=="string"&&D!==""||typeof D=="number")return V!==null?null:s(I,A,""+D,j);if(typeof D=="object"&&D!==null){switch(D.$$typeof){case iv:return D.key===V?h(I,A,D,j):null;case qd:return D.key===V?p(I,A,D,j):null;case Nl:return V=D._init,x(I,A,V(D._payload),j)}if(wp(D)||Jf(D))return V!==null?null:g(I,A,D,j,null);gv(I,D)}return null}function S(I,A,D,j,V){if(typeof j=="string"&&j!==""||typeof j=="number")return I=I.get(D)||null,s(A,I,""+j,V);if(typeof j=="object"&&j!==null){switch(j.$$typeof){case iv:return I=I.get(j.key===null?D:j.key)||null,h(A,I,j,V);case qd:return I=I.get(j.key===null?D:j.key)||null,p(A,I,j,V);case Nl:var U=j._init;return S(I,A,D,U(j._payload),V)}if(wp(j)||Jf(j))return I=I.get(D)||null,g(A,I,j,V,null);gv(A,j)}return null}function P(I,A,D,j){for(var V=null,U=null,$=A,W=A=0,X=null;$!==null&&W<D.length;W++){$.index>W?(X=$,$=null):X=$.sibling;var J=x(I,$,D[W],j);if(J===null){$===null&&($=X);break}e&&$&&J.alternate===null&&t(I,$),A=i(J,A,W),U===null?V=J:U.sibling=J,U=J,$=X}if(W===D.length)return r(I,$),kn&&Xu(I,W),V;if($===null){for(;W<D.length;W++)$=v(I,D[W],j),$!==null&&(A=i($,A,W),U===null?V=$:U.sibling=$,U=$);return kn&&Xu(I,W),V}for($=n(I,$);W<D.length;W++)X=S($,I,W,D[W],j),X!==null&&(e&&X.alternate!==null&&$.delete(X.key===null?W:X.key),A=i(X,A,W),U===null?V=X:U.sibling=X,U=X);return e&&$.forEach(function(Z){return t(I,Z)}),kn&&Xu(I,W),V}function N(I,A,D,j){var V=Jf(D);if(typeof V!="function")throw Error(Pt(150));if(D=V.call(D),D==null)throw Error(Pt(151));for(var U=V=null,$=A,W=A=0,X=null,J=D.next();$!==null&&!J.done;W++,J=D.next()){$.index>W?(X=$,$=null):X=$.sibling;var Z=x(I,$,J.value,j);if(Z===null){$===null&&($=X);break}e&&$&&Z.alternate===null&&t(I,$),A=i(Z,A,W),U===null?V=Z:U.sibling=Z,U=Z,$=X}if(J.done)return r(I,$),kn&&Xu(I,W),V;if($===null){for(;!J.done;W++,J=D.next())J=v(I,J.value,j),J!==null&&(A=i(J,A,W),U===null?V=J:U.sibling=J,U=J);return kn&&Xu(I,W),V}for($=n(I,$);!J.done;W++,J=D.next())J=S($,I,W,J.value,j),J!==null&&(e&&J.alternate!==null&&$.delete(J.key===null?W:J.key),A=i(J,A,W),U===null?V=J:U.sibling=J,U=J);return e&&$.forEach(function(K){return t(I,K)}),kn&&Xu(I,W),V}function M(I,A,D,j){if(typeof D=="object"&&D!==null&&D.type===Hd&&D.key===null&&(D=D.props.children),typeof D=="object"&&D!==null){switch(D.$$typeof){case iv:e:{for(var V=D.key,U=A;U!==null;){if(U.key===V){if(V=D.type,V===Hd){if(U.tag===7){r(I,U.sibling),A=a(U,D.props.children),A.return=I,I=A;break e}}else if(U.elementType===V||typeof V=="object"&&V!==null&&V.$$typeof===Nl&&Zk(V)===U.type){r(I,U.sibling),A=a(U,D.props),A.ref=np(I,U,D),A.return=I,I=A;break e}r(I,U);break}else t(I,U);U=U.sibling}D.type===Hd?(A=dc(D.props.children,I.mode,j,D.key),A.return=I,I=A):(j=ly(D.type,D.key,D.props,null,I.mode,j),j.ref=np(I,A,D),j.return=I,I=j)}return u(I);case qd:e:{for(U=D.key;A!==null;){if(A.key===U)if(A.tag===4&&A.stateNode.containerInfo===D.containerInfo&&A.stateNode.implementation===D.implementation){r(I,A.sibling),A=a(A,D.children||[]),A.return=I,I=A;break e}else{r(I,A);break}else t(I,A);A=A.sibling}A=e_(D,I.mode,j),A.return=I,I=A}return u(I);case Nl:return U=D._init,M(I,A,U(D._payload),j)}if(wp(D))return P(I,A,D,j);if(Jf(D))return N(I,A,D,j);gv(I,D)}return typeof D=="string"&&D!==""||typeof D=="number"?(D=""+D,A!==null&&A.tag===6?(r(I,A.sibling),A=a(A,D),A.return=I,I=A):(r(I,A),A=Qb(D,I.mode,j),A.return=I,I=A),u(I)):r(I,A)}return M}var Eh=xM(!0),bM=xM(!1),Oy=hu(null),Fy=null,Qd=null,iS=null;function sS(){iS=Qd=Fy=null}function oS(e){var t=Oy.current;bn(Oy),e._currentValue=t}function A1(e,t,r){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===r)break;e=e.return}}function dh(e,t){Fy=e,iS=Qd=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(_i=!0),e.firstContext=null)}function hs(e){var t=e._currentValue;if(iS!==e)if(e={context:e,memoizedValue:t,next:null},Qd===null){if(Fy===null)throw Error(Pt(308));Qd=e,Fy.dependencies={lanes:0,firstContext:e}}else Qd=Qd.next=e;return t}var ac=null;function lS(e){ac===null?ac=[e]:ac.push(e)}function _M(e,t,r,n){var a=t.interleaved;return a===null?(r.next=r,lS(t)):(r.next=a.next,a.next=r),t.interleaved=r,$o(e,n)}function $o(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var Ml=!1;function uS(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function wM(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Bo(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Xl(e,t,r){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,Vr&2){var a=n.pending;return a===null?t.next=t:(t.next=a.next,a.next=t),n.pending=t,$o(e,r)}return a=n.interleaved,a===null?(t.next=t,lS(n)):(t.next=a.next,a.next=t),n.interleaved=t,$o(e,r)}function ry(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,Z2(e,r)}}function Xk(e,t){var r=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var a=null,i=null;if(r=r.firstBaseUpdate,r!==null){do{var u={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};i===null?a=i=u:i=i.next=u,r=r.next}while(r!==null);i===null?a=i=t:i=i.next=t}else a=i=t;r={baseState:n.baseState,firstBaseUpdate:a,lastBaseUpdate:i,shared:n.shared,effects:n.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function $y(e,t,r,n){var a=e.updateQueue;Ml=!1;var i=a.firstBaseUpdate,u=a.lastBaseUpdate,s=a.shared.pending;if(s!==null){a.shared.pending=null;var h=s,p=h.next;h.next=null,u===null?i=p:u.next=p,u=h;var g=e.alternate;g!==null&&(g=g.updateQueue,s=g.lastBaseUpdate,s!==u&&(s===null?g.firstBaseUpdate=p:s.next=p,g.lastBaseUpdate=h))}if(i!==null){var v=a.baseState;u=0,g=p=h=null,s=i;do{var x=s.lane,S=s.eventTime;if((n&x)===x){g!==null&&(g=g.next={eventTime:S,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var P=e,N=s;switch(x=t,S=r,N.tag){case 1:if(P=N.payload,typeof P=="function"){v=P.call(S,v,x);break e}v=P;break e;case 3:P.flags=P.flags&-65537|128;case 0:if(P=N.payload,x=typeof P=="function"?P.call(S,v,x):P,x==null)break e;v=Mn({},v,x);break e;case 2:Ml=!0}}s.callback!==null&&s.lane!==0&&(e.flags|=64,x=a.effects,x===null?a.effects=[s]:x.push(s))}else S={eventTime:S,lane:x,tag:s.tag,payload:s.payload,callback:s.callback,next:null},g===null?(p=g=S,h=v):g=g.next=S,u|=x;if(s=s.next,s===null){if(s=a.shared.pending,s===null)break;x=s,s=x.next,x.next=null,a.lastBaseUpdate=x,a.shared.pending=null}}while(!0);if(g===null&&(h=v),a.baseState=h,a.firstBaseUpdate=p,a.lastBaseUpdate=g,t=a.shared.interleaved,t!==null){a=t;do u|=a.lane,a=a.next;while(a!==t)}else i===null&&(a.shared.lanes=0);yc|=u,e.lanes=u,e.memoizedState=v}}function Kk(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],a=n.callback;if(a!==null){if(n.callback=null,n=r,typeof a!="function")throw Error(Pt(191,a));a.call(n)}}}var Bm={},no=hu(Bm),rm=hu(Bm),nm=hu(Bm);function ic(e){if(e===Bm)throw Error(Pt(174));return e}function cS(e,t){switch(fn(nm,t),fn(rm,e),fn(no,Bm),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:c1(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=c1(t,e)}bn(no),fn(no,t)}function Ch(){bn(no),bn(rm),bn(nm)}function SM(e){ic(nm.current);var t=ic(no.current),r=c1(t,e.type);t!==r&&(fn(rm,e),fn(no,r))}function dS(e){rm.current===e&&(bn(no),bn(rm))}var In=hu(0);function Vy(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Wb=[];function hS(){for(var e=0;e<Wb.length;e++)Wb[e]._workInProgressVersionPrimary=null;Wb.length=0}var ny=Wo.ReactCurrentDispatcher,Zb=Wo.ReactCurrentBatchConfig,vc=0,An=null,Jn=null,pa=null,Uy=!1,Bp=!1,am=0,Ej=0;function Fa(){throw Error(Pt(321))}function fS(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!Ls(e[r],t[r]))return!1;return!0}function pS(e,t,r,n,a,i){if(vc=i,An=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ny.current=e===null||e.memoizedState===null?Pj:Ij,e=r(n,a),Bp){i=0;do{if(Bp=!1,am=0,25<=i)throw Error(Pt(301));i+=1,pa=Jn=null,t.updateQueue=null,ny.current=Aj,e=r(n,a)}while(Bp)}if(ny.current=qy,t=Jn!==null&&Jn.next!==null,vc=0,pa=Jn=An=null,Uy=!1,t)throw Error(Pt(300));return e}function mS(){var e=am!==0;return am=0,e}function Js(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return pa===null?An.memoizedState=pa=e:pa=pa.next=e,pa}function fs(){if(Jn===null){var e=An.alternate;e=e!==null?e.memoizedState:null}else e=Jn.next;var t=pa===null?An.memoizedState:pa.next;if(t!==null)pa=t,Jn=e;else{if(e===null)throw Error(Pt(310));Jn=e,e={memoizedState:Jn.memoizedState,baseState:Jn.baseState,baseQueue:Jn.baseQueue,queue:Jn.queue,next:null},pa===null?An.memoizedState=pa=e:pa=pa.next=e}return pa}function im(e,t){return typeof t=="function"?t(e):t}function Xb(e){var t=fs(),r=t.queue;if(r===null)throw Error(Pt(311));r.lastRenderedReducer=e;var n=Jn,a=n.baseQueue,i=r.pending;if(i!==null){if(a!==null){var u=a.next;a.next=i.next,i.next=u}n.baseQueue=a=i,r.pending=null}if(a!==null){i=a.next,n=n.baseState;var s=u=null,h=null,p=i;do{var g=p.lane;if((vc&g)===g)h!==null&&(h=h.next={lane:0,action:p.action,hasEagerState:p.hasEagerState,eagerState:p.eagerState,next:null}),n=p.hasEagerState?p.eagerState:e(n,p.action);else{var v={lane:g,action:p.action,hasEagerState:p.hasEagerState,eagerState:p.eagerState,next:null};h===null?(s=h=v,u=n):h=h.next=v,An.lanes|=g,yc|=g}p=p.next}while(p!==null&&p!==i);h===null?u=n:h.next=s,Ls(n,t.memoizedState)||(_i=!0),t.memoizedState=n,t.baseState=u,t.baseQueue=h,r.lastRenderedState=n}if(e=r.interleaved,e!==null){a=e;do i=a.lane,An.lanes|=i,yc|=i,a=a.next;while(a!==e)}else a===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function Kb(e){var t=fs(),r=t.queue;if(r===null)throw Error(Pt(311));r.lastRenderedReducer=e;var n=r.dispatch,a=r.pending,i=t.memoizedState;if(a!==null){r.pending=null;var u=a=a.next;do i=e(i,u.action),u=u.next;while(u!==a);Ls(i,t.memoizedState)||(_i=!0),t.memoizedState=i,t.baseQueue===null&&(t.baseState=i),r.lastRenderedState=i}return[i,n]}function EM(){}function CM(e,t){var r=An,n=fs(),a=t(),i=!Ls(n.memoizedState,a);if(i&&(n.memoizedState=a,_i=!0),n=n.queue,gS(PM.bind(null,r,n,e),[e]),n.getSnapshot!==t||i||pa!==null&&pa.memoizedState.tag&1){if(r.flags|=2048,sm(9,TM.bind(null,r,n,a,t),void 0,null),ma===null)throw Error(Pt(349));vc&30||kM(r,t,a)}return a}function kM(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=An.updateQueue,t===null?(t={lastEffect:null,stores:null},An.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function TM(e,t,r,n){t.value=r,t.getSnapshot=n,IM(t)&&AM(e)}function PM(e,t,r){return r(function(){IM(t)&&AM(e)})}function IM(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!Ls(e,r)}catch{return!0}}function AM(e){var t=$o(e,1);t!==null&&Ds(t,e,1,-1)}function Yk(e){var t=Js();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:im,lastRenderedState:e},t.queue=e,e=e.dispatch=Tj.bind(null,An,e),[t.memoizedState,e]}function sm(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},t=An.updateQueue,t===null?(t={lastEffect:null,stores:null},An.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e)),e}function NM(){return fs().memoizedState}function ay(e,t,r,n){var a=Js();An.flags|=e,a.memoizedState=sm(1|t,r,void 0,n===void 0?null:n)}function I0(e,t,r,n){var a=fs();n=n===void 0?null:n;var i=void 0;if(Jn!==null){var u=Jn.memoizedState;if(i=u.destroy,n!==null&&fS(n,u.deps)){a.memoizedState=sm(t,r,i,n);return}}An.flags|=e,a.memoizedState=sm(1|t,r,i,n)}function Jk(e,t){return ay(8390656,8,e,t)}function gS(e,t){return I0(2048,8,e,t)}function MM(e,t){return I0(4,2,e,t)}function DM(e,t){return I0(4,4,e,t)}function zM(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function RM(e,t,r){return r=r!=null?r.concat([e]):null,I0(4,4,zM.bind(null,t,e),r)}function vS(){}function LM(e,t){var r=fs();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&fS(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function BM(e,t){var r=fs();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&fS(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function jM(e,t,r){return vc&21?(Ls(r,t)||(r=UN(),An.lanes|=r,yc|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,_i=!0),e.memoizedState=r)}function Cj(e,t){var r=rn;rn=r!==0&&4>r?r:4,e(!0);var n=Zb.transition;Zb.transition={};try{e(!1),t()}finally{rn=r,Zb.transition=n}}function OM(){return fs().memoizedState}function kj(e,t,r){var n=Yl(e);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},FM(e))$M(t,r);else if(r=_M(e,t,r,n),r!==null){var a=ri();Ds(r,e,n,a),VM(r,t,n)}}function Tj(e,t,r){var n=Yl(e),a={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(FM(e))$M(t,a);else{var i=e.alternate;if(e.lanes===0&&(i===null||i.lanes===0)&&(i=t.lastRenderedReducer,i!==null))try{var u=t.lastRenderedState,s=i(u,r);if(a.hasEagerState=!0,a.eagerState=s,Ls(s,u)){var h=t.interleaved;h===null?(a.next=a,lS(t)):(a.next=h.next,h.next=a),t.interleaved=a;return}}catch{}finally{}r=_M(e,t,a,n),r!==null&&(a=ri(),Ds(r,e,n,a),VM(r,t,n))}}function FM(e){var t=e.alternate;return e===An||t!==null&&t===An}function $M(e,t){Bp=Uy=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function VM(e,t,r){if(r&4194240){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,Z2(e,r)}}var qy={readContext:hs,useCallback:Fa,useContext:Fa,useEffect:Fa,useImperativeHandle:Fa,useInsertionEffect:Fa,useLayoutEffect:Fa,useMemo:Fa,useReducer:Fa,useRef:Fa,useState:Fa,useDebugValue:Fa,useDeferredValue:Fa,useTransition:Fa,useMutableSource:Fa,useSyncExternalStore:Fa,useId:Fa,unstable_isNewReconciler:!1},Pj={readContext:hs,useCallback:function(e,t){return Js().memoizedState=[e,t===void 0?null:t],e},useContext:hs,useEffect:Jk,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,ay(4194308,4,zM.bind(null,t,e),r)},useLayoutEffect:function(e,t){return ay(4194308,4,e,t)},useInsertionEffect:function(e,t){return ay(4,2,e,t)},useMemo:function(e,t){var r=Js();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=Js();return t=r!==void 0?r(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=kj.bind(null,An,e),[n.memoizedState,e]},useRef:function(e){var t=Js();return e={current:e},t.memoizedState=e},useState:Yk,useDebugValue:vS,useDeferredValue:function(e){return Js().memoizedState=e},useTransition:function(){var e=Yk(!1),t=e[0];return e=Cj.bind(null,e[1]),Js().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var n=An,a=Js();if(kn){if(r===void 0)throw Error(Pt(407));r=r()}else{if(r=t(),ma===null)throw Error(Pt(349));vc&30||kM(n,t,r)}a.memoizedState=r;var i={value:r,getSnapshot:t};return a.queue=i,Jk(PM.bind(null,n,i,e),[e]),n.flags|=2048,sm(9,TM.bind(null,n,i,r,t),void 0,null),r},useId:function(){var e=Js(),t=ma.identifierPrefix;if(kn){var r=zo,n=Do;r=(n&~(1<<32-Ms(n)-1)).toString(32)+r,t=":"+t+"R"+r,r=am++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=Ej++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Ij={readContext:hs,useCallback:LM,useContext:hs,useEffect:gS,useImperativeHandle:RM,useInsertionEffect:MM,useLayoutEffect:DM,useMemo:BM,useReducer:Xb,useRef:NM,useState:function(){return Xb(im)},useDebugValue:vS,useDeferredValue:function(e){var t=fs();return jM(t,Jn.memoizedState,e)},useTransition:function(){var e=Xb(im)[0],t=fs().memoizedState;return[e,t]},useMutableSource:EM,useSyncExternalStore:CM,useId:OM,unstable_isNewReconciler:!1},Aj={readContext:hs,useCallback:LM,useContext:hs,useEffect:gS,useImperativeHandle:RM,useInsertionEffect:MM,useLayoutEffect:DM,useMemo:BM,useReducer:Kb,useRef:NM,useState:function(){return Kb(im)},useDebugValue:vS,useDeferredValue:function(e){var t=fs();return Jn===null?t.memoizedState=e:jM(t,Jn.memoizedState,e)},useTransition:function(){var e=Kb(im)[0],t=fs().memoizedState;return[e,t]},useMutableSource:EM,useSyncExternalStore:CM,useId:OM,unstable_isNewReconciler:!1};function Es(e,t){if(e&&e.defaultProps){t=Mn({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function N1(e,t,r,n){t=e.memoizedState,r=r(n,t),r=r==null?t:Mn({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var A0={isMounted:function(e){return(e=e._reactInternals)?Ic(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=ri(),a=Yl(e),i=Bo(n,a);i.payload=t,r!=null&&(i.callback=r),t=Xl(e,i,a),t!==null&&(Ds(t,e,a,n),ry(t,e,a))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=ri(),a=Yl(e),i=Bo(n,a);i.tag=1,i.payload=t,r!=null&&(i.callback=r),t=Xl(e,i,a),t!==null&&(Ds(t,e,a,n),ry(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=ri(),n=Yl(e),a=Bo(r,n);a.tag=2,t!=null&&(a.callback=t),t=Xl(e,a,n),t!==null&&(Ds(t,e,n,r),ry(t,e,n))}};function Qk(e,t,r,n,a,i,u){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,i,u):t.prototype&&t.prototype.isPureReactComponent?!Jp(r,n)||!Jp(a,i):!0}function UM(e,t,r){var n=!1,a=au,i=t.contextType;return typeof i=="object"&&i!==null?i=hs(i):(a=Ci(t)?mc:Ua.current,n=t.contextTypes,i=(n=n!=null)?wh(e,a):au),t=new t(r,i),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=A0,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=i),t}function eT(e,t,r,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&A0.enqueueReplaceState(t,t.state,null)}function M1(e,t,r,n){var a=e.stateNode;a.props=r,a.state=e.memoizedState,a.refs={},uS(e);var i=t.contextType;typeof i=="object"&&i!==null?a.context=hs(i):(i=Ci(t)?mc:Ua.current,a.context=wh(e,i)),a.state=e.memoizedState,i=t.getDerivedStateFromProps,typeof i=="function"&&(N1(e,t,i,r),a.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(t=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),t!==a.state&&A0.enqueueReplaceState(a,a.state,null),$y(e,r,a,n),a.state=e.memoizedState),typeof a.componentDidMount=="function"&&(e.flags|=4194308)}function kh(e,t){try{var r="",n=t;do r+=a5(n),n=n.return;while(n);var a=r}catch(i){a=`
Error generating stack: `+i.message+`
`+i.stack}return{value:e,source:t,stack:a,digest:null}}function Yb(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function D1(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var Nj=typeof WeakMap=="function"?WeakMap:Map;function qM(e,t,r){r=Bo(-1,r),r.tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){Gy||(Gy=!0,U1=n),D1(e,t)},r}function HM(e,t,r){r=Bo(-1,r),r.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var a=t.value;r.payload=function(){return n(a)},r.callback=function(){D1(e,t)}}var i=e.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(r.callback=function(){D1(e,t),typeof n!="function"&&(Kl===null?Kl=new Set([this]):Kl.add(this));var u=t.stack;this.componentDidCatch(t.value,{componentStack:u!==null?u:""})}),r}function tT(e,t,r){var n=e.pingCache;if(n===null){n=e.pingCache=new Nj;var a=new Set;n.set(t,a)}else a=n.get(t),a===void 0&&(a=new Set,n.set(t,a));a.has(r)||(a.add(r),e=Hj.bind(null,e,t,r),t.then(e,e))}function rT(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function nT(e,t,r,n,a){return e.mode&1?(e.flags|=65536,e.lanes=a,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=Bo(-1,1),t.tag=2,Xl(r,t,1))),r.lanes|=1),e)}var Mj=Wo.ReactCurrentOwner,_i=!1;function ti(e,t,r,n){t.child=e===null?bM(t,null,r,n):Eh(t,e.child,r,n)}function aT(e,t,r,n,a){r=r.render;var i=t.ref;return dh(t,a),n=pS(e,t,r,n,i,a),r=mS(),e!==null&&!_i?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Vo(e,t,a)):(kn&&r&&rS(t),t.flags|=1,ti(e,t,n,a),t.child)}function iT(e,t,r,n,a){if(e===null){var i=r.type;return typeof i=="function"&&!CS(i)&&i.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=i,GM(e,t,i,n,a)):(e=ly(r.type,null,n,t,t.mode,a),e.ref=t.ref,e.return=t,t.child=e)}if(i=e.child,!(e.lanes&a)){var u=i.memoizedProps;if(r=r.compare,r=r!==null?r:Jp,r(u,n)&&e.ref===t.ref)return Vo(e,t,a)}return t.flags|=1,e=Jl(i,n),e.ref=t.ref,e.return=t,t.child=e}function GM(e,t,r,n,a){if(e!==null){var i=e.memoizedProps;if(Jp(i,n)&&e.ref===t.ref)if(_i=!1,t.pendingProps=n=i,(e.lanes&a)!==0)e.flags&131072&&(_i=!0);else return t.lanes=e.lanes,Vo(e,t,a)}return z1(e,t,r,n,a)}function WM(e,t,r){var n=t.pendingProps,a=n.children,i=e!==null?e.memoizedState:null;if(n.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},fn(th,Bi),Bi|=r;else{if(!(r&1073741824))return e=i!==null?i.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,fn(th,Bi),Bi|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=i!==null?i.baseLanes:r,fn(th,Bi),Bi|=n}else i!==null?(n=i.baseLanes|r,t.memoizedState=null):n=r,fn(th,Bi),Bi|=n;return ti(e,t,a,r),t.child}function ZM(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function z1(e,t,r,n,a){var i=Ci(r)?mc:Ua.current;return i=wh(t,i),dh(t,a),r=pS(e,t,r,n,i,a),n=mS(),e!==null&&!_i?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Vo(e,t,a)):(kn&&n&&rS(t),t.flags|=1,ti(e,t,r,a),t.child)}function sT(e,t,r,n,a){if(Ci(r)){var i=!0;Ly(t)}else i=!1;if(dh(t,a),t.stateNode===null)iy(e,t),UM(t,r,n),M1(t,r,n,a),n=!0;else if(e===null){var u=t.stateNode,s=t.memoizedProps;u.props=s;var h=u.context,p=r.contextType;typeof p=="object"&&p!==null?p=hs(p):(p=Ci(r)?mc:Ua.current,p=wh(t,p));var g=r.getDerivedStateFromProps,v=typeof g=="function"||typeof u.getSnapshotBeforeUpdate=="function";v||typeof u.UNSAFE_componentWillReceiveProps!="function"&&typeof u.componentWillReceiveProps!="function"||(s!==n||h!==p)&&eT(t,u,n,p),Ml=!1;var x=t.memoizedState;u.state=x,$y(t,n,u,a),h=t.memoizedState,s!==n||x!==h||Ei.current||Ml?(typeof g=="function"&&(N1(t,r,g,n),h=t.memoizedState),(s=Ml||Qk(t,r,s,n,x,h,p))?(v||typeof u.UNSAFE_componentWillMount!="function"&&typeof u.componentWillMount!="function"||(typeof u.componentWillMount=="function"&&u.componentWillMount(),typeof u.UNSAFE_componentWillMount=="function"&&u.UNSAFE_componentWillMount()),typeof u.componentDidMount=="function"&&(t.flags|=4194308)):(typeof u.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=h),u.props=n,u.state=h,u.context=p,n=s):(typeof u.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{u=t.stateNode,wM(e,t),s=t.memoizedProps,p=t.type===t.elementType?s:Es(t.type,s),u.props=p,v=t.pendingProps,x=u.context,h=r.contextType,typeof h=="object"&&h!==null?h=hs(h):(h=Ci(r)?mc:Ua.current,h=wh(t,h));var S=r.getDerivedStateFromProps;(g=typeof S=="function"||typeof u.getSnapshotBeforeUpdate=="function")||typeof u.UNSAFE_componentWillReceiveProps!="function"&&typeof u.componentWillReceiveProps!="function"||(s!==v||x!==h)&&eT(t,u,n,h),Ml=!1,x=t.memoizedState,u.state=x,$y(t,n,u,a);var P=t.memoizedState;s!==v||x!==P||Ei.current||Ml?(typeof S=="function"&&(N1(t,r,S,n),P=t.memoizedState),(p=Ml||Qk(t,r,p,n,x,P,h)||!1)?(g||typeof u.UNSAFE_componentWillUpdate!="function"&&typeof u.componentWillUpdate!="function"||(typeof u.componentWillUpdate=="function"&&u.componentWillUpdate(n,P,h),typeof u.UNSAFE_componentWillUpdate=="function"&&u.UNSAFE_componentWillUpdate(n,P,h)),typeof u.componentDidUpdate=="function"&&(t.flags|=4),typeof u.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof u.componentDidUpdate!="function"||s===e.memoizedProps&&x===e.memoizedState||(t.flags|=4),typeof u.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&x===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=P),u.props=n,u.state=P,u.context=h,n=p):(typeof u.componentDidUpdate!="function"||s===e.memoizedProps&&x===e.memoizedState||(t.flags|=4),typeof u.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&x===e.memoizedState||(t.flags|=1024),n=!1)}return R1(e,t,r,n,i,a)}function R1(e,t,r,n,a,i){ZM(e,t);var u=(t.flags&128)!==0;if(!n&&!u)return a&&Hk(t,r,!1),Vo(e,t,i);n=t.stateNode,Mj.current=t;var s=u&&typeof r.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&u?(t.child=Eh(t,e.child,null,i),t.child=Eh(t,null,s,i)):ti(e,t,s,i),t.memoizedState=n.state,a&&Hk(t,r,!0),t.child}function XM(e){var t=e.stateNode;t.pendingContext?qk(e,t.pendingContext,t.pendingContext!==t.context):t.context&&qk(e,t.context,!1),cS(e,t.containerInfo)}function oT(e,t,r,n,a){return Sh(),aS(a),t.flags|=256,ti(e,t,r,n),t.child}var L1={dehydrated:null,treeContext:null,retryLane:0};function B1(e){return{baseLanes:e,cachePool:null,transitions:null}}function KM(e,t,r){var n=t.pendingProps,a=In.current,i=!1,u=(t.flags&128)!==0,s;if((s=u)||(s=e!==null&&e.memoizedState===null?!1:(a&2)!==0),s?(i=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(a|=1),fn(In,a&1),e===null)return I1(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(u=n.children,e=n.fallback,i?(n=t.mode,i=t.child,u={mode:"hidden",children:u},!(n&1)&&i!==null?(i.childLanes=0,i.pendingProps=u):i=D0(u,n,0,null),e=dc(e,n,r,null),i.return=t,e.return=t,i.sibling=e,t.child=i,t.child.memoizedState=B1(r),t.memoizedState=L1,e):yS(t,u));if(a=e.memoizedState,a!==null&&(s=a.dehydrated,s!==null))return Dj(e,t,u,n,s,a,r);if(i){i=n.fallback,u=t.mode,a=e.child,s=a.sibling;var h={mode:"hidden",children:n.children};return!(u&1)&&t.child!==a?(n=t.child,n.childLanes=0,n.pendingProps=h,t.deletions=null):(n=Jl(a,h),n.subtreeFlags=a.subtreeFlags&14680064),s!==null?i=Jl(s,i):(i=dc(i,u,r,null),i.flags|=2),i.return=t,n.return=t,n.sibling=i,t.child=n,n=i,i=t.child,u=e.child.memoizedState,u=u===null?B1(r):{baseLanes:u.baseLanes|r,cachePool:null,transitions:u.transitions},i.memoizedState=u,i.childLanes=e.childLanes&~r,t.memoizedState=L1,n}return i=e.child,e=i.sibling,n=Jl(i,{mode:"visible",children:n.children}),!(t.mode&1)&&(n.lanes=r),n.return=t,n.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n}function yS(e,t){return t=D0({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function vv(e,t,r,n){return n!==null&&aS(n),Eh(t,e.child,null,r),e=yS(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Dj(e,t,r,n,a,i,u){if(r)return t.flags&256?(t.flags&=-257,n=Yb(Error(Pt(422))),vv(e,t,u,n)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(i=n.fallback,a=t.mode,n=D0({mode:"visible",children:n.children},a,0,null),i=dc(i,a,u,null),i.flags|=2,n.return=t,i.return=t,n.sibling=i,t.child=n,t.mode&1&&Eh(t,e.child,null,u),t.child.memoizedState=B1(u),t.memoizedState=L1,i);if(!(t.mode&1))return vv(e,t,u,null);if(a.data==="$!"){if(n=a.nextSibling&&a.nextSibling.dataset,n)var s=n.dgst;return n=s,i=Error(Pt(419)),n=Yb(i,n,void 0),vv(e,t,u,n)}if(s=(u&e.childLanes)!==0,_i||s){if(n=ma,n!==null){switch(u&-u){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=a&(n.suspendedLanes|u)?0:a,a!==0&&a!==i.retryLane&&(i.retryLane=a,$o(e,a),Ds(n,e,a,-1))}return ES(),n=Yb(Error(Pt(421))),vv(e,t,u,n)}return a.data==="$?"?(t.flags|=128,t.child=e.child,t=Gj.bind(null,e),a._reactRetry=t,null):(e=i.treeContext,Oi=Zl(a.nextSibling),Fi=t,kn=!0,Ps=null,e!==null&&(rs[ns++]=Do,rs[ns++]=zo,rs[ns++]=gc,Do=e.id,zo=e.overflow,gc=t),t=yS(t,n.children),t.flags|=4096,t)}function lT(e,t,r){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),A1(e.return,t,r)}function Jb(e,t,r,n,a){var i=e.memoizedState;i===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:a}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=n,i.tail=r,i.tailMode=a)}function YM(e,t,r){var n=t.pendingProps,a=n.revealOrder,i=n.tail;if(ti(e,t,n.children,r),n=In.current,n&2)n=n&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&lT(e,r,t);else if(e.tag===19)lT(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(fn(In,n),!(t.mode&1))t.memoizedState=null;else switch(a){case"forwards":for(r=t.child,a=null;r!==null;)e=r.alternate,e!==null&&Vy(e)===null&&(a=r),r=r.sibling;r=a,r===null?(a=t.child,t.child=null):(a=r.sibling,r.sibling=null),Jb(t,!1,a,r,i);break;case"backwards":for(r=null,a=t.child,t.child=null;a!==null;){if(e=a.alternate,e!==null&&Vy(e)===null){t.child=a;break}e=a.sibling,a.sibling=r,r=a,a=e}Jb(t,!0,r,null,i);break;case"together":Jb(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function iy(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Vo(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),yc|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Pt(153));if(t.child!==null){for(e=t.child,r=Jl(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=Jl(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function zj(e,t,r){switch(t.tag){case 3:XM(t),Sh();break;case 5:SM(t);break;case 1:Ci(t.type)&&Ly(t);break;case 4:cS(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,a=t.memoizedProps.value;fn(Oy,n._currentValue),n._currentValue=a;break;case 13:if(n=t.memoizedState,n!==null)return n.dehydrated!==null?(fn(In,In.current&1),t.flags|=128,null):r&t.child.childLanes?KM(e,t,r):(fn(In,In.current&1),e=Vo(e,t,r),e!==null?e.sibling:null);fn(In,In.current&1);break;case 19:if(n=(r&t.childLanes)!==0,e.flags&128){if(n)return YM(e,t,r);t.flags|=128}if(a=t.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),fn(In,In.current),n)break;return null;case 22:case 23:return t.lanes=0,WM(e,t,r)}return Vo(e,t,r)}var JM,j1,QM,eD;JM=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};j1=function(){};QM=function(e,t,r,n){var a=e.memoizedProps;if(a!==n){e=t.stateNode,ic(no.current);var i=null;switch(r){case"input":a=s1(e,a),n=s1(e,n),i=[];break;case"select":a=Mn({},a,{value:void 0}),n=Mn({},n,{value:void 0}),i=[];break;case"textarea":a=u1(e,a),n=u1(e,n),i=[];break;default:typeof a.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=zy)}d1(r,n);var u;r=null;for(p in a)if(!n.hasOwnProperty(p)&&a.hasOwnProperty(p)&&a[p]!=null)if(p==="style"){var s=a[p];for(u in s)s.hasOwnProperty(u)&&(r||(r={}),r[u]="")}else p!=="dangerouslySetInnerHTML"&&p!=="children"&&p!=="suppressContentEditableWarning"&&p!=="suppressHydrationWarning"&&p!=="autoFocus"&&(Hp.hasOwnProperty(p)?i||(i=[]):(i=i||[]).push(p,null));for(p in n){var h=n[p];if(s=a!=null?a[p]:void 0,n.hasOwnProperty(p)&&h!==s&&(h!=null||s!=null))if(p==="style")if(s){for(u in s)!s.hasOwnProperty(u)||h&&h.hasOwnProperty(u)||(r||(r={}),r[u]="");for(u in h)h.hasOwnProperty(u)&&s[u]!==h[u]&&(r||(r={}),r[u]=h[u])}else r||(i||(i=[]),i.push(p,r)),r=h;else p==="dangerouslySetInnerHTML"?(h=h?h.__html:void 0,s=s?s.__html:void 0,h!=null&&s!==h&&(i=i||[]).push(p,h)):p==="children"?typeof h!="string"&&typeof h!="number"||(i=i||[]).push(p,""+h):p!=="suppressContentEditableWarning"&&p!=="suppressHydrationWarning"&&(Hp.hasOwnProperty(p)?(h!=null&&p==="onScroll"&&xn("scroll",e),i||s===h||(i=[])):(i=i||[]).push(p,h))}r&&(i=i||[]).push("style",r);var p=i;(t.updateQueue=p)&&(t.flags|=4)}};eD=function(e,t,r,n){r!==n&&(t.flags|=4)};function ap(e,t){if(!kn)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function $a(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,n=0;if(t)for(var a=e.child;a!==null;)r|=a.lanes|a.childLanes,n|=a.subtreeFlags&14680064,n|=a.flags&14680064,a.return=e,a=a.sibling;else for(a=e.child;a!==null;)r|=a.lanes|a.childLanes,n|=a.subtreeFlags,n|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=n,e.childLanes=r,t}function Rj(e,t,r){var n=t.pendingProps;switch(nS(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return $a(t),null;case 1:return Ci(t.type)&&Ry(),$a(t),null;case 3:return n=t.stateNode,Ch(),bn(Ei),bn(Ua),hS(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(mv(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Ps!==null&&(G1(Ps),Ps=null))),j1(e,t),$a(t),null;case 5:dS(t);var a=ic(nm.current);if(r=t.type,e!==null&&t.stateNode!=null)QM(e,t,r,n,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(t.stateNode===null)throw Error(Pt(166));return $a(t),null}if(e=ic(no.current),mv(t)){n=t.stateNode,r=t.type;var i=t.memoizedProps;switch(n[Qs]=t,n[tm]=i,e=(t.mode&1)!==0,r){case"dialog":xn("cancel",n),xn("close",n);break;case"iframe":case"object":case"embed":xn("load",n);break;case"video":case"audio":for(a=0;a<Ep.length;a++)xn(Ep[a],n);break;case"source":xn("error",n);break;case"img":case"image":case"link":xn("error",n),xn("load",n);break;case"details":xn("toggle",n);break;case"input":vk(n,i),xn("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!i.multiple},xn("invalid",n);break;case"textarea":xk(n,i),xn("invalid",n)}d1(r,i),a=null;for(var u in i)if(i.hasOwnProperty(u)){var s=i[u];u==="children"?typeof s=="string"?n.textContent!==s&&(i.suppressHydrationWarning!==!0&&pv(n.textContent,s,e),a=["children",s]):typeof s=="number"&&n.textContent!==""+s&&(i.suppressHydrationWarning!==!0&&pv(n.textContent,s,e),a=["children",""+s]):Hp.hasOwnProperty(u)&&s!=null&&u==="onScroll"&&xn("scroll",n)}switch(r){case"input":sv(n),yk(n,i,!0);break;case"textarea":sv(n),bk(n);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(n.onclick=zy)}n=a,t.updateQueue=n,n!==null&&(t.flags|=4)}else{u=a.nodeType===9?a:a.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=PN(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=u.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=u.createElement(r,{is:n.is}):(e=u.createElement(r),r==="select"&&(u=e,n.multiple?u.multiple=!0:n.size&&(u.size=n.size))):e=u.createElementNS(e,r),e[Qs]=t,e[tm]=n,JM(e,t,!1,!1),t.stateNode=e;e:{switch(u=h1(r,n),r){case"dialog":xn("cancel",e),xn("close",e),a=n;break;case"iframe":case"object":case"embed":xn("load",e),a=n;break;case"video":case"audio":for(a=0;a<Ep.length;a++)xn(Ep[a],e);a=n;break;case"source":xn("error",e),a=n;break;case"img":case"image":case"link":xn("error",e),xn("load",e),a=n;break;case"details":xn("toggle",e),a=n;break;case"input":vk(e,n),a=s1(e,n),xn("invalid",e);break;case"option":a=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},a=Mn({},n,{value:void 0}),xn("invalid",e);break;case"textarea":xk(e,n),a=u1(e,n),xn("invalid",e);break;default:a=n}d1(r,a),s=a;for(i in s)if(s.hasOwnProperty(i)){var h=s[i];i==="style"?NN(e,h):i==="dangerouslySetInnerHTML"?(h=h?h.__html:void 0,h!=null&&IN(e,h)):i==="children"?typeof h=="string"?(r!=="textarea"||h!=="")&&Gp(e,h):typeof h=="number"&&Gp(e,""+h):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Hp.hasOwnProperty(i)?h!=null&&i==="onScroll"&&xn("scroll",e):h!=null&&V2(e,i,h,u))}switch(r){case"input":sv(e),yk(e,n,!1);break;case"textarea":sv(e),bk(e);break;case"option":n.value!=null&&e.setAttribute("value",""+nu(n.value));break;case"select":e.multiple=!!n.multiple,i=n.value,i!=null?oh(e,!!n.multiple,i,!1):n.defaultValue!=null&&oh(e,!!n.multiple,n.defaultValue,!0);break;default:typeof a.onClick=="function"&&(e.onclick=zy)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return $a(t),null;case 6:if(e&&t.stateNode!=null)eD(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(Pt(166));if(r=ic(nm.current),ic(no.current),mv(t)){if(n=t.stateNode,r=t.memoizedProps,n[Qs]=t,(i=n.nodeValue!==r)&&(e=Fi,e!==null))switch(e.tag){case 3:pv(n.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&pv(n.nodeValue,r,(e.mode&1)!==0)}i&&(t.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[Qs]=t,t.stateNode=n}return $a(t),null;case 13:if(bn(In),n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(kn&&Oi!==null&&t.mode&1&&!(t.flags&128))yM(),Sh(),t.flags|=98560,i=!1;else if(i=mv(t),n!==null&&n.dehydrated!==null){if(e===null){if(!i)throw Error(Pt(318));if(i=t.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Pt(317));i[Qs]=t}else Sh(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;$a(t),i=!1}else Ps!==null&&(G1(Ps),Ps=null),i=!0;if(!i)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(n=n!==null,n!==(e!==null&&e.memoizedState!==null)&&n&&(t.child.flags|=8192,t.mode&1&&(e===null||In.current&1?Qn===0&&(Qn=3):ES())),t.updateQueue!==null&&(t.flags|=4),$a(t),null);case 4:return Ch(),j1(e,t),e===null&&Qp(t.stateNode.containerInfo),$a(t),null;case 10:return oS(t.type._context),$a(t),null;case 17:return Ci(t.type)&&Ry(),$a(t),null;case 19:if(bn(In),i=t.memoizedState,i===null)return $a(t),null;if(n=(t.flags&128)!==0,u=i.rendering,u===null)if(n)ap(i,!1);else{if(Qn!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(u=Vy(e),u!==null){for(t.flags|=128,ap(i,!1),n=u.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=r,r=t.child;r!==null;)i=r,e=n,i.flags&=14680066,u=i.alternate,u===null?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=u.childLanes,i.lanes=u.lanes,i.child=u.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=u.memoizedProps,i.memoizedState=u.memoizedState,i.updateQueue=u.updateQueue,i.type=u.type,e=u.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return fn(In,In.current&1|2),t.child}e=e.sibling}i.tail!==null&&jn()>Th&&(t.flags|=128,n=!0,ap(i,!1),t.lanes=4194304)}else{if(!n)if(e=Vy(u),e!==null){if(t.flags|=128,n=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),ap(i,!0),i.tail===null&&i.tailMode==="hidden"&&!u.alternate&&!kn)return $a(t),null}else 2*jn()-i.renderingStartTime>Th&&r!==1073741824&&(t.flags|=128,n=!0,ap(i,!1),t.lanes=4194304);i.isBackwards?(u.sibling=t.child,t.child=u):(r=i.last,r!==null?r.sibling=u:t.child=u,i.last=u)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=jn(),t.sibling=null,r=In.current,fn(In,n?r&1|2:r&1),t):($a(t),null);case 22:case 23:return SS(),n=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==n&&(t.flags|=8192),n&&t.mode&1?Bi&1073741824&&($a(t),t.subtreeFlags&6&&(t.flags|=8192)):$a(t),null;case 24:return null;case 25:return null}throw Error(Pt(156,t.tag))}function Lj(e,t){switch(nS(t),t.tag){case 1:return Ci(t.type)&&Ry(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Ch(),bn(Ei),bn(Ua),hS(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return dS(t),null;case 13:if(bn(In),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Pt(340));Sh()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return bn(In),null;case 4:return Ch(),null;case 10:return oS(t.type._context),null;case 22:case 23:return SS(),null;case 24:return null;default:return null}}var yv=!1,Va=!1,Bj=typeof WeakSet=="function"?WeakSet:Set,rr=null;function eh(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){zn(e,t,n)}else r.current=null}function O1(e,t,r){try{r()}catch(n){zn(e,t,n)}}var uT=!1;function jj(e,t){if(w1=Ny,e=iM(),tS(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var a=n.anchorOffset,i=n.focusNode;n=n.focusOffset;try{r.nodeType,i.nodeType}catch{r=null;break e}var u=0,s=-1,h=-1,p=0,g=0,v=e,x=null;t:for(;;){for(var S;v!==r||a!==0&&v.nodeType!==3||(s=u+a),v!==i||n!==0&&v.nodeType!==3||(h=u+n),v.nodeType===3&&(u+=v.nodeValue.length),(S=v.firstChild)!==null;)x=v,v=S;for(;;){if(v===e)break t;if(x===r&&++p===a&&(s=u),x===i&&++g===n&&(h=u),(S=v.nextSibling)!==null)break;v=x,x=v.parentNode}v=S}r=s===-1||h===-1?null:{start:s,end:h}}else r=null}r=r||{start:0,end:0}}else r=null;for(S1={focusedElem:e,selectionRange:r},Ny=!1,rr=t;rr!==null;)if(t=rr,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,rr=e;else for(;rr!==null;){t=rr;try{var P=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(P!==null){var N=P.memoizedProps,M=P.memoizedState,I=t.stateNode,A=I.getSnapshotBeforeUpdate(t.elementType===t.type?N:Es(t.type,N),M);I.__reactInternalSnapshotBeforeUpdate=A}break;case 3:var D=t.stateNode.containerInfo;D.nodeType===1?D.textContent="":D.nodeType===9&&D.documentElement&&D.removeChild(D.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Pt(163))}}catch(j){zn(t,t.return,j)}if(e=t.sibling,e!==null){e.return=t.return,rr=e;break}rr=t.return}return P=uT,uT=!1,P}function jp(e,t,r){var n=t.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var a=n=n.next;do{if((a.tag&e)===e){var i=a.destroy;a.destroy=void 0,i!==void 0&&O1(t,r,i)}a=a.next}while(a!==n)}}function N0(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function F1(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function tD(e){var t=e.alternate;t!==null&&(e.alternate=null,tD(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Qs],delete t[tm],delete t[k1],delete t[bj],delete t[_j])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function rD(e){return e.tag===5||e.tag===3||e.tag===4}function cT(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||rD(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function $1(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=zy));else if(n!==4&&(e=e.child,e!==null))for($1(e,t,r),e=e.sibling;e!==null;)$1(e,t,r),e=e.sibling}function V1(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(V1(e,t,r),e=e.sibling;e!==null;)V1(e,t,r),e=e.sibling}var Sa=null,Cs=!1;function Tl(e,t,r){for(r=r.child;r!==null;)nD(e,t,r),r=r.sibling}function nD(e,t,r){if(ro&&typeof ro.onCommitFiberUnmount=="function")try{ro.onCommitFiberUnmount(S0,r)}catch{}switch(r.tag){case 5:Va||eh(r,t);case 6:var n=Sa,a=Cs;Sa=null,Tl(e,t,r),Sa=n,Cs=a,Sa!==null&&(Cs?(e=Sa,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):Sa.removeChild(r.stateNode));break;case 18:Sa!==null&&(Cs?(e=Sa,r=r.stateNode,e.nodeType===8?Hb(e.parentNode,r):e.nodeType===1&&Hb(e,r),Kp(e)):Hb(Sa,r.stateNode));break;case 4:n=Sa,a=Cs,Sa=r.stateNode.containerInfo,Cs=!0,Tl(e,t,r),Sa=n,Cs=a;break;case 0:case 11:case 14:case 15:if(!Va&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){a=n=n.next;do{var i=a,u=i.destroy;i=i.tag,u!==void 0&&(i&2||i&4)&&O1(r,t,u),a=a.next}while(a!==n)}Tl(e,t,r);break;case 1:if(!Va&&(eh(r,t),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(s){zn(r,t,s)}Tl(e,t,r);break;case 21:Tl(e,t,r);break;case 22:r.mode&1?(Va=(n=Va)||r.memoizedState!==null,Tl(e,t,r),Va=n):Tl(e,t,r);break;default:Tl(e,t,r)}}function dT(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new Bj),t.forEach(function(n){var a=Wj.bind(null,e,n);r.has(n)||(r.add(n),n.then(a,a))})}}function bs(e,t){var r=t.deletions;if(r!==null)for(var n=0;n<r.length;n++){var a=r[n];try{var i=e,u=t,s=u;e:for(;s!==null;){switch(s.tag){case 5:Sa=s.stateNode,Cs=!1;break e;case 3:Sa=s.stateNode.containerInfo,Cs=!0;break e;case 4:Sa=s.stateNode.containerInfo,Cs=!0;break e}s=s.return}if(Sa===null)throw Error(Pt(160));nD(i,u,a),Sa=null,Cs=!1;var h=a.alternate;h!==null&&(h.return=null),a.return=null}catch(p){zn(a,t,p)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)aD(t,e),t=t.sibling}function aD(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(bs(t,e),Ws(e),n&4){try{jp(3,e,e.return),N0(3,e)}catch(N){zn(e,e.return,N)}try{jp(5,e,e.return)}catch(N){zn(e,e.return,N)}}break;case 1:bs(t,e),Ws(e),n&512&&r!==null&&eh(r,r.return);break;case 5:if(bs(t,e),Ws(e),n&512&&r!==null&&eh(r,r.return),e.flags&32){var a=e.stateNode;try{Gp(a,"")}catch(N){zn(e,e.return,N)}}if(n&4&&(a=e.stateNode,a!=null)){var i=e.memoizedProps,u=r!==null?r.memoizedProps:i,s=e.type,h=e.updateQueue;if(e.updateQueue=null,h!==null)try{s==="input"&&i.type==="radio"&&i.name!=null&&kN(a,i),h1(s,u);var p=h1(s,i);for(u=0;u<h.length;u+=2){var g=h[u],v=h[u+1];g==="style"?NN(a,v):g==="dangerouslySetInnerHTML"?IN(a,v):g==="children"?Gp(a,v):V2(a,g,v,p)}switch(s){case"input":o1(a,i);break;case"textarea":TN(a,i);break;case"select":var x=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!i.multiple;var S=i.value;S!=null?oh(a,!!i.multiple,S,!1):x!==!!i.multiple&&(i.defaultValue!=null?oh(a,!!i.multiple,i.defaultValue,!0):oh(a,!!i.multiple,i.multiple?[]:"",!1))}a[tm]=i}catch(N){zn(e,e.return,N)}}break;case 6:if(bs(t,e),Ws(e),n&4){if(e.stateNode===null)throw Error(Pt(162));a=e.stateNode,i=e.memoizedProps;try{a.nodeValue=i}catch(N){zn(e,e.return,N)}}break;case 3:if(bs(t,e),Ws(e),n&4&&r!==null&&r.memoizedState.isDehydrated)try{Kp(t.containerInfo)}catch(N){zn(e,e.return,N)}break;case 4:bs(t,e),Ws(e);break;case 13:bs(t,e),Ws(e),a=e.child,a.flags&8192&&(i=a.memoizedState!==null,a.stateNode.isHidden=i,!i||a.alternate!==null&&a.alternate.memoizedState!==null||(_S=jn())),n&4&&dT(e);break;case 22:if(g=r!==null&&r.memoizedState!==null,e.mode&1?(Va=(p=Va)||g,bs(t,e),Va=p):bs(t,e),Ws(e),n&8192){if(p=e.memoizedState!==null,(e.stateNode.isHidden=p)&&!g&&e.mode&1)for(rr=e,g=e.child;g!==null;){for(v=rr=g;rr!==null;){switch(x=rr,S=x.child,x.tag){case 0:case 11:case 14:case 15:jp(4,x,x.return);break;case 1:eh(x,x.return);var P=x.stateNode;if(typeof P.componentWillUnmount=="function"){n=x,r=x.return;try{t=n,P.props=t.memoizedProps,P.state=t.memoizedState,P.componentWillUnmount()}catch(N){zn(n,r,N)}}break;case 5:eh(x,x.return);break;case 22:if(x.memoizedState!==null){fT(v);continue}}S!==null?(S.return=x,rr=S):fT(v)}g=g.sibling}e:for(g=null,v=e;;){if(v.tag===5){if(g===null){g=v;try{a=v.stateNode,p?(i=a.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(s=v.stateNode,h=v.memoizedProps.style,u=h!=null&&h.hasOwnProperty("display")?h.display:null,s.style.display=AN("display",u))}catch(N){zn(e,e.return,N)}}}else if(v.tag===6){if(g===null)try{v.stateNode.nodeValue=p?"":v.memoizedProps}catch(N){zn(e,e.return,N)}}else if((v.tag!==22&&v.tag!==23||v.memoizedState===null||v===e)&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===e)break e;for(;v.sibling===null;){if(v.return===null||v.return===e)break e;g===v&&(g=null),v=v.return}g===v&&(g=null),v.sibling.return=v.return,v=v.sibling}}break;case 19:bs(t,e),Ws(e),n&4&&dT(e);break;case 21:break;default:bs(t,e),Ws(e)}}function Ws(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(rD(r)){var n=r;break e}r=r.return}throw Error(Pt(160))}switch(n.tag){case 5:var a=n.stateNode;n.flags&32&&(Gp(a,""),n.flags&=-33);var i=cT(e);V1(e,i,a);break;case 3:case 4:var u=n.stateNode.containerInfo,s=cT(e);$1(e,s,u);break;default:throw Error(Pt(161))}}catch(h){zn(e,e.return,h)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Oj(e,t,r){rr=e,iD(e)}function iD(e,t,r){for(var n=(e.mode&1)!==0;rr!==null;){var a=rr,i=a.child;if(a.tag===22&&n){var u=a.memoizedState!==null||yv;if(!u){var s=a.alternate,h=s!==null&&s.memoizedState!==null||Va;s=yv;var p=Va;if(yv=u,(Va=h)&&!p)for(rr=a;rr!==null;)u=rr,h=u.child,u.tag===22&&u.memoizedState!==null?pT(a):h!==null?(h.return=u,rr=h):pT(a);for(;i!==null;)rr=i,iD(i),i=i.sibling;rr=a,yv=s,Va=p}hT(e)}else a.subtreeFlags&8772&&i!==null?(i.return=a,rr=i):hT(e)}}function hT(e){for(;rr!==null;){var t=rr;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Va||N0(5,t);break;case 1:var n=t.stateNode;if(t.flags&4&&!Va)if(r===null)n.componentDidMount();else{var a=t.elementType===t.type?r.memoizedProps:Es(t.type,r.memoizedProps);n.componentDidUpdate(a,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;i!==null&&Kk(t,i,n);break;case 3:var u=t.updateQueue;if(u!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}Kk(t,u,r)}break;case 5:var s=t.stateNode;if(r===null&&t.flags&4){r=s;var h=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":h.autoFocus&&r.focus();break;case"img":h.src&&(r.src=h.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var p=t.alternate;if(p!==null){var g=p.memoizedState;if(g!==null){var v=g.dehydrated;v!==null&&Kp(v)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Pt(163))}Va||t.flags&512&&F1(t)}catch(x){zn(t,t.return,x)}}if(t===e){rr=null;break}if(r=t.sibling,r!==null){r.return=t.return,rr=r;break}rr=t.return}}function fT(e){for(;rr!==null;){var t=rr;if(t===e){rr=null;break}var r=t.sibling;if(r!==null){r.return=t.return,rr=r;break}rr=t.return}}function pT(e){for(;rr!==null;){var t=rr;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{N0(4,t)}catch(h){zn(t,r,h)}break;case 1:var n=t.stateNode;if(typeof n.componentDidMount=="function"){var a=t.return;try{n.componentDidMount()}catch(h){zn(t,a,h)}}var i=t.return;try{F1(t)}catch(h){zn(t,i,h)}break;case 5:var u=t.return;try{F1(t)}catch(h){zn(t,u,h)}}}catch(h){zn(t,t.return,h)}if(t===e){rr=null;break}var s=t.sibling;if(s!==null){s.return=t.return,rr=s;break}rr=t.return}}var Fj=Math.ceil,Hy=Wo.ReactCurrentDispatcher,xS=Wo.ReactCurrentOwner,ds=Wo.ReactCurrentBatchConfig,Vr=0,ma=null,Gn=null,Ea=0,Bi=0,th=hu(0),Qn=0,om=null,yc=0,M0=0,bS=0,Op=null,vi=null,_S=0,Th=1/0,Ao=null,Gy=!1,U1=null,Kl=null,xv=!1,Fl=null,Wy=0,Fp=0,q1=null,sy=-1,oy=0;function ri(){return Vr&6?jn():sy!==-1?sy:sy=jn()}function Yl(e){return e.mode&1?Vr&2&&Ea!==0?Ea&-Ea:Sj.transition!==null?(oy===0&&(oy=UN()),oy):(e=rn,e!==0||(e=window.event,e=e===void 0?16:KN(e.type)),e):1}function Ds(e,t,r,n){if(50<Fp)throw Fp=0,q1=null,Error(Pt(185));zm(e,r,n),(!(Vr&2)||e!==ma)&&(e===ma&&(!(Vr&2)&&(M0|=r),Qn===4&&Bl(e,Ea)),ki(e,n),r===1&&Vr===0&&!(t.mode&1)&&(Th=jn()+500,P0&&fu()))}function ki(e,t){var r=e.callbackNode;S5(e,t);var n=Ay(e,e===ma?Ea:0);if(n===0)r!==null&&Sk(r),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(r!=null&&Sk(r),t===1)e.tag===0?wj(mT.bind(null,e)):mM(mT.bind(null,e)),yj(function(){!(Vr&6)&&fu()}),r=null;else{switch(qN(n)){case 1:r=W2;break;case 4:r=$N;break;case 16:r=Iy;break;case 536870912:r=VN;break;default:r=Iy}r=fD(r,sD.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function sD(e,t){if(sy=-1,oy=0,Vr&6)throw Error(Pt(327));var r=e.callbackNode;if(hh()&&e.callbackNode!==r)return null;var n=Ay(e,e===ma?Ea:0);if(n===0)return null;if(n&30||n&e.expiredLanes||t)t=Zy(e,n);else{t=n;var a=Vr;Vr|=2;var i=lD();(ma!==e||Ea!==t)&&(Ao=null,Th=jn()+500,cc(e,t));do try{Uj();break}catch(s){oD(e,s)}while(!0);sS(),Hy.current=i,Vr=a,Gn!==null?t=0:(ma=null,Ea=0,t=Qn)}if(t!==0){if(t===2&&(a=v1(e),a!==0&&(n=a,t=H1(e,a))),t===1)throw r=om,cc(e,0),Bl(e,n),ki(e,jn()),r;if(t===6)Bl(e,n);else{if(a=e.current.alternate,!(n&30)&&!$j(a)&&(t=Zy(e,n),t===2&&(i=v1(e),i!==0&&(n=i,t=H1(e,i))),t===1))throw r=om,cc(e,0),Bl(e,n),ki(e,jn()),r;switch(e.finishedWork=a,e.finishedLanes=n,t){case 0:case 1:throw Error(Pt(345));case 2:Ku(e,vi,Ao);break;case 3:if(Bl(e,n),(n&130023424)===n&&(t=_S+500-jn(),10<t)){if(Ay(e,0)!==0)break;if(a=e.suspendedLanes,(a&n)!==n){ri(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=C1(Ku.bind(null,e,vi,Ao),t);break}Ku(e,vi,Ao);break;case 4:if(Bl(e,n),(n&4194240)===n)break;for(t=e.eventTimes,a=-1;0<n;){var u=31-Ms(n);i=1<<u,u=t[u],u>a&&(a=u),n&=~i}if(n=a,n=jn()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*Fj(n/1960))-n,10<n){e.timeoutHandle=C1(Ku.bind(null,e,vi,Ao),n);break}Ku(e,vi,Ao);break;case 5:Ku(e,vi,Ao);break;default:throw Error(Pt(329))}}}return ki(e,jn()),e.callbackNode===r?sD.bind(null,e):null}function H1(e,t){var r=Op;return e.current.memoizedState.isDehydrated&&(cc(e,t).flags|=256),e=Zy(e,t),e!==2&&(t=vi,vi=r,t!==null&&G1(t)),e}function G1(e){vi===null?vi=e:vi.push.apply(vi,e)}function $j(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var a=r[n],i=a.getSnapshot;a=a.value;try{if(!Ls(i(),a))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Bl(e,t){for(t&=~bS,t&=~M0,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-Ms(t),n=1<<r;e[r]=-1,t&=~n}}function mT(e){if(Vr&6)throw Error(Pt(327));hh();var t=Ay(e,0);if(!(t&1))return ki(e,jn()),null;var r=Zy(e,t);if(e.tag!==0&&r===2){var n=v1(e);n!==0&&(t=n,r=H1(e,n))}if(r===1)throw r=om,cc(e,0),Bl(e,t),ki(e,jn()),r;if(r===6)throw Error(Pt(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Ku(e,vi,Ao),ki(e,jn()),null}function wS(e,t){var r=Vr;Vr|=1;try{return e(t)}finally{Vr=r,Vr===0&&(Th=jn()+500,P0&&fu())}}function xc(e){Fl!==null&&Fl.tag===0&&!(Vr&6)&&hh();var t=Vr;Vr|=1;var r=ds.transition,n=rn;try{if(ds.transition=null,rn=1,e)return e()}finally{rn=n,ds.transition=r,Vr=t,!(Vr&6)&&fu()}}function SS(){Bi=th.current,bn(th)}function cc(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,vj(r)),Gn!==null)for(r=Gn.return;r!==null;){var n=r;switch(nS(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&Ry();break;case 3:Ch(),bn(Ei),bn(Ua),hS();break;case 5:dS(n);break;case 4:Ch();break;case 13:bn(In);break;case 19:bn(In);break;case 10:oS(n.type._context);break;case 22:case 23:SS()}r=r.return}if(ma=e,Gn=e=Jl(e.current,null),Ea=Bi=t,Qn=0,om=null,bS=M0=yc=0,vi=Op=null,ac!==null){for(t=0;t<ac.length;t++)if(r=ac[t],n=r.interleaved,n!==null){r.interleaved=null;var a=n.next,i=r.pending;if(i!==null){var u=i.next;i.next=a,n.next=u}r.pending=n}ac=null}return e}function oD(e,t){do{var r=Gn;try{if(sS(),ny.current=qy,Uy){for(var n=An.memoizedState;n!==null;){var a=n.queue;a!==null&&(a.pending=null),n=n.next}Uy=!1}if(vc=0,pa=Jn=An=null,Bp=!1,am=0,xS.current=null,r===null||r.return===null){Qn=1,om=t,Gn=null;break}e:{var i=e,u=r.return,s=r,h=t;if(t=Ea,s.flags|=32768,h!==null&&typeof h=="object"&&typeof h.then=="function"){var p=h,g=s,v=g.tag;if(!(g.mode&1)&&(v===0||v===11||v===15)){var x=g.alternate;x?(g.updateQueue=x.updateQueue,g.memoizedState=x.memoizedState,g.lanes=x.lanes):(g.updateQueue=null,g.memoizedState=null)}var S=rT(u);if(S!==null){S.flags&=-257,nT(S,u,s,i,t),S.mode&1&&tT(i,p,t),t=S,h=p;var P=t.updateQueue;if(P===null){var N=new Set;N.add(h),t.updateQueue=N}else P.add(h);break e}else{if(!(t&1)){tT(i,p,t),ES();break e}h=Error(Pt(426))}}else if(kn&&s.mode&1){var M=rT(u);if(M!==null){!(M.flags&65536)&&(M.flags|=256),nT(M,u,s,i,t),aS(kh(h,s));break e}}i=h=kh(h,s),Qn!==4&&(Qn=2),Op===null?Op=[i]:Op.push(i),i=u;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t;var I=qM(i,h,t);Xk(i,I);break e;case 1:s=h;var A=i.type,D=i.stateNode;if(!(i.flags&128)&&(typeof A.getDerivedStateFromError=="function"||D!==null&&typeof D.componentDidCatch=="function"&&(Kl===null||!Kl.has(D)))){i.flags|=65536,t&=-t,i.lanes|=t;var j=HM(i,s,t);Xk(i,j);break e}}i=i.return}while(i!==null)}cD(r)}catch(V){t=V,Gn===r&&r!==null&&(Gn=r=r.return);continue}break}while(!0)}function lD(){var e=Hy.current;return Hy.current=qy,e===null?qy:e}function ES(){(Qn===0||Qn===3||Qn===2)&&(Qn=4),ma===null||!(yc&268435455)&&!(M0&268435455)||Bl(ma,Ea)}function Zy(e,t){var r=Vr;Vr|=2;var n=lD();(ma!==e||Ea!==t)&&(Ao=null,cc(e,t));do try{Vj();break}catch(a){oD(e,a)}while(!0);if(sS(),Vr=r,Hy.current=n,Gn!==null)throw Error(Pt(261));return ma=null,Ea=0,Qn}function Vj(){for(;Gn!==null;)uD(Gn)}function Uj(){for(;Gn!==null&&!p5();)uD(Gn)}function uD(e){var t=hD(e.alternate,e,Bi);e.memoizedProps=e.pendingProps,t===null?cD(e):Gn=t,xS.current=null}function cD(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=Lj(r,t),r!==null){r.flags&=32767,Gn=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Qn=6,Gn=null;return}}else if(r=Rj(r,t,Bi),r!==null){Gn=r;return}if(t=t.sibling,t!==null){Gn=t;return}Gn=t=e}while(t!==null);Qn===0&&(Qn=5)}function Ku(e,t,r){var n=rn,a=ds.transition;try{ds.transition=null,rn=1,qj(e,t,r,n)}finally{ds.transition=a,rn=n}return null}function qj(e,t,r,n){do hh();while(Fl!==null);if(Vr&6)throw Error(Pt(327));r=e.finishedWork;var a=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(Pt(177));e.callbackNode=null,e.callbackPriority=0;var i=r.lanes|r.childLanes;if(E5(e,i),e===ma&&(Gn=ma=null,Ea=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||xv||(xv=!0,fD(Iy,function(){return hh(),null})),i=(r.flags&15990)!==0,r.subtreeFlags&15990||i){i=ds.transition,ds.transition=null;var u=rn;rn=1;var s=Vr;Vr|=4,xS.current=null,jj(e,r),aD(r,e),cj(S1),Ny=!!w1,S1=w1=null,e.current=r,Oj(r),m5(),Vr=s,rn=u,ds.transition=i}else e.current=r;if(xv&&(xv=!1,Fl=e,Wy=a),i=e.pendingLanes,i===0&&(Kl=null),y5(r.stateNode),ki(e,jn()),t!==null)for(n=e.onRecoverableError,r=0;r<t.length;r++)a=t[r],n(a.value,{componentStack:a.stack,digest:a.digest});if(Gy)throw Gy=!1,e=U1,U1=null,e;return Wy&1&&e.tag!==0&&hh(),i=e.pendingLanes,i&1?e===q1?Fp++:(Fp=0,q1=e):Fp=0,fu(),null}function hh(){if(Fl!==null){var e=qN(Wy),t=ds.transition,r=rn;try{if(ds.transition=null,rn=16>e?16:e,Fl===null)var n=!1;else{if(e=Fl,Fl=null,Wy=0,Vr&6)throw Error(Pt(331));var a=Vr;for(Vr|=4,rr=e.current;rr!==null;){var i=rr,u=i.child;if(rr.flags&16){var s=i.deletions;if(s!==null){for(var h=0;h<s.length;h++){var p=s[h];for(rr=p;rr!==null;){var g=rr;switch(g.tag){case 0:case 11:case 15:jp(8,g,i)}var v=g.child;if(v!==null)v.return=g,rr=v;else for(;rr!==null;){g=rr;var x=g.sibling,S=g.return;if(tD(g),g===p){rr=null;break}if(x!==null){x.return=S,rr=x;break}rr=S}}}var P=i.alternate;if(P!==null){var N=P.child;if(N!==null){P.child=null;do{var M=N.sibling;N.sibling=null,N=M}while(N!==null)}}rr=i}}if(i.subtreeFlags&2064&&u!==null)u.return=i,rr=u;else e:for(;rr!==null;){if(i=rr,i.flags&2048)switch(i.tag){case 0:case 11:case 15:jp(9,i,i.return)}var I=i.sibling;if(I!==null){I.return=i.return,rr=I;break e}rr=i.return}}var A=e.current;for(rr=A;rr!==null;){u=rr;var D=u.child;if(u.subtreeFlags&2064&&D!==null)D.return=u,rr=D;else e:for(u=A;rr!==null;){if(s=rr,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:N0(9,s)}}catch(V){zn(s,s.return,V)}if(s===u){rr=null;break e}var j=s.sibling;if(j!==null){j.return=s.return,rr=j;break e}rr=s.return}}if(Vr=a,fu(),ro&&typeof ro.onPostCommitFiberRoot=="function")try{ro.onPostCommitFiberRoot(S0,e)}catch{}n=!0}return n}finally{rn=r,ds.transition=t}}return!1}function gT(e,t,r){t=kh(r,t),t=qM(e,t,1),e=Xl(e,t,1),t=ri(),e!==null&&(zm(e,1,t),ki(e,t))}function zn(e,t,r){if(e.tag===3)gT(e,e,r);else for(;t!==null;){if(t.tag===3){gT(t,e,r);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Kl===null||!Kl.has(n))){e=kh(r,e),e=HM(t,e,1),t=Xl(t,e,1),e=ri(),t!==null&&(zm(t,1,e),ki(t,e));break}}t=t.return}}function Hj(e,t,r){var n=e.pingCache;n!==null&&n.delete(t),t=ri(),e.pingedLanes|=e.suspendedLanes&r,ma===e&&(Ea&r)===r&&(Qn===4||Qn===3&&(Ea&130023424)===Ea&&500>jn()-_S?cc(e,0):bS|=r),ki(e,t)}function dD(e,t){t===0&&(e.mode&1?(t=uv,uv<<=1,!(uv&130023424)&&(uv=4194304)):t=1);var r=ri();e=$o(e,t),e!==null&&(zm(e,t,r),ki(e,r))}function Gj(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),dD(e,r)}function Wj(e,t){var r=0;switch(e.tag){case 13:var n=e.stateNode,a=e.memoizedState;a!==null&&(r=a.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(Pt(314))}n!==null&&n.delete(t),dD(e,r)}var hD;hD=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||Ei.current)_i=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return _i=!1,zj(e,t,r);_i=!!(e.flags&131072)}else _i=!1,kn&&t.flags&1048576&&gM(t,jy,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;iy(e,t),e=t.pendingProps;var a=wh(t,Ua.current);dh(t,r),a=pS(null,t,n,e,a,r);var i=mS();return t.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ci(n)?(i=!0,Ly(t)):i=!1,t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,uS(t),a.updater=A0,t.stateNode=a,a._reactInternals=t,M1(t,n,e,r),t=R1(null,t,n,!0,i,r)):(t.tag=0,kn&&i&&rS(t),ti(null,t,a,r),t=t.child),t;case 16:n=t.elementType;e:{switch(iy(e,t),e=t.pendingProps,a=n._init,n=a(n._payload),t.type=n,a=t.tag=Xj(n),e=Es(n,e),a){case 0:t=z1(null,t,n,e,r);break e;case 1:t=sT(null,t,n,e,r);break e;case 11:t=aT(null,t,n,e,r);break e;case 14:t=iT(null,t,n,Es(n.type,e),r);break e}throw Error(Pt(306,n,""))}return t;case 0:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:Es(n,a),z1(e,t,n,a,r);case 1:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:Es(n,a),sT(e,t,n,a,r);case 3:e:{if(XM(t),e===null)throw Error(Pt(387));n=t.pendingProps,i=t.memoizedState,a=i.element,wM(e,t),$y(t,n,null,r);var u=t.memoizedState;if(n=u.element,i.isDehydrated)if(i={element:n,isDehydrated:!1,cache:u.cache,pendingSuspenseBoundaries:u.pendingSuspenseBoundaries,transitions:u.transitions},t.updateQueue.baseState=i,t.memoizedState=i,t.flags&256){a=kh(Error(Pt(423)),t),t=oT(e,t,n,r,a);break e}else if(n!==a){a=kh(Error(Pt(424)),t),t=oT(e,t,n,r,a);break e}else for(Oi=Zl(t.stateNode.containerInfo.firstChild),Fi=t,kn=!0,Ps=null,r=bM(t,null,n,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(Sh(),n===a){t=Vo(e,t,r);break e}ti(e,t,n,r)}t=t.child}return t;case 5:return SM(t),e===null&&I1(t),n=t.type,a=t.pendingProps,i=e!==null?e.memoizedProps:null,u=a.children,E1(n,a)?u=null:i!==null&&E1(n,i)&&(t.flags|=32),ZM(e,t),ti(e,t,u,r),t.child;case 6:return e===null&&I1(t),null;case 13:return KM(e,t,r);case 4:return cS(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=Eh(t,null,n,r):ti(e,t,n,r),t.child;case 11:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:Es(n,a),aT(e,t,n,a,r);case 7:return ti(e,t,t.pendingProps,r),t.child;case 8:return ti(e,t,t.pendingProps.children,r),t.child;case 12:return ti(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(n=t.type._context,a=t.pendingProps,i=t.memoizedProps,u=a.value,fn(Oy,n._currentValue),n._currentValue=u,i!==null)if(Ls(i.value,u)){if(i.children===a.children&&!Ei.current){t=Vo(e,t,r);break e}}else for(i=t.child,i!==null&&(i.return=t);i!==null;){var s=i.dependencies;if(s!==null){u=i.child;for(var h=s.firstContext;h!==null;){if(h.context===n){if(i.tag===1){h=Bo(-1,r&-r),h.tag=2;var p=i.updateQueue;if(p!==null){p=p.shared;var g=p.pending;g===null?h.next=h:(h.next=g.next,g.next=h),p.pending=h}}i.lanes|=r,h=i.alternate,h!==null&&(h.lanes|=r),A1(i.return,r,t),s.lanes|=r;break}h=h.next}}else if(i.tag===10)u=i.type===t.type?null:i.child;else if(i.tag===18){if(u=i.return,u===null)throw Error(Pt(341));u.lanes|=r,s=u.alternate,s!==null&&(s.lanes|=r),A1(u,r,t),u=i.sibling}else u=i.child;if(u!==null)u.return=i;else for(u=i;u!==null;){if(u===t){u=null;break}if(i=u.sibling,i!==null){i.return=u.return,u=i;break}u=u.return}i=u}ti(e,t,a.children,r),t=t.child}return t;case 9:return a=t.type,n=t.pendingProps.children,dh(t,r),a=hs(a),n=n(a),t.flags|=1,ti(e,t,n,r),t.child;case 14:return n=t.type,a=Es(n,t.pendingProps),a=Es(n.type,a),iT(e,t,n,a,r);case 15:return GM(e,t,t.type,t.pendingProps,r);case 17:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:Es(n,a),iy(e,t),t.tag=1,Ci(n)?(e=!0,Ly(t)):e=!1,dh(t,r),UM(t,n,a),M1(t,n,a,r),R1(null,t,n,!0,e,r);case 19:return YM(e,t,r);case 22:return WM(e,t,r)}throw Error(Pt(156,t.tag))};function fD(e,t){return FN(e,t)}function Zj(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function os(e,t,r,n){return new Zj(e,t,r,n)}function CS(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Xj(e){if(typeof e=="function")return CS(e)?1:0;if(e!=null){if(e=e.$$typeof,e===q2)return 11;if(e===H2)return 14}return 2}function Jl(e,t){var r=e.alternate;return r===null?(r=os(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function ly(e,t,r,n,a,i){var u=2;if(n=e,typeof e=="function")CS(e)&&(u=1);else if(typeof e=="string")u=5;else e:switch(e){case Hd:return dc(r.children,a,i,t);case U2:u=8,a|=8;break;case r1:return e=os(12,r,t,a|2),e.elementType=r1,e.lanes=i,e;case n1:return e=os(13,r,t,a),e.elementType=n1,e.lanes=i,e;case a1:return e=os(19,r,t,a),e.elementType=a1,e.lanes=i,e;case SN:return D0(r,a,i,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case _N:u=10;break e;case wN:u=9;break e;case q2:u=11;break e;case H2:u=14;break e;case Nl:u=16,n=null;break e}throw Error(Pt(130,e==null?e:typeof e,""))}return t=os(u,r,t,a),t.elementType=e,t.type=n,t.lanes=i,t}function dc(e,t,r,n){return e=os(7,e,n,t),e.lanes=r,e}function D0(e,t,r,n){return e=os(22,e,n,t),e.elementType=SN,e.lanes=r,e.stateNode={isHidden:!1},e}function Qb(e,t,r){return e=os(6,e,null,t),e.lanes=r,e}function e_(e,t,r){return t=os(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Kj(e,t,r,n,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zb(0),this.expirationTimes=zb(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zb(0),this.identifierPrefix=n,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function kS(e,t,r,n,a,i,u,s,h){return e=new Kj(e,t,r,s,h),t===1?(t=1,i===!0&&(t|=8)):t=0,i=os(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},uS(i),e}function Yj(e,t,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:qd,key:n==null?null:""+n,children:e,containerInfo:t,implementation:r}}function pD(e){if(!e)return au;e=e._reactInternals;e:{if(Ic(e)!==e||e.tag!==1)throw Error(Pt(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ci(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Pt(171))}if(e.tag===1){var r=e.type;if(Ci(r))return pM(e,r,t)}return t}function mD(e,t,r,n,a,i,u,s,h){return e=kS(r,n,!0,e,a,i,u,s,h),e.context=pD(null),r=e.current,n=ri(),a=Yl(r),i=Bo(n,a),i.callback=t??null,Xl(r,i,a),e.current.lanes=a,zm(e,a,n),ki(e,n),e}function z0(e,t,r,n){var a=t.current,i=ri(),u=Yl(a);return r=pD(r),t.context===null?t.context=r:t.pendingContext=r,t=Bo(i,u),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),e=Xl(a,t,u),e!==null&&(Ds(e,a,u,i),ry(e,a,u)),u}function Xy(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function vT(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function TS(e,t){vT(e,t),(e=e.alternate)&&vT(e,t)}function Jj(){return null}var gD=typeof reportError=="function"?reportError:function(e){console.error(e)};function PS(e){this._internalRoot=e}R0.prototype.render=PS.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Pt(409));z0(e,t,null,null)};R0.prototype.unmount=PS.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;xc(function(){z0(null,e,null,null)}),t[Fo]=null}};function R0(e){this._internalRoot=e}R0.prototype.unstable_scheduleHydration=function(e){if(e){var t=WN();e={blockedOn:null,target:e,priority:t};for(var r=0;r<Ll.length&&t!==0&&t<Ll[r].priority;r++);Ll.splice(r,0,e),r===0&&XN(e)}};function IS(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function L0(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function yT(){}function Qj(e,t,r,n,a){if(a){if(typeof n=="function"){var i=n;n=function(){var p=Xy(u);i.call(p)}}var u=mD(t,n,e,0,null,!1,!1,"",yT);return e._reactRootContainer=u,e[Fo]=u.current,Qp(e.nodeType===8?e.parentNode:e),xc(),u}for(;a=e.lastChild;)e.removeChild(a);if(typeof n=="function"){var s=n;n=function(){var p=Xy(h);s.call(p)}}var h=kS(e,0,!1,null,null,!1,!1,"",yT);return e._reactRootContainer=h,e[Fo]=h.current,Qp(e.nodeType===8?e.parentNode:e),xc(function(){z0(t,h,r,n)}),h}function B0(e,t,r,n,a){var i=r._reactRootContainer;if(i){var u=i;if(typeof a=="function"){var s=a;a=function(){var h=Xy(u);s.call(h)}}z0(t,u,e,a)}else u=Qj(r,t,e,a,n);return Xy(u)}HN=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=Sp(t.pendingLanes);r!==0&&(Z2(t,r|1),ki(t,jn()),!(Vr&6)&&(Th=jn()+500,fu()))}break;case 13:xc(function(){var n=$o(e,1);if(n!==null){var a=ri();Ds(n,e,1,a)}}),TS(e,1)}};X2=function(e){if(e.tag===13){var t=$o(e,134217728);if(t!==null){var r=ri();Ds(t,e,134217728,r)}TS(e,134217728)}};GN=function(e){if(e.tag===13){var t=Yl(e),r=$o(e,t);if(r!==null){var n=ri();Ds(r,e,t,n)}TS(e,t)}};WN=function(){return rn};ZN=function(e,t){var r=rn;try{return rn=e,t()}finally{rn=r}};p1=function(e,t,r){switch(t){case"input":if(o1(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var a=T0(n);if(!a)throw Error(Pt(90));CN(n),o1(n,a)}}}break;case"textarea":TN(e,r);break;case"select":t=r.value,t!=null&&oh(e,!!r.multiple,t,!1)}};zN=wS;RN=xc;var eO={usingClientEntryPoint:!1,Events:[Lm,Xd,T0,MN,DN,wS]},ip={findFiberByHostInstance:nc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},tO={bundleType:ip.bundleType,version:ip.version,rendererPackageName:ip.rendererPackageName,rendererConfig:ip.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Wo.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=jN(e),e===null?null:e.stateNode},findFiberByHostInstance:ip.findFiberByHostInstance||Jj,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var bv=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!bv.isDisabled&&bv.supportsFiber)try{S0=bv.inject(tO),ro=bv}catch{}}qi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eO;qi.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!IS(t))throw Error(Pt(200));return Yj(e,t,null,r)};qi.createRoot=function(e,t){if(!IS(e))throw Error(Pt(299));var r=!1,n="",a=gD;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),t=kS(e,1,!1,null,null,r,!1,n,a),e[Fo]=t.current,Qp(e.nodeType===8?e.parentNode:e),new PS(t)};qi.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Pt(188)):(e=Object.keys(e).join(","),Error(Pt(268,e)));return e=jN(t),e=e===null?null:e.stateNode,e};qi.flushSync=function(e){return xc(e)};qi.hydrate=function(e,t,r){if(!L0(t))throw Error(Pt(200));return B0(null,e,t,!0,r)};qi.hydrateRoot=function(e,t,r){if(!IS(e))throw Error(Pt(405));var n=r!=null&&r.hydratedSources||null,a=!1,i="",u=gD;if(r!=null&&(r.unstable_strictMode===!0&&(a=!0),r.identifierPrefix!==void 0&&(i=r.identifierPrefix),r.onRecoverableError!==void 0&&(u=r.onRecoverableError)),t=mD(t,null,e,1,r??null,a,!1,i,u),e[Fo]=t.current,Qp(e),n)for(e=0;e<n.length;e++)r=n[e],a=r._getVersion,a=a(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,a]:t.mutableSourceEagerHydrationData.push(r,a);return new R0(t)};qi.render=function(e,t,r){if(!L0(t))throw Error(Pt(200));return B0(null,e,t,!1,r)};qi.unmountComponentAtNode=function(e){if(!L0(e))throw Error(Pt(40));return e._reactRootContainer?(xc(function(){B0(null,null,e,!1,function(){e._reactRootContainer=null,e[Fo]=null})}),!0):!1};qi.unstable_batchedUpdates=wS;qi.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!L0(r))throw Error(Pt(200));if(e==null||e._reactInternals===void 0)throw Error(Pt(38));return B0(e,t,r,!1,n)};qi.version="18.3.1-next-f1338f8080-20240426";function vD(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(vD)}catch(e){console.error(e)}}vD(),vN.exports=qi;var rO=vN.exports,yD,xT=rO;yD=xT.createRoot,xT.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function lm(){return lm=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},lm.apply(this,arguments)}var $l;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})($l||($l={}));const bT="popstate";function nO(e){e===void 0&&(e={});function t(n,a){let{pathname:i,search:u,hash:s}=n.location;return W1("",{pathname:i,search:u,hash:s},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function r(n,a){return typeof a=="string"?a:bD(a)}return iO(t,r,null,e)}function Wn(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function xD(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function aO(){return Math.random().toString(36).substr(2,8)}function _T(e,t){return{usr:e.state,key:e.key,idx:t}}function W1(e,t,r,n){return r===void 0&&(r=null),lm({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?Oh(t):t,{state:r,key:t&&t.key||n||aO()})}function bD(e){let{pathname:t="/",search:r="",hash:n=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function Oh(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function iO(e,t,r,n){n===void 0&&(n={});let{window:a=document.defaultView,v5Compat:i=!1}=n,u=a.history,s=$l.Pop,h=null,p=g();p==null&&(p=0,u.replaceState(lm({},u.state,{idx:p}),""));function g(){return(u.state||{idx:null}).idx}function v(){s=$l.Pop;let M=g(),I=M==null?null:M-p;p=M,h&&h({action:s,location:N.location,delta:I})}function x(M,I){s=$l.Push;let A=W1(N.location,M,I);p=g()+1;let D=_T(A,p),j=N.createHref(A);try{u.pushState(D,"",j)}catch(V){if(V instanceof DOMException&&V.name==="DataCloneError")throw V;a.location.assign(j)}i&&h&&h({action:s,location:N.location,delta:1})}function S(M,I){s=$l.Replace;let A=W1(N.location,M,I);p=g();let D=_T(A,p),j=N.createHref(A);u.replaceState(D,"",j),i&&h&&h({action:s,location:N.location,delta:0})}function P(M){let I=a.location.origin!=="null"?a.location.origin:a.location.href,A=typeof M=="string"?M:bD(M);return A=A.replace(/ $/,"%20"),Wn(I,"No window.location.(origin|href) available to create URL for href: "+A),new URL(A,I)}let N={get action(){return s},get location(){return e(a,u)},listen(M){if(h)throw new Error("A history only accepts one active listener");return a.addEventListener(bT,v),h=M,()=>{a.removeEventListener(bT,v),h=null}},createHref(M){return t(a,M)},createURL:P,encodeLocation(M){let I=P(M);return{pathname:I.pathname,search:I.search,hash:I.hash}},push:x,replace:S,go(M){return u.go(M)}};return N}var wT;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(wT||(wT={}));function sO(e,t,r){return r===void 0&&(r="/"),oO(e,t,r)}function oO(e,t,r,n){let a=typeof t=="string"?Oh(t):t,i=SD(a.pathname||"/",r);if(i==null)return null;let u=_D(e);lO(u);let s=null;for(let h=0;s==null&&h<u.length;++h){let p=bO(i);s=vO(u[h],p)}return s}function _D(e,t,r,n){t===void 0&&(t=[]),r===void 0&&(r=[]),n===void 0&&(n="");let a=(i,u,s)=>{let h={relativePath:s===void 0?i.path||"":s,caseSensitive:i.caseSensitive===!0,childrenIndex:u,route:i};h.relativePath.startsWith("/")&&(Wn(h.relativePath.startsWith(n),'Absolute route path "'+h.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),h.relativePath=h.relativePath.slice(n.length));let p=hc([n,h.relativePath]),g=r.concat(h);i.children&&i.children.length>0&&(Wn(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+p+'".')),_D(i.children,t,g,p)),!(i.path==null&&!i.index)&&t.push({path:p,score:mO(p,i.index),routesMeta:g})};return e.forEach((i,u)=>{var s;if(i.path===""||!((s=i.path)!=null&&s.includes("?")))a(i,u);else for(let h of wD(i.path))a(i,u,h)}),t}function wD(e){let t=e.split("/");if(t.length===0)return[];let[r,...n]=t,a=r.endsWith("?"),i=r.replace(/\?$/,"");if(n.length===0)return a?[i,""]:[i];let u=wD(n.join("/")),s=[];return s.push(...u.map(h=>h===""?i:[i,h].join("/"))),a&&s.push(...u),s.map(h=>e.startsWith("/")&&h===""?"/":h)}function lO(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:gO(t.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const uO=/^:[\w-]+$/,cO=3,dO=2,hO=1,fO=10,pO=-2,ST=e=>e==="*";function mO(e,t){let r=e.split("/"),n=r.length;return r.some(ST)&&(n+=pO),t&&(n+=dO),r.filter(a=>!ST(a)).reduce((a,i)=>a+(uO.test(i)?cO:i===""?hO:fO),n)}function gO(e,t){return e.length===t.length&&e.slice(0,-1).every((n,a)=>n===t[a])?e[e.length-1]-t[t.length-1]:0}function vO(e,t,r){let{routesMeta:n}=e,a={},i="/",u=[];for(let s=0;s<n.length;++s){let h=n[s],p=s===n.length-1,g=i==="/"?t:t.slice(i.length)||"/",v=yO({path:h.relativePath,caseSensitive:h.caseSensitive,end:p},g),x=h.route;if(!v)return null;Object.assign(a,v.params),u.push({params:a,pathname:hc([i,v.pathname]),pathnameBase:EO(hc([i,v.pathnameBase])),route:x}),v.pathnameBase!=="/"&&(i=hc([i,v.pathnameBase]))}return u}function yO(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,n]=xO(e.path,e.caseSensitive,e.end),a=t.match(r);if(!a)return null;let i=a[0],u=i.replace(/(.)\/+$/,"$1"),s=a.slice(1);return{params:n.reduce((p,g,v)=>{let{paramName:x,isOptional:S}=g;if(x==="*"){let N=s[v]||"";u=i.slice(0,i.length-N.length).replace(/(.)\/+$/,"$1")}const P=s[v];return S&&!P?p[x]=void 0:p[x]=(P||"").replace(/%2F/g,"/"),p},{}),pathname:i,pathnameBase:u,pattern:e}}function xO(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),xD(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let n=[],a="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(u,s,h)=>(n.push({paramName:s,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(n.push({paramName:"*"}),a+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?a+="\\/*$":e!==""&&e!=="/"&&(a+="(?:(?=\\/|$))"),[new RegExp(a,t?void 0:"i"),n]}function bO(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return xD(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function SD(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,n=e.charAt(r);return n&&n!=="/"?null:e.slice(r)||"/"}function _O(e,t){t===void 0&&(t="/");let{pathname:r,search:n="",hash:a=""}=typeof e=="string"?Oh(e):e;return{pathname:r?r.startsWith("/")?r:wO(r,t):t,search:CO(n),hash:kO(a)}}function wO(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(a=>{a===".."?r.length>1&&r.pop():a!=="."&&r.push(a)}),r.length>1?r.join("/"):"/"}function t_(e,t,r,n){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function SO(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function ED(e,t){let r=SO(e);return t?r.map((n,a)=>a===r.length-1?n.pathname:n.pathnameBase):r.map(n=>n.pathnameBase)}function CD(e,t,r,n){n===void 0&&(n=!1);let a;typeof e=="string"?a=Oh(e):(a=lm({},e),Wn(!a.pathname||!a.pathname.includes("?"),t_("?","pathname","search",a)),Wn(!a.pathname||!a.pathname.includes("#"),t_("#","pathname","hash",a)),Wn(!a.search||!a.search.includes("#"),t_("#","search","hash",a)));let i=e===""||a.pathname==="",u=i?"/":a.pathname,s;if(u==null)s=r;else{let v=t.length-1;if(!n&&u.startsWith("..")){let x=u.split("/");for(;x[0]==="..";)x.shift(),v-=1;a.pathname=x.join("/")}s=v>=0?t[v]:"/"}let h=_O(a,s),p=u&&u!=="/"&&u.endsWith("/"),g=(i||u===".")&&r.endsWith("/");return!h.pathname.endsWith("/")&&(p||g)&&(h.pathname+="/"),h}const hc=e=>e.join("/").replace(/\/\/+/g,"/"),EO=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),CO=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,kO=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function TO(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const kD=["post","put","patch","delete"];new Set(kD);const PO=["get",...kD];new Set(PO);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function um(){return um=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},um.apply(this,arguments)}const AS=se.createContext(null),IO=se.createContext(null),jm=se.createContext(null),j0=se.createContext(null),Ac=se.createContext({outlet:null,matches:[],isDataRoute:!1}),TD=se.createContext(null);function Om(){return se.useContext(j0)!=null}function O0(){return Om()||Wn(!1),se.useContext(j0).location}function PD(e){se.useContext(jm).static||se.useLayoutEffect(e)}function NS(){let{isDataRoute:e}=se.useContext(Ac);return e?VO():AO()}function AO(){Om()||Wn(!1);let e=se.useContext(AS),{basename:t,future:r,navigator:n}=se.useContext(jm),{matches:a}=se.useContext(Ac),{pathname:i}=O0(),u=JSON.stringify(ED(a,r.v7_relativeSplatPath)),s=se.useRef(!1);return PD(()=>{s.current=!0}),se.useCallback(function(p,g){if(g===void 0&&(g={}),!s.current)return;if(typeof p=="number"){n.go(p);return}let v=CD(p,JSON.parse(u),i,g.relative==="path");e==null&&t!=="/"&&(v.pathname=v.pathname==="/"?t:hc([t,v.pathname])),(g.replace?n.replace:n.push)(v,g.state,g)},[t,n,u,i,e])}function NO(e,t){return MO(e,t)}function MO(e,t,r,n){Om()||Wn(!1);let{navigator:a}=se.useContext(jm),{matches:i}=se.useContext(Ac),u=i[i.length-1],s=u?u.params:{};u&&u.pathname;let h=u?u.pathnameBase:"/";u&&u.route;let p=O0(),g;if(t){var v;let M=typeof t=="string"?Oh(t):t;h==="/"||(v=M.pathname)!=null&&v.startsWith(h)||Wn(!1),g=M}else g=p;let x=g.pathname||"/",S=x;if(h!=="/"){let M=h.replace(/^\//,"").split("/");S="/"+x.replace(/^\//,"").split("/").slice(M.length).join("/")}let P=sO(e,{pathname:S}),N=BO(P&&P.map(M=>Object.assign({},M,{params:Object.assign({},s,M.params),pathname:hc([h,a.encodeLocation?a.encodeLocation(M.pathname).pathname:M.pathname]),pathnameBase:M.pathnameBase==="/"?h:hc([h,a.encodeLocation?a.encodeLocation(M.pathnameBase).pathname:M.pathnameBase])})),i,r,n);return t&&N?se.createElement(j0.Provider,{value:{location:um({pathname:"/",search:"",hash:"",state:null,key:"default"},g),navigationType:$l.Pop}},N):N}function DO(){let e=$O(),t=TO(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,a={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return se.createElement(se.Fragment,null,se.createElement("h2",null,"Unexpected Application Error!"),se.createElement("h3",{style:{fontStyle:"italic"}},t),r?se.createElement("pre",{style:a},r):null,null)}const zO=se.createElement(DO,null);class RO extends se.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error!==void 0?se.createElement(Ac.Provider,{value:this.props.routeContext},se.createElement(TD.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function LO(e){let{routeContext:t,match:r,children:n}=e,a=se.useContext(AS);return a&&a.static&&a.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=r.route.id),se.createElement(Ac.Provider,{value:t},n)}function BO(e,t,r,n){var a;if(t===void 0&&(t=[]),r===void 0&&(r=null),n===void 0&&(n=null),e==null){var i;if(!r)return null;if(r.errors)e=r.matches;else if((i=n)!=null&&i.v7_partialHydration&&t.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let u=e,s=(a=r)==null?void 0:a.errors;if(s!=null){let g=u.findIndex(v=>v.route.id&&(s==null?void 0:s[v.route.id])!==void 0);g>=0||Wn(!1),u=u.slice(0,Math.min(u.length,g+1))}let h=!1,p=-1;if(r&&n&&n.v7_partialHydration)for(let g=0;g<u.length;g++){let v=u[g];if((v.route.HydrateFallback||v.route.hydrateFallbackElement)&&(p=g),v.route.id){let{loaderData:x,errors:S}=r,P=v.route.loader&&x[v.route.id]===void 0&&(!S||S[v.route.id]===void 0);if(v.route.lazy||P){h=!0,p>=0?u=u.slice(0,p+1):u=[u[0]];break}}}return u.reduceRight((g,v,x)=>{let S,P=!1,N=null,M=null;r&&(S=s&&v.route.id?s[v.route.id]:void 0,N=v.route.errorElement||zO,h&&(p<0&&x===0?(UO("route-fallback"),P=!0,M=null):p===x&&(P=!0,M=v.route.hydrateFallbackElement||null)));let I=t.concat(u.slice(0,x+1)),A=()=>{let D;return S?D=N:P?D=M:v.route.Component?D=se.createElement(v.route.Component,null):v.route.element?D=v.route.element:D=g,se.createElement(LO,{match:v,routeContext:{outlet:g,matches:I,isDataRoute:r!=null},children:D})};return r&&(v.route.ErrorBoundary||v.route.errorElement||x===0)?se.createElement(RO,{location:r.location,revalidation:r.revalidation,component:N,error:S,children:A(),routeContext:{outlet:null,matches:I,isDataRoute:!0}}):A()},null)}var ID=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(ID||{}),AD=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(AD||{});function jO(e){let t=se.useContext(AS);return t||Wn(!1),t}function OO(e){let t=se.useContext(IO);return t||Wn(!1),t}function FO(e){let t=se.useContext(Ac);return t||Wn(!1),t}function ND(e){let t=FO(),r=t.matches[t.matches.length-1];return r.route.id||Wn(!1),r.route.id}function $O(){var e;let t=se.useContext(TD),r=OO(),n=ND();return t!==void 0?t:(e=r.errors)==null?void 0:e[n]}function VO(){let{router:e}=jO(ID.UseNavigateStable),t=ND(AD.UseNavigateStable),r=se.useRef(!1);return PD(()=>{r.current=!0}),se.useCallback(function(a,i){i===void 0&&(i={}),r.current&&(typeof a=="number"?e.navigate(a):e.navigate(a,um({fromRouteId:t},i)))},[e,t])}const ET={};function UO(e,t,r){ET[e]||(ET[e]=!0)}function qO(e,t){e==null||e.v7_startTransition,e==null||e.v7_relativeSplatPath}function sp(e){let{to:t,replace:r,state:n,relative:a}=e;Om()||Wn(!1);let{future:i,static:u}=se.useContext(jm),{matches:s}=se.useContext(Ac),{pathname:h}=O0(),p=NS(),g=CD(t,ED(s,i.v7_relativeSplatPath),h,a==="path"),v=JSON.stringify(g);return se.useEffect(()=>p(JSON.parse(v),{replace:r,state:n,relative:a}),[p,v,a,r,n]),null}function Io(e){Wn(!1)}function HO(e){let{basename:t="/",children:r=null,location:n,navigationType:a=$l.Pop,navigator:i,static:u=!1,future:s}=e;Om()&&Wn(!1);let h=t.replace(/^\/*/,"/"),p=se.useMemo(()=>({basename:h,navigator:i,static:u,future:um({v7_relativeSplatPath:!1},s)}),[h,s,i,u]);typeof n=="string"&&(n=Oh(n));let{pathname:g="/",search:v="",hash:x="",state:S=null,key:P="default"}=n,N=se.useMemo(()=>{let M=SD(g,h);return M==null?null:{location:{pathname:M,search:v,hash:x,state:S,key:P},navigationType:a}},[h,g,v,x,S,P,a]);return N==null?null:se.createElement(jm.Provider,{value:p},se.createElement(j0.Provider,{children:r,value:N}))}function GO(e){let{children:t,location:r}=e;return NO(Z1(t),r)}new Promise(()=>{});function Z1(e,t){t===void 0&&(t=[]);let r=[];return se.Children.forEach(e,(n,a)=>{if(!se.isValidElement(n))return;let i=[...t,a];if(n.type===se.Fragment){r.push.apply(r,Z1(n.props.children,i));return}n.type!==Io&&Wn(!1),!n.props.index||!n.props.children||Wn(!1);let u={id:n.props.id||i.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(u.children=Z1(n.props.children,i)),r.push(u)}),r}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const WO="6";try{window.__reactRouterVersion=WO}catch{}const ZO="startTransition",CT=H3[ZO];function XO(e){let{basename:t,children:r,future:n,window:a}=e,i=se.useRef();i.current==null&&(i.current=nO({window:a,v5Compat:!0}));let u=i.current,[s,h]=se.useState({action:u.action,location:u.location}),{v7_startTransition:p}=n||{},g=se.useCallback(v=>{p&&CT?CT(()=>h(v)):h(v)},[h,p]);return se.useLayoutEffect(()=>u.listen(g),[u,g]),se.useEffect(()=>qO(n),[n]),se.createElement(HO,{basename:t,children:r,location:s.location,navigationType:s.action,navigator:u,future:n})}var kT;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(kT||(kT={}));var TT;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(TT||(TT={}));const KO={},PT=e=>{let t;const r=new Set,n=(g,v)=>{const x=typeof g=="function"?g(t):g;if(!Object.is(x,t)){const S=t;t=v??(typeof x!="object"||x===null)?x:Object.assign({},t,x),r.forEach(P=>P(t,S))}},a=()=>t,h={setState:n,getState:a,getInitialState:()=>p,subscribe:g=>(r.add(g),()=>r.delete(g)),destroy:()=>{(KO?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()}},p=t=e(n,a,h);return h},MD=e=>e?PT(e):PT;var DD={exports:{}},zD={},RD={exports:{}},LD={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ph=se;function YO(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var JO=typeof Object.is=="function"?Object.is:YO,QO=Ph.useState,eF=Ph.useEffect,tF=Ph.useLayoutEffect,rF=Ph.useDebugValue;function nF(e,t){var r=t(),n=QO({inst:{value:r,getSnapshot:t}}),a=n[0].inst,i=n[1];return tF(function(){a.value=r,a.getSnapshot=t,r_(a)&&i({inst:a})},[e,r,t]),eF(function(){return r_(a)&&i({inst:a}),e(function(){r_(a)&&i({inst:a})})},[e]),rF(r),r}function r_(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!JO(e,r)}catch{return!0}}function aF(e,t){return t()}var iF=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?aF:nF;LD.useSyncExternalStore=Ph.useSyncExternalStore!==void 0?Ph.useSyncExternalStore:iF;RD.exports=LD;var sF=RD.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var F0=se,oF=sF;function lF(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var uF=typeof Object.is=="function"?Object.is:lF,cF=oF.useSyncExternalStore,dF=F0.useRef,hF=F0.useEffect,fF=F0.useMemo,pF=F0.useDebugValue;zD.useSyncExternalStoreWithSelector=function(e,t,r,n,a){var i=dF(null);if(i.current===null){var u={hasValue:!1,value:null};i.current=u}else u=i.current;i=fF(function(){function h(S){if(!p){if(p=!0,g=S,S=n(S),a!==void 0&&u.hasValue){var P=u.value;if(a(P,S))return v=P}return v=S}if(P=v,uF(g,S))return P;var N=n(S);return a!==void 0&&a(P,N)?(g=S,P):(g=S,v=N)}var p=!1,g,v,x=r===void 0?null:r;return[function(){return h(t())},x===null?void 0:function(){return h(x())}]},[t,r,n,a]);var s=cF(e,i[0],i[1]);return hF(function(){u.hasValue=!0,u.value=s},[s]),pF(s),s};DD.exports=zD;var mF=DD.exports;const BD=R2(mF),jD={},{useDebugValue:gF}=Ke,{useSyncExternalStoreWithSelector:vF}=BD;let IT=!1;const yF=e=>e;function xF(e,t=yF,r){(jD?"production":void 0)!=="production"&&r&&!IT&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),IT=!0);const n=vF(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,r);return gF(n),n}const AT=e=>{(jD?"production":void 0)!=="production"&&typeof e!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t=typeof e=="function"?MD(e):e,r=(n,a)=>xF(t,n,a);return Object.assign(r,t),r},Ti=e=>e?AT(e):AT,MS=Ti(e=>({id:void 0,type:void 0,set:t=>e(t),clear:()=>e({id:void 0,type:void 0})})),X1=new EventTarget,NT=e=>{X1.dispatchEvent(new CustomEvent("focus",{detail:e}))},OD=e=>{const t=r=>{e(r.detail)};return X1.addEventListener("focus",t),()=>{X1.removeEventListener("focus",t)}},bF="http://localhost:8089",_F="halcyon-dev",Ky="halcyon-ui",wF=`${bF}/realms/${_F}/.well-known/openid-configuration`,$0="halcyon_token",Yy="halcyon_refresh_token",V0="halcyon_user";let _v=null,ec=null;async function FD(){return _v||(_v=await(await fetch(wF)).json(),_v)}async function $D(e,t){var v,x,S;const n=(await FD()).token_endpoint,a=new URLSearchParams({grant_type:"password",client_id:Ky,username:e,password:t}),i=await fetch(n,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a});if(!i.ok)throw new Error("Login failed");const u=await i.json(),s=u.access_token,h=u.refresh_token,p=JSON.parse(atob(s.split(".")[1])),g={sub:p.sub,email:p.email,roles:((v=p.realm_access)==null?void 0:v.roles)||((S=(x=p.resource_access)==null?void 0:x[Ky])==null?void 0:S.roles)||[]};localStorage.setItem($0,s),localStorage.setItem(V0,JSON.stringify(g)),h&&localStorage.setItem(Yy,h),ec=null;try{sessionStorage.removeItem("halcyon_redirecting_to_login")}catch{}return{token:s,user:g,refreshToken:h}}async function DS(){return ec||(ec=(async()=>{var e,t,r;try{const n=localStorage.getItem(Yy);if(!n)throw new Error("No refresh token available");const i=(await FD()).token_endpoint,u=new URLSearchParams({grant_type:"refresh_token",client_id:Ky,refresh_token:n}),s=await fetch(i,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:u});if(!s.ok)throw zS(),new Error("Token refresh failed");const h=await s.json(),p=h.access_token,g=h.refresh_token,v=JSON.parse(atob(p.split(".")[1])),x={sub:v.sub,email:v.email,roles:((e=v.realm_access)==null?void 0:e.roles)||((r=(t=v.resource_access)==null?void 0:t[Ky])==null?void 0:r.roles)||[]};return localStorage.setItem($0,p),localStorage.setItem(V0,JSON.stringify(x)),g&&localStorage.setItem(Yy,g),{token:p,user:x}}finally{ec=null}})(),ec)}function zS(){localStorage.removeItem($0),localStorage.removeItem(Yy),localStorage.removeItem(V0),ec=null,window.location.href="/"}function bi(){return localStorage.getItem($0)}function RS(){const e=localStorage.getItem(V0);return e?JSON.parse(e):null}function On(e){const t=RS();return t?t.roles.includes(e):!1}function VD(){return!!bi()}const cm=Object.freeze(Object.defineProperty({__proto__:null,getToken:bi,getUser:RS,hasRole:On,isAuthenticated:VD,login:$D,logout:zS,refresh:DS},Symbol.toStringTag,{value:"Module"})),UD="halcyon_redirecting_to_login";function Vd(){try{return sessionStorage.getItem(UD)==="true"}catch{return!1}}function ws(e){try{e&&sessionStorage.setItem(UD,"true")}catch{}}function Ss(){return!(typeof window>"u"||window.location.pathname==="/login"||window.location.pathname.includes("/login")||Vd())}async function LS(e,t){const r=bi(),n={"Content-Type":"application/json"};r&&(n.Authorization=`Bearer ${r}`);let a=await fetch("http://localhost:8088/graphql",{method:"POST",headers:n,body:JSON.stringify({query:e,variables:t})});if(a.status===401&&Ss())throw ws(!0),window.location.href="/login",new Error("Unauthorized");const i=await a.json();if(i.errors)throw new Error(i.errors[0].message);if(!i.data)throw new Error("No data returned");return i.data}const n_="http://localhost:8088/graphql",op=n_.includes("/graphql")?n_.replace("/graphql",""):n_.replace(/\/$/,"")||"http://localhost:8088",br={async get(e,t){if(Vd())throw new Error("Unauthorized");const r=bi();if(!r)throw Ss()&&(ws(!0),window.location.href="/login"),new Error("Unauthorized");const n={Authorization:`Bearer ${r}`};let a=`${op}${e}`;if(t!=null&&t.params){const s=new URLSearchParams;Object.entries(t.params).forEach(([h,p])=>{p!=null&&s.append(h,String(p))}),s.toString()&&(a+=`?${s.toString()}`)}const i=await fetch(a,{headers:n});if(i.status===401&&Ss())throw ws(!0),window.location.href="/login",new Error("Unauthorized");if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);return{data:await i.json()}},async delete(e){if(Vd())throw new Error("Unauthorized");const t=bi();if(!t)throw Ss()&&(ws(!0),window.location.href="/login"),new Error("Unauthorized");const r={Authorization:`Bearer ${t}`},n=await fetch(`${op}${e}`,{method:"DELETE",headers:r});if(n.status===401&&Ss())throw ws(!0),window.location.href="/login",new Error("Unauthorized");if(n.status===403){const i=await n.json().catch(()=>({detail:n.statusText}));throw new Error(`HTTP ${n.status}: ${i.detail||n.statusText}`)}if(!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);const a=await n.text();return{data:a?JSON.parse(a):{}}},async put(e,t){if(Vd())throw new Error("Unauthorized");const r=bi();if(!r)throw Ss()&&(ws(!0),window.location.href="/login"),new Error("Unauthorized");const n={"Content-Type":"application/json",Authorization:`Bearer ${r}`},a=await fetch(`${op}${e}`,{method:"PUT",headers:n,body:t?JSON.stringify(t):void 0});if(a.status===401&&Ss())throw ws(!0),window.location.href="/login",new Error("Unauthorized");if(!a.ok)throw new Error(`HTTP ${a.status}: ${a.statusText}`);return{data:await a.json()}},async patch(e,t){if(Vd())throw new Error("Unauthorized");const r=bi();if(!r)throw Ss()&&(ws(!0),window.location.href="/login"),new Error("Unauthorized");const n={"Content-Type":"application/json",Authorization:`Bearer ${r}`},a=await fetch(`${op}${e}`,{method:"PATCH",headers:n,body:t?JSON.stringify(t):void 0});if(a.status===401&&Ss())throw ws(!0),window.location.href="/login",new Error("Unauthorized");if(!a.ok)throw new Error(`HTTP ${a.status}: ${a.statusText}`);return{data:await a.json()}},async post(e,t){if(Vd())throw new Error("Unauthorized");const r=bi();if(!r)throw Ss()&&(ws(!0),window.location.href="/login"),new Error("Unauthorized");const n={"Content-Type":"application/json",Authorization:`Bearer ${r}`},a=await fetch(`${op}${e}`,{method:"POST",headers:n,body:t?JSON.stringify(t):void 0});if(a.status===401&&Ss())throw ws(!0),window.location.href="/login",new Error("Unauthorized");if(!a.ok)throw new Error(`HTTP ${a.status}: ${a.statusText}`);return{data:await a.json()}}};function SF(){const{id:e,type:t,clear:r}=MS(),[n,a]=Ke.useState(null);return Ke.useEffect(()=>{if(!e)return a(null);LS("query($id:ID!){ entityById(id:$id){ id type attrs } }",{id:e}).then(i=>a(i.entityById)).catch(()=>a(null))},[e]),e?w.jsxs("aside",{className:"fixed right-0 top-0 h-full w-[380px] bg-panel/95 border-l border-white/10 p-4",children:[w.jsxs("div",{className:"flex items-center justify-between mb-3",children:[w.jsxs("h3",{className:"font-semibold",children:[t,"  ",e]}),w.jsx("button",{className:"text-sm opacity-70 hover:opacity-100",onClick:r,children:"Close"})]}),w.jsx("pre",{className:"text-xs opacity-80 overflow-auto max-h-[70vh]",children:JSON.stringify((n==null?void 0:n.attrs)??{},null,2)}),w.jsx("div",{className:"mt-3 flex gap-2",children:w.jsx("button",{className:"px-2 py-1 rounded bg-white/10",onClick:()=>{var i,u;NT({id:e,type:t}),(i=n==null?void 0:n.attrs)!=null&&i.lat&&((u=n==null?void 0:n.attrs)!=null&&u.lon)&&setTimeout(()=>NT({id:e,type:t}),50)},children:"Focus on Map/Graph"})})]}):null}const Nc=Ti(e=>({token:null,user:null,loading:!1,login:async(t,r)=>{e({loading:!0});try{const{token:n,user:a}=await $D(t,r);e({token:n,user:a,loading:!1})}catch(n){throw e({loading:!1}),n}},refresh:async()=>{try{const{token:t,user:r}=await DS();e({token:t,user:r})}catch(t){throw e({token:null,user:null}),t}},logout:()=>{zS(),e({token:null,user:null})},initialize:()=>{const t=bi(),r=RS();e({token:t,user:r})}}));function EF(){const[e,t]=se.useState(""),[r,n]=se.useState(""),[a,i]=se.useState(null),{login:u,loading:s}=Nc(),h=async p=>{p.preventDefault(),i(null);try{await u(e,r)}catch(g){i(g instanceof Error?g.message:"Login failed")}};return w.jsx("div",{className:"min-h-screen bg-surface flex items-center justify-center",children:w.jsxs("div",{className:"bg-panel rounded-xl p-8 w-96 border border-white/10",children:[w.jsxs("div",{className:"flex flex-col items-center mb-6",children:[w.jsx("img",{src:"/logo.png",alt:"HALCYON Logo",className:"h-16 w-16 object-contain mb-4"}),w.jsx("h2",{className:"text-2xl font-semibold",children:"HALCYON Console"})]}),w.jsxs("form",{onSubmit:h,className:"space-y-4",children:[w.jsxs("div",{children:[w.jsx("label",{className:"block text-sm mb-1 opacity-80",children:"Username"}),w.jsx("input",{type:"text",value:e,onChange:p=>t(p.target.value),className:"w-full px-3 py-2 bg-black/20 border border-white/10 rounded focus:outline-none focus:border-white/30",required:!0})]}),w.jsxs("div",{children:[w.jsx("label",{className:"block text-sm mb-1 opacity-80",children:"Password"}),w.jsx("input",{type:"password",value:r,onChange:p=>n(p.target.value),className:"w-full px-3 py-2 bg-black/20 border border-white/10 rounded focus:outline-none focus:border-white/30",required:!0})]}),a&&w.jsx("div",{className:"text-red-400 text-sm",children:a}),w.jsx("button",{type:"submit",disabled:s,className:"w-full px-4 py-2 bg-white/10 hover:bg-white/20 rounded transition-colors disabled:opacity-50",children:s?"Logging in...":"Login"})]}),w.jsx("div",{className:"mt-4 text-xs opacity-60",children:"Dev users: admin/admin, analyst/analyst"})]})})}function CF(){const{user:e,logout:t}=Nc();return e?w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsxs("div",{className:"text-sm opacity-80",children:[w.jsx("div",{className:"font-medium",children:e.email||e.sub}),w.jsx("div",{className:"text-xs opacity-60",children:e.roles.join(", ")})]}),w.jsx("button",{onClick:t,className:"px-3 py-1 text-sm bg-white/10 hover:bg-white/20 rounded transition-colors",children:"Logout"})]}):null}const mi="http://localhost:8088";async function Zs(e){if(!e.ok){if(e.status===401)try{await DS()}catch{}throw new Error(`${e.status} ${e.statusText}`)}return e.json()}function a_(e){return{id:e.id,name:e.name,gql:e.gql,owner:e.owner,shapeHint:e.shape_hint??void 0,createdAt:e.created_at,updatedAt:e.updated_at}}function wv(e){const t=e.config??e.config_json??{},r=typeof t=="string"?qD(t):t??{},n=r||{},a=typeof n.isDefault=="boolean"?!!n.isDefault:!1,i=e.is_default??e.isDefault??a;return{id:e.id,name:e.name,owner:e.owner,visibilityRoles:e.visibility_roles??e.visibilityRoles,config:r,isDefault:!!i,createdAt:e.created_at??e.createdAt,updatedAt:e.updated_at??e.updatedAt}}function i_(e){var a,i,u,s;const t=e.config??e.config_json??e.configJson??{},r=typeof t=="string"?qD(t):t??{},n=r||{};return{id:e.id,dashboardId:e.dashboard_id??e.dashboardId,title:e.title,type:e.type,refreshSec:e.refreshSec??n.refreshSec??((a=e.config)==null?void 0:a.refreshSec)??((i=e.config_json)==null?void 0:i.refreshSec),queryId:e.queryId??n.queryId??((u=e.config)==null?void 0:u.queryId)??((s=e.config_json)==null?void 0:s.queryId),config:r,position:e.position??0}}function qD(e){try{const t=JSON.parse(e);return t&&typeof t=="object"?t:{}}catch(t){return console.warn("Failed to parse dashboard config JSON",t),{}}}function gi(){const e={"Content-Type":"application/json"},t=bi();return t&&(e.Authorization=`Bearer ${t}`),e}const qr={getQueries:()=>fetch(`${mi}/saved-queries`,{headers:gi()}).then(Zs).then(e=>e.map(a_)),createQuery:e=>fetch(`${mi}/saved-queries`,{method:"POST",headers:gi(),body:JSON.stringify({name:e.name,gql:e.gql,shape_hint:e.shapeHint??null})}).then(Zs).then(a_),updateQuery:(e,t)=>fetch(`${mi}/saved-queries/${e}`,{method:"PUT",headers:gi(),body:JSON.stringify({...t.name!==void 0?{name:t.name}:{},...t.gql!==void 0?{gql:t.gql}:{},...t.shapeHint!==void 0?{shape_hint:t.shapeHint}:{}})}).then(Zs).then(a_),deleteQuery:e=>fetch(`${mi}/saved-queries/${e}`,{method:"DELETE",headers:gi()}).then(()=>{}),getDashboards:()=>fetch(`${mi}/dashboards`,{headers:gi()}).then(Zs).then(e=>e.map(wv)),createDashboard:e=>fetch(`${mi}/dashboards`,{method:"POST",headers:gi(),body:JSON.stringify({name:e.name,config:e.config??{},is_default:e.isDefault??!1})}).then(Zs).then(wv),updateDashboard:(e,t)=>fetch(`${mi}/dashboards/${e}`,{method:"PUT",headers:gi(),body:JSON.stringify({...t.name!==void 0&&{name:t.name},...t.config!==void 0&&{config:t.config??{}},...t.isDefault!==void 0&&{is_default:t.isDefault}})}).then(Zs).then(wv),setDefaultDashboard:e=>fetch(`${mi}/dashboards/${e}/set-default`,{method:"POST",headers:gi()}).then(()=>{}),deleteDashboard:e=>fetch(`${mi}/dashboards/${e}`,{method:"DELETE",headers:gi()}).then(()=>{}),getDashboard:e=>fetch(`${mi}/dashboards/${e}`,{headers:gi()}).then(Zs).then(t=>({...wv(t),panels:(t.panels||[]).map(i_)})),createPanel:(e,t)=>fetch(`${mi}/dashboards/${e}/panels`,{method:"POST",headers:gi(),body:JSON.stringify({dashboard_id:e,title:t.title,type:t.type,position:t.position??0,config_json:{...t.config||{},queryId:t.queryId,refreshSec:t.refreshSec}})}).then(Zs).then(i_),updatePanel:(e,t,r)=>fetch(`${mi}/dashboards/${e}/panels/${t}`,{method:"PUT",headers:gi(),body:JSON.stringify({...r.title!==void 0&&{title:r.title},...r.type!==void 0&&{type:r.type},...r.position!==void 0&&{position:r.position},...(r.config!==void 0||r.queryId!==void 0||r.refreshSec!==void 0)&&{config_json:{...r.config||{},...r.queryId!==void 0&&{queryId:r.queryId},...r.refreshSec!==void 0&&{refreshSec:r.refreshSec}}}})}).then(Zs).then(i_),deletePanel:(e,t)=>fetch(`${mi}/dashboards/${e}/panels/${t}`,{method:"DELETE",headers:gi()}).then(()=>{}),listDatasources:()=>fetch(`${mi}/datasources`,{headers:gi()}).then(Zs).then(e=>e.map(t=>({id:t.id,name:t.name,status:t.status})))},sc=Ti((e,t)=>({queries:[],dashboards:[],panels:{},loading:!1,defaultDashboardId:null,async loadAll(){e({loading:!0});try{const[r,n]=await Promise.all([qr.getQueries(),qr.getDashboards()]),a=n.find(i=>i.isDefault);e({queries:r,dashboards:n,defaultDashboardId:(a==null?void 0:a.id)??null,loading:!1})}catch(r){e({loading:!1,error:String((r==null?void 0:r.message)||r)})}},async loadQueries(){try{e({queries:await qr.getQueries()})}catch(r){e({error:String((r==null?void 0:r.message)||r)})}},async loadDashboards(){e({loading:!0});try{const r=await qr.getDashboards(),n=r.find(a=>a.isDefault);e({dashboards:r,defaultDashboardId:(n==null?void 0:n.id)??null,loading:!1})}catch(r){e({error:String((r==null?void 0:r.message)||r),loading:!1})}},async loadPanels(r){e({loading:!0});try{const n=await qr.getDashboard(r),{panels:a,...i}=n,u=t().dashboards,s=u.length?u.map(p=>p.id===r?{...p,...i}:p):[i],h=s.find(p=>p.isDefault);e({dashboards:s,defaultDashboardId:(h==null?void 0:h.id)??t().defaultDashboardId,panels:{...t().panels,[r]:a||[]},loading:!1})}catch(n){e({error:String((n==null?void 0:n.message)||n),loading:!1})}},async setDefaultDashboard(r){const n=t().defaultDashboardId,a=t().dashboards,i=a.map(u=>r&&u.id===r?{...u,isDefault:!0}:!r&&n&&u.id===n?{...u,isDefault:!1}:r&&n&&u.id===n?{...u,isDefault:!1}:{...u,isDefault:!1});try{e({defaultDashboardId:r,dashboards:i}),r?(await qr.setDefaultDashboard(r),await t().loadPanels(r)):n&&await qr.updateDashboard(n,{isDefault:!1}),await t().loadDashboards()}catch(u){const s=a.map(h=>n&&h.id===n?{...h,isDefault:!0}:r&&h.id===r?{...h,isDefault:!1}:h);throw e({error:String((u==null?void 0:u.message)||u),defaultDashboardId:n??null,dashboards:s}),u}}})),eo=({isOpen:e,onClose:t,title:r,children:n,className:a=""})=>e?w.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:t,children:w.jsxs("div",{className:`bg-panel rounded-xl border border-white/10 p-6 w-full max-w-md ${a}`,onClick:i=>i.stopPropagation(),children:[w.jsxs("div",{className:"flex items-center justify-between mb-4",children:[w.jsx("h3",{className:"text-lg font-semibold text-white",children:r}),w.jsx("button",{onClick:t,className:"text-white/70 hover:text-white text-xl leading-none",children:""})]}),n]})}):null,so=({isOpen:e,onClose:t,title:r,message:n,buttonText:a="OK",variant:i="info"})=>{const u={error:"bg-red-600 hover:bg-red-700",info:"bg-teal-600 hover:bg-teal-700",success:"bg-green-600 hover:bg-green-700"};return w.jsx(eo,{isOpen:e,onClose:t,title:r,children:w.jsxs("div",{className:"space-y-4",children:[w.jsx("p",{className:`text-white/80 ${i==="error"?"text-red-200":""}`,children:n}),w.jsx("div",{className:"flex justify-end",children:w.jsx("button",{onClick:t,className:`px-4 py-2 rounded text-white text-sm ${u[i]}`,children:a})})]})})},HD=({isOpen:e,onClose:t,onConfirm:r,title:n,message:a,confirmText:i="Confirm",cancelText:u="Cancel",danger:s=!1})=>{const h=()=>{r(),t()};return w.jsx(eo,{isOpen:e,onClose:t,title:n,children:w.jsxs("div",{className:"space-y-4",children:[w.jsx("p",{className:"text-white/80",children:a}),w.jsxs("div",{className:"flex gap-2 justify-end",children:[w.jsx("button",{onClick:t,className:"px-4 py-2 bg-white/10 hover:bg-white/20 rounded text-white text-sm",children:u}),w.jsx("button",{onClick:h,className:`px-4 py-2 rounded text-white text-sm ${s?"bg-red-600 hover:bg-red-700":"bg-teal-600 hover:bg-teal-700"}`,children:i})]})]})})},kF=({message:e,duration:t=3e3,onClose:r})=>(se.useEffect(()=>{const n=setTimeout(r,t);return()=>clearTimeout(n)},[t,r]),w.jsx("div",{className:"fixed top-4 right-4 bg-teal-600 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-fade-in",children:e}));let uy=[];const St=e=>{uy.forEach(t=>t(e))},TF=e=>(uy.push(e),()=>{uy=uy.filter(t=>t!==e)});function GD(e){var r,n;if(!e||typeof e!="object")return{shape:"unknown",confidence:"low"};if(Array.isArray(e.entities)&&e.entities.length>0){const a=e.entities[0];if(a&&typeof a=="object"&&(a.id||a.type))return(r=a.attrs)!=null&&r.lat&&((n=a.attrs)!=null&&n.lon)?{shape:"geo",confidence:"high",hint:"entities[] with lat/lon"}:{shape:"entities",confidence:"high",hint:"entities[]"}}if(Array.isArray(e.buckets)||Array.isArray(e.counts)){const a=e.buckets||e.counts;if(a.length>0&&a[0]&&typeof a[0]=="object"&&(a[0].ts||a[0].bucket||a[0].count!==void 0))return{shape:"counts",confidence:"high",hint:"buckets[] or counts[]"}}if(typeof e.value=="number"||e.data&&typeof e.data.value=="number")return{shape:"metric",confidence:"high",hint:"value: number"};if(typeof e.count=="number"||e.data&&typeof e.data.count=="number")return{shape:"metric",confidence:"high",hint:"count: number"};if(Array.isArray(e.items)&&e.items.length>0){const a=e.items[0];if(a&&typeof a=="object"&&(a.label!==void 0||a.value!==void 0))return{shape:"items",confidence:"high",hint:"items[] with label/value"}}if(Array.isArray(e.points)&&e.points.length>0){const a=e.points[0];if(a&&typeof a=="object"&&a.lat!==void 0&&a.lon!==void 0)return{shape:"geo",confidence:"high",hint:"points[] with lat/lon"}}const t=Object.values(e).filter(a=>Array.isArray(a));if(t.length>0){const a=t[0];if(a.length>0&&a[0]&&typeof a[0]=="object"&&(a[0].id||a[0].type))return{shape:"entities",confidence:"medium",hint:"array[] (entities-like)"}}return{shape:"unknown",confidence:"low"}}function BS(e){switch(e){case"map":case"list":case"table":case"graph":return"entities";case"timeline":return"counts";case"metric":return"metric";case"topbar":return"items";case"geoheat":return"geo";default:return"unknown"}}function K1(e,t){const r=BS(t);return Array.isArray(r)?r.includes(e):r===e||e==="unknown"}function as(e){switch(e){case"entities":return"entities[]";case"counts":return"counts[]";case"metric":return"metric";case"geo":return"geo[]";case"items":return"items[]";default:return"?"}}function WD(e){switch(e){case"map":return"Pick a query that returns entities[] with lat/lon for this panel.";case"list":case"table":return"Pick a query that returns entities[] for this panel.";case"graph":return"Pick a query that returns entities[] (and optionally relationships[]) for this panel.";case"timeline":return"Pick a query that returns counts[] or buckets[] for this panel.";case"metric":return"Pick a query that returns a numeric value or count for this panel.";case"topbar":return"Pick a query that returns items[] or entities[] (will rollup) for this panel.";case"geoheat":return"Pick a query that returns geo[] or entities[] with lat/lon for this panel.";default:return"Pick a compatible query for this panel."}}const s_=`# GraphQL example
query {
  health
}`;function PF(){const{queries:e,loadQueries:t}=sc(),[r,n]=Ke.useState(null),[a,i]=Ke.useState(""),[u,s]=Ke.useState(""),[h,p]=Ke.useState(s_),[g,v]=Ke.useState(void 0),[x,S]=Ke.useState(null),[P,N]=Ke.useState(!1),[M,I]=Ke.useState({isOpen:!1,title:"",message:"",variant:"info"}),[A,D]=Ke.useState({isOpen:!1,queryId:null,message:""});Ke.useEffect(()=>{t()},[t]),Ke.useEffect(()=>{if(!r){s(""),p(s_),v(void 0),S(null);return}const K=e.find(Y=>Y.id===r);K&&(s(K.name),p(K.gql),v(K.shapeHint),S(null))},[r,e]);const j=Ke.useMemo(()=>{const K=a.trim().toLowerCase();return K?e.filter(Y=>Y.name.toLowerCase().includes(K)||Y.gql.toLowerCase().includes(K)):e},[e,a]),V=(K,Y)=>{const G=Y instanceof Error?Y.message:String(Y);I({isOpen:!0,title:K,message:G,variant:"error"})},U=async()=>{N(!0);try{const K=await LS(h),Y=GD(K);S({data:K,shape:Y,executedAt:new Date().toISOString()}),Y.shape!=="unknown"&&v(Y.shape),St("Query executed")}catch(K){const Y=K instanceof Error?K.message:"Failed to run query";S({data:null,shape:null,error:Y,executedAt:new Date().toISOString()}),V("Run Failed",K)}finally{N(!1)}},$=()=>{n(null),s(""),p(s_),v(void 0),S(null)},W=async()=>{var Y;const K=u.trim();if(!K){I({isOpen:!0,title:"Validation Error",message:"Please provide a query name before saving.",variant:"error"});return}N(!0);try{const G=((Y=x==null?void 0:x.shape)==null?void 0:Y.shape)??g??"unknown";if(r)await qr.updateQuery(r,{name:K,gql:h,shapeHint:G}),St("Query updated");else{const oe=await qr.createQuery({name:K,gql:h,shapeHint:G});n(oe.id),St("Query saved")}await t()}catch(G){V("Save Failed",G)}finally{N(!1)}},X=async()=>{const K=A.queryId;if(K){N(!0);try{await qr.deleteQuery(K),r===K&&$(),await t(),St("Query deleted")}catch(Y){V("Delete Failed",Y)}finally{N(!1),D({isOpen:!1,queryId:null,message:""})}}},J=async K=>{N(!0);try{const Y=await qr.createQuery({name:`${K.name} (copy)`,gql:K.gql,shapeHint:K.shapeHint});await t(),n(Y.id),St("Query duplicated")}catch(Y){V("Duplicate Failed",Y)}finally{N(!1)}},Z=r?e.find(K=>K.id===r):null;return w.jsxs("div",{className:"h-full grid grid-cols-12 gap-4 p-4",children:[w.jsxs("div",{className:"col-span-4 flex flex-col bg-black/30 border border-white/10 rounded-xl overflow-hidden",children:[w.jsxs("div",{className:"p-4 border-b border-white/5 space-y-3",children:[w.jsxs("div",{children:[w.jsx("h2",{className:"text-lg font-semibold text-white",children:"Saved Queries"}),w.jsx("p",{className:"text-xs text-white/60",children:"Manage reusable GraphQL queries for dashboards and analysis."})]}),w.jsx("input",{value:a,onChange:K=>i(K.target.value),placeholder:"Search by name or text",className:"w-full bg-white/10 rounded px-3 py-2 text-sm text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-teal-500"}),w.jsx("button",{onClick:$,className:"w-full px-3 py-2 bg-teal-600 hover:bg-teal-500 rounded text-sm font-medium",children:"New Query"})]}),w.jsxs("div",{className:"flex-1 overflow-auto divide-y divide-white/5",children:[j.map(K=>{const Y=K.id===r;return w.jsxs("div",{role:"button",tabIndex:0,onClick:()=>n(K.id),onKeyDown:G=>{(G.key==="Enter"||G.key===" ")&&(G.preventDefault(),n(K.id))},className:`w-full text-left px-4 py-3 transition-colors cursor-pointer outline-none ${Y?"bg-white/10 ring-1 ring-white/20":"hover:bg-white/5 focus-visible:ring-1 focus-visible:ring-teal-400"}`,children:[w.jsxs("div",{className:"flex items-start justify-between gap-3",children:[w.jsxs("div",{children:[w.jsx("div",{className:"text-sm font-medium text-white line-clamp-1",children:K.name}),w.jsx("div",{className:"text-xs text-white/50 mt-1 line-clamp-2",children:K.gql})]}),K.shapeHint&&w.jsx("span",{className:"text-[11px] font-semibold text-teal-300 bg-teal-500/20 rounded px-2 py-0.5",children:as(K.shapeHint)})]}),w.jsxs("div",{className:"flex items-center justify-between mt-2 text-[11px] text-white/40",children:[w.jsx("span",{children:new Date(K.updatedAt??"").toLocaleString()}),w.jsxs("div",{className:"flex gap-2",children:[w.jsx("button",{type:"button",className:"hover:text-white",onClick:G=>{G.stopPropagation(),s(K.name),p(K.gql),v(K.shapeHint),S(null),n(K.id)},children:"Edit"}),w.jsx("button",{type:"button",className:"hover:text-white",onClick:G=>{G.stopPropagation(),J(K)},children:"Duplicate"}),w.jsx("button",{type:"button",className:"text-red-400 hover:text-red-200",onClick:G=>{G.stopPropagation(),D({isOpen:!0,queryId:K.id,message:`Delete ${K.name}? This cannot be undone.`})},children:"Delete"})]})]})]},K.id)}),j.length===0&&w.jsx("div",{className:"p-6 text-sm text-white/50",children:"No saved queries found. Use New Query to create one."})]})]}),w.jsxs("div",{className:"col-span-8 flex flex-col bg-black/20 border border-white/10 rounded-xl overflow-hidden",children:[w.jsxs("div",{className:"flex items-center justify-between border-b border-white/5 px-5 py-3",children:[w.jsxs("div",{children:[w.jsx("h3",{className:"text-lg font-semibold text-white",children:Z?"Edit Query":"New Query"}),w.jsx("p",{className:"text-xs text-white/60",children:"Run and save queries with automatic shape detection for dashboards."})]}),(x==null?void 0:x.shape)&&w.jsxs("div",{className:"flex items-center gap-2 text-xs text-white/70",children:[w.jsx("span",{children:"Detected shape:"}),w.jsx("span",{className:"px-2 py-1 rounded bg-white/10 text-white font-medium",children:as(x.shape.shape)}),w.jsxs("span",{className:"text-white/40",children:["(",x.shape.confidence," confidence)"]})]})]}),w.jsxs("div",{className:"p-5 space-y-4 overflow-auto",children:[w.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[w.jsxs("div",{className:"space-y-1",children:[w.jsx("label",{className:"text-xs text-white/60 block",children:"Name"}),w.jsx("input",{value:u,onChange:K=>s(K.target.value),placeholder:"My Entities by Type",className:"w-full bg-white/10 rounded px-3 py-2 text-sm text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-teal-500"})]}),w.jsxs("div",{className:"space-y-1",children:[w.jsx("label",{className:"text-xs text-white/60 block",children:"Shape hint"}),w.jsxs("select",{value:g??"",onChange:K=>v(K.target.value||void 0),className:"w-full bg-white/10 rounded px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-teal-500",children:[w.jsx("option",{value:"",children:"Auto-detect"}),w.jsx("option",{value:"entities",children:"entities[]"}),w.jsx("option",{value:"counts",children:"counts[]"}),w.jsx("option",{value:"metric",children:"metric"}),w.jsx("option",{value:"geo",children:"geo[]"}),w.jsx("option",{value:"items",children:"items[]"}),w.jsx("option",{value:"unknown",children:"unknown"})]})]})]}),w.jsxs("div",{className:"space-y-1",children:[w.jsx("label",{className:"text-xs text-white/60 block",children:"GraphQL"}),w.jsx("textarea",{value:h,onChange:K=>p(K.target.value),className:"w-full h-56 bg-black/40 border border-white/10 rounded-lg p-3 font-mono text-sm text-white leading-relaxed focus:outline-none focus:ring-2 focus:ring-teal-500"})]}),w.jsxs("div",{className:"flex flex-wrap gap-3",children:[w.jsx("button",{onClick:U,disabled:P,className:"px-4 py-2 rounded bg-blue-600 hover:bg-blue-500 disabled:opacity-50 text-sm font-medium",children:"Run"}),w.jsx("button",{onClick:W,disabled:P,className:"px-4 py-2 rounded bg-teal-600 hover:bg-teal-500 disabled:opacity-50 text-sm font-medium",children:r?"Save Changes":"Save Query"}),w.jsx("button",{onClick:$,disabled:P,className:"px-4 py-2 rounded bg-white/10 hover:bg-white/20 text-sm font-medium",children:"Reset"})]}),x&&w.jsxs("div",{className:"space-y-2",children:[w.jsxs("div",{className:"flex items-center justify-between",children:[w.jsx("h4",{className:"text-sm font-semibold text-white",children:"Last Run"}),x.executedAt&&w.jsx("span",{className:"text-[11px] text-white/40",children:new Date(x.executedAt).toLocaleString()})]}),x.error?w.jsx("div",{className:"text-sm text-red-400 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2",children:x.error}):w.jsx("pre",{className:"max-h-64 overflow-auto bg-black/40 border border-white/10 rounded-lg p-3 text-xs text-white",children:JSON.stringify(x.data,null,2)})]})]})]}),w.jsx(so,{isOpen:M.isOpen,onClose:()=>I({...M,isOpen:!1}),title:M.title,message:M.message,variant:M.variant}),w.jsx(HD,{isOpen:A.isOpen,onClose:()=>D({isOpen:!1,queryId:null,message:""}),onConfirm:X,title:"Delete Query",message:A.message,confirmText:"Delete",cancelText:"Cancel",danger:!0})]})}const IF=[{type:"map",title:"Map",desc:"Geospatial markers"},{type:"graph",title:"Graph",desc:"Entity relationships"},{type:"list",title:"List",desc:"Tabular entity listing"},{type:"timeline",title:"Timeline",desc:"Time buckets & playback"},{type:"metric",title:"Metric",desc:"Single numeric KPI"},{type:"table",title:"Table",desc:"Sortable table view"},{type:"topbar",title:"Top-N Bars",desc:"Categorical metrics"},{type:"geoheat",title:"Geo Heat",desc:"Spatial density map"}];function AF({onPick:e,variant:t="grid"}){const r=t==="single-column";return w.jsx("div",{className:r?"space-y-2":"grid grid-cols-4 gap-2",children:IF.map(n=>w.jsxs("button",{className:`bg-black/20 rounded p-3 text-left hover:bg-white/5 text-white ${r?"w-full":""}`,onClick:()=>e(n.type),children:[w.jsx("div",{className:"font-semibold",children:n.title}),w.jsx("div",{className:"text-xs opacity-70",children:n.desc})]},n.type))})}const Is=({title:e,children:t,className:r="",header:n,fill:a=!0,bodyClassName:i=""})=>w.jsxs("div",{className:`bg-panel rounded-xl border border-white/10 flex flex-col ${a?"h-full min-h-0":""} ${r}`.trim(),children:[(e||n)&&w.jsxs("div",{className:"px-3 py-2 border-b border-white/10 text-sm opacity-80 flex-shrink-0 flex items-center justify-between",children:[w.jsx("span",{className:"font-medium text-white/80",children:e}),n]}),w.jsx("div",{className:`${a?"flex-1 min-h-0":""} flex flex-col relative ${i}`.trim(),children:t})]});var ZD={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */(function(e,t){(function(r,n){e.exports=n()})(I3,function(){var r={},n={};function a(u,s,h){if(n[u]=h,u==="index"){var p="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",g={};return n.shared(g),n.index(r,g),typeof window<"u"&&r.setWorkerUrl(window.URL.createObjectURL(new Blob([p],{type:"text/javascript"}))),r}}a("shared",["exports"],function(u){function s(c,l,d,m){return new(d||(d=Promise))(function(_,k){function T(F){try{L(m.next(F))}catch(q){k(q)}}function z(F){try{L(m.throw(F))}catch(q){k(q)}}function L(F){var q;F.done?_(F.value):(q=F.value,q instanceof d?q:new d(function(Q){Q(q)})).then(T,z)}L((m=m.apply(c,l||[])).next())})}function h(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}typeof SuppressedError=="function"&&SuppressedError;var p=g;function g(c,l){this.x=c,this.y=l}g.prototype={clone:function(){return new g(this.x,this.y)},add:function(c){return this.clone()._add(c)},sub:function(c){return this.clone()._sub(c)},multByPoint:function(c){return this.clone()._multByPoint(c)},divByPoint:function(c){return this.clone()._divByPoint(c)},mult:function(c){return this.clone()._mult(c)},div:function(c){return this.clone()._div(c)},rotate:function(c){return this.clone()._rotate(c)},rotateAround:function(c,l){return this.clone()._rotateAround(c,l)},matMult:function(c){return this.clone()._matMult(c)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(c){return this.x===c.x&&this.y===c.y},dist:function(c){return Math.sqrt(this.distSqr(c))},distSqr:function(c){var l=c.x-this.x,d=c.y-this.y;return l*l+d*d},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith:function(c){return this.angleWithSep(c.x,c.y)},angleWithSep:function(c,l){return Math.atan2(this.x*l-this.y*c,this.x*c+this.y*l)},_matMult:function(c){var l=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=l,this},_add:function(c){return this.x+=c.x,this.y+=c.y,this},_sub:function(c){return this.x-=c.x,this.y-=c.y,this},_mult:function(c){return this.x*=c,this.y*=c,this},_div:function(c){return this.x/=c,this.y/=c,this},_multByPoint:function(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint:function(c){return this.x/=c.x,this.y/=c.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var c=this.y;return this.y=this.x,this.x=-c,this},_rotate:function(c){var l=Math.cos(c),d=Math.sin(c),m=d*this.x+l*this.y;return this.x=l*this.x-d*this.y,this.y=m,this},_rotateAround:function(c,l){var d=Math.cos(c),m=Math.sin(c),_=l.y+m*(this.x-l.x)+d*(this.y-l.y);return this.x=l.x+d*(this.x-l.x)-m*(this.y-l.y),this.y=_,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},g.convert=function(c){return c instanceof g?c:Array.isArray(c)?new g(c[0],c[1]):c};var v=h(p),x=S;function S(c,l,d,m){this.cx=3*c,this.bx=3*(d-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(m-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=l,this.p2x=d,this.p2y=m}S.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,l){if(l===void 0&&(l=1e-6),c<0)return 0;if(c>1)return 1;for(var d=c,m=0;m<8;m++){var _=this.sampleCurveX(d)-c;if(Math.abs(_)<l)return d;var k=this.sampleCurveDerivativeX(d);if(Math.abs(k)<1e-6)break;d-=_/k}var T=0,z=1;for(d=c,m=0;m<20&&(_=this.sampleCurveX(d),!(Math.abs(_-c)<l));m++)c>_?T=d:z=d,d=.5*(z-T)+T;return d},solve:function(c,l){return this.sampleCurveY(this.solveCurveX(c,l))}};var P=h(x);let N,M;function I(){return N==null&&(N=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),N}function A(){if(M==null&&(M=!1,I())){const l=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(l){for(let m=0;m<5*5;m++){const _=4*m;l.fillStyle=`rgb(${_},${_+1},${_+2})`,l.fillRect(m%5,Math.floor(m/5),1,1)}const d=l.getImageData(0,0,5,5).data;for(let m=0;m<5*5*4;m++)if(m%4!=3&&d[m]!==m){M=!0;break}}}return M||!1}function D(c,l,d,m){const _=new P(c,l,d,m);return k=>_.solve(k)}const j=D(.25,.1,.25,1);function V(c,l,d){return Math.min(d,Math.max(l,c))}function U(c,l,d){const m=d-l,_=((c-l)%m+m)%m+l;return _===l?d:_}function $(c,...l){for(const d of l)for(const m in d)c[m]=d[m];return c}let W=1;function X(c,l,d){const m={};for(const _ in c)m[_]=l.call(this,c[_],_,c);return m}function J(c,l,d){const m={};for(const _ in c)l.call(this,c[_],_,c)&&(m[_]=c[_]);return m}function Z(c){return Array.isArray(c)?c.map(Z):typeof c=="object"&&c?X(c,Z):c}const K={};function Y(c){K[c]||(typeof console<"u"&&console.warn(c),K[c]=!0)}function G(c,l,d){return(d.y-c.y)*(l.x-c.x)>(l.y-c.y)*(d.x-c.x)}function oe(c){return typeof WorkerGlobalScope<"u"&&c!==void 0&&c instanceof WorkerGlobalScope}let ie=null;function ce(c){return typeof ImageBitmap<"u"&&c instanceof ImageBitmap}const fe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function de(c,l,d,m,_){return s(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const k=new VideoFrame(c,{timestamp:0});try{const T=k==null?void 0:k.format;if(!T||!T.startsWith("BGR")&&!T.startsWith("RGB"))throw new Error(`Unrecognized format ${T}`);const z=T.startsWith("BGR"),L=new Uint8ClampedArray(m*_*4);if(yield k.copyTo(L,function(F,q,Q,ae,ue){const me=4*Math.max(-q,0),ve=(Math.max(0,Q)-Q)*ae*4+me,Ce=4*ae,Ie=Math.max(0,q),Je=Math.max(0,Q);return{rect:{x:Ie,y:Je,width:Math.min(F.width,q+ae)-Ie,height:Math.min(F.height,Q+ue)-Je},layout:[{offset:ve,stride:Ce}]}}(c,l,d,m,_)),z)for(let F=0;F<L.length;F+=4){const q=L[F];L[F]=L[F+2],L[F+2]=q}return L}finally{k.close()}})}let be,ge;const xe="AbortError";function Le(){return new Error(xe)}const Oe={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Fe(c){return Oe.REGISTERED_PROTOCOLS[c.substring(0,c.indexOf("://"))]}const et="global-dispatcher";class nt extends Error{constructor(l,d,m,_){super(`AJAXError: ${d} (${l}): ${m}`),this.status=l,this.statusText=d,this.url=m,this.body=_}}const mt=()=>oe(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,it=function(c,l){if(/:\/\//.test(c.url)&&!/^https?:|^file:/.test(c.url)){const m=Fe(c.url);if(m)return m(c,l);if(oe(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,targetMapId:et},l)}if(!(/^file:/.test(d=c.url)||/^file:/.test(mt())&&!/^\w+:/.test(d))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(m,_){return s(this,void 0,void 0,function*(){const k=new Request(m.url,{method:m.method||"GET",body:m.body,credentials:m.credentials,headers:m.headers,cache:m.cache,referrer:mt(),signal:_.signal});m.type!=="json"||k.headers.has("Accept")||k.headers.set("Accept","application/json");const T=yield fetch(k);if(!T.ok){const F=yield T.blob();throw new nt(T.status,T.statusText,m.url,F)}let z;z=m.type==="arrayBuffer"||m.type==="image"?T.arrayBuffer():m.type==="json"?T.json():T.text();const L=yield z;if(_.signal.aborted)throw Le();return{data:L,cacheControl:T.headers.get("Cache-Control"),expires:T.headers.get("Expires")}})}(c,l);if(oe(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,mustQueue:!0,targetMapId:et},l)}var d;return function(m,_){return new Promise((k,T)=>{var z;const L=new XMLHttpRequest;L.open(m.method||"GET",m.url,!0),m.type!=="arrayBuffer"&&m.type!=="image"||(L.responseType="arraybuffer");for(const F in m.headers)L.setRequestHeader(F,m.headers[F]);m.type==="json"&&(L.responseType="text",!((z=m.headers)===null||z===void 0)&&z.Accept||L.setRequestHeader("Accept","application/json")),L.withCredentials=m.credentials==="include",L.onerror=()=>{T(new Error(L.statusText))},L.onload=()=>{if(!_.signal.aborted)if((L.status>=200&&L.status<300||L.status===0)&&L.response!==null){let F=L.response;if(m.type==="json")try{F=JSON.parse(L.response)}catch(q){return void T(q)}k({data:F,cacheControl:L.getResponseHeader("Cache-Control"),expires:L.getResponseHeader("Expires")})}else{const F=new Blob([L.response],{type:L.getResponseHeader("Content-Type")});T(new nt(L.status,L.statusText,m.url,F))}},_.signal.addEventListener("abort",()=>{L.abort(),T(Le())}),L.send(m.body)})}(c,l)};function ze(c){if(!c||c.indexOf("://")<=0||c.indexOf("data:image/")===0||c.indexOf("blob:")===0)return!0;const l=new URL(c),d=window.location;return l.protocol===d.protocol&&l.host===d.host}function He(c,l,d){d[c]&&d[c].indexOf(l)!==-1||(d[c]=d[c]||[],d[c].push(l))}function We(c,l,d){if(d&&d[c]){const m=d[c].indexOf(l);m!==-1&&d[c].splice(m,1)}}class ot{constructor(l,d={}){$(this,d),this.type=l}}class xt extends ot{constructor(l,d={}){super("error",$({error:l},d))}}class Tt{on(l,d){return this._listeners=this._listeners||{},He(l,d,this._listeners),this}off(l,d){return We(l,d,this._listeners),We(l,d,this._oneTimeListeners),this}once(l,d){return d?(this._oneTimeListeners=this._oneTimeListeners||{},He(l,d,this._oneTimeListeners),this):new Promise(m=>this.once(l,m))}fire(l,d){typeof l=="string"&&(l=new ot(l,d||{}));const m=l.type;if(this.listens(m)){l.target=this;const _=this._listeners&&this._listeners[m]?this._listeners[m].slice():[];for(const z of _)z.call(this,l);const k=this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[];for(const z of k)We(m,z,this._oneTimeListeners),z.call(this,l);const T=this._eventedParent;T&&($(l,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),T.fire(l))}else l instanceof xt&&console.error(l.error);return this}listens(l){return this._listeners&&this._listeners[l]&&this._listeners[l].length>0||this._oneTimeListeners&&this._oneTimeListeners[l]&&this._oneTimeListeners[l].length>0||this._eventedParent&&this._eventedParent.listens(l)}setEventedParent(l,d){return this._eventedParent=l,this._eventedParentData=d,this}}var $e={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Xe=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Pe(c,l){const d={};for(const m in c)m!=="ref"&&(d[m]=c[m]);return Xe.forEach(m=>{m in l&&(d[m]=l[m])}),d}function Ye(c,l){if(Array.isArray(c)){if(!Array.isArray(l)||c.length!==l.length)return!1;for(let d=0;d<c.length;d++)if(!Ye(c[d],l[d]))return!1;return!0}if(typeof c=="object"&&c!==null&&l!==null){if(typeof l!="object"||Object.keys(c).length!==Object.keys(l).length)return!1;for(const d in c)if(!Ye(c[d],l[d]))return!1;return!0}return c===l}function at(c,l){c.push(l)}function bt(c,l,d){at(d,{command:"addSource",args:[c,l[c]]})}function Et(c,l,d){at(l,{command:"removeSource",args:[c]}),d[c]=!0}function Vt(c,l,d,m){Et(c,d,m),bt(c,l,d)}function Bt(c,l,d){let m;for(m in c[d])if(Object.prototype.hasOwnProperty.call(c[d],m)&&m!=="data"&&!Ye(c[d][m],l[d][m]))return!1;for(m in l[d])if(Object.prototype.hasOwnProperty.call(l[d],m)&&m!=="data"&&!Ye(c[d][m],l[d][m]))return!1;return!0}function Mt(c,l,d,m,_,k){c=c||{},l=l||{};for(const T in c)Object.prototype.hasOwnProperty.call(c,T)&&(Ye(c[T],l[T])||d.push({command:k,args:[m,T,l[T],_]}));for(const T in l)Object.prototype.hasOwnProperty.call(l,T)&&!Object.prototype.hasOwnProperty.call(c,T)&&(Ye(c[T],l[T])||d.push({command:k,args:[m,T,l[T],_]}))}function cr(c){return c.id}function ar(c,l){return c[l.id]=l,c}class ft{constructor(l,d,m,_){this.message=(l?`${l}: `:"")+m,_&&(this.identifier=_),d!=null&&d.__line__&&(this.line=d.__line__)}}function fr(c,...l){for(const d of l)for(const m in d)c[m]=d[m];return c}class Xt extends Error{constructor(l,d){super(d),this.message=d,this.key=l}}class kt{constructor(l,d=[]){this.parent=l,this.bindings={};for(const[m,_]of d)this.bindings[m]=_}concat(l){return new kt(this,l)}get(l){if(this.bindings[l])return this.bindings[l];if(this.parent)return this.parent.get(l);throw new Error(`${l} not found in scope.`)}has(l){return!!this.bindings[l]||!!this.parent&&this.parent.has(l)}}const dt={kind:"null"},le={kind:"number"},Be={kind:"string"},qe={kind:"boolean"},st={kind:"color"},ut={kind:"object"},vt={kind:"value"},gt={kind:"collator"},Ut={kind:"formatted"},Ot={kind:"padding"},Kt={kind:"resolvedImage"},we={kind:"variableAnchorOffsetCollection"};function ne(c,l){return{kind:"array",itemType:c,N:l}}function re(c){if(c.kind==="array"){const l=re(c.itemType);return typeof c.N=="number"?`array<${l}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${l}>`}return c.kind}const pe=[dt,le,Be,qe,st,Ut,ut,ne(vt),Ot,Kt,we];function _e(c,l){if(l.kind==="error")return null;if(c.kind==="array"){if(l.kind==="array"&&(l.N===0&&l.itemType.kind==="value"||!_e(c.itemType,l.itemType))&&(typeof c.N!="number"||c.N===l.N))return null}else{if(c.kind===l.kind)return null;if(c.kind==="value"){for(const d of pe)if(!_e(d,l))return null}}return`Expected ${re(c)} but found ${re(l)} instead.`}function Ne(c,l){return l.some(d=>d.kind===c.kind)}function De(c,l){return l.some(d=>d==="null"?c===null:d==="array"?Array.isArray(c):d==="object"?c&&!Array.isArray(c)&&typeof c=="object":d===typeof c)}function Ue(c,l){return c.kind==="array"&&l.kind==="array"?c.itemType.kind===l.itemType.kind&&typeof c.N=="number":c.kind===l.kind}const Te=.96422,rt=.82521,ht=4/29,Qe=6/29,wt=3*Qe*Qe,At=Qe*Qe*Qe,Ft=Math.PI/180,yr=180/Math.PI;function ir(c){return(c%=360)<0&&(c+=360),c}function _r([c,l,d,m]){let _,k;const T=Tr((.2225045*(c=pr(c))+.7168786*(l=pr(l))+.0606169*(d=pr(d)))/1);c===l&&l===d?_=k=T:(_=Tr((.4360747*c+.3850649*l+.1430804*d)/Te),k=Tr((.0139322*c+.0971045*l+.7141733*d)/rt));const z=116*T-16;return[z<0?0:z,500*(_-T),200*(T-k),m]}function pr(c){return c<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function Tr(c){return c>At?Math.pow(c,1/3):c/wt+ht}function wr([c,l,d,m]){let _=(c+16)/116,k=isNaN(l)?_:_+l/500,T=isNaN(d)?_:_-d/200;return _=1*kr(_),k=Te*kr(k),T=rt*kr(T),[sr(3.1338561*k-1.6168667*_-.4906146*T),sr(-.9787684*k+1.9161415*_+.033454*T),sr(.0719453*k-.2289914*_+1.4052427*T),m]}function sr(c){return(c=c<=.00304?12.92*c:1.055*Math.pow(c,1/2.4)-.055)<0?0:c>1?1:c}function kr(c){return c>Qe?c*c*c:wt*(c-ht)}function Er(c){return parseInt(c.padEnd(2,c),16)/255}function cn(c,l){return gn(l?c/100:c,0,1)}function gn(c,l,d){return Math.min(Math.max(l,c),d)}function wn(c){return!c.some(Number.isNaN)}const oi={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Mr{constructor(l,d,m,_=1,k=!0){this.r=l,this.g=d,this.b=m,this.a=_,k||(this.r*=_,this.g*=_,this.b*=_,_||this.overwriteGetter("rgb",[l,d,m,_]))}static parse(l){if(l instanceof Mr)return l;if(typeof l!="string")return;const d=function(m){if((m=m.toLowerCase().trim())==="transparent")return[0,0,0,0];const _=oi[m];if(_){const[T,z,L]=_;return[T/255,z/255,L/255,1]}if(m.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(m)){const T=m.length<6?1:2;let z=1;return[Er(m.slice(z,z+=T)),Er(m.slice(z,z+=T)),Er(m.slice(z,z+=T)),Er(m.slice(z,z+T)||"ff")]}if(m.startsWith("rgb")){const T=m.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(T){const[z,L,F,q,Q,ae,ue,me,ve,Ce,Ie,Je]=T,je=[q||" ",ue||" ",Ce].join("");if(je==="  "||je==="  /"||je===",,"||je===",,,"){const Ze=[F,ae,ve].join(""),ct=Ze==="%%%"?100:Ze===""?255:0;if(ct){const _t=[gn(+L/ct,0,1),gn(+Q/ct,0,1),gn(+me/ct,0,1),Ie?cn(+Ie,Je):1];if(wn(_t))return _t}}return}}const k=m.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(k){const[T,z,L,F,q,Q,ae,ue,me]=k,ve=[L||" ",q||" ",ae].join("");if(ve==="  "||ve==="  /"||ve===",,"||ve===",,,"){const Ce=[+z,gn(+F,0,100),gn(+Q,0,100),ue?cn(+ue,me):1];if(wn(Ce))return function([Ie,Je,je,Ze]){function ct(_t){const $t=(_t+Ie/30)%12,lr=Je*Math.min(je,1-je);return je-lr*Math.max(-1,Math.min($t-3,9-$t,1))}return Ie=ir(Ie),Je/=100,je/=100,[ct(0),ct(8),ct(4),Ze]}(Ce)}}}(l);return d?new Mr(...d,!1):void 0}get rgb(){const{r:l,g:d,b:m,a:_}=this,k=_||1/0;return this.overwriteGetter("rgb",[l/k,d/k,m/k,_])}get hcl(){return this.overwriteGetter("hcl",function(l){const[d,m,_,k]=_r(l),T=Math.sqrt(m*m+_*_);return[Math.round(1e4*T)?ir(Math.atan2(_,m)*yr):NaN,T,d,k]}(this.rgb))}get lab(){return this.overwriteGetter("lab",_r(this.rgb))}overwriteGetter(l,d){return Object.defineProperty(this,l,{value:d}),d}toString(){const[l,d,m,_]=this.rgb;return`rgba(${[l,d,m].map(k=>Math.round(255*k)).join(",")},${_})`}}Mr.black=new Mr(0,0,0,1),Mr.white=new Mr(1,1,1,1),Mr.transparent=new Mr(0,0,0,0),Mr.red=new Mr(1,0,0,1);class Gi{constructor(l,d,m){this.sensitivity=l?d?"variant":"case":d?"accent":"base",this.locale=m,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(l,d){return this.collator.compare(l,d)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Wi{constructor(l,d,m,_,k){this.text=l,this.image=d,this.scale=m,this.fontStack=_,this.textColor=k}}class lt{constructor(l){this.sections=l}static fromString(l){return new lt([new Wi(l,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(l=>l.text.length!==0||l.image&&l.image.name.length!==0)}static factory(l){return l instanceof lt?l:lt.fromString(l)}toString(){return this.sections.length===0?"":this.sections.map(l=>l.text).join("")}}class or{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof or)return l;if(typeof l=="number")return new or([l,l,l,l]);if(Array.isArray(l)&&!(l.length<1||l.length>4)){for(const d of l)if(typeof d!="number")return;switch(l.length){case 1:l=[l[0],l[0],l[0],l[0]];break;case 2:l=[l[0],l[1],l[0],l[1]];break;case 3:l=[l[0],l[1],l[2],l[1]]}return new or(l)}}toString(){return JSON.stringify(this.values)}}const Fr=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Gr{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof Gr)return l;if(Array.isArray(l)&&!(l.length<1)&&l.length%2==0){for(let d=0;d<l.length;d+=2){const m=l[d],_=l[d+1];if(typeof m!="string"||!Fr.has(m)||!Array.isArray(_)||_.length!==2||typeof _[0]!="number"||typeof _[1]!="number")return}return new Gr(l)}}toString(){return JSON.stringify(this.values)}}class vn{constructor(l){this.name=l.name,this.available=l.available}toString(){return this.name}static fromString(l){return l?new vn({name:l,available:!1}):null}}function Zn(c,l,d,m){return typeof c=="number"&&c>=0&&c<=255&&typeof l=="number"&&l>=0&&l<=255&&typeof d=="number"&&d>=0&&d<=255?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:`Invalid rgba value [${[c,l,d,m].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof m=="number"?[c,l,d,m]:[c,l,d]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Fn(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof Mr||c instanceof Gi||c instanceof lt||c instanceof or||c instanceof Gr||c instanceof vn)return!0;if(Array.isArray(c)){for(const l of c)if(!Fn(l))return!1;return!0}if(typeof c=="object"){for(const l in c)if(!Fn(c[l]))return!1;return!0}return!1}function jr(c){if(c===null)return dt;if(typeof c=="string")return Be;if(typeof c=="boolean")return qe;if(typeof c=="number")return le;if(c instanceof Mr)return st;if(c instanceof Gi)return gt;if(c instanceof lt)return Ut;if(c instanceof or)return Ot;if(c instanceof Gr)return we;if(c instanceof vn)return Kt;if(Array.isArray(c)){const l=c.length;let d;for(const m of c){const _=jr(m);if(d){if(d===_)continue;d=vt;break}d=_}return ne(d||vt,l)}return ut}function ps(c){const l=typeof c;return c===null?"":l==="string"||l==="number"||l==="boolean"?String(c):c instanceof Mr||c instanceof lt||c instanceof or||c instanceof Gr||c instanceof vn?c.toString():JSON.stringify(c)}class Na{constructor(l,d){this.type=l,this.value=d}static parse(l,d){if(l.length!==2)return d.error(`'literal' expression requires exactly one argument, but found ${l.length-1} instead.`);if(!Fn(l[1]))return d.error("invalid value");const m=l[1];let _=jr(m);const k=d.expectedType;return _.kind!=="array"||_.N!==0||!k||k.kind!=="array"||typeof k.N=="number"&&k.N!==0||(_=k),new Na(_,m)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Qr{constructor(l){this.name="ExpressionEvaluationError",this.message=l}toJSON(){return this.message}}const aa={string:Be,number:le,boolean:qe,object:ut};class Wa{constructor(l,d){this.type=l,this.args=d}static parse(l,d){if(l.length<2)return d.error("Expected at least one argument.");let m,_=1;const k=l[0];if(k==="array"){let z,L;if(l.length>2){const F=l[1];if(typeof F!="string"||!(F in aa)||F==="object")return d.error('The item type argument of "array" must be one of string, number, boolean',1);z=aa[F],_++}else z=vt;if(l.length>3){if(l[2]!==null&&(typeof l[2]!="number"||l[2]<0||l[2]!==Math.floor(l[2])))return d.error('The length argument to "array" must be a positive integer literal',2);L=l[2],_++}m=ne(z,L)}else{if(!aa[k])throw new Error(`Types doesn't contain name = ${k}`);m=aa[k]}const T=[];for(;_<l.length;_++){const z=d.parse(l[_],_,vt);if(!z)return null;T.push(z)}return new Wa(m,T)}evaluate(l){for(let d=0;d<this.args.length;d++){const m=this.args[d].evaluate(l);if(!_e(this.type,jr(m)))return m;if(d===this.args.length-1)throw new Qr(`Expected value to be of type ${re(this.type)}, but found ${re(jr(m))} instead.`)}throw new Error}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}const zc={"to-boolean":qe,"to-color":st,"to-number":le,"to-string":Be};class Za{constructor(l,d){this.type=l,this.args=d}static parse(l,d){if(l.length<2)return d.error("Expected at least one argument.");const m=l[0];if(!zc[m])throw new Error(`Can't parse ${m} as it is not part of the known types`);if((m==="to-boolean"||m==="to-string")&&l.length!==2)return d.error("Expected one argument.");const _=zc[m],k=[];for(let T=1;T<l.length;T++){const z=d.parse(l[T],T,vt);if(!z)return null;k.push(z)}return new Za(_,k)}evaluate(l){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(l);case"color":{let d,m;for(const _ of this.args){if(d=_.evaluate(l),m=null,d instanceof Mr)return d;if(typeof d=="string"){const k=l.parseColor(d);if(k)return k}else if(Array.isArray(d)&&(m=d.length<3||d.length>4?`Invalid rbga value ${JSON.stringify(d)}: expected an array containing either three or four numeric values.`:Zn(d[0],d[1],d[2],d[3]),!m))return new Mr(d[0]/255,d[1]/255,d[2]/255,d[3])}throw new Qr(m||`Could not parse color from value '${typeof d=="string"?d:JSON.stringify(d)}'`)}case"padding":{let d;for(const m of this.args){d=m.evaluate(l);const _=or.parse(d);if(_)return _}throw new Qr(`Could not parse padding from value '${typeof d=="string"?d:JSON.stringify(d)}'`)}case"variableAnchorOffsetCollection":{let d;for(const m of this.args){d=m.evaluate(l);const _=Gr.parse(d);if(_)return _}throw new Qr(`Could not parse variableAnchorOffsetCollection from value '${typeof d=="string"?d:JSON.stringify(d)}'`)}case"number":{let d=null;for(const m of this.args){if(d=m.evaluate(l),d===null)return 0;const _=Number(d);if(!isNaN(_))return _}throw new Qr(`Could not convert ${JSON.stringify(d)} to number.`)}case"formatted":return lt.fromString(ps(this.args[0].evaluate(l)));case"resolvedImage":return vn.fromString(ps(this.args[0].evaluate(l)));default:return ps(this.args[0].evaluate(l))}}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}const mx=["Unknown","Point","LineString","Polygon"];class Rc{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?mx[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(l){let d=this._parseColorCache[l];return d||(d=this._parseColorCache[l]=Mr.parse(l)),d}}class co{constructor(l,d,m=[],_,k=new kt,T=[]){this.registry=l,this.path=m,this.key=m.map(z=>`[${z}]`).join(""),this.scope=k,this.errors=T,this.expectedType=_,this._isConstant=d}parse(l,d,m,_,k={}){return d?this.concat(d,m,_)._parse(l,k):this._parse(l,k)}_parse(l,d){function m(_,k,T){return T==="assert"?new Wa(k,[_]):T==="coerce"?new Za(k,[_]):_}if(l!==null&&typeof l!="string"&&typeof l!="boolean"&&typeof l!="number"||(l=["literal",l]),Array.isArray(l)){if(l.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const _=l[0];if(typeof _!="string")return this.error(`Expression name must be a string, but found ${typeof _} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const k=this.registry[_];if(k){let T=k.parse(l,this);if(!T)return null;if(this.expectedType){const z=this.expectedType,L=T.type;if(z.kind!=="string"&&z.kind!=="number"&&z.kind!=="boolean"&&z.kind!=="object"&&z.kind!=="array"||L.kind!=="value")if(z.kind!=="color"&&z.kind!=="formatted"&&z.kind!=="resolvedImage"||L.kind!=="value"&&L.kind!=="string")if(z.kind!=="padding"||L.kind!=="value"&&L.kind!=="number"&&L.kind!=="array")if(z.kind!=="variableAnchorOffsetCollection"||L.kind!=="value"&&L.kind!=="array"){if(this.checkSubtype(z,L))return null}else T=m(T,z,d.typeAnnotation||"coerce");else T=m(T,z,d.typeAnnotation||"coerce");else T=m(T,z,d.typeAnnotation||"coerce");else T=m(T,z,d.typeAnnotation||"assert")}if(!(T instanceof Na)&&T.type.kind!=="resolvedImage"&&this._isConstant(T)){const z=new Rc;try{T=new Na(T.type,T.evaluate(z))}catch(L){return this.error(L.message),null}}return T}return this.error(`Unknown expression "${_}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(l===void 0?"'undefined' value invalid. Use null instead.":typeof l=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof l} instead.`)}concat(l,d,m){const _=typeof l=="number"?this.path.concat(l):this.path,k=m?this.scope.concat(m):this.scope;return new co(this.registry,this._isConstant,_,d||null,k,this.errors)}error(l,...d){const m=`${this.key}${d.map(_=>`[${_}]`).join("")}`;this.errors.push(new Xt(m,l))}checkSubtype(l,d){const m=_e(l,d);return m&&this.error(m),m}}class Os{constructor(l,d){this.type=d.type,this.bindings=[].concat(l),this.result=d}evaluate(l){return this.result.evaluate(l)}eachChild(l){for(const d of this.bindings)l(d[1]);l(this.result)}static parse(l,d){if(l.length<4)return d.error(`Expected at least 3 arguments, but found ${l.length-1} instead.`);const m=[];for(let k=1;k<l.length-1;k+=2){const T=l[k];if(typeof T!="string")return d.error(`Expected string, but found ${typeof T} instead.`,k);if(/[^a-zA-Z0-9_]/.test(T))return d.error("Variable names must contain only alphanumeric characters or '_'.",k);const z=d.parse(l[k+1],k+1);if(!z)return null;m.push([T,z])}const _=d.parse(l[l.length-1],l.length-1,d.expectedType,m);return _?new Os(m,_):null}outputDefined(){return this.result.outputDefined()}}class Br{constructor(l,d){this.type=d.type,this.name=l,this.boundExpression=d}static parse(l,d){if(l.length!==2||typeof l[1]!="string")return d.error("'var' expression requires exactly one string literal argument.");const m=l[1];return d.scope.has(m)?new Br(m,d.scope.get(m)):d.error(`Unknown variable "${m}". Make sure "${m}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(l){return this.boundExpression.evaluate(l)}eachChild(){}outputDefined(){return!1}}class Gh{constructor(l,d,m){this.type=l,this.index=d,this.input=m}static parse(l,d){if(l.length!==3)return d.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const m=d.parse(l[1],1,le),_=d.parse(l[2],2,ne(d.expectedType||vt));return m&&_?new Gh(_.type.itemType,m,_):null}evaluate(l){const d=this.index.evaluate(l),m=this.input.evaluate(l);if(d<0)throw new Qr(`Array index out of bounds: ${d} < 0.`);if(d>=m.length)throw new Qr(`Array index out of bounds: ${d} > ${m.length-1}.`);if(d!==Math.floor(d))throw new Qr(`Array index must be an integer, but found ${d} instead.`);return m[d]}eachChild(l){l(this.index),l(this.input)}outputDefined(){return!1}}class Wh{constructor(l,d){this.type=qe,this.needle=l,this.haystack=d}static parse(l,d){if(l.length!==3)return d.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const m=d.parse(l[1],1,vt),_=d.parse(l[2],2,vt);return m&&_?Ne(m.type,[qe,Be,le,dt,vt])?new Wh(m,_):d.error(`Expected first argument to be of type boolean, string, number or null, but found ${re(m.type)} instead`):null}evaluate(l){const d=this.needle.evaluate(l),m=this.haystack.evaluate(l);if(!m)return!1;if(!De(d,["boolean","string","number","null"]))throw new Qr(`Expected first argument to be of type boolean, string, number or null, but found ${re(jr(d))} instead.`);if(!De(m,["string","array"]))throw new Qr(`Expected second argument to be of type array or string, but found ${re(jr(m))} instead.`);return m.indexOf(d)>=0}eachChild(l){l(this.needle),l(this.haystack)}outputDefined(){return!0}}class Ko{constructor(l,d,m){this.type=le,this.needle=l,this.haystack=d,this.fromIndex=m}static parse(l,d){if(l.length<=2||l.length>=5)return d.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);const m=d.parse(l[1],1,vt),_=d.parse(l[2],2,vt);if(!m||!_)return null;if(!Ne(m.type,[qe,Be,le,dt,vt]))return d.error(`Expected first argument to be of type boolean, string, number or null, but found ${re(m.type)} instead`);if(l.length===4){const k=d.parse(l[3],3,le);return k?new Ko(m,_,k):null}return new Ko(m,_)}evaluate(l){const d=this.needle.evaluate(l),m=this.haystack.evaluate(l);if(!De(d,["boolean","string","number","null"]))throw new Qr(`Expected first argument to be of type boolean, string, number or null, but found ${re(jr(d))} instead.`);let _;if(this.fromIndex&&(_=this.fromIndex.evaluate(l)),De(m,["string"])){const k=m.indexOf(d,_);return k===-1?-1:[...m.slice(0,k)].length}if(De(m,["array"]))return m.indexOf(d,_);throw new Qr(`Expected second argument to be of type array or string, but found ${re(jr(m))} instead.`)}eachChild(l){l(this.needle),l(this.haystack),this.fromIndex&&l(this.fromIndex)}outputDefined(){return!1}}class Zh{constructor(l,d,m,_,k,T){this.inputType=l,this.type=d,this.input=m,this.cases=_,this.outputs=k,this.otherwise=T}static parse(l,d){if(l.length<5)return d.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if(l.length%2!=1)return d.error("Expected an even number of arguments.");let m,_;d.expectedType&&d.expectedType.kind!=="value"&&(_=d.expectedType);const k={},T=[];for(let F=2;F<l.length-1;F+=2){let q=l[F];const Q=l[F+1];Array.isArray(q)||(q=[q]);const ae=d.concat(F);if(q.length===0)return ae.error("Expected at least one branch label.");for(const me of q){if(typeof me!="number"&&typeof me!="string")return ae.error("Branch labels must be numbers or strings.");if(typeof me=="number"&&Math.abs(me)>Number.MAX_SAFE_INTEGER)return ae.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof me=="number"&&Math.floor(me)!==me)return ae.error("Numeric branch labels must be integer values.");if(m){if(ae.checkSubtype(m,jr(me)))return null}else m=jr(me);if(k[String(me)]!==void 0)return ae.error("Branch labels must be unique.");k[String(me)]=T.length}const ue=d.parse(Q,F,_);if(!ue)return null;_=_||ue.type,T.push(ue)}const z=d.parse(l[1],1,vt);if(!z)return null;const L=d.parse(l[l.length-1],l.length-1,_);return L?z.type.kind!=="value"&&d.concat(1).checkSubtype(m,z.type)?null:new Zh(m,_,z,k,T,L):null}evaluate(l){const d=this.input.evaluate(l);return(jr(d)===this.inputType&&this.outputs[this.cases[d]]||this.otherwise).evaluate(l)}eachChild(l){l(this.input),this.outputs.forEach(l),l(this.otherwise)}outputDefined(){return this.outputs.every(l=>l.outputDefined())&&this.otherwise.outputDefined()}}class Lc{constructor(l,d,m){this.type=l,this.branches=d,this.otherwise=m}static parse(l,d){if(l.length<4)return d.error(`Expected at least 3 arguments, but found only ${l.length-1}.`);if(l.length%2!=0)return d.error("Expected an odd number of arguments.");let m;d.expectedType&&d.expectedType.kind!=="value"&&(m=d.expectedType);const _=[];for(let T=1;T<l.length-1;T+=2){const z=d.parse(l[T],T,qe);if(!z)return null;const L=d.parse(l[T+1],T+1,m);if(!L)return null;_.push([z,L]),m=m||L.type}const k=d.parse(l[l.length-1],l.length-1,m);if(!k)return null;if(!m)throw new Error("Can't infer output type");return new Lc(m,_,k)}evaluate(l){for(const[d,m]of this.branches)if(d.evaluate(l))return m.evaluate(l);return this.otherwise.evaluate(l)}eachChild(l){for(const[d,m]of this.branches)l(d),l(m);l(this.otherwise)}outputDefined(){return this.branches.every(([l,d])=>d.outputDefined())&&this.otherwise.outputDefined()}}class bu{constructor(l,d,m,_){this.type=l,this.input=d,this.beginIndex=m,this.endIndex=_}static parse(l,d){if(l.length<=2||l.length>=5)return d.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);const m=d.parse(l[1],1,vt),_=d.parse(l[2],2,le);if(!m||!_)return null;if(!Ne(m.type,[ne(vt),Be,vt]))return d.error(`Expected first argument to be of type array or string, but found ${re(m.type)} instead`);if(l.length===4){const k=d.parse(l[3],3,le);return k?new bu(m.type,m,_,k):null}return new bu(m.type,m,_)}evaluate(l){const d=this.input.evaluate(l),m=this.beginIndex.evaluate(l);let _;if(this.endIndex&&(_=this.endIndex.evaluate(l)),De(d,["string"]))return[...d].slice(m,_).join("");if(De(d,["array"]))return d.slice(m,_);throw new Qr(`Expected first argument to be of type array or string, but found ${re(jr(d))} instead.`)}eachChild(l){l(this.input),l(this.beginIndex),this.endIndex&&l(this.endIndex)}outputDefined(){return!1}}function Bc(c,l){const d=c.length-1;let m,_,k=0,T=d,z=0;for(;k<=T;)if(z=Math.floor((k+T)/2),m=c[z],_=c[z+1],m<=l){if(z===d||l<_)return z;k=z+1}else{if(!(m>l))throw new Qr("Input is not a number.");T=z-1}return 0}class Yo{constructor(l,d,m){this.type=l,this.input=d,this.labels=[],this.outputs=[];for(const[_,k]of m)this.labels.push(_),this.outputs.push(k)}static parse(l,d){if(l.length-1<4)return d.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return d.error("Expected an even number of arguments.");const m=d.parse(l[1],1,le);if(!m)return null;const _=[];let k=null;d.expectedType&&d.expectedType.kind!=="value"&&(k=d.expectedType);for(let T=1;T<l.length;T+=2){const z=T===1?-1/0:l[T],L=l[T+1],F=T,q=T+1;if(typeof z!="number")return d.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(_.length&&_[_.length-1][0]>=z)return d.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',F);const Q=d.parse(L,q,k);if(!Q)return null;k=k||Q.type,_.push([z,Q])}return new Yo(k,m,_)}evaluate(l){const d=this.labels,m=this.outputs;if(d.length===1)return m[0].evaluate(l);const _=this.input.evaluate(l);if(_<=d[0])return m[0].evaluate(l);const k=d.length;return _>=d[k-1]?m[k-1].evaluate(l):m[Bc(d,_)].evaluate(l)}eachChild(l){l(this.input);for(const d of this.outputs)l(d)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}}function rg(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var gx=ng;function ng(c,l,d,m){this.cx=3*c,this.bx=3*(d-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(m-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=l,this.p2x=d,this.p2y=m}ng.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,l){if(l===void 0&&(l=1e-6),c<0)return 0;if(c>1)return 1;for(var d=c,m=0;m<8;m++){var _=this.sampleCurveX(d)-c;if(Math.abs(_)<l)return d;var k=this.sampleCurveDerivativeX(d);if(Math.abs(k)<1e-6)break;d-=_/k}var T=0,z=1;for(d=c,m=0;m<20&&(_=this.sampleCurveX(d),!(Math.abs(_-c)<l));m++)c>_?T=d:z=d,d=.5*(z-T)+T;return d},solve:function(c,l){return this.sampleCurveY(this.solveCurveX(c,l))}};var vx=rg(gx);function ho(c,l,d){return c+d*(l-c)}function _u(c,l,d){return c.map((m,_)=>ho(m,l[_],d))}const Ma={number:ho,color:function(c,l,d,m="rgb"){switch(m){case"rgb":{const[_,k,T,z]=_u(c.rgb,l.rgb,d);return new Mr(_,k,T,z,!1)}case"hcl":{const[_,k,T,z]=c.hcl,[L,F,q,Q]=l.hcl;let ae,ue;if(isNaN(_)||isNaN(L))isNaN(_)?isNaN(L)?ae=NaN:(ae=L,T!==1&&T!==0||(ue=F)):(ae=_,q!==1&&q!==0||(ue=k));else{let Je=L-_;L>_&&Je>180?Je-=360:L<_&&_-L>180&&(Je+=360),ae=_+d*Je}const[me,ve,Ce,Ie]=function([Je,je,Ze,ct]){return Je=isNaN(Je)?0:Je*Ft,wr([Ze,Math.cos(Je)*je,Math.sin(Je)*je,ct])}([ae,ue??ho(k,F,d),ho(T,q,d),ho(z,Q,d)]);return new Mr(me,ve,Ce,Ie,!1)}case"lab":{const[_,k,T,z]=wr(_u(c.lab,l.lab,d));return new Mr(_,k,T,z,!1)}}},array:_u,padding:function(c,l,d){return new or(_u(c.values,l.values,d))},variableAnchorOffsetCollection:function(c,l,d){const m=c.values,_=l.values;if(m.length!==_.length)throw new Qr(`Cannot interpolate values of different length. from: ${c.toString()}, to: ${l.toString()}`);const k=[];for(let T=0;T<m.length;T+=2){if(m[T]!==_[T])throw new Qr(`Cannot interpolate values containing mismatched anchors. from[${T}]: ${m[T]}, to[${T}]: ${_[T]}`);k.push(m[T]);const[z,L]=m[T+1],[F,q]=_[T+1];k.push([ho(z,F,d),ho(L,q,d)])}return new Gr(k)}};class Da{constructor(l,d,m,_,k){this.type=l,this.operator=d,this.interpolation=m,this.input=_,this.labels=[],this.outputs=[];for(const[T,z]of k)this.labels.push(T),this.outputs.push(z)}static interpolationFactor(l,d,m,_){let k=0;if(l.name==="exponential")k=jc(d,l.base,m,_);else if(l.name==="linear")k=jc(d,1,m,_);else if(l.name==="cubic-bezier"){const T=l.controlPoints;k=new vx(T[0],T[1],T[2],T[3]).solve(jc(d,1,m,_))}return k}static parse(l,d){let[m,_,k,...T]=l;if(!Array.isArray(_)||_.length===0)return d.error("Expected an interpolation type expression.",1);if(_[0]==="linear")_={name:"linear"};else if(_[0]==="exponential"){const F=_[1];if(typeof F!="number")return d.error("Exponential interpolation requires a numeric base.",1,1);_={name:"exponential",base:F}}else{if(_[0]!=="cubic-bezier")return d.error(`Unknown interpolation type ${String(_[0])}`,1,0);{const F=_.slice(1);if(F.length!==4||F.some(q=>typeof q!="number"||q<0||q>1))return d.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);_={name:"cubic-bezier",controlPoints:F}}}if(l.length-1<4)return d.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return d.error("Expected an even number of arguments.");if(k=d.parse(k,2,le),!k)return null;const z=[];let L=null;m==="interpolate-hcl"||m==="interpolate-lab"?L=st:d.expectedType&&d.expectedType.kind!=="value"&&(L=d.expectedType);for(let F=0;F<T.length;F+=2){const q=T[F],Q=T[F+1],ae=F+3,ue=F+4;if(typeof q!="number")return d.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ae);if(z.length&&z[z.length-1][0]>=q)return d.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ae);const me=d.parse(Q,ue,L);if(!me)return null;L=L||me.type,z.push([q,me])}return Ue(L,le)||Ue(L,st)||Ue(L,Ot)||Ue(L,we)||Ue(L,ne(le))?new Da(L,m,_,k,z):d.error(`Type ${re(L)} is not interpolatable.`)}evaluate(l){const d=this.labels,m=this.outputs;if(d.length===1)return m[0].evaluate(l);const _=this.input.evaluate(l);if(_<=d[0])return m[0].evaluate(l);const k=d.length;if(_>=d[k-1])return m[k-1].evaluate(l);const T=Bc(d,_),z=Da.interpolationFactor(this.interpolation,_,d[T],d[T+1]),L=m[T].evaluate(l),F=m[T+1].evaluate(l);switch(this.operator){case"interpolate":return Ma[this.type.kind](L,F,z);case"interpolate-hcl":return Ma.color(L,F,z,"hcl");case"interpolate-lab":return Ma.color(L,F,z,"lab")}}eachChild(l){l(this.input);for(const d of this.outputs)l(d)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}}function jc(c,l,d,m){const _=m-d,k=c-d;return _===0?0:l===1?k/_:(Math.pow(l,k)-1)/(Math.pow(l,_)-1)}class Oc{constructor(l,d){this.type=l,this.args=d}static parse(l,d){if(l.length<2)return d.error("Expectected at least one argument.");let m=null;const _=d.expectedType;_&&_.kind!=="value"&&(m=_);const k=[];for(const z of l.slice(1)){const L=d.parse(z,1+k.length,m,void 0,{typeAnnotation:"omit"});if(!L)return null;m=m||L.type,k.push(L)}if(!m)throw new Error("No output type");const T=_&&k.some(z=>_e(_,z.type));return new Oc(T?vt:m,k)}evaluate(l){let d,m=null,_=0;for(const k of this.args)if(_++,m=k.evaluate(l),m&&m instanceof vn&&!m.available&&(d||(d=m.name),m=null,_===this.args.length&&(m=d)),m!==null)break;return m}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}function Fc(c,l){return c==="=="||c==="!="?l.kind==="boolean"||l.kind==="string"||l.kind==="number"||l.kind==="null"||l.kind==="value":l.kind==="string"||l.kind==="number"||l.kind==="value"}function ag(c,l,d,m){return m.compare(l,d)===0}function Jo(c,l,d){const m=c!=="=="&&c!=="!=";return class XD{constructor(k,T,z){this.type=qe,this.lhs=k,this.rhs=T,this.collator=z,this.hasUntypedArgument=k.type.kind==="value"||T.type.kind==="value"}static parse(k,T){if(k.length!==3&&k.length!==4)return T.error("Expected two or three arguments.");const z=k[0];let L=T.parse(k[1],1,vt);if(!L)return null;if(!Fc(z,L.type))return T.concat(1).error(`"${z}" comparisons are not supported for type '${re(L.type)}'.`);let F=T.parse(k[2],2,vt);if(!F)return null;if(!Fc(z,F.type))return T.concat(2).error(`"${z}" comparisons are not supported for type '${re(F.type)}'.`);if(L.type.kind!==F.type.kind&&L.type.kind!=="value"&&F.type.kind!=="value")return T.error(`Cannot compare types '${re(L.type)}' and '${re(F.type)}'.`);m&&(L.type.kind==="value"&&F.type.kind!=="value"?L=new Wa(F.type,[L]):L.type.kind!=="value"&&F.type.kind==="value"&&(F=new Wa(L.type,[F])));let q=null;if(k.length===4){if(L.type.kind!=="string"&&F.type.kind!=="string"&&L.type.kind!=="value"&&F.type.kind!=="value")return T.error("Cannot use collator to compare non-string types.");if(q=T.parse(k[3],3,gt),!q)return null}return new XD(L,F,q)}evaluate(k){const T=this.lhs.evaluate(k),z=this.rhs.evaluate(k);if(m&&this.hasUntypedArgument){const L=jr(T),F=jr(z);if(L.kind!==F.kind||L.kind!=="string"&&L.kind!=="number")throw new Qr(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${L.kind}, ${F.kind}) instead.`)}if(this.collator&&!m&&this.hasUntypedArgument){const L=jr(T),F=jr(z);if(L.kind!=="string"||F.kind!=="string")return l(k,T,z)}return this.collator?d(k,T,z,this.collator.evaluate(k)):l(k,T,z)}eachChild(k){k(this.lhs),k(this.rhs),this.collator&&k(this.collator)}outputDefined(){return!0}}}const yx=Jo("==",function(c,l,d){return l===d},ag),ig=Jo("!=",function(c,l,d){return l!==d},function(c,l,d,m){return!ag(0,l,d,m)}),sg=Jo("<",function(c,l,d){return l<d},function(c,l,d,m){return m.compare(l,d)<0}),xx=Jo(">",function(c,l,d){return l>d},function(c,l,d,m){return m.compare(l,d)>0}),bx=Jo("<=",function(c,l,d){return l<=d},function(c,l,d,m){return m.compare(l,d)<=0}),og=Jo(">=",function(c,l,d){return l>=d},function(c,l,d,m){return m.compare(l,d)>=0});class wu{constructor(l,d,m){this.type=gt,this.locale=m,this.caseSensitive=l,this.diacriticSensitive=d}static parse(l,d){if(l.length!==2)return d.error("Expected one argument.");const m=l[1];if(typeof m!="object"||Array.isArray(m))return d.error("Collator options argument must be an object.");const _=d.parse(m["case-sensitive"]!==void 0&&m["case-sensitive"],1,qe);if(!_)return null;const k=d.parse(m["diacritic-sensitive"]!==void 0&&m["diacritic-sensitive"],1,qe);if(!k)return null;let T=null;return m.locale&&(T=d.parse(m.locale,1,Be),!T)?null:new wu(_,k,T)}evaluate(l){return new Gi(this.caseSensitive.evaluate(l),this.diacriticSensitive.evaluate(l),this.locale?this.locale.evaluate(l):null)}eachChild(l){l(this.caseSensitive),l(this.diacriticSensitive),this.locale&&l(this.locale)}outputDefined(){return!1}}class Xh{constructor(l,d,m,_,k){this.type=Be,this.number=l,this.locale=d,this.currency=m,this.minFractionDigits=_,this.maxFractionDigits=k}static parse(l,d){if(l.length!==3)return d.error("Expected two arguments.");const m=d.parse(l[1],1,le);if(!m)return null;const _=l[2];if(typeof _!="object"||Array.isArray(_))return d.error("NumberFormat options argument must be an object.");let k=null;if(_.locale&&(k=d.parse(_.locale,1,Be),!k))return null;let T=null;if(_.currency&&(T=d.parse(_.currency,1,Be),!T))return null;let z=null;if(_["min-fraction-digits"]&&(z=d.parse(_["min-fraction-digits"],1,le),!z))return null;let L=null;return _["max-fraction-digits"]&&(L=d.parse(_["max-fraction-digits"],1,le),!L)?null:new Xh(m,k,T,z,L)}evaluate(l){return new Intl.NumberFormat(this.locale?this.locale.evaluate(l):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(l):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(l):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(l):void 0}).format(this.number.evaluate(l))}eachChild(l){l(this.number),this.locale&&l(this.locale),this.currency&&l(this.currency),this.minFractionDigits&&l(this.minFractionDigits),this.maxFractionDigits&&l(this.maxFractionDigits)}outputDefined(){return!1}}class $c{constructor(l){this.type=Ut,this.sections=l}static parse(l,d){if(l.length<2)return d.error("Expected at least one argument.");const m=l[1];if(!Array.isArray(m)&&typeof m=="object")return d.error("First argument must be an image or text section.");const _=[];let k=!1;for(let T=1;T<=l.length-1;++T){const z=l[T];if(k&&typeof z=="object"&&!Array.isArray(z)){k=!1;let L=null;if(z["font-scale"]&&(L=d.parse(z["font-scale"],1,le),!L))return null;let F=null;if(z["text-font"]&&(F=d.parse(z["text-font"],1,ne(Be)),!F))return null;let q=null;if(z["text-color"]&&(q=d.parse(z["text-color"],1,st),!q))return null;const Q=_[_.length-1];Q.scale=L,Q.font=F,Q.textColor=q}else{const L=d.parse(l[T],1,vt);if(!L)return null;const F=L.type.kind;if(F!=="string"&&F!=="value"&&F!=="null"&&F!=="resolvedImage")return d.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");k=!0,_.push({content:L,scale:null,font:null,textColor:null})}}return new $c(_)}evaluate(l){return new lt(this.sections.map(d=>{const m=d.content.evaluate(l);return jr(m)===Kt?new Wi("",m,null,null,null):new Wi(ps(m),null,d.scale?d.scale.evaluate(l):null,d.font?d.font.evaluate(l).join(","):null,d.textColor?d.textColor.evaluate(l):null)}))}eachChild(l){for(const d of this.sections)l(d.content),d.scale&&l(d.scale),d.font&&l(d.font),d.textColor&&l(d.textColor)}outputDefined(){return!1}}class Kh{constructor(l){this.type=Kt,this.input=l}static parse(l,d){if(l.length!==2)return d.error("Expected two arguments.");const m=d.parse(l[1],1,Be);return m?new Kh(m):d.error("No image name provided.")}evaluate(l){const d=this.input.evaluate(l),m=vn.fromString(d);return m&&l.availableImages&&(m.available=l.availableImages.indexOf(d)>-1),m}eachChild(l){l(this.input)}outputDefined(){return!1}}class Yh{constructor(l){this.type=le,this.input=l}static parse(l,d){if(l.length!==2)return d.error(`Expected 1 argument, but found ${l.length-1} instead.`);const m=d.parse(l[1],1);return m?m.type.kind!=="array"&&m.type.kind!=="string"&&m.type.kind!=="value"?d.error(`Expected argument of type string or array, but found ${re(m.type)} instead.`):new Yh(m):null}evaluate(l){const d=this.input.evaluate(l);if(typeof d=="string")return[...d].length;if(Array.isArray(d))return d.length;throw new Qr(`Expected value to be of type string or array, but found ${re(jr(d))} instead.`)}eachChild(l){l(this.input)}outputDefined(){return!1}}const Zi=8192;function _x(c,l){const d=(180+c[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,_=Math.pow(2,l.z);return[Math.round(d*_*Zi),Math.round(m*_*Zi)]}function Jh(c,l){const d=Math.pow(2,l.z);return[(_=(c[0]/Zi+l.x)/d,360*_-180),(m=(c[1]/Zi+l.y)/d,360/Math.PI*Math.atan(Math.exp((180-360*m)*Math.PI/180))-90)];var m,_}function fo(c,l){c[0]=Math.min(c[0],l[0]),c[1]=Math.min(c[1],l[1]),c[2]=Math.max(c[2],l[0]),c[3]=Math.max(c[3],l[1])}function Fs(c,l){return!(c[0]<=l[0]||c[2]>=l[2]||c[1]<=l[1]||c[3]>=l[3])}function Or(c,l,d){const m=c[0]-l[0],_=c[1]-l[1],k=c[0]-d[0],T=c[1]-d[1];return m*T-k*_==0&&m*k<=0&&_*T<=0}function Vc(c,l,d,m){return(_=[m[0]-d[0],m[1]-d[1]])[0]*(k=[l[0]-c[0],l[1]-c[1]])[1]-_[1]*k[0]!=0&&!(!ug(c,l,d,m)||!ug(d,m,c,l));var _,k}function wx(c,l,d){for(const m of d)for(let _=0;_<m.length-1;++_)if(Vc(c,l,m[_],m[_+1]))return!0;return!1}function Qo(c,l,d=!1){let m=!1;for(const z of l)for(let L=0;L<z.length-1;L++){if(Or(c,z[L],z[L+1]))return d;(k=z[L])[1]>(_=c)[1]!=(T=z[L+1])[1]>_[1]&&_[0]<(T[0]-k[0])*(_[1]-k[1])/(T[1]-k[1])+k[0]&&(m=!m)}var _,k,T;return m}function Sx(c,l){for(const d of l)if(Qo(c,d))return!0;return!1}function lg(c,l){for(const d of c)if(!Qo(d,l))return!1;for(let d=0;d<c.length-1;++d)if(wx(c[d],c[d+1],l))return!1;return!0}function Ex(c,l){for(const d of l)if(lg(c,d))return!0;return!1}function ug(c,l,d,m){const _=m[0]-d[0],k=m[1]-d[1],T=(c[0]-d[0])*k-_*(c[1]-d[1]),z=(l[0]-d[0])*k-_*(l[1]-d[1]);return T>0&&z<0||T<0&&z>0}function Qh(c,l,d){const m=[];for(let _=0;_<c.length;_++){const k=[];for(let T=0;T<c[_].length;T++){const z=_x(c[_][T],d);fo(l,z),k.push(z)}m.push(k)}return m}function cg(c,l,d){const m=[];for(let _=0;_<c.length;_++){const k=Qh(c[_],l,d);m.push(k)}return m}function dg(c,l,d,m){if(c[0]<d[0]||c[0]>d[2]){const _=.5*m;let k=c[0]-d[0]>_?-m:d[0]-c[0]>_?m:0;k===0&&(k=c[0]-d[2]>_?-m:d[2]-c[0]>_?m:0),c[0]+=k}fo(l,c)}function hg(c,l,d,m){const _=Math.pow(2,m.z)*Zi,k=[m.x*Zi,m.y*Zi],T=[];for(const z of c)for(const L of z){const F=[L.x+k[0],L.y+k[1]];dg(F,l,d,_),T.push(F)}return T}function fg(c,l,d,m){const _=Math.pow(2,m.z)*Zi,k=[m.x*Zi,m.y*Zi],T=[];for(const L of c){const F=[];for(const q of L){const Q=[q.x+k[0],q.y+k[1]];fo(l,Q),F.push(Q)}T.push(F)}if(l[2]-l[0]<=_/2){(z=l)[0]=z[1]=1/0,z[2]=z[3]=-1/0;for(const L of T)for(const F of L)dg(F,l,d,_)}var z;return T}class po{constructor(l,d){this.type=qe,this.geojson=l,this.geometries=d}static parse(l,d){if(l.length!==2)return d.error(`'within' expression requires exactly one argument, but found ${l.length-1} instead.`);if(Fn(l[1])){const m=l[1];if(m.type==="FeatureCollection"){const _=[];for(const k of m.features){const{type:T,coordinates:z}=k.geometry;T==="Polygon"&&_.push(z),T==="MultiPolygon"&&_.push(...z)}if(_.length)return new po(m,{type:"MultiPolygon",coordinates:_})}else if(m.type==="Feature"){const _=m.geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new po(m,m.geometry)}else if(m.type==="Polygon"||m.type==="MultiPolygon")return new po(m,m)}return d.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return function(d,m){const _=[1/0,1/0,-1/0,-1/0],k=[1/0,1/0,-1/0,-1/0],T=d.canonicalID();if(m.type==="Polygon"){const z=Qh(m.coordinates,k,T),L=hg(d.geometry(),_,k,T);if(!Fs(_,k))return!1;for(const F of L)if(!Qo(F,z))return!1}if(m.type==="MultiPolygon"){const z=cg(m.coordinates,k,T),L=hg(d.geometry(),_,k,T);if(!Fs(_,k))return!1;for(const F of L)if(!Sx(F,z))return!1}return!0}(l,this.geometries);if(l.geometryType()==="LineString")return function(d,m){const _=[1/0,1/0,-1/0,-1/0],k=[1/0,1/0,-1/0,-1/0],T=d.canonicalID();if(m.type==="Polygon"){const z=Qh(m.coordinates,k,T),L=fg(d.geometry(),_,k,T);if(!Fs(_,k))return!1;for(const F of L)if(!lg(F,z))return!1}if(m.type==="MultiPolygon"){const z=cg(m.coordinates,k,T),L=fg(d.geometry(),_,k,T);if(!Fs(_,k))return!1;for(const F of L)if(!Ex(F,z))return!1}return!0}(l,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let pg=class{constructor(c=[],l=(d,m)=>d<m?-1:d>m?1:0){if(this.data=c,this.length=this.data.length,this.compare=l,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(c){this.data.push(c),this._up(this.length++)}pop(){if(this.length===0)return;const c=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),c}peek(){return this.data[0]}_up(c){const{data:l,compare:d}=this,m=l[c];for(;c>0;){const _=c-1>>1,k=l[_];if(d(m,k)>=0)break;l[c]=k,c=_}l[c]=m}_down(c){const{data:l,compare:d}=this,m=this.length>>1,_=l[c];for(;c<m;){let k=1+(c<<1);const T=k+1;if(T<this.length&&d(l[T],l[k])<0&&(k=T),d(l[k],_)>=0)break;l[c]=l[k],c=k}l[c]=_}};function Cx(c,l,d,m,_){mg(c,l,d,m||c.length-1,_||kx)}function mg(c,l,d,m,_){for(;m>d;){if(m-d>600){var k=m-d+1,T=l-d+1,z=Math.log(k),L=.5*Math.exp(2*z/3),F=.5*Math.sqrt(z*L*(k-L)/k)*(T-k/2<0?-1:1);mg(c,l,Math.max(d,Math.floor(l-T*L/k+F)),Math.min(m,Math.floor(l+(k-T)*L/k+F)),_)}var q=c[l],Q=d,ae=m;for(Su(c,d,l),_(c[m],q)>0&&Su(c,d,m);Q<ae;){for(Su(c,Q,ae),Q++,ae--;_(c[Q],q)<0;)Q++;for(;_(c[ae],q)>0;)ae--}_(c[d],q)===0?Su(c,d,ae):Su(c,++ae,m),ae<=l&&(d=ae+1),l<=ae&&(m=ae-1)}}function Su(c,l,d){var m=c[l];c[l]=c[d],c[d]=m}function kx(c,l){return c<l?-1:c>l?1:0}function Uc(c,l){if(c.length<=1)return[c];const d=[];let m,_;for(const k of c){const T=Px(k);T!==0&&(k.area=Math.abs(T),_===void 0&&(_=T<0),_===T<0?(m&&d.push(m),m=[k]):m.push(k))}if(m&&d.push(m),l>1)for(let k=0;k<d.length;k++)d[k].length<=l||(Cx(d[k],l,1,d[k].length-1,Tx),d[k]=d[k].slice(0,l));return d}function Tx(c,l){return l.area-c.area}function Px(c){let l=0;for(let d,m,_=0,k=c.length,T=k-1;_<k;T=_++)d=c[_],m=c[T],l+=(m.x-d.x)*(d.y+m.y);return l}const gg=1/298.257223563,vg=gg*(2-gg),yg=Math.PI/180;class ef{constructor(l){const d=6378.137*yg*1e3,m=Math.cos(l*yg),_=1/(1-vg*(1-m*m)),k=Math.sqrt(_);this.kx=d*k*m,this.ky=d*k*_*(1-vg)}distance(l,d){const m=this.wrap(l[0]-d[0])*this.kx,_=(l[1]-d[1])*this.ky;return Math.sqrt(m*m+_*_)}pointOnLine(l,d){let m,_,k,T,z=1/0;for(let L=0;L<l.length-1;L++){let F=l[L][0],q=l[L][1],Q=this.wrap(l[L+1][0]-F)*this.kx,ae=(l[L+1][1]-q)*this.ky,ue=0;Q===0&&ae===0||(ue=(this.wrap(d[0]-F)*this.kx*Q+(d[1]-q)*this.ky*ae)/(Q*Q+ae*ae),ue>1?(F=l[L+1][0],q=l[L+1][1]):ue>0&&(F+=Q/this.kx*ue,q+=ae/this.ky*ue)),Q=this.wrap(d[0]-F)*this.kx,ae=(d[1]-q)*this.ky;const me=Q*Q+ae*ae;me<z&&(z=me,m=F,_=q,k=L,T=ue)}return{point:[m,_],index:k,t:Math.max(0,Math.min(1,T))}}wrap(l){for(;l<-180;)l+=360;for(;l>180;)l-=360;return l}}function xg(c,l){return l[0]-c[0]}function qc(c){return c[1]-c[0]+1}function ms(c,l){return c[1]>=c[0]&&c[1]<l}function tf(c,l){if(c[0]>c[1])return[null,null];const d=qc(c);if(l){if(d===2)return[c,null];const _=Math.floor(d/2);return[[c[0],c[0]+_],[c[0]+_,c[1]]]}if(d===1)return[c,null];const m=Math.floor(d/2)-1;return[[c[0],c[0]+m],[c[0]+m+1,c[1]]]}function rf(c,l){if(!ms(l,c.length))return[1/0,1/0,-1/0,-1/0];const d=[1/0,1/0,-1/0,-1/0];for(let m=l[0];m<=l[1];++m)fo(d,c[m]);return d}function nf(c){const l=[1/0,1/0,-1/0,-1/0];for(const d of c)for(const m of d)fo(l,m);return l}function Hc(c){return c[0]!==-1/0&&c[1]!==-1/0&&c[2]!==1/0&&c[3]!==1/0}function af(c,l,d){if(!Hc(c)||!Hc(l))return NaN;let m=0,_=0;return c[2]<l[0]&&(m=l[0]-c[2]),c[0]>l[2]&&(m=c[0]-l[2]),c[1]>l[3]&&(_=c[1]-l[3]),c[3]<l[1]&&(_=l[1]-c[3]),d.distance([0,0],[m,_])}function mo(c,l,d){const m=d.pointOnLine(l,c);return d.distance(c,m.point)}function sf(c,l,d,m,_){const k=Math.min(mo(c,[d,m],_),mo(l,[d,m],_)),T=Math.min(mo(d,[c,l],_),mo(m,[c,l],_));return Math.min(k,T)}function Ix(c,l,d,m,_){if(!ms(l,c.length)||!ms(m,d.length))return 1/0;let k=1/0;for(let T=l[0];T<l[1];++T){const z=c[T],L=c[T+1];for(let F=m[0];F<m[1];++F){const q=d[F],Q=d[F+1];if(Vc(z,L,q,Q))return 0;k=Math.min(k,sf(z,L,q,Q,_))}}return k}function Sn(c,l,d,m,_){if(!ms(l,c.length)||!ms(m,d.length))return NaN;let k=1/0;for(let T=l[0];T<=l[1];++T)for(let z=m[0];z<=m[1];++z)if(k=Math.min(k,_.distance(c[T],d[z])),k===0)return k;return k}function Ax(c,l,d){if(Qo(c,l,!0))return 0;let m=1/0;for(const _ of l){const k=_[0],T=_[_.length-1];if(k!==T&&(m=Math.min(m,mo(c,[T,k],d)),m===0))return m;const z=d.pointOnLine(_,c);if(m=Math.min(m,d.distance(c,z.point)),m===0)return m}return m}function Cr(c,l,d,m){if(!ms(l,c.length))return NaN;for(let k=l[0];k<=l[1];++k)if(Qo(c[k],d,!0))return 0;let _=1/0;for(let k=l[0];k<l[1];++k){const T=c[k],z=c[k+1];for(const L of d)for(let F=0,q=L.length,Q=q-1;F<q;Q=F++){const ae=L[Q],ue=L[F];if(Vc(T,z,ae,ue))return 0;_=Math.min(_,sf(T,z,ae,ue,m))}}return _}function Gc(c,l){for(const d of c)for(const m of d)if(Qo(m,l,!0))return!0;return!1}function en(c,l,d,m=1/0){const _=nf(c),k=nf(l);if(m!==1/0&&af(_,k,d)>=m)return m;if(Fs(_,k)){if(Gc(c,l))return 0}else if(Gc(l,c))return 0;let T=1/0;for(const z of c)for(let L=0,F=z.length,q=F-1;L<F;q=L++){const Q=z[q],ae=z[L];for(const ue of l)for(let me=0,ve=ue.length,Ce=ve-1;me<ve;Ce=me++){const Ie=ue[Ce],Je=ue[me];if(Vc(Q,ae,Ie,Je))return 0;T=Math.min(T,sf(Q,ae,Ie,Je,d))}}return T}function Wr(c,l,d,m,_,k){if(!k)return;const T=af(rf(m,k),_,d);T<l&&c.push([T,k,[0,0]])}function go(c,l,d,m,_,k,T){if(!k||!T)return;const z=af(rf(m,k),rf(_,T),d);z<l&&c.push([z,k,T])}function Eu(c,l,d,m,_=1/0){let k=Math.min(m.distance(c[0],d[0][0]),_);if(k===0)return k;const T=new pg([[0,[0,c.length-1],[0,0]]],xg),z=nf(d);for(;T.length>0;){const L=T.pop();if(L[0]>=k)continue;const F=L[1],q=l?50:100;if(qc(F)<=q){if(!ms(F,c.length))return NaN;if(l){const Q=Cr(c,F,d,m);if(isNaN(Q)||Q===0)return Q;k=Math.min(k,Q)}else for(let Q=F[0];Q<=F[1];++Q){const ae=Ax(c[Q],d,m);if(k=Math.min(k,ae),k===0)return 0}}else{const Q=tf(F,l);Wr(T,k,m,c,z,Q[0]),Wr(T,k,m,c,z,Q[1])}}return k}function Cu(c,l,d,m,_,k=1/0){let T=Math.min(k,_.distance(c[0],d[0]));if(T===0)return T;const z=new pg([[0,[0,c.length-1],[0,d.length-1]]],xg);for(;z.length>0;){const L=z.pop();if(L[0]>=T)continue;const F=L[1],q=L[2],Q=l?50:100,ae=m?50:100;if(qc(F)<=Q&&qc(q)<=ae){if(!ms(F,c.length)&&ms(q,d.length))return NaN;let ue;if(l&&m)ue=Ix(c,F,d,q,_),T=Math.min(T,ue);else if(l&&!m){const me=c.slice(F[0],F[1]+1);for(let ve=q[0];ve<=q[1];++ve)if(ue=mo(d[ve],me,_),T=Math.min(T,ue),T===0)return T}else if(!l&&m){const me=d.slice(q[0],q[1]+1);for(let ve=F[0];ve<=F[1];++ve)if(ue=mo(c[ve],me,_),T=Math.min(T,ue),T===0)return T}else ue=Sn(c,F,d,q,_),T=Math.min(T,ue)}else{const ue=tf(F,l),me=tf(q,m);go(z,T,_,c,d,ue[0],me[0]),go(z,T,_,c,d,ue[0],me[1]),go(z,T,_,c,d,ue[1],me[0]),go(z,T,_,c,d,ue[1],me[1])}}return T}function of(c){return c.type==="MultiPolygon"?c.coordinates.map(l=>({type:"Polygon",coordinates:l})):c.type==="MultiLineString"?c.coordinates.map(l=>({type:"LineString",coordinates:l})):c.type==="MultiPoint"?c.coordinates.map(l=>({type:"Point",coordinates:l})):[c]}class vo{constructor(l,d){this.type=le,this.geojson=l,this.geometries=d}static parse(l,d){if(l.length!==2)return d.error(`'distance' expression requires exactly one argument, but found ${l.length-1} instead.`);if(Fn(l[1])){const m=l[1];if(m.type==="FeatureCollection")return new vo(m,m.features.map(_=>of(_.geometry)).flat());if(m.type==="Feature")return new vo(m,of(m.geometry));if("type"in m&&"coordinates"in m)return new vo(m,of(m))}return d.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return function(d,m){const _=d.geometry(),k=_.flat().map(L=>Jh([L.x,L.y],d.canonical));if(_.length===0)return NaN;const T=new ef(k[0][1]);let z=1/0;for(const L of m){switch(L.type){case"Point":z=Math.min(z,Cu(k,!1,[L.coordinates],!1,T,z));break;case"LineString":z=Math.min(z,Cu(k,!1,L.coordinates,!0,T,z));break;case"Polygon":z=Math.min(z,Eu(k,!1,L.coordinates,T,z))}if(z===0)return z}return z}(l,this.geometries);if(l.geometryType()==="LineString")return function(d,m){const _=d.geometry(),k=_.flat().map(L=>Jh([L.x,L.y],d.canonical));if(_.length===0)return NaN;const T=new ef(k[0][1]);let z=1/0;for(const L of m){switch(L.type){case"Point":z=Math.min(z,Cu(k,!0,[L.coordinates],!1,T,z));break;case"LineString":z=Math.min(z,Cu(k,!0,L.coordinates,!0,T,z));break;case"Polygon":z=Math.min(z,Eu(k,!0,L.coordinates,T,z))}if(z===0)return z}return z}(l,this.geometries);if(l.geometryType()==="Polygon")return function(d,m){const _=d.geometry();if(_.length===0||_[0].length===0)return NaN;const k=Uc(_,0).map(L=>L.map(F=>F.map(q=>Jh([q.x,q.y],d.canonical)))),T=new ef(k[0][0][0][1]);let z=1/0;for(const L of m)for(const F of k){switch(L.type){case"Point":z=Math.min(z,Eu([L.coordinates],!1,F,T,z));break;case"LineString":z=Math.min(z,Eu(L.coordinates,!0,F,T,z));break;case"Polygon":z=Math.min(z,en(F,L.coordinates,T,z))}if(z===0)return z}return z}(l,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const el={"==":yx,"!=":ig,">":xx,"<":sg,">=":og,"<=":bx,array:Wa,at:Gh,boolean:Wa,case:Lc,coalesce:Oc,collator:wu,format:$c,image:Kh,in:Wh,"index-of":Ko,interpolate:Da,"interpolate-hcl":Da,"interpolate-lab":Da,length:Yh,let:Os,literal:Na,match:Zh,number:Wa,"number-format":Xh,object:Wa,slice:bu,step:Yo,string:Wa,"to-boolean":Za,"to-color":Za,"to-number":Za,"to-string":Za,var:Br,within:po,distance:vo};class li{constructor(l,d,m,_){this.name=l,this.type=d,this._evaluate=m,this.args=_}evaluate(l){return this._evaluate(l,this.args)}eachChild(l){this.args.forEach(l)}outputDefined(){return!1}static parse(l,d){const m=l[0],_=li.definitions[m];if(!_)return d.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0);const k=Array.isArray(_)?_[0]:_.type,T=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,z=T.filter(([F])=>!Array.isArray(F)||F.length===l.length-1);let L=null;for(const[F,q]of z){L=new co(d.registry,ku,d.path,null,d.scope);const Q=[];let ae=!1;for(let ue=1;ue<l.length;ue++){const me=l[ue],ve=Array.isArray(F)?F[ue-1]:F.type,Ce=L.parse(me,1+Q.length,ve);if(!Ce){ae=!0;break}Q.push(Ce)}if(!ae)if(Array.isArray(F)&&F.length!==Q.length)L.error(`Expected ${F.length} arguments, but found ${Q.length} instead.`);else{for(let ue=0;ue<Q.length;ue++){const me=Array.isArray(F)?F[ue]:F.type,ve=Q[ue];L.concat(ue+1).checkSubtype(me,ve.type)}if(L.errors.length===0)return new li(m,k,q,Q)}}if(z.length===1)d.errors.push(...L.errors);else{const F=(z.length?z:T).map(([Q])=>{return ae=Q,Array.isArray(ae)?`(${ae.map(re).join(", ")})`:`(${re(ae.type)}...)`;var ae}).join(" | "),q=[];for(let Q=1;Q<l.length;Q++){const ae=d.parse(l[Q],1+q.length);if(!ae)return null;q.push(re(ae.type))}d.error(`Expected arguments of type ${F}, but found (${q.join(", ")}) instead.`)}return null}static register(l,d){li.definitions=d;for(const m in d)l[m]=li}}function lf(c,[l,d,m,_]){l=l.evaluate(c),d=d.evaluate(c),m=m.evaluate(c);const k=_?_.evaluate(c):1,T=Zn(l,d,m,k);if(T)throw new Qr(T);return new Mr(l/255,d/255,m/255,k,!1)}function uf(c,l){return c in l}function cf(c,l){const d=l[c];return d===void 0?null:d}function yo(c){return{type:c}}function ku(c){if(c instanceof Br)return ku(c.boundExpression);if(c instanceof li&&c.name==="error"||c instanceof wu||c instanceof po||c instanceof vo)return!1;const l=c instanceof Za||c instanceof Wa;let d=!0;return c.eachChild(m=>{d=l?d&&ku(m):d&&m instanceof Na}),!!d&&Tu(c)&&Pu(c,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Tu(c){if(c instanceof li&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof po||c instanceof vo)return!1;let l=!0;return c.eachChild(d=>{l&&!Tu(d)&&(l=!1)}),l}function tl(c){if(c instanceof li&&c.name==="feature-state")return!1;let l=!0;return c.eachChild(d=>{l&&!tl(d)&&(l=!1)}),l}function Pu(c,l){if(c instanceof li&&l.indexOf(c.name)>=0)return!1;let d=!0;return c.eachChild(m=>{d&&!Pu(m,l)&&(d=!1)}),d}function Wc(c){return{result:"success",value:c}}function rl(c){return{result:"error",value:c}}function nl(c){return c["property-type"]==="data-driven"||c["property-type"]==="cross-faded-data-driven"}function bg(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function df(c){return!!c.expression&&c.expression.interpolated}function Rr(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}function Zc(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function Nx(c){return c}function _g(c,l){const d=l.type==="color",m=c.stops&&typeof c.stops[0][0]=="object",_=m||!(m||c.property!==void 0),k=c.type||(df(l)?"exponential":"interval");if(d||l.type==="padding"){const q=d?Mr.parse:or.parse;(c=fr({},c)).stops&&(c.stops=c.stops.map(Q=>[Q[0],q(Q[1])])),c.default=q(c.default?c.default:l.default)}if(c.colorSpace&&(T=c.colorSpace)!=="rgb"&&T!=="hcl"&&T!=="lab")throw new Error(`Unknown color space: "${c.colorSpace}"`);var T;let z,L,F;if(k==="exponential")z=Sg;else if(k==="interval")z=Xc;else if(k==="categorical"){z=wg,L=Object.create(null);for(const q of c.stops)L[q[0]]=q[1];F=typeof c.stops[0][0]}else{if(k!=="identity")throw new Error(`Unknown function type "${k}"`);z=Eg}if(m){const q={},Q=[];for(let me=0;me<c.stops.length;me++){const ve=c.stops[me],Ce=ve[0].zoom;q[Ce]===void 0&&(q[Ce]={zoom:Ce,type:c.type,property:c.property,default:c.default,stops:[]},Q.push(Ce)),q[Ce].stops.push([ve[0].value,ve[1]])}const ae=[];for(const me of Q)ae.push([q[me].zoom,_g(q[me],l)]);const ue={name:"linear"};return{kind:"composite",interpolationType:ue,interpolationFactor:Da.interpolationFactor.bind(void 0,ue),zoomStops:ae.map(me=>me[0]),evaluate:({zoom:me},ve)=>Sg({stops:ae,base:c.base},l,me).evaluate(me,ve)}}if(_){const q=k==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:q,interpolationFactor:Da.interpolationFactor.bind(void 0,q),zoomStops:c.stops.map(Q=>Q[0]),evaluate:({zoom:Q})=>z(c,l,Q,L,F)}}return{kind:"source",evaluate(q,Q){const ae=Q&&Q.properties?Q.properties[c.property]:void 0;return ae===void 0?al(c.default,l.default):z(c,l,ae,L,F)}}}function al(c,l,d){return c!==void 0?c:l!==void 0?l:d!==void 0?d:void 0}function wg(c,l,d,m,_){return al(typeof d===_?m[d]:void 0,c.default,l.default)}function Xc(c,l,d){if(Rr(d)!=="number")return al(c.default,l.default);const m=c.stops.length;if(m===1||d<=c.stops[0][0])return c.stops[0][1];if(d>=c.stops[m-1][0])return c.stops[m-1][1];const _=Bc(c.stops.map(k=>k[0]),d);return c.stops[_][1]}function Sg(c,l,d){const m=c.base!==void 0?c.base:1;if(Rr(d)!=="number")return al(c.default,l.default);const _=c.stops.length;if(_===1||d<=c.stops[0][0])return c.stops[0][1];if(d>=c.stops[_-1][0])return c.stops[_-1][1];const k=Bc(c.stops.map(q=>q[0]),d),T=function(q,Q,ae,ue){const me=ue-ae,ve=q-ae;return me===0?0:Q===1?ve/me:(Math.pow(Q,ve)-1)/(Math.pow(Q,me)-1)}(d,m,c.stops[k][0],c.stops[k+1][0]),z=c.stops[k][1],L=c.stops[k+1][1],F=Ma[l.type]||Nx;return typeof z.evaluate=="function"?{evaluate(...q){const Q=z.evaluate.apply(void 0,q),ae=L.evaluate.apply(void 0,q);if(Q!==void 0&&ae!==void 0)return F(Q,ae,T,c.colorSpace)}}:F(z,L,T,c.colorSpace)}function Eg(c,l,d){switch(l.type){case"color":d=Mr.parse(d);break;case"formatted":d=lt.fromString(d.toString());break;case"resolvedImage":d=vn.fromString(d.toString());break;case"padding":d=or.parse(d);break;default:Rr(d)===l.type||l.type==="enum"&&l.values[d]||(d=void 0)}return al(d,c.default,l.default)}li.register(el,{error:[{kind:"error"},[Be],(c,[l])=>{throw new Qr(l.evaluate(c))}],typeof:[Be,[vt],(c,[l])=>re(jr(l.evaluate(c)))],"to-rgba":[ne(le,4),[st],(c,[l])=>{const[d,m,_,k]=l.evaluate(c).rgb;return[255*d,255*m,255*_,k]}],rgb:[st,[le,le,le],lf],rgba:[st,[le,le,le,le],lf],has:{type:qe,overloads:[[[Be],(c,[l])=>uf(l.evaluate(c),c.properties())],[[Be,ut],(c,[l,d])=>uf(l.evaluate(c),d.evaluate(c))]]},get:{type:vt,overloads:[[[Be],(c,[l])=>cf(l.evaluate(c),c.properties())],[[Be,ut],(c,[l,d])=>cf(l.evaluate(c),d.evaluate(c))]]},"feature-state":[vt,[Be],(c,[l])=>cf(l.evaluate(c),c.featureState||{})],properties:[ut,[],c=>c.properties()],"geometry-type":[Be,[],c=>c.geometryType()],id:[vt,[],c=>c.id()],zoom:[le,[],c=>c.globals.zoom],"heatmap-density":[le,[],c=>c.globals.heatmapDensity||0],"line-progress":[le,[],c=>c.globals.lineProgress||0],accumulated:[vt,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[le,yo(le),(c,l)=>{let d=0;for(const m of l)d+=m.evaluate(c);return d}],"*":[le,yo(le),(c,l)=>{let d=1;for(const m of l)d*=m.evaluate(c);return d}],"-":{type:le,overloads:[[[le,le],(c,[l,d])=>l.evaluate(c)-d.evaluate(c)],[[le],(c,[l])=>-l.evaluate(c)]]},"/":[le,[le,le],(c,[l,d])=>l.evaluate(c)/d.evaluate(c)],"%":[le,[le,le],(c,[l,d])=>l.evaluate(c)%d.evaluate(c)],ln2:[le,[],()=>Math.LN2],pi:[le,[],()=>Math.PI],e:[le,[],()=>Math.E],"^":[le,[le,le],(c,[l,d])=>Math.pow(l.evaluate(c),d.evaluate(c))],sqrt:[le,[le],(c,[l])=>Math.sqrt(l.evaluate(c))],log10:[le,[le],(c,[l])=>Math.log(l.evaluate(c))/Math.LN10],ln:[le,[le],(c,[l])=>Math.log(l.evaluate(c))],log2:[le,[le],(c,[l])=>Math.log(l.evaluate(c))/Math.LN2],sin:[le,[le],(c,[l])=>Math.sin(l.evaluate(c))],cos:[le,[le],(c,[l])=>Math.cos(l.evaluate(c))],tan:[le,[le],(c,[l])=>Math.tan(l.evaluate(c))],asin:[le,[le],(c,[l])=>Math.asin(l.evaluate(c))],acos:[le,[le],(c,[l])=>Math.acos(l.evaluate(c))],atan:[le,[le],(c,[l])=>Math.atan(l.evaluate(c))],min:[le,yo(le),(c,l)=>Math.min(...l.map(d=>d.evaluate(c)))],max:[le,yo(le),(c,l)=>Math.max(...l.map(d=>d.evaluate(c)))],abs:[le,[le],(c,[l])=>Math.abs(l.evaluate(c))],round:[le,[le],(c,[l])=>{const d=l.evaluate(c);return d<0?-Math.round(-d):Math.round(d)}],floor:[le,[le],(c,[l])=>Math.floor(l.evaluate(c))],ceil:[le,[le],(c,[l])=>Math.ceil(l.evaluate(c))],"filter-==":[qe,[Be,vt],(c,[l,d])=>c.properties()[l.value]===d.value],"filter-id-==":[qe,[vt],(c,[l])=>c.id()===l.value],"filter-type-==":[qe,[Be],(c,[l])=>c.geometryType()===l.value],"filter-<":[qe,[Be,vt],(c,[l,d])=>{const m=c.properties()[l.value],_=d.value;return typeof m==typeof _&&m<_}],"filter-id-<":[qe,[vt],(c,[l])=>{const d=c.id(),m=l.value;return typeof d==typeof m&&d<m}],"filter->":[qe,[Be,vt],(c,[l,d])=>{const m=c.properties()[l.value],_=d.value;return typeof m==typeof _&&m>_}],"filter-id->":[qe,[vt],(c,[l])=>{const d=c.id(),m=l.value;return typeof d==typeof m&&d>m}],"filter-<=":[qe,[Be,vt],(c,[l,d])=>{const m=c.properties()[l.value],_=d.value;return typeof m==typeof _&&m<=_}],"filter-id-<=":[qe,[vt],(c,[l])=>{const d=c.id(),m=l.value;return typeof d==typeof m&&d<=m}],"filter->=":[qe,[Be,vt],(c,[l,d])=>{const m=c.properties()[l.value],_=d.value;return typeof m==typeof _&&m>=_}],"filter-id->=":[qe,[vt],(c,[l])=>{const d=c.id(),m=l.value;return typeof d==typeof m&&d>=m}],"filter-has":[qe,[vt],(c,[l])=>l.value in c.properties()],"filter-has-id":[qe,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[qe,[ne(Be)],(c,[l])=>l.value.indexOf(c.geometryType())>=0],"filter-id-in":[qe,[ne(vt)],(c,[l])=>l.value.indexOf(c.id())>=0],"filter-in-small":[qe,[Be,ne(vt)],(c,[l,d])=>d.value.indexOf(c.properties()[l.value])>=0],"filter-in-large":[qe,[Be,ne(vt)],(c,[l,d])=>function(m,_,k,T){for(;k<=T;){const z=k+T>>1;if(_[z]===m)return!0;_[z]>m?T=z-1:k=z+1}return!1}(c.properties()[l.value],d.value,0,d.value.length-1)],all:{type:qe,overloads:[[[qe,qe],(c,[l,d])=>l.evaluate(c)&&d.evaluate(c)],[yo(qe),(c,l)=>{for(const d of l)if(!d.evaluate(c))return!1;return!0}]]},any:{type:qe,overloads:[[[qe,qe],(c,[l,d])=>l.evaluate(c)||d.evaluate(c)],[yo(qe),(c,l)=>{for(const d of l)if(d.evaluate(c))return!0;return!1}]]},"!":[qe,[qe],(c,[l])=>!l.evaluate(c)],"is-supported-script":[qe,[Be],(c,[l])=>{const d=c.globals&&c.globals.isSupportedScript;return!d||d(l.evaluate(c))}],upcase:[Be,[Be],(c,[l])=>l.evaluate(c).toUpperCase()],downcase:[Be,[Be],(c,[l])=>l.evaluate(c).toLowerCase()],concat:[Be,yo(vt),(c,l)=>l.map(d=>ps(d.evaluate(c))).join("")],"resolved-locale":[Be,[gt],(c,[l])=>l.evaluate(c).resolvedLocale()]});class Kc{constructor(l,d){var m;this.expression=l,this._warningHistory={},this._evaluator=new Rc,this._defaultValue=d?(m=d).type==="color"&&Zc(m.default)?new Mr(0,0,0,0):m.type==="color"?Mr.parse(m.default)||null:m.type==="padding"?or.parse(m.default)||null:m.type==="variableAnchorOffsetCollection"?Gr.parse(m.default)||null:m.default===void 0?null:m.default:null,this._enumValues=d&&d.type==="enum"?d.values:null}evaluateWithoutErrorHandling(l,d,m,_,k,T){return this._evaluator.globals=l,this._evaluator.feature=d,this._evaluator.featureState=m,this._evaluator.canonical=_,this._evaluator.availableImages=k||null,this._evaluator.formattedSection=T,this.expression.evaluate(this._evaluator)}evaluate(l,d,m,_,k,T){this._evaluator.globals=l,this._evaluator.feature=d||null,this._evaluator.featureState=m||null,this._evaluator.canonical=_,this._evaluator.availableImages=k||null,this._evaluator.formattedSection=T||null;try{const z=this.expression.evaluate(this._evaluator);if(z==null||typeof z=="number"&&z!=z)return this._defaultValue;if(this._enumValues&&!(z in this._enumValues))throw new Qr(`Expected value to be one of ${Object.keys(this._enumValues).map(L=>JSON.stringify(L)).join(", ")}, but found ${JSON.stringify(z)} instead.`);return z}catch(z){return this._warningHistory[z.message]||(this._warningHistory[z.message]=!0,typeof console<"u"&&console.warn(z.message)),this._defaultValue}}}function Yc(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in el}function il(c,l){const d=new co(el,ku,[],l?function(_){const k={color:st,string:Be,number:le,enum:Be,boolean:qe,formatted:Ut,padding:Ot,resolvedImage:Kt,variableAnchorOffsetCollection:we};return _.type==="array"?ne(k[_.value]||vt,_.length):k[_.type]}(l):void 0),m=d.parse(c,void 0,void 0,void 0,l&&l.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?Wc(new Kc(m,l)):rl(d.errors)}class sl{constructor(l,d){this.kind=l,this._styleExpression=d,this.isStateDependent=l!=="constant"&&!tl(d.expression)}evaluateWithoutErrorHandling(l,d,m,_,k,T){return this._styleExpression.evaluateWithoutErrorHandling(l,d,m,_,k,T)}evaluate(l,d,m,_,k,T){return this._styleExpression.evaluate(l,d,m,_,k,T)}}class ol{constructor(l,d,m,_){this.kind=l,this.zoomStops=m,this._styleExpression=d,this.isStateDependent=l!=="camera"&&!tl(d.expression),this.interpolationType=_}evaluateWithoutErrorHandling(l,d,m,_,k,T){return this._styleExpression.evaluateWithoutErrorHandling(l,d,m,_,k,T)}evaluate(l,d,m,_,k,T){return this._styleExpression.evaluate(l,d,m,_,k,T)}interpolationFactor(l,d,m){return this.interpolationType?Da.interpolationFactor(this.interpolationType,l,d,m):0}}function hf(c,l){const d=il(c,l);if(d.result==="error")return d;const m=d.value.expression,_=Tu(m);if(!_&&!nl(l))return rl([new Xt("","data expressions not supported")]);const k=Pu(m,["zoom"]);if(!k&&!bg(l))return rl([new Xt("","zoom expressions not supported")]);const T=Iu(m);return T||k?T instanceof Xt?rl([T]):T instanceof Da&&!df(l)?rl([new Xt("",'"interpolate" expressions cannot be used with this property')]):Wc(T?new ol(_?"camera":"composite",d.value,T.labels,T instanceof Da?T.interpolation:void 0):new sl(_?"constant":"source",d.value)):rl([new Xt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ll{constructor(l,d){this._parameters=l,this._specification=d,fr(this,_g(this._parameters,this._specification))}static deserialize(l){return new ll(l._parameters,l._specification)}static serialize(l){return{_parameters:l._parameters,_specification:l._specification}}}function Iu(c){let l=null;if(c instanceof Os)l=Iu(c.result);else if(c instanceof Oc){for(const d of c.args)if(l=Iu(d),l)break}else(c instanceof Yo||c instanceof Da)&&c.input instanceof li&&c.input.name==="zoom"&&(l=c);return l instanceof Xt||c.eachChild(d=>{const m=Iu(d);m instanceof Xt?l=m:!l&&m?l=new Xt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):l&&m&&l!==m&&(l=new Xt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),l}function Jc(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const l of c.slice(1))if(!Jc(l)&&typeof l!="boolean")return!1;return!0;default:return!0}}const Qc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ff(c){if(c==null)return{filter:()=>!0,needGeometry:!1};Jc(c)||(c=ed(c));const l=il(c,Qc);if(l.result==="error")throw new Error(l.value.map(d=>`${d.key}: ${d.message}`).join(", "));return{filter:(d,m,_)=>l.value.evaluate(d,m,{},_),needGeometry:Cg(c)}}function Mx(c,l){return c<l?-1:c>l?1:0}function Cg(c){if(!Array.isArray(c))return!1;if(c[0]==="within"||c[0]==="distance")return!0;for(let l=1;l<c.length;l++)if(Cg(c[l]))return!0;return!1}function ed(c){if(!c)return!0;const l=c[0];return c.length<=1?l!=="any":l==="=="?pf(c[1],c[2],"=="):l==="!="?ia(pf(c[1],c[2],"==")):l==="<"||l===">"||l==="<="||l===">="?pf(c[1],c[2],l):l==="any"?(d=c.slice(1),["any"].concat(d.map(ed))):l==="all"?["all"].concat(c.slice(1).map(ed)):l==="none"?["all"].concat(c.slice(1).map(ed).map(ia)):l==="in"?Au(c[1],c.slice(2)):l==="!in"?ia(Au(c[1],c.slice(2))):l==="has"?Nu(c[1]):l!=="!has"||ia(Nu(c[1]));var d}function pf(c,l,d){switch(c){case"$type":return[`filter-type-${d}`,l];case"$id":return[`filter-id-${d}`,l];default:return[`filter-${d}`,c,l]}}function Au(c,l){if(l.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",l]];case"$id":return["filter-id-in",["literal",l]];default:return l.length>200&&!l.some(d=>typeof d!=typeof l[0])?["filter-in-large",c,["literal",l.sort(Mx)]]:["filter-in-small",c,["literal",l]]}}function Nu(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function ia(c){return["!",c]}function xo(c){const l=typeof c;if(l==="number"||l==="boolean"||l==="string"||c==null)return JSON.stringify(c);if(Array.isArray(c)){let _="[";for(const k of c)_+=`${xo(k)},`;return`${_}]`}const d=Object.keys(c).sort();let m="{";for(let _=0;_<d.length;_++)m+=`${JSON.stringify(d[_])}:${xo(c[d[_]])},`;return`${m}}`}function kg(c){let l="";for(const d of Xe)l+=`/${xo(c[d])}`;return l}function Tg(c){const l=c.value;return l?[new ft(c.key,l,"constants have been deprecated as of v8")]:[]}function En(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function Pi(c){if(Array.isArray(c))return c.map(Pi);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const l={};for(const d in c)l[d]=Pi(c[d]);return l}return En(c)}function Xa(c){const l=c.key,d=c.value,m=c.valueSpec||{},_=c.objectElementValidators||{},k=c.style,T=c.styleSpec,z=c.validateSpec;let L=[];const F=Rr(d);if(F!=="object")return[new ft(l,d,`object expected, ${F} found`)];for(const q in d){const Q=q.split(".")[0],ae=m[Q]||m["*"];let ue;if(_[Q])ue=_[Q];else if(m[Q])ue=z;else if(_["*"])ue=_["*"];else{if(!m["*"]){L.push(new ft(l,d[q],`unknown property "${q}"`));continue}ue=z}L=L.concat(ue({key:(l&&`${l}.`)+q,value:d[q],valueSpec:ae,style:k,styleSpec:T,object:d,objectKey:q,validateSpec:z},d))}for(const q in m)_[q]||m[q].required&&m[q].default===void 0&&d[q]===void 0&&L.push(new ft(l,d,`missing required property "${q}"`));return L}function Mu(c){const l=c.value,d=c.valueSpec,m=c.style,_=c.styleSpec,k=c.key,T=c.arrayElementValidator||c.validateSpec;if(Rr(l)!=="array")return[new ft(k,l,`array expected, ${Rr(l)} found`)];if(d.length&&l.length!==d.length)return[new ft(k,l,`array length ${d.length} expected, length ${l.length} found`)];if(d["min-length"]&&l.length<d["min-length"])return[new ft(k,l,`array length at least ${d["min-length"]} expected, length ${l.length} found`)];let z={type:d.value,values:d.values};_.$version<7&&(z.function=d.function),Rr(d.value)==="object"&&(z=d.value);let L=[];for(let F=0;F<l.length;F++)L=L.concat(T({array:l,arrayIndex:F,value:l[F],valueSpec:z,validateSpec:c.validateSpec,style:m,styleSpec:_,key:`${k}[${F}]`}));return L}function mf(c){const l=c.key,d=c.value,m=c.valueSpec;let _=Rr(d);return _==="number"&&d!=d&&(_="NaN"),_!=="number"?[new ft(l,d,`number expected, ${_} found`)]:"minimum"in m&&d<m.minimum?[new ft(l,d,`${d} is less than the minimum value ${m.minimum}`)]:"maximum"in m&&d>m.maximum?[new ft(l,d,`${d} is greater than the maximum value ${m.maximum}`)]:[]}function td(c){const l=c.valueSpec,d=En(c.value.type);let m,_,k,T={};const z=d!=="categorical"&&c.value.property===void 0,L=!z,F=Rr(c.value.stops)==="array"&&Rr(c.value.stops[0])==="array"&&Rr(c.value.stops[0][0])==="object",q=Xa({key:c.key,value:c.value,valueSpec:c.styleSpec.function,validateSpec:c.validateSpec,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(ue){if(d==="identity")return[new ft(ue.key,ue.value,'identity function may not have a "stops" property')];let me=[];const ve=ue.value;return me=me.concat(Mu({key:ue.key,value:ve,valueSpec:ue.valueSpec,validateSpec:ue.validateSpec,style:ue.style,styleSpec:ue.styleSpec,arrayElementValidator:Q})),Rr(ve)==="array"&&ve.length===0&&me.push(new ft(ue.key,ve,"array must have at least one stop")),me},default:function(ue){return ue.validateSpec({key:ue.key,value:ue.value,valueSpec:l,validateSpec:ue.validateSpec,style:ue.style,styleSpec:ue.styleSpec})}}});return d==="identity"&&z&&q.push(new ft(c.key,c.value,'missing required property "property"')),d==="identity"||c.value.stops||q.push(new ft(c.key,c.value,'missing required property "stops"')),d==="exponential"&&c.valueSpec.expression&&!df(c.valueSpec)&&q.push(new ft(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(L&&!nl(c.valueSpec)?q.push(new ft(c.key,c.value,"property functions not supported")):z&&!bg(c.valueSpec)&&q.push(new ft(c.key,c.value,"zoom functions not supported"))),d!=="categorical"&&!F||c.value.property!==void 0||q.push(new ft(c.key,c.value,'"property" property is required')),q;function Q(ue){let me=[];const ve=ue.value,Ce=ue.key;if(Rr(ve)!=="array")return[new ft(Ce,ve,`array expected, ${Rr(ve)} found`)];if(ve.length!==2)return[new ft(Ce,ve,`array length 2 expected, length ${ve.length} found`)];if(F){if(Rr(ve[0])!=="object")return[new ft(Ce,ve,`object expected, ${Rr(ve[0])} found`)];if(ve[0].zoom===void 0)return[new ft(Ce,ve,"object stop key must have zoom")];if(ve[0].value===void 0)return[new ft(Ce,ve,"object stop key must have value")];if(k&&k>En(ve[0].zoom))return[new ft(Ce,ve[0].zoom,"stop zoom values must appear in ascending order")];En(ve[0].zoom)!==k&&(k=En(ve[0].zoom),_=void 0,T={}),me=me.concat(Xa({key:`${Ce}[0]`,value:ve[0],valueSpec:{zoom:{}},validateSpec:ue.validateSpec,style:ue.style,styleSpec:ue.styleSpec,objectElementValidators:{zoom:mf,value:ae}}))}else me=me.concat(ae({key:`${Ce}[0]`,value:ve[0],validateSpec:ue.validateSpec,style:ue.style,styleSpec:ue.styleSpec},ve));return Yc(Pi(ve[1]))?me.concat([new ft(`${Ce}[1]`,ve[1],"expressions are not allowed in function stops.")]):me.concat(ue.validateSpec({key:`${Ce}[1]`,value:ve[1],valueSpec:l,validateSpec:ue.validateSpec,style:ue.style,styleSpec:ue.styleSpec}))}function ae(ue,me){const ve=Rr(ue.value),Ce=En(ue.value),Ie=ue.value!==null?ue.value:me;if(m){if(ve!==m)return[new ft(ue.key,Ie,`${ve} stop domain type must match previous stop domain type ${m}`)]}else m=ve;if(ve!=="number"&&ve!=="string"&&ve!=="boolean")return[new ft(ue.key,Ie,"stop domain value must be a number, string, or boolean")];if(ve!=="number"&&d!=="categorical"){let Je=`number expected, ${ve} found`;return nl(l)&&d===void 0&&(Je+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ft(ue.key,Ie,Je)]}return d!=="categorical"||ve!=="number"||isFinite(Ce)&&Math.floor(Ce)===Ce?d!=="categorical"&&ve==="number"&&_!==void 0&&Ce<_?[new ft(ue.key,Ie,"stop domain values must appear in ascending order")]:(_=Ce,d==="categorical"&&Ce in T?[new ft(ue.key,Ie,"stop domain values must be unique")]:(T[Ce]=!0,[])):[new ft(ue.key,Ie,`integer expected, found ${Ce}`)]}}function ul(c){const l=(c.expressionContext==="property"?hf:il)(Pi(c.value),c.valueSpec);if(l.result==="error")return l.value.map(m=>new ft(`${c.key}${m.key}`,c.value,m.message));const d=l.value.expression||l.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!d.outputDefined())return[new ft(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!tl(d))return[new ft(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter"&&!tl(d))return[new ft(c.key,c.value,'"feature-state" data expressions are not supported with filters.')];if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!Pu(d,["zoom","feature-state"]))return[new ft(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!Tu(d))return[new ft(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function gs(c){const l=c.key,d=c.value,m=c.valueSpec,_=[];return Array.isArray(m.values)?m.values.indexOf(En(d))===-1&&_.push(new ft(l,d,`expected one of [${m.values.join(", ")}], ${JSON.stringify(d)} found`)):Object.keys(m.values).indexOf(En(d))===-1&&_.push(new ft(l,d,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(d)} found`)),_}function gf(c){return Jc(Pi(c.value))?ul(fr({},c,{expressionContext:"filter",valueSpec:{value:"boolean"}})):rd(c)}function rd(c){const l=c.value,d=c.key;if(Rr(l)!=="array")return[new ft(d,l,`array expected, ${Rr(l)} found`)];const m=c.styleSpec;let _,k=[];if(l.length<1)return[new ft(d,l,"filter array must have at least 1 element")];switch(k=k.concat(gs({key:`${d}[0]`,value:l[0],valueSpec:m.filter_operator,style:c.style,styleSpec:c.styleSpec})),En(l[0])){case"<":case"<=":case">":case">=":l.length>=2&&En(l[1])==="$type"&&k.push(new ft(d,l,`"$type" cannot be use with operator "${l[0]}"`));case"==":case"!=":l.length!==3&&k.push(new ft(d,l,`filter array for operator "${l[0]}" must have 3 elements`));case"in":case"!in":l.length>=2&&(_=Rr(l[1]),_!=="string"&&k.push(new ft(`${d}[1]`,l[1],`string expected, ${_} found`)));for(let T=2;T<l.length;T++)_=Rr(l[T]),En(l[1])==="$type"?k=k.concat(gs({key:`${d}[${T}]`,value:l[T],valueSpec:m.geometry_type,style:c.style,styleSpec:c.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&k.push(new ft(`${d}[${T}]`,l[T],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let T=1;T<l.length;T++)k=k.concat(rd({key:`${d}[${T}]`,value:l[T],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":_=Rr(l[1]),l.length!==2?k.push(new ft(d,l,`filter array for "${l[0]}" operator must have 2 elements`)):_!=="string"&&k.push(new ft(`${d}[1]`,l[1],`string expected, ${_} found`))}return k}function vf(c,l){const d=c.key,m=c.validateSpec,_=c.style,k=c.styleSpec,T=c.value,z=c.objectKey,L=k[`${l}_${c.layerType}`];if(!L)return[];const F=z.match(/^(.*)-transition$/);if(l==="paint"&&F&&L[F[1]]&&L[F[1]].transition)return m({key:d,value:T,valueSpec:k.transition,style:_,styleSpec:k});const q=c.valueSpec||L[z];if(!q)return[new ft(d,T,`unknown property "${z}"`)];let Q;if(Rr(T)==="string"&&nl(q)&&!q.tokens&&(Q=/^{([^}]+)}$/.exec(T)))return[new ft(d,T,`"${z}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(Q[1])} }\`.`)];const ae=[];return c.layerType==="symbol"&&(z==="text-field"&&_&&!_.glyphs&&ae.push(new ft(d,T,'use of "text-field" requires a style "glyphs" property')),z==="text-font"&&Zc(Pi(T))&&En(T.type)==="identity"&&ae.push(new ft(d,T,'"text-font" does not support identity functions'))),ae.concat(m({key:c.key,value:T,valueSpec:q,style:_,styleSpec:k,expressionContext:"property",propertyType:l,propertyKey:z}))}function nd(c){return vf(c,"paint")}function yf(c){return vf(c,"layout")}function xf(c){let l=[];const d=c.value,m=c.key,_=c.style,k=c.styleSpec;d.type||d.ref||l.push(new ft(m,d,'either "type" or "ref" is required'));let T=En(d.type);const z=En(d.ref);if(d.id){const L=En(d.id);for(let F=0;F<c.arrayIndex;F++){const q=_.layers[F];En(q.id)===L&&l.push(new ft(m,d.id,`duplicate layer id "${d.id}", previously used at line ${q.id.__line__}`))}}if("ref"in d){let L;["type","source","source-layer","filter","layout"].forEach(F=>{F in d&&l.push(new ft(m,d[F],`"${F}" is prohibited for ref layers`))}),_.layers.forEach(F=>{En(F.id)===z&&(L=F)}),L?L.ref?l.push(new ft(m,d.ref,"ref cannot reference another ref layer")):T=En(L.type):l.push(new ft(m,d.ref,`ref layer "${z}" not found`))}else if(T!=="background")if(d.source){const L=_.sources&&_.sources[d.source],F=L&&En(L.type);L?F==="vector"&&T==="raster"?l.push(new ft(m,d.source,`layer "${d.id}" requires a raster source`)):F!=="raster-dem"&&T==="hillshade"?l.push(new ft(m,d.source,`layer "${d.id}" requires a raster-dem source`)):F==="raster"&&T!=="raster"?l.push(new ft(m,d.source,`layer "${d.id}" requires a vector source`)):F!=="vector"||d["source-layer"]?F==="raster-dem"&&T!=="hillshade"?l.push(new ft(m,d.source,"raster-dem source can only be used with layer type 'hillshade'.")):T!=="line"||!d.paint||!d.paint["line-gradient"]||F==="geojson"&&L.lineMetrics||l.push(new ft(m,d,`layer "${d.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):l.push(new ft(m,d,`layer "${d.id}" must specify a "source-layer"`)):l.push(new ft(m,d.source,`source "${d.source}" not found`))}else l.push(new ft(m,d,'missing required property "source"'));return l=l.concat(Xa({key:m,value:d,valueSpec:k.layer,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,objectElementValidators:{"*":()=>[],type:()=>c.validateSpec({key:`${m}.type`,value:d.type,valueSpec:k.layer.type,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,object:d,objectKey:"type"}),filter:gf,layout:L=>Xa({layer:d,key:L.key,value:L.value,style:L.style,styleSpec:L.styleSpec,validateSpec:L.validateSpec,objectElementValidators:{"*":F=>yf(fr({layerType:T},F))}}),paint:L=>Xa({layer:d,key:L.key,value:L.value,style:L.style,styleSpec:L.styleSpec,validateSpec:L.validateSpec,objectElementValidators:{"*":F=>nd(fr({layerType:T},F))}})}})),l}function bo(c){const l=c.value,d=c.key,m=Rr(l);return m!=="string"?[new ft(d,l,`string expected, ${m} found`)]:[]}const ad={promoteId:function({key:c,value:l}){if(Rr(l)==="string")return bo({key:c,value:l});{const d=[];for(const m in l)d.push(...bo({key:`${c}.${m}`,value:l[m]}));return d}}};function Du(c){const l=c.value,d=c.key,m=c.styleSpec,_=c.style,k=c.validateSpec;if(!l.type)return[new ft(d,l,'"type" is required')];const T=En(l.type);let z;switch(T){case"vector":case"raster":return z=Xa({key:d,value:l,valueSpec:m[`source_${T.replace("-","_")}`],style:c.style,styleSpec:m,objectElementValidators:ad,validateSpec:k}),z;case"raster-dem":return z=function(L){var F;const q=(F=L.sourceName)!==null&&F!==void 0?F:"",Q=L.value,ae=L.styleSpec,ue=ae.source_raster_dem,me=L.style;let ve=[];const Ce=Rr(Q);if(Q===void 0)return ve;if(Ce!=="object")return ve.push(new ft("source_raster_dem",Q,`object expected, ${Ce} found`)),ve;const Ie=En(Q.encoding)==="custom",Je=["redFactor","greenFactor","blueFactor","baseShift"],je=L.value.encoding?`"${L.value.encoding}"`:"Default";for(const Ze in Q)!Ie&&Je.includes(Ze)?ve.push(new ft(Ze,Q[Ze],`In "${q}": "${Ze}" is only valid when "encoding" is set to "custom". ${je} encoding found`)):ue[Ze]?ve=ve.concat(L.validateSpec({key:Ze,value:Q[Ze],valueSpec:ue[Ze],validateSpec:L.validateSpec,style:me,styleSpec:ae})):ve.push(new ft(Ze,Q[Ze],`unknown property "${Ze}"`));return ve}({sourceName:d,value:l,style:c.style,styleSpec:m,validateSpec:k}),z;case"geojson":if(z=Xa({key:d,value:l,valueSpec:m.source_geojson,style:_,styleSpec:m,validateSpec:k,objectElementValidators:ad}),l.cluster)for(const L in l.clusterProperties){const[F,q]=l.clusterProperties[L],Q=typeof F=="string"?[F,["accumulated"],["get",L]]:F;z.push(...ul({key:`${d}.${L}.map`,value:q,expressionContext:"cluster-map"})),z.push(...ul({key:`${d}.${L}.reduce`,value:Q,expressionContext:"cluster-reduce"}))}return z;case"video":return Xa({key:d,value:l,valueSpec:m.source_video,style:_,validateSpec:k,styleSpec:m});case"image":return Xa({key:d,value:l,valueSpec:m.source_image,style:_,validateSpec:k,styleSpec:m});case"canvas":return[new ft(d,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return gs({key:`${d}.type`,value:l.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function bf(c){const l=c.value,d=c.styleSpec,m=d.light,_=c.style;let k=[];const T=Rr(l);if(l===void 0)return k;if(T!=="object")return k=k.concat([new ft("light",l,`object expected, ${T} found`)]),k;for(const z in l){const L=z.match(/^(.*)-transition$/);k=k.concat(L&&m[L[1]]&&m[L[1]].transition?c.validateSpec({key:z,value:l[z],valueSpec:d.transition,validateSpec:c.validateSpec,style:_,styleSpec:d}):m[z]?c.validateSpec({key:z,value:l[z],valueSpec:m[z],validateSpec:c.validateSpec,style:_,styleSpec:d}):[new ft(z,l[z],`unknown property "${z}"`)])}return k}function _f(c){const l=c.value,d=c.styleSpec,m=d.sky,_=c.style,k=Rr(l);if(l===void 0)return[];if(k!=="object")return[new ft("sky",l,`object expected, ${k} found`)];let T=[];for(const z in l)T=T.concat(m[z]?c.validateSpec({key:z,value:l[z],valueSpec:m[z],style:_,styleSpec:d}):[new ft(z,l[z],`unknown property "${z}"`)]);return T}function wf(c){const l=c.value,d=c.styleSpec,m=d.terrain,_=c.style;let k=[];const T=Rr(l);if(l===void 0)return k;if(T!=="object")return k=k.concat([new ft("terrain",l,`object expected, ${T} found`)]),k;for(const z in l)k=k.concat(m[z]?c.validateSpec({key:z,value:l[z],valueSpec:m[z],validateSpec:c.validateSpec,style:_,styleSpec:d}):[new ft(z,l[z],`unknown property "${z}"`)]);return k}function Sf(c){let l=[];const d=c.value,m=c.key;if(Array.isArray(d)){const _=[],k=[];for(const T in d)d[T].id&&_.includes(d[T].id)&&l.push(new ft(m,d,`all the sprites' ids must be unique, but ${d[T].id} is duplicated`)),_.push(d[T].id),d[T].url&&k.includes(d[T].url)&&l.push(new ft(m,d,`all the sprites' URLs must be unique, but ${d[T].url} is duplicated`)),k.push(d[T].url),l=l.concat(Xa({key:`${m}[${T}]`,value:d[T],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:c.validateSpec}));return l}return bo({key:m,value:d})}const id={"*":()=>[],array:Mu,boolean:function(c){const l=c.value,d=c.key,m=Rr(l);return m!=="boolean"?[new ft(d,l,`boolean expected, ${m} found`)]:[]},number:mf,color:function(c){const l=c.key,d=c.value,m=Rr(d);return m!=="string"?[new ft(l,d,`color expected, ${m} found`)]:Mr.parse(String(d))?[]:[new ft(l,d,`color expected, "${d}" found`)]},constants:Tg,enum:gs,filter:gf,function:td,layer:xf,object:Xa,source:Du,light:bf,sky:_f,terrain:wf,projection:function(c){const l=c.value,d=c.styleSpec,m=d.projection,_=c.style,k=Rr(l);if(l===void 0)return[];if(k!=="object")return[new ft("projection",l,`object expected, ${k} found`)];let T=[];for(const z in l)T=T.concat(m[z]?c.validateSpec({key:z,value:l[z],valueSpec:m[z],style:_,styleSpec:d}):[new ft(z,l[z],`unknown property "${z}"`)]);return T},string:bo,formatted:function(c){return bo(c).length===0?[]:ul(c)},resolvedImage:function(c){return bo(c).length===0?[]:ul(c)},padding:function(c){const l=c.key,d=c.value;if(Rr(d)==="array"){if(d.length<1||d.length>4)return[new ft(l,d,`padding requires 1 to 4 values; ${d.length} values found`)];const m={type:"number"};let _=[];for(let k=0;k<d.length;k++)_=_.concat(c.validateSpec({key:`${l}[${k}]`,value:d[k],validateSpec:c.validateSpec,valueSpec:m}));return _}return mf({key:l,value:d,valueSpec:{}})},variableAnchorOffsetCollection:function(c){const l=c.key,d=c.value,m=Rr(d),_=c.styleSpec;if(m!=="array"||d.length<1||d.length%2!=0)return[new ft(l,d,"variableAnchorOffsetCollection requires a non-empty array of even length")];let k=[];for(let T=0;T<d.length;T+=2)k=k.concat(gs({key:`${l}[${T}]`,value:d[T],valueSpec:_.layout_symbol["text-anchor"]})),k=k.concat(Mu({key:`${l}[${T+1}]`,value:d[T+1],valueSpec:{length:2,value:"number"},validateSpec:c.validateSpec,style:c.style,styleSpec:_}));return k},sprite:Sf};function zu(c){const l=c.value,d=c.valueSpec,m=c.styleSpec;return c.validateSpec=zu,d.expression&&Zc(En(l))?td(c):d.expression&&Yc(Pi(l))?ul(c):d.type&&id[d.type]?id[d.type](c):Xa(fr({},c,{valueSpec:d.type?m[d.type]:d}))}function Pg(c){const l=c.value,d=c.key,m=bo(c);return m.length||(l.indexOf("{fontstack}")===-1&&m.push(new ft(d,l,'"glyphs" url must include a "{fontstack}" token')),l.indexOf("{range}")===-1&&m.push(new ft(d,l,'"glyphs" url must include a "{range}" token'))),m}function ui(c,l=$e){let d=[];return d=d.concat(zu({key:"",value:c,valueSpec:l.$root,styleSpec:l,style:c,validateSpec:zu,objectElementValidators:{glyphs:Pg,"*":()=>[]}})),c.constants&&(d=d.concat(Tg({key:"constants",value:c.constants}))),Ef(d)}function Xi(c){return function(l){return c({...l,validateSpec:zu})}}function Ef(c){return[].concat(c).sort((l,d)=>l.line-d.line)}function Ii(c){return function(...l){return Ef(c.apply(this,l))}}ui.source=Ii(Xi(Du)),ui.sprite=Ii(Xi(Sf)),ui.glyphs=Ii(Xi(Pg)),ui.light=Ii(Xi(bf)),ui.sky=Ii(Xi(_f)),ui.terrain=Ii(Xi(wf)),ui.layer=Ii(Xi(xf)),ui.filter=Ii(Xi(gf)),ui.paintProperty=Ii(Xi(nd)),ui.layoutProperty=Ii(Xi(yf));const _o=ui,Dx=_o.light,zx=_o.sky,Ig=_o.paintProperty,Ag=_o.layoutProperty;function Cf(c,l){let d=!1;if(l&&l.length)for(const m of l)c.fire(new xt(new Error(m.message))),d=!0;return d}class cl{constructor(l,d,m){const _=this.cells=[];if(l instanceof ArrayBuffer){this.arrayBuffer=l;const T=new Int32Array(this.arrayBuffer);l=T[0],this.d=(d=T[1])+2*(m=T[2]);for(let L=0;L<this.d*this.d;L++){const F=T[3+L],q=T[3+L+1];_.push(F===q?null:T.subarray(F,q))}const z=T[3+_.length+1];this.keys=T.subarray(T[3+_.length],z),this.bboxes=T.subarray(z),this.insert=this._insertReadonly}else{this.d=d+2*m;for(let T=0;T<this.d*this.d;T++)_.push([]);this.keys=[],this.bboxes=[]}this.n=d,this.extent=l,this.padding=m,this.scale=d/l,this.uid=0;const k=m/d*l;this.min=-k,this.max=l+k}insert(l,d,m,_,k){this._forEachCell(d,m,_,k,this._insertCell,this.uid++,void 0,void 0),this.keys.push(l),this.bboxes.push(d),this.bboxes.push(m),this.bboxes.push(_),this.bboxes.push(k)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(l,d,m,_,k,T){this.cells[k].push(T)}query(l,d,m,_,k){const T=this.min,z=this.max;if(l<=T&&d<=T&&z<=m&&z<=_&&!k)return Array.prototype.slice.call(this.keys);{const L=[];return this._forEachCell(l,d,m,_,this._queryCell,L,{},k),L}}_queryCell(l,d,m,_,k,T,z,L){const F=this.cells[k];if(F!==null){const q=this.keys,Q=this.bboxes;for(let ae=0;ae<F.length;ae++){const ue=F[ae];if(z[ue]===void 0){const me=4*ue;(L?L(Q[me+0],Q[me+1],Q[me+2],Q[me+3]):l<=Q[me+2]&&d<=Q[me+3]&&m>=Q[me+0]&&_>=Q[me+1])?(z[ue]=!0,T.push(q[ue])):z[ue]=!1}}}}_forEachCell(l,d,m,_,k,T,z,L){const F=this._convertToCellCoord(l),q=this._convertToCellCoord(d),Q=this._convertToCellCoord(m),ae=this._convertToCellCoord(_);for(let ue=F;ue<=Q;ue++)for(let me=q;me<=ae;me++){const ve=this.d*me+ue;if((!L||L(this._convertFromCellCoord(ue),this._convertFromCellCoord(me),this._convertFromCellCoord(ue+1),this._convertFromCellCoord(me+1)))&&k.call(this,l,d,m,_,ve,T,z,L))return}}_convertFromCellCoord(l){return(l-this.padding)/this.scale}_convertToCellCoord(l){return Math.max(0,Math.min(this.d-1,Math.floor(l*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const l=this.cells,d=3+this.cells.length+1+1;let m=0;for(let T=0;T<this.cells.length;T++)m+=this.cells[T].length;const _=new Int32Array(d+m+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;let k=d;for(let T=0;T<l.length;T++){const z=l[T];_[3+T]=k,_.set(z,k),k+=z.length}return _[3+l.length]=k,_.set(this.keys,k),k+=this.keys.length,_[3+l.length+1]=k,_.set(this.bboxes,k),k+=this.bboxes.length,_.buffer}static serialize(l,d){const m=l.toArrayBuffer();return d&&d.push(m),{buffer:m}}static deserialize(l){return new cl(l.buffer)}}const ci={};function Wt(c,l,d={}){if(ci[c])throw new Error(`${c} is already registered.`);Object.defineProperty(l,"_classRegistryKey",{value:c,writeable:!1}),ci[c]={klass:l,omit:d.omit||[],shallow:d.shallow||[]}}Wt("Object",Object),Wt("TransferableGridIndex",cl),Wt("Color",Mr),Wt("Error",Error),Wt("AJAXError",nt),Wt("ResolvedImage",vn),Wt("StylePropertyFunction",ll),Wt("StyleExpression",Kc,{omit:["_evaluator"]}),Wt("ZoomDependentExpression",ol),Wt("ZoomConstantExpression",sl),Wt("CompoundExpression",li,{omit:["_evaluate"]});for(const c in el)el[c]._classRegistryKey||Wt(`Expression_${c}`,el[c]);function sd(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function kf(c){return c.$name||c.constructor._classRegistryKey}function Ng(c){return!function(l){if(l===null||typeof l!="object")return!1;const d=kf(l);return!(!d||d==="Object")}(c)&&(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||c instanceof Error||sd(c)||ce(c)||ArrayBuffer.isView(c)||c instanceof ImageData)}function dl(c,l){if(Ng(c))return(sd(c)||ce(c))&&l&&l.push(c),ArrayBuffer.isView(c)&&l&&l.push(c.buffer),c instanceof ImageData&&l&&l.push(c.data.buffer),c;if(Array.isArray(c)){const k=[];for(const T of c)k.push(dl(T,l));return k}if(typeof c!="object")throw new Error("can't serialize object of type "+typeof c);const d=kf(c);if(!d)throw new Error(`can't serialize object of unregistered class ${c.constructor.name}`);if(!ci[d])throw new Error(`${d} is not registered.`);const{klass:m}=ci[d],_=m.serialize?m.serialize(c,l):{};if(m.serialize){if(l&&_===l[l.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const k in c){if(!c.hasOwnProperty(k)||ci[d].omit.indexOf(k)>=0)continue;const T=c[k];_[k]=ci[d].shallow.indexOf(k)>=0?T:dl(T,l)}c instanceof Error&&(_.message=c.message)}if(_.$name)throw new Error("$name property is reserved for worker serialization logic.");return d!=="Object"&&(_.$name=d),_}function hl(c){if(Ng(c))return c;if(Array.isArray(c))return c.map(hl);if(typeof c!="object")throw new Error("can't deserialize object of type "+typeof c);const l=kf(c)||"Object";if(!ci[l])throw new Error(`can't deserialize unregistered class ${l}`);const{klass:d}=ci[l];if(!d)throw new Error(`can't deserialize unregistered class ${l}`);if(d.deserialize)return d.deserialize(c);const m=Object.create(d.prototype);for(const _ of Object.keys(c)){if(_==="$name")continue;const k=c[_];m[_]=ci[l].shallow.indexOf(_)>=0?k:hl(k)}return m}class Tf{constructor(){this.first=!0}update(l,d){const m=Math.floor(l);return this.first?(this.first=!1,this.lastIntegerZoom=m,this.lastIntegerZoomTime=0,this.lastZoom=l,this.lastFloorZoom=m,!0):(this.lastFloorZoom>m?(this.lastIntegerZoom=m+1,this.lastIntegerZoomTime=d):this.lastFloorZoom<m&&(this.lastIntegerZoom=m,this.lastIntegerZoomTime=d),l!==this.lastZoom&&(this.lastZoom=l,this.lastFloorZoom=m,!0))}}const Ir={"Latin-1 Supplement":c=>c>=128&&c<=255,"Hangul Jamo":c=>c>=4352&&c<=4607,Khmer:c=>c>=6016&&c<=6143,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Katakana:c=>c>=12448&&c<=12543,Kanbun:c=>c>=12688&&c<=12703,"CJK Strokes":c=>c>=12736&&c<=12783,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"Private Use Area":c=>c>=57344&&c<=63743,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519};function Pf(c){for(const l of c)if(Af(l.charCodeAt(0)))return!0;return!1}function Rx(c){for(const l of c)if(!fl(l.charCodeAt(0)))return!1;return!0}function If(c){const l=c.map(d=>{try{return new RegExp(`\\p{sc=${d}}`,"u").source}catch{return null}}).filter(d=>d);return new RegExp(l.join("|"),"u")}const Lx=If(["Arab","Dupl","Mong","Ougr","Syrc"]);function fl(c){return!Lx.test(String.fromCodePoint(c))}const Mg=If(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Af(c){return!(c!==746&&c!==747&&(c<4352||!(Ir["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||Ir["CJK Compatibility"](c)||Ir["CJK Strokes"](c)||!(!Ir["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||Ir["Enclosed CJK Letters and Months"](c)||Ir["Ideographic Description Characters"](c)||Ir.Kanbun(c)||Ir.Katakana(c)&&c!==12540||!(!Ir["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!Ir["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||Ir["Vertical Forms"](c)||Ir["Yijing Hexagram Symbols"](c)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(c))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(c))||Mg.test(String.fromCodePoint(c)))))}function Dg(c){return!(Af(c)||function(l){return!!(Ir["Latin-1 Supplement"](l)&&(l===167||l===169||l===174||l===177||l===188||l===189||l===190||l===215||l===247)||Ir["General Punctuation"](l)&&(l===8214||l===8224||l===8225||l===8240||l===8241||l===8251||l===8252||l===8258||l===8263||l===8264||l===8265||l===8273)||Ir["Letterlike Symbols"](l)||Ir["Number Forms"](l)||Ir["Miscellaneous Technical"](l)&&(l>=8960&&l<=8967||l>=8972&&l<=8991||l>=8996&&l<=9e3||l===9003||l>=9085&&l<=9114||l>=9150&&l<=9165||l===9167||l>=9169&&l<=9179||l>=9186&&l<=9215)||Ir["Control Pictures"](l)&&l!==9251||Ir["Optical Character Recognition"](l)||Ir["Enclosed Alphanumerics"](l)||Ir["Geometric Shapes"](l)||Ir["Miscellaneous Symbols"](l)&&!(l>=9754&&l<=9759)||Ir["Miscellaneous Symbols and Arrows"](l)&&(l>=11026&&l<=11055||l>=11088&&l<=11097||l>=11192&&l<=11243)||Ir["CJK Symbols and Punctuation"](l)||Ir.Katakana(l)||Ir["Private Use Area"](l)||Ir["CJK Compatibility Forms"](l)||Ir["Small Form Variants"](l)||Ir["Halfwidth and Fullwidth Forms"](l)||l===8734||l===8756||l===8757||l>=9984&&l<=10087||l>=10102&&l<=10131||l===65532||l===65533)}(c))}const Bx=If(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Nf(c){return Bx.test(String.fromCodePoint(c))}function jx(c,l){return!(!l&&Nf(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||Ir.Khmer(c))}function Ox(c){for(const l of c)if(Nf(l.charCodeAt(0)))return!0;return!1}const Ka=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(c){this.pluginStatus=c.pluginStatus,this.pluginURL=c.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(c){this.applyArabicShaping=c.applyArabicShaping,this.processBidirectionalText=c.processBidirectionalText,this.processStyledBidirectionalText=c.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class nn{constructor(l,d){this.zoom=l,d?(this.now=d.now,this.fadeDuration=d.fadeDuration,this.zoomHistory=d.zoomHistory,this.transition=d.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Tf,this.transition={})}isSupportedScript(l){return function(d,m){for(const _ of d)if(!jx(_.charCodeAt(0),m))return!1;return!0}(l,Ka.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const l=this.zoom,d=l-Math.floor(l),m=this.crossFadingFactor();return l>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:d+(1-d)*m}:{fromScale:.5,toScale:1,t:1-(1-m)*d}}}class pl{constructor(l,d){this.property=l,this.value=d,this.expression=function(m,_){if(Zc(m))return new ll(m,_);if(Yc(m)){const k=hf(m,_);if(k.result==="error")throw new Error(k.value.map(T=>`${T.key}: ${T.message}`).join(", "));return k.value}{let k=m;return _.type==="color"&&typeof m=="string"?k=Mr.parse(m):_.type!=="padding"||typeof m!="number"&&!Array.isArray(m)?_.type==="variableAnchorOffsetCollection"&&Array.isArray(m)&&(k=Gr.parse(m)):k=or.parse(m),{kind:"constant",evaluate:()=>k}}}(d===void 0?l.specification.default:d,l.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(l,d,m){return this.property.possiblyEvaluate(this,l,d,m)}}class od{constructor(l){this.property=l,this.value=new pl(l,void 0)}transitioned(l,d){return new zg(this.property,this.value,d,$({},l.transition,this.transition),l.now)}untransitioned(){return new zg(this.property,this.value,null,{},0)}}class ld{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitionablePropertyValues)}getValue(l){return Z(this._values[l].value.value)}setValue(l,d){Object.prototype.hasOwnProperty.call(this._values,l)||(this._values[l]=new od(this._values[l].property)),this._values[l].value=new pl(this._values[l].property,d===null?void 0:Z(d))}getTransition(l){return Z(this._values[l].transition)}setTransition(l,d){Object.prototype.hasOwnProperty.call(this._values,l)||(this._values[l]=new od(this._values[l].property)),this._values[l].transition=Z(d)||void 0}serialize(){const l={};for(const d of Object.keys(this._values)){const m=this.getValue(d);m!==void 0&&(l[d]=m);const _=this.getTransition(d);_!==void 0&&(l[`${d}-transition`]=_)}return l}transitioned(l,d){const m=new Ru(this._properties);for(const _ of Object.keys(this._values))m._values[_]=this._values[_].transitioned(l,d._values[_]);return m}untransitioned(){const l=new Ru(this._properties);for(const d of Object.keys(this._values))l._values[d]=this._values[d].untransitioned();return l}}class zg{constructor(l,d,m,_,k){this.property=l,this.value=d,this.begin=k+_.delay||0,this.end=this.begin+_.duration||0,l.specification.transition&&(_.delay||_.duration)&&(this.prior=m)}possiblyEvaluate(l,d,m){const _=l.now||0,k=this.value.possiblyEvaluate(l,d,m),T=this.prior;if(T){if(_>this.end)return this.prior=null,k;if(this.value.isDataDriven())return this.prior=null,k;if(_<this.begin)return T.possiblyEvaluate(l,d,m);{const z=(_-this.begin)/(this.end-this.begin);return this.property.interpolate(T.possiblyEvaluate(l,d,m),k,function(L){if(L<=0)return 0;if(L>=1)return 1;const F=L*L,q=F*L;return 4*(L<.5?q:3*(L-F)+q-.75)}(z))}}return k}}class Ru{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitioningPropertyValues)}possiblyEvaluate(l,d,m){const _=new Bu(this._properties);for(const k of Object.keys(this._values))_._values[k]=this._values[k].possiblyEvaluate(l,d,m);return _}hasTransition(){for(const l of Object.keys(this._values))if(this._values[l].prior)return!0;return!1}}class Lu{constructor(l){this._properties=l,this._values=Object.create(l.defaultPropertyValues)}hasValue(l){return this._values[l].value!==void 0}getValue(l){return Z(this._values[l].value)}setValue(l,d){this._values[l]=new pl(this._values[l].property,d===null?void 0:Z(d))}serialize(){const l={};for(const d of Object.keys(this._values)){const m=this.getValue(d);m!==void 0&&(l[d]=m)}return l}possiblyEvaluate(l,d,m){const _=new Bu(this._properties);for(const k of Object.keys(this._values))_._values[k]=this._values[k].possiblyEvaluate(l,d,m);return _}}class Ki{constructor(l,d,m){this.property=l,this.value=d,this.parameters=m}isConstant(){return this.value.kind==="constant"}constantOr(l){return this.value.kind==="constant"?this.value.value:l}evaluate(l,d,m,_){return this.property.evaluate(this.value,this.parameters,l,d,m,_)}}class Bu{constructor(l){this._properties=l,this._values=Object.create(l.defaultPossiblyEvaluatedValues)}get(l){return this._values[l]}}class Yt{constructor(l){this.specification=l}possiblyEvaluate(l,d){if(l.isDataDriven())throw new Error("Value should not be data driven");return l.expression.evaluate(d)}interpolate(l,d,m){const _=Ma[this.specification.type];return _?_(l,d,m):l}}class ur{constructor(l,d){this.specification=l,this.overrides=d}possiblyEvaluate(l,d,m,_){return new Ki(this,l.expression.kind==="constant"||l.expression.kind==="camera"?{kind:"constant",value:l.expression.evaluate(d,null,{},m,_)}:l.expression,d)}interpolate(l,d,m){if(l.value.kind!=="constant"||d.value.kind!=="constant")return l;if(l.value.value===void 0||d.value.value===void 0)return new Ki(this,{kind:"constant",value:void 0},l.parameters);const _=Ma[this.specification.type];if(_){const k=_(l.value.value,d.value.value,m);return new Ki(this,{kind:"constant",value:k},l.parameters)}return l}evaluate(l,d,m,_,k,T){return l.kind==="constant"?l.value:l.evaluate(d,m,_,k,T)}}class ud extends ur{possiblyEvaluate(l,d,m,_){if(l.value===void 0)return new Ki(this,{kind:"constant",value:void 0},d);if(l.expression.kind==="constant"){const k=l.expression.evaluate(d,null,{},m,_),T=l.property.specification.type==="resolvedImage"&&typeof k!="string"?k.name:k,z=this._calculate(T,T,T,d);return new Ki(this,{kind:"constant",value:z},d)}if(l.expression.kind==="camera"){const k=this._calculate(l.expression.evaluate({zoom:d.zoom-1}),l.expression.evaluate({zoom:d.zoom}),l.expression.evaluate({zoom:d.zoom+1}),d);return new Ki(this,{kind:"constant",value:k},d)}return new Ki(this,l.expression,d)}evaluate(l,d,m,_,k,T){if(l.kind==="source"){const z=l.evaluate(d,m,_,k,T);return this._calculate(z,z,z,d)}return l.kind==="composite"?this._calculate(l.evaluate({zoom:Math.floor(d.zoom)-1},m,_),l.evaluate({zoom:Math.floor(d.zoom)},m,_),l.evaluate({zoom:Math.floor(d.zoom)+1},m,_),d):l.value}_calculate(l,d,m,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:l,to:d}:{from:m,to:d}}interpolate(l){return l}}class cd{constructor(l){this.specification=l}possiblyEvaluate(l,d,m,_){if(l.value!==void 0){if(l.expression.kind==="constant"){const k=l.expression.evaluate(d,null,{},m,_);return this._calculate(k,k,k,d)}return this._calculate(l.expression.evaluate(new nn(Math.floor(d.zoom-1),d)),l.expression.evaluate(new nn(Math.floor(d.zoom),d)),l.expression.evaluate(new nn(Math.floor(d.zoom+1),d)),d)}}_calculate(l,d,m,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:l,to:d}:{from:m,to:d}}interpolate(l){return l}}class Mf{constructor(l){this.specification=l}possiblyEvaluate(l,d,m,_){return!!l.expression.evaluate(d,null,{},m,_)}interpolate(){return!1}}class C{constructor(l){this.properties=l,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const d in l){const m=l[d];m.specification.overridable&&this.overridableProperties.push(d);const _=this.defaultPropertyValues[d]=new pl(m,void 0),k=this.defaultTransitionablePropertyValues[d]=new od(m);this.defaultTransitioningPropertyValues[d]=k.untransitioned(),this.defaultPossiblyEvaluatedValues[d]=_.possiblyEvaluate({})}}}Wt("DataDrivenProperty",ur),Wt("DataConstantProperty",Yt),Wt("CrossFadedDataDrivenProperty",ud),Wt("CrossFadedProperty",cd),Wt("ColorRampProperty",Mf);const o="-transition";class f extends Tt{constructor(l,d){if(super(),this.id=l.id,this.type=l.type,this._featureFilter={filter:()=>!0,needGeometry:!1},l.type!=="custom"&&(this.metadata=l.metadata,this.minzoom=l.minzoom,this.maxzoom=l.maxzoom,l.type!=="background"&&(this.source=l.source,this.sourceLayer=l["source-layer"],this.filter=l.filter),d.layout&&(this._unevaluatedLayout=new Lu(d.layout)),d.paint)){this._transitionablePaint=new ld(d.paint);for(const m in l.paint)this.setPaintProperty(m,l.paint[m],{validate:!1});for(const m in l.layout)this.setLayoutProperty(m,l.layout[m],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Bu(d.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(l){return l==="visibility"?this.visibility:this._unevaluatedLayout.getValue(l)}setLayoutProperty(l,d,m={}){d!=null&&this._validate(Ag,`layers.${this.id}.layout.${l}`,l,d,m)||(l!=="visibility"?this._unevaluatedLayout.setValue(l,d):this.visibility=d)}getPaintProperty(l){return l.endsWith(o)?this._transitionablePaint.getTransition(l.slice(0,-11)):this._transitionablePaint.getValue(l)}setPaintProperty(l,d,m={}){if(d!=null&&this._validate(Ig,`layers.${this.id}.paint.${l}`,l,d,m))return!1;if(l.endsWith(o))return this._transitionablePaint.setTransition(l.slice(0,-11),d||void 0),!1;{const _=this._transitionablePaint._values[l],k=_.property.specification["property-type"]==="cross-faded-data-driven",T=_.value.isDataDriven(),z=_.value;this._transitionablePaint.setValue(l,d),this._handleSpecialPaintPropertyUpdate(l);const L=this._transitionablePaint._values[l].value;return L.isDataDriven()||T||k||this._handleOverridablePaintPropertyUpdate(l,z,L)}}_handleSpecialPaintPropertyUpdate(l){}_handleOverridablePaintPropertyUpdate(l,d,m){return!1}isHidden(l){return!!(this.minzoom&&l<this.minzoom)||!!(this.maxzoom&&l>=this.maxzoom)||this.visibility==="none"}updateTransitions(l){this._transitioningPaint=this._transitionablePaint.transitioned(l,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(l,d){l.getCrossfadeParameters&&(this._crossfadeParameters=l.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(l,void 0,d)),this.paint=this._transitioningPaint.possiblyEvaluate(l,void 0,d)}serialize(){const l={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(l.layout=l.layout||{},l.layout.visibility=this.visibility),J(l,(d,m)=>!(d===void 0||m==="layout"&&!Object.keys(d).length||m==="paint"&&!Object.keys(d).length))}_validate(l,d,m,_,k={}){return(!k||k.validate!==!1)&&Cf(this,l.call(_o,{key:d,layerType:this.type,objectKey:m,value:_,styleSpec:$e,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const l in this.paint._values){const d=this.paint.get(l);if(d instanceof Ki&&nl(d.property.specification)&&(d.value.kind==="source"||d.value.kind==="composite")&&d.value.isStateDependent)return!0}return!1}}const y={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class b{constructor(l,d){this._structArray=l,this._pos1=d*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class E{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(l,d){return l._trim(),d&&(l.isTransferred=!0,d.push(l.arrayBuffer)),{length:l.length,arrayBuffer:l.arrayBuffer}}static deserialize(l){const d=Object.create(this.prototype);return d.arrayBuffer=l.arrayBuffer,d.length=l.length,d.capacity=l.arrayBuffer.byteLength/d.bytesPerElement,d._refreshViews(),d}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(l){this.reserve(l),this.length=l}reserve(l){if(l>this.capacity){this.capacity=Math.max(l,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const d=this.uint8;this._refreshViews(),d&&this.uint8.set(d)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function R(c,l=1){let d=0,m=0;return{members:c.map(_=>{const k=y[_.type].BYTES_PER_ELEMENT,T=d=B(d,Math.max(l,k)),z=_.components||1;return m=Math.max(m,k),d+=k*z,{name:_.name,type:_.type,components:z,offset:T}}),size:B(d,Math.max(m,l)),alignment:l}}function B(c,l){return Math.ceil(c/l)*l}class O extends E{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d){const m=this.length;return this.resize(m+1),this.emplace(m,l,d)}emplace(l,d,m){const _=2*l;return this.int16[_+0]=d,this.int16[_+1]=m,l}}O.prototype.bytesPerElement=4,Wt("StructArrayLayout2i4",O);class H extends E{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,m){const _=this.length;return this.resize(_+1),this.emplace(_,l,d,m)}emplace(l,d,m,_){const k=3*l;return this.int16[k+0]=d,this.int16[k+1]=m,this.int16[k+2]=_,l}}H.prototype.bytesPerElement=6,Wt("StructArrayLayout3i6",H);class ee extends E{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,m,_){const k=this.length;return this.resize(k+1),this.emplace(k,l,d,m,_)}emplace(l,d,m,_,k){const T=4*l;return this.int16[T+0]=d,this.int16[T+1]=m,this.int16[T+2]=_,this.int16[T+3]=k,l}}ee.prototype.bytesPerElement=8,Wt("StructArrayLayout4i8",ee);class te extends E{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,m,_,k,T){const z=this.length;return this.resize(z+1),this.emplace(z,l,d,m,_,k,T)}emplace(l,d,m,_,k,T,z){const L=6*l;return this.int16[L+0]=d,this.int16[L+1]=m,this.int16[L+2]=_,this.int16[L+3]=k,this.int16[L+4]=T,this.int16[L+5]=z,l}}te.prototype.bytesPerElement=12,Wt("StructArrayLayout2i4i12",te);class he extends E{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,m,_,k,T){const z=this.length;return this.resize(z+1),this.emplace(z,l,d,m,_,k,T)}emplace(l,d,m,_,k,T,z){const L=4*l,F=8*l;return this.int16[L+0]=d,this.int16[L+1]=m,this.uint8[F+4]=_,this.uint8[F+5]=k,this.uint8[F+6]=T,this.uint8[F+7]=z,l}}he.prototype.bytesPerElement=8,Wt("StructArrayLayout2i4ub8",he);class ye extends E{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d){const m=this.length;return this.resize(m+1),this.emplace(m,l,d)}emplace(l,d,m){const _=2*l;return this.float32[_+0]=d,this.float32[_+1]=m,l}}ye.prototype.bytesPerElement=8,Wt("StructArrayLayout2f8",ye);class Se extends E{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,m,_,k,T,z,L,F,q){const Q=this.length;return this.resize(Q+1),this.emplace(Q,l,d,m,_,k,T,z,L,F,q)}emplace(l,d,m,_,k,T,z,L,F,q,Q){const ae=10*l;return this.uint16[ae+0]=d,this.uint16[ae+1]=m,this.uint16[ae+2]=_,this.uint16[ae+3]=k,this.uint16[ae+4]=T,this.uint16[ae+5]=z,this.uint16[ae+6]=L,this.uint16[ae+7]=F,this.uint16[ae+8]=q,this.uint16[ae+9]=Q,l}}Se.prototype.bytesPerElement=20,Wt("StructArrayLayout10ui20",Se);class ke extends E{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,m,_,k,T,z,L,F,q,Q,ae){const ue=this.length;return this.resize(ue+1),this.emplace(ue,l,d,m,_,k,T,z,L,F,q,Q,ae)}emplace(l,d,m,_,k,T,z,L,F,q,Q,ae,ue){const me=12*l;return this.int16[me+0]=d,this.int16[me+1]=m,this.int16[me+2]=_,this.int16[me+3]=k,this.uint16[me+4]=T,this.uint16[me+5]=z,this.uint16[me+6]=L,this.uint16[me+7]=F,this.int16[me+8]=q,this.int16[me+9]=Q,this.int16[me+10]=ae,this.int16[me+11]=ue,l}}ke.prototype.bytesPerElement=24,Wt("StructArrayLayout4i4ui4i24",ke);class Ae extends E{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,m){const _=this.length;return this.resize(_+1),this.emplace(_,l,d,m)}emplace(l,d,m,_){const k=3*l;return this.float32[k+0]=d,this.float32[k+1]=m,this.float32[k+2]=_,l}}Ae.prototype.bytesPerElement=12,Wt("StructArrayLayout3f12",Ae);class Me extends E{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(l){const d=this.length;return this.resize(d+1),this.emplace(d,l)}emplace(l,d){return this.uint32[1*l+0]=d,l}}Me.prototype.bytesPerElement=4,Wt("StructArrayLayout1ul4",Me);class Re extends E{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,m,_,k,T,z,L,F){const q=this.length;return this.resize(q+1),this.emplace(q,l,d,m,_,k,T,z,L,F)}emplace(l,d,m,_,k,T,z,L,F,q){const Q=10*l,ae=5*l;return this.int16[Q+0]=d,this.int16[Q+1]=m,this.int16[Q+2]=_,this.int16[Q+3]=k,this.int16[Q+4]=T,this.int16[Q+5]=z,this.uint32[ae+3]=L,this.uint16[Q+8]=F,this.uint16[Q+9]=q,l}}Re.prototype.bytesPerElement=20,Wt("StructArrayLayout6i1ul2ui20",Re);class Ee extends E{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,m,_,k,T){const z=this.length;return this.resize(z+1),this.emplace(z,l,d,m,_,k,T)}emplace(l,d,m,_,k,T,z){const L=6*l;return this.int16[L+0]=d,this.int16[L+1]=m,this.int16[L+2]=_,this.int16[L+3]=k,this.int16[L+4]=T,this.int16[L+5]=z,l}}Ee.prototype.bytesPerElement=12,Wt("StructArrayLayout2i2i2i12",Ee);class Ve extends E{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,m,_,k){const T=this.length;return this.resize(T+1),this.emplace(T,l,d,m,_,k)}emplace(l,d,m,_,k,T){const z=4*l,L=8*l;return this.float32[z+0]=d,this.float32[z+1]=m,this.float32[z+2]=_,this.int16[L+6]=k,this.int16[L+7]=T,l}}Ve.prototype.bytesPerElement=16,Wt("StructArrayLayout2f1f2i16",Ve);class Ge extends E{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,m,_,k,T){const z=this.length;return this.resize(z+1),this.emplace(z,l,d,m,_,k,T)}emplace(l,d,m,_,k,T,z){const L=16*l,F=4*l,q=8*l;return this.uint8[L+0]=d,this.uint8[L+1]=m,this.float32[F+1]=_,this.float32[F+2]=k,this.int16[q+6]=T,this.int16[q+7]=z,l}}Ge.prototype.bytesPerElement=16,Wt("StructArrayLayout2ub2f2i16",Ge);class tt extends E{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,m){const _=this.length;return this.resize(_+1),this.emplace(_,l,d,m)}emplace(l,d,m,_){const k=3*l;return this.uint16[k+0]=d,this.uint16[k+1]=m,this.uint16[k+2]=_,l}}tt.prototype.bytesPerElement=6,Wt("StructArrayLayout3ui6",tt);class yt extends E{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,m,_,k,T,z,L,F,q,Q,ae,ue,me,ve,Ce,Ie){const Je=this.length;return this.resize(Je+1),this.emplace(Je,l,d,m,_,k,T,z,L,F,q,Q,ae,ue,me,ve,Ce,Ie)}emplace(l,d,m,_,k,T,z,L,F,q,Q,ae,ue,me,ve,Ce,Ie,Je){const je=24*l,Ze=12*l,ct=48*l;return this.int16[je+0]=d,this.int16[je+1]=m,this.uint16[je+2]=_,this.uint16[je+3]=k,this.uint32[Ze+2]=T,this.uint32[Ze+3]=z,this.uint32[Ze+4]=L,this.uint16[je+10]=F,this.uint16[je+11]=q,this.uint16[je+12]=Q,this.float32[Ze+7]=ae,this.float32[Ze+8]=ue,this.uint8[ct+36]=me,this.uint8[ct+37]=ve,this.uint8[ct+38]=Ce,this.uint32[Ze+10]=Ie,this.int16[je+22]=Je,l}}yt.prototype.bytesPerElement=48,Wt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",yt);class Ct extends E{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,m,_,k,T,z,L,F,q,Q,ae,ue,me,ve,Ce,Ie,Je,je,Ze,ct,_t,$t,lr,Lt,zt,er,Zt){const Gt=this.length;return this.resize(Gt+1),this.emplace(Gt,l,d,m,_,k,T,z,L,F,q,Q,ae,ue,me,ve,Ce,Ie,Je,je,Ze,ct,_t,$t,lr,Lt,zt,er,Zt)}emplace(l,d,m,_,k,T,z,L,F,q,Q,ae,ue,me,ve,Ce,Ie,Je,je,Ze,ct,_t,$t,lr,Lt,zt,er,Zt,Gt){const pt=32*l,tr=16*l;return this.int16[pt+0]=d,this.int16[pt+1]=m,this.int16[pt+2]=_,this.int16[pt+3]=k,this.int16[pt+4]=T,this.int16[pt+5]=z,this.int16[pt+6]=L,this.int16[pt+7]=F,this.uint16[pt+8]=q,this.uint16[pt+9]=Q,this.uint16[pt+10]=ae,this.uint16[pt+11]=ue,this.uint16[pt+12]=me,this.uint16[pt+13]=ve,this.uint16[pt+14]=Ce,this.uint16[pt+15]=Ie,this.uint16[pt+16]=Je,this.uint16[pt+17]=je,this.uint16[pt+18]=Ze,this.uint16[pt+19]=ct,this.uint16[pt+20]=_t,this.uint16[pt+21]=$t,this.uint16[pt+22]=lr,this.uint32[tr+12]=Lt,this.float32[tr+13]=zt,this.float32[tr+14]=er,this.uint16[pt+30]=Zt,this.uint16[pt+31]=Gt,l}}Ct.prototype.bytesPerElement=64,Wt("StructArrayLayout8i15ui1ul2f2ui64",Ct);class Rt extends E{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l){const d=this.length;return this.resize(d+1),this.emplace(d,l)}emplace(l,d){return this.float32[1*l+0]=d,l}}Rt.prototype.bytesPerElement=4,Wt("StructArrayLayout1f4",Rt);class qt extends E{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,m){const _=this.length;return this.resize(_+1),this.emplace(_,l,d,m)}emplace(l,d,m,_){const k=3*l;return this.uint16[6*l+0]=d,this.float32[k+1]=m,this.float32[k+2]=_,l}}qt.prototype.bytesPerElement=12,Wt("StructArrayLayout1ui2f12",qt);class Nt extends E{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,m){const _=this.length;return this.resize(_+1),this.emplace(_,l,d,m)}emplace(l,d,m,_){const k=4*l;return this.uint32[2*l+0]=d,this.uint16[k+2]=m,this.uint16[k+3]=_,l}}Nt.prototype.bytesPerElement=8,Wt("StructArrayLayout1ul2ui8",Nt);class It extends E{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d){const m=this.length;return this.resize(m+1),this.emplace(m,l,d)}emplace(l,d,m){const _=2*l;return this.uint16[_+0]=d,this.uint16[_+1]=m,l}}It.prototype.bytesPerElement=4,Wt("StructArrayLayout2ui4",It);class Jt extends E{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l){const d=this.length;return this.resize(d+1),this.emplace(d,l)}emplace(l,d){return this.uint16[1*l+0]=d,l}}Jt.prototype.bytesPerElement=2,Wt("StructArrayLayout1ui2",Jt);class vr extends E{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,m,_){const k=this.length;return this.resize(k+1),this.emplace(k,l,d,m,_)}emplace(l,d,m,_,k){const T=4*l;return this.float32[T+0]=d,this.float32[T+1]=m,this.float32[T+2]=_,this.float32[T+3]=k,l}}vr.prototype.bytesPerElement=16,Wt("StructArrayLayout4f16",vr);class Dt extends b{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new v(this.anchorPointX,this.anchorPointY)}}Dt.prototype.size=20;class jt extends Re{get(l){return new Dt(this,l)}}Wt("CollisionBoxArray",jt);class mr extends b{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(l){this._structArray.uint8[this._pos1+37]=l}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(l){this._structArray.uint8[this._pos1+38]=l}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(l){this._structArray.uint32[this._pos4+10]=l}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}mr.prototype.size=48;class an extends yt{get(l){return new mr(this,l)}}Wt("PlacedSymbolArray",an);class Sr extends b{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(l){this._structArray.uint32[this._pos4+12]=l}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Sr.prototype.size=64;class Pr extends Ct{get(l){return new Sr(this,l)}}Wt("SymbolInstanceArray",Pr);class sn extends Rt{getoffsetX(l){return this.float32[1*l+0]}}Wt("GlyphOffsetArray",sn);class sa extends H{getx(l){return this.int16[3*l+0]}gety(l){return this.int16[3*l+1]}gettileUnitDistanceFromAnchor(l){return this.int16[3*l+2]}}Wt("SymbolLineVertexArray",sa);class Ai extends b{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Ai.prototype.size=12;class on extends qt{get(l){return new Ai(this,l)}}Wt("TextAnchorOffsetArray",on);class za extends b{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}za.prototype.size=8;class xa extends Nt{get(l){return new za(this,l)}}Wt("FeatureIndexArray",xa);class oa extends O{}class ba extends O{}class Yi extends O{}class ml extends te{}class dd extends he{}class gl extends ye{}class di extends Se{}class hd extends ke{}class Df extends Ae{}class hi extends Me{}class fi extends Ee{}class $s extends Ge{}class Ni extends tt{}class Xn extends It{}const la=R([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ya}=la;class Ar{constructor(l=[]){this.segments=l}prepareSegment(l,d,m,_){let k=this.segments[this.segments.length-1];return l>Ar.MAX_VERTEX_ARRAY_LENGTH&&Y(`Max vertices per segment is ${Ar.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${l}`),(!k||k.vertexLength+l>Ar.MAX_VERTEX_ARRAY_LENGTH||k.sortKey!==_)&&(k={vertexOffset:d.length,primitiveOffset:m.length,vertexLength:0,primitiveLength:0},_!==void 0&&(k.sortKey=_),this.segments.push(k)),k}get(){return this.segments}destroy(){for(const l of this.segments)for(const d in l.vaos)l.vaos[d].destroy()}static simpleSegment(l,d,m,_){return new Ar([{vertexOffset:l,primitiveOffset:d,vertexLength:m,primitiveLength:_,vaos:{},sortKey:0}])}}function wo(c,l){return 256*(c=V(Math.floor(c),0,255))+V(Math.floor(l),0,255)}Ar.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Wt("SegmentVector",Ar);const vl=R([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var yl={exports:{}},Rg={exports:{}};Rg.exports=function(c,l){var d,m,_,k,T,z,L,F;for(m=c.length-(d=3&c.length),_=l,T=3432918353,z=461845907,F=0;F<m;)L=255&c.charCodeAt(F)|(255&c.charCodeAt(++F))<<8|(255&c.charCodeAt(++F))<<16|(255&c.charCodeAt(++F))<<24,++F,_=27492+(65535&(k=5*(65535&(_=(_^=L=(65535&(L=(L=(65535&L)*T+(((L>>>16)*T&65535)<<16)&4294967295)<<15|L>>>17))*z+(((L>>>16)*z&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(k>>>16)&65535)<<16);switch(L=0,d){case 3:L^=(255&c.charCodeAt(F+2))<<16;case 2:L^=(255&c.charCodeAt(F+1))<<8;case 1:_^=L=(65535&(L=(L=(65535&(L^=255&c.charCodeAt(F)))*T+(((L>>>16)*T&65535)<<16)&4294967295)<<15|L>>>17))*z+(((L>>>16)*z&65535)<<16)&4294967295}return _^=c.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0};var Fx=Rg.exports,Lg={exports:{}};Lg.exports=function(c,l){for(var d,m=c.length,_=l^m,k=0;m>=4;)d=1540483477*(65535&(d=255&c.charCodeAt(k)|(255&c.charCodeAt(++k))<<8|(255&c.charCodeAt(++k))<<16|(255&c.charCodeAt(++k))<<24))+((1540483477*(d>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),m-=4,++k;switch(m){case 3:_^=(255&c.charCodeAt(k+2))<<16;case 2:_^=(255&c.charCodeAt(k+1))<<8;case 1:_=1540483477*(65535&(_^=255&c.charCodeAt(k)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0};var Vs=Fx,Bg=Lg.exports;yl.exports=Vs,yl.exports.murmur3=Vs,yl.exports.murmur2=Bg;var fd=h(yl.exports);class ju{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(l,d,m,_){this.ids.push(pd(l)),this.positions.push(d,m,_)}getPositions(l){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const d=pd(l);let m=0,_=this.ids.length-1;for(;m<_;){const T=m+_>>1;this.ids[T]>=d?_=T:m=T+1}const k=[];for(;this.ids[m]===d;)k.push({index:this.positions[3*m],start:this.positions[3*m+1],end:this.positions[3*m+2]}),m++;return k}static serialize(l,d){const m=new Float64Array(l.ids),_=new Uint32Array(l.positions);return md(m,_,0,m.length-1),d&&d.push(m.buffer,_.buffer),{ids:m,positions:_}}static deserialize(l){const d=new ju;return d.ids=l.ids,d.positions=l.positions,d.indexed=!0,d}}function pd(c){const l=+c;return!isNaN(l)&&l<=Number.MAX_SAFE_INTEGER?l:fd(String(c))}function md(c,l,d,m){for(;d<m;){const _=c[d+m>>1];let k=d-1,T=m+1;for(;;){do k++;while(c[k]<_);do T--;while(c[T]>_);if(k>=T)break;xl(c,k,T),xl(l,3*k,3*T),xl(l,3*k+1,3*T+1),xl(l,3*k+2,3*T+2)}T-d<m-T?(md(c,l,d,T),d=T+1):(md(c,l,T+1,m),m=T)}}function xl(c,l,d){const m=c[l];c[l]=c[d],c[d]=m}Wt("FeaturePositionMap",ju);class Ou{constructor(l,d){this.gl=l.gl,this.location=d}}class jg extends Ou{constructor(l,d){super(l,d),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class PE extends Ou{constructor(l,d){super(l,d),this.current=[0,0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3]))}}class IE extends Ou{constructor(l,d){super(l,d),this.current=Mr.transparent}set(l){l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a))}}const zB=new Float32Array(16);function $x(c){return[wo(255*c.r,255*c.g),wo(255*c.b,255*c.a)]}class zf{constructor(l,d,m){this.value=l,this.uniformNames=d.map(_=>`u_${_}`),this.type=m}setUniform(l,d,m){l.set(m.constantOr(this.value))}getBinding(l,d,m){return this.type==="color"?new IE(l,d):new jg(l,d)}}class gd{constructor(l,d){this.uniformNames=d.map(m=>`u_${m}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(l,d){this.pixelRatioFrom=d.pixelRatio,this.pixelRatioTo=l.pixelRatio,this.patternFrom=d.tlbr,this.patternTo=l.tlbr}setUniform(l,d,m,_){const k=_==="u_pattern_to"?this.patternTo:_==="u_pattern_from"?this.patternFrom:_==="u_pixel_ratio_to"?this.pixelRatioTo:_==="u_pixel_ratio_from"?this.pixelRatioFrom:null;k&&l.set(k)}getBinding(l,d,m){return m.substr(0,9)==="u_pattern"?new PE(l,d):new jg(l,d)}}class So{constructor(l,d,m,_){this.expression=l,this.type=m,this.maxValue=0,this.paintVertexAttributes=d.map(k=>({name:`a_${k}`,type:"Float32",components:m==="color"?2:1,offset:0})),this.paintVertexArray=new _}populatePaintArray(l,d,m,_,k){const T=this.paintVertexArray.length,z=this.expression.evaluate(new nn(0),d,{},_,[],k);this.paintVertexArray.resize(l),this._setPaintValue(T,l,z)}updatePaintArray(l,d,m,_){const k=this.expression.evaluate({zoom:0},m,_);this._setPaintValue(l,d,k)}_setPaintValue(l,d,m){if(this.type==="color"){const _=$x(m);for(let k=l;k<d;k++)this.paintVertexArray.emplace(k,_[0],_[1])}else{for(let _=l;_<d;_++)this.paintVertexArray.emplace(_,m);this.maxValue=Math.max(this.maxValue,Math.abs(m))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class vs{constructor(l,d,m,_,k,T){this.expression=l,this.uniformNames=d.map(z=>`u_${z}_t`),this.type=m,this.useIntegerZoom=_,this.zoom=k,this.maxValue=0,this.paintVertexAttributes=d.map(z=>({name:`a_${z}`,type:"Float32",components:m==="color"?4:2,offset:0})),this.paintVertexArray=new T}populatePaintArray(l,d,m,_,k){const T=this.expression.evaluate(new nn(this.zoom),d,{},_,[],k),z=this.expression.evaluate(new nn(this.zoom+1),d,{},_,[],k),L=this.paintVertexArray.length;this.paintVertexArray.resize(l),this._setPaintValue(L,l,T,z)}updatePaintArray(l,d,m,_){const k=this.expression.evaluate({zoom:this.zoom},m,_),T=this.expression.evaluate({zoom:this.zoom+1},m,_);this._setPaintValue(l,d,k,T)}_setPaintValue(l,d,m,_){if(this.type==="color"){const k=$x(m),T=$x(_);for(let z=l;z<d;z++)this.paintVertexArray.emplace(z,k[0],k[1],T[0],T[1])}else{for(let k=l;k<d;k++)this.paintVertexArray.emplace(k,m,_);this.maxValue=Math.max(this.maxValue,Math.abs(m),Math.abs(_))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(l,d){const m=this.useIntegerZoom?Math.floor(d.zoom):d.zoom,_=V(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);l.set(_)}getBinding(l,d,m){return new jg(l,d)}}class bl{constructor(l,d,m,_,k,T){this.expression=l,this.type=d,this.useIntegerZoom=m,this.zoom=_,this.layerId=T,this.zoomInPaintVertexArray=new k,this.zoomOutPaintVertexArray=new k}populatePaintArray(l,d,m){const _=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(l),this.zoomOutPaintVertexArray.resize(l),this._setPaintValues(_,l,d.patterns&&d.patterns[this.layerId],m)}updatePaintArray(l,d,m,_,k){this._setPaintValues(l,d,m.patterns&&m.patterns[this.layerId],k)}_setPaintValues(l,d,m,_){if(!_||!m)return;const{min:k,mid:T,max:z}=m,L=_[k],F=_[T],q=_[z];if(L&&F&&q)for(let Q=l;Q<d;Q++)this.zoomInPaintVertexArray.emplace(Q,F.tl[0],F.tl[1],F.br[0],F.br[1],L.tl[0],L.tl[1],L.br[0],L.br[1],F.pixelRatio,L.pixelRatio),this.zoomOutPaintVertexArray.emplace(Q,F.tl[0],F.tl[1],F.br[0],F.br[1],q.tl[0],q.tl[1],q.br[0],q.br[1],F.pixelRatio,q.pixelRatio)}upload(l){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=l.createVertexBuffer(this.zoomInPaintVertexArray,vl.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=l.createVertexBuffer(this.zoomOutPaintVertexArray,vl.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class AE{constructor(l,d,m){this.binders={},this._buffers=[];const _=[];for(const k in l.paint._values){if(!m(k))continue;const T=l.paint.get(k);if(!(T instanceof Ki&&nl(T.property.specification)))continue;const z=RB(k,l.type),L=T.value,F=T.property.specification.type,q=T.property.useIntegerZoom,Q=T.property.specification["property-type"],ae=Q==="cross-faded"||Q==="cross-faded-data-driven";if(L.kind==="constant")this.binders[k]=ae?new gd(L.value,z):new zf(L.value,z,F),_.push(`/u_${k}`);else if(L.kind==="source"||ae){const ue=NE(k,F,"source");this.binders[k]=ae?new bl(L,F,q,d,ue,l.id):new So(L,z,F,ue),_.push(`/a_${k}`)}else{const ue=NE(k,F,"composite");this.binders[k]=new vs(L,z,F,q,d,ue),_.push(`/z_${k}`)}}this.cacheKey=_.sort().join("")}getMaxValue(l){const d=this.binders[l];return d instanceof So||d instanceof vs?d.maxValue:0}populatePaintArrays(l,d,m,_,k){for(const T in this.binders){const z=this.binders[T];(z instanceof So||z instanceof vs||z instanceof bl)&&z.populatePaintArray(l,d,m,_,k)}}setConstantPatternPositions(l,d){for(const m in this.binders){const _=this.binders[m];_ instanceof gd&&_.setConstantPatternPositions(l,d)}}updatePaintArrays(l,d,m,_,k){let T=!1;for(const z in l){const L=d.getPositions(z);for(const F of L){const q=m.feature(F.index);for(const Q in this.binders){const ae=this.binders[Q];if((ae instanceof So||ae instanceof vs||ae instanceof bl)&&ae.expression.isStateDependent===!0){const ue=_.paint.get(Q);ae.expression=ue.value,ae.updatePaintArray(F.start,F.end,q,l[z],k),T=!0}}}}return T}defines(){const l=[];for(const d in this.binders){const m=this.binders[d];(m instanceof zf||m instanceof gd)&&l.push(...m.uniformNames.map(_=>`#define HAS_UNIFORM_${_}`))}return l}getBinderAttributes(){const l=[];for(const d in this.binders){const m=this.binders[d];if(m instanceof So||m instanceof vs)for(let _=0;_<m.paintVertexAttributes.length;_++)l.push(m.paintVertexAttributes[_].name);else if(m instanceof bl)for(let _=0;_<vl.members.length;_++)l.push(vl.members[_].name)}return l}getBinderUniforms(){const l=[];for(const d in this.binders){const m=this.binders[d];if(m instanceof zf||m instanceof gd||m instanceof vs)for(const _ of m.uniformNames)l.push(_)}return l}getPaintVertexBuffers(){return this._buffers}getUniforms(l,d){const m=[];for(const _ in this.binders){const k=this.binders[_];if(k instanceof zf||k instanceof gd||k instanceof vs){for(const T of k.uniformNames)if(d[T]){const z=k.getBinding(l,d[T],T);m.push({name:T,property:_,binding:z})}}}return m}setUniforms(l,d,m,_){for(const{name:k,property:T,binding:z}of d)this.binders[T].setUniform(z,_,m.get(T),k)}updatePaintBuffers(l){this._buffers=[];for(const d in this.binders){const m=this.binders[d];if(l&&m instanceof bl){const _=l.fromScale===2?m.zoomInPaintVertexBuffer:m.zoomOutPaintVertexBuffer;_&&this._buffers.push(_)}else(m instanceof So||m instanceof vs)&&m.paintVertexBuffer&&this._buffers.push(m.paintVertexBuffer)}}upload(l){for(const d in this.binders){const m=this.binders[d];(m instanceof So||m instanceof vs||m instanceof bl)&&m.upload(l)}this.updatePaintBuffers()}destroy(){for(const l in this.binders){const d=this.binders[l];(d instanceof So||d instanceof vs||d instanceof bl)&&d.destroy()}}}class Fu{constructor(l,d,m=()=>!0){this.programConfigurations={};for(const _ of l)this.programConfigurations[_.id]=new AE(_,d,m);this.needsUpload=!1,this._featureMap=new ju,this._bufferOffset=0}populatePaintArrays(l,d,m,_,k,T){for(const z in this.programConfigurations)this.programConfigurations[z].populatePaintArrays(l,d,_,k,T);d.id!==void 0&&this._featureMap.add(d.id,m,this._bufferOffset,l),this._bufferOffset=l,this.needsUpload=!0}updatePaintArrays(l,d,m,_){for(const k of m)this.needsUpload=this.programConfigurations[k.id].updatePaintArrays(l,this._featureMap,d,k,_)||this.needsUpload}get(l){return this.programConfigurations[l]}upload(l){if(this.needsUpload){for(const d in this.programConfigurations)this.programConfigurations[d].upload(l);this.needsUpload=!1}}destroy(){for(const l in this.programConfigurations)this.programConfigurations[l].destroy()}}function RB(c,l){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[c]||[c.replace(`${l}-`,"").replace(/-/g,"_")]}function NE(c,l,d){const m={color:{source:ye,composite:vr},number:{source:Rt,composite:ye}},_=function(k){return{"line-pattern":{source:di,composite:di},"fill-pattern":{source:di,composite:di},"fill-extrusion-pattern":{source:di,composite:di}}[k]}(c);return _&&_[d]||m[l][d]}Wt("ConstantBinder",zf),Wt("CrossFadedConstantBinder",gd),Wt("SourceExpressionBinder",So),Wt("CrossFadedCompositeBinder",bl),Wt("CompositeExpressionBinder",vs),Wt("ProgramConfiguration",AE,{omit:["_buffers"]}),Wt("ProgramConfigurationSet",Fu);const Dn=8192,Vx=Math.pow(2,14)-1,ME=-Vx-1;function $u(c){const l=Dn/c.extent,d=c.loadGeometry();for(let m=0;m<d.length;m++){const _=d[m];for(let k=0;k<_.length;k++){const T=_[k],z=Math.round(T.x*l),L=Math.round(T.y*l);T.x=V(z,ME,Vx),T.y=V(L,ME,Vx),(z<T.x||z>T.x+1||L<T.y||L>T.y+1)&&Y("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return d}function Vu(c,l){return{type:c.type,id:c.id,properties:c.properties,geometry:l?$u(c):[]}}function Og(c,l,d,m,_){c.emplaceBack(2*l+(m+1)/2,2*d+(_+1)/2)}class Ux{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(d=>d.id),this.index=l.index,this.hasPattern=!1,this.layoutVertexArray=new ba,this.indexArray=new Ni,this.segments=new Ar,this.programConfigurations=new Fu(l.layers,l.zoom),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(l,d,m){const _=this.layers[0],k=[];let T=null,z=!1;_.type==="circle"&&(T=_.layout.get("circle-sort-key"),z=!T.isConstant());for(const{feature:L,id:F,index:q,sourceLayerIndex:Q}of l){const ae=this.layers[0]._featureFilter.needGeometry,ue=Vu(L,ae);if(!this.layers[0]._featureFilter.filter(new nn(this.zoom),ue,m))continue;const me=z?T.evaluate(ue,{},m):void 0,ve={id:F,properties:L.properties,type:L.type,sourceLayerIndex:Q,index:q,geometry:ae?ue.geometry:$u(L),patterns:{},sortKey:me};k.push(ve)}z&&k.sort((L,F)=>L.sortKey-F.sortKey);for(const L of k){const{geometry:F,index:q,sourceLayerIndex:Q}=L,ae=l[q].feature;this.addFeature(L,F,q,m),d.featureIndex.insert(ae,F,q,Q,this.index)}}update(l,d,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,d,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,Ya),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(l,d,m,_){for(const k of d)for(const T of k){const z=T.x,L=T.y;if(z<0||z>=Dn||L<0||L>=Dn)continue;const F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,l.sortKey),q=F.vertexLength;Og(this.layoutVertexArray,z,L,-1,-1),Og(this.layoutVertexArray,z,L,1,-1),Og(this.layoutVertexArray,z,L,1,1),Og(this.layoutVertexArray,z,L,-1,1),this.indexArray.emplaceBack(q,q+1,q+2),this.indexArray.emplaceBack(q,q+3,q+2),F.vertexLength+=4,F.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,m,{},_)}}function DE(c,l){for(let d=0;d<c.length;d++)if(vd(l,c[d]))return!0;for(let d=0;d<l.length;d++)if(vd(c,l[d]))return!0;return!!qx(c,l)}function LB(c,l,d){return!!vd(c,l)||!!Hx(l,c,d)}function zE(c,l){if(c.length===1)return LE(l,c[0]);for(let d=0;d<l.length;d++){const m=l[d];for(let _=0;_<m.length;_++)if(vd(c,m[_]))return!0}for(let d=0;d<c.length;d++)if(LE(l,c[d]))return!0;for(let d=0;d<l.length;d++)if(qx(c,l[d]))return!0;return!1}function BB(c,l,d){if(c.length>1){if(qx(c,l))return!0;for(let m=0;m<l.length;m++)if(Hx(l[m],c,d))return!0}for(let m=0;m<c.length;m++)if(Hx(c[m],l,d))return!0;return!1}function qx(c,l){if(c.length===0||l.length===0)return!1;for(let d=0;d<c.length-1;d++){const m=c[d],_=c[d+1];for(let k=0;k<l.length-1;k++)if(jB(m,_,l[k],l[k+1]))return!0}return!1}function jB(c,l,d,m){return G(c,d,m)!==G(l,d,m)&&G(c,l,d)!==G(c,l,m)}function Hx(c,l,d){const m=d*d;if(l.length===1)return c.distSqr(l[0])<m;for(let _=1;_<l.length;_++)if(RE(c,l[_-1],l[_])<m)return!0;return!1}function RE(c,l,d){const m=l.distSqr(d);if(m===0)return c.distSqr(l);const _=((c.x-l.x)*(d.x-l.x)+(c.y-l.y)*(d.y-l.y))/m;return c.distSqr(_<0?l:_>1?d:d.sub(l)._mult(_)._add(l))}function LE(c,l){let d,m,_,k=!1;for(let T=0;T<c.length;T++){d=c[T];for(let z=0,L=d.length-1;z<d.length;L=z++)m=d[z],_=d[L],m.y>l.y!=_.y>l.y&&l.x<(_.x-m.x)*(l.y-m.y)/(_.y-m.y)+m.x&&(k=!k)}return k}function vd(c,l){let d=!1;for(let m=0,_=c.length-1;m<c.length;_=m++){const k=c[m],T=c[_];k.y>l.y!=T.y>l.y&&l.x<(T.x-k.x)*(l.y-k.y)/(T.y-k.y)+k.x&&(d=!d)}return d}function OB(c,l,d){const m=d[0],_=d[2];if(c.x<m.x&&l.x<m.x||c.x>_.x&&l.x>_.x||c.y<m.y&&l.y<m.y||c.y>_.y&&l.y>_.y)return!1;const k=G(c,l,d[0]);return k!==G(c,l,d[1])||k!==G(c,l,d[2])||k!==G(c,l,d[3])}function Rf(c,l,d){const m=l.paint.get(c).value;return m.kind==="constant"?m.value:d.programConfigurations.get(l.id).getMaxValue(c)}function Fg(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function $g(c,l,d,m,_){if(!l[0]&&!l[1])return c;const k=v.convert(l)._mult(_);d==="viewport"&&k._rotate(-m);const T=[];for(let z=0;z<c.length;z++)T.push(c[z].sub(k));return T}let BE,jE;Wt("CircleBucket",Ux,{omit:["layers"]});var FB={get paint(){return jE=jE||new C({"circle-radius":new ur($e.paint_circle["circle-radius"]),"circle-color":new ur($e.paint_circle["circle-color"]),"circle-blur":new ur($e.paint_circle["circle-blur"]),"circle-opacity":new ur($e.paint_circle["circle-opacity"]),"circle-translate":new Yt($e.paint_circle["circle-translate"]),"circle-translate-anchor":new Yt($e.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Yt($e.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Yt($e.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ur($e.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ur($e.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ur($e.paint_circle["circle-stroke-opacity"])})},get layout(){return BE=BE||new C({"circle-sort-key":new ur($e.layout_circle["circle-sort-key"])})}},Ra=1e-6,yd=typeof Float32Array<"u"?Float32Array:Array;function Gx(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function OE(c,l,d){var m=l[0],_=l[1],k=l[2],T=l[3],z=l[4],L=l[5],F=l[6],q=l[7],Q=l[8],ae=l[9],ue=l[10],me=l[11],ve=l[12],Ce=l[13],Ie=l[14],Je=l[15],je=d[0],Ze=d[1],ct=d[2],_t=d[3];return c[0]=je*m+Ze*z+ct*Q+_t*ve,c[1]=je*_+Ze*L+ct*ae+_t*Ce,c[2]=je*k+Ze*F+ct*ue+_t*Ie,c[3]=je*T+Ze*q+ct*me+_t*Je,c[4]=(je=d[4])*m+(Ze=d[5])*z+(ct=d[6])*Q+(_t=d[7])*ve,c[5]=je*_+Ze*L+ct*ae+_t*Ce,c[6]=je*k+Ze*F+ct*ue+_t*Ie,c[7]=je*T+Ze*q+ct*me+_t*Je,c[8]=(je=d[8])*m+(Ze=d[9])*z+(ct=d[10])*Q+(_t=d[11])*ve,c[9]=je*_+Ze*L+ct*ae+_t*Ce,c[10]=je*k+Ze*F+ct*ue+_t*Ie,c[11]=je*T+Ze*q+ct*me+_t*Je,c[12]=(je=d[12])*m+(Ze=d[13])*z+(ct=d[14])*Q+(_t=d[15])*ve,c[13]=je*_+Ze*L+ct*ae+_t*Ce,c[14]=je*k+Ze*F+ct*ue+_t*Ie,c[15]=je*T+Ze*q+ct*me+_t*Je,c}Math.hypot||(Math.hypot=function(){for(var c=0,l=arguments.length;l--;)c+=arguments[l]*arguments[l];return Math.sqrt(c)});var Lf,$B=OE;function Vg(c,l,d){var m=l[0],_=l[1],k=l[2],T=l[3];return c[0]=d[0]*m+d[4]*_+d[8]*k+d[12]*T,c[1]=d[1]*m+d[5]*_+d[9]*k+d[13]*T,c[2]=d[2]*m+d[6]*_+d[10]*k+d[14]*T,c[3]=d[3]*m+d[7]*_+d[11]*k+d[15]*T,c}Lf=new yd(4),yd!=Float32Array&&(Lf[0]=0,Lf[1]=0,Lf[2]=0,Lf[3]=0);class VB extends f{constructor(l){super(l,FB)}createBucket(l){return new Ux(l)}queryRadius(l){const d=l;return Rf("circle-radius",this,d)+Rf("circle-stroke-width",this,d)+Fg(this.paint.get("circle-translate"))}queryIntersectsFeature(l,d,m,_,k,T,z,L){const F=$g(l,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),T.angle,z),q=this.paint.get("circle-radius").evaluate(d,m)+this.paint.get("circle-stroke-width").evaluate(d,m),Q=this.paint.get("circle-pitch-alignment")==="map",ae=Q?F:function(me,ve){return me.map(Ce=>FE(Ce,ve))}(F,L),ue=Q?q*z:q;for(const me of _)for(const ve of me){const Ce=Q?ve:FE(ve,L);let Ie=ue;const Je=Vg([],[ve.x,ve.y,0,1],L);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Ie*=Je[3]/T.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Ie*=T.cameraToCenterDistance/Je[3]),LB(ae,Ce,Ie))return!0}return!1}}function FE(c,l){const d=Vg([],[c.x,c.y,0,1],l);return new v(d[0]/d[3],d[1]/d[3])}class $E extends Ux{}let VE;Wt("HeatmapBucket",$E,{omit:["layers"]});var UB={get paint(){return VE=VE||new C({"heatmap-radius":new ur($e.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ur($e.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Yt($e.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Mf($e.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Yt($e.paint_heatmap["heatmap-opacity"])})}};function Wx(c,{width:l,height:d},m,_){if(_){if(_ instanceof Uint8ClampedArray)_=new Uint8Array(_.buffer);else if(_.length!==l*d*m)throw new RangeError(`mismatched image size. expected: ${_.length} but got: ${l*d*m}`)}else _=new Uint8Array(l*d*m);return c.width=l,c.height=d,c.data=_,c}function UE(c,{width:l,height:d},m){if(l===c.width&&d===c.height)return;const _=Wx({},{width:l,height:d},m);Zx(c,_,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,l),height:Math.min(c.height,d)},m),c.width=l,c.height=d,c.data=_.data}function Zx(c,l,d,m,_,k){if(_.width===0||_.height===0)return l;if(_.width>c.width||_.height>c.height||d.x>c.width-_.width||d.y>c.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>l.width||_.height>l.height||m.x>l.width-_.width||m.y>l.height-_.height)throw new RangeError("out of range destination coordinates for image copy");const T=c.data,z=l.data;if(T===z)throw new Error("srcData equals dstData, so image is already copied");for(let L=0;L<_.height;L++){const F=((d.y+L)*c.width+d.x)*k,q=((m.y+L)*l.width+m.x)*k;for(let Q=0;Q<_.width*k;Q++)z[q+Q]=T[F+Q]}return l}class Bf{constructor(l,d){Wx(this,l,1,d)}resize(l){UE(this,l,1)}clone(){return new Bf({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,d,m,_,k){Zx(l,d,m,_,k,1)}}class Mi{constructor(l,d){Wx(this,l,4,d)}resize(l){UE(this,l,4)}replace(l,d){d?this.data.set(l):this.data=l instanceof Uint8ClampedArray?new Uint8Array(l.buffer):l}clone(){return new Mi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,d,m,_,k){Zx(l,d,m,_,k,4)}}function qE(c){const l={},d=c.resolution||256,m=c.clips?c.clips.length:1,_=c.image||new Mi({width:d,height:m});if(Math.log(d)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${d}`);const k=(T,z,L)=>{l[c.evaluationKey]=L;const F=c.expression.evaluate(l);_.data[T+z+0]=Math.floor(255*F.r/F.a),_.data[T+z+1]=Math.floor(255*F.g/F.a),_.data[T+z+2]=Math.floor(255*F.b/F.a),_.data[T+z+3]=Math.floor(255*F.a)};if(c.clips)for(let T=0,z=0;T<m;++T,z+=4*d)for(let L=0,F=0;L<d;L++,F+=4){const q=L/(d-1),{start:Q,end:ae}=c.clips[T];k(z,F,Q*(1-q)+ae*q)}else for(let T=0,z=0;T<d;T++,z+=4)k(0,z,T/(d-1));return _}Wt("AlphaImage",Bf),Wt("RGBAImage",Mi);const Xx="big-fb";class qB extends f{createBucket(l){return new $E(l)}constructor(l){super(l,UB),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=qE({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Xx)&&this.heatmapFbos.delete(Xx)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let HE;var HB={get paint(){return HE=HE||new C({"hillshade-illumination-direction":new Yt($e.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Yt($e.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Yt($e.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Yt($e.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Yt($e.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Yt($e.paint_hillshade["hillshade-accent-color"])})}};class GB extends f{constructor(l){super(l,HB)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const WB=R([{name:"a_pos",components:2,type:"Int16"}],4),{members:ZB}=WB;function GE(c,l,d=2){const m=l&&l.length,_=m?l[0]*d:c.length;let k=WE(c,0,_,d,!0);const T=[];if(!k||k.next===k.prev)return T;let z,L,F;if(m&&(k=function(q,Q,ae,ue){const me=[];for(let ve=0,Ce=Q.length;ve<Ce;ve++){const Ie=WE(q,Q[ve]*ue,ve<Ce-1?Q[ve+1]*ue:q.length,ue,!1);Ie===Ie.next&&(Ie.steiner=!0),me.push(r4(Ie))}me.sort(QB);for(let ve=0;ve<me.length;ve++)ae=e4(me[ve],ae);return ae}(c,l,k,d)),c.length>80*d){z=1/0,L=1/0;let q=-1/0,Q=-1/0;for(let ae=d;ae<_;ae+=d){const ue=c[ae],me=c[ae+1];ue<z&&(z=ue),me<L&&(L=me),ue>q&&(q=ue),me>Q&&(Q=me)}F=Math.max(q-z,Q-L),F=F!==0?32767/F:0}return jf(k,T,d,z,L,F,0),T}function WE(c,l,d,m,_){let k;if(_===function(T,z,L,F){let q=0;for(let Q=z,ae=L-F;Q<L;Q+=F)q+=(T[ae]-T[Q])*(T[Q+1]+T[ae+1]),ae=Q;return q}(c,l,d,m)>0)for(let T=l;T<d;T+=m)k=KE(T/m|0,c[T],c[T+1],k);else for(let T=d-m;T>=l;T-=m)k=KE(T/m|0,c[T],c[T+1],k);return k&&Ug(k,k.next)&&(Ff(k),k=k.next),k}function Uu(c,l){if(!c)return c;l||(l=c);let d,m=c;do if(d=!1,m.steiner||!Ug(m,m.next)&&Pn(m.prev,m,m.next)!==0)m=m.next;else{if(Ff(m),m=l=m.prev,m===m.next)break;d=!0}while(d||m!==l);return l}function jf(c,l,d,m,_,k,T){if(!c)return;!T&&k&&function(L,F,q,Q){let ae=L;do ae.z===0&&(ae.z=Kx(ae.x,ae.y,F,q,Q)),ae.prevZ=ae.prev,ae.nextZ=ae.next,ae=ae.next;while(ae!==L);ae.prevZ.nextZ=null,ae.prevZ=null,function(ue){let me,ve=1;do{let Ce,Ie=ue;ue=null;let Je=null;for(me=0;Ie;){me++;let je=Ie,Ze=0;for(let _t=0;_t<ve&&(Ze++,je=je.nextZ,je);_t++);let ct=ve;for(;Ze>0||ct>0&&je;)Ze!==0&&(ct===0||!je||Ie.z<=je.z)?(Ce=Ie,Ie=Ie.nextZ,Ze--):(Ce=je,je=je.nextZ,ct--),Je?Je.nextZ=Ce:ue=Ce,Ce.prevZ=Je,Je=Ce;Ie=je}Je.nextZ=null,ve*=2}while(me>1)}(ae)}(c,m,_,k);let z=c;for(;c.prev!==c.next;){const L=c.prev,F=c.next;if(k?KB(c,m,_,k):XB(c))l.push(L.i,c.i,F.i),Ff(c),c=F.next,z=F.next;else if((c=F)===z){T?T===1?jf(c=YB(Uu(c),l),l,d,m,_,k,2):T===2&&JB(c,l,d,m,_,k):jf(Uu(c),l,d,m,_,k,1);break}}}function XB(c){const l=c.prev,d=c,m=c.next;if(Pn(l,d,m)>=0)return!1;const _=l.x,k=d.x,T=m.x,z=l.y,L=d.y,F=m.y,q=_<k?_<T?_:T:k<T?k:T,Q=z<L?z<F?z:F:L<F?L:F,ae=_>k?_>T?_:T:k>T?k:T,ue=z>L?z>F?z:F:L>F?L:F;let me=m.next;for(;me!==l;){if(me.x>=q&&me.x<=ae&&me.y>=Q&&me.y<=ue&&xd(_,z,k,L,T,F,me.x,me.y)&&Pn(me.prev,me,me.next)>=0)return!1;me=me.next}return!0}function KB(c,l,d,m){const _=c.prev,k=c,T=c.next;if(Pn(_,k,T)>=0)return!1;const z=_.x,L=k.x,F=T.x,q=_.y,Q=k.y,ae=T.y,ue=z<L?z<F?z:F:L<F?L:F,me=q<Q?q<ae?q:ae:Q<ae?Q:ae,ve=z>L?z>F?z:F:L>F?L:F,Ce=q>Q?q>ae?q:ae:Q>ae?Q:ae,Ie=Kx(ue,me,l,d,m),Je=Kx(ve,Ce,l,d,m);let je=c.prevZ,Ze=c.nextZ;for(;je&&je.z>=Ie&&Ze&&Ze.z<=Je;){if(je.x>=ue&&je.x<=ve&&je.y>=me&&je.y<=Ce&&je!==_&&je!==T&&xd(z,q,L,Q,F,ae,je.x,je.y)&&Pn(je.prev,je,je.next)>=0||(je=je.prevZ,Ze.x>=ue&&Ze.x<=ve&&Ze.y>=me&&Ze.y<=Ce&&Ze!==_&&Ze!==T&&xd(z,q,L,Q,F,ae,Ze.x,Ze.y)&&Pn(Ze.prev,Ze,Ze.next)>=0))return!1;Ze=Ze.nextZ}for(;je&&je.z>=Ie;){if(je.x>=ue&&je.x<=ve&&je.y>=me&&je.y<=Ce&&je!==_&&je!==T&&xd(z,q,L,Q,F,ae,je.x,je.y)&&Pn(je.prev,je,je.next)>=0)return!1;je=je.prevZ}for(;Ze&&Ze.z<=Je;){if(Ze.x>=ue&&Ze.x<=ve&&Ze.y>=me&&Ze.y<=Ce&&Ze!==_&&Ze!==T&&xd(z,q,L,Q,F,ae,Ze.x,Ze.y)&&Pn(Ze.prev,Ze,Ze.next)>=0)return!1;Ze=Ze.nextZ}return!0}function YB(c,l){let d=c;do{const m=d.prev,_=d.next.next;!Ug(m,_)&&ZE(m,d,d.next,_)&&Of(m,_)&&Of(_,m)&&(l.push(m.i,d.i,_.i),Ff(d),Ff(d.next),d=c=_),d=d.next}while(d!==c);return Uu(d)}function JB(c,l,d,m,_,k){let T=c;do{let z=T.next.next;for(;z!==T.prev;){if(T.i!==z.i&&n4(T,z)){let L=XE(T,z);return T=Uu(T,T.next),L=Uu(L,L.next),jf(T,l,d,m,_,k,0),void jf(L,l,d,m,_,k,0)}z=z.next}T=T.next}while(T!==c)}function QB(c,l){return c.x-l.x}function e4(c,l){const d=function(_,k){let T=k;const z=_.x,L=_.y;let F,q=-1/0;do{if(L<=T.y&&L>=T.next.y&&T.next.y!==T.y){const ve=T.x+(L-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(ve<=z&&ve>q&&(q=ve,F=T.x<T.next.x?T:T.next,ve===z))return F}T=T.next}while(T!==k);if(!F)return null;const Q=F,ae=F.x,ue=F.y;let me=1/0;T=F;do{if(z>=T.x&&T.x>=ae&&z!==T.x&&xd(L<ue?z:q,L,ae,ue,L<ue?q:z,L,T.x,T.y)){const ve=Math.abs(L-T.y)/(z-T.x);Of(T,_)&&(ve<me||ve===me&&(T.x>F.x||T.x===F.x&&t4(F,T)))&&(F=T,me=ve)}T=T.next}while(T!==Q);return F}(c,l);if(!d)return l;const m=XE(d,c);return Uu(m,m.next),Uu(d,d.next)}function t4(c,l){return Pn(c.prev,c,l.prev)<0&&Pn(l.next,c,c.next)<0}function Kx(c,l,d,m,_){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-d)*_|0)|c<<8))|c<<4))|c<<2))|c<<1))|(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-m)*_|0)|l<<8))|l<<4))|l<<2))|l<<1))<<1}function r4(c){let l=c,d=c;do(l.x<d.x||l.x===d.x&&l.y<d.y)&&(d=l),l=l.next;while(l!==c);return d}function xd(c,l,d,m,_,k,T,z){return(_-T)*(l-z)>=(c-T)*(k-z)&&(c-T)*(m-z)>=(d-T)*(l-z)&&(d-T)*(k-z)>=(_-T)*(m-z)}function n4(c,l){return c.next.i!==l.i&&c.prev.i!==l.i&&!function(d,m){let _=d;do{if(_.i!==d.i&&_.next.i!==d.i&&_.i!==m.i&&_.next.i!==m.i&&ZE(_,_.next,d,m))return!0;_=_.next}while(_!==d);return!1}(c,l)&&(Of(c,l)&&Of(l,c)&&function(d,m){let _=d,k=!1;const T=(d.x+m.x)/2,z=(d.y+m.y)/2;do _.y>z!=_.next.y>z&&_.next.y!==_.y&&T<(_.next.x-_.x)*(z-_.y)/(_.next.y-_.y)+_.x&&(k=!k),_=_.next;while(_!==d);return k}(c,l)&&(Pn(c.prev,c,l.prev)||Pn(c,l.prev,l))||Ug(c,l)&&Pn(c.prev,c,c.next)>0&&Pn(l.prev,l,l.next)>0)}function Pn(c,l,d){return(l.y-c.y)*(d.x-l.x)-(l.x-c.x)*(d.y-l.y)}function Ug(c,l){return c.x===l.x&&c.y===l.y}function ZE(c,l,d,m){const _=Hg(Pn(c,l,d)),k=Hg(Pn(c,l,m)),T=Hg(Pn(d,m,c)),z=Hg(Pn(d,m,l));return _!==k&&T!==z||!(_!==0||!qg(c,d,l))||!(k!==0||!qg(c,m,l))||!(T!==0||!qg(d,c,m))||!(z!==0||!qg(d,l,m))}function qg(c,l,d){return l.x<=Math.max(c.x,d.x)&&l.x>=Math.min(c.x,d.x)&&l.y<=Math.max(c.y,d.y)&&l.y>=Math.min(c.y,d.y)}function Hg(c){return c>0?1:c<0?-1:0}function Of(c,l){return Pn(c.prev,c,c.next)<0?Pn(c,l,c.next)>=0&&Pn(c,c.prev,l)>=0:Pn(c,l,c.prev)<0||Pn(c,c.next,l)<0}function XE(c,l){const d=Yx(c.i,c.x,c.y),m=Yx(l.i,l.x,l.y),_=c.next,k=l.prev;return c.next=l,l.prev=c,d.next=_,_.prev=d,m.next=d,d.prev=m,k.next=m,m.prev=k,m}function KE(c,l,d,m){const _=Yx(c,l,d);return m?(_.next=m.next,_.prev=m,m.next.prev=_,m.next=_):(_.prev=_,_.next=_),_}function Ff(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function Yx(c,l,d){return{i:c,x:l,y:d,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Jx(c,l,d){const m=d.patternDependencies;let _=!1;for(const k of l){const T=k.paint.get(`${c}-pattern`);T.isConstant()||(_=!0);const z=T.constantOr(null);z&&(_=!0,m[z.to]=!0,m[z.from]=!0)}return _}function Qx(c,l,d,m,_){const k=_.patternDependencies;for(const T of l){const z=T.paint.get(`${c}-pattern`).value;if(z.kind!=="constant"){let L=z.evaluate({zoom:m-1},d,{},_.availableImages),F=z.evaluate({zoom:m},d,{},_.availableImages),q=z.evaluate({zoom:m+1},d,{},_.availableImages);L=L&&L.name?L.name:L,F=F&&F.name?F.name:F,q=q&&q.name?q.name:q,k[L]=!0,k[F]=!0,k[q]=!0,d.patterns[T.id]={min:L,mid:F,max:q}}}return d}class eb{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(d=>d.id),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Yi,this.indexArray=new Ni,this.indexArray2=new Xn,this.programConfigurations=new Fu(l.layers,l.zoom),this.segments=new Ar,this.segments2=new Ar,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(l,d,m){this.hasPattern=Jx("fill",this.layers,d);const _=this.layers[0].layout.get("fill-sort-key"),k=!_.isConstant(),T=[];for(const{feature:z,id:L,index:F,sourceLayerIndex:q}of l){const Q=this.layers[0]._featureFilter.needGeometry,ae=Vu(z,Q);if(!this.layers[0]._featureFilter.filter(new nn(this.zoom),ae,m))continue;const ue=k?_.evaluate(ae,{},m,d.availableImages):void 0,me={id:L,properties:z.properties,type:z.type,sourceLayerIndex:q,index:F,geometry:Q?ae.geometry:$u(z),patterns:{},sortKey:ue};T.push(me)}k&&T.sort((z,L)=>z.sortKey-L.sortKey);for(const z of T){const{geometry:L,index:F,sourceLayerIndex:q}=z;if(this.hasPattern){const Q=Qx("fill",this.layers,z,this.zoom,d);this.patternFeatures.push(Q)}else this.addFeature(z,L,F,m,{});d.featureIndex.insert(l[F].feature,L,F,q,this.index)}}update(l,d,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,d,this.stateDependentLayers,m)}addFeatures(l,d,m){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,d,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,ZB),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.indexBuffer2=l.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(l,d,m,_,k){for(const T of Uc(d,500)){let z=0;for(const ue of T)z+=ue.length;const L=this.segments.prepareSegment(z,this.layoutVertexArray,this.indexArray),F=L.vertexLength,q=[],Q=[];for(const ue of T){if(ue.length===0)continue;ue!==T[0]&&Q.push(q.length/2);const me=this.segments2.prepareSegment(ue.length,this.layoutVertexArray,this.indexArray2),ve=me.vertexLength;this.layoutVertexArray.emplaceBack(ue[0].x,ue[0].y),this.indexArray2.emplaceBack(ve+ue.length-1,ve),q.push(ue[0].x),q.push(ue[0].y);for(let Ce=1;Ce<ue.length;Ce++)this.layoutVertexArray.emplaceBack(ue[Ce].x,ue[Ce].y),this.indexArray2.emplaceBack(ve+Ce-1,ve+Ce),q.push(ue[Ce].x),q.push(ue[Ce].y);me.vertexLength+=ue.length,me.primitiveLength+=ue.length}const ae=GE(q,Q);for(let ue=0;ue<ae.length;ue+=3)this.indexArray.emplaceBack(F+ae[ue],F+ae[ue+1],F+ae[ue+2]);L.vertexLength+=z,L.primitiveLength+=ae.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,m,k,_)}}let YE,JE;Wt("FillBucket",eb,{omit:["layers","patternFeatures"]});var a4={get paint(){return JE=JE||new C({"fill-antialias":new Yt($e.paint_fill["fill-antialias"]),"fill-opacity":new ur($e.paint_fill["fill-opacity"]),"fill-color":new ur($e.paint_fill["fill-color"]),"fill-outline-color":new ur($e.paint_fill["fill-outline-color"]),"fill-translate":new Yt($e.paint_fill["fill-translate"]),"fill-translate-anchor":new Yt($e.paint_fill["fill-translate-anchor"]),"fill-pattern":new ud($e.paint_fill["fill-pattern"])})},get layout(){return YE=YE||new C({"fill-sort-key":new ur($e.layout_fill["fill-sort-key"])})}};class i4 extends f{constructor(l){super(l,a4)}recalculate(l,d){super.recalculate(l,d);const m=this.paint._values["fill-outline-color"];m.value.kind==="constant"&&m.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new eb(l)}queryRadius(){return Fg(this.paint.get("fill-translate"))}queryIntersectsFeature(l,d,m,_,k,T,z){return zE($g(l,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),T.angle,z),_)}isTileClipped(){return!0}}const s4=R([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),o4=R([{name:"a_centroid",components:2,type:"Int16"}],4),{members:l4}=s4;var _l={},u4=p,QE=bd;function bd(c,l,d,m,_){this.properties={},this.extent=d,this.type=0,this._pbf=c,this._geometry=-1,this._keys=m,this._values=_,c.readFields(c4,this,l)}function c4(c,l,d){c==1?l.id=d.readVarint():c==2?function(m,_){for(var k=m.readVarint()+m.pos;m.pos<k;){var T=_._keys[m.readVarint()],z=_._values[m.readVarint()];_.properties[T]=z}}(d,l):c==3?l.type=d.readVarint():c==4&&(l._geometry=d.pos)}function d4(c){for(var l,d,m=0,_=0,k=c.length,T=k-1;_<k;T=_++)m+=((d=c[T]).x-(l=c[_]).x)*(l.y+d.y);return m}bd.types=["Unknown","Point","LineString","Polygon"],bd.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var l,d=c.readVarint()+c.pos,m=1,_=0,k=0,T=0,z=[];c.pos<d;){if(_<=0){var L=c.readVarint();m=7&L,_=L>>3}if(_--,m===1||m===2)k+=c.readSVarint(),T+=c.readSVarint(),m===1&&(l&&z.push(l),l=[]),l.push(new u4(k,T));else{if(m!==7)throw new Error("unknown command "+m);l&&l.push(l[0].clone())}}return l&&z.push(l),z},bd.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var l=c.readVarint()+c.pos,d=1,m=0,_=0,k=0,T=1/0,z=-1/0,L=1/0,F=-1/0;c.pos<l;){if(m<=0){var q=c.readVarint();d=7&q,m=q>>3}if(m--,d===1||d===2)(_+=c.readSVarint())<T&&(T=_),_>z&&(z=_),(k+=c.readSVarint())<L&&(L=k),k>F&&(F=k);else if(d!==7)throw new Error("unknown command "+d)}return[T,L,z,F]},bd.prototype.toGeoJSON=function(c,l,d){var m,_,k=this.extent*Math.pow(2,d),T=this.extent*c,z=this.extent*l,L=this.loadGeometry(),F=bd.types[this.type];function q(ue){for(var me=0;me<ue.length;me++){var ve=ue[me];ue[me]=[360*(ve.x+T)/k-180,360/Math.PI*Math.atan(Math.exp((180-360*(ve.y+z)/k)*Math.PI/180))-90]}}switch(this.type){case 1:var Q=[];for(m=0;m<L.length;m++)Q[m]=L[m][0];q(L=Q);break;case 2:for(m=0;m<L.length;m++)q(L[m]);break;case 3:for(L=function(ue){var me=ue.length;if(me<=1)return[ue];for(var ve,Ce,Ie=[],Je=0;Je<me;Je++){var je=d4(ue[Je]);je!==0&&(Ce===void 0&&(Ce=je<0),Ce===je<0?(ve&&Ie.push(ve),ve=[ue[Je]]):ve.push(ue[Je]))}return ve&&Ie.push(ve),Ie}(L),m=0;m<L.length;m++)for(_=0;_<L[m].length;_++)q(L[m][_])}L.length===1?L=L[0]:F="Multi"+F;var ae={type:"Feature",geometry:{type:F,coordinates:L},properties:this.properties};return"id"in this&&(ae.id=this.id),ae};var h4=QE,eC=tC;function tC(c,l){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(f4,this,l),this.length=this._features.length}function f4(c,l,d){c===15?l.version=d.readVarint():c===1?l.name=d.readString():c===5?l.extent=d.readVarint():c===2?l._features.push(d.pos):c===3?l._keys.push(d.readString()):c===4&&l._values.push(function(m){for(var _=null,k=m.readVarint()+m.pos;m.pos<k;){var T=m.readVarint()>>3;_=T===1?m.readString():T===2?m.readFloat():T===3?m.readDouble():T===4?m.readVarint64():T===5?m.readVarint():T===6?m.readSVarint():T===7?m.readBoolean():null}return _}(d))}tC.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var l=this._pbf.readVarint()+this._pbf.pos;return new h4(this._pbf,l,this.extent,this._keys,this._values)};var p4=eC;function m4(c,l,d){if(c===3){var m=new p4(d,d.readVarint()+d.pos);m.length&&(l[m.name]=m)}}_l.VectorTile=function(c,l){this.layers=c.readFields(m4,{},l)},_l.VectorTileFeature=QE,_l.VectorTileLayer=eC;const g4=_l.VectorTileFeature.types,tb=Math.pow(2,13);function $f(c,l,d,m,_,k,T,z){c.emplaceBack(l,d,2*Math.floor(m*tb)+T,_*tb*2,k*tb*2,Math.round(z))}class rb{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(d=>d.id),this.index=l.index,this.hasPattern=!1,this.layoutVertexArray=new ml,this.centroidVertexArray=new oa,this.indexArray=new Ni,this.programConfigurations=new Fu(l.layers,l.zoom),this.segments=new Ar,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(l,d,m){this.features=[],this.hasPattern=Jx("fill-extrusion",this.layers,d);for(const{feature:_,id:k,index:T,sourceLayerIndex:z}of l){const L=this.layers[0]._featureFilter.needGeometry,F=Vu(_,L);if(!this.layers[0]._featureFilter.filter(new nn(this.zoom),F,m))continue;const q={id:k,sourceLayerIndex:z,index:T,geometry:L?F.geometry:$u(_),properties:_.properties,type:_.type,patterns:{}};this.hasPattern?this.features.push(Qx("fill-extrusion",this.layers,q,this.zoom,d)):this.addFeature(q,q.geometry,T,m,{}),d.featureIndex.insert(_,q.geometry,T,z,this.index,!0)}}addFeatures(l,d,m){for(const _ of this.features){const{geometry:k}=_;this.addFeature(_,k,_.index,d,m)}}update(l,d,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,d,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,l4),this.centroidVertexBuffer=l.createVertexBuffer(this.centroidVertexArray,o4.members,!0),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(l,d,m,_,k){for(const T of Uc(d,500)){const z={x:0,y:0,vertexCount:0};let L=0;for(const me of T)L+=me.length;let F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const me of T){if(me.length===0||y4(me))continue;let ve=0;for(let Ce=0;Ce<me.length;Ce++){const Ie=me[Ce];if(Ce>=1){const Je=me[Ce-1];if(!v4(Ie,Je)){F.vertexLength+4>Ar.MAX_VERTEX_ARRAY_LENGTH&&(F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const je=Ie.sub(Je)._perp()._unit(),Ze=Je.dist(Ie);ve+Ze>32768&&(ve=0),$f(this.layoutVertexArray,Ie.x,Ie.y,je.x,je.y,0,0,ve),$f(this.layoutVertexArray,Ie.x,Ie.y,je.x,je.y,0,1,ve),z.x+=2*Ie.x,z.y+=2*Ie.y,z.vertexCount+=2,ve+=Ze,$f(this.layoutVertexArray,Je.x,Je.y,je.x,je.y,0,0,ve),$f(this.layoutVertexArray,Je.x,Je.y,je.x,je.y,0,1,ve),z.x+=2*Je.x,z.y+=2*Je.y,z.vertexCount+=2;const ct=F.vertexLength;this.indexArray.emplaceBack(ct,ct+2,ct+1),this.indexArray.emplaceBack(ct+1,ct+2,ct+3),F.vertexLength+=4,F.primitiveLength+=2}}}}if(F.vertexLength+L>Ar.MAX_VERTEX_ARRAY_LENGTH&&(F=this.segments.prepareSegment(L,this.layoutVertexArray,this.indexArray)),g4[l.type]!=="Polygon")continue;const q=[],Q=[],ae=F.vertexLength;for(const me of T)if(me.length!==0){me!==T[0]&&Q.push(q.length/2);for(let ve=0;ve<me.length;ve++){const Ce=me[ve];$f(this.layoutVertexArray,Ce.x,Ce.y,0,0,1,1,0),z.x+=Ce.x,z.y+=Ce.y,z.vertexCount+=1,q.push(Ce.x),q.push(Ce.y)}}const ue=GE(q,Q);for(let me=0;me<ue.length;me+=3)this.indexArray.emplaceBack(ae+ue[me],ae+ue[me+2],ae+ue[me+1]);F.primitiveLength+=ue.length/3,F.vertexLength+=L;for(let me=0;me<z.vertexCount;me++){const ve=Math.floor(z.x/z.vertexCount),Ce=Math.floor(z.y/z.vertexCount);this.centroidVertexArray.emplaceBack(ve,Ce)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,m,k,_)}}function v4(c,l){return c.x===l.x&&(c.x<0||c.x>Dn)||c.y===l.y&&(c.y<0||c.y>Dn)}function y4(c){return c.every(l=>l.x<0)||c.every(l=>l.x>Dn)||c.every(l=>l.y<0)||c.every(l=>l.y>Dn)}let rC;Wt("FillExtrusionBucket",rb,{omit:["layers","features"]});var x4={get paint(){return rC=rC||new C({"fill-extrusion-opacity":new Yt($e["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ur($e["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Yt($e["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Yt($e["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ud($e["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ur($e["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ur($e["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Yt($e["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class b4 extends f{constructor(l){super(l,x4)}createBucket(l){return new rb(l)}queryRadius(){return Fg(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(l,d,m,_,k,T,z,L){const F=$g(l,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),T.angle,z),q=this.paint.get("fill-extrusion-height").evaluate(d,m),Q=this.paint.get("fill-extrusion-base").evaluate(d,m),ae=function(me,ve,Ce,Ie){const Je=[];for(const je of me){const Ze=[je.x,je.y,0,1];Vg(Ze,Ze,ve),Je.push(new v(Ze[0]/Ze[3],Ze[1]/Ze[3]))}return Je}(F,L),ue=function(me,ve,Ce,Ie){const Je=[],je=[],Ze=Ie[8]*ve,ct=Ie[9]*ve,_t=Ie[10]*ve,$t=Ie[11]*ve,lr=Ie[8]*Ce,Lt=Ie[9]*Ce,zt=Ie[10]*Ce,er=Ie[11]*Ce;for(const Zt of me){const Gt=[],pt=[];for(const tr of Zt){const Qt=tr.x,gr=tr.y,Kr=Ie[0]*Qt+Ie[4]*gr+Ie[12],Xr=Ie[1]*Qt+Ie[5]*gr+Ie[13],$n=Ie[2]*Qt+Ie[6]*gr+Ie[14],Ji=Ie[3]*Qt+Ie[7]*gr+Ie[15],ca=$n+_t,Vn=Ji+$t,La=Kr+lr,Ba=Xr+Lt,ja=$n+zt,Cn=Ji+er,Un=new v((Kr+Ze)/Vn,(Xr+ct)/Vn);Un.z=ca/Vn,Gt.push(Un);const _a=new v(La/Cn,Ba/Cn);_a.z=ja/Cn,pt.push(_a)}Je.push(Gt),je.push(pt)}return[Je,je]}(_,Q,q,L);return function(me,ve,Ce){let Ie=1/0;zE(Ce,ve)&&(Ie=nC(Ce,ve[0]));for(let Je=0;Je<ve.length;Je++){const je=ve[Je],Ze=me[Je];for(let ct=0;ct<je.length-1;ct++){const _t=je[ct],$t=[_t,je[ct+1],Ze[ct+1],Ze[ct],_t];DE(Ce,$t)&&(Ie=Math.min(Ie,nC(Ce,$t)))}}return Ie!==1/0&&Ie}(ue[0],ue[1],ae)}}function Vf(c,l){return c.x*l.x+c.y*l.y}function nC(c,l){if(c.length===1){let d=0;const m=l[d++];let _;for(;!_||m.equals(_);)if(_=l[d++],!_)return 1/0;for(;d<l.length;d++){const k=l[d],T=c[0],z=_.sub(m),L=k.sub(m),F=T.sub(m),q=Vf(z,z),Q=Vf(z,L),ae=Vf(L,L),ue=Vf(F,z),me=Vf(F,L),ve=q*ae-Q*Q,Ce=(ae*ue-Q*me)/ve,Ie=(q*me-Q*ue)/ve,Je=m.z*(1-Ce-Ie)+_.z*Ce+k.z*Ie;if(isFinite(Je))return Je}return 1/0}{let d=1/0;for(const m of l)d=Math.min(d,m.z);return d}}const _4=R([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:w4}=_4,S4=R([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:E4}=S4,C4=_l.VectorTileFeature.types,k4=Math.cos(Math.PI/180*37.5),aC=Math.pow(2,14)/.5;class nb{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(d=>d.id),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(d=>{this.gradients[d.id]={}}),this.layoutVertexArray=new dd,this.layoutVertexArray2=new gl,this.indexArray=new Ni,this.programConfigurations=new Fu(l.layers,l.zoom),this.segments=new Ar,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(l,d,m){this.hasPattern=Jx("line",this.layers,d);const _=this.layers[0].layout.get("line-sort-key"),k=!_.isConstant(),T=[];for(const{feature:z,id:L,index:F,sourceLayerIndex:q}of l){const Q=this.layers[0]._featureFilter.needGeometry,ae=Vu(z,Q);if(!this.layers[0]._featureFilter.filter(new nn(this.zoom),ae,m))continue;const ue=k?_.evaluate(ae,{},m):void 0,me={id:L,properties:z.properties,type:z.type,sourceLayerIndex:q,index:F,geometry:Q?ae.geometry:$u(z),patterns:{},sortKey:ue};T.push(me)}k&&T.sort((z,L)=>z.sortKey-L.sortKey);for(const z of T){const{geometry:L,index:F,sourceLayerIndex:q}=z;if(this.hasPattern){const Q=Qx("line",this.layers,z,this.zoom,d);this.patternFeatures.push(Q)}else this.addFeature(z,L,F,m,{});d.featureIndex.insert(l[F].feature,L,F,q,this.index)}}update(l,d,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,d,this.stateDependentLayers,m)}addFeatures(l,d,m){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,d,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=l.createVertexBuffer(this.layoutVertexArray2,E4)),this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,w4),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(l){if(l.properties&&Object.prototype.hasOwnProperty.call(l.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(l.properties,"mapbox_clip_end"))return{start:+l.properties.mapbox_clip_start,end:+l.properties.mapbox_clip_end}}addFeature(l,d,m,_,k){const T=this.layers[0].layout,z=T.get("line-join").evaluate(l,{}),L=T.get("line-cap"),F=T.get("line-miter-limit"),q=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(l);for(const Q of d)this.addLine(Q,l,z,L,F,q);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,m,k,_)}addLine(l,d,m,_,k,T){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ie=0;Ie<l.length-1;Ie++)this.totalDistance+=l[Ie].dist(l[Ie+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const z=C4[d.type]==="Polygon";let L=l.length;for(;L>=2&&l[L-1].equals(l[L-2]);)L--;let F=0;for(;F<L-1&&l[F].equals(l[F+1]);)F++;if(L<(z?3:2))return;m==="bevel"&&(k=1.05);const q=this.overscaling<=16?15*Dn/(512*this.overscaling):0,Q=this.segments.prepareSegment(10*L,this.layoutVertexArray,this.indexArray);let ae,ue,me,ve,Ce;this.e1=this.e2=-1,z&&(ae=l[L-2],Ce=l[F].sub(ae)._unit()._perp());for(let Ie=F;Ie<L;Ie++){if(me=Ie===L-1?z?l[F+1]:void 0:l[Ie+1],me&&l[Ie].equals(me))continue;Ce&&(ve=Ce),ae&&(ue=ae),ae=l[Ie],Ce=me?me.sub(ae)._unit()._perp():ve,ve=ve||Ce;let Je=ve.add(Ce);Je.x===0&&Je.y===0||Je._unit();const je=ve.x*Ce.x+ve.y*Ce.y,Ze=Je.x*Ce.x+Je.y*Ce.y,ct=Ze!==0?1/Ze:1/0,_t=2*Math.sqrt(2-2*Ze),$t=Ze<k4&&ue&&me,lr=ve.x*Ce.y-ve.y*Ce.x>0;if($t&&Ie>F){const er=ae.dist(ue);if(er>2*q){const Zt=ae.sub(ae.sub(ue)._mult(q/er)._round());this.updateDistance(ue,Zt),this.addCurrentVertex(Zt,ve,0,0,Q),ue=Zt}}const Lt=ue&&me;let zt=Lt?m:z?"butt":_;if(Lt&&zt==="round"&&(ct<T?zt="miter":ct<=2&&(zt="fakeround")),zt==="miter"&&ct>k&&(zt="bevel"),zt==="bevel"&&(ct>2&&(zt="flipbevel"),ct<k&&(zt="miter")),ue&&this.updateDistance(ue,ae),zt==="miter")Je._mult(ct),this.addCurrentVertex(ae,Je,0,0,Q);else if(zt==="flipbevel"){if(ct>100)Je=Ce.mult(-1);else{const er=ct*ve.add(Ce).mag()/ve.sub(Ce).mag();Je._perp()._mult(er*(lr?-1:1))}this.addCurrentVertex(ae,Je,0,0,Q),this.addCurrentVertex(ae,Je.mult(-1),0,0,Q)}else if(zt==="bevel"||zt==="fakeround"){const er=-Math.sqrt(ct*ct-1),Zt=lr?er:0,Gt=lr?0:er;if(ue&&this.addCurrentVertex(ae,ve,Zt,Gt,Q),zt==="fakeround"){const pt=Math.round(180*_t/Math.PI/20);for(let tr=1;tr<pt;tr++){let Qt=tr/pt;if(Qt!==.5){const Kr=Qt-.5;Qt+=Qt*Kr*(Qt-1)*((1.0904+je*(je*(3.55645-1.43519*je)-3.2452))*Kr*Kr+(.848013+je*(.215638*je-1.06021)))}const gr=Ce.sub(ve)._mult(Qt)._add(ve)._unit()._mult(lr?-1:1);this.addHalfVertex(ae,gr.x,gr.y,!1,lr,0,Q)}}me&&this.addCurrentVertex(ae,Ce,-Zt,-Gt,Q)}else if(zt==="butt")this.addCurrentVertex(ae,Je,0,0,Q);else if(zt==="square"){const er=ue?1:-1;this.addCurrentVertex(ae,Je,er,er,Q)}else zt==="round"&&(ue&&(this.addCurrentVertex(ae,ve,0,0,Q),this.addCurrentVertex(ae,ve,1,1,Q,!0)),me&&(this.addCurrentVertex(ae,Ce,-1,-1,Q,!0),this.addCurrentVertex(ae,Ce,0,0,Q)));if($t&&Ie<L-1){const er=ae.dist(me);if(er>2*q){const Zt=ae.add(me.sub(ae)._mult(q/er)._round());this.updateDistance(ae,Zt),this.addCurrentVertex(Zt,Ce,0,0,Q),ae=Zt}}}}addCurrentVertex(l,d,m,_,k,T=!1){const z=d.y*_-d.x,L=-d.y-d.x*_;this.addHalfVertex(l,d.x+d.y*m,d.y-d.x*m,T,!1,m,k),this.addHalfVertex(l,z,L,T,!0,-_,k),this.distance>aC/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(l,d,m,_,k,T))}addHalfVertex({x:l,y:d},m,_,k,T,z,L){const F=.5*(this.lineClips?this.scaledDistance*(aC-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((l<<1)+(k?1:0),(d<<1)+(T?1:0),Math.round(63*m)+128,Math.round(63*_)+128,1+(z===0?0:z<0?-1:1)|(63&F)<<2,F>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const q=L.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,q),L.primitiveLength++),T?this.e2=q:this.e1=q}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(l,d){this.distance+=l.dist(d),this.updateScaledDistance()}}let iC,sC;Wt("LineBucket",nb,{omit:["layers","patternFeatures"]});var oC={get paint(){return sC=sC||new C({"line-opacity":new ur($e.paint_line["line-opacity"]),"line-color":new ur($e.paint_line["line-color"]),"line-translate":new Yt($e.paint_line["line-translate"]),"line-translate-anchor":new Yt($e.paint_line["line-translate-anchor"]),"line-width":new ur($e.paint_line["line-width"]),"line-gap-width":new ur($e.paint_line["line-gap-width"]),"line-offset":new ur($e.paint_line["line-offset"]),"line-blur":new ur($e.paint_line["line-blur"]),"line-dasharray":new cd($e.paint_line["line-dasharray"]),"line-pattern":new ud($e.paint_line["line-pattern"]),"line-gradient":new Mf($e.paint_line["line-gradient"])})},get layout(){return iC=iC||new C({"line-cap":new Yt($e.layout_line["line-cap"]),"line-join":new ur($e.layout_line["line-join"]),"line-miter-limit":new Yt($e.layout_line["line-miter-limit"]),"line-round-limit":new Yt($e.layout_line["line-round-limit"]),"line-sort-key":new ur($e.layout_line["line-sort-key"])})}};class T4 extends ur{possiblyEvaluate(l,d){return d=new nn(Math.floor(d.zoom),{now:d.now,fadeDuration:d.fadeDuration,zoomHistory:d.zoomHistory,transition:d.transition}),super.possiblyEvaluate(l,d)}evaluate(l,d,m,_){return d=$({},d,{zoom:Math.floor(d.zoom)}),super.evaluate(l,d,m,_)}}let Gg;class P4 extends f{constructor(l){super(l,oC),this.gradientVersion=0,Gg||(Gg=new T4(oC.paint.properties["line-width"].specification),Gg.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){const d=this.gradientExpression();this.stepInterpolant=!!function(m){return m._styleExpression!==void 0}(d)&&d._styleExpression.expression instanceof Yo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(l,d){super.recalculate(l,d),this.paint._values["line-floorwidth"]=Gg.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new nb(l)}queryRadius(l){const d=l,m=lC(Rf("line-width",this,d),Rf("line-gap-width",this,d)),_=Rf("line-offset",this,d);return m/2+Math.abs(_)+Fg(this.paint.get("line-translate"))}queryIntersectsFeature(l,d,m,_,k,T,z){const L=$g(l,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),T.angle,z),F=z/2*lC(this.paint.get("line-width").evaluate(d,m),this.paint.get("line-gap-width").evaluate(d,m)),q=this.paint.get("line-offset").evaluate(d,m);return q&&(_=function(Q,ae){const ue=[];for(let me=0;me<Q.length;me++){const ve=Q[me],Ce=[];for(let Ie=0;Ie<ve.length;Ie++){const Je=ve[Ie-1],je=ve[Ie],Ze=ve[Ie+1],ct=Ie===0?new v(0,0):je.sub(Je)._unit()._perp(),_t=Ie===ve.length-1?new v(0,0):Ze.sub(je)._unit()._perp(),$t=ct._add(_t)._unit(),lr=$t.x*_t.x+$t.y*_t.y;lr!==0&&$t._mult(1/lr),Ce.push($t._mult(ae)._add(je))}ue.push(Ce)}return ue}(_,q*z)),function(Q,ae,ue){for(let me=0;me<ae.length;me++){const ve=ae[me];if(Q.length>=3){for(let Ce=0;Ce<ve.length;Ce++)if(vd(Q,ve[Ce]))return!0}if(BB(Q,ve,ue))return!0}return!1}(L,_,F)}isTileClipped(){return!0}}function lC(c,l){return l>0?l+2*c:c}const I4=R([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),A4=R([{name:"a_projected_pos",components:3,type:"Float32"}],4);R([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const N4=R([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);R([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const uC=R([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),M4=R([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function D4(c,l,d){return c.sections.forEach(m=>{m.text=function(_,k,T){const z=k.layout.get("text-transform").evaluate(T,{});return z==="uppercase"?_=_.toLocaleUpperCase():z==="lowercase"&&(_=_.toLocaleLowerCase()),Ka.applyArabicShaping&&(_=Ka.applyArabicShaping(_)),_}(m.text,l,d)}),c}R([{name:"triangle",components:3,type:"Uint16"}]),R([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),R([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),R([{type:"Float32",name:"offsetX"}]),R([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),R([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Uf={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Bn=24,cC=Zr,dC=function(c,l,d,m,_){var k,T,z=8*_-m-1,L=(1<<z)-1,F=L>>1,q=-7,Q=_-1,ae=-1,ue=c[l+Q];for(Q+=ae,k=ue&(1<<-q)-1,ue>>=-q,q+=z;q>0;k=256*k+c[l+Q],Q+=ae,q-=8);for(T=k&(1<<-q)-1,k>>=-q,q+=m;q>0;T=256*T+c[l+Q],Q+=ae,q-=8);if(k===0)k=1-F;else{if(k===L)return T?NaN:1/0*(ue?-1:1);T+=Math.pow(2,m),k-=F}return(ue?-1:1)*T*Math.pow(2,k-m)},hC=function(c,l,d,m,_,k){var T,z,L,F=8*k-_-1,q=(1<<F)-1,Q=q>>1,ae=_===23?Math.pow(2,-24)-Math.pow(2,-77):0,ue=0,me=1,ve=l<0||l===0&&1/l<0?1:0;for(l=Math.abs(l),isNaN(l)||l===1/0?(z=isNaN(l)?1:0,T=q):(T=Math.floor(Math.log(l)/Math.LN2),l*(L=Math.pow(2,-T))<1&&(T--,L*=2),(l+=T+Q>=1?ae/L:ae*Math.pow(2,1-Q))*L>=2&&(T++,L/=2),T+Q>=q?(z=0,T=q):T+Q>=1?(z=(l*L-1)*Math.pow(2,_),T+=Q):(z=l*Math.pow(2,Q-1)*Math.pow(2,_),T=0));_>=8;c[d+ue]=255&z,ue+=me,z/=256,_-=8);for(T=T<<_|z,F+=_;F>0;c[d+ue]=255&T,ue+=me,T/=256,F-=8);c[d+ue-me]|=128*ve};function Zr(c){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(c)?c:new Uint8Array(c||0),this.pos=0,this.type=0,this.length=this.buf.length}Zr.Varint=0,Zr.Fixed64=1,Zr.Bytes=2,Zr.Fixed32=5;var ab=4294967296,fC=1/ab,pC=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function Eo(c){return c.type===Zr.Bytes?c.readVarint()+c.pos:c.pos+1}function _d(c,l,d){return d?4294967296*l+(c>>>0):4294967296*(l>>>0)+(c>>>0)}function mC(c,l,d){var m=l<=16383?1:l<=2097151?2:l<=268435455?3:Math.floor(Math.log(l)/(7*Math.LN2));d.realloc(m);for(var _=d.pos-1;_>=c;_--)d.buf[_+m]=d.buf[_]}function z4(c,l){for(var d=0;d<c.length;d++)l.writeVarint(c[d])}function R4(c,l){for(var d=0;d<c.length;d++)l.writeSVarint(c[d])}function L4(c,l){for(var d=0;d<c.length;d++)l.writeFloat(c[d])}function B4(c,l){for(var d=0;d<c.length;d++)l.writeDouble(c[d])}function j4(c,l){for(var d=0;d<c.length;d++)l.writeBoolean(c[d])}function O4(c,l){for(var d=0;d<c.length;d++)l.writeFixed32(c[d])}function F4(c,l){for(var d=0;d<c.length;d++)l.writeSFixed32(c[d])}function $4(c,l){for(var d=0;d<c.length;d++)l.writeFixed64(c[d])}function V4(c,l){for(var d=0;d<c.length;d++)l.writeSFixed64(c[d])}function Wg(c,l){return(c[l]|c[l+1]<<8|c[l+2]<<16)+16777216*c[l+3]}function wd(c,l,d){c[d]=l,c[d+1]=l>>>8,c[d+2]=l>>>16,c[d+3]=l>>>24}function gC(c,l){return(c[l]|c[l+1]<<8|c[l+2]<<16)+(c[l+3]<<24)}Zr.prototype={destroy:function(){this.buf=null},readFields:function(c,l,d){for(d=d||this.length;this.pos<d;){var m=this.readVarint(),_=m>>3,k=this.pos;this.type=7&m,c(_,l,this),this.pos===k&&this.skip(m)}return l},readMessage:function(c,l){return this.readFields(c,l,this.readVarint()+this.pos)},readFixed32:function(){var c=Wg(this.buf,this.pos);return this.pos+=4,c},readSFixed32:function(){var c=gC(this.buf,this.pos);return this.pos+=4,c},readFixed64:function(){var c=Wg(this.buf,this.pos)+Wg(this.buf,this.pos+4)*ab;return this.pos+=8,c},readSFixed64:function(){var c=Wg(this.buf,this.pos)+gC(this.buf,this.pos+4)*ab;return this.pos+=8,c},readFloat:function(){var c=dC(this.buf,this.pos,!0,23,4);return this.pos+=4,c},readDouble:function(){var c=dC(this.buf,this.pos,!0,52,8);return this.pos+=8,c},readVarint:function(c){var l,d,m=this.buf;return l=127&(d=m[this.pos++]),d<128?l:(l|=(127&(d=m[this.pos++]))<<7,d<128?l:(l|=(127&(d=m[this.pos++]))<<14,d<128?l:(l|=(127&(d=m[this.pos++]))<<21,d<128?l:function(_,k,T){var z,L,F=T.buf;if(z=(112&(L=F[T.pos++]))>>4,L<128||(z|=(127&(L=F[T.pos++]))<<3,L<128)||(z|=(127&(L=F[T.pos++]))<<10,L<128)||(z|=(127&(L=F[T.pos++]))<<17,L<128)||(z|=(127&(L=F[T.pos++]))<<24,L<128)||(z|=(1&(L=F[T.pos++]))<<31,L<128))return _d(_,z,k);throw new Error("Expected varint not more than 10 bytes")}(l|=(15&(d=m[this.pos]))<<28,c,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var c=this.readVarint();return c%2==1?(c+1)/-2:c/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var c=this.readVarint()+this.pos,l=this.pos;return this.pos=c,c-l>=12&&pC?function(d,m,_){return pC.decode(d.subarray(m,_))}(this.buf,l,c):function(d,m,_){for(var k="",T=m;T<_;){var z,L,F,q=d[T],Q=null,ae=q>239?4:q>223?3:q>191?2:1;if(T+ae>_)break;ae===1?q<128&&(Q=q):ae===2?(192&(z=d[T+1]))==128&&(Q=(31&q)<<6|63&z)<=127&&(Q=null):ae===3?(L=d[T+2],(192&(z=d[T+1]))==128&&(192&L)==128&&((Q=(15&q)<<12|(63&z)<<6|63&L)<=2047||Q>=55296&&Q<=57343)&&(Q=null)):ae===4&&(L=d[T+2],F=d[T+3],(192&(z=d[T+1]))==128&&(192&L)==128&&(192&F)==128&&((Q=(15&q)<<18|(63&z)<<12|(63&L)<<6|63&F)<=65535||Q>=1114112)&&(Q=null)),Q===null?(Q=65533,ae=1):Q>65535&&(Q-=65536,k+=String.fromCharCode(Q>>>10&1023|55296),Q=56320|1023&Q),k+=String.fromCharCode(Q),T+=ae}return k}(this.buf,l,c)},readBytes:function(){var c=this.readVarint()+this.pos,l=this.buf.subarray(this.pos,c);return this.pos=c,l},readPackedVarint:function(c,l){if(this.type!==Zr.Bytes)return c.push(this.readVarint(l));var d=Eo(this);for(c=c||[];this.pos<d;)c.push(this.readVarint(l));return c},readPackedSVarint:function(c){if(this.type!==Zr.Bytes)return c.push(this.readSVarint());var l=Eo(this);for(c=c||[];this.pos<l;)c.push(this.readSVarint());return c},readPackedBoolean:function(c){if(this.type!==Zr.Bytes)return c.push(this.readBoolean());var l=Eo(this);for(c=c||[];this.pos<l;)c.push(this.readBoolean());return c},readPackedFloat:function(c){if(this.type!==Zr.Bytes)return c.push(this.readFloat());var l=Eo(this);for(c=c||[];this.pos<l;)c.push(this.readFloat());return c},readPackedDouble:function(c){if(this.type!==Zr.Bytes)return c.push(this.readDouble());var l=Eo(this);for(c=c||[];this.pos<l;)c.push(this.readDouble());return c},readPackedFixed32:function(c){if(this.type!==Zr.Bytes)return c.push(this.readFixed32());var l=Eo(this);for(c=c||[];this.pos<l;)c.push(this.readFixed32());return c},readPackedSFixed32:function(c){if(this.type!==Zr.Bytes)return c.push(this.readSFixed32());var l=Eo(this);for(c=c||[];this.pos<l;)c.push(this.readSFixed32());return c},readPackedFixed64:function(c){if(this.type!==Zr.Bytes)return c.push(this.readFixed64());var l=Eo(this);for(c=c||[];this.pos<l;)c.push(this.readFixed64());return c},readPackedSFixed64:function(c){if(this.type!==Zr.Bytes)return c.push(this.readSFixed64());var l=Eo(this);for(c=c||[];this.pos<l;)c.push(this.readSFixed64());return c},skip:function(c){var l=7&c;if(l===Zr.Varint)for(;this.buf[this.pos++]>127;);else if(l===Zr.Bytes)this.pos=this.readVarint()+this.pos;else if(l===Zr.Fixed32)this.pos+=4;else{if(l!==Zr.Fixed64)throw new Error("Unimplemented type: "+l);this.pos+=8}},writeTag:function(c,l){this.writeVarint(c<<3|l)},realloc:function(c){for(var l=this.length||16;l<this.pos+c;)l*=2;if(l!==this.length){var d=new Uint8Array(l);d.set(this.buf),this.buf=d,this.length=l}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(c){this.realloc(4),wd(this.buf,c,this.pos),this.pos+=4},writeSFixed32:function(c){this.realloc(4),wd(this.buf,c,this.pos),this.pos+=4},writeFixed64:function(c){this.realloc(8),wd(this.buf,-1&c,this.pos),wd(this.buf,Math.floor(c*fC),this.pos+4),this.pos+=8},writeSFixed64:function(c){this.realloc(8),wd(this.buf,-1&c,this.pos),wd(this.buf,Math.floor(c*fC),this.pos+4),this.pos+=8},writeVarint:function(c){(c=+c||0)>268435455||c<0?function(l,d){var m,_;if(l>=0?(m=l%4294967296|0,_=l/4294967296|0):(_=~(-l/4294967296),4294967295^(m=~(-l%4294967296))?m=m+1|0:(m=0,_=_+1|0)),l>=18446744073709552e3||l<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");d.realloc(10),function(k,T,z){z.buf[z.pos++]=127&k|128,k>>>=7,z.buf[z.pos++]=127&k|128,k>>>=7,z.buf[z.pos++]=127&k|128,k>>>=7,z.buf[z.pos++]=127&k|128,z.buf[z.pos]=127&(k>>>=7)}(m,0,d),function(k,T){var z=(7&k)<<4;T.buf[T.pos++]|=z|((k>>>=3)?128:0),k&&(T.buf[T.pos++]=127&k|((k>>>=7)?128:0),k&&(T.buf[T.pos++]=127&k|((k>>>=7)?128:0),k&&(T.buf[T.pos++]=127&k|((k>>>=7)?128:0),k&&(T.buf[T.pos++]=127&k|((k>>>=7)?128:0),k&&(T.buf[T.pos++]=127&k)))))}(_,d)}(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))},writeSVarint:function(c){this.writeVarint(c<0?2*-c-1:2*c)},writeBoolean:function(c){this.writeVarint(!!c)},writeString:function(c){c=String(c),this.realloc(4*c.length),this.pos++;var l=this.pos;this.pos=function(m,_,k){for(var T,z,L=0;L<_.length;L++){if((T=_.charCodeAt(L))>55295&&T<57344){if(!z){T>56319||L+1===_.length?(m[k++]=239,m[k++]=191,m[k++]=189):z=T;continue}if(T<56320){m[k++]=239,m[k++]=191,m[k++]=189,z=T;continue}T=z-55296<<10|T-56320|65536,z=null}else z&&(m[k++]=239,m[k++]=191,m[k++]=189,z=null);T<128?m[k++]=T:(T<2048?m[k++]=T>>6|192:(T<65536?m[k++]=T>>12|224:(m[k++]=T>>18|240,m[k++]=T>>12&63|128),m[k++]=T>>6&63|128),m[k++]=63&T|128)}return k}(this.buf,c,this.pos);var d=this.pos-l;d>=128&&mC(l,d,this),this.pos=l-1,this.writeVarint(d),this.pos+=d},writeFloat:function(c){this.realloc(4),hC(this.buf,c,this.pos,!0,23,4),this.pos+=4},writeDouble:function(c){this.realloc(8),hC(this.buf,c,this.pos,!0,52,8),this.pos+=8},writeBytes:function(c){var l=c.length;this.writeVarint(l),this.realloc(l);for(var d=0;d<l;d++)this.buf[this.pos++]=c[d]},writeRawMessage:function(c,l){this.pos++;var d=this.pos;c(l,this);var m=this.pos-d;m>=128&&mC(d,m,this),this.pos=d-1,this.writeVarint(m),this.pos+=m},writeMessage:function(c,l,d){this.writeTag(c,Zr.Bytes),this.writeRawMessage(l,d)},writePackedVarint:function(c,l){l.length&&this.writeMessage(c,z4,l)},writePackedSVarint:function(c,l){l.length&&this.writeMessage(c,R4,l)},writePackedBoolean:function(c,l){l.length&&this.writeMessage(c,j4,l)},writePackedFloat:function(c,l){l.length&&this.writeMessage(c,L4,l)},writePackedDouble:function(c,l){l.length&&this.writeMessage(c,B4,l)},writePackedFixed32:function(c,l){l.length&&this.writeMessage(c,O4,l)},writePackedSFixed32:function(c,l){l.length&&this.writeMessage(c,F4,l)},writePackedFixed64:function(c,l){l.length&&this.writeMessage(c,$4,l)},writePackedSFixed64:function(c,l){l.length&&this.writeMessage(c,V4,l)},writeBytesField:function(c,l){this.writeTag(c,Zr.Bytes),this.writeBytes(l)},writeFixed32Field:function(c,l){this.writeTag(c,Zr.Fixed32),this.writeFixed32(l)},writeSFixed32Field:function(c,l){this.writeTag(c,Zr.Fixed32),this.writeSFixed32(l)},writeFixed64Field:function(c,l){this.writeTag(c,Zr.Fixed64),this.writeFixed64(l)},writeSFixed64Field:function(c,l){this.writeTag(c,Zr.Fixed64),this.writeSFixed64(l)},writeVarintField:function(c,l){this.writeTag(c,Zr.Varint),this.writeVarint(l)},writeSVarintField:function(c,l){this.writeTag(c,Zr.Varint),this.writeSVarint(l)},writeStringField:function(c,l){this.writeTag(c,Zr.Bytes),this.writeString(l)},writeFloatField:function(c,l){this.writeTag(c,Zr.Fixed32),this.writeFloat(l)},writeDoubleField:function(c,l){this.writeTag(c,Zr.Fixed64),this.writeDouble(l)},writeBooleanField:function(c,l){this.writeVarintField(c,!!l)}};var ib=h(cC);const sb=3;function U4(c,l,d){c===1&&d.readMessage(q4,l)}function q4(c,l,d){if(c===3){const{id:m,bitmap:_,width:k,height:T,left:z,top:L,advance:F}=d.readMessage(H4,{});l.push({id:m,bitmap:new Bf({width:k+2*sb,height:T+2*sb},_),metrics:{width:k,height:T,left:z,top:L,advance:F}})}}function H4(c,l,d){c===1?l.id=d.readVarint():c===2?l.bitmap=d.readBytes():c===3?l.width=d.readVarint():c===4?l.height=d.readVarint():c===5?l.left=d.readSVarint():c===6?l.top=d.readSVarint():c===7&&(l.advance=d.readVarint())}const vC=sb;function yC(c){let l=0,d=0;for(const T of c)l+=T.w*T.h,d=Math.max(d,T.w);c.sort((T,z)=>z.h-T.h);const m=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(l/.95)),d),h:1/0}];let _=0,k=0;for(const T of c)for(let z=m.length-1;z>=0;z--){const L=m[z];if(!(T.w>L.w||T.h>L.h)){if(T.x=L.x,T.y=L.y,k=Math.max(k,T.y+T.h),_=Math.max(_,T.x+T.w),T.w===L.w&&T.h===L.h){const F=m.pop();z<m.length&&(m[z]=F)}else T.h===L.h?(L.x+=T.w,L.w-=T.w):T.w===L.w?(L.y+=T.h,L.h-=T.h):(m.push({x:L.x+T.w,y:L.y,w:L.w-T.w,h:T.h}),L.y+=T.h,L.h-=T.h);break}}return{w:_,h:k,fill:l/(_*k)||0}}const Ja=1;class ob{constructor(l,{pixelRatio:d,version:m,stretchX:_,stretchY:k,content:T,textFitWidth:z,textFitHeight:L}){this.paddedRect=l,this.pixelRatio=d,this.stretchX=_,this.stretchY=k,this.content=T,this.version=m,this.textFitWidth=z,this.textFitHeight=L}get tl(){return[this.paddedRect.x+Ja,this.paddedRect.y+Ja]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ja,this.paddedRect.y+this.paddedRect.h-Ja]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Ja)/this.pixelRatio,(this.paddedRect.h-2*Ja)/this.pixelRatio]}}class xC{constructor(l,d){const m={},_={};this.haveRenderCallbacks=[];const k=[];this.addImages(l,m,k),this.addImages(d,_,k);const{w:T,h:z}=yC(k),L=new Mi({width:T||1,height:z||1});for(const F in l){const q=l[F],Q=m[F].paddedRect;Mi.copy(q.data,L,{x:0,y:0},{x:Q.x+Ja,y:Q.y+Ja},q.data)}for(const F in d){const q=d[F],Q=_[F].paddedRect,ae=Q.x+Ja,ue=Q.y+Ja,me=q.data.width,ve=q.data.height;Mi.copy(q.data,L,{x:0,y:0},{x:ae,y:ue},q.data),Mi.copy(q.data,L,{x:0,y:ve-1},{x:ae,y:ue-1},{width:me,height:1}),Mi.copy(q.data,L,{x:0,y:0},{x:ae,y:ue+ve},{width:me,height:1}),Mi.copy(q.data,L,{x:me-1,y:0},{x:ae-1,y:ue},{width:1,height:ve}),Mi.copy(q.data,L,{x:0,y:0},{x:ae+me,y:ue},{width:1,height:ve})}this.image=L,this.iconPositions=m,this.patternPositions=_}addImages(l,d,m){for(const _ in l){const k=l[_],T={x:0,y:0,w:k.data.width+2*Ja,h:k.data.height+2*Ja};m.push(T),d[_]=new ob(T,k),k.hasRenderCallback&&this.haveRenderCallbacks.push(_)}}patchUpdatedImages(l,d){l.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const m in l.updatedImages)this.patchUpdatedImage(this.iconPositions[m],l.getImage(m),d),this.patchUpdatedImage(this.patternPositions[m],l.getImage(m),d)}patchUpdatedImage(l,d,m){if(!l||!d||l.version===d.version)return;l.version=d.version;const[_,k]=l.tl;m.update(d.data,void 0,{x:_,y:k})}}var wl;Wt("ImagePosition",ob),Wt("ImageAtlas",xC),u.ah=void 0,(wl=u.ah||(u.ah={}))[wl.none=0]="none",wl[wl.horizontal=1]="horizontal",wl[wl.vertical=2]="vertical",wl[wl.horizontalOnly=3]="horizontalOnly";const qf=-17;class Hf{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(l,d){const m=new Hf;return m.scale=l||1,m.fontStack=d,m}static forImage(l){const d=new Hf;return d.imageName=l,d}}class Sd{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(l,d){const m=new Sd;for(let _=0;_<l.sections.length;_++){const k=l.sections[_];k.image?m.addImageSection(k):m.addTextSection(k,d)}return m}length(){return this.text.length}getSection(l){return this.sections[this.sectionIndex[l]]}getSectionIndex(l){return this.sectionIndex[l]}getCharCode(l){return this.text.charCodeAt(l)}verticalizePunctuation(){this.text=function(l){let d="";for(let m=0;m<l.length;m++){const _=l.charCodeAt(m+1)||null,k=l.charCodeAt(m-1)||null;d+=_&&Dg(_)&&!Uf[l[m+1]]||k&&Dg(k)&&!Uf[l[m-1]]||!Uf[l[m]]?l[m]:Uf[l[m]]}return d}(this.text)}trim(){let l=0;for(let m=0;m<this.text.length&&Xg[this.text.charCodeAt(m)];m++)l++;let d=this.text.length;for(let m=this.text.length-1;m>=0&&m>=l&&Xg[this.text.charCodeAt(m)];m--)d--;this.text=this.text.substring(l,d),this.sectionIndex=this.sectionIndex.slice(l,d)}substring(l,d){const m=new Sd;return m.text=this.text.substring(l,d),m.sectionIndex=this.sectionIndex.slice(l,d),m.sections=this.sections,m}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((l,d)=>Math.max(l,this.sections[d].scale),0)}addTextSection(l,d){this.text+=l.text,this.sections.push(Hf.forText(l.scale,l.fontStack||d));const m=this.sections.length-1;for(let _=0;_<l.text.length;++_)this.sectionIndex.push(m)}addImageSection(l){const d=l.image?l.image.name:"";if(d.length===0)return void Y("Can't add FormattedSection with an empty image.");const m=this.getNextImageSectionCharCode();m?(this.text+=String.fromCharCode(m),this.sections.push(Hf.forImage(d)),this.sectionIndex.push(this.sections.length-1)):Y("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Zg(c,l,d,m,_,k,T,z,L,F,q,Q,ae,ue,me){const ve=Sd.fromFeature(c,_);let Ce;Q===u.ah.vertical&&ve.verticalizePunctuation();const{processBidirectionalText:Ie,processStyledBidirectionalText:Je}=Ka;if(Ie&&ve.sections.length===1){Ce=[];const ct=Ie(ve.toString(),lb(ve,F,k,l,m,ue));for(const _t of ct){const $t=new Sd;$t.text=_t,$t.sections=ve.sections;for(let lr=0;lr<_t.length;lr++)$t.sectionIndex.push(0);Ce.push($t)}}else if(Je){Ce=[];const ct=Je(ve.text,ve.sectionIndex,lb(ve,F,k,l,m,ue));for(const _t of ct){const $t=new Sd;$t.text=_t[0],$t.sectionIndex=_t[1],$t.sections=ve.sections,Ce.push($t)}}else Ce=function(ct,_t){const $t=[],lr=ct.text;let Lt=0;for(const zt of _t)$t.push(ct.substring(Lt,zt)),Lt=zt;return Lt<lr.length&&$t.push(ct.substring(Lt,lr.length)),$t}(ve,lb(ve,F,k,l,m,ue));const je=[],Ze={positionedLines:je,text:ve.toString(),top:q[1],bottom:q[1],left:q[0],right:q[0],writingMode:Q,iconsInText:!1,verticalizable:!1};return function(ct,_t,$t,lr,Lt,zt,er,Zt,Gt,pt,tr,Qt){let gr=0,Kr=qf,Xr=0,$n=0;const Ji=Zt==="right"?1:Zt==="left"?0:.5;let ca=0;for(const Cn of Lt){Cn.trim();const Un=Cn.getMaxScale(),_a=(Un-1)*Bn,da={positionedGlyphs:[],lineOffset:0};ct.positionedLines[ca]=da;const Oa=da.positionedGlyphs;let ha=0;if(!Cn.length()){Kr+=zt,++ca;continue}for(let Qa=0;Qa<Cn.length();Qa++){const Lr=Cn.getSection(Qa),tn=Cn.getSectionIndex(Qa),ln=Cn.getCharCode(Qa);let pi=0,yn=null,Td=null,qs=null,Hs=Bn;const Qi=!(Gt===u.ah.horizontal||!tr&&!Af(ln)||tr&&(Xg[ln]||(Vn=ln,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(Vn)))));if(Lr.imageName){const Ri=lr[Lr.imageName];if(!Ri)continue;qs=Lr.imageName,ct.iconsInText=ct.iconsInText||!0,Td=Ri.paddedRect;const Kn=Ri.displaySize;Lr.scale=Lr.scale*Bn/Qt,yn={width:Kn[0],height:Kn[1],left:Ja,top:-vC,advance:Qi?Kn[1]:Kn[0]},pi=_a+(Bn-Kn[1]*Lr.scale),Hs=yn.advance;const Co=Qi?Kn[0]*Lr.scale-Bn*Un:Kn[1]*Lr.scale-Bn*Un;Co>0&&Co>ha&&(ha=Co)}else{const Ri=$t[Lr.fontStack],Kn=Ri&&Ri[ln];if(Kn&&Kn.rect)Td=Kn.rect,yn=Kn.metrics;else{const Co=_t[Lr.fontStack],Yf=Co&&Co[ln];if(!Yf)continue;yn=Yf.metrics}pi=(Un-Lr.scale)*Bn}Qi?(ct.verticalizable=!0,Oa.push({glyph:ln,imageName:qs,x:gr,y:Kr+pi,vertical:Qi,scale:Lr.scale,fontStack:Lr.fontStack,sectionIndex:tn,metrics:yn,rect:Td}),gr+=Hs*Lr.scale+pt):(Oa.push({glyph:ln,imageName:qs,x:gr,y:Kr+pi,vertical:Qi,scale:Lr.scale,fontStack:Lr.fontStack,sectionIndex:tn,metrics:yn,rect:Td}),gr+=yn.advance*Lr.scale+pt)}Oa.length!==0&&(Xr=Math.max(gr-pt,Xr),X4(Oa,0,Oa.length-1,Ji,ha)),gr=0;const zi=zt*Un+ha;da.lineOffset=Math.max(ha,_a),Kr+=zi,$n=Math.max(zi,$n),++ca}var Vn;const La=Kr-qf,{horizontalAlign:Ba,verticalAlign:ja}=ub(er);(function(Cn,Un,_a,da,Oa,ha,zi,Qa,Lr){const tn=(Un-_a)*Oa;let ln=0;ln=ha!==zi?-Qa*da-qf:(-da*Lr+.5)*zi;for(const pi of Cn)for(const yn of pi.positionedGlyphs)yn.x+=tn,yn.y+=ln})(ct.positionedLines,Ji,Ba,ja,Xr,$n,zt,La,Lt.length),ct.top+=-ja*La,ct.bottom=ct.top+La,ct.left+=-Ba*Xr,ct.right=ct.left+Xr}(Ze,l,d,m,Ce,T,z,L,Q,F,ae,me),!function(ct){for(const _t of ct)if(_t.positionedGlyphs.length!==0)return!1;return!0}(je)&&Ze}const Xg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},G4={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},W4={40:!0};function bC(c,l,d,m,_,k){if(l.imageName){const T=m[l.imageName];return T?T.displaySize[0]*l.scale*Bn/k+_:0}{const T=d[l.fontStack],z=T&&T[c];return z?z.metrics.advance*l.scale+_:0}}function _C(c,l,d,m){const _=Math.pow(c-l,2);return m?c<l?_/2:2*_:_+Math.abs(d)*d}function Z4(c,l,d){let m=0;return c===10&&(m-=1e4),d&&(m+=150),c!==40&&c!==65288||(m+=50),l!==41&&l!==65289||(m+=50),m}function wC(c,l,d,m,_,k){let T=null,z=_C(l,d,_,k);for(const L of m){const F=_C(l-L.x,d,_,k)+L.badness;F<=z&&(T=L,z=F)}return{index:c,x:l,priorBreak:T,badness:z}}function SC(c){return c?SC(c.priorBreak).concat(c.index):[]}function lb(c,l,d,m,_,k){if(!c)return[];const T=[],z=function(Q,ae,ue,me,ve,Ce){let Ie=0;for(let Je=0;Je<Q.length();Je++){const je=Q.getSection(Je);Ie+=bC(Q.getCharCode(Je),je,me,ve,ae,Ce)}return Ie/Math.max(1,Math.ceil(Ie/ue))}(c,l,d,m,_,k),L=c.text.indexOf("")>=0;let F=0;for(let Q=0;Q<c.length();Q++){const ae=c.getSection(Q),ue=c.getCharCode(Q);if(Xg[ue]||(F+=bC(ue,ae,m,_,l,k)),Q<c.length()-1){const me=!((q=ue)<11904)&&(!!Ir["CJK Compatibility Forms"](q)||!!Ir["CJK Compatibility"](q)||!!Ir["CJK Strokes"](q)||!!Ir["CJK Symbols and Punctuation"](q)||!!Ir["Enclosed CJK Letters and Months"](q)||!!Ir["Halfwidth and Fullwidth Forms"](q)||!!Ir["Ideographic Description Characters"](q)||!!Ir["Vertical Forms"](q)||Mg.test(String.fromCodePoint(q)));(G4[ue]||me||ae.imageName||Q!==c.length()-2&&W4[c.getCharCode(Q+1)])&&T.push(wC(Q+1,F,z,T,Z4(ue,c.getCharCode(Q+1),me&&L),!1))}}var q;return SC(wC(c.length(),F,z,T,0,!0))}function ub(c){let l=.5,d=.5;switch(c){case"right":case"top-right":case"bottom-right":l=1;break;case"left":case"top-left":case"bottom-left":l=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":d=1;break;case"top":case"top-right":case"top-left":d=0}return{horizontalAlign:l,verticalAlign:d}}function X4(c,l,d,m,_){if(!m&&!_)return;const k=c[d],T=(c[d].x+k.metrics.advance*k.scale)*m;for(let z=l;z<=d;z++)c[z].x-=T,c[z].y+=_}function K4(c,l,d){const{horizontalAlign:m,verticalAlign:_}=ub(d),k=l[0]-c.displaySize[0]*m,T=l[1]-c.displaySize[1]*_;return{image:c,top:T,bottom:T+c.displaySize[1],left:k,right:k+c.displaySize[0]}}function EC(c){var l,d;let m=c.left,_=c.top,k=c.right-m,T=c.bottom-_;const z=(l=c.image.textFitWidth)!==null&&l!==void 0?l:"stretchOrShrink",L=(d=c.image.textFitHeight)!==null&&d!==void 0?d:"stretchOrShrink",F=(c.image.content[2]-c.image.content[0])/(c.image.content[3]-c.image.content[1]);if(L==="proportional"){if(z==="stretchOnly"&&k/T<F||z==="proportional"){const q=Math.ceil(T*F);m*=q/k,k=q}}else if(z==="proportional"&&L==="stretchOnly"&&F!==0&&k/T>F){const q=Math.ceil(k/F);_*=q/T,T=q}return{x1:m,y1:_,x2:m+k,y2:_+T}}function CC(c,l,d,m,_,k){const T=c.image;let z;if(T.content){const Ce=T.content,Ie=T.pixelRatio||1;z=[Ce[0]/Ie,Ce[1]/Ie,T.displaySize[0]-Ce[2]/Ie,T.displaySize[1]-Ce[3]/Ie]}const L=l.left*k,F=l.right*k;let q,Q,ae,ue;d==="width"||d==="both"?(ue=_[0]+L-m[3],Q=_[0]+F+m[1]):(ue=_[0]+(L+F-T.displaySize[0])/2,Q=ue+T.displaySize[0]);const me=l.top*k,ve=l.bottom*k;return d==="height"||d==="both"?(q=_[1]+me-m[0],ae=_[1]+ve+m[2]):(q=_[1]+(me+ve-T.displaySize[1])/2,ae=q+T.displaySize[1]),{image:T,top:q,right:Q,bottom:ae,left:ue,collisionPadding:z}}const Gf=255,Us=128,Sl=Gf*Us;function kC(c,l){const{expression:d}=l;if(d.kind==="constant")return{kind:"constant",layoutSize:d.evaluate(new nn(c+1))};if(d.kind==="source")return{kind:"source"};{const{zoomStops:m,interpolationType:_}=d;let k=0;for(;k<m.length&&m[k]<=c;)k++;k=Math.max(0,k-1);let T=k;for(;T<m.length&&m[T]<c+1;)T++;T=Math.min(m.length-1,T);const z=m[k],L=m[T];return d.kind==="composite"?{kind:"composite",minZoom:z,maxZoom:L,interpolationType:_}:{kind:"camera",minZoom:z,maxZoom:L,minSize:d.evaluate(new nn(z)),maxSize:d.evaluate(new nn(L)),interpolationType:_}}}function cb(c,l,d){let m="never";const _=c.get(l);return _?m=_:c.get(d)&&(m="always"),m}const Y4=_l.VectorTileFeature.types,J4=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Kg(c,l,d,m,_,k,T,z,L,F,q,Q,ae){const ue=z?Math.min(Sl,Math.round(z[0])):0,me=z?Math.min(Sl,Math.round(z[1])):0;c.emplaceBack(l,d,Math.round(32*m),Math.round(32*_),k,T,(ue<<1)+(L?1:0),me,16*F,16*q,256*Q,256*ae)}function db(c,l,d){c.emplaceBack(l.x,l.y,d),c.emplaceBack(l.x,l.y,d),c.emplaceBack(l.x,l.y,d),c.emplaceBack(l.x,l.y,d)}function Q4(c){for(const l of c.sections)if(Ox(l.text))return!0;return!1}class hb{constructor(l){this.layoutVertexArray=new hd,this.indexArray=new Ni,this.programConfigurations=l,this.segments=new Ar,this.dynamicLayoutVertexArray=new Df,this.opacityVertexArray=new hi,this.hasVisibleVertices=!1,this.placedSymbolArray=new an}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(l,d,m,_){this.isEmpty()||(m&&(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,I4.members),this.indexBuffer=l.createIndexBuffer(this.indexArray,d),this.dynamicLayoutVertexBuffer=l.createVertexBuffer(this.dynamicLayoutVertexArray,A4.members,!0),this.opacityVertexBuffer=l.createVertexBuffer(this.opacityVertexArray,J4,!0),this.opacityVertexBuffer.itemSize=1),(m||_)&&this.programConfigurations.upload(l))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Wt("SymbolBuffers",hb);class fb{constructor(l,d,m){this.layoutVertexArray=new l,this.layoutAttributes=d,this.indexArray=new m,this.segments=new Ar,this.collisionVertexArray=new $s}upload(l){this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=l.createVertexBuffer(this.collisionVertexArray,N4.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Wt("CollisionBuffers",fb);class Ed{constructor(l){this.collisionBoxArray=l.collisionBoxArray,this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(T=>T.id),this.index=l.index,this.pixelRatio=l.pixelRatio,this.sourceLayerIndex=l.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Gx([]),this.placementViewportMatrix=Gx([]);const d=this.layers[0]._unevaluatedLayout._values;this.textSizeData=kC(this.zoom,d["text-size"]),this.iconSizeData=kC(this.zoom,d["icon-size"]);const m=this.layers[0].layout,_=m.get("symbol-sort-key"),k=m.get("symbol-z-order");this.canOverlap=cb(m,"text-overlap","text-allow-overlap")!=="never"||cb(m,"icon-overlap","icon-allow-overlap")!=="never"||m.get("text-ignore-placement")||m.get("icon-ignore-placement"),this.sortFeaturesByKey=k!=="viewport-y"&&!_.isConstant(),this.sortFeaturesByY=(k==="viewport-y"||k==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,m.get("symbol-placement")==="point"&&(this.writingModes=m.get("text-writing-mode").map(T=>u.ah[T])),this.stateDependentLayerIds=this.layers.filter(T=>T.isStateDependent()).map(T=>T.id),this.sourceID=l.sourceID}createArrays(){this.text=new hb(new Fu(this.layers,this.zoom,l=>/^text/.test(l))),this.icon=new hb(new Fu(this.layers,this.zoom,l=>/^icon/.test(l))),this.glyphOffsetArray=new sn,this.lineVertexArray=new sa,this.symbolInstances=new Pr,this.textAnchorOffsets=new on}calculateGlyphDependencies(l,d,m,_,k){for(let T=0;T<l.length;T++)if(d[l.charCodeAt(T)]=!0,(m||_)&&k){const z=Uf[l.charAt(T)];z&&(d[z.charCodeAt(0)]=!0)}}populate(l,d,m){const _=this.layers[0],k=_.layout,T=k.get("text-font"),z=k.get("text-field"),L=k.get("icon-image"),F=(z.value.kind!=="constant"||z.value.value instanceof lt&&!z.value.value.isEmpty()||z.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),q=L.value.kind!=="constant"||!!L.value.value||Object.keys(L.parameters).length>0,Q=k.get("symbol-sort-key");if(this.features=[],!F&&!q)return;const ae=d.iconDependencies,ue=d.glyphDependencies,me=d.availableImages,ve=new nn(this.zoom);for(const{feature:Ce,id:Ie,index:Je,sourceLayerIndex:je}of l){const Ze=_._featureFilter.needGeometry,ct=Vu(Ce,Ze);if(!_._featureFilter.filter(ve,ct,m))continue;let _t,$t;if(Ze||(ct.geometry=$u(Ce)),F){const Lt=_.getValueAndResolveTokens("text-field",ct,m,me),zt=lt.factory(Lt),er=this.hasRTLText=this.hasRTLText||Q4(zt);(!er||Ka.getRTLTextPluginStatus()==="unavailable"||er&&Ka.isParsed())&&(_t=D4(zt,_,ct))}if(q){const Lt=_.getValueAndResolveTokens("icon-image",ct,m,me);$t=Lt instanceof vn?Lt:vn.fromString(Lt)}if(!_t&&!$t)continue;const lr=this.sortFeaturesByKey?Q.evaluate(ct,{},m):void 0;if(this.features.push({id:Ie,text:_t,icon:$t,index:Je,sourceLayerIndex:je,geometry:ct.geometry,properties:Ce.properties,type:Y4[Ce.type],sortKey:lr}),$t&&(ae[$t.name]=!0),_t){const Lt=T.evaluate(ct,{},m).join(","),zt=k.get("text-rotation-alignment")!=="viewport"&&k.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(u.ah.vertical)>=0;for(const er of _t.sections)if(er.image)ae[er.image.name]=!0;else{const Zt=Pf(_t.toString()),Gt=er.fontStack||Lt,pt=ue[Gt]=ue[Gt]||{};this.calculateGlyphDependencies(er.text,pt,zt,this.allowVerticalPlacement,Zt)}}}k.get("symbol-placement")==="line"&&(this.features=function(Ce){const Ie={},Je={},je=[];let Ze=0;function ct(Lt){je.push(Ce[Lt]),Ze++}function _t(Lt,zt,er){const Zt=Je[Lt];return delete Je[Lt],Je[zt]=Zt,je[Zt].geometry[0].pop(),je[Zt].geometry[0]=je[Zt].geometry[0].concat(er[0]),Zt}function $t(Lt,zt,er){const Zt=Ie[zt];return delete Ie[zt],Ie[Lt]=Zt,je[Zt].geometry[0].shift(),je[Zt].geometry[0]=er[0].concat(je[Zt].geometry[0]),Zt}function lr(Lt,zt,er){const Zt=er?zt[0][zt[0].length-1]:zt[0][0];return`${Lt}:${Zt.x}:${Zt.y}`}for(let Lt=0;Lt<Ce.length;Lt++){const zt=Ce[Lt],er=zt.geometry,Zt=zt.text?zt.text.toString():null;if(!Zt){ct(Lt);continue}const Gt=lr(Zt,er),pt=lr(Zt,er,!0);if(Gt in Je&&pt in Ie&&Je[Gt]!==Ie[pt]){const tr=$t(Gt,pt,er),Qt=_t(Gt,pt,je[tr].geometry);delete Ie[Gt],delete Je[pt],Je[lr(Zt,je[Qt].geometry,!0)]=Qt,je[tr].geometry=null}else Gt in Je?_t(Gt,pt,er):pt in Ie?$t(Gt,pt,er):(ct(Lt),Ie[Gt]=Ze-1,Je[pt]=Ze-1)}return je.filter(Lt=>Lt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Ce,Ie)=>Ce.sortKey-Ie.sortKey)}update(l,d,m){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(l,d,this.layers,m),this.icon.programConfigurations.updatePaintArrays(l,d,this.layers,m))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(l){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(l),this.iconCollisionBox.upload(l)),this.text.upload(l,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(l,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(l,d){const m=this.lineVertexArray.length;if(l.segment!==void 0){let _=l.dist(d[l.segment+1]),k=l.dist(d[l.segment]);const T={};for(let z=l.segment+1;z<d.length;z++)T[z]={x:d[z].x,y:d[z].y,tileUnitDistanceFromAnchor:_},z<d.length-1&&(_+=d[z+1].dist(d[z]));for(let z=l.segment||0;z>=0;z--)T[z]={x:d[z].x,y:d[z].y,tileUnitDistanceFromAnchor:k},z>0&&(k+=d[z-1].dist(d[z]));for(let z=0;z<d.length;z++){const L=T[z];this.lineVertexArray.emplaceBack(L.x,L.y,L.tileUnitDistanceFromAnchor)}}return{lineStartIndex:m,lineLength:this.lineVertexArray.length-m}}addSymbols(l,d,m,_,k,T,z,L,F,q,Q,ae){const ue=l.indexArray,me=l.layoutVertexArray,ve=l.segments.prepareSegment(4*d.length,me,ue,this.canOverlap?T.sortKey:void 0),Ce=this.glyphOffsetArray.length,Ie=ve.vertexLength,Je=this.allowVerticalPlacement&&z===u.ah.vertical?Math.PI/2:0,je=T.text&&T.text.sections;for(let Ze=0;Ze<d.length;Ze++){const{tl:ct,tr:_t,bl:$t,br:lr,tex:Lt,pixelOffsetTL:zt,pixelOffsetBR:er,minFontScaleX:Zt,minFontScaleY:Gt,glyphOffset:pt,isSDF:tr,sectionIndex:Qt}=d[Ze],gr=ve.vertexLength,Kr=pt[1];Kg(me,L.x,L.y,ct.x,Kr+ct.y,Lt.x,Lt.y,m,tr,zt.x,zt.y,Zt,Gt),Kg(me,L.x,L.y,_t.x,Kr+_t.y,Lt.x+Lt.w,Lt.y,m,tr,er.x,zt.y,Zt,Gt),Kg(me,L.x,L.y,$t.x,Kr+$t.y,Lt.x,Lt.y+Lt.h,m,tr,zt.x,er.y,Zt,Gt),Kg(me,L.x,L.y,lr.x,Kr+lr.y,Lt.x+Lt.w,Lt.y+Lt.h,m,tr,er.x,er.y,Zt,Gt),db(l.dynamicLayoutVertexArray,L,Je),ue.emplaceBack(gr,gr+1,gr+2),ue.emplaceBack(gr+1,gr+2,gr+3),ve.vertexLength+=4,ve.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(pt[0]),Ze!==d.length-1&&Qt===d[Ze+1].sectionIndex||l.programConfigurations.populatePaintArrays(me.length,T,T.index,{},ae,je&&je[Qt])}l.placedSymbolArray.emplaceBack(L.x,L.y,Ce,this.glyphOffsetArray.length-Ce,Ie,F,q,L.segment,m?m[0]:0,m?m[1]:0,_[0],_[1],z,0,!1,0,Q)}_addCollisionDebugVertex(l,d,m,_,k,T){return d.emplaceBack(0,0),l.emplaceBack(m.x,m.y,_,k,Math.round(T.x),Math.round(T.y))}addCollisionDebugVertices(l,d,m,_,k,T,z){const L=k.segments.prepareSegment(4,k.layoutVertexArray,k.indexArray),F=L.vertexLength,q=k.layoutVertexArray,Q=k.collisionVertexArray,ae=z.anchorX,ue=z.anchorY;this._addCollisionDebugVertex(q,Q,T,ae,ue,new v(l,d)),this._addCollisionDebugVertex(q,Q,T,ae,ue,new v(m,d)),this._addCollisionDebugVertex(q,Q,T,ae,ue,new v(m,_)),this._addCollisionDebugVertex(q,Q,T,ae,ue,new v(l,_)),L.vertexLength+=4;const me=k.indexArray;me.emplaceBack(F,F+1),me.emplaceBack(F+1,F+2),me.emplaceBack(F+2,F+3),me.emplaceBack(F+3,F),L.primitiveLength+=4}addDebugCollisionBoxes(l,d,m,_){for(let k=l;k<d;k++){const T=this.collisionBoxArray.get(k);this.addCollisionDebugVertices(T.x1,T.y1,T.x2,T.y2,_?this.textCollisionBox:this.iconCollisionBox,T.anchorPoint,m)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new fb(fi,uC.members,Xn),this.iconCollisionBox=new fb(fi,uC.members,Xn);for(let l=0;l<this.symbolInstances.length;l++){const d=this.symbolInstances.get(l);this.addDebugCollisionBoxes(d.textBoxStartIndex,d.textBoxEndIndex,d,!0),this.addDebugCollisionBoxes(d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d,!0),this.addDebugCollisionBoxes(d.iconBoxStartIndex,d.iconBoxEndIndex,d,!1),this.addDebugCollisionBoxes(d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex,d,!1)}}_deserializeCollisionBoxesForSymbol(l,d,m,_,k,T,z,L,F){const q={};for(let Q=d;Q<m;Q++){const ae=l.get(Q);q.textBox={x1:ae.x1,y1:ae.y1,x2:ae.x2,y2:ae.y2,anchorPointX:ae.anchorPointX,anchorPointY:ae.anchorPointY},q.textFeatureIndex=ae.featureIndex;break}for(let Q=_;Q<k;Q++){const ae=l.get(Q);q.verticalTextBox={x1:ae.x1,y1:ae.y1,x2:ae.x2,y2:ae.y2,anchorPointX:ae.anchorPointX,anchorPointY:ae.anchorPointY},q.verticalTextFeatureIndex=ae.featureIndex;break}for(let Q=T;Q<z;Q++){const ae=l.get(Q);q.iconBox={x1:ae.x1,y1:ae.y1,x2:ae.x2,y2:ae.y2,anchorPointX:ae.anchorPointX,anchorPointY:ae.anchorPointY},q.iconFeatureIndex=ae.featureIndex;break}for(let Q=L;Q<F;Q++){const ae=l.get(Q);q.verticalIconBox={x1:ae.x1,y1:ae.y1,x2:ae.x2,y2:ae.y2,anchorPointX:ae.anchorPointX,anchorPointY:ae.anchorPointY},q.verticalIconFeatureIndex=ae.featureIndex;break}return q}deserializeCollisionBoxes(l){this.collisionArrays=[];for(let d=0;d<this.symbolInstances.length;d++){const m=this.symbolInstances.get(d);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(l,m.textBoxStartIndex,m.textBoxEndIndex,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m.iconBoxStartIndex,m.iconBoxEndIndex,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(l,d){const m=l.placedSymbolArray.get(d),_=m.vertexStartIndex+4*m.numGlyphs;for(let k=m.vertexStartIndex;k<_;k+=4)l.indexArray.emplaceBack(k,k+1,k+2),l.indexArray.emplaceBack(k+1,k+2,k+3)}getSortedSymbolIndexes(l){if(this.sortedAngle===l&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const d=Math.sin(l),m=Math.cos(l),_=[],k=[],T=[];for(let z=0;z<this.symbolInstances.length;++z){T.push(z);const L=this.symbolInstances.get(z);_.push(0|Math.round(d*L.anchorX+m*L.anchorY)),k.push(L.featureIndex)}return T.sort((z,L)=>_[z]-_[L]||k[L]-k[z]),T}addToSortKeyRanges(l,d){const m=this.sortKeyRanges[this.sortKeyRanges.length-1];m&&m.sortKey===d?m.symbolInstanceEnd=l+1:this.sortKeyRanges.push({sortKey:d,symbolInstanceStart:l,symbolInstanceEnd:l+1})}sortFeatures(l){if(this.sortFeaturesByY&&this.sortedAngle!==l&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(l),this.sortedAngle=l,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const d of this.symbolInstanceIndexes){const m=this.symbolInstances.get(d);this.featureSortOrder.push(m.featureIndex),[m.rightJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.leftJustifiedTextSymbolIndex].forEach((_,k,T)=>{_>=0&&T.indexOf(_)===k&&this.addIndicesForPlacedSymbol(this.text,_)}),m.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,m.verticalPlacedTextSymbolIndex),m.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.placedIconSymbolIndex),m.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let TC,PC;Wt("SymbolBucket",Ed,{omit:["layers","collisionBoxArray","features","compareText"]}),Ed.MAX_GLYPHS=65535,Ed.addDynamicAttributes=db;var pb={get paint(){return PC=PC||new C({"icon-opacity":new ur($e.paint_symbol["icon-opacity"]),"icon-color":new ur($e.paint_symbol["icon-color"]),"icon-halo-color":new ur($e.paint_symbol["icon-halo-color"]),"icon-halo-width":new ur($e.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ur($e.paint_symbol["icon-halo-blur"]),"icon-translate":new Yt($e.paint_symbol["icon-translate"]),"icon-translate-anchor":new Yt($e.paint_symbol["icon-translate-anchor"]),"text-opacity":new ur($e.paint_symbol["text-opacity"]),"text-color":new ur($e.paint_symbol["text-color"],{runtimeType:st,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new ur($e.paint_symbol["text-halo-color"]),"text-halo-width":new ur($e.paint_symbol["text-halo-width"]),"text-halo-blur":new ur($e.paint_symbol["text-halo-blur"]),"text-translate":new Yt($e.paint_symbol["text-translate"]),"text-translate-anchor":new Yt($e.paint_symbol["text-translate-anchor"])})},get layout(){return TC=TC||new C({"symbol-placement":new Yt($e.layout_symbol["symbol-placement"]),"symbol-spacing":new Yt($e.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Yt($e.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ur($e.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Yt($e.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Yt($e.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Yt($e.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Yt($e.layout_symbol["icon-ignore-placement"]),"icon-optional":new Yt($e.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Yt($e.layout_symbol["icon-rotation-alignment"]),"icon-size":new ur($e.layout_symbol["icon-size"]),"icon-text-fit":new Yt($e.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Yt($e.layout_symbol["icon-text-fit-padding"]),"icon-image":new ur($e.layout_symbol["icon-image"]),"icon-rotate":new ur($e.layout_symbol["icon-rotate"]),"icon-padding":new ur($e.layout_symbol["icon-padding"]),"icon-keep-upright":new Yt($e.layout_symbol["icon-keep-upright"]),"icon-offset":new ur($e.layout_symbol["icon-offset"]),"icon-anchor":new ur($e.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Yt($e.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Yt($e.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Yt($e.layout_symbol["text-rotation-alignment"]),"text-field":new ur($e.layout_symbol["text-field"]),"text-font":new ur($e.layout_symbol["text-font"]),"text-size":new ur($e.layout_symbol["text-size"]),"text-max-width":new ur($e.layout_symbol["text-max-width"]),"text-line-height":new Yt($e.layout_symbol["text-line-height"]),"text-letter-spacing":new ur($e.layout_symbol["text-letter-spacing"]),"text-justify":new ur($e.layout_symbol["text-justify"]),"text-radial-offset":new ur($e.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Yt($e.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new ur($e.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new ur($e.layout_symbol["text-anchor"]),"text-max-angle":new Yt($e.layout_symbol["text-max-angle"]),"text-writing-mode":new Yt($e.layout_symbol["text-writing-mode"]),"text-rotate":new ur($e.layout_symbol["text-rotate"]),"text-padding":new Yt($e.layout_symbol["text-padding"]),"text-keep-upright":new Yt($e.layout_symbol["text-keep-upright"]),"text-transform":new ur($e.layout_symbol["text-transform"]),"text-offset":new ur($e.layout_symbol["text-offset"]),"text-allow-overlap":new Yt($e.layout_symbol["text-allow-overlap"]),"text-overlap":new Yt($e.layout_symbol["text-overlap"]),"text-ignore-placement":new Yt($e.layout_symbol["text-ignore-placement"]),"text-optional":new Yt($e.layout_symbol["text-optional"])})}};class IC{constructor(l){if(l.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=l.property.overrides?l.property.overrides.runtimeType:dt,this.defaultValue=l}evaluate(l){if(l.formattedSection){const d=this.defaultValue.property.overrides;if(d&&d.hasOverride(l.formattedSection))return d.getOverride(l.formattedSection)}return l.feature&&l.featureState?this.defaultValue.evaluate(l.feature,l.featureState):this.defaultValue.property.specification.default}eachChild(l){this.defaultValue.isConstant()||l(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Wt("FormatSectionOverride",IC,{omit:["defaultValue"]});class Yg extends f{constructor(l){super(l,pb)}recalculate(l,d){if(super.recalculate(l,d),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const m=this.layout.get("text-writing-mode");if(m){const _=[];for(const k of m)_.indexOf(k)<0&&_.push(k);this.layout._values["text-writing-mode"]=_}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(l,d,m,_){const k=this.layout.get(l).evaluate(d,{},m,_),T=this._unevaluatedLayout._values[l];return T.isDataDriven()||Yc(T.value)||!k?k:function(z,L){return L.replace(/{([^{}]+)}/g,(F,q)=>z&&q in z?String(z[q]):"")}(d.properties,k)}createBucket(l){return new Ed(l)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const l of pb.paint.overridableProperties){if(!Yg.hasPaintOverride(this.layout,l))continue;const d=this.paint.get(l),m=new IC(d),_=new Kc(m,d.property.specification);let k=null;k=d.value.kind==="constant"||d.value.kind==="source"?new sl("source",_):new ol("composite",_,d.value.zoomStops),this.paint._values[l]=new Ki(d.property,k,d.parameters)}}_handleOverridablePaintPropertyUpdate(l,d,m){return!(!this.layout||d.isDataDriven()||m.isDataDriven())&&Yg.hasPaintOverride(this.layout,l)}static hasPaintOverride(l,d){const m=l.get("text-field"),_=pb.paint.properties[d];let k=!1;const T=z=>{for(const L of z)if(_.overrides&&_.overrides.hasOverride(L))return void(k=!0)};if(m.value.kind==="constant"&&m.value.value instanceof lt)T(m.value.value.sections);else if(m.value.kind==="source"){const z=F=>{k||(F instanceof Na&&jr(F.value)===Ut?T(F.value.sections):F instanceof $c?T(F.sections):F.eachChild(z))},L=m.value;L._styleExpression&&z(L._styleExpression.expression)}return k}}let AC;var e3={get paint(){return AC=AC||new C({"background-color":new Yt($e.paint_background["background-color"]),"background-pattern":new cd($e.paint_background["background-pattern"]),"background-opacity":new Yt($e.paint_background["background-opacity"])})}};class t3 extends f{constructor(l){super(l,e3)}}let NC;var r3={get paint(){return NC=NC||new C({"raster-opacity":new Yt($e.paint_raster["raster-opacity"]),"raster-hue-rotate":new Yt($e.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Yt($e.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Yt($e.paint_raster["raster-brightness-max"]),"raster-saturation":new Yt($e.paint_raster["raster-saturation"]),"raster-contrast":new Yt($e.paint_raster["raster-contrast"]),"raster-resampling":new Yt($e.paint_raster["raster-resampling"]),"raster-fade-duration":new Yt($e.paint_raster["raster-fade-duration"])})}};class n3 extends f{constructor(l){super(l,r3)}}class a3 extends f{constructor(l){super(l,{}),this.onAdd=d=>{this.implementation.onAdd&&this.implementation.onAdd(d,d.painter.context.gl)},this.onRemove=d=>{this.implementation.onRemove&&this.implementation.onRemove(d,d.painter.context.gl)},this.implementation=l}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class i3{constructor(l){this._methodToThrottle=l,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const mb=63710088e-1;class El{constructor(l,d){if(isNaN(l)||isNaN(d))throw new Error(`Invalid LngLat object: (${l}, ${d})`);if(this.lng=+l,this.lat=+d,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new El(U(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(l){const d=Math.PI/180,m=this.lat*d,_=l.lat*d,k=Math.sin(m)*Math.sin(_)+Math.cos(m)*Math.cos(_)*Math.cos((l.lng-this.lng)*d);return mb*Math.acos(Math.min(k,1))}static convert(l){if(l instanceof El)return l;if(Array.isArray(l)&&(l.length===2||l.length===3))return new El(Number(l[0]),Number(l[1]));if(!Array.isArray(l)&&typeof l=="object"&&l!==null)return new El(Number("lng"in l?l.lng:l.lon),Number(l.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const MC=2*Math.PI*mb;function DC(c){return MC*Math.cos(c*Math.PI/180)}function zC(c){return(180+c)/360}function RC(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function LC(c,l){return c/DC(l)}function gb(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}class Wf{constructor(l,d,m=0){this.x=+l,this.y=+d,this.z=+m}static fromLngLat(l,d=0){const m=El.convert(l);return new Wf(zC(m.lng),RC(m.lat),LC(d,m.lat))}toLngLat(){return new El(360*this.x-180,gb(this.y))}toAltitude(){return this.z*DC(gb(this.y))}meterInMercatorCoordinateUnits(){return 1/MC*(l=gb(this.y),1/Math.cos(l*Math.PI/180));var l}}function BC(c,l,d){var m=2*Math.PI*6378137/256/Math.pow(2,d);return[c*m-2*Math.PI*6378137/2,l*m-2*Math.PI*6378137/2]}class vb{constructor(l,d,m){if(!function(_,k,T){return!(_<0||_>25||T<0||T>=Math.pow(2,_)||k<0||k>=Math.pow(2,_))}(l,d,m))throw new Error(`x=${d}, y=${m}, z=${l} outside of bounds. 0<=x<${Math.pow(2,l)}, 0<=y<${Math.pow(2,l)} 0<=z<=25 `);this.z=l,this.x=d,this.y=m,this.key=Zf(0,l,l,d,m)}equals(l){return this.z===l.z&&this.x===l.x&&this.y===l.y}url(l,d,m){const _=(T=this.y,z=this.z,L=BC(256*(k=this.x),256*(T=Math.pow(2,z)-T-1),z),F=BC(256*(k+1),256*(T+1),z),L[0]+","+L[1]+","+F[0]+","+F[1]);var k,T,z,L,F;const q=function(Q,ae,ue){let me,ve="";for(let Ce=Q;Ce>0;Ce--)me=1<<Ce-1,ve+=(ae&me?1:0)+(ue&me?2:0);return ve}(this.z,this.x,this.y);return l[(this.x+this.y)%l.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(m==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,d>1?"@2x":"").replace(/{quadkey}/g,q).replace(/{bbox-epsg-3857}/g,_)}isChildOf(l){const d=this.z-l.z;return d>0&&l.x===this.x>>d&&l.y===this.y>>d}getTilePoint(l){const d=Math.pow(2,this.z);return new v((l.x*d-this.x)*Dn,(l.y*d-this.y)*Dn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class jC{constructor(l,d){this.wrap=l,this.canonical=d,this.key=Zf(l,d.z,d.z,d.x,d.y)}}class Di{constructor(l,d,m,_,k){if(l<m)throw new Error(`overscaledZ should be >= z; overscaledZ = ${l}; z = ${m}`);this.overscaledZ=l,this.wrap=d,this.canonical=new vb(m,+_,+k),this.key=Zf(d,l,m,_,k)}clone(){return new Di(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(l){return this.overscaledZ===l.overscaledZ&&this.wrap===l.wrap&&this.canonical.equals(l.canonical)}scaledTo(l){if(l>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${l}; overscaledZ = ${this.overscaledZ}`);const d=this.canonical.z-l;return l>this.canonical.z?new Di(l,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Di(l,this.wrap,l,this.canonical.x>>d,this.canonical.y>>d)}calculateScaledKey(l,d){if(l>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${l}; overscaledZ = ${this.overscaledZ}`);const m=this.canonical.z-l;return l>this.canonical.z?Zf(this.wrap*+d,l,this.canonical.z,this.canonical.x,this.canonical.y):Zf(this.wrap*+d,l,l,this.canonical.x>>m,this.canonical.y>>m)}isChildOf(l){if(l.wrap!==this.wrap)return!1;const d=this.canonical.z-l.canonical.z;return l.overscaledZ===0||l.overscaledZ<this.overscaledZ&&l.canonical.x===this.canonical.x>>d&&l.canonical.y===this.canonical.y>>d}children(l){if(this.overscaledZ>=l)return[new Di(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const d=this.canonical.z+1,m=2*this.canonical.x,_=2*this.canonical.y;return[new Di(d,this.wrap,d,m,_),new Di(d,this.wrap,d,m+1,_),new Di(d,this.wrap,d,m,_+1),new Di(d,this.wrap,d,m+1,_+1)]}isLessThan(l){return this.wrap<l.wrap||!(this.wrap>l.wrap)&&(this.overscaledZ<l.overscaledZ||!(this.overscaledZ>l.overscaledZ)&&(this.canonical.x<l.canonical.x||!(this.canonical.x>l.canonical.x)&&this.canonical.y<l.canonical.y))}wrapped(){return new Di(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(l){return new Di(this.overscaledZ,l,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new jC(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(l){return this.canonical.getTilePoint(new Wf(l.x-this.wrap,l.y))}}function Zf(c,l,d,m,_){(c*=2)<0&&(c=-1*c-1);const k=1<<d;return(k*k*c+k*_+m).toString(36)+d.toString(36)+l.toString(36)}Wt("CanonicalTileID",vb),Wt("OverscaledTileID",Di,{omit:["posMatrix"]});class OC{constructor(l,d,m,_=1,k=1,T=1,z=0){if(this.uid=l,d.height!==d.width)throw new RangeError("DEM tiles must be square");if(m&&!["mapbox","terrarium","custom"].includes(m))return void Y(`"${m}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=d.height;const L=this.dim=d.height-2;switch(this.data=new Uint32Array(d.data.buffer),m){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=_,this.greenFactor=k,this.blueFactor=T,this.baseShift=z;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let F=0;F<L;F++)this.data[this._idx(-1,F)]=this.data[this._idx(0,F)],this.data[this._idx(L,F)]=this.data[this._idx(L-1,F)],this.data[this._idx(F,-1)]=this.data[this._idx(F,0)],this.data[this._idx(F,L)]=this.data[this._idx(F,L-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(L,-1)]=this.data[this._idx(L-1,0)],this.data[this._idx(-1,L)]=this.data[this._idx(0,L-1)],this.data[this._idx(L,L)]=this.data[this._idx(L-1,L-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let F=0;F<L;F++)for(let q=0;q<L;q++){const Q=this.get(F,q);Q>this.max&&(this.max=Q),Q<this.min&&(this.min=Q)}}get(l,d){const m=new Uint8Array(this.data.buffer),_=4*this._idx(l,d);return this.unpack(m[_],m[_+1],m[_+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(l,d){if(l<-1||l>=this.dim+1||d<-1||d>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(d+1)*this.stride+(l+1)}unpack(l,d,m){return l*this.redFactor+d*this.greenFactor+m*this.blueFactor-this.baseShift}getPixels(){return new Mi({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(l,d,m){if(this.dim!==l.dim)throw new Error("dem dimension mismatch");let _=d*this.dim,k=d*this.dim+this.dim,T=m*this.dim,z=m*this.dim+this.dim;switch(d){case-1:_=k-1;break;case 1:k=_+1}switch(m){case-1:T=z-1;break;case 1:z=T+1}const L=-d*this.dim,F=-m*this.dim;for(let q=T;q<z;q++)for(let Q=_;Q<k;Q++)this.data[this._idx(Q,q)]=l.data[this._idx(Q+L,q+F)]}}Wt("DEMData",OC);class FC{constructor(l){this._stringToNumber={},this._numberToString=[];for(let d=0;d<l.length;d++){const m=l[d];this._stringToNumber[m]=d,this._numberToString[d]=m}}encode(l){return this._stringToNumber[l]}decode(l){if(l>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${l} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[l]}}class $C{constructor(l,d,m,_,k){this.type="Feature",this._vectorTileFeature=l,l._z=d,l._x=m,l._y=_,this.properties=l.properties,this.id=k}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(l){this._geometry=l}toJSON(){const l={geometry:this.geometry};for(const d in this)d!=="_geometry"&&d!=="_vectorTileFeature"&&(l[d]=this[d]);return l}}class VC{constructor(l,d){this.tileID=l,this.x=l.canonical.x,this.y=l.canonical.y,this.z=l.canonical.z,this.grid=new cl(Dn,16,0),this.grid3D=new cl(Dn,16,0),this.featureIndexArray=new xa,this.promoteId=d}insert(l,d,m,_,k,T){const z=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(m,_,k);const L=T?this.grid3D:this.grid;for(let F=0;F<d.length;F++){const q=d[F],Q=[1/0,1/0,-1/0,-1/0];for(let ae=0;ae<q.length;ae++){const ue=q[ae];Q[0]=Math.min(Q[0],ue.x),Q[1]=Math.min(Q[1],ue.y),Q[2]=Math.max(Q[2],ue.x),Q[3]=Math.max(Q[3],ue.y)}Q[0]<Dn&&Q[1]<Dn&&Q[2]>=0&&Q[3]>=0&&L.insert(z,Q[0],Q[1],Q[2],Q[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new _l.VectorTile(new ib(this.rawTileData)).layers,this.sourceLayerCoder=new FC(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(l,d,m,_){this.loadVTLayers();const k=l.params||{},T=Dn/l.tileSize/l.scale,z=ff(k.filter),L=l.queryGeometry,F=l.queryPadding*T,q=qC(L),Q=this.grid.query(q.minX-F,q.minY-F,q.maxX+F,q.maxY+F),ae=qC(l.cameraQueryGeometry),ue=this.grid3D.query(ae.minX-F,ae.minY-F,ae.maxX+F,ae.maxY+F,(Ce,Ie,Je,je)=>function(Ze,ct,_t,$t,lr){for(const zt of Ze)if(ct<=zt.x&&_t<=zt.y&&$t>=zt.x&&lr>=zt.y)return!0;const Lt=[new v(ct,_t),new v(ct,lr),new v($t,lr),new v($t,_t)];if(Ze.length>2){for(const zt of Lt)if(vd(Ze,zt))return!0}for(let zt=0;zt<Ze.length-1;zt++)if(OB(Ze[zt],Ze[zt+1],Lt))return!0;return!1}(l.cameraQueryGeometry,Ce-F,Ie-F,Je+F,je+F));for(const Ce of ue)Q.push(Ce);Q.sort(s3);const me={};let ve;for(let Ce=0;Ce<Q.length;Ce++){const Ie=Q[Ce];if(Ie===ve)continue;ve=Ie;const Je=this.featureIndexArray.get(Ie);let je=null;this.loadMatchingFeature(me,Je.bucketIndex,Je.sourceLayerIndex,Je.featureIndex,z,k.layers,k.availableImages,d,m,_,(Ze,ct,_t)=>(je||(je=$u(Ze)),ct.queryIntersectsFeature(L,Ze,_t,je,this.z,l.transform,T,l.pixelPosMatrix)))}return me}loadMatchingFeature(l,d,m,_,k,T,z,L,F,q,Q){const ae=this.bucketLayerIDs[d];if(T&&!function(Ce,Ie){for(let Je=0;Je<Ce.length;Je++)if(Ie.indexOf(Ce[Je])>=0)return!0;return!1}(T,ae))return;const ue=this.sourceLayerCoder.decode(m),me=this.vtLayers[ue].feature(_);if(k.needGeometry){const Ce=Vu(me,!0);if(!k.filter(new nn(this.tileID.overscaledZ),Ce,this.tileID.canonical))return}else if(!k.filter(new nn(this.tileID.overscaledZ),me))return;const ve=this.getId(me,ue);for(let Ce=0;Ce<ae.length;Ce++){const Ie=ae[Ce];if(T&&T.indexOf(Ie)<0)continue;const Je=L[Ie];if(!Je)continue;let je={};ve&&q&&(je=q.getState(Je.sourceLayer||"_geojsonTileLayer",ve));const Ze=$({},F[Ie]);Ze.paint=UC(Ze.paint,Je.paint,me,je,z),Ze.layout=UC(Ze.layout,Je.layout,me,je,z);const ct=!Q||Q(me,Je,je);if(!ct)continue;const _t=new $C(me,this.z,this.x,this.y,ve);_t.layer=Ze;let $t=l[Ie];$t===void 0&&($t=l[Ie]=[]),$t.push({featureIndex:_,feature:_t,intersectionZ:ct})}}lookupSymbolFeatures(l,d,m,_,k,T,z,L){const F={};this.loadVTLayers();const q=ff(k);for(const Q of l)this.loadMatchingFeature(F,m,_,Q,q,T,z,L,d);return F}hasLayer(l){for(const d of this.bucketLayerIDs)for(const m of d)if(l===m)return!0;return!1}getId(l,d){let m=l.id;return this.promoteId&&(m=l.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[d]],typeof m=="boolean"&&(m=Number(m))),m}}function UC(c,l,d,m,_){return X(c,(k,T)=>{const z=l instanceof Bu?l.get(T):null;return z&&z.evaluate?z.evaluate(d,m,_):z})}function qC(c){let l=1/0,d=1/0,m=-1/0,_=-1/0;for(const k of c)l=Math.min(l,k.x),d=Math.min(d,k.y),m=Math.max(m,k.x),_=Math.max(_,k.y);return{minX:l,minY:d,maxX:m,maxY:_}}function s3(c,l){return l-c}function HC(c,l,d,m,_){const k=[];for(let T=0;T<c.length;T++){const z=c[T];let L;for(let F=0;F<z.length-1;F++){let q=z[F],Q=z[F+1];q.x<l&&Q.x<l||(q.x<l?q=new v(l,q.y+(l-q.x)/(Q.x-q.x)*(Q.y-q.y))._round():Q.x<l&&(Q=new v(l,q.y+(l-q.x)/(Q.x-q.x)*(Q.y-q.y))._round()),q.y<d&&Q.y<d||(q.y<d?q=new v(q.x+(d-q.y)/(Q.y-q.y)*(Q.x-q.x),d)._round():Q.y<d&&(Q=new v(q.x+(d-q.y)/(Q.y-q.y)*(Q.x-q.x),d)._round()),q.x>=m&&Q.x>=m||(q.x>=m?q=new v(m,q.y+(m-q.x)/(Q.x-q.x)*(Q.y-q.y))._round():Q.x>=m&&(Q=new v(m,q.y+(m-q.x)/(Q.x-q.x)*(Q.y-q.y))._round()),q.y>=_&&Q.y>=_||(q.y>=_?q=new v(q.x+(_-q.y)/(Q.y-q.y)*(Q.x-q.x),_)._round():Q.y>=_&&(Q=new v(q.x+(_-q.y)/(Q.y-q.y)*(Q.x-q.x),_)._round()),L&&q.equals(L[L.length-1])||(L=[q],k.push(L)),L.push(Q)))))}}return k}Wt("FeatureIndex",VC,{omit:["rawTileData","sourceLayerCoder"]});class Cl extends v{constructor(l,d,m,_){super(l,d),this.angle=m,_!==void 0&&(this.segment=_)}clone(){return new Cl(this.x,this.y,this.angle,this.segment)}}function GC(c,l,d,m,_){if(l.segment===void 0||d===0)return!0;let k=l,T=l.segment+1,z=0;for(;z>-d/2;){if(T--,T<0)return!1;z-=c[T].dist(k),k=c[T]}z+=c[T].dist(c[T+1]),T++;const L=[];let F=0;for(;z<d/2;){const q=c[T],Q=c[T+1];if(!Q)return!1;let ae=c[T-1].angleTo(q)-q.angleTo(Q);for(ae=Math.abs((ae+3*Math.PI)%(2*Math.PI)-Math.PI),L.push({distance:z,angleDelta:ae}),F+=ae;z-L[0].distance>m;)F-=L.shift().angleDelta;if(F>_)return!1;T++,z+=q.dist(Q)}return!0}function WC(c){let l=0;for(let d=0;d<c.length-1;d++)l+=c[d].dist(c[d+1]);return l}function ZC(c,l,d){return c?.6*l*d:0}function XC(c,l){return Math.max(c?c.right-c.left:0,l?l.right-l.left:0)}function o3(c,l,d,m,_,k){const T=ZC(d,_,k),z=XC(d,m)*k;let L=0;const F=WC(c)/2;for(let q=0;q<c.length-1;q++){const Q=c[q],ae=c[q+1],ue=Q.dist(ae);if(L+ue>F){const me=(F-L)/ue,ve=Ma.number(Q.x,ae.x,me),Ce=Ma.number(Q.y,ae.y,me),Ie=new Cl(ve,Ce,ae.angleTo(Q),q);return Ie._round(),!T||GC(c,Ie,z,T,l)?Ie:void 0}L+=ue}}function l3(c,l,d,m,_,k,T,z,L){const F=ZC(m,k,T),q=XC(m,_),Q=q*T,ae=c[0].x===0||c[0].x===L||c[0].y===0||c[0].y===L;return l-Q<l/4&&(l=Q+l/4),KC(c,ae?l/2*z%l:(q/2+2*k)*T*z%l,l,F,d,Q,ae,!1,L)}function KC(c,l,d,m,_,k,T,z,L){const F=k/2,q=WC(c);let Q=0,ae=l-d,ue=[];for(let me=0;me<c.length-1;me++){const ve=c[me],Ce=c[me+1],Ie=ve.dist(Ce),Je=Ce.angleTo(ve);for(;ae+d<Q+Ie;){ae+=d;const je=(ae-Q)/Ie,Ze=Ma.number(ve.x,Ce.x,je),ct=Ma.number(ve.y,Ce.y,je);if(Ze>=0&&Ze<L&&ct>=0&&ct<L&&ae-F>=0&&ae+F<=q){const _t=new Cl(Ze,ct,Je,me);_t._round(),m&&!GC(c,_t,k,m,_)||ue.push(_t)}}Q+=Ie}return z||ue.length||T||(ue=KC(c,Q/2,d,m,_,k,T,!0,L)),ue}Wt("Anchor",Cl);const Cd=Ja;function YC(c,l,d,m){const _=[],k=c.image,T=k.pixelRatio,z=k.paddedRect.w-2*Cd,L=k.paddedRect.h-2*Cd;let F={x1:c.left,y1:c.top,x2:c.right,y2:c.bottom};const q=k.stretchX||[[0,z]],Q=k.stretchY||[[0,L]],ae=(pt,tr)=>pt+tr[1]-tr[0],ue=q.reduce(ae,0),me=Q.reduce(ae,0),ve=z-ue,Ce=L-me;let Ie=0,Je=ue,je=0,Ze=me,ct=0,_t=ve,$t=0,lr=Ce;if(k.content&&m){const pt=k.content,tr=pt[2]-pt[0],Qt=pt[3]-pt[1];(k.textFitWidth||k.textFitHeight)&&(F=EC(c)),Ie=Jg(q,0,pt[0]),je=Jg(Q,0,pt[1]),Je=Jg(q,pt[0],pt[2]),Ze=Jg(Q,pt[1],pt[3]),ct=pt[0]-Ie,$t=pt[1]-je,_t=tr-Je,lr=Qt-Ze}const Lt=F.x1,zt=F.y1,er=F.x2-Lt,Zt=F.y2-zt,Gt=(pt,tr,Qt,gr)=>{const Kr=Qg(pt.stretch-Ie,Je,er,Lt),Xr=ev(pt.fixed-ct,_t,pt.stretch,ue),$n=Qg(tr.stretch-je,Ze,Zt,zt),Ji=ev(tr.fixed-$t,lr,tr.stretch,me),ca=Qg(Qt.stretch-Ie,Je,er,Lt),Vn=ev(Qt.fixed-ct,_t,Qt.stretch,ue),La=Qg(gr.stretch-je,Ze,Zt,zt),Ba=ev(gr.fixed-$t,lr,gr.stretch,me),ja=new v(Kr,$n),Cn=new v(ca,$n),Un=new v(ca,La),_a=new v(Kr,La),da=new v(Xr/T,Ji/T),Oa=new v(Vn/T,Ba/T),ha=l*Math.PI/180;if(ha){const Lr=Math.sin(ha),tn=Math.cos(ha),ln=[tn,-Lr,Lr,tn];ja._matMult(ln),Cn._matMult(ln),_a._matMult(ln),Un._matMult(ln)}const zi=pt.stretch+pt.fixed,Qa=tr.stretch+tr.fixed;return{tl:ja,tr:Cn,bl:_a,br:Un,tex:{x:k.paddedRect.x+Cd+zi,y:k.paddedRect.y+Cd+Qa,w:Qt.stretch+Qt.fixed-zi,h:gr.stretch+gr.fixed-Qa},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:da,pixelOffsetBR:Oa,minFontScaleX:_t/T/er,minFontScaleY:lr/T/Zt,isSDF:d}};if(m&&(k.stretchX||k.stretchY)){const pt=JC(q,ve,ue),tr=JC(Q,Ce,me);for(let Qt=0;Qt<pt.length-1;Qt++){const gr=pt[Qt],Kr=pt[Qt+1];for(let Xr=0;Xr<tr.length-1;Xr++)_.push(Gt(gr,tr[Xr],Kr,tr[Xr+1]))}}else _.push(Gt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:z+1},{fixed:0,stretch:L+1}));return _}function Jg(c,l,d){let m=0;for(const _ of c)m+=Math.max(l,Math.min(d,_[1]))-Math.max(l,Math.min(d,_[0]));return m}function JC(c,l,d){const m=[{fixed:-Cd,stretch:0}];for(const[_,k]of c){const T=m[m.length-1];m.push({fixed:_-T.stretch,stretch:T.stretch}),m.push({fixed:_-T.stretch,stretch:T.stretch+(k-_)})}return m.push({fixed:l+Cd,stretch:d}),m}function Qg(c,l,d,m){return c/l*d+m}function ev(c,l,d,m){return c-l*d/m}class tv{constructor(l,d,m,_,k,T,z,L,F,q){var Q;if(this.boxStartIndex=l.length,F){let ae=T.top,ue=T.bottom;const me=T.collisionPadding;me&&(ae-=me[1],ue+=me[3]);let ve=ue-ae;ve>0&&(ve=Math.max(10,ve),this.circleDiameter=ve)}else{const ae=!((Q=T.image)===null||Q===void 0)&&Q.content&&(T.image.textFitWidth||T.image.textFitHeight)?EC(T):{x1:T.left,y1:T.top,x2:T.right,y2:T.bottom};ae.y1=ae.y1*z-L[0],ae.y2=ae.y2*z+L[2],ae.x1=ae.x1*z-L[3],ae.x2=ae.x2*z+L[1];const ue=T.collisionPadding;if(ue&&(ae.x1-=ue[0]*z,ae.y1-=ue[1]*z,ae.x2+=ue[2]*z,ae.y2+=ue[3]*z),q){const me=new v(ae.x1,ae.y1),ve=new v(ae.x2,ae.y1),Ce=new v(ae.x1,ae.y2),Ie=new v(ae.x2,ae.y2),Je=q*Math.PI/180;me._rotate(Je),ve._rotate(Je),Ce._rotate(Je),Ie._rotate(Je),ae.x1=Math.min(me.x,ve.x,Ce.x,Ie.x),ae.x2=Math.max(me.x,ve.x,Ce.x,Ie.x),ae.y1=Math.min(me.y,ve.y,Ce.y,Ie.y),ae.y2=Math.max(me.y,ve.y,Ce.y,Ie.y)}l.emplaceBack(d.x,d.y,ae.x1,ae.y1,ae.x2,ae.y2,m,_,k)}this.boxEndIndex=l.length}}class u3{constructor(l=[],d=(m,_)=>m<_?-1:m>_?1:0){if(this.data=l,this.length=this.data.length,this.compare=d,this.length>0)for(let m=(this.length>>1)-1;m>=0;m--)this._down(m)}push(l){this.data.push(l),this._up(this.length++)}pop(){if(this.length===0)return;const l=this.data[0],d=this.data.pop();return--this.length>0&&(this.data[0]=d,this._down(0)),l}peek(){return this.data[0]}_up(l){const{data:d,compare:m}=this,_=d[l];for(;l>0;){const k=l-1>>1,T=d[k];if(m(_,T)>=0)break;d[l]=T,l=k}d[l]=_}_down(l){const{data:d,compare:m}=this,_=this.length>>1,k=d[l];for(;l<_;){let T=1+(l<<1);const z=T+1;if(z<this.length&&m(d[z],d[T])<0&&(T=z),m(d[T],k)>=0)break;d[l]=d[T],l=T}d[l]=k}}function c3(c,l=1,d=!1){let m=1/0,_=1/0,k=-1/0,T=-1/0;const z=c[0];for(let ue=0;ue<z.length;ue++){const me=z[ue];(!ue||me.x<m)&&(m=me.x),(!ue||me.y<_)&&(_=me.y),(!ue||me.x>k)&&(k=me.x),(!ue||me.y>T)&&(T=me.y)}const L=Math.min(k-m,T-_);let F=L/2;const q=new u3([],d3);if(L===0)return new v(m,_);for(let ue=m;ue<k;ue+=L)for(let me=_;me<T;me+=L)q.push(new kd(ue+F,me+F,F,c));let Q=function(ue){let me=0,ve=0,Ce=0;const Ie=ue[0];for(let Je=0,je=Ie.length,Ze=je-1;Je<je;Ze=Je++){const ct=Ie[Je],_t=Ie[Ze],$t=ct.x*_t.y-_t.x*ct.y;ve+=(ct.x+_t.x)*$t,Ce+=(ct.y+_t.y)*$t,me+=3*$t}return new kd(ve/me,Ce/me,0,ue)}(c),ae=q.length;for(;q.length;){const ue=q.pop();(ue.d>Q.d||!Q.d)&&(Q=ue,d&&console.log("found best %d after %d probes",Math.round(1e4*ue.d)/1e4,ae)),ue.max-Q.d<=l||(F=ue.h/2,q.push(new kd(ue.p.x-F,ue.p.y-F,F,c)),q.push(new kd(ue.p.x+F,ue.p.y-F,F,c)),q.push(new kd(ue.p.x-F,ue.p.y+F,F,c)),q.push(new kd(ue.p.x+F,ue.p.y+F,F,c)),ae+=4)}return d&&(console.log(`num probes: ${ae}`),console.log(`best distance: ${Q.d}`)),Q.p}function d3(c,l){return l.max-c.max}function kd(c,l,d,m){this.p=new v(c,l),this.h=d,this.d=function(_,k){let T=!1,z=1/0;for(let L=0;L<k.length;L++){const F=k[L];for(let q=0,Q=F.length,ae=Q-1;q<Q;ae=q++){const ue=F[q],me=F[ae];ue.y>_.y!=me.y>_.y&&_.x<(me.x-ue.x)*(_.y-ue.y)/(me.y-ue.y)+ue.x&&(T=!T),z=Math.min(z,RE(_,ue,me))}}return(T?1:-1)*Math.sqrt(z)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}var ua;u.aq=void 0,(ua=u.aq||(u.aq={}))[ua.center=1]="center",ua[ua.left=2]="left",ua[ua.right=3]="right",ua[ua.top=4]="top",ua[ua.bottom=5]="bottom",ua[ua["top-left"]=6]="top-left",ua[ua["top-right"]=7]="top-right",ua[ua["bottom-left"]=8]="bottom-left",ua[ua["bottom-right"]=9]="bottom-right";const kl=7,yb=Number.POSITIVE_INFINITY;function QC(c,l){return l[1]!==yb?function(d,m,_){let k=0,T=0;switch(m=Math.abs(m),_=Math.abs(_),d){case"top-right":case"top-left":case"top":T=_-kl;break;case"bottom-right":case"bottom-left":case"bottom":T=-_+kl}switch(d){case"top-right":case"bottom-right":case"right":k=-m;break;case"top-left":case"bottom-left":case"left":k=m}return[k,T]}(c,l[0],l[1]):function(d,m){let _=0,k=0;m<0&&(m=0);const T=m/Math.SQRT2;switch(d){case"top-right":case"top-left":k=T-kl;break;case"bottom-right":case"bottom-left":k=-T+kl;break;case"bottom":k=-m+kl;break;case"top":k=m-kl}switch(d){case"top-right":case"bottom-right":_=-T;break;case"top-left":case"bottom-left":_=T;break;case"left":_=m;break;case"right":_=-m}return[_,k]}(c,l[0])}function ek(c,l,d){var m;const _=c.layout,k=(m=_.get("text-variable-anchor-offset"))===null||m===void 0?void 0:m.evaluate(l,{},d);if(k){const z=k.values,L=[];for(let F=0;F<z.length;F+=2){const q=L[F]=z[F],Q=z[F+1].map(ae=>ae*Bn);q.startsWith("top")?Q[1]-=kl:q.startsWith("bottom")&&(Q[1]+=kl),L[F+1]=Q}return new Gr(L)}const T=_.get("text-variable-anchor");if(T){let z;z=c._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[_.get("text-radial-offset").evaluate(l,{},d)*Bn,yb]:_.get("text-offset").evaluate(l,{},d).map(F=>F*Bn);const L=[];for(const F of T)L.push(F,QC(F,z));return new Gr(L)}return null}function xb(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function h3(c,l,d,m,_,k,T,z,L,F,q){let Q=k.textMaxSize.evaluate(l,{});Q===void 0&&(Q=T);const ae=c.layers[0].layout,ue=ae.get("icon-offset").evaluate(l,{},q),me=rk(d.horizontal),ve=T/24,Ce=c.tilePixelRatio*ve,Ie=c.tilePixelRatio*Q/24,Je=c.tilePixelRatio*z,je=c.tilePixelRatio*ae.get("symbol-spacing"),Ze=ae.get("text-padding")*c.tilePixelRatio,ct=function(pt,tr,Qt,gr=1){const Kr=pt.get("icon-padding").evaluate(tr,{},Qt),Xr=Kr&&Kr.values;return[Xr[0]*gr,Xr[1]*gr,Xr[2]*gr,Xr[3]*gr]}(ae,l,q,c.tilePixelRatio),_t=ae.get("text-max-angle")/180*Math.PI,$t=ae.get("text-rotation-alignment")!=="viewport"&&ae.get("symbol-placement")!=="point",lr=ae.get("icon-rotation-alignment")==="map"&&ae.get("symbol-placement")!=="point",Lt=ae.get("symbol-placement"),zt=je/2,er=ae.get("icon-text-fit");let Zt;m&&er!=="none"&&(c.allowVerticalPlacement&&d.vertical&&(Zt=CC(m,d.vertical,er,ae.get("icon-text-fit-padding"),ue,ve)),me&&(m=CC(m,me,er,ae.get("icon-text-fit-padding"),ue,ve)));const Gt=(pt,tr)=>{tr.x<0||tr.x>=Dn||tr.y<0||tr.y>=Dn||function(Qt,gr,Kr,Xr,$n,Ji,ca,Vn,La,Ba,ja,Cn,Un,_a,da,Oa,ha,zi,Qa,Lr,tn,ln,pi,yn,Td){const qs=Qt.addToLineVertexArray(gr,Kr);let Hs,Qi,Ri,Kn,Co=0,Yf=0,sk=0,ok=0,Tb=-1,Pb=-1;const ko={};let lk=fd("");if(Qt.allowVerticalPlacement&&Xr.vertical){const wa=Vn.layout.get("text-rotate").evaluate(tn,{},yn)+90;Ri=new tv(La,gr,Ba,ja,Cn,Xr.vertical,Un,_a,da,wa),ca&&(Kn=new tv(La,gr,Ba,ja,Cn,ca,ha,zi,da,wa))}if($n){const wa=Vn.layout.get("icon-rotate").evaluate(tn,{}),Li=Vn.layout.get("icon-text-fit")!=="none",qu=YC($n,wa,pi,Li),xs=ca?YC(ca,wa,pi,Li):void 0;Qi=new tv(La,gr,Ba,ja,Cn,$n,ha,zi,!1,wa),Co=4*qu.length;const Hu=Qt.iconSizeData;let Gs=null;Hu.kind==="source"?(Gs=[Us*Vn.layout.get("icon-size").evaluate(tn,{})],Gs[0]>Sl&&Y(`${Qt.layerIds[0]}: Value for "icon-size" is >= ${Gf}. Reduce your "icon-size".`)):Hu.kind==="composite"&&(Gs=[Us*ln.compositeIconSizes[0].evaluate(tn,{},yn),Us*ln.compositeIconSizes[1].evaluate(tn,{},yn)],(Gs[0]>Sl||Gs[1]>Sl)&&Y(`${Qt.layerIds[0]}: Value for "icon-size" is >= ${Gf}. Reduce your "icon-size".`)),Qt.addSymbols(Qt.icon,qu,Gs,Lr,Qa,tn,u.ah.none,gr,qs.lineStartIndex,qs.lineLength,-1,yn),Tb=Qt.icon.placedSymbolArray.length-1,xs&&(Yf=4*xs.length,Qt.addSymbols(Qt.icon,xs,Gs,Lr,Qa,tn,u.ah.vertical,gr,qs.lineStartIndex,qs.lineLength,-1,yn),Pb=Qt.icon.placedSymbolArray.length-1)}const uk=Object.keys(Xr.horizontal);for(const wa of uk){const Li=Xr.horizontal[wa];if(!Hs){lk=fd(Li.text);const xs=Vn.layout.get("text-rotate").evaluate(tn,{},yn);Hs=new tv(La,gr,Ba,ja,Cn,Li,Un,_a,da,xs)}const qu=Li.positionedLines.length===1;if(sk+=tk(Qt,gr,Li,Ji,Vn,da,tn,Oa,qs,Xr.vertical?u.ah.horizontal:u.ah.horizontalOnly,qu?uk:[wa],ko,Tb,ln,yn),qu)break}Xr.vertical&&(ok+=tk(Qt,gr,Xr.vertical,Ji,Vn,da,tn,Oa,qs,u.ah.vertical,["vertical"],ko,Pb,ln,yn));const m3=Hs?Hs.boxStartIndex:Qt.collisionBoxArray.length,g3=Hs?Hs.boxEndIndex:Qt.collisionBoxArray.length,v3=Ri?Ri.boxStartIndex:Qt.collisionBoxArray.length,y3=Ri?Ri.boxEndIndex:Qt.collisionBoxArray.length,x3=Qi?Qi.boxStartIndex:Qt.collisionBoxArray.length,b3=Qi?Qi.boxEndIndex:Qt.collisionBoxArray.length,_3=Kn?Kn.boxStartIndex:Qt.collisionBoxArray.length,w3=Kn?Kn.boxEndIndex:Qt.collisionBoxArray.length;let ys=-1;const nv=(wa,Li)=>wa&&wa.circleDiameter?Math.max(wa.circleDiameter,Li):Li;ys=nv(Hs,ys),ys=nv(Ri,ys),ys=nv(Qi,ys),ys=nv(Kn,ys);const ck=ys>-1?1:0;ck&&(ys*=Td/Bn),Qt.glyphOffsetArray.length>=Ed.MAX_GLYPHS&&Y("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),tn.sortKey!==void 0&&Qt.addToSortKeyRanges(Qt.symbolInstances.length,tn.sortKey);const S3=ek(Vn,tn,yn),[E3,C3]=function(wa,Li){const qu=wa.length,xs=Li==null?void 0:Li.values;if((xs==null?void 0:xs.length)>0)for(let Hu=0;Hu<xs.length;Hu+=2){const Gs=xs[Hu+1];wa.emplaceBack(u.aq[xs[Hu]],Gs[0],Gs[1])}return[qu,wa.length]}(Qt.textAnchorOffsets,S3);Qt.symbolInstances.emplaceBack(gr.x,gr.y,ko.right>=0?ko.right:-1,ko.center>=0?ko.center:-1,ko.left>=0?ko.left:-1,ko.vertical||-1,Tb,Pb,lk,m3,g3,v3,y3,x3,b3,_3,w3,Ba,sk,ok,Co,Yf,ck,0,Un,ys,E3,C3)}(c,tr,pt,d,m,_,Zt,c.layers[0],c.collisionBoxArray,l.index,l.sourceLayerIndex,c.index,Ce,[Ze,Ze,Ze,Ze],$t,L,Je,ct,lr,ue,l,k,F,q,T)};if(Lt==="line")for(const pt of HC(l.geometry,0,0,Dn,Dn)){const tr=l3(pt,je,_t,d.vertical||me,m,24,Ie,c.overscaling,Dn);for(const Qt of tr)me&&f3(c,me.text,zt,Qt)||Gt(pt,Qt)}else if(Lt==="line-center"){for(const pt of l.geometry)if(pt.length>1){const tr=o3(pt,_t,d.vertical||me,m,24,Ie);tr&&Gt(pt,tr)}}else if(l.type==="Polygon")for(const pt of Uc(l.geometry,0)){const tr=c3(pt,16);Gt(pt[0],new Cl(tr.x,tr.y,0))}else if(l.type==="LineString")for(const pt of l.geometry)Gt(pt,new Cl(pt[0].x,pt[0].y,0));else if(l.type==="Point")for(const pt of l.geometry)for(const tr of pt)Gt([tr],new Cl(tr.x,tr.y,0))}function tk(c,l,d,m,_,k,T,z,L,F,q,Q,ae,ue,me){const ve=function(Je,je,Ze,ct,_t,$t,lr,Lt){const zt=ct.layout.get("text-rotate").evaluate($t,{})*Math.PI/180,er=[];for(const Zt of je.positionedLines)for(const Gt of Zt.positionedGlyphs){if(!Gt.rect)continue;const pt=Gt.rect||{};let tr=vC+1,Qt=!0,gr=1,Kr=0;const Xr=(_t||Lt)&&Gt.vertical,$n=Gt.metrics.advance*Gt.scale/2;if(Lt&&je.verticalizable&&(Kr=Zt.lineOffset/2-(Gt.imageName?-(Bn-Gt.metrics.width*Gt.scale)/2:(Gt.scale-1)*Bn)),Gt.imageName){const Lr=lr[Gt.imageName];Qt=Lr.sdf,gr=Lr.pixelRatio,tr=Ja/gr}const Ji=_t?[Gt.x+$n,Gt.y]:[0,0];let ca=_t?[0,0]:[Gt.x+$n+Ze[0],Gt.y+Ze[1]-Kr],Vn=[0,0];Xr&&(Vn=ca,ca=[0,0]);const La=Gt.metrics.isDoubleResolution?2:1,Ba=(Gt.metrics.left-tr)*Gt.scale-$n+ca[0],ja=(-Gt.metrics.top-tr)*Gt.scale+ca[1],Cn=Ba+pt.w/La*Gt.scale/gr,Un=ja+pt.h/La*Gt.scale/gr,_a=new v(Ba,ja),da=new v(Cn,ja),Oa=new v(Ba,Un),ha=new v(Cn,Un);if(Xr){const Lr=new v(-$n,$n-qf),tn=-Math.PI/2,ln=Bn/2-$n,pi=new v(5-qf-ln,-(Gt.imageName?ln:0)),yn=new v(...Vn);_a._rotateAround(tn,Lr)._add(pi)._add(yn),da._rotateAround(tn,Lr)._add(pi)._add(yn),Oa._rotateAround(tn,Lr)._add(pi)._add(yn),ha._rotateAround(tn,Lr)._add(pi)._add(yn)}if(zt){const Lr=Math.sin(zt),tn=Math.cos(zt),ln=[tn,-Lr,Lr,tn];_a._matMult(ln),da._matMult(ln),Oa._matMult(ln),ha._matMult(ln)}const zi=new v(0,0),Qa=new v(0,0);er.push({tl:_a,tr:da,bl:Oa,br:ha,tex:pt,writingMode:je.writingMode,glyphOffset:Ji,sectionIndex:Gt.sectionIndex,isSDF:Qt,pixelOffsetTL:zi,pixelOffsetBR:Qa,minFontScaleX:0,minFontScaleY:0})}return er}(0,d,z,_,k,T,m,c.allowVerticalPlacement),Ce=c.textSizeData;let Ie=null;Ce.kind==="source"?(Ie=[Us*_.layout.get("text-size").evaluate(T,{})],Ie[0]>Sl&&Y(`${c.layerIds[0]}: Value for "text-size" is >= ${Gf}. Reduce your "text-size".`)):Ce.kind==="composite"&&(Ie=[Us*ue.compositeTextSizes[0].evaluate(T,{},me),Us*ue.compositeTextSizes[1].evaluate(T,{},me)],(Ie[0]>Sl||Ie[1]>Sl)&&Y(`${c.layerIds[0]}: Value for "text-size" is >= ${Gf}. Reduce your "text-size".`)),c.addSymbols(c.text,ve,Ie,z,k,T,F,l,L.lineStartIndex,L.lineLength,ae,me);for(const Je of q)Q[Je]=c.text.placedSymbolArray.length-1;return 4*ve.length}function rk(c){for(const l in c)return c[l];return null}function f3(c,l,d,m){const _=c.compareText;if(l in _){const k=_[l];for(let T=k.length-1;T>=0;T--)if(m.dist(k[T])<d)return!0}else _[l]=[];return _[l].push(m),!1}const nk=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class bb{static from(l){if(!(l instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[d,m]=new Uint8Array(l,0,2);if(d!==219)throw new Error("Data does not appear to be in a KDBush format.");const _=m>>4;if(_!==1)throw new Error(`Got v${_} data when expected v1.`);const k=nk[15&m];if(!k)throw new Error("Unrecognized array type.");const[T]=new Uint16Array(l,2,1),[z]=new Uint32Array(l,4,1);return new bb(z,T,k,l)}constructor(l,d=64,m=Float64Array,_){if(isNaN(l)||l<0)throw new Error(`Unpexpected numItems value: ${l}.`);this.numItems=+l,this.nodeSize=Math.min(Math.max(+d,2),65535),this.ArrayType=m,this.IndexArrayType=l<65536?Uint16Array:Uint32Array;const k=nk.indexOf(this.ArrayType),T=2*l*this.ArrayType.BYTES_PER_ELEMENT,z=l*this.IndexArrayType.BYTES_PER_ELEMENT,L=(8-z%8)%8;if(k<0)throw new Error(`Unexpected typed array class: ${m}.`);_&&_ instanceof ArrayBuffer?(this.data=_,this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+z+L,2*l),this._pos=2*l,this._finished=!0):(this.data=new ArrayBuffer(8+T+z+L),this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+z+L,2*l),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+k]),new Uint16Array(this.data,2,1)[0]=d,new Uint32Array(this.data,4,1)[0]=l)}add(l,d){const m=this._pos>>1;return this.ids[m]=m,this.coords[this._pos++]=l,this.coords[this._pos++]=d,m}finish(){const l=this._pos>>1;if(l!==this.numItems)throw new Error(`Added ${l} items when expected ${this.numItems}.`);return _b(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(l,d,m,_){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:k,coords:T,nodeSize:z}=this,L=[0,k.length-1,0],F=[];for(;L.length;){const q=L.pop()||0,Q=L.pop()||0,ae=L.pop()||0;if(Q-ae<=z){for(let Ce=ae;Ce<=Q;Ce++){const Ie=T[2*Ce],Je=T[2*Ce+1];Ie>=l&&Ie<=m&&Je>=d&&Je<=_&&F.push(k[Ce])}continue}const ue=ae+Q>>1,me=T[2*ue],ve=T[2*ue+1];me>=l&&me<=m&&ve>=d&&ve<=_&&F.push(k[ue]),(q===0?l<=me:d<=ve)&&(L.push(ae),L.push(ue-1),L.push(1-q)),(q===0?m>=me:_>=ve)&&(L.push(ue+1),L.push(Q),L.push(1-q))}return F}within(l,d,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:k,nodeSize:T}=this,z=[0,_.length-1,0],L=[],F=m*m;for(;z.length;){const q=z.pop()||0,Q=z.pop()||0,ae=z.pop()||0;if(Q-ae<=T){for(let Ce=ae;Ce<=Q;Ce++)ik(k[2*Ce],k[2*Ce+1],l,d)<=F&&L.push(_[Ce]);continue}const ue=ae+Q>>1,me=k[2*ue],ve=k[2*ue+1];ik(me,ve,l,d)<=F&&L.push(_[ue]),(q===0?l-m<=me:d-m<=ve)&&(z.push(ae),z.push(ue-1),z.push(1-q)),(q===0?l+m>=me:d+m>=ve)&&(z.push(ue+1),z.push(Q),z.push(1-q))}return L}}function _b(c,l,d,m,_,k){if(_-m<=d)return;const T=m+_>>1;ak(c,l,T,m,_,k),_b(c,l,d,m,T-1,1-k),_b(c,l,d,T+1,_,1-k)}function ak(c,l,d,m,_,k){for(;_>m;){if(_-m>600){const F=_-m+1,q=d-m+1,Q=Math.log(F),ae=.5*Math.exp(2*Q/3),ue=.5*Math.sqrt(Q*ae*(F-ae)/F)*(q-F/2<0?-1:1);ak(c,l,d,Math.max(m,Math.floor(d-q*ae/F+ue)),Math.min(_,Math.floor(d+(F-q)*ae/F+ue)),k)}const T=l[2*d+k];let z=m,L=_;for(Xf(c,l,m,d),l[2*_+k]>T&&Xf(c,l,m,_);z<L;){for(Xf(c,l,z,L),z++,L--;l[2*z+k]<T;)z++;for(;l[2*L+k]>T;)L--}l[2*m+k]===T?Xf(c,l,m,L):(L++,Xf(c,l,L,_)),L<=d&&(m=L+1),d<=L&&(_=L-1)}}function Xf(c,l,d,m){wb(c,d,m),wb(l,2*d,2*m),wb(l,2*d+1,2*m+1)}function wb(c,l,d){const m=c[l];c[l]=c[d],c[d]=m}function ik(c,l,d,m){const _=c-d,k=l-m;return _*_+k*k}var Sb;u.bg=void 0,(Sb=u.bg||(u.bg={})).create="create",Sb.load="load",Sb.fullLoad="fullLoad";let rv=null,Kf=[];const Eb=1e3/60,Cb="loadTime",kb="fullLoadTime",p3={mark(c){performance.mark(c)},frame(c){const l=c;rv!=null&&Kf.push(l-rv),rv=l},clearMetrics(){rv=null,Kf=[],performance.clearMeasures(Cb),performance.clearMeasures(kb);for(const c in u.bg)performance.clearMarks(u.bg[c])},getPerformanceMetrics(){performance.measure(Cb,u.bg.create,u.bg.load),performance.measure(kb,u.bg.create,u.bg.fullLoad);const c=performance.getEntriesByName(Cb)[0].duration,l=performance.getEntriesByName(kb)[0].duration,d=Kf.length,m=1/(Kf.reduce((k,T)=>k+T,0)/d/1e3),_=Kf.filter(k=>k>Eb).reduce((k,T)=>k+(T-Eb)/Eb,0);return{loadTime:c,fullLoadTime:l,fps:m,percentDroppedFrames:_/(d+_)*100,totalFrames:d}}};u.$=class extends ee{},u.A=yd,u.B=zx,u.C=function(c){if(ie==null){const l=c.navigator?c.navigator.userAgent:null;ie=!!c.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return ie},u.D=Yt,u.E=Tt,u.F=class{constructor(c,l){this.target=c,this.mapId=l,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new i3(()=>this.process()),this.subscription=function(d,m,_,k){return d.addEventListener(m,_,!1),{unsubscribe:()=>{d.removeEventListener(m,_,!1)}}}(this.target,"message",d=>this.receive(d)),this.globalScope=oe(self)?c:window}registerMessageHandler(c,l){this.messageHandlers[c]=l}sendAsync(c,l){return new Promise((d,m)=>{const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[_]={resolve:d,reject:m},l&&l.signal.addEventListener("abort",()=>{delete this.resolveRejects[_];const z={id:_,type:"<cancel>",origin:location.origin,targetMapId:c.targetMapId,sourceMapId:this.mapId};this.target.postMessage(z)},{once:!0});const k=[],T=Object.assign(Object.assign({},c),{id:_,sourceMapId:this.mapId,origin:location.origin,data:dl(c.data,k)});this.target.postMessage(T,{transfer:k})})}receive(c){const l=c.data,d=l.id;if(!(l.origin!=="file://"&&location.origin!=="file://"&&l.origin!=="resource://android"&&location.origin!=="resource://android"&&l.origin!==location.origin||l.targetMapId&&this.mapId!==l.targetMapId)){if(l.type==="<cancel>"){delete this.tasks[d];const m=this.abortControllers[d];return delete this.abortControllers[d],void(m&&m.abort())}if(oe(self)||l.mustQueue)return this.tasks[d]=l,this.taskQueue.push(d),void this.invoker.trigger();this.processTask(d,l)}}process(){if(this.taskQueue.length===0)return;const c=this.taskQueue.shift(),l=this.tasks[c];delete this.tasks[c],this.taskQueue.length>0&&this.invoker.trigger(),l&&this.processTask(c,l)}processTask(c,l){return s(this,void 0,void 0,function*(){if(l.type==="<response>"){const _=this.resolveRejects[c];return delete this.resolveRejects[c],_?void(l.error?_.reject(hl(l.error)):_.resolve(hl(l.data))):void 0}if(!this.messageHandlers[l.type])return void this.completeTask(c,new Error(`Could not find a registered handler for ${l.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const d=hl(l.data),m=new AbortController;this.abortControllers[c]=m;try{const _=yield this.messageHandlers[l.type](l.sourceMapId,d,m);this.completeTask(c,null,_)}catch(_){this.completeTask(c,_)}})}completeTask(c,l,d){const m=[];delete this.abortControllers[c];const _={id:c,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:l?dl(l):null,data:dl(d,m)};this.target.postMessage(_,{transfer:m})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},u.G=et,u.H=function(){var c=new yd(16);return yd!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},u.I=ob,u.J=function(c,l,d){var m,_,k,T,z,L,F,q,Q,ae,ue,me,ve=d[0],Ce=d[1],Ie=d[2];return l===c?(c[12]=l[0]*ve+l[4]*Ce+l[8]*Ie+l[12],c[13]=l[1]*ve+l[5]*Ce+l[9]*Ie+l[13],c[14]=l[2]*ve+l[6]*Ce+l[10]*Ie+l[14],c[15]=l[3]*ve+l[7]*Ce+l[11]*Ie+l[15]):(_=l[1],k=l[2],T=l[3],z=l[4],L=l[5],F=l[6],q=l[7],Q=l[8],ae=l[9],ue=l[10],me=l[11],c[0]=m=l[0],c[1]=_,c[2]=k,c[3]=T,c[4]=z,c[5]=L,c[6]=F,c[7]=q,c[8]=Q,c[9]=ae,c[10]=ue,c[11]=me,c[12]=m*ve+z*Ce+Q*Ie+l[12],c[13]=_*ve+L*Ce+ae*Ie+l[13],c[14]=k*ve+F*Ce+ue*Ie+l[14],c[15]=T*ve+q*Ce+me*Ie+l[15]),c},u.K=function(c,l,d){var m=d[0],_=d[1],k=d[2];return c[0]=l[0]*m,c[1]=l[1]*m,c[2]=l[2]*m,c[3]=l[3]*m,c[4]=l[4]*_,c[5]=l[5]*_,c[6]=l[6]*_,c[7]=l[7]*_,c[8]=l[8]*k,c[9]=l[9]*k,c[10]=l[10]*k,c[11]=l[11]*k,c[12]=l[12],c[13]=l[13],c[14]=l[14],c[15]=l[15],c},u.L=OE,u.M=function(c,l){const d={};for(let m=0;m<l.length;m++){const _=l[m];_ in c&&(d[_]=c[_])}return d},u.N=El,u.O=zC,u.P=v,u.Q=RC,u.R=Mi,u.S=Di,u.T=ld,u.U=I,u.V=A,u.W=de,u.X=Dn,u.Y=R,u.Z=Wf,u._=s,u.a=Oe,u.a$=function(c,l){var d=c[0],m=c[1],_=c[2],k=c[3],T=c[4],z=c[5],L=c[6],F=c[7],q=c[8],Q=c[9],ae=c[10],ue=c[11],me=c[12],ve=c[13],Ce=c[14],Ie=c[15],Je=l[0],je=l[1],Ze=l[2],ct=l[3],_t=l[4],$t=l[5],lr=l[6],Lt=l[7],zt=l[8],er=l[9],Zt=l[10],Gt=l[11],pt=l[12],tr=l[13],Qt=l[14],gr=l[15];return Math.abs(d-Je)<=Ra*Math.max(1,Math.abs(d),Math.abs(Je))&&Math.abs(m-je)<=Ra*Math.max(1,Math.abs(m),Math.abs(je))&&Math.abs(_-Ze)<=Ra*Math.max(1,Math.abs(_),Math.abs(Ze))&&Math.abs(k-ct)<=Ra*Math.max(1,Math.abs(k),Math.abs(ct))&&Math.abs(T-_t)<=Ra*Math.max(1,Math.abs(T),Math.abs(_t))&&Math.abs(z-$t)<=Ra*Math.max(1,Math.abs(z),Math.abs($t))&&Math.abs(L-lr)<=Ra*Math.max(1,Math.abs(L),Math.abs(lr))&&Math.abs(F-Lt)<=Ra*Math.max(1,Math.abs(F),Math.abs(Lt))&&Math.abs(q-zt)<=Ra*Math.max(1,Math.abs(q),Math.abs(zt))&&Math.abs(Q-er)<=Ra*Math.max(1,Math.abs(Q),Math.abs(er))&&Math.abs(ae-Zt)<=Ra*Math.max(1,Math.abs(ae),Math.abs(Zt))&&Math.abs(ue-Gt)<=Ra*Math.max(1,Math.abs(ue),Math.abs(Gt))&&Math.abs(me-pt)<=Ra*Math.max(1,Math.abs(me),Math.abs(pt))&&Math.abs(ve-tr)<=Ra*Math.max(1,Math.abs(ve),Math.abs(tr))&&Math.abs(Ce-Qt)<=Ra*Math.max(1,Math.abs(Ce),Math.abs(Qt))&&Math.abs(Ie-gr)<=Ra*Math.max(1,Math.abs(Ie),Math.abs(gr))},u.a0=Ar,u.a1=vb,u.a2=ft,u.a3=c=>{const l=window.document.createElement("video");return l.muted=!0,new Promise(d=>{l.onloadstart=()=>{d(l)};for(const m of c){const _=window.document.createElement("source");ze(m)||(l.crossOrigin="Anonymous"),_.src=m,l.appendChild(_)}})},u.a4=function(){return W++},u.a5=jt,u.a6=Ed,u.a7=ff,u.a8=Vu,u.a9=$C,u.aA=function(c){if(c.type==="custom")return new a3(c);switch(c.type){case"background":return new t3(c);case"circle":return new VB(c);case"fill":return new i4(c);case"fill-extrusion":return new b4(c);case"heatmap":return new qB(c);case"hillshade":return new GB(c);case"line":return new P4(c);case"raster":return new n3(c);case"symbol":return new Yg(c)}},u.aB=Z,u.aC=function(c,l){if(!c)return[{command:"setStyle",args:[l]}];let d=[];try{if(!Ye(c.version,l.version))return[{command:"setStyle",args:[l]}];Ye(c.center,l.center)||d.push({command:"setCenter",args:[l.center]}),Ye(c.zoom,l.zoom)||d.push({command:"setZoom",args:[l.zoom]}),Ye(c.bearing,l.bearing)||d.push({command:"setBearing",args:[l.bearing]}),Ye(c.pitch,l.pitch)||d.push({command:"setPitch",args:[l.pitch]}),Ye(c.sprite,l.sprite)||d.push({command:"setSprite",args:[l.sprite]}),Ye(c.glyphs,l.glyphs)||d.push({command:"setGlyphs",args:[l.glyphs]}),Ye(c.transition,l.transition)||d.push({command:"setTransition",args:[l.transition]}),Ye(c.light,l.light)||d.push({command:"setLight",args:[l.light]}),Ye(c.terrain,l.terrain)||d.push({command:"setTerrain",args:[l.terrain]}),Ye(c.sky,l.sky)||d.push({command:"setSky",args:[l.sky]}),Ye(c.projection,l.projection)||d.push({command:"setProjection",args:[l.projection]});const m={},_=[];(function(T,z,L,F){let q;for(q in z=z||{},T=T||{})Object.prototype.hasOwnProperty.call(T,q)&&(Object.prototype.hasOwnProperty.call(z,q)||Et(q,L,F));for(q in z)Object.prototype.hasOwnProperty.call(z,q)&&(Object.prototype.hasOwnProperty.call(T,q)?Ye(T[q],z[q])||(T[q].type==="geojson"&&z[q].type==="geojson"&&Bt(T,z,q)?at(L,{command:"setGeoJSONSourceData",args:[q,z[q].data]}):Vt(q,z,L,F)):bt(q,z,L))})(c.sources,l.sources,_,m);const k=[];c.layers&&c.layers.forEach(T=>{"source"in T&&m[T.source]?d.push({command:"removeLayer",args:[T.id]}):k.push(T)}),d=d.concat(_),function(T,z,L){z=z||[];const F=(T=T||[]).map(cr),q=z.map(cr),Q=T.reduce(ar,{}),ae=z.reduce(ar,{}),ue=F.slice(),me=Object.create(null);let ve,Ce,Ie,Je,je;for(let Ze=0,ct=0;Ze<F.length;Ze++)ve=F[Ze],Object.prototype.hasOwnProperty.call(ae,ve)?ct++:(at(L,{command:"removeLayer",args:[ve]}),ue.splice(ue.indexOf(ve,ct),1));for(let Ze=0,ct=0;Ze<q.length;Ze++)ve=q[q.length-1-Ze],ue[ue.length-1-Ze]!==ve&&(Object.prototype.hasOwnProperty.call(Q,ve)?(at(L,{command:"removeLayer",args:[ve]}),ue.splice(ue.lastIndexOf(ve,ue.length-ct),1)):ct++,Je=ue[ue.length-Ze],at(L,{command:"addLayer",args:[ae[ve],Je]}),ue.splice(ue.length-Ze,0,ve),me[ve]=!0);for(let Ze=0;Ze<q.length;Ze++)if(ve=q[Ze],Ce=Q[ve],Ie=ae[ve],!me[ve]&&!Ye(Ce,Ie))if(Ye(Ce.source,Ie.source)&&Ye(Ce["source-layer"],Ie["source-layer"])&&Ye(Ce.type,Ie.type)){for(je in Mt(Ce.layout,Ie.layout,L,ve,null,"setLayoutProperty"),Mt(Ce.paint,Ie.paint,L,ve,null,"setPaintProperty"),Ye(Ce.filter,Ie.filter)||at(L,{command:"setFilter",args:[ve,Ie.filter]}),Ye(Ce.minzoom,Ie.minzoom)&&Ye(Ce.maxzoom,Ie.maxzoom)||at(L,{command:"setLayerZoomRange",args:[ve,Ie.minzoom,Ie.maxzoom]}),Ce)Object.prototype.hasOwnProperty.call(Ce,je)&&je!=="layout"&&je!=="paint"&&je!=="filter"&&je!=="metadata"&&je!=="minzoom"&&je!=="maxzoom"&&(je.indexOf("paint.")===0?Mt(Ce[je],Ie[je],L,ve,je.slice(6),"setPaintProperty"):Ye(Ce[je],Ie[je])||at(L,{command:"setLayerProperty",args:[ve,je,Ie[je]]}));for(je in Ie)Object.prototype.hasOwnProperty.call(Ie,je)&&!Object.prototype.hasOwnProperty.call(Ce,je)&&je!=="layout"&&je!=="paint"&&je!=="filter"&&je!=="metadata"&&je!=="minzoom"&&je!=="maxzoom"&&(je.indexOf("paint.")===0?Mt(Ce[je],Ie[je],L,ve,je.slice(6),"setPaintProperty"):Ye(Ce[je],Ie[je])||at(L,{command:"setLayerProperty",args:[ve,je,Ie[je]]}))}else at(L,{command:"removeLayer",args:[ve]}),Je=ue[ue.lastIndexOf(ve)+1],at(L,{command:"addLayer",args:[Ie,Je]})}(k,l.layers,d)}catch(m){console.warn("Unable to compute style diff:",m),d=[{command:"setStyle",args:[l]}]}return d},u.aD=function(c){const l=[],d=c.id;return d===void 0&&l.push({message:`layers.${d}: missing required property "id"`}),c.render===void 0&&l.push({message:`layers.${d}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&l.push({message:`layers.${d}: property "renderingMode" must be either "2d" or "3d"`}),l},u.aE=function c(l,d){if(Array.isArray(l)){if(!Array.isArray(d)||l.length!==d.length)return!1;for(let m=0;m<l.length;m++)if(!c(l[m],d[m]))return!1;return!0}if(typeof l=="object"&&l!==null&&d!==null){if(typeof d!="object"||Object.keys(l).length!==Object.keys(d).length)return!1;for(const m in l)if(!c(l[m],d[m]))return!1;return!0}return l===d},u.aF=X,u.aG=J,u.aH=class extends Ou{constructor(c,l){super(c,l),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}},u.aI=jg,u.aJ=class extends Ou{constructor(c,l){super(c,l),this.current=zB}set(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let l=1;l<16;l++)if(c[l]!==this.current[l]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}},u.aK=PE,u.aL=IE,u.aM=Mr,u.aN=class extends Ou{constructor(c,l){super(c,l),this.current=[0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))}},u.aO=class extends Ou{constructor(c,l){super(c,l),this.current=[0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))}},u.aP=function(c,l,d,m,_,k,T){var z=1/(l-d),L=1/(m-_),F=1/(k-T);return c[0]=-2*z,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*L,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*F,c[11]=0,c[12]=(l+d)*z,c[13]=(_+m)*L,c[14]=(T+k)*F,c[15]=1,c},u.aQ=$B,u.aR=class extends Ve{},u.aS=M4,u.aT=class extends tt{},u.aU=Xx,u.aV=function(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))},u.aW=qE,u.aX=oa,u.aY=Ni,u.aZ=class extends Jt{},u.a_=function(c,l){return c[0]===l[0]&&c[1]===l[1]&&c[2]===l[2]&&c[3]===l[3]&&c[4]===l[4]&&c[5]===l[5]&&c[6]===l[6]&&c[7]===l[7]&&c[8]===l[8]&&c[9]===l[9]&&c[10]===l[10]&&c[11]===l[11]&&c[12]===l[12]&&c[13]===l[13]&&c[14]===l[14]&&c[15]===l[15]},u.aa=function(c){const l={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(d,m,_,k)=>{const T=_||k;return l[m]=!T||T.toLowerCase(),""}),l["max-age"]){const d=parseInt(l["max-age"],10);isNaN(d)?delete l["max-age"]:l["max-age"]=d}return l},u.ab=function(c,l){const d=[];for(const m in c)m in l||d.push(m);return d},u.ac=V,u.ad=function(c,l,d){var m=Math.sin(d),_=Math.cos(d),k=l[0],T=l[1],z=l[2],L=l[3],F=l[4],q=l[5],Q=l[6],ae=l[7];return l!==c&&(c[8]=l[8],c[9]=l[9],c[10]=l[10],c[11]=l[11],c[12]=l[12],c[13]=l[13],c[14]=l[14],c[15]=l[15]),c[0]=k*_+F*m,c[1]=T*_+q*m,c[2]=z*_+Q*m,c[3]=L*_+ae*m,c[4]=F*_-k*m,c[5]=q*_-T*m,c[6]=Q*_-z*m,c[7]=ae*_-L*m,c},u.ae=function(c){var l=new yd(16);return l[0]=c[0],l[1]=c[1],l[2]=c[2],l[3]=c[3],l[4]=c[4],l[5]=c[5],l[6]=c[6],l[7]=c[7],l[8]=c[8],l[9]=c[9],l[10]=c[10],l[11]=c[11],l[12]=c[12],l[13]=c[13],l[14]=c[14],l[15]=c[15],l},u.af=Vg,u.ag=function(c,l){let d=0,m=0;if(c.kind==="constant")m=c.layoutSize;else if(c.kind!=="source"){const{interpolationType:_,minZoom:k,maxZoom:T}=c,z=_?V(Da.interpolationFactor(_,l,k,T),0,1):0;c.kind==="camera"?m=Ma.number(c.minSize,c.maxSize,z):d=z}return{uSizeT:d,uSize:m}},u.ai=function(c,{uSize:l,uSizeT:d},{lowerSize:m,upperSize:_}){return c.kind==="source"?m/Us:c.kind==="composite"?Ma.number(m/Us,_/Us,d):l},u.aj=db,u.ak=function(c,l,d,m){const _=l.y-c.y,k=l.x-c.x,T=m.y-d.y,z=m.x-d.x,L=T*k-z*_;if(L===0)return null;const F=(z*(c.y-d.y)-T*(c.x-d.x))/L;return new v(c.x+F*k,c.y+F*_)},u.al=HC,u.am=DE,u.an=Gx,u.ao=function(c){let l=1/0,d=1/0,m=-1/0,_=-1/0;for(const k of c)l=Math.min(l,k.x),d=Math.min(d,k.y),m=Math.max(m,k.x),_=Math.max(_,k.y);return[l,d,m,_]},u.ap=Bn,u.ar=cb,u.as=function(c,l){var d=l[0],m=l[1],_=l[2],k=l[3],T=l[4],z=l[5],L=l[6],F=l[7],q=l[8],Q=l[9],ae=l[10],ue=l[11],me=l[12],ve=l[13],Ce=l[14],Ie=l[15],Je=d*z-m*T,je=d*L-_*T,Ze=d*F-k*T,ct=m*L-_*z,_t=m*F-k*z,$t=_*F-k*L,lr=q*ve-Q*me,Lt=q*Ce-ae*me,zt=q*Ie-ue*me,er=Q*Ce-ae*ve,Zt=Q*Ie-ue*ve,Gt=ae*Ie-ue*Ce,pt=Je*Gt-je*Zt+Ze*er+ct*zt-_t*Lt+$t*lr;return pt?(c[0]=(z*Gt-L*Zt+F*er)*(pt=1/pt),c[1]=(_*Zt-m*Gt-k*er)*pt,c[2]=(ve*$t-Ce*_t+Ie*ct)*pt,c[3]=(ae*_t-Q*$t-ue*ct)*pt,c[4]=(L*zt-T*Gt-F*Lt)*pt,c[5]=(d*Gt-_*zt+k*Lt)*pt,c[6]=(Ce*Ze-me*$t-Ie*je)*pt,c[7]=(q*$t-ae*Ze+ue*je)*pt,c[8]=(T*Zt-z*zt+F*lr)*pt,c[9]=(m*zt-d*Zt-k*lr)*pt,c[10]=(me*_t-ve*Ze+Ie*Je)*pt,c[11]=(Q*Ze-q*_t-ue*Je)*pt,c[12]=(z*Lt-T*er-L*lr)*pt,c[13]=(d*er-m*Lt+_*lr)*pt,c[14]=(ve*je-me*ct-Ce*Je)*pt,c[15]=(q*ct-Q*je+ae*Je)*pt,c):null},u.at=xb,u.au=ub,u.av=bb,u.aw=function(){const c={},l=$e.$version;for(const d in $e.$root){const m=$e.$root[d];if(m.required){let _=null;_=d==="version"?l:m.type==="array"?[]:{},_!=null&&(c[d]=_)}}return c},u.ax=Tf,u.ay=mt,u.az=function(c){c=c.slice();const l=Object.create(null);for(let d=0;d<c.length;d++)l[c[d].id]=c[d];for(let d=0;d<c.length;d++)"ref"in c[d]&&(c[d]=Pe(c[d],l[c[d].ref]));return c},u.b=ce,u.b0=function(c,l){return c[0]=l[0],c[1]=l[1],c[2]=l[2],c[3]=l[3],c[4]=l[4],c[5]=l[5],c[6]=l[6],c[7]=l[7],c[8]=l[8],c[9]=l[9],c[10]=l[10],c[11]=l[11],c[12]=l[12],c[13]=l[13],c[14]=l[14],c[15]=l[15],c},u.b1=function(c,l,d){return c[0]=l[0]*d[0],c[1]=l[1]*d[1],c[2]=l[2]*d[2],c[3]=l[3]*d[3],c},u.b2=function(c,l){return c[0]*l[0]+c[1]*l[1]+c[2]*l[2]+c[3]*l[3]},u.b3=U,u.b4=jC,u.b5=LC,u.b6=function(c,l,d,m,_){var k,T=1/Math.tan(l/2);return c[0]=T/d,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=T,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,_!=null&&_!==1/0?(c[10]=(_+m)*(k=1/(m-_)),c[14]=2*_*m*k):(c[10]=-1,c[14]=-2*m),c},u.b7=function(c,l,d){var m=Math.sin(d),_=Math.cos(d),k=l[4],T=l[5],z=l[6],L=l[7],F=l[8],q=l[9],Q=l[10],ae=l[11];return l!==c&&(c[0]=l[0],c[1]=l[1],c[2]=l[2],c[3]=l[3],c[12]=l[12],c[13]=l[13],c[14]=l[14],c[15]=l[15]),c[4]=k*_+F*m,c[5]=T*_+q*m,c[6]=z*_+Q*m,c[7]=L*_+ae*m,c[8]=F*_-k*m,c[9]=q*_-T*m,c[10]=Q*_-z*m,c[11]=ae*_-L*m,c},u.b8=D,u.b9=j,u.bA=cC,u.bB=function(c){return c.message===xe},u.bC=il,u.bD=Ka,u.ba=function(c){return c*Math.PI/180},u.bb=function(c,l){const{x:d,y:m}=Wf.fromLngLat(l);return!(c<0||c>25||m<0||m>=1||d<0||d>=1)},u.bc=function(c,l){return c[0]=l[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=l[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=l[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},u.bd=class extends H{},u.be=mb,u.bf=p3,u.bh=nt,u.bi=function(c,l){Oe.REGISTERED_PROTOCOLS[c]=l},u.bj=function(c){delete Oe.REGISTERED_PROTOCOLS[c]},u.bk=function(c,l){const d={};for(let _=0;_<c.length;_++){const k=l&&l[c[_].id]||kg(c[_]);l&&(l[c[_].id]=k);let T=d[k];T||(T=d[k]=[]),T.push(c[_])}const m=[];for(const _ in d)m.push(d[_]);return m},u.bl=Wt,u.bm=FC,u.bn=VC,u.bo=xC,u.bp=function(c){c.bucket.createArrays(),c.bucket.tilePixelRatio=Dn/(512*c.bucket.overscaling),c.bucket.compareText={},c.bucket.iconsNeedLinear=!1;const l=c.bucket.layers[0],d=l.layout,m=l._unevaluatedLayout._values,_={layoutIconSize:m["icon-size"].possiblyEvaluate(new nn(c.bucket.zoom+1),c.canonical),layoutTextSize:m["text-size"].possiblyEvaluate(new nn(c.bucket.zoom+1),c.canonical),textMaxSize:m["text-size"].possiblyEvaluate(new nn(18))};if(c.bucket.textSizeData.kind==="composite"){const{minZoom:F,maxZoom:q}=c.bucket.textSizeData;_.compositeTextSizes=[m["text-size"].possiblyEvaluate(new nn(F),c.canonical),m["text-size"].possiblyEvaluate(new nn(q),c.canonical)]}if(c.bucket.iconSizeData.kind==="composite"){const{minZoom:F,maxZoom:q}=c.bucket.iconSizeData;_.compositeIconSizes=[m["icon-size"].possiblyEvaluate(new nn(F),c.canonical),m["icon-size"].possiblyEvaluate(new nn(q),c.canonical)]}const k=d.get("text-line-height")*Bn,T=d.get("text-rotation-alignment")!=="viewport"&&d.get("symbol-placement")!=="point",z=d.get("text-keep-upright"),L=d.get("text-size");for(const F of c.bucket.features){const q=d.get("text-font").evaluate(F,{},c.canonical).join(","),Q=L.evaluate(F,{},c.canonical),ae=_.layoutTextSize.evaluate(F,{},c.canonical),ue=_.layoutIconSize.evaluate(F,{},c.canonical),me={horizontal:{},vertical:void 0},ve=F.text;let Ce,Ie=[0,0];if(ve){const Ze=ve.toString(),ct=d.get("text-letter-spacing").evaluate(F,{},c.canonical)*Bn,_t=Rx(Ze)?ct:0,$t=d.get("text-anchor").evaluate(F,{},c.canonical),lr=ek(l,F,c.canonical);if(!lr){const Zt=d.get("text-radial-offset").evaluate(F,{},c.canonical);Ie=Zt?QC($t,[Zt*Bn,yb]):d.get("text-offset").evaluate(F,{},c.canonical).map(Gt=>Gt*Bn)}let Lt=T?"center":d.get("text-justify").evaluate(F,{},c.canonical);const zt=d.get("symbol-placement")==="point"?d.get("text-max-width").evaluate(F,{},c.canonical)*Bn:1/0,er=()=>{c.bucket.allowVerticalPlacement&&Pf(Ze)&&(me.vertical=Zg(ve,c.glyphMap,c.glyphPositions,c.imagePositions,q,zt,k,$t,"left",_t,Ie,u.ah.vertical,!0,ae,Q))};if(!T&&lr){const Zt=new Set;if(Lt==="auto")for(let pt=0;pt<lr.values.length;pt+=2)Zt.add(xb(lr.values[pt]));else Zt.add(Lt);let Gt=!1;for(const pt of Zt)if(!me.horizontal[pt])if(Gt)me.horizontal[pt]=me.horizontal[0];else{const tr=Zg(ve,c.glyphMap,c.glyphPositions,c.imagePositions,q,zt,k,"center",pt,_t,Ie,u.ah.horizontal,!1,ae,Q);tr&&(me.horizontal[pt]=tr,Gt=tr.positionedLines.length===1)}er()}else{Lt==="auto"&&(Lt=xb($t));const Zt=Zg(ve,c.glyphMap,c.glyphPositions,c.imagePositions,q,zt,k,$t,Lt,_t,Ie,u.ah.horizontal,!1,ae,Q);Zt&&(me.horizontal[Lt]=Zt),er(),Pf(Ze)&&T&&z&&(me.vertical=Zg(ve,c.glyphMap,c.glyphPositions,c.imagePositions,q,zt,k,$t,Lt,_t,Ie,u.ah.vertical,!1,ae,Q))}}let Je=!1;if(F.icon&&F.icon.name){const Ze=c.imageMap[F.icon.name];Ze&&(Ce=K4(c.imagePositions[F.icon.name],d.get("icon-offset").evaluate(F,{},c.canonical),d.get("icon-anchor").evaluate(F,{},c.canonical)),Je=!!Ze.sdf,c.bucket.sdfIcons===void 0?c.bucket.sdfIcons=Je:c.bucket.sdfIcons!==Je&&Y("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ze.pixelRatio!==c.bucket.pixelRatio||d.get("icon-rotate").constantOr(1)!==0)&&(c.bucket.iconsNeedLinear=!0))}const je=rk(me.horizontal)||me.vertical;c.bucket.iconsInText=!!je&&je.iconsInText,(je||Ce)&&h3(c.bucket,F,me,Ce,c.imageMap,_,ae,ue,Ie,Je,c.canonical)}c.showCollisionBoxes&&c.bucket.generateCollisionDebugBuffers()},u.bq=nb,u.br=eb,u.bs=rb,u.bt=_l,u.bu=ib,u.bv=class{constructor(c){this._marks={start:[c.url,"start"].join("#"),end:[c.url,"end"].join("#"),measure:c.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let c=performance.getEntriesByName(this._marks.measure);return c.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),c=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),c}},u.bw=function(c,l,d,m,_){return s(this,void 0,void 0,function*(){if(A())try{return yield de(c,l,d,m,_)}catch{}return function(k,T,z,L,F){const q=k.width,Q=k.height;be&&ge||(be=new OffscreenCanvas(q,Q),ge=be.getContext("2d",{willReadFrequently:!0})),be.width=q,be.height=Q,ge.drawImage(k,0,0,q,Q);const ae=ge.getImageData(T,z,L,F);return ge.clearRect(0,0,q,Q),ae.data}(c,l,d,m,_)})},u.bx=OC,u.by=h,u.bz=p,u.c=Le,u.d=c=>s(void 0,void 0,void 0,function*(){if(c.byteLength===0)return createImageBitmap(new ImageData(1,1));const l=new Blob([new Uint8Array(c)],{type:"image/png"});try{return createImageBitmap(l)}catch(d){throw new Error(`Could not load image because of ${d.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),u.e=$,u.f=c=>new Promise((l,d)=>{const m=new Image;m.onload=()=>{l(m),URL.revokeObjectURL(m.src),m.onload=null,window.requestAnimationFrame(()=>{m.src=fe})},m.onerror=()=>d(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const _=new Blob([new Uint8Array(c)],{type:"image/png"});m.src=c.byteLength?URL.createObjectURL(_):fe}),u.g=Fe,u.h=(c,l)=>it($(c,{type:"json"}),l),u.i=oe,u.j=xt,u.k=ot,u.l=(c,l)=>it($(c,{type:"arrayBuffer"}),l),u.m=it,u.n=function(c){return new ib(c).readFields(U4,[])},u.o=Bf,u.p=yC,u.q=C,u.r=Dx,u.s=ze,u.t=Cf,u.u=_o,u.v=$e,u.w=Y,u.x=function([c,l,d]){return l+=90,l*=Math.PI/180,d*=Math.PI/180,{x:c*Math.cos(l)*Math.sin(d),y:c*Math.sin(l)*Math.sin(d),z:c*Math.cos(d)}},u.y=Ma,u.z=nn}),a("worker",["./shared"],function(u){class s{constructor(ne){this.keyCache={},ne&&this.replace(ne)}replace(ne){this._layerConfigs={},this._layers={},this.update(ne,[])}update(ne,re){for(const _e of ne){this._layerConfigs[_e.id]=_e;const Ne=this._layers[_e.id]=u.aA(_e);Ne._featureFilter=u.a7(Ne.filter),this.keyCache[_e.id]&&delete this.keyCache[_e.id]}for(const _e of re)delete this.keyCache[_e],delete this._layerConfigs[_e],delete this._layers[_e];this.familiesBySource={};const pe=u.bk(Object.values(this._layerConfigs),this.keyCache);for(const _e of pe){const Ne=_e.map(Qe=>this._layers[Qe.id]),De=Ne[0];if(De.visibility==="none")continue;const Ue=De.source||"";let Te=this.familiesBySource[Ue];Te||(Te=this.familiesBySource[Ue]={});const rt=De.sourceLayer||"_geojsonTileLayer";let ht=Te[rt];ht||(ht=Te[rt]=[]),ht.push(Ne)}}}class h{constructor(ne){const re={},pe=[];for(const Ue in ne){const Te=ne[Ue],rt=re[Ue]={};for(const ht in Te){const Qe=Te[+ht];if(!Qe||Qe.bitmap.width===0||Qe.bitmap.height===0)continue;const wt={x:0,y:0,w:Qe.bitmap.width+2,h:Qe.bitmap.height+2};pe.push(wt),rt[ht]={rect:wt,metrics:Qe.metrics}}}const{w:_e,h:Ne}=u.p(pe),De=new u.o({width:_e||1,height:Ne||1});for(const Ue in ne){const Te=ne[Ue];for(const rt in Te){const ht=Te[+rt];if(!ht||ht.bitmap.width===0||ht.bitmap.height===0)continue;const Qe=re[Ue][rt].rect;u.o.copy(ht.bitmap,De,{x:0,y:0},{x:Qe.x+1,y:Qe.y+1},ht.bitmap)}}this.image=De,this.positions=re}}u.bl("GlyphAtlas",h);class p{constructor(ne){this.tileID=new u.S(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),this.uid=ne.uid,this.zoom=ne.zoom,this.pixelRatio=ne.pixelRatio,this.tileSize=ne.tileSize,this.source=ne.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ne.showCollisionBoxes,this.collectResourceTiming=!!ne.collectResourceTiming,this.returnDependencies=!!ne.returnDependencies,this.promoteId=ne.promoteId,this.inFlightDependencies=[]}parse(ne,re,pe,_e){return u._(this,void 0,void 0,function*(){this.status="parsing",this.data=ne,this.collisionBoxArray=new u.a5;const Ne=new u.bm(Object.keys(ne.layers).sort()),De=new u.bn(this.tileID,this.promoteId);De.bucketLayerIDs=[];const Ue={},Te={featureIndex:De,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:pe},rt=re.familiesBySource[this.source];for(const sr in rt){const kr=ne.layers[sr];if(!kr)continue;kr.version===1&&u.w(`Vector tile source "${this.source}" layer "${sr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Er=Ne.encode(sr),cn=[];for(let gn=0;gn<kr.length;gn++){const wn=kr.feature(gn),oi=De.getId(wn,sr);cn.push({feature:wn,id:oi,index:gn,sourceLayerIndex:Er})}for(const gn of rt[sr]){const wn=gn[0];wn.source!==this.source&&u.w(`layer.source = ${wn.source} does not equal this.source = ${this.source}`),wn.minzoom&&this.zoom<Math.floor(wn.minzoom)||wn.maxzoom&&this.zoom>=wn.maxzoom||wn.visibility!=="none"&&(g(gn,this.zoom,pe),(Ue[wn.id]=wn.createBucket({index:De.bucketLayerIDs.length,layers:gn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Er,sourceID:this.source})).populate(cn,Te,this.tileID.canonical),De.bucketLayerIDs.push(gn.map(oi=>oi.id)))}}const ht=u.aF(Te.glyphDependencies,sr=>Object.keys(sr).map(Number));this.inFlightDependencies.forEach(sr=>sr==null?void 0:sr.abort()),this.inFlightDependencies=[];let Qe=Promise.resolve({});if(Object.keys(ht).length){const sr=new AbortController;this.inFlightDependencies.push(sr),Qe=_e.sendAsync({type:"GG",data:{stacks:ht,source:this.source,tileID:this.tileID,type:"glyphs"}},sr)}const wt=Object.keys(Te.iconDependencies);let At=Promise.resolve({});if(wt.length){const sr=new AbortController;this.inFlightDependencies.push(sr),At=_e.sendAsync({type:"GI",data:{icons:wt,source:this.source,tileID:this.tileID,type:"icons"}},sr)}const Ft=Object.keys(Te.patternDependencies);let yr=Promise.resolve({});if(Ft.length){const sr=new AbortController;this.inFlightDependencies.push(sr),yr=_e.sendAsync({type:"GI",data:{icons:Ft,source:this.source,tileID:this.tileID,type:"patterns"}},sr)}const[ir,_r,pr]=yield Promise.all([Qe,At,yr]),Tr=new h(ir),wr=new u.bo(_r,pr);for(const sr in Ue){const kr=Ue[sr];kr instanceof u.a6?(g(kr.layers,this.zoom,pe),u.bp({bucket:kr,glyphMap:ir,glyphPositions:Tr.positions,imageMap:_r,imagePositions:wr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):kr.hasPattern&&(kr instanceof u.bq||kr instanceof u.br||kr instanceof u.bs)&&(g(kr.layers,this.zoom,pe),kr.addFeatures(Te,this.tileID.canonical,wr.patternPositions))}return this.status="done",{buckets:Object.values(Ue).filter(sr=>!sr.isEmpty()),featureIndex:De,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Tr.image,imageAtlas:wr,glyphMap:this.returnDependencies?ir:null,iconMap:this.returnDependencies?_r:null,glyphPositions:this.returnDependencies?Tr.positions:null}})}}function g(we,ne,re){const pe=new u.z(ne);for(const _e of we)_e.recalculate(pe,re)}class v{constructor(ne,re,pe){this.actor=ne,this.layerIndex=re,this.availableImages=pe,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(ne,re){return u._(this,void 0,void 0,function*(){const pe=yield u.l(ne.request,re);try{return{vectorTile:new u.bt.VectorTile(new u.bu(pe.data)),rawData:pe.data,cacheControl:pe.cacheControl,expires:pe.expires}}catch(_e){const Ne=new Uint8Array(pe.data);let De=`Unable to parse the tile at ${ne.request.url}, `;throw De+=Ne[0]===31&&Ne[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${_e.message}`,new Error(De)}})}loadTile(ne){return u._(this,void 0,void 0,function*(){const re=ne.uid,pe=!!(ne&&ne.request&&ne.request.collectResourceTiming)&&new u.bv(ne.request),_e=new p(ne);this.loading[re]=_e;const Ne=new AbortController;_e.abort=Ne;try{const De=yield this.loadVectorTile(ne,Ne);if(delete this.loading[re],!De)return null;const Ue=De.rawData,Te={};De.expires&&(Te.expires=De.expires),De.cacheControl&&(Te.cacheControl=De.cacheControl);const rt={};if(pe){const Qe=pe.finish();Qe&&(rt.resourceTiming=JSON.parse(JSON.stringify(Qe)))}_e.vectorTile=De.vectorTile;const ht=_e.parse(De.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[re]=_e,this.fetching[re]={rawTileData:Ue,cacheControl:Te,resourceTiming:rt};try{const Qe=yield ht;return u.e({rawTileData:Ue.slice(0)},Qe,Te,rt)}finally{delete this.fetching[re]}}catch(De){throw delete this.loading[re],_e.status="done",this.loaded[re]=_e,De}})}reloadTile(ne){return u._(this,void 0,void 0,function*(){const re=ne.uid;if(!this.loaded||!this.loaded[re])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const pe=this.loaded[re];if(pe.showCollisionBoxes=ne.showCollisionBoxes,pe.status==="parsing"){const _e=yield pe.parse(pe.vectorTile,this.layerIndex,this.availableImages,this.actor);let Ne;if(this.fetching[re]){const{rawTileData:De,cacheControl:Ue,resourceTiming:Te}=this.fetching[re];delete this.fetching[re],Ne=u.e({rawTileData:De.slice(0)},_e,Ue,Te)}else Ne=_e;return Ne}if(pe.status==="done"&&pe.vectorTile)return pe.parse(pe.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(ne){return u._(this,void 0,void 0,function*(){const re=this.loading,pe=ne.uid;re&&re[pe]&&re[pe].abort&&(re[pe].abort.abort(),delete re[pe])})}removeTile(ne){return u._(this,void 0,void 0,function*(){this.loaded&&this.loaded[ne.uid]&&delete this.loaded[ne.uid]})}}class x{constructor(){this.loaded={}}loadTile(ne){return u._(this,void 0,void 0,function*(){const{uid:re,encoding:pe,rawImageData:_e,redFactor:Ne,greenFactor:De,blueFactor:Ue,baseShift:Te}=ne,rt=_e.width+2,ht=_e.height+2,Qe=u.b(_e)?new u.R({width:rt,height:ht},yield u.bw(_e,-1,-1,rt,ht)):_e,wt=new u.bx(re,Qe,pe,Ne,De,Ue,Te);return this.loaded=this.loaded||{},this.loaded[re]=wt,wt})}removeTile(ne){const re=this.loaded,pe=ne.uid;re&&re[pe]&&delete re[pe]}}function S(we,ne){if(we.length!==0){P(we[0],ne);for(var re=1;re<we.length;re++)P(we[re],!ne)}}function P(we,ne){for(var re=0,pe=0,_e=0,Ne=we.length,De=Ne-1;_e<Ne;De=_e++){var Ue=(we[_e][0]-we[De][0])*(we[De][1]+we[_e][1]),Te=re+Ue;pe+=Math.abs(re)>=Math.abs(Ue)?re-Te+Ue:Ue-Te+re,re=Te}re+pe>=0!=!!ne&&we.reverse()}var N=u.by(function we(ne,re){var pe,_e=ne&&ne.type;if(_e==="FeatureCollection")for(pe=0;pe<ne.features.length;pe++)we(ne.features[pe],re);else if(_e==="GeometryCollection")for(pe=0;pe<ne.geometries.length;pe++)we(ne.geometries[pe],re);else if(_e==="Feature")we(ne.geometry,re);else if(_e==="Polygon")S(ne.coordinates,re);else if(_e==="MultiPolygon")for(pe=0;pe<ne.coordinates.length;pe++)S(ne.coordinates[pe],re);return ne});const M=u.bt.VectorTileFeature.prototype.toGeoJSON;var I={exports:{}},A=u.bz,D=u.bt.VectorTileFeature,j=V;function V(we,ne){this.options=ne||{},this.features=we,this.length=we.length}function U(we,ne){this.id=typeof we.id=="number"?we.id:void 0,this.type=we.type,this.rawGeometry=we.type===1?[we.geometry]:we.geometry,this.properties=we.tags,this.extent=ne||4096}V.prototype.feature=function(we){return new U(this.features[we],this.options.extent)},U.prototype.loadGeometry=function(){var we=this.rawGeometry;this.geometry=[];for(var ne=0;ne<we.length;ne++){for(var re=we[ne],pe=[],_e=0;_e<re.length;_e++)pe.push(new A(re[_e][0],re[_e][1]));this.geometry.push(pe)}return this.geometry},U.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var we=this.geometry,ne=1/0,re=-1/0,pe=1/0,_e=-1/0,Ne=0;Ne<we.length;Ne++)for(var De=we[Ne],Ue=0;Ue<De.length;Ue++){var Te=De[Ue];ne=Math.min(ne,Te.x),re=Math.max(re,Te.x),pe=Math.min(pe,Te.y),_e=Math.max(_e,Te.y)}return[ne,pe,re,_e]},U.prototype.toGeoJSON=D.prototype.toGeoJSON;var $=u.bA,W=j;function X(we){var ne=new $;return function(re,pe){for(var _e in re.layers)pe.writeMessage(3,J,re.layers[_e])}(we,ne),ne.finish()}function J(we,ne){var re;ne.writeVarintField(15,we.version||1),ne.writeStringField(1,we.name||""),ne.writeVarintField(5,we.extent||4096);var pe={keys:[],values:[],keycache:{},valuecache:{}};for(re=0;re<we.length;re++)pe.feature=we.feature(re),ne.writeMessage(2,Z,pe);var _e=pe.keys;for(re=0;re<_e.length;re++)ne.writeStringField(3,_e[re]);var Ne=pe.values;for(re=0;re<Ne.length;re++)ne.writeMessage(4,ie,Ne[re])}function Z(we,ne){var re=we.feature;re.id!==void 0&&ne.writeVarintField(1,re.id),ne.writeMessage(2,K,we),ne.writeVarintField(3,re.type),ne.writeMessage(4,oe,re)}function K(we,ne){var re=we.feature,pe=we.keys,_e=we.values,Ne=we.keycache,De=we.valuecache;for(var Ue in re.properties){var Te=re.properties[Ue],rt=Ne[Ue];if(Te!==null){rt===void 0&&(pe.push(Ue),Ne[Ue]=rt=pe.length-1),ne.writeVarint(rt);var ht=typeof Te;ht!=="string"&&ht!=="boolean"&&ht!=="number"&&(Te=JSON.stringify(Te));var Qe=ht+":"+Te,wt=De[Qe];wt===void 0&&(_e.push(Te),De[Qe]=wt=_e.length-1),ne.writeVarint(wt)}}}function Y(we,ne){return(ne<<3)+(7&we)}function G(we){return we<<1^we>>31}function oe(we,ne){for(var re=we.loadGeometry(),pe=we.type,_e=0,Ne=0,De=re.length,Ue=0;Ue<De;Ue++){var Te=re[Ue],rt=1;pe===1&&(rt=Te.length),ne.writeVarint(Y(1,rt));for(var ht=pe===3?Te.length-1:Te.length,Qe=0;Qe<ht;Qe++){Qe===1&&pe!==1&&ne.writeVarint(Y(2,ht-1));var wt=Te[Qe].x-_e,At=Te[Qe].y-Ne;ne.writeVarint(G(wt)),ne.writeVarint(G(At)),_e+=wt,Ne+=At}pe===3&&ne.writeVarint(Y(7,1))}}function ie(we,ne){var re=typeof we;re==="string"?ne.writeStringField(1,we):re==="boolean"?ne.writeBooleanField(7,we):re==="number"&&(we%1!=0?ne.writeDoubleField(3,we):we<0?ne.writeSVarintField(6,we):ne.writeVarintField(5,we))}I.exports=X,I.exports.fromVectorTileJs=X,I.exports.fromGeojsonVt=function(we,ne){ne=ne||{};var re={};for(var pe in we)re[pe]=new W(we[pe].features,ne),re[pe].name=pe,re[pe].version=ne.version,re[pe].extent=ne.extent;return X({layers:re})},I.exports.GeoJSONWrapper=W;var ce=u.by(I.exports);const fe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:we=>we},de=Math.fround||(be=new Float32Array(1),we=>(be[0]=+we,be[0]));var be;const ge=3,xe=5,Le=6;class Oe{constructor(ne){this.options=Object.assign(Object.create(fe),ne),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ne){const{log:re,minZoom:pe,maxZoom:_e}=this.options;re&&console.time("total time");const Ne=`prepare ${ne.length} points`;re&&console.time(Ne),this.points=ne;const De=[];for(let Te=0;Te<ne.length;Te++){const rt=ne[Te];if(!rt.geometry)continue;const[ht,Qe]=rt.geometry.coordinates,wt=de(nt(ht)),At=de(mt(Qe));De.push(wt,At,1/0,Te,-1,1),this.options.reduce&&De.push(0)}let Ue=this.trees[_e+1]=this._createTree(De);re&&console.timeEnd(Ne);for(let Te=_e;Te>=pe;Te--){const rt=+Date.now();Ue=this.trees[Te]=this._createTree(this._cluster(Ue,Te)),re&&console.log("z%d: %d clusters in %dms",Te,Ue.numItems,+Date.now()-rt)}return re&&console.timeEnd("total time"),this}getClusters(ne,re){let pe=((ne[0]+180)%360+360)%360-180;const _e=Math.max(-90,Math.min(90,ne[1]));let Ne=ne[2]===180?180:((ne[2]+180)%360+360)%360-180;const De=Math.max(-90,Math.min(90,ne[3]));if(ne[2]-ne[0]>=360)pe=-180,Ne=180;else if(pe>Ne){const Qe=this.getClusters([pe,_e,180,De],re),wt=this.getClusters([-180,_e,Ne,De],re);return Qe.concat(wt)}const Ue=this.trees[this._limitZoom(re)],Te=Ue.range(nt(pe),mt(De),nt(Ne),mt(_e)),rt=Ue.data,ht=[];for(const Qe of Te){const wt=this.stride*Qe;ht.push(rt[wt+xe]>1?Fe(rt,wt,this.clusterProps):this.points[rt[wt+ge]])}return ht}getChildren(ne){const re=this._getOriginId(ne),pe=this._getOriginZoom(ne),_e="No cluster with the specified id.",Ne=this.trees[pe];if(!Ne)throw new Error(_e);const De=Ne.data;if(re*this.stride>=De.length)throw new Error(_e);const Ue=this.options.radius/(this.options.extent*Math.pow(2,pe-1)),Te=Ne.within(De[re*this.stride],De[re*this.stride+1],Ue),rt=[];for(const ht of Te){const Qe=ht*this.stride;De[Qe+4]===ne&&rt.push(De[Qe+xe]>1?Fe(De,Qe,this.clusterProps):this.points[De[Qe+ge]])}if(rt.length===0)throw new Error(_e);return rt}getLeaves(ne,re,pe){const _e=[];return this._appendLeaves(_e,ne,re=re||10,pe=pe||0,0),_e}getTile(ne,re,pe){const _e=this.trees[this._limitZoom(ne)],Ne=Math.pow(2,ne),{extent:De,radius:Ue}=this.options,Te=Ue/De,rt=(pe-Te)/Ne,ht=(pe+1+Te)/Ne,Qe={features:[]};return this._addTileFeatures(_e.range((re-Te)/Ne,rt,(re+1+Te)/Ne,ht),_e.data,re,pe,Ne,Qe),re===0&&this._addTileFeatures(_e.range(1-Te/Ne,rt,1,ht),_e.data,Ne,pe,Ne,Qe),re===Ne-1&&this._addTileFeatures(_e.range(0,rt,Te/Ne,ht),_e.data,-1,pe,Ne,Qe),Qe.features.length?Qe:null}getClusterExpansionZoom(ne){let re=this._getOriginZoom(ne)-1;for(;re<=this.options.maxZoom;){const pe=this.getChildren(ne);if(re++,pe.length!==1)break;ne=pe[0].properties.cluster_id}return re}_appendLeaves(ne,re,pe,_e,Ne){const De=this.getChildren(re);for(const Ue of De){const Te=Ue.properties;if(Te&&Te.cluster?Ne+Te.point_count<=_e?Ne+=Te.point_count:Ne=this._appendLeaves(ne,Te.cluster_id,pe,_e,Ne):Ne<_e?Ne++:ne.push(Ue),ne.length===pe)break}return Ne}_createTree(ne){const re=new u.av(ne.length/this.stride|0,this.options.nodeSize,Float32Array);for(let pe=0;pe<ne.length;pe+=this.stride)re.add(ne[pe],ne[pe+1]);return re.finish(),re.data=ne,re}_addTileFeatures(ne,re,pe,_e,Ne,De){for(const Ue of ne){const Te=Ue*this.stride,rt=re[Te+xe]>1;let ht,Qe,wt;if(rt)ht=et(re,Te,this.clusterProps),Qe=re[Te],wt=re[Te+1];else{const yr=this.points[re[Te+ge]];ht=yr.properties;const[ir,_r]=yr.geometry.coordinates;Qe=nt(ir),wt=mt(_r)}const At={type:1,geometry:[[Math.round(this.options.extent*(Qe*Ne-pe)),Math.round(this.options.extent*(wt*Ne-_e))]],tags:ht};let Ft;Ft=rt||this.options.generateId?re[Te+ge]:this.points[re[Te+ge]].id,Ft!==void 0&&(At.id=Ft),De.features.push(At)}}_limitZoom(ne){return Math.max(this.options.minZoom,Math.min(Math.floor(+ne),this.options.maxZoom+1))}_cluster(ne,re){const{radius:pe,extent:_e,reduce:Ne,minPoints:De}=this.options,Ue=pe/(_e*Math.pow(2,re)),Te=ne.data,rt=[],ht=this.stride;for(let Qe=0;Qe<Te.length;Qe+=ht){if(Te[Qe+2]<=re)continue;Te[Qe+2]=re;const wt=Te[Qe],At=Te[Qe+1],Ft=ne.within(Te[Qe],Te[Qe+1],Ue),yr=Te[Qe+xe];let ir=yr;for(const _r of Ft){const pr=_r*ht;Te[pr+2]>re&&(ir+=Te[pr+xe])}if(ir>yr&&ir>=De){let _r,pr=wt*yr,Tr=At*yr,wr=-1;const sr=((Qe/ht|0)<<5)+(re+1)+this.points.length;for(const kr of Ft){const Er=kr*ht;if(Te[Er+2]<=re)continue;Te[Er+2]=re;const cn=Te[Er+xe];pr+=Te[Er]*cn,Tr+=Te[Er+1]*cn,Te[Er+4]=sr,Ne&&(_r||(_r=this._map(Te,Qe,!0),wr=this.clusterProps.length,this.clusterProps.push(_r)),Ne(_r,this._map(Te,Er)))}Te[Qe+4]=sr,rt.push(pr/ir,Tr/ir,1/0,sr,-1,ir),Ne&&rt.push(wr)}else{for(let _r=0;_r<ht;_r++)rt.push(Te[Qe+_r]);if(ir>1)for(const _r of Ft){const pr=_r*ht;if(!(Te[pr+2]<=re)){Te[pr+2]=re;for(let Tr=0;Tr<ht;Tr++)rt.push(Te[pr+Tr])}}}}return rt}_getOriginId(ne){return ne-this.points.length>>5}_getOriginZoom(ne){return(ne-this.points.length)%32}_map(ne,re,pe){if(ne[re+xe]>1){const De=this.clusterProps[ne[re+Le]];return pe?Object.assign({},De):De}const _e=this.points[ne[re+ge]].properties,Ne=this.options.map(_e);return pe&&Ne===_e?Object.assign({},Ne):Ne}}function Fe(we,ne,re){return{type:"Feature",id:we[ne+ge],properties:et(we,ne,re),geometry:{type:"Point",coordinates:[(pe=we[ne],360*(pe-.5)),it(we[ne+1])]}};var pe}function et(we,ne,re){const pe=we[ne+xe],_e=pe>=1e4?`${Math.round(pe/1e3)}k`:pe>=1e3?Math.round(pe/100)/10+"k":pe,Ne=we[ne+Le],De=Ne===-1?{}:Object.assign({},re[Ne]);return Object.assign(De,{cluster:!0,cluster_id:we[ne+ge],point_count:pe,point_count_abbreviated:_e})}function nt(we){return we/360+.5}function mt(we){const ne=Math.sin(we*Math.PI/180),re=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return re<0?0:re>1?1:re}function it(we){const ne=(180-360*we)*Math.PI/180;return 360*Math.atan(Math.exp(ne))/Math.PI-90}function ze(we,ne,re,pe){let _e=pe;const Ne=ne+(re-ne>>1);let De,Ue=re-ne;const Te=we[ne],rt=we[ne+1],ht=we[re],Qe=we[re+1];for(let wt=ne+3;wt<re;wt+=3){const At=He(we[wt],we[wt+1],Te,rt,ht,Qe);if(At>_e)De=wt,_e=At;else if(At===_e){const Ft=Math.abs(wt-Ne);Ft<Ue&&(De=wt,Ue=Ft)}}_e>pe&&(De-ne>3&&ze(we,ne,De,pe),we[De+2]=_e,re-De>3&&ze(we,De,re,pe))}function He(we,ne,re,pe,_e,Ne){let De=_e-re,Ue=Ne-pe;if(De!==0||Ue!==0){const Te=((we-re)*De+(ne-pe)*Ue)/(De*De+Ue*Ue);Te>1?(re=_e,pe=Ne):Te>0&&(re+=De*Te,pe+=Ue*Te)}return De=we-re,Ue=ne-pe,De*De+Ue*Ue}function We(we,ne,re,pe){const _e={id:we??null,type:ne,geometry:re,tags:pe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ne==="Point"||ne==="MultiPoint"||ne==="LineString")ot(_e,re);else if(ne==="Polygon")ot(_e,re[0]);else if(ne==="MultiLineString")for(const Ne of re)ot(_e,Ne);else if(ne==="MultiPolygon")for(const Ne of re)ot(_e,Ne[0]);return _e}function ot(we,ne){for(let re=0;re<ne.length;re+=3)we.minX=Math.min(we.minX,ne[re]),we.minY=Math.min(we.minY,ne[re+1]),we.maxX=Math.max(we.maxX,ne[re]),we.maxY=Math.max(we.maxY,ne[re+1])}function xt(we,ne,re,pe){if(!ne.geometry)return;const _e=ne.geometry.coordinates;if(_e&&_e.length===0)return;const Ne=ne.geometry.type,De=Math.pow(re.tolerance/((1<<re.maxZoom)*re.extent),2);let Ue=[],Te=ne.id;if(re.promoteId?Te=ne.properties[re.promoteId]:re.generateId&&(Te=pe||0),Ne==="Point")Tt(_e,Ue);else if(Ne==="MultiPoint")for(const rt of _e)Tt(rt,Ue);else if(Ne==="LineString")$e(_e,Ue,De,!1);else if(Ne==="MultiLineString"){if(re.lineMetrics){for(const rt of _e)Ue=[],$e(rt,Ue,De,!1),we.push(We(Te,"LineString",Ue,ne.properties));return}Xe(_e,Ue,De,!1)}else if(Ne==="Polygon")Xe(_e,Ue,De,!0);else{if(Ne!=="MultiPolygon"){if(Ne==="GeometryCollection"){for(const rt of ne.geometry.geometries)xt(we,{id:Te,geometry:rt,properties:ne.properties},re,pe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const rt of _e){const ht=[];Xe(rt,ht,De,!0),Ue.push(ht)}}we.push(We(Te,Ne,Ue,ne.properties))}function Tt(we,ne){ne.push(Pe(we[0]),Ye(we[1]),0)}function $e(we,ne,re,pe){let _e,Ne,De=0;for(let Te=0;Te<we.length;Te++){const rt=Pe(we[Te][0]),ht=Ye(we[Te][1]);ne.push(rt,ht,0),Te>0&&(De+=pe?(_e*ht-rt*Ne)/2:Math.sqrt(Math.pow(rt-_e,2)+Math.pow(ht-Ne,2))),_e=rt,Ne=ht}const Ue=ne.length-3;ne[2]=1,ze(ne,0,Ue,re),ne[Ue+2]=1,ne.size=Math.abs(De),ne.start=0,ne.end=ne.size}function Xe(we,ne,re,pe){for(let _e=0;_e<we.length;_e++){const Ne=[];$e(we[_e],Ne,re,pe),ne.push(Ne)}}function Pe(we){return we/360+.5}function Ye(we){const ne=Math.sin(we*Math.PI/180),re=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return re<0?0:re>1?1:re}function at(we,ne,re,pe,_e,Ne,De,Ue){if(pe/=ne,Ne>=(re/=ne)&&De<pe)return we;if(De<re||Ne>=pe)return null;const Te=[];for(const rt of we){const ht=rt.geometry;let Qe=rt.type;const wt=_e===0?rt.minX:rt.minY,At=_e===0?rt.maxX:rt.maxY;if(wt>=re&&At<pe){Te.push(rt);continue}if(At<re||wt>=pe)continue;let Ft=[];if(Qe==="Point"||Qe==="MultiPoint")bt(ht,Ft,re,pe,_e);else if(Qe==="LineString")Et(ht,Ft,re,pe,_e,!1,Ue.lineMetrics);else if(Qe==="MultiLineString")Bt(ht,Ft,re,pe,_e,!1);else if(Qe==="Polygon")Bt(ht,Ft,re,pe,_e,!0);else if(Qe==="MultiPolygon")for(const yr of ht){const ir=[];Bt(yr,ir,re,pe,_e,!0),ir.length&&Ft.push(ir)}if(Ft.length){if(Ue.lineMetrics&&Qe==="LineString"){for(const yr of Ft)Te.push(We(rt.id,Qe,yr,rt.tags));continue}Qe!=="LineString"&&Qe!=="MultiLineString"||(Ft.length===1?(Qe="LineString",Ft=Ft[0]):Qe="MultiLineString"),Qe!=="Point"&&Qe!=="MultiPoint"||(Qe=Ft.length===3?"Point":"MultiPoint"),Te.push(We(rt.id,Qe,Ft,rt.tags))}}return Te.length?Te:null}function bt(we,ne,re,pe,_e){for(let Ne=0;Ne<we.length;Ne+=3){const De=we[Ne+_e];De>=re&&De<=pe&&Mt(ne,we[Ne],we[Ne+1],we[Ne+2])}}function Et(we,ne,re,pe,_e,Ne,De){let Ue=Vt(we);const Te=_e===0?cr:ar;let rt,ht,Qe=we.start;for(let ir=0;ir<we.length-3;ir+=3){const _r=we[ir],pr=we[ir+1],Tr=we[ir+2],wr=we[ir+3],sr=we[ir+4],kr=_e===0?_r:pr,Er=_e===0?wr:sr;let cn=!1;De&&(rt=Math.sqrt(Math.pow(_r-wr,2)+Math.pow(pr-sr,2))),kr<re?Er>re&&(ht=Te(Ue,_r,pr,wr,sr,re),De&&(Ue.start=Qe+rt*ht)):kr>pe?Er<pe&&(ht=Te(Ue,_r,pr,wr,sr,pe),De&&(Ue.start=Qe+rt*ht)):Mt(Ue,_r,pr,Tr),Er<re&&kr>=re&&(ht=Te(Ue,_r,pr,wr,sr,re),cn=!0),Er>pe&&kr<=pe&&(ht=Te(Ue,_r,pr,wr,sr,pe),cn=!0),!Ne&&cn&&(De&&(Ue.end=Qe+rt*ht),ne.push(Ue),Ue=Vt(we)),De&&(Qe+=rt)}let wt=we.length-3;const At=we[wt],Ft=we[wt+1],yr=_e===0?At:Ft;yr>=re&&yr<=pe&&Mt(Ue,At,Ft,we[wt+2]),wt=Ue.length-3,Ne&&wt>=3&&(Ue[wt]!==Ue[0]||Ue[wt+1]!==Ue[1])&&Mt(Ue,Ue[0],Ue[1],Ue[2]),Ue.length&&ne.push(Ue)}function Vt(we){const ne=[];return ne.size=we.size,ne.start=we.start,ne.end=we.end,ne}function Bt(we,ne,re,pe,_e,Ne){for(const De of we)Et(De,ne,re,pe,_e,Ne,!1)}function Mt(we,ne,re,pe){we.push(ne,re,pe)}function cr(we,ne,re,pe,_e,Ne){const De=(Ne-ne)/(pe-ne);return Mt(we,Ne,re+(_e-re)*De,1),De}function ar(we,ne,re,pe,_e,Ne){const De=(Ne-re)/(_e-re);return Mt(we,ne+(pe-ne)*De,Ne,1),De}function ft(we,ne){const re=[];for(let pe=0;pe<we.length;pe++){const _e=we[pe],Ne=_e.type;let De;if(Ne==="Point"||Ne==="MultiPoint"||Ne==="LineString")De=fr(_e.geometry,ne);else if(Ne==="MultiLineString"||Ne==="Polygon"){De=[];for(const Ue of _e.geometry)De.push(fr(Ue,ne))}else if(Ne==="MultiPolygon"){De=[];for(const Ue of _e.geometry){const Te=[];for(const rt of Ue)Te.push(fr(rt,ne));De.push(Te)}}re.push(We(_e.id,Ne,De,_e.tags))}return re}function fr(we,ne){const re=[];re.size=we.size,we.start!==void 0&&(re.start=we.start,re.end=we.end);for(let pe=0;pe<we.length;pe+=3)re.push(we[pe]+ne,we[pe+1],we[pe+2]);return re}function Xt(we,ne){if(we.transformed)return we;const re=1<<we.z,pe=we.x,_e=we.y;for(const Ne of we.features){const De=Ne.geometry,Ue=Ne.type;if(Ne.geometry=[],Ue===1)for(let Te=0;Te<De.length;Te+=2)Ne.geometry.push(kt(De[Te],De[Te+1],ne,re,pe,_e));else for(let Te=0;Te<De.length;Te++){const rt=[];for(let ht=0;ht<De[Te].length;ht+=2)rt.push(kt(De[Te][ht],De[Te][ht+1],ne,re,pe,_e));Ne.geometry.push(rt)}}return we.transformed=!0,we}function kt(we,ne,re,pe,_e,Ne){return[Math.round(re*(we*pe-_e)),Math.round(re*(ne*pe-Ne))]}function dt(we,ne,re,pe,_e){const Ne=ne===_e.maxZoom?0:_e.tolerance/((1<<ne)*_e.extent),De={features:[],numPoints:0,numSimplified:0,numFeatures:we.length,source:null,x:re,y:pe,z:ne,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ue of we)le(De,Ue,Ne,_e);return De}function le(we,ne,re,pe){const _e=ne.geometry,Ne=ne.type,De=[];if(we.minX=Math.min(we.minX,ne.minX),we.minY=Math.min(we.minY,ne.minY),we.maxX=Math.max(we.maxX,ne.maxX),we.maxY=Math.max(we.maxY,ne.maxY),Ne==="Point"||Ne==="MultiPoint")for(let Ue=0;Ue<_e.length;Ue+=3)De.push(_e[Ue],_e[Ue+1]),we.numPoints++,we.numSimplified++;else if(Ne==="LineString")Be(De,_e,we,re,!1,!1);else if(Ne==="MultiLineString"||Ne==="Polygon")for(let Ue=0;Ue<_e.length;Ue++)Be(De,_e[Ue],we,re,Ne==="Polygon",Ue===0);else if(Ne==="MultiPolygon")for(let Ue=0;Ue<_e.length;Ue++){const Te=_e[Ue];for(let rt=0;rt<Te.length;rt++)Be(De,Te[rt],we,re,!0,rt===0)}if(De.length){let Ue=ne.tags||null;if(Ne==="LineString"&&pe.lineMetrics){Ue={};for(const rt in ne.tags)Ue[rt]=ne.tags[rt];Ue.mapbox_clip_start=_e.start/_e.size,Ue.mapbox_clip_end=_e.end/_e.size}const Te={geometry:De,type:Ne==="Polygon"||Ne==="MultiPolygon"?3:Ne==="LineString"||Ne==="MultiLineString"?2:1,tags:Ue};ne.id!==null&&(Te.id=ne.id),we.features.push(Te)}}function Be(we,ne,re,pe,_e,Ne){const De=pe*pe;if(pe>0&&ne.size<(_e?De:pe))return void(re.numPoints+=ne.length/3);const Ue=[];for(let Te=0;Te<ne.length;Te+=3)(pe===0||ne[Te+2]>De)&&(re.numSimplified++,Ue.push(ne[Te],ne[Te+1])),re.numPoints++;_e&&function(Te,rt){let ht=0;for(let Qe=0,wt=Te.length,At=wt-2;Qe<wt;At=Qe,Qe+=2)ht+=(Te[Qe]-Te[At])*(Te[Qe+1]+Te[At+1]);if(ht>0===rt)for(let Qe=0,wt=Te.length;Qe<wt/2;Qe+=2){const At=Te[Qe],Ft=Te[Qe+1];Te[Qe]=Te[wt-2-Qe],Te[Qe+1]=Te[wt-1-Qe],Te[wt-2-Qe]=At,Te[wt-1-Qe]=Ft}}(Ue,Ne),we.push(Ue)}const qe={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class st{constructor(ne,re){const pe=(re=this.options=function(Ne,De){for(const Ue in De)Ne[Ue]=De[Ue];return Ne}(Object.create(qe),re)).debug;if(pe&&console.time("preprocess data"),re.maxZoom<0||re.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(re.promoteId&&re.generateId)throw new Error("promoteId and generateId cannot be used together.");let _e=function(Ne,De){const Ue=[];if(Ne.type==="FeatureCollection")for(let Te=0;Te<Ne.features.length;Te++)xt(Ue,Ne.features[Te],De,Te);else xt(Ue,Ne.type==="Feature"?Ne:{geometry:Ne},De);return Ue}(ne,re);this.tiles={},this.tileCoords=[],pe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",re.indexMaxZoom,re.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),_e=function(Ne,De){const Ue=De.buffer/De.extent;let Te=Ne;const rt=at(Ne,1,-1-Ue,Ue,0,-1,2,De),ht=at(Ne,1,1-Ue,2+Ue,0,-1,2,De);return(rt||ht)&&(Te=at(Ne,1,-Ue,1+Ue,0,-1,2,De)||[],rt&&(Te=ft(rt,1).concat(Te)),ht&&(Te=Te.concat(ft(ht,-1)))),Te}(_e,re),_e.length&&this.splitTile(_e,0,0,0),pe&&(_e.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ne,re,pe,_e,Ne,De,Ue){const Te=[ne,re,pe,_e],rt=this.options,ht=rt.debug;for(;Te.length;){_e=Te.pop(),pe=Te.pop(),re=Te.pop(),ne=Te.pop();const Qe=1<<re,wt=ut(re,pe,_e);let At=this.tiles[wt];if(!At&&(ht>1&&console.time("creation"),At=this.tiles[wt]=dt(ne,re,pe,_e,rt),this.tileCoords.push({z:re,x:pe,y:_e}),ht)){ht>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",re,pe,_e,At.numFeatures,At.numPoints,At.numSimplified),console.timeEnd("creation"));const cn=`z${re}`;this.stats[cn]=(this.stats[cn]||0)+1,this.total++}if(At.source=ne,Ne==null){if(re===rt.indexMaxZoom||At.numPoints<=rt.indexMaxPoints)continue}else{if(re===rt.maxZoom||re===Ne)continue;if(Ne!=null){const cn=Ne-re;if(pe!==De>>cn||_e!==Ue>>cn)continue}}if(At.source=null,ne.length===0)continue;ht>1&&console.time("clipping");const Ft=.5*rt.buffer/rt.extent,yr=.5-Ft,ir=.5+Ft,_r=1+Ft;let pr=null,Tr=null,wr=null,sr=null,kr=at(ne,Qe,pe-Ft,pe+ir,0,At.minX,At.maxX,rt),Er=at(ne,Qe,pe+yr,pe+_r,0,At.minX,At.maxX,rt);ne=null,kr&&(pr=at(kr,Qe,_e-Ft,_e+ir,1,At.minY,At.maxY,rt),Tr=at(kr,Qe,_e+yr,_e+_r,1,At.minY,At.maxY,rt),kr=null),Er&&(wr=at(Er,Qe,_e-Ft,_e+ir,1,At.minY,At.maxY,rt),sr=at(Er,Qe,_e+yr,_e+_r,1,At.minY,At.maxY,rt),Er=null),ht>1&&console.timeEnd("clipping"),Te.push(pr||[],re+1,2*pe,2*_e),Te.push(Tr||[],re+1,2*pe,2*_e+1),Te.push(wr||[],re+1,2*pe+1,2*_e),Te.push(sr||[],re+1,2*pe+1,2*_e+1)}}getTile(ne,re,pe){ne=+ne,re=+re,pe=+pe;const _e=this.options,{extent:Ne,debug:De}=_e;if(ne<0||ne>24)return null;const Ue=1<<ne,Te=ut(ne,re=re+Ue&Ue-1,pe);if(this.tiles[Te])return Xt(this.tiles[Te],Ne);De>1&&console.log("drilling down to z%d-%d-%d",ne,re,pe);let rt,ht=ne,Qe=re,wt=pe;for(;!rt&&ht>0;)ht--,Qe>>=1,wt>>=1,rt=this.tiles[ut(ht,Qe,wt)];return rt&&rt.source?(De>1&&(console.log("found parent tile z%d-%d-%d",ht,Qe,wt),console.time("drilling down")),this.splitTile(rt.source,ht,Qe,wt,ne,re,pe),De>1&&console.timeEnd("drilling down"),this.tiles[Te]?Xt(this.tiles[Te],Ne):null):null}}function ut(we,ne,re){return 32*((1<<we)*re+ne)+we}function vt(we,ne){return ne?we.properties[ne]:we.id}function gt(we,ne){if(we==null)return!0;if(we.type==="Feature")return vt(we,ne)!=null;if(we.type==="FeatureCollection"){const re=new Set;for(const pe of we.features){const _e=vt(pe,ne);if(_e==null||re.has(_e))return!1;re.add(_e)}return!0}return!1}function Ut(we,ne){const re=new Map;if(we!=null)if(we.type==="Feature")re.set(vt(we,ne),we);else for(const pe of we.features)re.set(vt(pe,ne),pe);return re}class Ot extends v{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(ne,re){return u._(this,void 0,void 0,function*(){const pe=ne.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const _e=this._geoJSONIndex.getTile(pe.z,pe.x,pe.y);if(!_e)return null;const Ne=new class{constructor(Ue){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=u.X,this.length=Ue.length,this._features=Ue}feature(Ue){return new class{constructor(Te){this._feature=Te,this.extent=u.X,this.type=Te.type,this.properties=Te.tags,"id"in Te&&!isNaN(Te.id)&&(this.id=parseInt(Te.id,10))}loadGeometry(){if(this._feature.type===1){const Te=[];for(const rt of this._feature.geometry)Te.push([new u.P(rt[0],rt[1])]);return Te}{const Te=[];for(const rt of this._feature.geometry){const ht=[];for(const Qe of rt)ht.push(new u.P(Qe[0],Qe[1]));Te.push(ht)}return Te}}toGeoJSON(Te,rt,ht){return M.call(this,Te,rt,ht)}}(this._features[Ue])}}(_e.features);let De=ce(Ne);return De.byteOffset===0&&De.byteLength===De.buffer.byteLength||(De=new Uint8Array(De)),{vectorTile:Ne,rawData:De.buffer}})}loadData(ne){return u._(this,void 0,void 0,function*(){var re;(re=this._pendingRequest)===null||re===void 0||re.abort();const pe=!!(ne&&ne.request&&ne.request.collectResourceTiming)&&new u.bv(ne.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(ne,this._pendingRequest),this._geoJSONIndex=ne.cluster?new Oe(function({superclusterOptions:De,clusterProperties:Ue}){if(!Ue||!De)return De;const Te={},rt={},ht={accumulated:null,zoom:0},Qe={properties:null},wt=Object.keys(Ue);for(const At of wt){const[Ft,yr]=Ue[At],ir=u.bC(yr),_r=u.bC(typeof Ft=="string"?[Ft,["accumulated"],["get",At]]:Ft);Te[At]=ir.value,rt[At]=_r.value}return De.map=At=>{Qe.properties=At;const Ft={};for(const yr of wt)Ft[yr]=Te[yr].evaluate(ht,Qe);return Ft},De.reduce=(At,Ft)=>{Qe.properties=Ft;for(const yr of wt)ht.accumulated=At[yr],At[yr]=rt[yr].evaluate(ht,Qe)},De}(ne)).load((yield this._pendingData).features):(_e=yield this._pendingData,new st(_e,ne.geojsonVtOptions)),this.loaded={};const Ne={};if(pe){const De=pe.finish();De&&(Ne.resourceTiming={},Ne.resourceTiming[ne.source]=JSON.parse(JSON.stringify(De)))}return Ne}catch(Ne){if(delete this._pendingRequest,u.bB(Ne))return{abandoned:!0};throw Ne}var _e})}getData(){return u._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(ne){const re=this.loaded;return re&&re[ne.uid]?super.reloadTile(ne):this.loadTile(ne)}loadAndProcessGeoJSON(ne,re){return u._(this,void 0,void 0,function*(){let pe=yield this.loadGeoJSON(ne,re);if(delete this._pendingRequest,typeof pe!="object")throw new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`);if(N(pe,!0),ne.filter){const _e=u.bC(ne.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(_e.result==="error")throw new Error(_e.value.map(De=>`${De.key}: ${De.message}`).join(", "));pe={type:"FeatureCollection",features:pe.features.filter(De=>_e.value.evaluate({zoom:0},De))}}return pe})}loadGeoJSON(ne,re){return u._(this,void 0,void 0,function*(){const{promoteId:pe}=ne;if(ne.request){const _e=yield u.h(ne.request,re);return this._dataUpdateable=gt(_e.data,pe)?Ut(_e.data,pe):void 0,_e.data}if(typeof ne.data=="string")try{const _e=JSON.parse(ne.data);return this._dataUpdateable=gt(_e,pe)?Ut(_e,pe):void 0,_e}catch{throw new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`)}if(!ne.dataDiff)throw new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${ne.source}`);return function(_e,Ne,De){var Ue,Te,rt,ht;if(Ne.removeAll&&_e.clear(),Ne.remove)for(const Qe of Ne.remove)_e.delete(Qe);if(Ne.add)for(const Qe of Ne.add){const wt=vt(Qe,De);wt!=null&&_e.set(wt,Qe)}if(Ne.update)for(const Qe of Ne.update){let wt=_e.get(Qe.id);if(wt==null)continue;const At=!Qe.removeAllProperties&&(((Ue=Qe.removeProperties)===null||Ue===void 0?void 0:Ue.length)>0||((Te=Qe.addOrUpdateProperties)===null||Te===void 0?void 0:Te.length)>0);if((Qe.newGeometry||Qe.removeAllProperties||At)&&(wt=Object.assign({},wt),_e.set(Qe.id,wt),At&&(wt.properties=Object.assign({},wt.properties))),Qe.newGeometry&&(wt.geometry=Qe.newGeometry),Qe.removeAllProperties)wt.properties={};else if(((rt=Qe.removeProperties)===null||rt===void 0?void 0:rt.length)>0)for(const Ft of Qe.removeProperties)Object.prototype.hasOwnProperty.call(wt.properties,Ft)&&delete wt.properties[Ft];if(((ht=Qe.addOrUpdateProperties)===null||ht===void 0?void 0:ht.length)>0)for(const{key:Ft,value:yr}of Qe.addOrUpdateProperties)wt.properties[Ft]=yr}}(this._dataUpdateable,ne.dataDiff,pe),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(ne){return u._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(ne){return this._geoJSONIndex.getClusterExpansionZoom(ne.clusterId)}getClusterChildren(ne){return this._geoJSONIndex.getChildren(ne.clusterId)}getClusterLeaves(ne){return this._geoJSONIndex.getLeaves(ne.clusterId,ne.limit,ne.offset)}}class Kt{constructor(ne){this.self=ne,this.actor=new u.F(ne),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(re,pe)=>{if(this.externalWorkerSourceTypes[re])throw new Error(`Worker source with name "${re}" already registered.`);this.externalWorkerSourceTypes[re]=pe},this.self.addProtocol=u.bi,this.self.removeProtocol=u.bj,this.self.registerRTLTextPlugin=re=>{if(u.bD.isParsed())throw new Error("RTL text plugin already registered.");u.bD.setMethods(re)},this.actor.registerMessageHandler("LDT",(re,pe)=>this._getDEMWorkerSource(re,pe.source).loadTile(pe)),this.actor.registerMessageHandler("RDT",(re,pe)=>u._(this,void 0,void 0,function*(){this._getDEMWorkerSource(re,pe.source).removeTile(pe)})),this.actor.registerMessageHandler("GCEZ",(re,pe)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(re,pe.type,pe.source).getClusterExpansionZoom(pe)})),this.actor.registerMessageHandler("GCC",(re,pe)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(re,pe.type,pe.source).getClusterChildren(pe)})),this.actor.registerMessageHandler("GCL",(re,pe)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(re,pe.type,pe.source).getClusterLeaves(pe)})),this.actor.registerMessageHandler("LD",(re,pe)=>this._getWorkerSource(re,pe.type,pe.source).loadData(pe)),this.actor.registerMessageHandler("GD",(re,pe)=>this._getWorkerSource(re,pe.type,pe.source).getData()),this.actor.registerMessageHandler("LT",(re,pe)=>this._getWorkerSource(re,pe.type,pe.source).loadTile(pe)),this.actor.registerMessageHandler("RT",(re,pe)=>this._getWorkerSource(re,pe.type,pe.source).reloadTile(pe)),this.actor.registerMessageHandler("AT",(re,pe)=>this._getWorkerSource(re,pe.type,pe.source).abortTile(pe)),this.actor.registerMessageHandler("RMT",(re,pe)=>this._getWorkerSource(re,pe.type,pe.source).removeTile(pe)),this.actor.registerMessageHandler("RS",(re,pe)=>u._(this,void 0,void 0,function*(){if(!this.workerSources[re]||!this.workerSources[re][pe.type]||!this.workerSources[re][pe.type][pe.source])return;const _e=this.workerSources[re][pe.type][pe.source];delete this.workerSources[re][pe.type][pe.source],_e.removeSource!==void 0&&_e.removeSource(pe)})),this.actor.registerMessageHandler("RM",re=>u._(this,void 0,void 0,function*(){delete this.layerIndexes[re],delete this.availableImages[re],delete this.workerSources[re],delete this.demWorkerSources[re]})),this.actor.registerMessageHandler("SR",(re,pe)=>u._(this,void 0,void 0,function*(){this.referrer=pe})),this.actor.registerMessageHandler("SRPS",(re,pe)=>this._syncRTLPluginState(re,pe)),this.actor.registerMessageHandler("IS",(re,pe)=>u._(this,void 0,void 0,function*(){this.self.importScripts(pe)})),this.actor.registerMessageHandler("SI",(re,pe)=>this._setImages(re,pe)),this.actor.registerMessageHandler("UL",(re,pe)=>u._(this,void 0,void 0,function*(){this._getLayerIndex(re).update(pe.layers,pe.removedIds)})),this.actor.registerMessageHandler("SL",(re,pe)=>u._(this,void 0,void 0,function*(){this._getLayerIndex(re).replace(pe)}))}_setImages(ne,re){return u._(this,void 0,void 0,function*(){this.availableImages[ne]=re;for(const pe in this.workerSources[ne]){const _e=this.workerSources[ne][pe];for(const Ne in _e)_e[Ne].availableImages=re}})}_syncRTLPluginState(ne,re){return u._(this,void 0,void 0,function*(){if(u.bD.isParsed())return u.bD.getState();if(re.pluginStatus!=="loading")return u.bD.setState(re),re;const pe=re.pluginURL;if(this.self.importScripts(pe),u.bD.isParsed()){const _e={pluginStatus:"loaded",pluginURL:pe};return u.bD.setState(_e),_e}throw u.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${pe}`)})}_getAvailableImages(ne){let re=this.availableImages[ne];return re||(re=[]),re}_getLayerIndex(ne){let re=this.layerIndexes[ne];return re||(re=this.layerIndexes[ne]=new s),re}_getWorkerSource(ne,re,pe){if(this.workerSources[ne]||(this.workerSources[ne]={}),this.workerSources[ne][re]||(this.workerSources[ne][re]={}),!this.workerSources[ne][re][pe]){const _e={sendAsync:(Ne,De)=>(Ne.targetMapId=ne,this.actor.sendAsync(Ne,De))};switch(re){case"vector":this.workerSources[ne][re][pe]=new v(_e,this._getLayerIndex(ne),this._getAvailableImages(ne));break;case"geojson":this.workerSources[ne][re][pe]=new Ot(_e,this._getLayerIndex(ne),this._getAvailableImages(ne));break;default:this.workerSources[ne][re][pe]=new this.externalWorkerSourceTypes[re](_e,this._getLayerIndex(ne),this._getAvailableImages(ne))}}return this.workerSources[ne][re][pe]}_getDEMWorkerSource(ne,re){return this.demWorkerSources[ne]||(this.demWorkerSources[ne]={}),this.demWorkerSources[ne][re]||(this.demWorkerSources[ne][re]=new x),this.demWorkerSources[ne][re]}}return u.i(self)&&(self.worker=new Kt(self)),Kt}),a("index",["exports","./shared"],function(u,s){var h="4.7.1";let p,g;const v={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:C=>new Promise((o,f)=>{const y=requestAnimationFrame(o);C.signal.addEventListener("abort",()=>{cancelAnimationFrame(y),f(s.c())})}),getImageData(C,o=0){return this.getImageCanvasContext(C).getImageData(-o,-o,C.width+2*o,C.height+2*o)},getImageCanvasContext(C){const o=window.document.createElement("canvas"),f=o.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return o.width=C.width,o.height=C.height,f.drawImage(C,0,0,C.width,C.height),f},resolveURL:C=>(p||(p=document.createElement("a")),p.href=C,p.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(g==null&&(g=matchMedia("(prefers-reduced-motion: reduce)")),g.matches)}};class x{static testProp(o){if(!x.docStyle)return o[0];for(let f=0;f<o.length;f++)if(o[f]in x.docStyle)return o[f];return o[0]}static create(o,f,y){const b=window.document.createElement(o);return f!==void 0&&(b.className=f),y&&y.appendChild(b),b}static createNS(o,f){return window.document.createElementNS(o,f)}static disableDrag(){x.docStyle&&x.selectProp&&(x.userSelect=x.docStyle[x.selectProp],x.docStyle[x.selectProp]="none")}static enableDrag(){x.docStyle&&x.selectProp&&(x.docStyle[x.selectProp]=x.userSelect)}static setTransform(o,f){o.style[x.transformProp]=f}static addEventListener(o,f,y,b={}){o.addEventListener(f,y,"passive"in b?b:b.capture)}static removeEventListener(o,f,y,b={}){o.removeEventListener(f,y,"passive"in b?b:b.capture)}static suppressClickInternal(o){o.preventDefault(),o.stopPropagation(),window.removeEventListener("click",x.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",x.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",x.suppressClickInternal,!0)},0)}static getScale(o){const f=o.getBoundingClientRect();return{x:f.width/o.offsetWidth||1,y:f.height/o.offsetHeight||1,boundingClientRect:f}}static getPoint(o,f,y){const b=f.boundingClientRect;return new s.P((y.clientX-b.left)/f.x-o.clientLeft,(y.clientY-b.top)/f.y-o.clientTop)}static mousePos(o,f){const y=x.getScale(o);return x.getPoint(o,y,f)}static touchPos(o,f){const y=[],b=x.getScale(o);for(let E=0;E<f.length;E++)y.push(x.getPoint(o,b,f[E]));return y}static mouseButton(o){return o.button}static remove(o){o.parentNode&&o.parentNode.removeChild(o)}}x.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,x.selectProp=x.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),x.transformProp=x.testProp(["transform","WebkitTransform"]);const S={supported:!1,testSupport:function(C){!M&&N&&(I?A(C):P=C)}};let P,N,M=!1,I=!1;function A(C){const o=C.createTexture();C.bindTexture(C.TEXTURE_2D,o);try{if(C.texImage2D(C.TEXTURE_2D,0,C.RGBA,C.RGBA,C.UNSIGNED_BYTE,N),C.isContextLost())return;S.supported=!0}catch{}C.deleteTexture(o),M=!0}var D;typeof document<"u"&&(N=document.createElement("img"),N.onload=()=>{P&&A(P),P=null,I=!0},N.onerror=()=>{M=!0,P=null},N.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(C){let o,f,y,b;C.resetRequestQueue=()=>{o=[],f=0,y=0,b={}},C.addThrottleControl=O=>{const H=y++;return b[H]=O,H},C.removeThrottleControl=O=>{delete b[O],R()},C.getImage=(O,H,ee=!0)=>new Promise((te,he)=>{S.supported&&(O.headers||(O.headers={}),O.headers.accept="image/webp,*/*"),s.e(O,{type:"image"}),o.push({abortController:H,requestParameters:O,supportImageRefresh:ee,state:"queued",onError:ye=>{he(ye)},onSuccess:ye=>{te(ye)}}),R()});const E=O=>s._(this,void 0,void 0,function*(){O.state="running";const{requestParameters:H,supportImageRefresh:ee,onError:te,onSuccess:he,abortController:ye}=O,Se=ee===!1&&!s.i(self)&&!s.g(H.url)&&(!H.headers||Object.keys(H.headers).reduce((Me,Re)=>Me&&Re==="accept",!0));f++;const ke=Se?B(H,ye):s.m(H,ye);try{const Me=yield ke;delete O.abortController,O.state="completed",Me.data instanceof HTMLImageElement||s.b(Me.data)?he(Me):Me.data&&he({data:yield(Ae=Me.data,typeof createImageBitmap=="function"?s.d(Ae):s.f(Ae)),cacheControl:Me.cacheControl,expires:Me.expires})}catch(Me){delete O.abortController,te(Me)}finally{f--,R()}var Ae}),R=()=>{const O=(()=>{for(const H of Object.keys(b))if(b[H]())return!0;return!1})()?s.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let H=f;H<O&&o.length>0;H++){const ee=o.shift();ee.abortController.signal.aborted?H--:E(ee)}},B=(O,H)=>new Promise((ee,te)=>{const he=new Image,ye=O.url,Se=O.credentials;Se&&Se==="include"?he.crossOrigin="use-credentials":(Se&&Se==="same-origin"||!s.s(ye))&&(he.crossOrigin="anonymous"),H.signal.addEventListener("abort",()=>{he.src="",te(s.c())}),he.fetchPriority="high",he.onload=()=>{he.onerror=he.onload=null,ee({data:he})},he.onerror=()=>{he.onerror=he.onload=null,H.signal.aborted||te(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},he.src=ye})}(D||(D={})),D.resetRequestQueue();class j{constructor(o){this._transformRequestFn=o}transformRequest(o,f){return this._transformRequestFn&&this._transformRequestFn(o,f)||{url:o}}setTransformRequest(o){this._transformRequestFn=o}}function V(C){var o=new s.A(3);return o[0]=C[0],o[1]=C[1],o[2]=C[2],o}var U,$=function(C,o,f){return C[0]=o[0]-f[0],C[1]=o[1]-f[1],C[2]=o[2]-f[2],C};U=new s.A(3),s.A!=Float32Array&&(U[0]=0,U[1]=0,U[2]=0);var W=function(C){var o=C[0],f=C[1];return o*o+f*f};function X(C){const o=[];if(typeof C=="string")o.push({id:"default",url:C});else if(C&&C.length>0){const f=[];for(const{id:y,url:b}of C){const E=`${y}${b}`;f.indexOf(E)===-1&&(f.push(E),o.push({id:y,url:b}))}}return o}function J(C,o,f){const y=C.split("?");return y[0]+=`${o}${f}`,y.join("?")}(function(){var C=new s.A(2);s.A!=Float32Array&&(C[0]=0,C[1]=0)})();class Z{constructor(o,f,y,b){this.context=o,this.format=y,this.texture=o.gl.createTexture(),this.update(f,b)}update(o,f,y){const{width:b,height:E}=o,R=!(this.size&&this.size[0]===b&&this.size[1]===E||y),{context:B}=this,{gl:O}=B;if(this.useMipmap=!!(f&&f.useMipmap),O.bindTexture(O.TEXTURE_2D,this.texture),B.pixelStoreUnpackFlipY.set(!1),B.pixelStoreUnpack.set(1),B.pixelStoreUnpackPremultiplyAlpha.set(this.format===O.RGBA&&(!f||f.premultiply!==!1)),R)this.size=[b,E],o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||s.b(o)?O.texImage2D(O.TEXTURE_2D,0,this.format,this.format,O.UNSIGNED_BYTE,o):O.texImage2D(O.TEXTURE_2D,0,this.format,b,E,0,this.format,O.UNSIGNED_BYTE,o.data);else{const{x:H,y:ee}=y||{x:0,y:0};o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||s.b(o)?O.texSubImage2D(O.TEXTURE_2D,0,H,ee,O.RGBA,O.UNSIGNED_BYTE,o):O.texSubImage2D(O.TEXTURE_2D,0,H,ee,b,E,O.RGBA,O.UNSIGNED_BYTE,o.data)}this.useMipmap&&this.isSizePowerOfTwo()&&O.generateMipmap(O.TEXTURE_2D)}bind(o,f,y){const{context:b}=this,{gl:E}=b;E.bindTexture(E.TEXTURE_2D,this.texture),y!==E.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(y=E.LINEAR),o!==this.filter&&(E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,o),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,y||o),this.filter=o),f!==this.wrap&&(E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,f),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,f),this.wrap=f)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}function K(C){const{userImage:o}=C;return!!(o&&o.render&&o.render())&&(C.data.replace(new Uint8Array(o.data.buffer)),!0)}class Y extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:f,promiseResolve:y}of this.requestors)y(this._getImagesForIds(f));this.requestors=[]}}getImage(o){const f=this.images[o];if(f&&!f.data&&f.spriteData){const y=f.spriteData;f.data=new s.R({width:y.width,height:y.height},y.context.getImageData(y.x,y.y,y.width,y.height).data),f.spriteData=null}return f}addImage(o,f){if(this.images[o])throw new Error(`Image id ${o} already exist, use updateImage instead`);this._validate(o,f)&&(this.images[o]=f)}_validate(o,f){let y=!0;const b=f.data||f.spriteData;return this._validateStretch(f.stretchX,b&&b.width)||(this.fire(new s.j(new Error(`Image "${o}" has invalid "stretchX" value`))),y=!1),this._validateStretch(f.stretchY,b&&b.height)||(this.fire(new s.j(new Error(`Image "${o}" has invalid "stretchY" value`))),y=!1),this._validateContent(f.content,f)||(this.fire(new s.j(new Error(`Image "${o}" has invalid "content" value`))),y=!1),y}_validateStretch(o,f){if(!o)return!0;let y=0;for(const b of o){if(b[0]<y||b[1]<b[0]||f<b[1])return!1;y=b[1]}return!0}_validateContent(o,f){if(!o)return!0;if(o.length!==4)return!1;const y=f.spriteData,b=y&&y.width||f.data.width,E=y&&y.height||f.data.height;return!(o[0]<0||b<o[0]||o[1]<0||E<o[1]||o[2]<0||b<o[2]||o[3]<0||E<o[3]||o[2]<o[0]||o[3]<o[1])}updateImage(o,f,y=!0){const b=this.getImage(o);if(y&&(b.data.width!==f.data.width||b.data.height!==f.data.height))throw new Error(`size mismatch between old image (${b.data.width}x${b.data.height}) and new image (${f.data.width}x${f.data.height}).`);f.version=b.version+1,this.images[o]=f,this.updatedImages[o]=!0}removeImage(o){const f=this.images[o];delete this.images[o],delete this.patterns[o],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o){return new Promise((f,y)=>{let b=!0;if(!this.isLoaded())for(const E of o)this.images[E]||(b=!1);this.isLoaded()||b?f(this._getImagesForIds(o)):this.requestors.push({ids:o,promiseResolve:f})})}_getImagesForIds(o){const f={};for(const y of o){let b=this.getImage(y);b||(this.fire(new s.k("styleimagemissing",{id:y})),b=this.getImage(y)),b?f[y]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,textFitWidth:b.textFitWidth,textFitHeight:b.textFitHeight,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:s.w(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return f}getPixelSize(){const{width:o,height:f}=this.atlasImage;return{width:o,height:f}}getPattern(o){const f=this.patterns[o],y=this.getImage(o);if(!y)return null;if(f&&f.position.version===y.version)return f.position;if(f)f.position.version=y.version;else{const b={w:y.data.width+2,h:y.data.height+2,x:0,y:0},E=new s.I(b,y);this.patterns[o]={bin:b,position:E}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const f=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Z(o,this.atlasImage,f.RGBA),this.atlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const E in this.patterns)o.push(this.patterns[E].bin);const{w:f,h:y}=s.p(o),b=this.atlasImage;b.resize({width:f||1,height:y||1});for(const E in this.patterns){const{bin:R}=this.patterns[E],B=R.x+1,O=R.y+1,H=this.getImage(E).data,ee=H.width,te=H.height;s.R.copy(H,b,{x:0,y:0},{x:B,y:O},{width:ee,height:te}),s.R.copy(H,b,{x:0,y:te-1},{x:B,y:O-1},{width:ee,height:1}),s.R.copy(H,b,{x:0,y:0},{x:B,y:O+te},{width:ee,height:1}),s.R.copy(H,b,{x:ee-1,y:0},{x:B-1,y:O},{width:1,height:te}),s.R.copy(H,b,{x:0,y:0},{x:B+ee,y:O},{width:1,height:te})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const f of o){if(this.callbackDispatchedThisFrame[f])continue;this.callbackDispatchedThisFrame[f]=!0;const y=this.getImage(f);y||s.w(`Image with ID: "${f}" was not found`),K(y)&&this.updateImage(f,y)}}}const G=1e20;function oe(C,o,f,y,b,E,R,B,O){for(let H=o;H<o+y;H++)ie(C,f*E+H,E,b,R,B,O);for(let H=f;H<f+b;H++)ie(C,H*E+o,1,y,R,B,O)}function ie(C,o,f,y,b,E,R){E[0]=0,R[0]=-G,R[1]=G,b[0]=C[o];for(let B=1,O=0,H=0;B<y;B++){b[B]=C[o+B*f];const ee=B*B;do{const te=E[O];H=(b[B]-b[te]+ee-te*te)/(B-te)/2}while(H<=R[O]&&--O>-1);O++,E[O]=B,R[O]=H,R[O+1]=G}for(let B=0,O=0;B<y;B++){for(;R[O+1]<B;)O++;const H=E[O],ee=B-H;C[o+B*f]=b[H]+ee*ee}}class ce{constructor(o,f){this.requestManager=o,this.localIdeographFontFamily=f,this.entries={}}setURL(o){this.url=o}getGlyphs(o){return s._(this,void 0,void 0,function*(){const f=[];for(const E in o)for(const R of o[E])f.push(this._getAndCacheGlyphsPromise(E,R));const y=yield Promise.all(f),b={};for(const{stack:E,id:R,glyph:B}of y)b[E]||(b[E]={}),b[E][R]=B&&{id:B.id,bitmap:B.bitmap.clone(),metrics:B.metrics};return b})}_getAndCacheGlyphsPromise(o,f){return s._(this,void 0,void 0,function*(){let y=this.entries[o];y||(y=this.entries[o]={glyphs:{},requests:{},ranges:{}});let b=y.glyphs[f];if(b!==void 0)return{stack:o,id:f,glyph:b};if(b=this._tinySDF(y,o,f),b)return y.glyphs[f]=b,{stack:o,id:f,glyph:b};const E=Math.floor(f/256);if(256*E>65535)throw new Error("glyphs > 65535 not supported");if(y.ranges[E])return{stack:o,id:f,glyph:b};if(!this.url)throw new Error("glyphsUrl is not set");if(!y.requests[E]){const B=ce.loadGlyphRange(o,E,this.url,this.requestManager);y.requests[E]=B}const R=yield y.requests[E];for(const B in R)this._doesCharSupportLocalGlyph(+B)||(y.glyphs[+B]=R[+B]);return y.ranges[E]=!0,{stack:o,id:f,glyph:R[f]||null}})}_doesCharSupportLocalGlyph(o){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(o))}_tinySDF(o,f,y){const b=this.localIdeographFontFamily;if(!b||!this._doesCharSupportLocalGlyph(y))return;let E=o.tinySDF;if(!E){let B="400";/bold/i.test(f)?B="900":/medium/i.test(f)?B="500":/light/i.test(f)&&(B="200"),E=o.tinySDF=new ce.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:b,fontWeight:B})}const R=E.draw(String.fromCharCode(y));return{id:y,bitmap:new s.o({width:R.width||60,height:R.height||60},R.data),metrics:{width:R.glyphWidth/2||24,height:R.glyphHeight/2||24,left:R.glyphLeft/2+.5||0,top:R.glyphTop/2-27.5||-8,advance:R.glyphAdvance/2||24,isDoubleResolution:!0}}}}ce.loadGlyphRange=function(C,o,f,y){return s._(this,void 0,void 0,function*(){const b=256*o,E=b+255,R=y.transformRequest(f.replace("{fontstack}",C).replace("{range}",`${b}-${E}`),"Glyphs"),B=yield s.l(R,new AbortController);if(!B||!B.data)throw new Error(`Could not load glyph range. range: ${o}, ${b}-${E}`);const O={};for(const H of s.n(B.data))O[H.id]=H;return O})},ce.TinySDF=class{constructor({fontSize:C=24,buffer:o=3,radius:f=8,cutoff:y=.25,fontFamily:b="sans-serif",fontWeight:E="normal",fontStyle:R="normal"}={}){this.buffer=o,this.cutoff=y,this.radius=f;const B=this.size=C+4*o,O=this._createCanvas(B),H=this.ctx=O.getContext("2d",{willReadFrequently:!0});H.font=`${R} ${E} ${C}px ${b}`,H.textBaseline="alphabetic",H.textAlign="left",H.fillStyle="black",this.gridOuter=new Float64Array(B*B),this.gridInner=new Float64Array(B*B),this.f=new Float64Array(B),this.z=new Float64Array(B+1),this.v=new Uint16Array(B)}_createCanvas(C){const o=document.createElement("canvas");return o.width=o.height=C,o}draw(C){const{width:o,actualBoundingBoxAscent:f,actualBoundingBoxDescent:y,actualBoundingBoxLeft:b,actualBoundingBoxRight:E}=this.ctx.measureText(C),R=Math.ceil(f),B=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(E-b))),O=Math.min(this.size-this.buffer,R+Math.ceil(y)),H=B+2*this.buffer,ee=O+2*this.buffer,te=Math.max(H*ee,0),he=new Uint8ClampedArray(te),ye={data:he,width:H,height:ee,glyphWidth:B,glyphHeight:O,glyphTop:R,glyphLeft:0,glyphAdvance:o};if(B===0||O===0)return ye;const{ctx:Se,buffer:ke,gridInner:Ae,gridOuter:Me}=this;Se.clearRect(ke,ke,B,O),Se.fillText(C,ke,ke+R);const Re=Se.getImageData(ke,ke,B,O);Me.fill(G,0,te),Ae.fill(0,0,te);for(let Ee=0;Ee<O;Ee++)for(let Ve=0;Ve<B;Ve++){const Ge=Re.data[4*(Ee*B+Ve)+3]/255;if(Ge===0)continue;const tt=(Ee+ke)*H+Ve+ke;if(Ge===1)Me[tt]=0,Ae[tt]=G;else{const yt=.5-Ge;Me[tt]=yt>0?yt*yt:0,Ae[tt]=yt<0?yt*yt:0}}oe(Me,0,0,H,ee,H,this.f,this.v,this.z),oe(Ae,ke,ke,B,O,H,this.f,this.v,this.z);for(let Ee=0;Ee<te;Ee++){const Ve=Math.sqrt(Me[Ee])-Math.sqrt(Ae[Ee]);he[Ee]=Math.round(255-255*(Ve/this.radius+this.cutoff))}return ye}};class fe{constructor(){this.specification=s.v.light.position}possiblyEvaluate(o,f){return s.x(o.expression.evaluate(f))}interpolate(o,f,y){return{x:s.y.number(o.x,f.x,y),y:s.y.number(o.y,f.y,y),z:s.y.number(o.z,f.z,y)}}}let de;class be extends s.E{constructor(o){super(),de=de||new s.q({anchor:new s.D(s.v.light.anchor),position:new fe,color:new s.D(s.v.light.color),intensity:new s.D(s.v.light.intensity)}),this._transitionable=new s.T(de),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,f={}){if(!this._validate(s.r,o,f))for(const y in o){const b=o[y];y.endsWith("-transition")?this._transitionable.setTransition(y.slice(0,-11),b):this._transitionable.setValue(y,b)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,f,y){return(!y||y.validate!==!1)&&s.t(this,o.call(s.u,{value:f,style:{glyphs:!0,sprite:!0},styleSpec:s.v}))}}const ge=new s.q({"sky-color":new s.D(s.v.sky["sky-color"]),"horizon-color":new s.D(s.v.sky["horizon-color"]),"fog-color":new s.D(s.v.sky["fog-color"]),"fog-ground-blend":new s.D(s.v.sky["fog-ground-blend"]),"horizon-fog-blend":new s.D(s.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new s.D(s.v.sky["sky-horizon-blend"]),"atmosphere-blend":new s.D(s.v.sky["atmosphere-blend"])});class xe extends s.E{constructor(o){super(),this._transitionable=new s.T(ge),this.setSky(o),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new s.z(0))}setSky(o,f={}){if(!this._validate(s.B,o,f)){o||(o={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const y in o){const b=o[y];y.endsWith("-transition")?this._transitionable.setTransition(y.slice(0,-11),b):this._transitionable.setValue(y,b)}}}getSky(){return this._transitionable.serialize()}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,f,y={}){return(y==null?void 0:y.validate)!==!1&&s.t(this,o.call(s.u,s.e({value:f,style:{glyphs:!0,sprite:!0},styleSpec:s.v})))}calculateFogBlendOpacity(o){return o<60?0:o<70?(o-60)/10:1}}class Le{constructor(o,f){this.width=o,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(o,f){const y=o.join(",")+String(f);return this.dashEntry[y]||(this.dashEntry[y]=this.addDash(o,f)),this.dashEntry[y]}getDashRanges(o,f,y){const b=[];let E=o.length%2==1?-o[o.length-1]*y:0,R=o[0]*y,B=!0;b.push({left:E,right:R,isDash:B,zeroLength:o[0]===0});let O=o[0];for(let H=1;H<o.length;H++){B=!B;const ee=o[H];E=O*y,O+=ee,R=O*y,b.push({left:E,right:R,isDash:B,zeroLength:ee===0})}return b}addRoundDash(o,f,y){const b=f/2;for(let E=-y;E<=y;E++){const R=this.width*(this.nextRow+y+E);let B=0,O=o[B];for(let H=0;H<this.width;H++){H/O.right>1&&(O=o[++B]);const ee=Math.abs(H-O.left),te=Math.abs(H-O.right),he=Math.min(ee,te);let ye;const Se=E/y*(b+1);if(O.isDash){const ke=b-Math.abs(Se);ye=Math.sqrt(he*he+ke*ke)}else ye=b-Math.sqrt(he*he+Se*Se);this.data[R+H]=Math.max(0,Math.min(255,ye+128))}}}addRegularDash(o){for(let B=o.length-1;B>=0;--B){const O=o[B],H=o[B+1];O.zeroLength?o.splice(B,1):H&&H.isDash===O.isDash&&(H.left=O.left,o.splice(B,1))}const f=o[0],y=o[o.length-1];f.isDash===y.isDash&&(f.left=y.left-this.width,y.right=f.right+this.width);const b=this.width*this.nextRow;let E=0,R=o[E];for(let B=0;B<this.width;B++){B/R.right>1&&(R=o[++E]);const O=Math.abs(B-R.left),H=Math.abs(B-R.right),ee=Math.min(O,H);this.data[b+B]=Math.max(0,Math.min(255,(R.isDash?ee:-ee)+128))}}addDash(o,f){const y=f?7:0,b=2*y+1;if(this.nextRow+b>this.height)return s.w("LineAtlas out of space"),null;let E=0;for(let B=0;B<o.length;B++)E+=o[B];if(E!==0){const B=this.width/E,O=this.getDashRanges(o,this.width,B);f?this.addRoundDash(O,B,y):this.addRegularDash(O)}const R={y:(this.nextRow+y+.5)/this.height,height:2*y/this.height,width:E};return this.nextRow+=b,this.dirty=!0,R}bind(o){const f=o.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))}}const Oe="maplibre_preloaded_worker_pool";class Fe{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<Fe.workerCount;)this.workers.push(new Worker(s.a.WORKER_URL));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.numActive()===0&&(this.workers.forEach(f=>{f.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Oe]}numActive(){return Object.keys(this.active).length}}const et=Math.floor(v.hardwareConcurrency/2);let nt,mt;function it(){return nt||(nt=new Fe),nt}Fe.workerCount=s.C(globalThis)?Math.max(Math.min(et,3),1):1;class ze{constructor(o,f){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=f;const y=this.workerPool.acquire(f);for(let b=0;b<y.length;b++){const E=new s.F(y[b],f);E.name=`Worker ${b}`,this.actors.push(E)}if(!this.actors.length)throw new Error("No actors found")}broadcast(o,f){const y=[];for(const b of this.actors)y.push(b.sendAsync({type:o,data:f}));return Promise.all(y)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(o=!0){this.actors.forEach(f=>{f.remove()}),this.actors=[],o&&this.workerPool.release(this.id)}registerMessageHandler(o,f){for(const y of this.actors)y.registerMessageHandler(o,f)}}function He(){return mt||(mt=new ze(it(),s.G),mt.registerMessageHandler("GR",(C,o,f)=>s.m(o,f))),mt}function We(C,o){const f=s.H();return s.J(f,f,[1,1,0]),s.K(f,f,[.5*C.width,.5*C.height,1]),s.L(f,f,C.calculatePosMatrix(o.toUnwrapped()))}function ot(C,o,f,y,b,E){const R=function(te,he,ye){if(te)for(const Se of te){const ke=he[Se];if(ke&&ke.source===ye&&ke.type==="fill-extrusion")return!0}else for(const Se in he){const ke=he[Se];if(ke.source===ye&&ke.type==="fill-extrusion")return!0}return!1}(b&&b.layers,o,C.id),B=E.maxPitchScaleFactor(),O=C.tilesIn(y,B,R);O.sort(xt);const H=[];for(const te of O)H.push({wrappedTileID:te.tileID.wrapped().key,queryResults:te.tile.queryRenderedFeatures(o,f,C._state,te.queryGeometry,te.cameraQueryGeometry,te.scale,b,E,B,We(C.transform,te.tileID))});const ee=function(te){const he={},ye={};for(const Se of te){const ke=Se.queryResults,Ae=Se.wrappedTileID,Me=ye[Ae]=ye[Ae]||{};for(const Re in ke){const Ee=ke[Re],Ve=Me[Re]=Me[Re]||{},Ge=he[Re]=he[Re]||[];for(const tt of Ee)Ve[tt.featureIndex]||(Ve[tt.featureIndex]=!0,Ge.push(tt))}}return he}(H);for(const te in ee)ee[te].forEach(he=>{const ye=he.feature,Se=C.getFeatureState(ye.layer["source-layer"],ye.id);ye.source=ye.layer.source,ye.layer["source-layer"]&&(ye.sourceLayer=ye.layer["source-layer"]),ye.state=Se});return ee}function xt(C,o){const f=C.tileID,y=o.tileID;return f.overscaledZ-y.overscaledZ||f.canonical.y-y.canonical.y||f.wrap-y.wrap||f.canonical.x-y.canonical.x}function Tt(C,o,f){return s._(this,void 0,void 0,function*(){let y=C;if(C.url?y=(yield s.h(o.transformRequest(C.url,"Source"),f)).data:yield v.frameAsync(f),!y)return null;const b=s.M(s.e(y,C),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in y&&y.vector_layers&&(b.vectorLayerIds=y.vector_layers.map(E=>E.id)),b})}class $e{constructor(o,f){o&&(f?this.setSouthWest(o).setNorthEast(f):Array.isArray(o)&&(o.length===4?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1])))}setNorthEast(o){return this._ne=o instanceof s.N?new s.N(o.lng,o.lat):s.N.convert(o),this}setSouthWest(o){return this._sw=o instanceof s.N?new s.N(o.lng,o.lat):s.N.convert(o),this}extend(o){const f=this._sw,y=this._ne;let b,E;if(o instanceof s.N)b=o,E=o;else{if(!(o instanceof $e))return Array.isArray(o)?o.length===4||o.every(Array.isArray)?this.extend($e.convert(o)):this.extend(s.N.convert(o)):o&&("lng"in o||"lon"in o)&&"lat"in o?this.extend(s.N.convert(o)):this;if(b=o._sw,E=o._ne,!b||!E)return this}return f||y?(f.lng=Math.min(b.lng,f.lng),f.lat=Math.min(b.lat,f.lat),y.lng=Math.max(E.lng,y.lng),y.lat=Math.max(E.lat,y.lat)):(this._sw=new s.N(b.lng,b.lat),this._ne=new s.N(E.lng,E.lat)),this}getCenter(){return new s.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.N(this.getWest(),this.getNorth())}getSouthEast(){return new s.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:f,lat:y}=s.N.convert(o);let b=this._sw.lng<=f&&f<=this._ne.lng;return this._sw.lng>this._ne.lng&&(b=this._sw.lng>=f&&f>=this._ne.lng),this._sw.lat<=y&&y<=this._ne.lat&&b}static convert(o){return o instanceof $e?o:o&&new $e(o)}static fromLngLat(o,f=0){const y=360*f/40075017,b=y/Math.cos(Math.PI/180*o.lat);return new $e(new s.N(o.lng-b,o.lat-y),new s.N(o.lng+b,o.lat+y))}adjustAntiMeridian(){const o=new s.N(this._sw.lng,this._sw.lat),f=new s.N(this._ne.lng,this._ne.lat);return new $e(o,o.lng>f.lng?new s.N(f.lng+360,f.lat):f)}}class Xe{constructor(o,f,y){this.bounds=$e.convert(this.validateBounds(o)),this.minzoom=f||0,this.maxzoom=y||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const f=Math.pow(2,o.z),y=Math.floor(s.O(this.bounds.getWest())*f),b=Math.floor(s.Q(this.bounds.getNorth())*f),E=Math.ceil(s.O(this.bounds.getEast())*f),R=Math.ceil(s.Q(this.bounds.getSouth())*f);return o.x>=y&&o.x<E&&o.y>=b&&o.y<R}}class Pe extends s.E{constructor(o,f,y,b){if(super(),this.id=o,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.M(f,["url","scheme","tileSize","promoteId"])),this._options=s.e({type:"vector"},f),this._collectResourceTiming=f.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b)}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const o=yield Tt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),o&&(s.e(this,o),o.bounds&&(this.tileBounds=new Xe(o.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))}catch(o){this._tileJSONRequest=null,this.fire(new s.j(o))}})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}setSourceProperty(o){this._tileJSONRequest&&this._tileJSONRequest.abort(),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return s.e({},this._options)}loadTile(o){return s._(this,void 0,void 0,function*(){const f=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),y={request:this.map._requestManager.transformRequest(f,"Tile"),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};y.request.collectResourceTiming=this._collectResourceTiming;let b="RT";if(o.actor&&o.state!=="expired"){if(o.state==="loading")return new Promise((E,R)=>{o.reloadPromise={resolve:E,reject:R}})}else o.actor=this.dispatcher.getActor(),b="LT";o.abortController=new AbortController;try{const E=yield o.actor.sendAsync({type:b,data:y},o.abortController);if(delete o.abortController,o.aborted)return;this._afterTileLoadWorkerResponse(o,E)}catch(E){if(delete o.abortController,o.aborted)return;if(E&&E.status!==404)throw E;this._afterTileLoadWorkerResponse(o,null)}})}_afterTileLoadWorkerResponse(o,f){if(f&&f.resourceTiming&&(o.resourceTiming=f.resourceTiming),f&&this.map._refreshExpiredTiles&&o.setExpiryData(f),o.loadVectorData(f,this.map.painter),o.reloadPromise){const y=o.reloadPromise;o.reloadPromise=null,this.loadTile(o).then(y.resolve).catch(y.reject)}}abortTile(o){return s._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.actor&&(yield o.actor.sendAsync({type:"AT",data:{uid:o.uid,type:this.type,source:this.id}}))})}unloadTile(o){return s._(this,void 0,void 0,function*(){o.unloadVectorData(),o.actor&&(yield o.actor.sendAsync({type:"RMT",data:{uid:o.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Ye extends s.E{constructor(o,f,y,b){super(),this.id=o,this.dispatcher=y,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},f),s.e(this,s.M(f,["url","scheme","tileSize"]))}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const o=yield Tt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,o&&(s.e(this,o),o.bounds&&(this.tileBounds=new Xe(o.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))}catch(o){this._tileJSONRequest=null,this.fire(new s.j(o))}})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(o){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}serialize(){return s.e({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o){return s._(this,void 0,void 0,function*(){const f=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);o.abortController=new AbortController;try{const y=yield D.getImage(this.map._requestManager.transformRequest(f,"Tile"),o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(y&&y.data){this.map._refreshExpiredTiles&&y.cacheControl&&y.expires&&o.setExpiryData({cacheControl:y.cacheControl,expires:y.expires});const b=this.map.painter.context,E=b.gl,R=y.data;o.texture=this.map.painter.getTileTexture(R.width),o.texture?o.texture.update(R,{useMipmap:!0}):(o.texture=new Z(b,R,E.RGBA,{useMipmap:!0}),o.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE,E.LINEAR_MIPMAP_NEAREST)),o.state="loaded"}}catch(y){if(delete o.abortController,o.aborted)o.state="unloaded";else if(y)throw o.state="errored",y}})}abortTile(o){return s._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController)})}unloadTile(o){return s._(this,void 0,void 0,function*(){o.texture&&this.map.painter.saveTileTexture(o.texture)})}hasTransition(){return!1}}class at extends Ye{constructor(o,f,y,b){super(o,f,y,b),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},f),this.encoding=f.encoding||"mapbox",this.redFactor=f.redFactor,this.greenFactor=f.greenFactor,this.blueFactor=f.blueFactor,this.baseShift=f.baseShift}loadTile(o){return s._(this,void 0,void 0,function*(){const f=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),y=this.map._requestManager.transformRequest(f,"Tile");o.neighboringTiles=this._getNeighboringTiles(o.tileID),o.abortController=new AbortController;try{const b=yield D.getImage(y,o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(b&&b.data){const E=b.data;this.map._refreshExpiredTiles&&b.cacheControl&&b.expires&&o.setExpiryData({cacheControl:b.cacheControl,expires:b.expires});const R=s.b(E)&&s.U()?E:yield this.readImageNow(E),B={type:this.type,uid:o.uid,source:this.id,rawImageData:R,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!o.actor||o.state==="expired"){o.actor=this.dispatcher.getActor();const O=yield o.actor.sendAsync({type:"LDT",data:B});o.dem=O,o.needsHillshadePrepare=!0,o.needsTerrainPrepare=!0,o.state="loaded"}}}catch(b){if(delete o.abortController,o.aborted)o.state="unloaded";else if(b)throw o.state="errored",b}})}readImageNow(o){return s._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&s.V()){const f=o.width+2,y=o.height+2;try{return new s.R({width:f,height:y},yield s.W(o,-1,-1,f,y))}catch{}}return v.getImageData(o,1)})}_getNeighboringTiles(o){const f=o.canonical,y=Math.pow(2,f.z),b=(f.x-1+y)%y,E=f.x===0?o.wrap-1:o.wrap,R=(f.x+1+y)%y,B=f.x+1===y?o.wrap+1:o.wrap,O={};return O[new s.S(o.overscaledZ,E,f.z,b,f.y).key]={backfilled:!1},O[new s.S(o.overscaledZ,B,f.z,R,f.y).key]={backfilled:!1},f.y>0&&(O[new s.S(o.overscaledZ,E,f.z,b,f.y-1).key]={backfilled:!1},O[new s.S(o.overscaledZ,o.wrap,f.z,f.x,f.y-1).key]={backfilled:!1},O[new s.S(o.overscaledZ,B,f.z,R,f.y-1).key]={backfilled:!1}),f.y+1<y&&(O[new s.S(o.overscaledZ,E,f.z,b,f.y+1).key]={backfilled:!1},O[new s.S(o.overscaledZ,o.wrap,f.z,f.x,f.y+1).key]={backfilled:!1},O[new s.S(o.overscaledZ,B,f.z,R,f.y+1).key]={backfilled:!1}),O}unloadTile(o){return s._(this,void 0,void 0,function*(){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&(yield o.actor.sendAsync({type:"RDT",data:{type:this.type,uid:o.uid,source:this.id}}))})}}class bt extends s.E{constructor(o,f,y,b){super(),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=y.getActor(),this.setEventedParent(b),this._data=f.data,this._options=s.e({},f),this._collectResourceTiming=f.collectResourceTiming,f.maxzoom!==void 0&&(this.maxzoom=f.maxzoom),f.type&&(this.type=f.type),f.attribution&&(this.attribution=f.attribution),this.promoteId=f.promoteId;const E=s.X/this.tileSize;f.clusterMaxZoom!==void 0&&this.maxzoom<=f.clusterMaxZoom&&s.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${f.clusterMaxZoom}".`),this.workerOptions=s.e({source:this.id,cluster:f.cluster||!1,geojsonVtOptions:{buffer:(f.buffer!==void 0?f.buffer:128)*E,tolerance:(f.tolerance!==void 0?f.tolerance:.375)*E,extent:s.X,maxZoom:this.maxzoom,lineMetrics:f.lineMetrics||!1,generateId:f.generateId||!1},superclusterOptions:{maxZoom:f.clusterMaxZoom!==void 0?f.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,f.clusterMinPoints||2),extent:s.X,radius:(f.clusterRadius||50)*E,log:!1,generateId:f.generateId||!1},clusterProperties:f.clusterProperties,filter:f.filter},f.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return s._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(o){this.map=o,this.load()}setData(o){return this._data=o,this._updateWorkerData(),this}updateData(o){return this._updateWorkerData(o),this}getData(){return s._(this,void 0,void 0,function*(){const o=s.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:o})})}setClusterOptions(o){return this.workerOptions.cluster=o.cluster,o&&(o.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=o.clusterRadius),o.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=o.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(o){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:o,source:this.id}})}getClusterChildren(o){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:o,source:this.id}})}getClusterLeaves(o,f,y){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:o,limit:f,offset:y}})}_updateWorkerData(o){return s._(this,void 0,void 0,function*(){const f=s.e({type:this.type},this.workerOptions);o?f.dataDiff=o:typeof this._data=="string"?(f.request=this.map._requestManager.transformRequest(v.resolveURL(this._data),"Source"),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new s.k("dataloading",{dataType:"source"}));try{const y=yield this.actor.sendAsync({type:"LD",data:f});if(this._pendingLoads--,this._removed||y.abandoned)return void this.fire(new s.k("dataabort",{dataType:"source"}));let b=null;y.resourceTiming&&y.resourceTiming[this.id]&&(b=y.resourceTiming[this.id].slice(0));const E={dataType:"source"};this._collectResourceTiming&&b&&b.length>0&&s.e(E,{resourceTiming:b}),this.fire(new s.k("data",Object.assign(Object.assign({},E),{sourceDataType:"metadata"}))),this.fire(new s.k("data",Object.assign(Object.assign({},E),{sourceDataType:"content"})))}catch(y){if(this._pendingLoads--,this._removed)return void this.fire(new s.k("dataabort",{dataType:"source"}));this.fire(new s.j(y))}})}loaded(){return this._pendingLoads===0}loadTile(o){return s._(this,void 0,void 0,function*(){const f=o.actor?"RT":"LT";o.actor=this.actor;const y={type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};o.abortController=new AbortController;const b=yield this.actor.sendAsync({type:f,data:y},o.abortController);delete o.abortController,o.unloadVectorData(),o.aborted||o.loadVectorData(b,this.map.painter,f==="RT")})}abortTile(o){return s._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.aborted=!0})}unloadTile(o){return s._(this,void 0,void 0,function*(){o.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:o.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return s.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Et=s.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Vt extends s.E{constructor(o,f,y,b){super(),this.id=o,this.dispatcher=y,this.coordinates=f.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(b),this.options=f}load(o){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const f=yield D.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,f&&f.data&&(this.image=f.data,o&&(this.coordinates=o),this._finishLoading())}catch(f){this._request=null,this._loaded=!0,this.fire(new s.j(f))}})}loaded(){return this._loaded}updateImage(o){return o.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=o.url,this.load(o.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(o){this.coordinates=o;const f=o.map(s.Z.fromLngLat);this.tileID=function(b){let E=1/0,R=1/0,B=-1/0,O=-1/0;for(const he of b)E=Math.min(E,he.x),R=Math.min(R,he.y),B=Math.max(B,he.x),O=Math.max(O,he.y);const H=Math.max(B-E,O-R),ee=Math.max(0,Math.floor(-Math.log(H)/Math.LN2)),te=Math.pow(2,ee);return new s.a1(ee,Math.floor((E+B)/2*te),Math.floor((R+O)/2*te))}(f),this.minzoom=this.maxzoom=this.tileID.z;const y=f.map(b=>this.tileID.getTilePoint(b)._round());return this._boundsArray=new s.$,this._boundsArray.emplaceBack(y[0].x,y[0].y,0,0),this._boundsArray.emplaceBack(y[1].x,y[1].y,s.X,0),this._boundsArray.emplaceBack(y[3].x,y[3].y,0,s.X),this._boundsArray.emplaceBack(y[2].x,y[2].y,s.X,s.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const o=this.map.painter.context,f=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,Et.members)),this.boundsSegments||(this.boundsSegments=s.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Z(o,this.image,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let y=!1;for(const b in this.tiles){const E=this.tiles[b];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture,y=!0)}y&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(o){return s._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={}):o.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Bt extends Vt{constructor(o,f,y,b){super(o,f,y,b),this.roundZoom=!0,this.type="video",this.options=f}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1;const o=this.options;this.urls=[];for(const f of o.urls)this.urls.push(this.map._requestManager.transformRequest(f,"Source").url);try{const f=yield s.a3(this.urls);if(this._loaded=!0,!f)return;this.video=f,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(f){this.fire(new s.j(f))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(o){if(this.video){const f=this.video.seekable;o<f.start(0)||o>f.end(0)?this.fire(new s.j(new s.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${f.start(0)} and ${f.end(0)}-second mark.`))):this.video.currentTime=o}}getVideo(){return this.video}onAdd(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const o=this.map.painter.context,f=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,Et.members)),this.boundsSegments||(this.boundsSegments=s.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE),f.texSubImage2D(f.TEXTURE_2D,0,0,0,f.RGBA,f.UNSIGNED_BYTE,this.video)):(this.texture=new Z(o,this.video,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let y=!1;for(const b in this.tiles){const E=this.tiles[b];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture,y=!0)}y&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Mt extends Vt{constructor(o,f,y,b){super(o,f,y,b),f.coordinates?Array.isArray(f.coordinates)&&f.coordinates.length===4&&!f.coordinates.some(E=>!Array.isArray(E)||E.length!==2||E.some(R=>typeof R!="number"))||this.fire(new s.j(new s.a2(`sources.${o}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.j(new s.a2(`sources.${o}`,null,'missing required property "coordinates"'))),f.animate&&typeof f.animate!="boolean"&&this.fire(new s.j(new s.a2(`sources.${o}`,null,'optional "animate" property must be a boolean value'))),f.canvas?typeof f.canvas=="string"||f.canvas instanceof HTMLCanvasElement||this.fire(new s.j(new s.a2(`sources.${o}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.j(new s.a2(`sources.${o}`,null,'missing required property "canvas"'))),this.options=f,this.animate=f.animate===void 0||f.animate}load(){return s._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let o=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,o=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,o=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const f=this.map.painter.context,y=f.gl;this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,Et.members)),this.boundsSegments||(this.boundsSegments=s.a0.simpleSegment(0,0,4,2)),this.texture?(o||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Z(f,this.canvas,y.RGBA,{premultiply:!0});let b=!1;for(const E in this.tiles){const R=this.tiles[E];R.state!=="loaded"&&(R.state="loaded",R.texture=this.texture,b=!0)}b&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const o of[this.canvas.width,this.canvas.height])if(isNaN(o)||o<=0)return!0;return!1}}const cr={},ar=C=>{switch(C){case"geojson":return bt;case"image":return Vt;case"raster":return Ye;case"raster-dem":return at;case"vector":return Pe;case"video":return Bt;case"canvas":return Mt}return cr[C]},ft="RTLPluginLoaded";class fr extends s.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=He()}_syncState(o){return this.status=o,this.dispatcher.broadcast("SRPS",{pluginStatus:o,pluginURL:this.url}).catch(f=>{throw this.status="error",f})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(o){return s._(this,arguments,void 0,function*(f,y=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=v.resolveURL(f),!this.url)throw new Error(`requested url ${f} is invalid`);if(this.status==="unavailable"){if(!y)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return s._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new s.k(ft))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Xt=null;function kt(){return Xt||(Xt=new fr),Xt}class dt{constructor(o,f){this.timeAdded=0,this.fadeEndTime=0,this.tileID=o,this.uid=s.a4(),this.uses=0,this.tileSize=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(o){const f=o+this.timeAdded;f<this.fadeEndTime||(this.fadeEndTime=f)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(o){this.demTexture&&o.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(o,f,y){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(b,E){const R={};if(!E)return R;for(const B of b){const O=B.layerIds.map(H=>E.getLayer(H)).filter(Boolean);if(O.length!==0){B.layers=O,B.stateDependentLayerIds&&(B.stateDependentLayers=B.stateDependentLayerIds.map(H=>O.filter(ee=>ee.id===H)[0]));for(const H of O)R[H.id]=B}}return R}(o.buckets,f.style),this.hasSymbolBuckets=!1;for(const b in this.buckets){const E=this.buckets[b];if(E instanceof s.a6){if(this.hasSymbolBuckets=!0,!y)break;E.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const b in this.buckets){const E=this.buckets[b];if(E instanceof s.a6&&E.hasRTLText){this.hasRTLText=!0,kt().lazyLoad();break}}this.queryPadding=0;for(const b in this.buckets){const E=this.buckets[b];this.queryPadding=Math.max(this.queryPadding,f.style.getLayer(b).queryRadius(E))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage)}else this.collisionBoxArray=new s.a5}unloadVectorData(){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(o){return this.buckets[o.id]}upload(o){for(const y in this.buckets){const b=this.buckets[y];b.uploadPending()&&b.upload(o)}const f=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Z(o,this.imageAtlas.image,f.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Z(o,this.glyphAtlasImage,f.ALPHA),this.glyphAtlasImage=null)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,f,y,b,E,R,B,O,H,ee){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:b,cameraQueryGeometry:E,scale:R,tileSize:this.tileSize,pixelPosMatrix:ee,transform:O,params:B,queryPadding:this.queryPadding*H},o,f,y):{}}querySourceFeatures(o,f){const y=this.latestFeatureIndex;if(!y||!y.rawTileData)return;const b=y.loadVTLayers(),E=f&&f.sourceLayer?f.sourceLayer:"",R=b._geojsonTileLayer||b[E];if(!R)return;const B=s.a7(f&&f.filter),{z:O,x:H,y:ee}=this.tileID.canonical,te={z:O,x:H,y:ee};for(let he=0;he<R.length;he++){const ye=R.feature(he);if(B.needGeometry){const Ae=s.a8(ye,!0);if(!B.filter(new s.z(this.tileID.overscaledZ),Ae,this.tileID.canonical))continue}else if(!B.filter(new s.z(this.tileID.overscaledZ),ye))continue;const Se=y.getId(ye,E),ke=new s.a9(ye,O,H,ee,Se);ke.tile=te,o.push(ke)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const f=this.expirationTime;if(o.cacheControl){const y=s.aa(o.cacheControl);y["max-age"]&&(this.expirationTime=Date.now()+1e3*y["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const y=Date.now();let b=!1;if(this.expirationTime>y)b=!1;else if(f)if(this.expirationTime<f)b=!0;else{const E=this.expirationTime-f;E?this.expirationTime=y+Math.max(E,3e4):b=!0}else b=!0;b?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(o,f){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(o).length===0)return;const y=this.latestFeatureIndex.loadVTLayers();for(const b in this.buckets){if(!f.style.hasLayer(b))continue;const E=this.buckets[b],R=E.layers[0].sourceLayer||"_geojsonTileLayer",B=y[R],O=o[R];if(!B||!O||Object.keys(O).length===0)continue;E.update(O,B,this.imageAtlas&&this.imageAtlas.patternPositions||{});const H=f&&f.style&&f.style.getLayer(b);H&&(this.queryPadding=Math.max(this.queryPadding,H.queryRadius(E)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<v.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=v.now()+o}setDependencies(o,f){const y={};for(const b of f)y[b]=!0;this.dependencies[o]=y}hasDependency(o,f){for(const y of o){const b=this.dependencies[y];if(b){for(const E of f)if(b[E])return!0}}return!1}}class le{constructor(o,f){this.max=o,this.onRemove=f,this.reset()}reset(){for(const o in this.data)for(const f of this.data[o])f.timeout&&clearTimeout(f.timeout),this.onRemove(f.value);return this.data={},this.order=[],this}add(o,f,y){const b=o.wrapped().key;this.data[b]===void 0&&(this.data[b]=[]);const E={value:f,timeout:void 0};if(y!==void 0&&(E.timeout=setTimeout(()=>{this.remove(o,E)},y)),this.data[b].push(E),this.order.push(b),this.order.length>this.max){const R=this._getAndRemoveByKey(this.order[0]);R&&this.onRemove(R)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const f=this.data[o].shift();return f.timeout&&clearTimeout(f.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),f.value}getByKey(o){const f=this.data[o];return f?f[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,f){if(!this.has(o))return this;const y=o.wrapped().key,b=f===void 0?0:this.data[y].indexOf(f),E=this.data[y][b];return this.data[y].splice(b,1),E.timeout&&clearTimeout(E.timeout),this.data[y].length===0&&delete this.data[y],this.onRemove(E.value),this.order.splice(this.order.indexOf(y),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}filter(o){const f=[];for(const y in this.data)for(const b of this.data[y])o(b.value)||f.push(b);for(const y of f)this.remove(y.value.tileID,y)}}class Be{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,f,y){const b=String(f);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][b]=this.stateChanges[o][b]||{},s.e(this.stateChanges[o][b],y),this.deletedStates[o]===null){this.deletedStates[o]={};for(const E in this.state[o])E!==b&&(this.deletedStates[o][E]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][b]===null){this.deletedStates[o][b]={};for(const E in this.state[o][b])y[E]||(this.deletedStates[o][b][E]=null)}else for(const E in y)this.deletedStates[o]&&this.deletedStates[o][b]&&this.deletedStates[o][b][E]===null&&delete this.deletedStates[o][b][E]}removeFeatureState(o,f,y){if(this.deletedStates[o]===null)return;const b=String(f);if(this.deletedStates[o]=this.deletedStates[o]||{},y&&f!==void 0)this.deletedStates[o][b]!==null&&(this.deletedStates[o][b]=this.deletedStates[o][b]||{},this.deletedStates[o][b][y]=null);else if(f!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][b])for(y in this.deletedStates[o][b]={},this.stateChanges[o][b])this.deletedStates[o][b][y]=null;else this.deletedStates[o][b]=null;else this.deletedStates[o]=null}getState(o,f){const y=String(f),b=s.e({},(this.state[o]||{})[y],(this.stateChanges[o]||{})[y]);if(this.deletedStates[o]===null)return{};if(this.deletedStates[o]){const E=this.deletedStates[o][f];if(E===null)return{};for(const R in E)delete b[R]}return b}initializeTileState(o,f){o.setFeatureState(this.state,f)}coalesceChanges(o,f){const y={};for(const b in this.stateChanges){this.state[b]=this.state[b]||{};const E={};for(const R in this.stateChanges[b])this.state[b][R]||(this.state[b][R]={}),s.e(this.state[b][R],this.stateChanges[b][R]),E[R]=this.state[b][R];y[b]=E}for(const b in this.deletedStates){this.state[b]=this.state[b]||{};const E={};if(this.deletedStates[b]===null)for(const R in this.state[b])E[R]={},this.state[b][R]={};else for(const R in this.deletedStates[b]){if(this.deletedStates[b][R]===null)this.state[b][R]={};else for(const B of Object.keys(this.deletedStates[b][R]))delete this.state[b][R][B];E[R]=this.state[b][R]}y[b]=y[b]||{},s.e(y[b],E)}if(this.stateChanges={},this.deletedStates={},Object.keys(y).length!==0)for(const b in o)o[b].setFeatureState(y,f)}}class qe extends s.E{constructor(o,f,y){super(),this.id=o,this.dispatcher=y,this.on("data",b=>this._dataHandler(b)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((b,E,R,B)=>{const O=new(ar(E.type))(b,E,R,B);if(O.id!==b)throw new Error(`Expected Source id to be ${b} instead of ${O.id}`);return O})(o,f,y,this),this._tiles={},this._cache=new le(0,b=>this._unloadTile(b)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Be,this._didEmitContent=!1,this._updated=!1}onAdd(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._maxTileCacheZoomLevels=o?o._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(o)}onRemove(o){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(o)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const o in this._tiles){const f=this._tiles[o];if(f.state!=="loaded"&&f.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(o,f,y){return s._(this,void 0,void 0,function*(){try{yield this._source.loadTile(o),this._tileLoaded(o,f,y)}catch(b){o.state="errored",b.status!==404?this._source.fire(new s.j(b,{tile:o})):this.update(this.transform,this.terrain)}})}_unloadTile(o){this._source.unloadTile&&this._source.unloadTile(o)}_abortTile(o){this._source.abortTile&&this._source.abortTile(o),this._source.fire(new s.k("dataabort",{tile:o,coord:o.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const f in this._tiles){const y=this._tiles[f];y.upload(o),y.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(st).map(o=>o.key)}getRenderableIds(o){const f=[];for(const y in this._tiles)this._isIdRenderable(y,o)&&f.push(this._tiles[y]);return o?f.sort((y,b)=>{const E=y.tileID,R=b.tileID,B=new s.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle),O=new s.P(R.canonical.x,R.canonical.y)._rotate(this.transform.angle);return E.overscaledZ-R.overscaledZ||O.y-B.y||O.x-B.x}).map(y=>y.tileID.key):f.map(y=>y.tileID).sort(st).map(y=>y.key)}hasRenderableParent(o){const f=this.findLoadedParent(o,0);return!!f&&this._isIdRenderable(f.tileID.key)}_isIdRenderable(o,f){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(f||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(o,"reloading")}}_reloadTile(o,f){return s._(this,void 0,void 0,function*(){const y=this._tiles[o];y&&(y.state!=="loading"&&(y.state=f),yield this._loadTile(y,o,f))})}_tileLoaded(o,f,y){o.timeAdded=v.now(),y==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(f,o),this.getSource().type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),o.aborted||this._source.fire(new s.k("data",{dataType:"source",tile:o,coord:o.tileID}))}_backfillDEM(o){const f=this.getRenderableIds();for(let b=0;b<f.length;b++){const E=f[b];if(o.neighboringTiles&&o.neighboringTiles[E]){const R=this.getTileByID(E);y(o,R),y(R,o)}}function y(b,E){b.needsHillshadePrepare=!0,b.needsTerrainPrepare=!0;let R=E.tileID.canonical.x-b.tileID.canonical.x;const B=E.tileID.canonical.y-b.tileID.canonical.y,O=Math.pow(2,b.tileID.canonical.z),H=E.tileID.key;R===0&&B===0||Math.abs(B)>1||(Math.abs(R)>1&&(Math.abs(R+O)===1?R+=O:Math.abs(R-O)===1&&(R-=O)),E.dem&&b.dem&&(b.dem.backfillBorder(E.dem,R,B),b.neighboringTiles&&b.neighboringTiles[H]&&(b.neighboringTiles[H].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,f,y,b){for(const E in this._tiles){let R=this._tiles[E];if(b[E]||!R.hasData()||R.tileID.overscaledZ<=f||R.tileID.overscaledZ>y)continue;let B=R.tileID;for(;R&&R.tileID.overscaledZ>f+1;){const H=R.tileID.scaledTo(R.tileID.overscaledZ-1);R=this._tiles[H.key],R&&R.hasData()&&(B=H)}let O=B;for(;O.overscaledZ>f;)if(O=O.scaledTo(O.overscaledZ-1),o[O.key]){b[B.key]=B;break}}}findLoadedParent(o,f){if(o.key in this._loadedParentTiles){const y=this._loadedParentTiles[o.key];return y&&y.tileID.overscaledZ>=f?y:null}for(let y=o.overscaledZ-1;y>=f;y--){const b=o.scaledTo(y),E=this._getLoadedTile(b);if(E)return E}}findLoadedSibling(o){return this._getLoadedTile(o)}_getLoadedTile(o){const f=this._tiles[o.key];return f&&f.hasData()?f:this._cache.getByKey(o.wrapped().key)}updateCacheSize(o){const f=Math.ceil(o.width/this._source.tileSize)+1,y=Math.ceil(o.height/this._source.tileSize)+1,b=Math.floor(f*y*(this._maxTileCacheZoomLevels===null?s.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),E=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(E)}handleWrapJump(o){const f=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,f){const y={};for(const b in this._tiles){const E=this._tiles[b];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+f),y[E.tileID.key]=E}this._tiles=y;for(const b in this._timers)clearTimeout(this._timers[b]),delete this._timers[b];for(const b in this._tiles)this._setTileReloadTimer(b,this._tiles[b])}}_updateCoveredAndRetainedTiles(o,f,y,b,E,R){const B={},O={},H=Object.keys(o),ee=v.now();for(const te of H){const he=o[te],ye=this._tiles[te];if(!ye||ye.fadeEndTime!==0&&ye.fadeEndTime<=ee)continue;const Se=this.findLoadedParent(he,f),ke=this.findLoadedSibling(he),Ae=Se||ke||null;Ae&&(this._addTile(Ae.tileID),B[Ae.tileID.key]=Ae.tileID),O[te]=he}this._retainLoadedChildren(O,b,y,o);for(const te in B)o[te]||(this._coveredTiles[te]=!0,o[te]=B[te]);if(R){const te={},he={};for(const ye of E)this._tiles[ye.key].hasData()?te[ye.key]=ye:he[ye.key]=ye;for(const ye in he){const Se=he[ye].children(this._source.maxzoom);this._tiles[Se[0].key]&&this._tiles[Se[1].key]&&this._tiles[Se[2].key]&&this._tiles[Se[3].key]&&(te[Se[0].key]=o[Se[0].key]=Se[0],te[Se[1].key]=o[Se[1].key]=Se[1],te[Se[2].key]=o[Se[2].key]=Se[2],te[Se[3].key]=o[Se[3].key]=Se[3],delete he[ye])}for(const ye in he){const Se=he[ye],ke=this.findLoadedParent(Se,this._source.minzoom),Ae=this.findLoadedSibling(Se),Me=ke||Ae||null;if(Me){te[Me.tileID.key]=o[Me.tileID.key]=Me.tileID;for(const Re in te)te[Re].isChildOf(Me.tileID)&&delete te[Re]}}for(const ye in this._tiles)te[ye]||(this._coveredTiles[ye]=!0)}}update(o,f){if(!this._sourceLoaded||this._paused)return;let y;this.transform=o,this.terrain=f,this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?y=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(ee=>new s.S(ee.canonical.z,ee.wrap,ee.canonical.z,ee.canonical.x,ee.canonical.y)):(y=o.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:f}),this._source.hasTile&&(y=y.filter(ee=>this._source.hasTile(ee)))):y=[];const b=o.coveringZoomLevel(this._source),E=Math.max(b-qe.maxOverzooming,this._source.minzoom),R=Math.max(b+qe.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const ee={};for(const te of y)if(te.canonical.z>this._source.minzoom){const he=te.scaledTo(te.canonical.z-1);ee[he.key]=he;const ye=te.scaledTo(Math.max(this._source.minzoom,Math.min(te.canonical.z,5)));ee[ye.key]=ye}y=y.concat(Object.values(ee))}const B=y.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,B&&this.fire(new s.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const O=this._updateRetainedTiles(y,b);ut(this._source.type)&&this._updateCoveredAndRetainedTiles(O,E,R,b,y,f);for(const ee in O)this._tiles[ee].clearFadeHold();const H=s.ab(this._tiles,O);for(const ee of H){const te=this._tiles[ee];te.hasSymbolBuckets&&!te.holdingForFade()?te.setHoldDuration(this.map._fadeDuration):te.hasSymbolBuckets&&!te.symbolFadeFinished()||this._removeTile(ee)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)}_updateRetainedTiles(o,f){var y;const b={},E={},R=Math.max(f-qe.maxOverzooming,this._source.minzoom),B=Math.max(f+qe.maxUnderzooming,this._source.minzoom),O={};for(const H of o){const ee=this._addTile(H);b[H.key]=H,ee.hasData()||f<this._source.maxzoom&&(O[H.key]=H)}this._retainLoadedChildren(O,f,B,b);for(const H of o){let ee=this._tiles[H.key];if(ee.hasData())continue;if(f+1>this._source.maxzoom){const he=H.children(this._source.maxzoom)[0],ye=this.getTile(he);if(ye&&ye.hasData()){b[he.key]=he;continue}}else{const he=H.children(this._source.maxzoom);if(b[he[0].key]&&b[he[1].key]&&b[he[2].key]&&b[he[3].key])continue}let te=ee.wasRequested();for(let he=H.overscaledZ-1;he>=R;--he){const ye=H.scaledTo(he);if(E[ye.key])break;if(E[ye.key]=!0,ee=this.getTile(ye),!ee&&te&&(ee=this._addTile(ye)),ee){const Se=ee.hasData();if((Se||!(!((y=this.map)===null||y===void 0)&&y.cancelPendingTileRequestsWhileZooming)||te)&&(b[ye.key]=ye),te=ee.wasRequested(),Se)break}}}return b}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const f=[];let y,b=this._tiles[o].tileID;for(;b.overscaledZ>0;){if(b.key in this._loadedParentTiles){y=this._loadedParentTiles[b.key];break}f.push(b.key);const E=b.scaledTo(b.overscaledZ-1);if(y=this._getLoadedTile(E),y)break;b=E}for(const E of f)this._loadedParentTiles[E]=y}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const o in this._tiles){const f=this._tiles[o].tileID,y=this._getLoadedTile(f);this._loadedSiblingTiles[f.key]=y}}_addTile(o){let f=this._tiles[o.key];if(f)return f;f=this._cache.getAndRemove(o),f&&(this._setTileReloadTimer(o.key,f),f.tileID=o,this._state.initializeTileState(f,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,f)));const y=f;return f||(f=new dt(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(f,o.key,f.state)),f.uses++,this._tiles[o.key]=f,y||this._source.fire(new s.k("dataloading",{tile:f,coord:f.tileID,dataType:"source"})),f}_setTileReloadTimer(o,f){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const y=f.getExpiryTimeout();y&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},y))}_removeTile(o){const f=this._tiles[o];f&&(f.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),f.uses>0||(f.hasData()&&f.state!=="reloading"?this._cache.add(f.tileID,f,f.getExpiryTimeout()):(f.aborted=!0,this._abortTile(f),this._unloadTile(f))))}_dataHandler(o){const f=o.sourceDataType;o.dataType==="source"&&f==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&o.dataType==="source"&&f==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(o);this._cache.reset()}tilesIn(o,f,y){const b=[],E=this.transform;if(!E)return b;const R=y?E.getCameraQueryGeometry(o):o,B=o.map(Se=>E.pointCoordinate(Se,this.terrain)),O=R.map(Se=>E.pointCoordinate(Se,this.terrain)),H=this.getIds();let ee=1/0,te=1/0,he=-1/0,ye=-1/0;for(const Se of O)ee=Math.min(ee,Se.x),te=Math.min(te,Se.y),he=Math.max(he,Se.x),ye=Math.max(ye,Se.y);for(let Se=0;Se<H.length;Se++){const ke=this._tiles[H[Se]];if(ke.holdingForFade())continue;const Ae=ke.tileID,Me=Math.pow(2,E.zoom-ke.tileID.overscaledZ),Re=f*ke.queryPadding*s.X/ke.tileSize/Me,Ee=[Ae.getTilePoint(new s.Z(ee,te)),Ae.getTilePoint(new s.Z(he,ye))];if(Ee[0].x-Re<s.X&&Ee[0].y-Re<s.X&&Ee[1].x+Re>=0&&Ee[1].y+Re>=0){const Ve=B.map(tt=>Ae.getTilePoint(tt)),Ge=O.map(tt=>Ae.getTilePoint(tt));b.push({tile:ke,tileID:Ae,queryGeometry:Ve,cameraQueryGeometry:Ge,scale:Me})}}return b}getVisibleCoordinates(o){const f=this.getRenderableIds(o).map(y=>this._tiles[y].tileID);for(const y of f)y.posMatrix=this.transform.calculatePosMatrix(y.toUnwrapped());return f}hasTransition(){if(this._source.hasTransition())return!0;if(ut(this._source.type)){const o=v.now();for(const f in this._tiles)if(this._tiles[f].fadeEndTime>=o)return!0}return!1}setFeatureState(o,f,y){this._state.updateState(o=o||"_geojsonTileLayer",f,y)}removeFeatureState(o,f,y){this._state.removeFeatureState(o=o||"_geojsonTileLayer",f,y)}getFeatureState(o,f){return this._state.getState(o=o||"_geojsonTileLayer",f)}setDependencies(o,f,y){const b=this._tiles[o];b&&b.setDependencies(f,y)}reloadTilesForDependencies(o,f){for(const y in this._tiles)this._tiles[y].hasDependency(o,f)&&this._reloadTile(y,"reloading");this._cache.filter(y=>!y.hasDependency(o,f))}}function st(C,o){const f=Math.abs(2*C.wrap)-+(C.wrap<0),y=Math.abs(2*o.wrap)-+(o.wrap<0);return C.overscaledZ-o.overscaledZ||y-f||o.canonical.y-C.canonical.y||o.canonical.x-C.canonical.x}function ut(C){return C==="raster"||C==="image"||C==="video"}qe.maxOverzooming=10,qe.maxUnderzooming=3;class vt{constructor(o,f){this.reset(o,f)}reset(o,f){this.points=o||[],this._distances=[0];for(let y=1;y<this.points.length;y++)this._distances[y]=this._distances[y-1]+this.points[y].dist(this.points[y-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=s.ac(o,0,1);let f=1,y=this._distances[f];const b=o*this.paddedLength+this.padding;for(;y<b&&f<this._distances.length;)y=this._distances[++f];const E=f-1,R=this._distances[E],B=y-R,O=B>0?(b-R)/B:0;return this.points[E].mult(1-O).add(this.points[f].mult(O))}}function gt(C,o){let f=!0;return C==="always"||C!=="never"&&o!=="never"||(f=!1),f}class Ut{constructor(o,f,y){const b=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(o/y),this.yCellCount=Math.ceil(f/y);for(let R=0;R<this.xCellCount*this.yCellCount;R++)b.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=f,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,f,y,b,E){this._forEachCell(f,y,b,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(f),this.bboxes.push(y),this.bboxes.push(b),this.bboxes.push(E)}insertCircle(o,f,y,b){this._forEachCell(f-b,y-b,f+b,y+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(f),this.circles.push(y),this.circles.push(b)}_insertBoxCell(o,f,y,b,E,R){this.boxCells[E].push(R)}_insertCircleCell(o,f,y,b,E,R){this.circleCells[E].push(R)}_query(o,f,y,b,E,R,B){if(y<0||o>this.width||b<0||f>this.height)return[];const O=[];if(o<=0&&f<=0&&this.width<=y&&this.height<=b){if(E)return[{key:null,x1:o,y1:f,x2:y,y2:b}];for(let H=0;H<this.boxKeys.length;H++)O.push({key:this.boxKeys[H],x1:this.bboxes[4*H],y1:this.bboxes[4*H+1],x2:this.bboxes[4*H+2],y2:this.bboxes[4*H+3]});for(let H=0;H<this.circleKeys.length;H++){const ee=this.circles[3*H],te=this.circles[3*H+1],he=this.circles[3*H+2];O.push({key:this.circleKeys[H],x1:ee-he,y1:te-he,x2:ee+he,y2:te+he})}}else this._forEachCell(o,f,y,b,this._queryCell,O,{hitTest:E,overlapMode:R,seenUids:{box:{},circle:{}}},B);return O}query(o,f,y,b){return this._query(o,f,y,b,!1,null)}hitTest(o,f,y,b,E,R){return this._query(o,f,y,b,!0,E,R).length>0}hitTestCircle(o,f,y,b,E){const R=o-y,B=o+y,O=f-y,H=f+y;if(B<0||R>this.width||H<0||O>this.height)return!1;const ee=[];return this._forEachCell(R,O,B,H,this._queryCellCircle,ee,{hitTest:!0,overlapMode:b,circle:{x:o,y:f,radius:y},seenUids:{box:{},circle:{}}},E),ee.length>0}_queryCell(o,f,y,b,E,R,B,O){const{seenUids:H,hitTest:ee,overlapMode:te}=B,he=this.boxCells[E];if(he!==null){const Se=this.bboxes;for(const ke of he)if(!H.box[ke]){H.box[ke]=!0;const Ae=4*ke,Me=this.boxKeys[ke];if(o<=Se[Ae+2]&&f<=Se[Ae+3]&&y>=Se[Ae+0]&&b>=Se[Ae+1]&&(!O||O(Me))&&(!ee||!gt(te,Me.overlapMode))&&(R.push({key:Me,x1:Se[Ae],y1:Se[Ae+1],x2:Se[Ae+2],y2:Se[Ae+3]}),ee))return!0}}const ye=this.circleCells[E];if(ye!==null){const Se=this.circles;for(const ke of ye)if(!H.circle[ke]){H.circle[ke]=!0;const Ae=3*ke,Me=this.circleKeys[ke];if(this._circleAndRectCollide(Se[Ae],Se[Ae+1],Se[Ae+2],o,f,y,b)&&(!O||O(Me))&&(!ee||!gt(te,Me.overlapMode))){const Re=Se[Ae],Ee=Se[Ae+1],Ve=Se[Ae+2];if(R.push({key:Me,x1:Re-Ve,y1:Ee-Ve,x2:Re+Ve,y2:Ee+Ve}),ee)return!0}}}return!1}_queryCellCircle(o,f,y,b,E,R,B,O){const{circle:H,seenUids:ee,overlapMode:te}=B,he=this.boxCells[E];if(he!==null){const Se=this.bboxes;for(const ke of he)if(!ee.box[ke]){ee.box[ke]=!0;const Ae=4*ke,Me=this.boxKeys[ke];if(this._circleAndRectCollide(H.x,H.y,H.radius,Se[Ae+0],Se[Ae+1],Se[Ae+2],Se[Ae+3])&&(!O||O(Me))&&!gt(te,Me.overlapMode))return R.push(!0),!0}}const ye=this.circleCells[E];if(ye!==null){const Se=this.circles;for(const ke of ye)if(!ee.circle[ke]){ee.circle[ke]=!0;const Ae=3*ke,Me=this.circleKeys[ke];if(this._circlesCollide(Se[Ae],Se[Ae+1],Se[Ae+2],H.x,H.y,H.radius)&&(!O||O(Me))&&!gt(te,Me.overlapMode))return R.push(!0),!0}}}_forEachCell(o,f,y,b,E,R,B,O){const H=this._convertToXCellCoord(o),ee=this._convertToYCellCoord(f),te=this._convertToXCellCoord(y),he=this._convertToYCellCoord(b);for(let ye=H;ye<=te;ye++)for(let Se=ee;Se<=he;Se++)if(E.call(this,o,f,y,b,this.xCellCount*Se+ye,R,B,O))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,f,y,b,E,R){const B=b-o,O=E-f,H=y+R;return H*H>B*B+O*O}_circleAndRectCollide(o,f,y,b,E,R,B){const O=(R-b)/2,H=Math.abs(o-(b+O));if(H>O+y)return!1;const ee=(B-E)/2,te=Math.abs(f-(E+ee));if(te>ee+y)return!1;if(H<=O||te<=ee)return!0;const he=H-O,ye=te-ee;return he*he+ye*ye<=y*y}}function Ot(C,o,f,y,b){const E=s.H();return o?(s.K(E,E,[1/b,1/b,1]),f||s.ad(E,E,y.angle)):s.L(E,y.labelPlaneMatrix,C),E}function Kt(C,o,f,y,b){if(o){const E=s.ae(C);return s.K(E,E,[b,b,1]),f||s.ad(E,E,-y.angle),E}return y.glCoordMatrix}function we(C,o,f,y){let b;y?(b=[C,o,y(C,o),1],s.af(b,b,f)):(b=[C,o,0,1],yr(b,b,f));const E=b[3];return{point:new s.P(b[0]/E,b[1]/E),signedDistanceFromCamera:E,isOccluded:!1}}function ne(C,o){return .5+C/o*.5}function re(C,o){return C.x>=-o[0]&&C.x<=o[0]&&C.y>=-o[1]&&C.y<=o[1]}function pe(C,o,f,y,b,E,R,B,O,H,ee,te,he,ye,Se){const ke=y?C.textSizeData:C.iconSizeData,Ae=s.ag(ke,f.transform.zoom),Me=[256/f.width*2+1,256/f.height*2+1],Re=y?C.text.dynamicLayoutVertexArray:C.icon.dynamicLayoutVertexArray;Re.clear();const Ee=C.lineVertexArray,Ve=y?C.text.placedSymbolArray:C.icon.placedSymbolArray,Ge=f.transform.width/f.transform.height;let tt=!1;for(let yt=0;yt<Ve.length;yt++){const Ct=Ve.get(yt);if(Ct.hidden||Ct.writingMode===s.ah.vertical&&!tt){Ft(Ct.numGlyphs,Re);continue}tt=!1;const Rt=we(Ct.anchorX,Ct.anchorY,o,Se);if(!re(Rt.point,Me)){Ft(Ct.numGlyphs,Re);continue}const qt=ne(f.transform.cameraToCenterDistance,Rt.signedDistanceFromCamera),Nt=s.ai(ke,Ae,Ct),It=R?Nt/qt:Nt*qt,Jt={getElevation:Se,labelPlaneMatrix:b,lineVertexArray:Ee,pitchWithMap:R,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:H,tileAnchorPoint:new s.P(Ct.anchorX,Ct.anchorY),unwrappedTileID:ee,width:te,height:he,translation:ye},vr=De(Jt,Ct,It,!1,B,o,E,C.glyphOffsetArray,Re,Ge,O);tt=vr.useVertical,(vr.notEnoughRoom||tt||vr.needsFlipping&&De(Jt,Ct,It,!0,B,o,E,C.glyphOffsetArray,Re,Ge,O).notEnoughRoom)&&Ft(Ct.numGlyphs,Re)}y?C.text.dynamicLayoutVertexBuffer.updateData(Re):C.icon.dynamicLayoutVertexBuffer.updateData(Re)}function _e(C,o,f,y,b,E,R,B){const O=E.glyphStartIndex+E.numGlyphs,H=E.lineStartIndex,ee=E.lineStartIndex+E.lineLength,te=o.getoffsetX(E.glyphStartIndex),he=o.getoffsetX(O-1),ye=wt(C*te,f,y,b,E.segment,H,ee,B,R);if(!ye)return null;const Se=wt(C*he,f,y,b,E.segment,H,ee,B,R);return Se?B.projectionCache.anyProjectionOccluded?null:{first:ye,last:Se}:null}function Ne(C,o,f,y){return C===s.ah.horizontal&&Math.abs(f.y-o.y)>Math.abs(f.x-o.x)*y?{useVertical:!0}:(C===s.ah.vertical?o.y<f.y:o.x>f.x)?{needsFlipping:!0}:null}function De(C,o,f,y,b,E,R,B,O,H,ee){const te=f/24,he=o.lineOffsetX*te,ye=o.lineOffsetY*te;let Se;if(o.numGlyphs>1){const ke=o.glyphStartIndex+o.numGlyphs,Ae=o.lineStartIndex,Me=o.lineStartIndex+o.lineLength,Re=_e(te,B,he,ye,y,o,ee,C);if(!Re)return{notEnoughRoom:!0};const Ee=we(Re.first.point.x,Re.first.point.y,R,C.getElevation).point,Ve=we(Re.last.point.x,Re.last.point.y,R,C.getElevation).point;if(b&&!y){const Ge=Ne(o.writingMode,Ee,Ve,H);if(Ge)return Ge}Se=[Re.first];for(let Ge=o.glyphStartIndex+1;Ge<ke-1;Ge++)Se.push(wt(te*B.getoffsetX(Ge),he,ye,y,o.segment,Ae,Me,C,ee));Se.push(Re.last)}else{if(b&&!y){const Ae=we(C.tileAnchorPoint.x,C.tileAnchorPoint.y,E,C.getElevation).point,Me=o.lineStartIndex+o.segment+1,Re=new s.P(C.lineVertexArray.getx(Me),C.lineVertexArray.gety(Me)),Ee=we(Re.x,Re.y,E,C.getElevation),Ve=Ee.signedDistanceFromCamera>0?Ee.point:function(tt,yt,Ct,Rt,qt,Nt){return Ue(tt,yt,Ct,1,qt,Nt)}(C.tileAnchorPoint,Re,Ae,0,E,C),Ge=Ne(o.writingMode,Ae,Ve,H);if(Ge)return Ge}const ke=wt(te*B.getoffsetX(o.glyphStartIndex),he,ye,y,o.segment,o.lineStartIndex,o.lineStartIndex+o.lineLength,C,ee);if(!ke||C.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};Se=[ke]}for(const ke of Se)s.aj(O,ke.point,ke.angle);return{}}function Ue(C,o,f,y,b,E){const R=C.add(C.sub(o)._unit()),B=b!==void 0?we(R.x,R.y,b,E.getElevation).point:rt(R.x,R.y,E).point,O=f.sub(B);return f.add(O._mult(y/O.mag()))}function Te(C,o,f){const y=o.projectionCache;if(y.projections[C])return y.projections[C];const b=new s.P(o.lineVertexArray.getx(C),o.lineVertexArray.gety(C)),E=rt(b.x,b.y,o);if(E.signedDistanceFromCamera>0)return y.projections[C]=E.point,y.anyProjectionOccluded=y.anyProjectionOccluded||E.isOccluded,E.point;const R=C-f.direction;return function(B,O,H,ee,te){return Ue(B,O,H,ee,void 0,te)}(f.distanceFromAnchor===0?o.tileAnchorPoint:new s.P(o.lineVertexArray.getx(R),o.lineVertexArray.gety(R)),b,f.previousVertex,f.absOffsetX-f.distanceFromAnchor+1,o)}function rt(C,o,f){const y=C+f.translation[0],b=o+f.translation[1];let E;return!f.pitchWithMap&&f.projection.useSpecialProjectionForSymbols?(E=f.projection.projectTileCoordinates(y,b,f.unwrappedTileID,f.getElevation),E.point.x=(.5*E.point.x+.5)*f.width,E.point.y=(.5*-E.point.y+.5)*f.height):(E=we(y,b,f.labelPlaneMatrix,f.getElevation),E.isOccluded=!1),E}function ht(C,o,f){return C._unit()._perp()._mult(o*f)}function Qe(C,o,f,y,b,E,R,B,O){if(B.projectionCache.offsets[C])return B.projectionCache.offsets[C];const H=f.add(o);if(C+O.direction<y||C+O.direction>=b)return B.projectionCache.offsets[C]=H,H;const ee=Te(C+O.direction,B,O),te=ht(ee.sub(f),R,O.direction),he=f.add(te),ye=ee.add(te);return B.projectionCache.offsets[C]=s.ak(E,H,he,ye)||H,B.projectionCache.offsets[C]}function wt(C,o,f,y,b,E,R,B,O){const H=y?C-o:C+o;let ee=H>0?1:-1,te=0;y&&(ee*=-1,te=Math.PI),ee<0&&(te+=Math.PI);let he,ye=ee>0?E+b:E+b+1;B.projectionCache.cachedAnchorPoint?he=B.projectionCache.cachedAnchorPoint:(he=rt(B.tileAnchorPoint.x,B.tileAnchorPoint.y,B).point,B.projectionCache.cachedAnchorPoint=he);let Se,ke,Ae=he,Me=he,Re=0,Ee=0;const Ve=Math.abs(H),Ge=[];let tt;for(;Re+Ee<=Ve;){if(ye+=ee,ye<E||ye>=R)return null;Re+=Ee,Me=Ae,ke=Se;const Rt={absOffsetX:Ve,direction:ee,distanceFromAnchor:Re,previousVertex:Me};if(Ae=Te(ye,B,Rt),f===0)Ge.push(Me),tt=Ae.sub(Me);else{let qt;const Nt=Ae.sub(Me);qt=Nt.mag()===0?ht(Te(ye+ee,B,Rt).sub(Ae),f,ee):ht(Nt,f,ee),ke||(ke=Me.add(qt)),Se=Qe(ye,qt,Ae,E,R,ke,f,B,Rt),Ge.push(ke),tt=Se.sub(ke)}Ee=tt.mag()}const yt=tt._mult((Ve-Re)/Ee)._add(ke||Me),Ct=te+Math.atan2(Ae.y-Me.y,Ae.x-Me.x);return Ge.push(yt),{point:yt,angle:O?Ct:0,path:Ge}}const At=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ft(C,o){for(let f=0;f<C;f++){const y=o.length;o.resize(y+4),o.float32.set(At,3*y)}}function yr(C,o,f){const y=o[0],b=o[1];return C[0]=f[0]*y+f[4]*b+f[12],C[1]=f[1]*y+f[5]*b+f[13],C[3]=f[3]*y+f[7]*b+f[15],C}const ir=100;class _r{constructor(o,f,y=new Ut(o.width+200,o.height+200,25),b=new Ut(o.width+200,o.height+200,25)){this.transform=o,this.mapProjection=f,this.grid=y,this.ignoredGrid=b,this.pitchFactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+ir,this.screenBottomBoundary=o.height+ir,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(o,f,y,b,E,R,B,O,H,ee,te){const he=o.anchorPointX+O[0],ye=o.anchorPointY+O[1],Se=this.projectAndGetPerspectiveRatio(b,he,ye,E,ee),ke=y*Se.perspectiveRatio;let Ae;if(R||B)Ae=this._projectCollisionBox(o,ke,b,E,R,B,O,Se,ee,te);else{const Ge=Se.point.x+(te?te.x*ke:0),tt=Se.point.y+(te?te.y*ke:0);Ae={allPointsOccluded:!1,box:[Ge+o.x1*ke,tt+o.y1*ke,Ge+o.x2*ke,tt+o.y2*ke]}}const[Me,Re,Ee,Ve]=Ae.box;return this.mapProjection.useSpecialProjectionForSymbols&&(R?Ae.allPointsOccluded:this.mapProjection.isOccluded(he,ye,E))||Se.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(Me,Re,Ee,Ve)||f!=="always"&&this.grid.hitTest(Me,Re,Ee,Ve,f,H)?{box:[Me,Re,Ee,Ve],placeable:!1,offscreen:!1}:{box:[Me,Re,Ee,Ve],placeable:!0,offscreen:this.isOffscreen(Me,Re,Ee,Ve)}}placeCollisionCircles(o,f,y,b,E,R,B,O,H,ee,te,he,ye,Se,ke,Ae){const Me=[],Re=new s.P(f.anchorX,f.anchorY),Ee=this.getPerspectiveRatio(R,Re.x,Re.y,B,Ae),Ve=(te?E/Ee:E*Ee)/s.ap,Ge={getElevation:Ae,labelPlaneMatrix:O,lineVertexArray:y,pitchWithMap:te,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:Re,unwrappedTileID:B,width:this.transform.width,height:this.transform.height,translation:ke},tt=_e(Ve,b,f.lineOffsetX*Ve,f.lineOffsetY*Ve,!1,f,!1,Ge);let yt=!1,Ct=!1,Rt=!0;if(tt){const qt=.5*ye*Ee+Se,Nt=new s.P(-100,-100),It=new s.P(this.screenRightBoundary,this.screenBottomBoundary),Jt=new vt,vr=tt.first,Dt=tt.last;let jt=[];for(let Sr=vr.path.length-1;Sr>=1;Sr--)jt.push(vr.path[Sr]);for(let Sr=1;Sr<Dt.path.length;Sr++)jt.push(Dt.path[Sr]);const mr=2.5*qt;if(H){const Sr=this.projectPathToScreenSpace(jt,Ge,H);jt=Sr.some(Pr=>Pr.signedDistanceFromCamera<=0)?[]:Sr.map(Pr=>Pr.point)}let an=[];if(jt.length>0){const Sr=jt[0].clone(),Pr=jt[0].clone();for(let sn=1;sn<jt.length;sn++)Sr.x=Math.min(Sr.x,jt[sn].x),Sr.y=Math.min(Sr.y,jt[sn].y),Pr.x=Math.max(Pr.x,jt[sn].x),Pr.y=Math.max(Pr.y,jt[sn].y);an=Sr.x>=Nt.x&&Pr.x<=It.x&&Sr.y>=Nt.y&&Pr.y<=It.y?[jt]:Pr.x<Nt.x||Sr.x>It.x||Pr.y<Nt.y||Sr.y>It.y?[]:s.al([jt],Nt.x,Nt.y,It.x,It.y)}for(const Sr of an){Jt.reset(Sr,.25*qt);let Pr=0;Pr=Jt.length<=.5*qt?1:Math.ceil(Jt.paddedLength/mr)+1;for(let sn=0;sn<Pr;sn++){const sa=sn/Math.max(Pr-1,1),Ai=Jt.lerp(sa),on=Ai.x+ir,za=Ai.y+ir;Me.push(on,za,qt,0);const xa=on-qt,oa=za-qt,ba=on+qt,Yi=za+qt;if(Rt=Rt&&this.isOffscreen(xa,oa,ba,Yi),Ct=Ct||this.isInsideGrid(xa,oa,ba,Yi),o!=="always"&&this.grid.hitTestCircle(on,za,qt,o,he)&&(yt=!0,!ee))return{circles:[],offscreen:!1,collisionDetected:yt}}}}return{circles:!ee&&yt||!Ct||Ee<this.perspectiveRatioCutoff?[]:Me,offscreen:Rt,collisionDetected:yt}}projectPathToScreenSpace(o,f,y){return o.map(b=>we(b.x,b.y,y,f.getElevation))}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const f=[];let y=1/0,b=1/0,E=-1/0,R=-1/0;for(const ee of o){const te=new s.P(ee.x+ir,ee.y+ir);y=Math.min(y,te.x),b=Math.min(b,te.y),E=Math.max(E,te.x),R=Math.max(R,te.y),f.push(te)}const B=this.grid.query(y,b,E,R).concat(this.ignoredGrid.query(y,b,E,R)),O={},H={};for(const ee of B){const te=ee.key;if(O[te.bucketInstanceId]===void 0&&(O[te.bucketInstanceId]={}),O[te.bucketInstanceId][te.featureIndex])continue;const he=[new s.P(ee.x1,ee.y1),new s.P(ee.x2,ee.y1),new s.P(ee.x2,ee.y2),new s.P(ee.x1,ee.y2)];s.am(f,he)&&(O[te.bucketInstanceId][te.featureIndex]=!0,H[te.bucketInstanceId]===void 0&&(H[te.bucketInstanceId]=[]),H[te.bucketInstanceId].push(te.featureIndex))}return H}insertCollisionBox(o,f,y,b,E,R){(y?this.ignoredGrid:this.grid).insert({bucketInstanceId:b,featureIndex:E,collisionGroupID:R,overlapMode:f},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,f,y,b,E,R){const B=y?this.ignoredGrid:this.grid,O={bucketInstanceId:b,featureIndex:E,collisionGroupID:R,overlapMode:f};for(let H=0;H<o.length;H+=4)B.insertCircle(O,o[H],o[H+1],o[H+2])}projectAndGetPerspectiveRatio(o,f,y,b,E){let R;E?(R=[f,y,E(f,y),1],s.af(R,R,o)):(R=[f,y,0,1],yr(R,R,o));const B=R[3];return{point:new s.P((R[0]/B+1)/2*this.transform.width+ir,(-R[1]/B+1)/2*this.transform.height+ir),perspectiveRatio:.5+this.transform.cameraToCenterDistance/B*.5,isOccluded:!1,signedDistanceFromCamera:B}}getPerspectiveRatio(o,f,y,b,E){const R=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(f,y,b,E):we(f,y,o,E);return .5+this.transform.cameraToCenterDistance/R.signedDistanceFromCamera*.5}isOffscreen(o,f,y,b){return y<ir||o>=this.screenRightBoundary||b<ir||f>this.screenBottomBoundary}isInsideGrid(o,f,y,b){return y>=0&&o<this.gridRightBoundary&&b>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const o=s.an([]);return s.J(o,o,[-100,-100,0]),o}_projectCollisionBox(o,f,y,b,E,R,B,O,H,ee){let te=new s.P(1,0),he=new s.P(0,1);const ye=new s.P(o.anchorPointX+B[0],o.anchorPointY+B[1]);if(R&&!E){const Rt=this.projectAndGetPerspectiveRatio(y,ye.x+1,ye.y,b,H).point.sub(O.point).unit(),qt=Math.atan(Rt.y/Rt.x)+(Rt.x<0?Math.PI:0),Nt=Math.sin(qt),It=Math.cos(qt);te=new s.P(It,Nt),he=new s.P(-Nt,It)}else if(!R&&E){const Rt=-this.transform.angle,qt=Math.sin(Rt),Nt=Math.cos(Rt);te=new s.P(Nt,qt),he=new s.P(-qt,Nt)}let Se=O.point,ke=f;if(E){Se=ye;const Rt=this.transform.zoom-Math.floor(this.transform.zoom);ke=Math.pow(2,-Rt),ke*=this.mapProjection.getPitchedTextCorrection(this.transform,ye,b),ee||(ke*=s.ac(.5+O.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}ee&&(Se=Se.add(te.mult(ee.x*ke)).add(he.mult(ee.y*ke)));const Ae=o.x1*ke,Me=o.x2*ke,Re=(Ae+Me)/2,Ee=o.y1*ke,Ve=o.y2*ke,Ge=(Ee+Ve)/2,tt=[{offsetX:Ae,offsetY:Ee},{offsetX:Re,offsetY:Ee},{offsetX:Me,offsetY:Ee},{offsetX:Me,offsetY:Ge},{offsetX:Me,offsetY:Ve},{offsetX:Re,offsetY:Ve},{offsetX:Ae,offsetY:Ve},{offsetX:Ae,offsetY:Ge}];let yt=[];for(const{offsetX:Rt,offsetY:qt}of tt)yt.push(new s.P(Se.x+te.x*Rt+he.x*qt,Se.y+te.y*Rt+he.y*qt));let Ct=!1;if(E){const Rt=yt.map(qt=>this.projectAndGetPerspectiveRatio(y,qt.x,qt.y,b,H));Ct=Rt.some(qt=>!qt.isOccluded),yt=Rt.map(qt=>qt.point)}else Ct=!0;return{box:s.ao(yt),allPointsOccluded:!Ct}}}function pr(C,o,f){return o*(s.X/(C.tileSize*Math.pow(2,f-C.tileID.overscaledZ)))}class Tr{constructor(o,f,y,b){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?f:-f))):b&&y?1:0,this.placed=y}isHidden(){return this.opacity===0&&!this.placed}}class wr{constructor(o,f,y,b,E){this.text=new Tr(o?o.text:null,f,y,E),this.icon=new Tr(o?o.icon:null,f,b,E)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class sr{constructor(o,f,y){this.text=o,this.icon=f,this.skipFade=y}}class kr{constructor(){this.invProjMatrix=s.H(),this.viewportMatrix=s.H(),this.circles=[]}}class Er{constructor(o,f,y,b,E){this.bucketInstanceId=o,this.featureIndex=f,this.sourceLayerIndex=y,this.bucketIndex=b,this.tileID=E}}class cn{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const f=++this.maxGroupID;this.collisionGroups[o]={ID:f,predicate:y=>y.collisionGroupID===f}}return this.collisionGroups[o]}}function gn(C,o,f,y,b){const{horizontalAlign:E,verticalAlign:R}=s.au(C);return new s.P(-(E-.5)*o+y[0]*b,-(R-.5)*f+y[1]*b)}class wn{constructor(o,f,y,b,E,R){this.transform=o.clone(),this.terrain=y,this.collisionIndex=new _r(this.transform,f),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=b,this.retainedQueryData={},this.collisionGroups=new cn(E),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=R,R&&(R.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(o){const f=this.terrain;return f?(y,b)=>f.getElevation(o,y,b):null}getBucketParts(o,f,y,b){const E=y.getBucket(f),R=y.latestFeatureIndex;if(!E||!R||f.id!==E.layerIds[0])return;const B=y.collisionBoxArray,O=E.layers[0].layout,H=E.layers[0].paint,ee=Math.pow(2,this.transform.zoom-y.tileID.overscaledZ),te=y.tileSize/s.X,he=y.tileID.toUnwrapped(),ye=this.transform.calculatePosMatrix(he),Se=O.get("text-pitch-alignment")==="map",ke=O.get("text-rotation-alignment")==="map",Ae=pr(y,1,this.transform.zoom),Me=this.collisionIndex.mapProjection.translatePosition(this.transform,y,H.get("text-translate"),H.get("text-translate-anchor")),Re=this.collisionIndex.mapProjection.translatePosition(this.transform,y,H.get("icon-translate"),H.get("icon-translate-anchor")),Ee=Ot(ye,Se,ke,this.transform,Ae);let Ve=null;if(Se){const tt=Kt(ye,Se,ke,this.transform,Ae);Ve=s.L([],this.transform.labelPlaneMatrix,tt)}this.retainedQueryData[E.bucketInstanceId]=new Er(E.bucketInstanceId,R,E.sourceLayerIndex,E.index,y.tileID);const Ge={bucket:E,layout:O,translationText:Me,translationIcon:Re,posMatrix:ye,unwrappedTileID:he,textLabelPlaneMatrix:Ee,labelToScreenMatrix:Ve,scale:ee,textPixelRatio:te,holdingForFade:y.holdingForFade(),collisionBoxArray:B,partiallyEvaluatedTextSize:s.ag(E.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(b)for(const tt of E.sortKeyRanges){const{sortKey:yt,symbolInstanceStart:Ct,symbolInstanceEnd:Rt}=tt;o.push({sortKey:yt,symbolInstanceStart:Ct,symbolInstanceEnd:Rt,parameters:Ge})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:Ge})}attemptAnchorPlacement(o,f,y,b,E,R,B,O,H,ee,te,he,ye,Se,ke,Ae,Me,Re,Ee){const Ve=s.aq[o.textAnchor],Ge=[o.textOffset0,o.textOffset1],tt=gn(Ve,y,b,Ge,E),yt=this.collisionIndex.placeCollisionBox(f,he,O,H,ee,B,R,Ae,te.predicate,Ee,tt);if((!Re||this.collisionIndex.placeCollisionBox(Re,he,O,H,ee,B,R,Me,te.predicate,Ee,tt).placeable)&&yt.placeable){let Ct;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ye.crossTileID]&&this.prevPlacement.placements[ye.crossTileID]&&this.prevPlacement.placements[ye.crossTileID].text&&(Ct=this.prevPlacement.variableOffsets[ye.crossTileID].anchor),ye.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[ye.crossTileID]={textOffset:Ge,width:y,height:b,anchor:Ve,textBoxScale:E,prevAnchor:Ct},this.markUsedJustification(Se,Ve,ye,ke),Se.allowVerticalPlacement&&(this.markUsedOrientation(Se,ke,ye),this.placedOrientations[ye.crossTileID]=ke),{shift:tt,placedGlyphBoxes:yt}}}placeLayerBucketPart(o,f,y){const{bucket:b,layout:E,translationText:R,translationIcon:B,posMatrix:O,unwrappedTileID:H,textLabelPlaneMatrix:ee,labelToScreenMatrix:te,textPixelRatio:he,holdingForFade:ye,collisionBoxArray:Se,partiallyEvaluatedTextSize:ke,collisionGroup:Ae}=o.parameters,Me=E.get("text-optional"),Re=E.get("icon-optional"),Ee=s.ar(E,"text-overlap","text-allow-overlap"),Ve=Ee==="always",Ge=s.ar(E,"icon-overlap","icon-allow-overlap"),tt=Ge==="always",yt=E.get("text-rotation-alignment")==="map",Ct=E.get("text-pitch-alignment")==="map",Rt=E.get("icon-text-fit")!=="none",qt=E.get("symbol-z-order")==="viewport-y",Nt=Ve&&(tt||!b.hasIconData()||Re),It=tt&&(Ve||!b.hasTextData()||Me);!b.collisionArrays&&Se&&b.deserializeCollisionBoxes(Se);const Jt=this._getTerrainElevationFunc(this.retainedQueryData[b.bucketInstanceId].tileID),vr=(Dt,jt,mr)=>{var an,Sr;if(f[Dt.crossTileID])return;if(ye)return void(this.placements[Dt.crossTileID]=new sr(!1,!1,!1));let Pr=!1,sn=!1,sa=!0,Ai=null,on={box:null,placeable:!1,offscreen:null},za={placeable:!1},xa=null,oa=null,ba=null,Yi=0,ml=0,dd=0;jt.textFeatureIndex?Yi=jt.textFeatureIndex:Dt.useRuntimeCollisionCircles&&(Yi=Dt.featureIndex),jt.verticalTextFeatureIndex&&(ml=jt.verticalTextFeatureIndex);const gl=jt.textBox;if(gl){const hi=Xn=>{let la=s.ah.horizontal;if(b.allowVerticalPlacement&&!Xn&&this.prevPlacement){const Ya=this.prevPlacement.placedOrientations[Dt.crossTileID];Ya&&(this.placedOrientations[Dt.crossTileID]=Ya,la=Ya,this.markUsedOrientation(b,la,Dt))}return la},fi=(Xn,la)=>{if(b.allowVerticalPlacement&&Dt.numVerticalGlyphVertices>0&&jt.verticalTextBox){for(const Ya of b.writingModes)if(Ya===s.ah.vertical?(on=la(),za=on):on=Xn(),on&&on.placeable)break}else on=Xn()},$s=Dt.textAnchorOffsetStartIndex,Ni=Dt.textAnchorOffsetEndIndex;if(Ni===$s){const Xn=(la,Ya)=>{const Ar=this.collisionIndex.placeCollisionBox(la,Ee,he,O,H,Ct,yt,R,Ae.predicate,Jt);return Ar&&Ar.placeable&&(this.markUsedOrientation(b,Ya,Dt),this.placedOrientations[Dt.crossTileID]=Ya),Ar};fi(()=>Xn(gl,s.ah.horizontal),()=>{const la=jt.verticalTextBox;return b.allowVerticalPlacement&&Dt.numVerticalGlyphVertices>0&&la?Xn(la,s.ah.vertical):{box:null,offscreen:null}}),hi(on&&on.placeable)}else{let Xn=s.aq[(Sr=(an=this.prevPlacement)===null||an===void 0?void 0:an.variableOffsets[Dt.crossTileID])===null||Sr===void 0?void 0:Sr.anchor];const la=(Ar,wo,vl)=>{const yl=Ar.x2-Ar.x1,Rg=Ar.y2-Ar.y1,Fx=Dt.textBoxScale,Lg=Rt&&Ge==="never"?wo:null;let Vs=null,Bg=Ee==="never"?1:2,fd="never";Xn&&Bg++;for(let ju=0;ju<Bg;ju++){for(let pd=$s;pd<Ni;pd++){const md=b.textAnchorOffsets.get(pd);if(Xn&&md.textAnchor!==Xn)continue;const xl=this.attemptAnchorPlacement(md,Ar,yl,Rg,Fx,yt,Ct,he,O,H,Ae,fd,Dt,b,vl,R,B,Lg,Jt);if(xl&&(Vs=xl.placedGlyphBoxes,Vs&&Vs.placeable))return Pr=!0,Ai=xl.shift,Vs}Xn?Xn=null:fd=Ee}return y&&!Vs&&(Vs={box:this.collisionIndex.placeCollisionBox(gl,"always",he,O,H,Ct,yt,R,Ae.predicate,Jt,new s.P(0,0)).box,offscreen:!1,placeable:!1}),Vs};fi(()=>la(gl,jt.iconBox,s.ah.horizontal),()=>{const Ar=jt.verticalTextBox;return b.allowVerticalPlacement&&(!on||!on.placeable)&&Dt.numVerticalGlyphVertices>0&&Ar?la(Ar,jt.verticalIconBox,s.ah.vertical):{box:null,occluded:!0,offscreen:null}}),on&&(Pr=on.placeable,sa=on.offscreen);const Ya=hi(on&&on.placeable);if(!Pr&&this.prevPlacement){const Ar=this.prevPlacement.variableOffsets[Dt.crossTileID];Ar&&(this.variableOffsets[Dt.crossTileID]=Ar,this.markUsedJustification(b,Ar.anchor,Dt,Ya))}}}if(xa=on,Pr=xa&&xa.placeable,sa=xa&&xa.offscreen,Dt.useRuntimeCollisionCircles){const hi=b.text.placedSymbolArray.get(Dt.centerJustifiedTextSymbolIndex),fi=s.ai(b.textSizeData,ke,hi),$s=E.get("text-padding");oa=this.collisionIndex.placeCollisionCircles(Ee,hi,b.lineVertexArray,b.glyphOffsetArray,fi,O,H,ee,te,y,Ct,Ae.predicate,Dt.collisionCircleDiameter,$s,R,Jt),oa.circles.length&&oa.collisionDetected&&!y&&s.w("Collisions detected, but collision boxes are not shown"),Pr=Ve||oa.circles.length>0&&!oa.collisionDetected,sa=sa&&oa.offscreen}if(jt.iconFeatureIndex&&(dd=jt.iconFeatureIndex),jt.iconBox){const hi=fi=>this.collisionIndex.placeCollisionBox(fi,Ge,he,O,H,Ct,yt,B,Ae.predicate,Jt,Rt&&Ai?Ai:void 0);za&&za.placeable&&jt.verticalIconBox?(ba=hi(jt.verticalIconBox),sn=ba.placeable):(ba=hi(jt.iconBox),sn=ba.placeable),sa=sa&&ba.offscreen}const di=Me||Dt.numHorizontalGlyphVertices===0&&Dt.numVerticalGlyphVertices===0,hd=Re||Dt.numIconVertices===0;di||hd?hd?di||(sn=sn&&Pr):Pr=sn&&Pr:sn=Pr=sn&&Pr;const Df=sn&&ba.placeable;if(Pr&&xa.placeable&&this.collisionIndex.insertCollisionBox(xa.box,Ee,E.get("text-ignore-placement"),b.bucketInstanceId,za&&za.placeable&&ml?ml:Yi,Ae.ID),Df&&this.collisionIndex.insertCollisionBox(ba.box,Ge,E.get("icon-ignore-placement"),b.bucketInstanceId,dd,Ae.ID),oa&&Pr&&this.collisionIndex.insertCollisionCircles(oa.circles,Ee,E.get("text-ignore-placement"),b.bucketInstanceId,Yi,Ae.ID),y&&this.storeCollisionData(b.bucketInstanceId,mr,jt,xa,ba,oa),Dt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(b.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Dt.crossTileID]=new sr(Pr||Nt,sn||It,sa||b.justReloaded),f[Dt.crossTileID]=!0};if(qt){if(o.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Dt=b.getSortedSymbolIndexes(this.transform.angle);for(let jt=Dt.length-1;jt>=0;--jt){const mr=Dt[jt];vr(b.symbolInstances.get(mr),b.collisionArrays[mr],mr)}}else for(let Dt=o.symbolInstanceStart;Dt<o.symbolInstanceEnd;Dt++)vr(b.symbolInstances.get(Dt),b.collisionArrays[Dt],Dt);if(y&&b.bucketInstanceId in this.collisionCircleArrays){const Dt=this.collisionCircleArrays[b.bucketInstanceId];s.as(Dt.invProjMatrix,O),Dt.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}storeCollisionData(o,f,y,b,E,R){if(y.textBox||y.iconBox){let B,O;this.collisionBoxArrays.has(o)?B=this.collisionBoxArrays.get(o):(B=new Map,this.collisionBoxArrays.set(o,B)),B.has(f)?O=B.get(f):(O={text:null,icon:null},B.set(f,O)),y.textBox&&(O.text=b.box),y.iconBox&&(O.icon=E.box)}if(R){let B=this.collisionCircleArrays[o];B===void 0&&(B=this.collisionCircleArrays[o]=new kr);for(let O=0;O<R.circles.length;O+=4)B.circles.push(R.circles[O+0]),B.circles.push(R.circles[O+1]),B.circles.push(R.circles[O+2]),B.circles.push(R.collisionDetected?1:0)}}markUsedJustification(o,f,y,b){let E;E=b===s.ah.vertical?y.verticalPlacedTextSymbolIndex:{left:y.leftJustifiedTextSymbolIndex,center:y.centerJustifiedTextSymbolIndex,right:y.rightJustifiedTextSymbolIndex}[s.at(f)];const R=[y.leftJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.rightJustifiedTextSymbolIndex,y.verticalPlacedTextSymbolIndex];for(const B of R)B>=0&&(o.text.placedSymbolArray.get(B).crossTileID=E>=0&&B!==E?0:y.crossTileID)}markUsedOrientation(o,f,y){const b=f===s.ah.horizontal||f===s.ah.horizontalOnly?f:0,E=f===s.ah.vertical?f:0,R=[y.leftJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.rightJustifiedTextSymbolIndex];for(const B of R)o.text.placedSymbolArray.get(B).placedOrientation=b;y.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(y.verticalPlacedTextSymbolIndex).placedOrientation=E)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let y=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const b=f?f.symbolFadeChange(o):1,E=f?f.opacities:{},R=f?f.variableOffsets:{},B=f?f.placedOrientations:{};for(const O in this.placements){const H=this.placements[O],ee=E[O];ee?(this.opacities[O]=new wr(ee,b,H.text,H.icon),y=y||H.text!==ee.text.placed||H.icon!==ee.icon.placed):(this.opacities[O]=new wr(null,b,H.text,H.icon,H.skipFade),y=y||H.text||H.icon)}for(const O in E){const H=E[O];if(!this.opacities[O]){const ee=new wr(H,b,!1,!1);ee.isHidden()||(this.opacities[O]=ee,y=y||H.text.placed||H.icon.placed)}}for(const O in R)this.variableOffsets[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.variableOffsets[O]=R[O]);for(const O in B)this.placedOrientations[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.placedOrientations[O]=B[O]);if(f&&f.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");y?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:o)}updateLayerOpacities(o,f){const y={};for(const b of f){const E=b.getBucket(o);E&&b.latestFeatureIndex&&o.id===E.layerIds[0]&&this.updateBucketOpacities(E,b.tileID,y,b.collisionBoxArray)}}updateBucketOpacities(o,f,y,b){o.hasTextData()&&(o.text.opacityVertexArray.clear(),o.text.hasVisibleVertices=!1),o.hasIconData()&&(o.icon.opacityVertexArray.clear(),o.icon.hasVisibleVertices=!1),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const E=o.layers[0],R=E.layout,B=new wr(null,0,!1,!1,!0),O=R.get("text-allow-overlap"),H=R.get("icon-allow-overlap"),ee=E._unevaluatedLayout.hasValue("text-variable-anchor")||E._unevaluatedLayout.hasValue("text-variable-anchor-offset"),te=R.get("text-rotation-alignment")==="map",he=R.get("text-pitch-alignment")==="map",ye=R.get("icon-text-fit")!=="none",Se=new wr(null,0,O&&(H||!o.hasIconData()||R.get("icon-optional")),H&&(O||!o.hasTextData()||R.get("text-optional")),!0);!o.collisionArrays&&b&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(b);const ke=(Me,Re,Ee)=>{for(let Ve=0;Ve<Re/4;Ve++)Me.opacityVertexArray.emplaceBack(Ee);Me.hasVisibleVertices=Me.hasVisibleVertices||Ee!==Zn},Ae=this.collisionBoxArrays.get(o.bucketInstanceId);for(let Me=0;Me<o.symbolInstances.length;Me++){const Re=o.symbolInstances.get(Me),{numHorizontalGlyphVertices:Ee,numVerticalGlyphVertices:Ve,crossTileID:Ge}=Re;let tt=this.opacities[Ge];y[Ge]?tt=B:tt||(tt=Se,this.opacities[Ge]=tt),y[Ge]=!0;const yt=Re.numIconVertices>0,Ct=this.placedOrientations[Re.crossTileID],Rt=Ct===s.ah.vertical,qt=Ct===s.ah.horizontal||Ct===s.ah.horizontalOnly;if(Ee>0||Ve>0){const It=vn(tt.text);ke(o.text,Ee,Rt?Zn:It),ke(o.text,Ve,qt?Zn:It);const Jt=tt.text.isHidden();[Re.rightJustifiedTextSymbolIndex,Re.centerJustifiedTextSymbolIndex,Re.leftJustifiedTextSymbolIndex].forEach(jt=>{jt>=0&&(o.text.placedSymbolArray.get(jt).hidden=Jt||Rt?1:0)}),Re.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(Re.verticalPlacedTextSymbolIndex).hidden=Jt||qt?1:0);const vr=this.variableOffsets[Re.crossTileID];vr&&this.markUsedJustification(o,vr.anchor,Re,Ct);const Dt=this.placedOrientations[Re.crossTileID];Dt&&(this.markUsedJustification(o,"left",Re,Dt),this.markUsedOrientation(o,Dt,Re))}if(yt){const It=vn(tt.icon),Jt=!(ye&&Re.verticalPlacedIconSymbolIndex&&Rt);Re.placedIconSymbolIndex>=0&&(ke(o.icon,Re.numIconVertices,Jt?It:Zn),o.icon.placedSymbolArray.get(Re.placedIconSymbolIndex).hidden=tt.icon.isHidden()),Re.verticalPlacedIconSymbolIndex>=0&&(ke(o.icon,Re.numVerticalIconVertices,Jt?Zn:It),o.icon.placedSymbolArray.get(Re.verticalPlacedIconSymbolIndex).hidden=tt.icon.isHidden())}const Nt=Ae&&Ae.has(Me)?Ae.get(Me):{text:null,icon:null};if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const It=o.collisionArrays[Me];if(It){let Jt=new s.P(0,0);if(It.textBox||It.verticalTextBox){let vr=!0;if(ee){const Dt=this.variableOffsets[Ge];Dt?(Jt=gn(Dt.anchor,Dt.width,Dt.height,Dt.textOffset,Dt.textBoxScale),te&&Jt._rotate(he?this.transform.angle:-this.transform.angle)):vr=!1}if(It.textBox||It.verticalTextBox){let Dt;It.textBox&&(Dt=Rt),It.verticalTextBox&&(Dt=qt),oi(o.textCollisionBox.collisionVertexArray,tt.text.placed,!vr||Dt,Nt.text,Jt.x,Jt.y)}}if(It.iconBox||It.verticalIconBox){const vr=!!(!qt&&It.verticalIconBox);let Dt;It.iconBox&&(Dt=vr),It.verticalIconBox&&(Dt=!vr),oi(o.iconCollisionBox.collisionVertexArray,tt.icon.placed,Dt,Nt.icon,ye?Jt.x:0,ye?Jt.y:0)}}}}if(o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.text.opacityVertexArray.length!==o.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${o.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${o.text.layoutVertexArray.length}) / 4`);if(o.icon.opacityVertexArray.length!==o.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${o.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${o.icon.layoutVertexArray.length}) / 4`);if(o.bucketInstanceId in this.collisionCircleArrays){const Me=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=Me.invProjMatrix,o.placementViewportMatrix=Me.viewportMatrix,o.collisionCircleArray=Me.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,f){const y=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*y>o}setStale(){this.stale=!0}}function oi(C,o,f,y,b,E){y&&y.length!==0||(y=[0,0,0,0]);const R=y[0]-ir,B=y[1]-ir,O=y[2]-ir,H=y[3]-ir;C.emplaceBack(o?1:0,f?1:0,b||0,E||0,R,B),C.emplaceBack(o?1:0,f?1:0,b||0,E||0,O,B),C.emplaceBack(o?1:0,f?1:0,b||0,E||0,O,H),C.emplaceBack(o?1:0,f?1:0,b||0,E||0,R,H)}const Mr=Math.pow(2,25),Gi=Math.pow(2,24),Wi=Math.pow(2,17),lt=Math.pow(2,16),or=Math.pow(2,9),Fr=Math.pow(2,8),Gr=Math.pow(2,1);function vn(C){if(C.opacity===0&&!C.placed)return 0;if(C.opacity===1&&C.placed)return 4294967295;const o=C.placed?1:0,f=Math.floor(127*C.opacity);return f*Mr+o*Gi+f*Wi+o*lt+f*or+o*Fr+f*Gr+o}const Zn=0;function Fn(){return{isOccluded:(C,o,f)=>!1,getPitchedTextCorrection:(C,o,f)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(C,o,f,y){throw new Error("Not implemented.")},translatePosition:(C,o,f,y)=>function(b,E,R,B,O=!1){if(!R[0]&&!R[1])return[0,0];const H=O?B==="map"?b.angle:0:B==="viewport"?-b.angle:0;if(H){const ee=Math.sin(H),te=Math.cos(H);R=[R[0]*te-R[1]*ee,R[0]*ee+R[1]*te]}return[O?R[0]:pr(E,R[0],b.zoom),O?R[1]:pr(E,R[1],b.zoom)]}(C,o,f,y),getCircleRadiusCorrection:C=>1}}class jr{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&!o.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,f,y,b,E){const R=this._bucketParts;for(;this._currentTileIndex<o.length;)if(f.getBucketParts(R,b,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,R.sort((B,O)=>B.sortKey-O.sortKey));this._currentPartIndex<R.length;)if(f.placeLayerBucketPart(R[this._currentPartIndex],this._seenCrossTileIDs,y),this._currentPartIndex++,E())return!0;return!1}}class ps{constructor(o,f,y,b,E,R,B,O){this.placement=new wn(o,Fn(),f,R,B,O),this._currentPlacementIndex=y.length-1,this._forceFullPlacement=b,this._showCollisionBoxes=E,this._done=!1}isDone(){return this._done}continuePlacement(o,f,y){const b=v.now(),E=()=>!this._forceFullPlacement&&v.now()-b>2;for(;this._currentPlacementIndex>=0;){const R=f[o[this._currentPlacementIndex]],B=this.placement.collisionIndex.transform.zoom;if(R.type==="symbol"&&(!R.minzoom||R.minzoom<=B)&&(!R.maxzoom||R.maxzoom>B)){if(this._inProgressLayer||(this._inProgressLayer=new jr(R)),this._inProgressLayer.continuePlacement(y[R.source],this.placement,this._showCollisionBoxes,R,E))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const Na=512/s.X/2;class Qr{constructor(o,f,y){this.tileID=o,this.bucketInstanceId=y,this._symbolsByKey={};const b=new Map;for(let E=0;E<f.length;E++){const R=f.get(E),B=R.key,O=b.get(B);O?O.push(R):b.set(B,[R])}for(const[E,R]of b){const B={positions:R.map(O=>({x:Math.floor(O.anchorX*Na),y:Math.floor(O.anchorY*Na)})),crossTileIDs:R.map(O=>O.crossTileID)};if(B.positions.length>128){const O=new s.av(B.positions.length,16,Uint16Array);for(const{x:H,y:ee}of B.positions)O.add(H,ee);O.finish(),delete B.positions,B.index=O}this._symbolsByKey[E]=B}}getScaledCoordinates(o,f){const{x:y,y:b,z:E}=this.tileID.canonical,{x:R,y:B,z:O}=f.canonical,H=Na/Math.pow(2,O-E),ee=(B*s.X+o.anchorY)*H,te=b*s.X*Na;return{x:Math.floor((R*s.X+o.anchorX)*H-y*s.X*Na),y:Math.floor(ee-te)}}findMatches(o,f,y){const b=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z);for(let E=0;E<o.length;E++){const R=o.get(E);if(R.crossTileID)continue;const B=this._symbolsByKey[R.key];if(!B)continue;const O=this.getScaledCoordinates(R,f);if(B.index){const H=B.index.range(O.x-b,O.y-b,O.x+b,O.y+b).sort();for(const ee of H){const te=B.crossTileIDs[ee];if(!y[te]){y[te]=!0,R.crossTileID=te;break}}}else if(B.positions)for(let H=0;H<B.positions.length;H++){const ee=B.positions[H],te=B.crossTileIDs[H];if(Math.abs(ee.x-O.x)<=b&&Math.abs(ee.y-O.y)<=b&&!y[te]){y[te]=!0,R.crossTileID=te;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:o})=>o)}}class aa{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Wa{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const f=Math.round((o-this.lng)/360);if(f!==0)for(const y in this.indexes){const b=this.indexes[y],E={};for(const R in b){const B=b[R];B.tileID=B.tileID.unwrapTo(B.tileID.wrap+f),E[B.tileID.key]=B}this.indexes[y]=E}this.lng=o}addBucket(o,f,y){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let E=0;E<f.symbolInstances.length;E++)f.symbolInstances.get(E).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const b=this.usedCrossTileIDs[o.overscaledZ];for(const E in this.indexes){const R=this.indexes[E];if(Number(E)>o.overscaledZ)for(const B in R){const O=R[B];O.tileID.isChildOf(o)&&O.findMatches(f.symbolInstances,o,b)}else{const B=R[o.scaledTo(Number(E)).key];B&&B.findMatches(f.symbolInstances,o,b)}}for(let E=0;E<f.symbolInstances.length;E++){const R=f.symbolInstances.get(E);R.crossTileID||(R.crossTileID=y.generate(),b[R.crossTileID]=!0)}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Qr(o,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(o,f){for(const y of f.getCrossTileIDsLists())for(const b of y)delete this.usedCrossTileIDs[o][b]}removeStaleBuckets(o){let f=!1;for(const y in this.indexes){const b=this.indexes[y];for(const E in b)o[b[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(y,b[E]),delete b[E],f=!0)}return f}}class zc{constructor(){this.layerIndexes={},this.crossTileIDs=new aa,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,f,y){let b=this.layerIndexes[o.id];b===void 0&&(b=this.layerIndexes[o.id]=new Wa);let E=!1;const R={};b.handleWrapJump(y);for(const B of f){const O=B.getBucket(o);O&&o.id===O.layerIds[0]&&(O.bucketInstanceId||(O.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(B.tileID,O,this.crossTileIDs)&&(E=!0),R[O.bucketInstanceId]=!0)}return b.removeStaleBuckets(R)&&(E=!0),E}pruneUnusedLayers(o){const f={};o.forEach(y=>{f[y]=!0});for(const y in this.layerIndexes)f[y]||delete this.layerIndexes[y]}}const Za=(C,o)=>s.t(C,o&&o.filter(f=>f.identifier!=="source.canvas")),mx=s.aw();class Rc extends s.E{constructor(o,f={}){super(),this._rtlPluginLoaded=()=>{for(const y in this.sourceCaches){const b=this.sourceCaches[y].getSource().type;b!=="vector"&&b!=="geojson"||this.sourceCaches[y].reload()}},this.map=o,this.dispatcher=new ze(it(),o._getMapId()),this.dispatcher.registerMessageHandler("GG",(y,b)=>this.getGlyphs(y,b)),this.dispatcher.registerMessageHandler("GI",(y,b)=>this.getImages(y,b)),this.imageManager=new Y,this.imageManager.setEventedParent(this),this.glyphManager=new ce(o._requestManager,f.localIdeographFontFamily),this.lineAtlas=new Le(256,512),this.crossTileSymbolIndex=new zc,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",s.ay()),kt().on(ft,this._rtlPluginLoaded),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const b=this.sourceCaches[y.sourceId];if(!b)return;const E=b.getSource();if(E&&E.vectorLayerIds)for(const R in this._layers){const B=this._layers[R];B.source===E.id&&this._validateLayer(B)}})}loadURL(o,f={},y){this.fire(new s.k("dataloading",{dataType:"style"})),f.validate=typeof f.validate!="boolean"||f.validate;const b=this.map._requestManager.transformRequest(o,"Style");this._loadStyleRequest=new AbortController;const E=this._loadStyleRequest;s.h(b,this._loadStyleRequest).then(R=>{this._loadStyleRequest=null,this._load(R.data,f,y)}).catch(R=>{this._loadStyleRequest=null,R&&!E.signal.aborted&&this.fire(new s.j(R))})}loadJSON(o,f={},y){this.fire(new s.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,v.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,f.validate=f.validate!==!1,this._load(o,f,y)}).catch(()=>{})}loadEmpty(){this.fire(new s.k("dataloading",{dataType:"style"})),this._load(mx,{validate:!1})}_load(o,f,y){var b;const E=f.transformStyle?f.transformStyle(y,o):o;if(!f.validate||!Za(this,s.u(E))){this._loaded=!0,this.stylesheet=E;for(const R in E.sources)this.addSource(R,E.sources[R],{validate:!1});E.sprite?this._loadSprite(E.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(E.glyphs),this._createLayers(),this.light=new be(this.stylesheet.light),this.sky=new xe(this.stylesheet.sky),this.map.setTerrain((b=this.stylesheet.terrain)!==null&&b!==void 0?b:null),this.fire(new s.k("data",{dataType:"style"})),this.fire(new s.k("style.load"))}}_createLayers(){const o=s.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",o),this._order=o.map(f=>f.id),this._layers={},this._serializedLayers=null;for(const f of o){const y=s.aA(f);y.setEventedParent(this,{layer:{id:f.id}}),this._layers[f.id]=y}}_loadSprite(o,f=!1,y=void 0){let b;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(E,R,B,O){return s._(this,void 0,void 0,function*(){const H=X(E),ee=B>1?"@2x":"",te={},he={};for(const{id:ye,url:Se}of H){const ke=R.transformRequest(J(Se,ee,".json"),"SpriteJSON");te[ye]=s.h(ke,O);const Ae=R.transformRequest(J(Se,ee,".png"),"SpriteImage");he[ye]=D.getImage(Ae,O)}return yield Promise.all([...Object.values(te),...Object.values(he)]),function(ye,Se){return s._(this,void 0,void 0,function*(){const ke={};for(const Ae in ye){ke[Ae]={};const Me=v.getImageCanvasContext((yield Se[Ae]).data),Re=(yield ye[Ae]).data;for(const Ee in Re){const{width:Ve,height:Ge,x:tt,y:yt,sdf:Ct,pixelRatio:Rt,stretchX:qt,stretchY:Nt,content:It,textFitWidth:Jt,textFitHeight:vr}=Re[Ee];ke[Ae][Ee]={data:null,pixelRatio:Rt,sdf:Ct,stretchX:qt,stretchY:Nt,content:It,textFitWidth:Jt,textFitHeight:vr,spriteData:{width:Ve,height:Ge,x:tt,y:yt,context:Me}}}}return ke})}(te,he)})}(o,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(E=>{if(this._spriteRequest=null,E)for(const R in E){this._spritesImagesIds[R]=[];const B=this._spritesImagesIds[R]?this._spritesImagesIds[R].filter(O=>!(O in E)):[];for(const O of B)this.imageManager.removeImage(O),this._changedImages[O]=!0;for(const O in E[R]){const H=R==="default"?O:`${R}:${O}`;this._spritesImagesIds[R].push(H),H in this.imageManager.images?this.imageManager.updateImage(H,E[R][O],!1):this.imageManager.addImage(H,E[R][O]),f&&(this._changedImages[H]=!0)}}}).catch(E=>{this._spriteRequest=null,b=E,this.fire(new s.j(b))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),f&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.k("data",{dataType:"style"})),y&&y(b)})}_unloadSprite(){for(const o of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(o),this._changedImages[o]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}_validateLayer(o){const f=this.sourceCaches[o.source];if(!f)return;const y=o.sourceLayer;if(!y)return;const b=f.getSource();(b.type==="geojson"||b.vectorLayerIds&&b.vectorLayerIds.indexOf(y)===-1)&&this.fire(new s.j(new Error(`Source layer "${y}" does not exist on source "${b.id}" as specified by style layer "${o.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(o,f=!1){const y=this._serializedAllLayers();if(!o||o.length===0)return Object.values(f?s.aB(y):y);const b=[];for(const E of o)if(y[E]){const R=f?s.aB(y[E]):y[E];b.push(R)}return b}_serializedAllLayers(){let o=this._serializedLayers;if(o)return o;o=this._serializedLayers={};const f=Object.keys(this._layers);for(const y of f){const b=this._layers[y];b.type!=="custom"&&(o[y]=b.serialize())}return o}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const o in this.sourceCaches)if(this.sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(o){if(!this._loaded)return;const f=this._changed;if(f){const b=Object.keys(this._updatedLayers),E=Object.keys(this._removedLayers);(b.length||E.length)&&this._updateWorkerLayers(b,E);for(const R in this._updatedSources){const B=this._updatedSources[R];if(B==="reload")this._reloadSource(R);else{if(B!=="clear")throw new Error(`Invalid action ${B}`);this._clearSource(R)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const R in this._updatedPaintProps)this._layers[R].updateTransitions(o);this.light.updateTransitions(o),this.sky.updateTransitions(o),this._resetUpdates()}const y={};for(const b in this.sourceCaches){const E=this.sourceCaches[b];y[b]=E.used,E.used=!1}for(const b of this._order){const E=this._layers[b];E.recalculate(o,this._availableImages),!E.isHidden(o.zoom)&&E.source&&(this.sourceCaches[E.source].used=!0)}for(const b in y){const E=this.sourceCaches[b];!!y[b]!=!!E.used&&E.fire(new s.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:b}))}this.light.recalculate(o),this.sky.recalculate(o),this.z=o.zoom,f&&this.fire(new s.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const f in this.sourceCaches)this.sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(o,f){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(o,!1),removedIds:f})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(o,f={}){var y;this._checkLoaded();const b=this.serialize();if(o=f.transformStyle?f.transformStyle(b,o):o,((y=f.validate)===null||y===void 0||y)&&Za(this,s.u(o)))return!1;(o=s.aB(o)).layers=s.az(o.layers);const E=s.aC(b,o),R=this._getOperationsToPerform(E);if(R.unimplemented.length>0)throw new Error(`Unimplemented: ${R.unimplemented.join(", ")}.`);if(R.operations.length===0)return!1;for(const B of R.operations)B();return this.stylesheet=o,this._serializedLayers=null,!0}_getOperationsToPerform(o){const f=[],y=[];for(const b of o)switch(b.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":f.push(()=>this.addLayer.apply(this,b.args));break;case"removeLayer":f.push(()=>this.removeLayer.apply(this,b.args));break;case"setPaintProperty":f.push(()=>this.setPaintProperty.apply(this,b.args));break;case"setLayoutProperty":f.push(()=>this.setLayoutProperty.apply(this,b.args));break;case"setFilter":f.push(()=>this.setFilter.apply(this,b.args));break;case"addSource":f.push(()=>this.addSource.apply(this,b.args));break;case"removeSource":f.push(()=>this.removeSource.apply(this,b.args));break;case"setLayerZoomRange":f.push(()=>this.setLayerZoomRange.apply(this,b.args));break;case"setLight":f.push(()=>this.setLight.apply(this,b.args));break;case"setGeoJSONSourceData":f.push(()=>this.setGeoJSONSourceData.apply(this,b.args));break;case"setGlyphs":f.push(()=>this.setGlyphs.apply(this,b.args));break;case"setSprite":f.push(()=>this.setSprite.apply(this,b.args));break;case"setSky":f.push(()=>this.setSky.apply(this,b.args));break;case"setTerrain":f.push(()=>this.map.setTerrain.apply(this,b.args));break;case"setTransition":f.push(()=>{});break;default:y.push(b.command)}return{operations:f,unimplemented:y}}addImage(o,f){if(this.getImage(o))return this.fire(new s.j(new Error(`An image named "${o}" already exists.`)));this.imageManager.addImage(o,f),this._afterImageUpdated(o)}updateImage(o,f){this.imageManager.updateImage(o,f)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new s.j(new Error(`An image named "${o}" does not exist.`)));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(o,f,y={}){if(this._checkLoaded(),this.sourceCaches[o]!==void 0)throw new Error(`Source "${o}" already exists.`);if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(s.u.source,`sources.${o}`,f,null,y))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const b=this.sourceCaches[o]=new qe(o,f,this.dispatcher);b.style=this,b.setEventedParent(this,()=>({isSourceLoaded:b.loaded(),source:b.serialize(),sourceId:o})),b.onAdd(this.map),this._changed=!0}removeSource(o){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===o)return this.fire(new s.j(new Error(`Source "${o}" cannot be removed while layer "${y}" is using it.`)));const f=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],f.fire(new s.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),f.setEventedParent(null),f.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,f){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error(`There is no source with this ID=${o}`);const y=this.sourceCaches[o].getSource();if(y.type!=="geojson")throw new Error(`geojsonSource.type is ${y.type}, which is !== 'geojson`);y.setData(f),this._changed=!0}getSource(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()}addLayer(o,f,y={}){this._checkLoaded();const b=o.id;if(this.getLayer(b))return void this.fire(new s.j(new Error(`Layer "${b}" already exists on this map.`)));let E;if(o.type==="custom"){if(Za(this,s.aD(o)))return;E=s.aA(o)}else{if("source"in o&&typeof o.source=="object"&&(this.addSource(b,o.source),o=s.aB(o),o=s.e(o,{source:b})),this._validate(s.u.layer,`layers.${b}`,o,{arrayIndex:-1},y))return;E=s.aA(o),this._validateLayer(E),E.setEventedParent(this,{layer:{id:b}})}const R=f?this._order.indexOf(f):this._order.length;if(f&&R===-1)this.fire(new s.j(new Error(`Cannot add layer "${b}" before non-existing layer "${f}".`)));else{if(this._order.splice(R,0,b),this._layerOrderChanged=!0,this._layers[b]=E,this._removedLayers[b]&&E.source&&E.type!=="custom"){const B=this._removedLayers[b];delete this._removedLayers[b],B.type!==E.type?this._updatedSources[E.source]="clear":(this._updatedSources[E.source]="reload",this.sourceCaches[E.source].pause())}this._updateLayer(E),E.onAdd&&E.onAdd(this.map)}}moveLayer(o,f){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new s.j(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===f)return;const y=this._order.indexOf(o);this._order.splice(y,1);const b=f?this._order.indexOf(f):this._order.length;f&&b===-1?this.fire(new s.j(new Error(`Cannot move layer "${o}" before non-existing layer "${f}".`))):(this._order.splice(b,0,o),this._layerOrderChanged=!0)}removeLayer(o){this._checkLoaded();const f=this._layers[o];if(!f)return void this.fire(new s.j(new Error(`Cannot remove non-existing layer "${o}".`)));f.setEventedParent(null);const y=this._order.indexOf(o);this._order.splice(y,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=f,delete this._layers[o],this._serializedLayers&&delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],f.onRemove&&f.onRemove(this.map)}getLayer(o){return this._layers[o]}getLayersOrder(){return[...this._order]}hasLayer(o){return o in this._layers}setLayerZoomRange(o,f,y){this._checkLoaded();const b=this.getLayer(o);b?b.minzoom===f&&b.maxzoom===y||(f!=null&&(b.minzoom=f),y!=null&&(b.maxzoom=y),this._updateLayer(b)):this.fire(new s.j(new Error(`Cannot set the zoom range of non-existing layer "${o}".`)))}setFilter(o,f,y={}){this._checkLoaded();const b=this.getLayer(o);if(b){if(!s.aE(b.filter,f))return f==null?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(s.u.filter,`layers.${b.id}.filter`,f,null,y)||(b.filter=s.aB(f),this._updateLayer(b)))}else this.fire(new s.j(new Error(`Cannot filter non-existing layer "${o}".`)))}getFilter(o){return s.aB(this.getLayer(o).filter)}setLayoutProperty(o,f,y,b={}){this._checkLoaded();const E=this.getLayer(o);E?s.aE(E.getLayoutProperty(f),y)||(E.setLayoutProperty(f,y,b),this._updateLayer(E)):this.fire(new s.j(new Error(`Cannot style non-existing layer "${o}".`)))}getLayoutProperty(o,f){const y=this.getLayer(o);if(y)return y.getLayoutProperty(f);this.fire(new s.j(new Error(`Cannot get style of non-existing layer "${o}".`)))}setPaintProperty(o,f,y,b={}){this._checkLoaded();const E=this.getLayer(o);E?s.aE(E.getPaintProperty(f),y)||(E.setPaintProperty(f,y,b)&&this._updateLayer(E),this._changed=!0,this._updatedPaintProps[o]=!0,this._serializedLayers=null):this.fire(new s.j(new Error(`Cannot style non-existing layer "${o}".`)))}getPaintProperty(o,f){return this.getLayer(o).getPaintProperty(f)}setFeatureState(o,f){this._checkLoaded();const y=o.source,b=o.sourceLayer,E=this.sourceCaches[y];if(E===void 0)return void this.fire(new s.j(new Error(`The source '${y}' does not exist in the map's style.`)));const R=E.getSource().type;R==="geojson"&&b?this.fire(new s.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):R!=="vector"||b?(o.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),E.setFeatureState(b,o.id,f)):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(o,f){this._checkLoaded();const y=o.source,b=this.sourceCaches[y];if(b===void 0)return void this.fire(new s.j(new Error(`The source '${y}' does not exist in the map's style.`)));const E=b.getSource().type,R=E==="vector"?o.sourceLayer:void 0;E!=="vector"||R?f&&typeof o.id!="string"&&typeof o.id!="number"?this.fire(new s.j(new Error("A feature id is required to remove its specific state property."))):b.removeFeatureState(R,o.id,f):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(o){this._checkLoaded();const f=o.source,y=o.sourceLayer,b=this.sourceCaches[f];if(b!==void 0)return b.getSource().type!=="vector"||y?(o.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),b.getFeatureState(y,o.id)):void this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.j(new Error(`The source '${f}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const o=s.aF(this.sourceCaches,E=>E.serialize()),f=this._serializeByIds(this._order,!0),y=this.map.getTerrain()||void 0,b=this.stylesheet;return s.aG({version:b.version,name:b.name,metadata:b.metadata,light:b.light,sky:b.sky,center:b.center,zoom:b.zoom,bearing:b.bearing,pitch:b.pitch,sprite:b.sprite,glyphs:b.glyphs,transition:b.transition,sources:o,layers:f,terrain:y},E=>E!==void 0)}_updateLayer(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&this.sourceCaches[o.source].getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(o){const f=R=>this._layers[R].type==="fill-extrusion",y={},b=[];for(let R=this._order.length-1;R>=0;R--){const B=this._order[R];if(f(B)){y[B]=R;for(const O of o){const H=O[B];if(H)for(const ee of H)b.push(ee)}}}b.sort((R,B)=>B.intersectionZ-R.intersectionZ);const E=[];for(let R=this._order.length-1;R>=0;R--){const B=this._order[R];if(f(B))for(let O=b.length-1;O>=0;O--){const H=b[O].feature;if(y[H.layer.id]<R)break;E.push(H),b.pop()}else for(const O of o){const H=O[B];if(H)for(const ee of H)E.push(ee.feature)}}return E}queryRenderedFeatures(o,f,y){f&&f.filter&&this._validate(s.u.filter,"queryRenderedFeatures.filter",f.filter,null,f);const b={};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new s.j(new Error("parameters.layers must be an Array."))),[];for(const B of f.layers){const O=this._layers[B];if(!O)return this.fire(new s.j(new Error(`The layer '${B}' does not exist in the map's style and cannot be queried for features.`))),[];b[O.source]=!0}}const E=[];f.availableImages=this._availableImages;const R=this._serializedAllLayers();for(const B in this.sourceCaches)f.layers&&!b[B]||E.push(ot(this.sourceCaches[B],this._layers,R,o,f,y));return this.placement&&E.push(function(B,O,H,ee,te,he,ye){const Se={},ke=he.queryRenderedSymbols(ee),Ae=[];for(const Me of Object.keys(ke).map(Number))Ae.push(ye[Me]);Ae.sort(xt);for(const Me of Ae){const Re=Me.featureIndex.lookupSymbolFeatures(ke[Me.bucketInstanceId],O,Me.bucketIndex,Me.sourceLayerIndex,te.filter,te.layers,te.availableImages,B);for(const Ee in Re){const Ve=Se[Ee]=Se[Ee]||[],Ge=Re[Ee];Ge.sort((tt,yt)=>{const Ct=Me.featureSortOrder;if(Ct){const Rt=Ct.indexOf(tt.featureIndex);return Ct.indexOf(yt.featureIndex)-Rt}return yt.featureIndex-tt.featureIndex});for(const tt of Ge)Ve.push(tt)}}for(const Me in Se)Se[Me].forEach(Re=>{const Ee=Re.feature,Ve=H[B[Me].source].getFeatureState(Ee.layer["source-layer"],Ee.id);Ee.source=Ee.layer.source,Ee.layer["source-layer"]&&(Ee.sourceLayer=Ee.layer["source-layer"]),Ee.state=Ve});return Se}(this._layers,R,this.sourceCaches,o,f,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(E)}querySourceFeatures(o,f){f&&f.filter&&this._validate(s.u.filter,"querySourceFeatures.filter",f.filter,null,f);const y=this.sourceCaches[o];return y?function(b,E){const R=b.getRenderableIds().map(H=>b.getTileByID(H)),B=[],O={};for(let H=0;H<R.length;H++){const ee=R[H],te=ee.tileID.canonical.key;O[te]||(O[te]=!0,ee.querySourceFeatures(B,E))}return B}(y,f):[]}getLight(){return this.light.getLight()}setLight(o,f={}){this._checkLoaded();const y=this.light.getLight();let b=!1;for(const R in o)if(!s.aE(o[R],y[R])){b=!0;break}if(!b)return;const E={now:v.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,f),this.light.updateTransitions(E)}getSky(){var o;return(o=this.stylesheet)===null||o===void 0?void 0:o.sky}setSky(o,f={}){const y=this.getSky();let b=!1;if(!o&&!y)return;if(o&&!y)b=!0;else if(!o&&y)b=!0;else for(const R in o)if(!s.aE(o[R],y[R])){b=!0;break}if(!b)return;const E={now:v.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=o,this.sky.setSky(o,f),this.sky.updateTransitions(E)}_validate(o,f,y,b,E={}){return(!E||E.validate!==!1)&&Za(this,o.call(s.u,s.e({key:f,style:this.serialize(),value:y,styleSpec:s.v},b)))}_remove(o=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),kt().off(ft,this._rtlPluginLoaded);for(const f in this._layers)this._layers[f].setEventedParent(null);for(const f in this.sourceCaches){const y=this.sourceCaches[f];y.setEventedParent(null),y.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),o&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(o)}_clearSource(o){this.sourceCaches[o].clearTiles()}_reloadSource(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()}_updateSources(o){for(const f in this.sourceCaches)this.sourceCaches[f].update(o,this.map.terrain)}_generateCollisionBoxes(){for(const o in this.sourceCaches)this._reloadSource(o)}_updatePlacement(o,f,y,b,E=!1){let R=!1,B=!1;const O={};for(const H of this._order){const ee=this._layers[H];if(ee.type!=="symbol")continue;if(!O[ee.source]){const he=this.sourceCaches[ee.source];O[ee.source]=he.getRenderableIds(!0).map(ye=>he.getTileByID(ye)).sort((ye,Se)=>Se.tileID.overscaledZ-ye.tileID.overscaledZ||(ye.tileID.isLessThan(Se.tileID)?-1:1))}const te=this.crossTileSymbolIndex.addLayer(ee,O[ee.source],o.center.lng);R=R||te}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((E=E||this._layerOrderChanged||y===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(v.now(),o.zoom))&&(this.pauseablePlacement=new ps(o,this.map.terrain,this._order,E,f,y,b,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,O),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(v.now()),B=!0),R&&this.pauseablePlacement.placement.setStale()),B||R)for(const H of this._order){const ee=this._layers[H];ee.type==="symbol"&&this.placement.updateLayerOpacities(ee,O[ee.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(v.now())}_releaseSymbolFadeTiles(){for(const o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,f){return s._(this,void 0,void 0,function*(){const y=yield this.imageManager.getImages(f.icons);this._updateTilesForChangedImages();const b=this.sourceCaches[f.source];return b&&b.setDependencies(f.tileID.key,f.type,f.icons),y})}getGlyphs(o,f){return s._(this,void 0,void 0,function*(){const y=yield this.glyphManager.getGlyphs(f.stacks),b=this.sourceCaches[f.source];return b&&b.setDependencies(f.tileID.key,f.type,[""]),y})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(o,f={}){this._checkLoaded(),o&&this._validate(s.u.glyphs,"glyphs",o,null,f)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=o,this.glyphManager.entries={},this.glyphManager.setURL(o))}addSprite(o,f,y={},b){this._checkLoaded();const E=[{id:o,url:f}],R=[...X(this.stylesheet.sprite),...E];this._validate(s.u.sprite,"sprite",R,null,y)||(this.stylesheet.sprite=R,this._loadSprite(E,!0,b))}removeSprite(o){this._checkLoaded();const f=X(this.stylesheet.sprite);if(f.find(y=>y.id===o)){if(this._spritesImagesIds[o])for(const y of this._spritesImagesIds[o])this.imageManager.removeImage(y),this._changedImages[y]=!0;f.splice(f.findIndex(y=>y.id===o),1),this.stylesheet.sprite=f.length>0?f:void 0,delete this._spritesImagesIds[o],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}else this.fire(new s.j(new Error(`Sprite "${o}" doesn't exists on this map.`)))}getSprite(){return X(this.stylesheet.sprite)}setSprite(o,f={},y){this._checkLoaded(),o&&this._validate(s.u.sprite,"sprite",o,null,f)||(this.stylesheet.sprite=o,o?this._loadSprite(o,!0,y):(this._unloadSprite(),y&&y(null)))}}var co=s.Y([{name:"a_pos",type:"Int16",components:2}]);const Os={prelude:Br(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Br(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Br(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Br(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Br("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Br(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:Br(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Br("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Br("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Br("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Br(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Br(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Br(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Br(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Br(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Br(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Br(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Br(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Br(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Br(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Br(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Br(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Br(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Br(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Br(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Br(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Br("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Br("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Br("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:Br("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Br(C,o){const f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,y=o.match(/attribute ([\w]+) ([\w]+)/g),b=C.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=o.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),R=E?E.concat(b):b,B={};return{fragmentSource:C=C.replace(f,(O,H,ee,te,he)=>(B[he]=!0,H==="define"?`
#ifndef HAS_UNIFORM_u_${he}
varying ${ee} ${te} ${he};
#else
uniform ${ee} ${te} u_${he};
#endif
`:`
#ifdef HAS_UNIFORM_u_${he}
    ${ee} ${te} ${he} = u_${he};
#endif
`)),vertexSource:o=o.replace(f,(O,H,ee,te,he)=>{const ye=te==="float"?"vec2":"vec4",Se=he.match(/color/)?"color":ye;return B[he]?H==="define"?`
#ifndef HAS_UNIFORM_u_${he}
uniform lowp float u_${he}_t;
attribute ${ee} ${ye} a_${he};
varying ${ee} ${te} ${he};
#else
uniform ${ee} ${te} u_${he};
#endif
`:Se==="vec4"?`
#ifndef HAS_UNIFORM_u_${he}
    ${he} = a_${he};
#else
    ${ee} ${te} ${he} = u_${he};
#endif
`:`
#ifndef HAS_UNIFORM_u_${he}
    ${he} = unpack_mix_${Se}(a_${he}, u_${he}_t);
#else
    ${ee} ${te} ${he} = u_${he};
#endif
`:H==="define"?`
#ifndef HAS_UNIFORM_u_${he}
uniform lowp float u_${he}_t;
attribute ${ee} ${ye} a_${he};
#else
uniform ${ee} ${te} u_${he};
#endif
`:Se==="vec4"?`
#ifndef HAS_UNIFORM_u_${he}
    ${ee} ${te} ${he} = a_${he};
#else
    ${ee} ${te} ${he} = u_${he};
#endif
`:`
#ifndef HAS_UNIFORM_u_${he}
    ${ee} ${te} ${he} = unpack_mix_${Se}(a_${he}, u_${he}_t);
#else
    ${ee} ${te} ${he} = u_${he};
#endif
`}),staticAttributes:y,staticUniforms:R}}class Gh{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,f,y,b,E,R,B,O,H){this.context=o;let ee=this.boundPaintVertexBuffers.length!==b.length;for(let te=0;!ee&&te<b.length;te++)this.boundPaintVertexBuffers[te]!==b[te]&&(ee=!0);!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==y||ee||this.boundIndexBuffer!==E||this.boundVertexOffset!==R||this.boundDynamicVertexBuffer!==B||this.boundDynamicVertexBuffer2!==O||this.boundDynamicVertexBuffer3!==H?this.freshBind(f,y,b,E,R,B,O,H):(o.bindVertexArray.set(this.vao),B&&B.bind(),E&&E.dynamicDraw&&E.bind(),O&&O.bind(),H&&H.bind())}freshBind(o,f,y,b,E,R,B,O){const H=o.numAttributes,ee=this.context,te=ee.gl;this.vao&&this.destroy(),this.vao=ee.createVertexArray(),ee.bindVertexArray.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=y,this.boundIndexBuffer=b,this.boundVertexOffset=E,this.boundDynamicVertexBuffer=R,this.boundDynamicVertexBuffer2=B,this.boundDynamicVertexBuffer3=O,f.enableAttributes(te,o);for(const he of y)he.enableAttributes(te,o);R&&R.enableAttributes(te,o),B&&B.enableAttributes(te,o),O&&O.enableAttributes(te,o),f.bind(),f.setVertexAttribPointers(te,o,E);for(const he of y)he.bind(),he.setVertexAttribPointers(te,o,E);R&&(R.bind(),R.setVertexAttribPointers(te,o,E)),b&&b.bind(),B&&(B.bind(),B.setVertexAttribPointers(te,o,E)),O&&(O.bind(),O.setVertexAttribPointers(te,o,E)),ee.currentNumAttributes=H}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Wh=(C,o,f,y,b)=>({u_matrix:C,u_texture:0,u_ele_delta:o,u_fog_matrix:f,u_fog_color:y?y.properties.get("fog-color"):s.aM.white,u_fog_ground_blend:y?y.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:y?y.calculateFogBlendOpacity(b):0,u_horizon_color:y?y.properties.get("horizon-color"):s.aM.white,u_horizon_fog_blend:y?y.properties.get("horizon-fog-blend"):1});function Ko(C){const o=[];for(let f=0;f<C.length;f++){if(C[f]===null)continue;const y=C[f].split(" ");o.push(y.pop())}return o}class Zh{constructor(o,f,y,b,E,R){const B=o.gl;this.program=B.createProgram();const O=Ko(f.staticAttributes),H=y?y.getBinderAttributes():[],ee=O.concat(H),te=Os.prelude.staticUniforms?Ko(Os.prelude.staticUniforms):[],he=f.staticUniforms?Ko(f.staticUniforms):[],ye=y?y.getBinderUniforms():[],Se=te.concat(he).concat(ye),ke=[];for(const tt of Se)ke.indexOf(tt)<0&&ke.push(tt);const Ae=y?y.defines():[];E&&Ae.push("#define OVERDRAW_INSPECTOR;"),R&&Ae.push("#define TERRAIN3D;");const Me=Ae.concat(Os.prelude.fragmentSource,f.fragmentSource).join(`
`),Re=Ae.concat(Os.prelude.vertexSource,f.vertexSource).join(`
`),Ee=B.createShader(B.FRAGMENT_SHADER);if(B.isContextLost())return void(this.failedToCreate=!0);if(B.shaderSource(Ee,Me),B.compileShader(Ee),!B.getShaderParameter(Ee,B.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${B.getShaderInfoLog(Ee)}`);B.attachShader(this.program,Ee);const Ve=B.createShader(B.VERTEX_SHADER);if(B.isContextLost())return void(this.failedToCreate=!0);if(B.shaderSource(Ve,Re),B.compileShader(Ve),!B.getShaderParameter(Ve,B.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${B.getShaderInfoLog(Ve)}`);B.attachShader(this.program,Ve),this.attributes={};const Ge={};this.numAttributes=ee.length;for(let tt=0;tt<this.numAttributes;tt++)ee[tt]&&(B.bindAttribLocation(this.program,tt,ee[tt]),this.attributes[ee[tt]]=tt);if(B.linkProgram(this.program),!B.getProgramParameter(this.program,B.LINK_STATUS))throw new Error(`Program failed to link: ${B.getProgramInfoLog(this.program)}`);B.deleteShader(Ve),B.deleteShader(Ee);for(let tt=0;tt<ke.length;tt++){const yt=ke[tt];if(yt&&!Ge[yt]){const Ct=B.getUniformLocation(this.program,yt);Ct&&(Ge[yt]=Ct)}}this.fixedUniforms=b(o,Ge),this.terrainUniforms=((tt,yt)=>({u_depth:new s.aH(tt,yt.u_depth),u_terrain:new s.aH(tt,yt.u_terrain),u_terrain_dim:new s.aI(tt,yt.u_terrain_dim),u_terrain_matrix:new s.aJ(tt,yt.u_terrain_matrix),u_terrain_unpack:new s.aK(tt,yt.u_terrain_unpack),u_terrain_exaggeration:new s.aI(tt,yt.u_terrain_exaggeration)}))(o,Ge),this.binderUniforms=y?y.getUniforms(o,Ge):[]}draw(o,f,y,b,E,R,B,O,H,ee,te,he,ye,Se,ke,Ae,Me,Re){const Ee=o.gl;if(this.failedToCreate)return;if(o.program.set(this.program),o.setDepthMode(y),o.setStencilMode(b),o.setColorMode(E),o.setCullFace(R),O){o.activeTexture.set(Ee.TEXTURE2),Ee.bindTexture(Ee.TEXTURE_2D,O.depthTexture),o.activeTexture.set(Ee.TEXTURE3),Ee.bindTexture(Ee.TEXTURE_2D,O.texture);for(const Ge in this.terrainUniforms)this.terrainUniforms[Ge].set(O[Ge])}for(const Ge in this.fixedUniforms)this.fixedUniforms[Ge].set(B[Ge]);ke&&ke.setUniforms(o,this.binderUniforms,ye,{zoom:Se});let Ve=0;switch(f){case Ee.LINES:Ve=2;break;case Ee.TRIANGLES:Ve=3;break;case Ee.LINE_STRIP:Ve=1}for(const Ge of he.get()){const tt=Ge.vaos||(Ge.vaos={});(tt[H]||(tt[H]=new Gh)).bind(o,this,ee,ke?ke.getPaintVertexBuffers():[],te,Ge.vertexOffset,Ae,Me,Re),Ee.drawElements(f,Ge.primitiveLength*Ve,Ee.UNSIGNED_SHORT,Ge.primitiveOffset*Ve*2)}}}function Lc(C,o,f){const y=1/pr(f,1,o.transform.tileZoom),b=Math.pow(2,f.tileID.overscaledZ),E=f.tileSize*Math.pow(2,o.transform.tileZoom)/b,R=E*(f.tileID.canonical.x+f.tileID.wrap*b),B=E*f.tileID.canonical.y;return{u_image:0,u_texsize:f.imageAtlasTexture.size,u_scale:[y,C.fromScale,C.toScale],u_fade:C.t,u_pixel_coord_upper:[R>>16,B>>16],u_pixel_coord_lower:[65535&R,65535&B]}}const bu=(C,o,f,y)=>{const b=o.style.light,E=b.properties.get("position"),R=[E.x,E.y,E.z],B=function(){var H=new s.A(9);return s.A!=Float32Array&&(H[1]=0,H[2]=0,H[3]=0,H[5]=0,H[6]=0,H[7]=0),H[0]=1,H[4]=1,H[8]=1,H}();b.properties.get("anchor")==="viewport"&&function(H,ee){var te=Math.sin(ee),he=Math.cos(ee);H[0]=he,H[1]=te,H[2]=0,H[3]=-te,H[4]=he,H[5]=0,H[6]=0,H[7]=0,H[8]=1}(B,-o.transform.angle),function(H,ee,te){var he=ee[0],ye=ee[1],Se=ee[2];H[0]=he*te[0]+ye*te[3]+Se*te[6],H[1]=he*te[1]+ye*te[4]+Se*te[7],H[2]=he*te[2]+ye*te[5]+Se*te[8]}(R,R,B);const O=b.properties.get("color");return{u_matrix:C,u_lightpos:R,u_lightintensity:b.properties.get("intensity"),u_lightcolor:[O.r,O.g,O.b],u_vertical_gradient:+f,u_opacity:y}},Bc=(C,o,f,y,b,E,R)=>s.e(bu(C,o,f,y),Lc(E,o,R),{u_height_factor:-Math.pow(2,b.overscaledZ)/R.tileSize/8}),Yo=C=>({u_matrix:C}),rg=(C,o,f,y)=>s.e(Yo(C),Lc(f,o,y)),gx=(C,o)=>({u_matrix:C,u_world:o}),ng=(C,o,f,y,b)=>s.e(rg(C,o,f,y),{u_world:b}),vx=(C,o,f,y)=>{const b=C.transform;let E,R;if(y.paint.get("circle-pitch-alignment")==="map"){const B=pr(f,1,b.zoom);E=!0,R=[B,B]}else E=!1,R=b.pixelsToGLUnits;return{u_camera_to_center_distance:b.cameraToCenterDistance,u_scale_with_map:+(y.paint.get("circle-pitch-scale")==="map"),u_matrix:C.translatePosMatrix(o.posMatrix,f,y.paint.get("circle-translate"),y.paint.get("circle-translate-anchor")),u_pitch_with_map:+E,u_device_pixel_ratio:C.pixelRatio,u_extrude_scale:R}},ho=(C,o,f)=>({u_matrix:C,u_inv_matrix:o,u_camera_to_center_distance:f.cameraToCenterDistance,u_viewport_size:[f.width,f.height]}),_u=(C,o,f=1)=>({u_matrix:C,u_color:o,u_overlay:0,u_overlay_scale:f}),Ma=C=>({u_matrix:C}),Da=(C,o,f,y)=>({u_matrix:C,u_extrude_scale:pr(o,1,f),u_intensity:y}),jc=(C,o,f,y)=>{const b=s.H();s.aP(b,0,C.width,C.height,0,0,1);const E=C.context.gl;return{u_matrix:b,u_world:[E.drawingBufferWidth,E.drawingBufferHeight],u_image:f,u_color_ramp:y,u_opacity:o.paint.get("heatmap-opacity")}};function Oc(C,o){const f=Math.pow(2,o.canonical.z),y=o.canonical.y;return[new s.Z(0,y/f).toLngLat().lat,new s.Z(0,(y+1)/f).toLngLat().lat]}const Fc=(C,o,f,y)=>{const b=C.transform;return{u_matrix:sg(C,o,f,y),u_ratio:1/pr(o,1,b.zoom),u_device_pixel_ratio:C.pixelRatio,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},ag=(C,o,f,y,b)=>s.e(Fc(C,o,f,b),{u_image:0,u_image_height:y}),Jo=(C,o,f,y,b)=>{const E=C.transform,R=ig(o,E);return{u_matrix:sg(C,o,f,b),u_texsize:o.imageAtlasTexture.size,u_ratio:1/pr(o,1,E.zoom),u_device_pixel_ratio:C.pixelRatio,u_image:0,u_scale:[R,y.fromScale,y.toScale],u_fade:y.t,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]]}},yx=(C,o,f,y,b,E)=>{const R=C.lineAtlas,B=ig(o,C.transform),O=f.layout.get("line-cap")==="round",H=R.getDash(y.from,O),ee=R.getDash(y.to,O),te=H.width*b.fromScale,he=ee.width*b.toScale;return s.e(Fc(C,o,f,E),{u_patternscale_a:[B/te,-H.height/2],u_patternscale_b:[B/he,-ee.height/2],u_sdfgamma:R.width/(256*Math.min(te,he)*C.pixelRatio)/2,u_image:0,u_tex_y_a:H.y,u_tex_y_b:ee.y,u_mix:b.t})};function ig(C,o){return 1/pr(C,1,o.tileZoom)}function sg(C,o,f,y){return C.translatePosMatrix(y?y.posMatrix:o.tileID.posMatrix,o,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}const xx=(C,o,f,y,b)=>{return{u_matrix:C,u_tl_parent:o,u_scale_parent:f,u_buffer_scale:1,u_fade_t:y.mix,u_opacity:y.opacity*b.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:b.paint.get("raster-brightness-min"),u_brightness_high:b.paint.get("raster-brightness-max"),u_saturation_factor:(R=b.paint.get("raster-saturation"),R>0?1-1/(1.001-R):-R),u_contrast_factor:(E=b.paint.get("raster-contrast"),E>0?1/(1-E):1+E),u_spin_weights:bx(b.paint.get("raster-hue-rotate"))};var E,R};function bx(C){C*=Math.PI/180;const o=Math.sin(C),f=Math.cos(C);return[(2*f+1)/3,(-Math.sqrt(3)*o-f+1)/3,(Math.sqrt(3)*o-f+1)/3]}const og=(C,o,f,y,b,E,R,B,O,H,ee,te,he,ye)=>{const Se=R.transform;return{u_is_size_zoom_constant:+(C==="constant"||C==="source"),u_is_size_feature_constant:+(C==="constant"||C==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:Se.cameraToCenterDistance,u_pitch:Se.pitch/360*2*Math.PI,u_rotate_symbol:+f,u_aspect_ratio:Se.width/Se.height,u_fade_change:R.options.fadeDuration?R.symbolFadeChange:1,u_matrix:B,u_label_plane_matrix:O,u_coord_matrix:H,u_is_text:+te,u_pitch_with_map:+y,u_is_along_line:b,u_is_variable_anchor:E,u_texsize:he,u_texture:0,u_translation:ee,u_pitched_scale:ye}},wu=(C,o,f,y,b,E,R,B,O,H,ee,te,he,ye,Se)=>{const ke=R.transform;return s.e(og(C,o,f,y,b,E,R,B,O,H,ee,te,he,Se),{u_gamma_scale:y?Math.cos(ke._pitch)*ke.cameraToCenterDistance:1,u_device_pixel_ratio:R.pixelRatio,u_is_halo:1})},Xh=(C,o,f,y,b,E,R,B,O,H,ee,te,he,ye)=>s.e(wu(C,o,f,y,b,E,R,B,O,H,ee,!0,te,!0,ye),{u_texsize_icon:he,u_texture_icon:1}),$c=(C,o,f)=>({u_matrix:C,u_opacity:o,u_color:f}),Kh=(C,o,f,y,b,E)=>s.e(function(R,B,O,H){const ee=O.imageManager.getPattern(R.from.toString()),te=O.imageManager.getPattern(R.to.toString()),{width:he,height:ye}=O.imageManager.getPixelSize(),Se=Math.pow(2,H.tileID.overscaledZ),ke=H.tileSize*Math.pow(2,O.transform.tileZoom)/Se,Ae=ke*(H.tileID.canonical.x+H.tileID.wrap*Se),Me=ke*H.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ee.tl,u_pattern_br_a:ee.br,u_pattern_tl_b:te.tl,u_pattern_br_b:te.br,u_texsize:[he,ye],u_mix:B.t,u_pattern_size_a:ee.displaySize,u_pattern_size_b:te.displaySize,u_scale_a:B.fromScale,u_scale_b:B.toScale,u_tile_units_to_pixels:1/pr(H,1,O.transform.tileZoom),u_pixel_coord_upper:[Ae>>16,Me>>16],u_pixel_coord_lower:[65535&Ae,65535&Me]}}(y,E,f,b),{u_matrix:C,u_opacity:o}),Yh={fillExtrusion:(C,o)=>({u_matrix:new s.aJ(C,o.u_matrix),u_lightpos:new s.aN(C,o.u_lightpos),u_lightintensity:new s.aI(C,o.u_lightintensity),u_lightcolor:new s.aN(C,o.u_lightcolor),u_vertical_gradient:new s.aI(C,o.u_vertical_gradient),u_opacity:new s.aI(C,o.u_opacity)}),fillExtrusionPattern:(C,o)=>({u_matrix:new s.aJ(C,o.u_matrix),u_lightpos:new s.aN(C,o.u_lightpos),u_lightintensity:new s.aI(C,o.u_lightintensity),u_lightcolor:new s.aN(C,o.u_lightcolor),u_vertical_gradient:new s.aI(C,o.u_vertical_gradient),u_height_factor:new s.aI(C,o.u_height_factor),u_image:new s.aH(C,o.u_image),u_texsize:new s.aO(C,o.u_texsize),u_pixel_coord_upper:new s.aO(C,o.u_pixel_coord_upper),u_pixel_coord_lower:new s.aO(C,o.u_pixel_coord_lower),u_scale:new s.aN(C,o.u_scale),u_fade:new s.aI(C,o.u_fade),u_opacity:new s.aI(C,o.u_opacity)}),fill:(C,o)=>({u_matrix:new s.aJ(C,o.u_matrix)}),fillPattern:(C,o)=>({u_matrix:new s.aJ(C,o.u_matrix),u_image:new s.aH(C,o.u_image),u_texsize:new s.aO(C,o.u_texsize),u_pixel_coord_upper:new s.aO(C,o.u_pixel_coord_upper),u_pixel_coord_lower:new s.aO(C,o.u_pixel_coord_lower),u_scale:new s.aN(C,o.u_scale),u_fade:new s.aI(C,o.u_fade)}),fillOutline:(C,o)=>({u_matrix:new s.aJ(C,o.u_matrix),u_world:new s.aO(C,o.u_world)}),fillOutlinePattern:(C,o)=>({u_matrix:new s.aJ(C,o.u_matrix),u_world:new s.aO(C,o.u_world),u_image:new s.aH(C,o.u_image),u_texsize:new s.aO(C,o.u_texsize),u_pixel_coord_upper:new s.aO(C,o.u_pixel_coord_upper),u_pixel_coord_lower:new s.aO(C,o.u_pixel_coord_lower),u_scale:new s.aN(C,o.u_scale),u_fade:new s.aI(C,o.u_fade)}),circle:(C,o)=>({u_camera_to_center_distance:new s.aI(C,o.u_camera_to_center_distance),u_scale_with_map:new s.aH(C,o.u_scale_with_map),u_pitch_with_map:new s.aH(C,o.u_pitch_with_map),u_extrude_scale:new s.aO(C,o.u_extrude_scale),u_device_pixel_ratio:new s.aI(C,o.u_device_pixel_ratio),u_matrix:new s.aJ(C,o.u_matrix)}),collisionBox:(C,o)=>({u_matrix:new s.aJ(C,o.u_matrix),u_pixel_extrude_scale:new s.aO(C,o.u_pixel_extrude_scale)}),collisionCircle:(C,o)=>({u_matrix:new s.aJ(C,o.u_matrix),u_inv_matrix:new s.aJ(C,o.u_inv_matrix),u_camera_to_center_distance:new s.aI(C,o.u_camera_to_center_distance),u_viewport_size:new s.aO(C,o.u_viewport_size)}),debug:(C,o)=>({u_color:new s.aL(C,o.u_color),u_matrix:new s.aJ(C,o.u_matrix),u_overlay:new s.aH(C,o.u_overlay),u_overlay_scale:new s.aI(C,o.u_overlay_scale)}),clippingMask:(C,o)=>({u_matrix:new s.aJ(C,o.u_matrix)}),heatmap:(C,o)=>({u_extrude_scale:new s.aI(C,o.u_extrude_scale),u_intensity:new s.aI(C,o.u_intensity),u_matrix:new s.aJ(C,o.u_matrix)}),heatmapTexture:(C,o)=>({u_matrix:new s.aJ(C,o.u_matrix),u_world:new s.aO(C,o.u_world),u_image:new s.aH(C,o.u_image),u_color_ramp:new s.aH(C,o.u_color_ramp),u_opacity:new s.aI(C,o.u_opacity)}),hillshade:(C,o)=>({u_matrix:new s.aJ(C,o.u_matrix),u_image:new s.aH(C,o.u_image),u_latrange:new s.aO(C,o.u_latrange),u_light:new s.aO(C,o.u_light),u_shadow:new s.aL(C,o.u_shadow),u_highlight:new s.aL(C,o.u_highlight),u_accent:new s.aL(C,o.u_accent)}),hillshadePrepare:(C,o)=>({u_matrix:new s.aJ(C,o.u_matrix),u_image:new s.aH(C,o.u_image),u_dimension:new s.aO(C,o.u_dimension),u_zoom:new s.aI(C,o.u_zoom),u_unpack:new s.aK(C,o.u_unpack)}),line:(C,o)=>({u_matrix:new s.aJ(C,o.u_matrix),u_ratio:new s.aI(C,o.u_ratio),u_device_pixel_ratio:new s.aI(C,o.u_device_pixel_ratio),u_units_to_pixels:new s.aO(C,o.u_units_to_pixels)}),lineGradient:(C,o)=>({u_matrix:new s.aJ(C,o.u_matrix),u_ratio:new s.aI(C,o.u_ratio),u_device_pixel_ratio:new s.aI(C,o.u_device_pixel_ratio),u_units_to_pixels:new s.aO(C,o.u_units_to_pixels),u_image:new s.aH(C,o.u_image),u_image_height:new s.aI(C,o.u_image_height)}),linePattern:(C,o)=>({u_matrix:new s.aJ(C,o.u_matrix),u_texsize:new s.aO(C,o.u_texsize),u_ratio:new s.aI(C,o.u_ratio),u_device_pixel_ratio:new s.aI(C,o.u_device_pixel_ratio),u_image:new s.aH(C,o.u_image),u_units_to_pixels:new s.aO(C,o.u_units_to_pixels),u_scale:new s.aN(C,o.u_scale),u_fade:new s.aI(C,o.u_fade)}),lineSDF:(C,o)=>({u_matrix:new s.aJ(C,o.u_matrix),u_ratio:new s.aI(C,o.u_ratio),u_device_pixel_ratio:new s.aI(C,o.u_device_pixel_ratio),u_units_to_pixels:new s.aO(C,o.u_units_to_pixels),u_patternscale_a:new s.aO(C,o.u_patternscale_a),u_patternscale_b:new s.aO(C,o.u_patternscale_b),u_sdfgamma:new s.aI(C,o.u_sdfgamma),u_image:new s.aH(C,o.u_image),u_tex_y_a:new s.aI(C,o.u_tex_y_a),u_tex_y_b:new s.aI(C,o.u_tex_y_b),u_mix:new s.aI(C,o.u_mix)}),raster:(C,o)=>({u_matrix:new s.aJ(C,o.u_matrix),u_tl_parent:new s.aO(C,o.u_tl_parent),u_scale_parent:new s.aI(C,o.u_scale_parent),u_buffer_scale:new s.aI(C,o.u_buffer_scale),u_fade_t:new s.aI(C,o.u_fade_t),u_opacity:new s.aI(C,o.u_opacity),u_image0:new s.aH(C,o.u_image0),u_image1:new s.aH(C,o.u_image1),u_brightness_low:new s.aI(C,o.u_brightness_low),u_brightness_high:new s.aI(C,o.u_brightness_high),u_saturation_factor:new s.aI(C,o.u_saturation_factor),u_contrast_factor:new s.aI(C,o.u_contrast_factor),u_spin_weights:new s.aN(C,o.u_spin_weights)}),symbolIcon:(C,o)=>({u_is_size_zoom_constant:new s.aH(C,o.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aH(C,o.u_is_size_feature_constant),u_size_t:new s.aI(C,o.u_size_t),u_size:new s.aI(C,o.u_size),u_camera_to_center_distance:new s.aI(C,o.u_camera_to_center_distance),u_pitch:new s.aI(C,o.u_pitch),u_rotate_symbol:new s.aH(C,o.u_rotate_symbol),u_aspect_ratio:new s.aI(C,o.u_aspect_ratio),u_fade_change:new s.aI(C,o.u_fade_change),u_matrix:new s.aJ(C,o.u_matrix),u_label_plane_matrix:new s.aJ(C,o.u_label_plane_matrix),u_coord_matrix:new s.aJ(C,o.u_coord_matrix),u_is_text:new s.aH(C,o.u_is_text),u_pitch_with_map:new s.aH(C,o.u_pitch_with_map),u_is_along_line:new s.aH(C,o.u_is_along_line),u_is_variable_anchor:new s.aH(C,o.u_is_variable_anchor),u_texsize:new s.aO(C,o.u_texsize),u_texture:new s.aH(C,o.u_texture),u_translation:new s.aO(C,o.u_translation),u_pitched_scale:new s.aI(C,o.u_pitched_scale)}),symbolSDF:(C,o)=>({u_is_size_zoom_constant:new s.aH(C,o.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aH(C,o.u_is_size_feature_constant),u_size_t:new s.aI(C,o.u_size_t),u_size:new s.aI(C,o.u_size),u_camera_to_center_distance:new s.aI(C,o.u_camera_to_center_distance),u_pitch:new s.aI(C,o.u_pitch),u_rotate_symbol:new s.aH(C,o.u_rotate_symbol),u_aspect_ratio:new s.aI(C,o.u_aspect_ratio),u_fade_change:new s.aI(C,o.u_fade_change),u_matrix:new s.aJ(C,o.u_matrix),u_label_plane_matrix:new s.aJ(C,o.u_label_plane_matrix),u_coord_matrix:new s.aJ(C,o.u_coord_matrix),u_is_text:new s.aH(C,o.u_is_text),u_pitch_with_map:new s.aH(C,o.u_pitch_with_map),u_is_along_line:new s.aH(C,o.u_is_along_line),u_is_variable_anchor:new s.aH(C,o.u_is_variable_anchor),u_texsize:new s.aO(C,o.u_texsize),u_texture:new s.aH(C,o.u_texture),u_gamma_scale:new s.aI(C,o.u_gamma_scale),u_device_pixel_ratio:new s.aI(C,o.u_device_pixel_ratio),u_is_halo:new s.aH(C,o.u_is_halo),u_translation:new s.aO(C,o.u_translation),u_pitched_scale:new s.aI(C,o.u_pitched_scale)}),symbolTextAndIcon:(C,o)=>({u_is_size_zoom_constant:new s.aH(C,o.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aH(C,o.u_is_size_feature_constant),u_size_t:new s.aI(C,o.u_size_t),u_size:new s.aI(C,o.u_size),u_camera_to_center_distance:new s.aI(C,o.u_camera_to_center_distance),u_pitch:new s.aI(C,o.u_pitch),u_rotate_symbol:new s.aH(C,o.u_rotate_symbol),u_aspect_ratio:new s.aI(C,o.u_aspect_ratio),u_fade_change:new s.aI(C,o.u_fade_change),u_matrix:new s.aJ(C,o.u_matrix),u_label_plane_matrix:new s.aJ(C,o.u_label_plane_matrix),u_coord_matrix:new s.aJ(C,o.u_coord_matrix),u_is_text:new s.aH(C,o.u_is_text),u_pitch_with_map:new s.aH(C,o.u_pitch_with_map),u_is_along_line:new s.aH(C,o.u_is_along_line),u_is_variable_anchor:new s.aH(C,o.u_is_variable_anchor),u_texsize:new s.aO(C,o.u_texsize),u_texsize_icon:new s.aO(C,o.u_texsize_icon),u_texture:new s.aH(C,o.u_texture),u_texture_icon:new s.aH(C,o.u_texture_icon),u_gamma_scale:new s.aI(C,o.u_gamma_scale),u_device_pixel_ratio:new s.aI(C,o.u_device_pixel_ratio),u_is_halo:new s.aH(C,o.u_is_halo),u_translation:new s.aO(C,o.u_translation),u_pitched_scale:new s.aI(C,o.u_pitched_scale)}),background:(C,o)=>({u_matrix:new s.aJ(C,o.u_matrix),u_opacity:new s.aI(C,o.u_opacity),u_color:new s.aL(C,o.u_color)}),backgroundPattern:(C,o)=>({u_matrix:new s.aJ(C,o.u_matrix),u_opacity:new s.aI(C,o.u_opacity),u_image:new s.aH(C,o.u_image),u_pattern_tl_a:new s.aO(C,o.u_pattern_tl_a),u_pattern_br_a:new s.aO(C,o.u_pattern_br_a),u_pattern_tl_b:new s.aO(C,o.u_pattern_tl_b),u_pattern_br_b:new s.aO(C,o.u_pattern_br_b),u_texsize:new s.aO(C,o.u_texsize),u_mix:new s.aI(C,o.u_mix),u_pattern_size_a:new s.aO(C,o.u_pattern_size_a),u_pattern_size_b:new s.aO(C,o.u_pattern_size_b),u_scale_a:new s.aI(C,o.u_scale_a),u_scale_b:new s.aI(C,o.u_scale_b),u_pixel_coord_upper:new s.aO(C,o.u_pixel_coord_upper),u_pixel_coord_lower:new s.aO(C,o.u_pixel_coord_lower),u_tile_units_to_pixels:new s.aI(C,o.u_tile_units_to_pixels)}),terrain:(C,o)=>({u_matrix:new s.aJ(C,o.u_matrix),u_texture:new s.aH(C,o.u_texture),u_ele_delta:new s.aI(C,o.u_ele_delta),u_fog_matrix:new s.aJ(C,o.u_fog_matrix),u_fog_color:new s.aL(C,o.u_fog_color),u_fog_ground_blend:new s.aI(C,o.u_fog_ground_blend),u_fog_ground_blend_opacity:new s.aI(C,o.u_fog_ground_blend_opacity),u_horizon_color:new s.aL(C,o.u_horizon_color),u_horizon_fog_blend:new s.aI(C,o.u_horizon_fog_blend)}),terrainDepth:(C,o)=>({u_matrix:new s.aJ(C,o.u_matrix),u_ele_delta:new s.aI(C,o.u_ele_delta)}),terrainCoords:(C,o)=>({u_matrix:new s.aJ(C,o.u_matrix),u_texture:new s.aH(C,o.u_texture),u_terrain_coords_id:new s.aI(C,o.u_terrain_coords_id),u_ele_delta:new s.aI(C,o.u_ele_delta)}),sky:(C,o)=>({u_sky_color:new s.aL(C,o.u_sky_color),u_horizon_color:new s.aL(C,o.u_horizon_color),u_horizon:new s.aI(C,o.u_horizon),u_sky_horizon_blend:new s.aI(C,o.u_sky_horizon_blend)})};class Zi{constructor(o,f,y){this.context=o;const b=o.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!y,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const f=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const _x={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Jh{constructor(o,f,y,b){this.length=f.length,this.attributes=y,this.itemSize=f.bytesPerElement,this.dynamicDraw=b,this.context=o;const E=o.gl;this.buffer=E.createBuffer(),o.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){if(o.length!==this.length)throw new Error(`Length of new data is ${o.length}, which doesn't match current length of ${this.length}`);const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,f){for(let y=0;y<this.attributes.length;y++){const b=f.attributes[this.attributes[y].name];b!==void 0&&o.enableVertexAttribArray(b)}}setVertexAttribPointers(o,f,y){for(let b=0;b<this.attributes.length;b++){const E=this.attributes[b],R=f.attributes[E.name];R!==void 0&&o.vertexAttribPointer(R,E.components,o[_x[E.type]],!1,this.itemSize,E.offset+this.itemSize*(y||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const fo=new WeakMap;function Fs(C){var o;if(fo.has(C))return fo.get(C);{const f=(o=C.getParameter(C.VERSION))===null||o===void 0?void 0:o.startsWith("WebGL 2.0");return fo.set(C,f),f}}class Or{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Vc extends Or{getDefault(){return s.aM.transparent}set(o){const f=this.current;(o.r!==f.r||o.g!==f.g||o.b!==f.b||o.a!==f.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class wx extends Or{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class Qo extends Or{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class Sx extends Or{getDefault(){return[!0,!0,!0,!0]}set(o){const f=this.current;(o[0]!==f[0]||o[1]!==f[1]||o[2]!==f[2]||o[3]!==f[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class lg extends Or{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class Ex extends Or{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class ug extends Or{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const f=this.current;(o.func!==f.func||o.ref!==f.ref||o.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class Qh extends Or{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const f=this.current;(o[0]!==f[0]||o[1]!==f[1]||o[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class cg extends Or{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;o?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=o,this.dirty=!1}}class dg extends Or{getDefault(){return[0,1]}set(o){const f=this.current;(o[0]!==f[0]||o[1]!==f[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class hg extends Or{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;o?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=o,this.dirty=!1}}class fg extends Or{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class po extends Or{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;o?f.enable(f.BLEND):f.disable(f.BLEND),this.current=o,this.dirty=!1}}class pg extends Or{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const f=this.current;(o[0]!==f[0]||o[1]!==f[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class Cx extends Or{getDefault(){return s.aM.transparent}set(o){const f=this.current;(o.r!==f.r||o.g!==f.g||o.b!==f.b||o.a!==f.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class mg extends Or{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class Su extends Or{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;o?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=o,this.dirty=!1}}class kx extends Or{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class Uc extends Or{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class Tx extends Or{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class Px extends Or{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class gg extends Or{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const f=this.current;(o[0]!==f[0]||o[1]!==f[1]||o[2]!==f[2]||o[3]!==f[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class vg extends Or{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class yg extends Or{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class ef extends Or{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class xg extends Or{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class qc extends Or{getDefault(){return null}set(o){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class ms extends Or{getDefault(){return null}set(o){var f;if(o===this.current&&!this.dirty)return;const y=this.gl;Fs(y)?y.bindVertexArray(o):(f=y.getExtension("OES_vertex_array_object"))===null||f===void 0||f.bindVertexArrayOES(o),this.current=o,this.dirty=!1}}class tf extends Or{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class rf extends Or{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class nf extends Or{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class Hc extends Or{constructor(o,f){super(o),this.context=o,this.parent=f}getDefault(){return null}}class af extends Hc{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class mo extends Hc{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,f.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class sf extends Hc{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_STENCIL_ATTACHMENT,f.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Ix{constructor(o,f,y,b,E){this.context=o,this.width=f,this.height=y;const R=o.gl,B=this.framebuffer=R.createFramebuffer();if(this.colorAttachment=new af(o,B),b)this.depthAttachment=E?new sf(o,B):new mo(o,B);else if(E)throw new Error("Stencil cannot be set without depth");if(R.checkFramebufferStatus(R.FRAMEBUFFER)!==R.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const o=this.context.gl,f=this.colorAttachment.get();if(f&&o.deleteTexture(f),this.depthAttachment){const y=this.depthAttachment.get();y&&o.deleteRenderbuffer(y)}o.deleteFramebuffer(this.framebuffer)}}class Sn{constructor(o,f,y){this.blendFunction=o,this.blendColor=f,this.mask=y}}Sn.Replace=[1,0],Sn.disabled=new Sn(Sn.Replace,s.aM.transparent,[!1,!1,!1,!1]),Sn.unblended=new Sn(Sn.Replace,s.aM.transparent,[!0,!0,!0,!0]),Sn.alphaBlended=new Sn([1,771],s.aM.transparent,[!0,!0,!0,!0]);class Ax{constructor(o){var f,y;if(this.gl=o,this.clearColor=new Vc(this),this.clearDepth=new wx(this),this.clearStencil=new Qo(this),this.colorMask=new Sx(this),this.depthMask=new lg(this),this.stencilMask=new Ex(this),this.stencilFunc=new ug(this),this.stencilOp=new Qh(this),this.stencilTest=new cg(this),this.depthRange=new dg(this),this.depthTest=new hg(this),this.depthFunc=new fg(this),this.blend=new po(this),this.blendFunc=new pg(this),this.blendColor=new Cx(this),this.blendEquation=new mg(this),this.cullFace=new Su(this),this.cullFaceSide=new kx(this),this.frontFace=new Uc(this),this.program=new Tx(this),this.activeTexture=new Px(this),this.viewport=new gg(this),this.bindFramebuffer=new vg(this),this.bindRenderbuffer=new yg(this),this.bindTexture=new ef(this),this.bindVertexBuffer=new xg(this),this.bindElementBuffer=new qc(this),this.bindVertexArray=new ms(this),this.pixelStoreUnpack=new tf(this),this.pixelStoreUnpackPremultiplyAlpha=new rf(this),this.pixelStoreUnpackFlipY=new nf(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),Fs(o)){this.HALF_FLOAT=o.HALF_FLOAT;const b=o.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(f=o.RGBA16F)!==null&&f!==void 0?f:b==null?void 0:b.RGBA16F_EXT,this.RGB16F=(y=o.RGB16F)!==null&&y!==void 0?y:b==null?void 0:b.RGB16F_EXT,o.getExtension("EXT_color_buffer_float")}else{o.getExtension("EXT_color_buffer_half_float"),o.getExtension("OES_texture_half_float_linear");const b=o.getExtension("OES_texture_half_float");this.HALF_FLOAT=b==null?void 0:b.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,f){return new Zi(this,o,f)}createVertexBuffer(o,f,y){return new Jh(this,o,f,y)}createRenderbuffer(o,f,y){const b=this.gl,E=b.createRenderbuffer();return this.bindRenderbuffer.set(E),b.renderbufferStorage(b.RENDERBUFFER,o,f,y),this.bindRenderbuffer.set(null),E}createFramebuffer(o,f,y,b){return new Ix(this,o,f,y,b)}clear({color:o,depth:f,stencil:y}){const b=this.gl;let E=0;o&&(E|=b.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(E|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),y!==void 0&&(E|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(y),this.stencilMask.set(255)),b.clear(E)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){s.aE(o.blendFunction,Sn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}createVertexArray(){var o;return Fs(this.gl)?this.gl.createVertexArray():(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.createVertexArrayOES()}deleteVertexArray(o){var f;return Fs(this.gl)?this.gl.deleteVertexArray(o):(f=this.gl.getExtension("OES_vertex_array_object"))===null||f===void 0?void 0:f.deleteVertexArrayOES(o)}unbindVAO(){this.bindVertexArray.set(null)}}class Cr{constructor(o,f,y){this.func=o,this.mask=f,this.range=y}}Cr.ReadOnly=!1,Cr.ReadWrite=!0,Cr.disabled=new Cr(519,Cr.ReadOnly,[0,1]);const Gc=7680;class en{constructor(o,f,y,b,E,R){this.test=o,this.ref=f,this.mask=y,this.fail=b,this.depthFail=E,this.pass=R}}en.disabled=new en({func:519,mask:0},0,0,Gc,Gc,Gc);class Wr{constructor(o,f,y){this.enable=o,this.mode=f,this.frontFace=y}}let go;function Eu(C,o,f,y,b){const E=C.context,R=E.gl,B=C.useProgram("collisionBox"),O=[];let H=0,ee=0;for(let Me=0;Me<y.length;Me++){const Re=y[Me],Ee=o.getTile(Re).getBucket(f);if(!Ee)continue;const Ve=b?Ee.textCollisionBox:Ee.iconCollisionBox,Ge=Ee.collisionCircleArray;if(Ge.length>0){const tt=s.H();s.aQ(tt,Ee.placementInvProjMatrix,C.transform.glCoordMatrix),s.aQ(tt,tt,Ee.placementViewportMatrix),O.push({circleArray:Ge,circleOffset:ee,transform:Re.posMatrix,invTransform:tt,coord:Re}),H+=Ge.length/4,ee=H}Ve&&B.draw(E,R.LINES,Cr.disabled,en.disabled,C.colorModeForRenderPass(),Wr.disabled,{u_matrix:Re.posMatrix,u_pixel_extrude_scale:[1/(te=C.transform).width,1/te.height]},C.style.map.terrain&&C.style.map.terrain.getTerrainData(Re),f.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ve.segments,null,C.transform.zoom,null,null,Ve.collisionVertexBuffer)}var te;if(!b||!O.length)return;const he=C.useProgram("collisionCircle"),ye=new s.aR;ye.resize(4*H),ye._trim();let Se=0;for(const Me of O)for(let Re=0;Re<Me.circleArray.length/4;Re++){const Ee=4*Re,Ve=Me.circleArray[Ee+0],Ge=Me.circleArray[Ee+1],tt=Me.circleArray[Ee+2],yt=Me.circleArray[Ee+3];ye.emplace(Se++,Ve,Ge,tt,yt,0),ye.emplace(Se++,Ve,Ge,tt,yt,1),ye.emplace(Se++,Ve,Ge,tt,yt,2),ye.emplace(Se++,Ve,Ge,tt,yt,3)}(!go||go.length<2*H)&&(go=function(Me){const Re=2*Me,Ee=new s.aT;Ee.resize(Re),Ee._trim();for(let Ve=0;Ve<Re;Ve++){const Ge=6*Ve;Ee.uint16[Ge+0]=4*Ve+0,Ee.uint16[Ge+1]=4*Ve+1,Ee.uint16[Ge+2]=4*Ve+2,Ee.uint16[Ge+3]=4*Ve+2,Ee.uint16[Ge+4]=4*Ve+3,Ee.uint16[Ge+5]=4*Ve+0}return Ee}(H));const ke=E.createIndexBuffer(go,!0),Ae=E.createVertexBuffer(ye,s.aS.members,!0);for(const Me of O){const Re=ho(Me.transform,Me.invTransform,C.transform);he.draw(E,R.TRIANGLES,Cr.disabled,en.disabled,C.colorModeForRenderPass(),Wr.disabled,Re,C.style.map.terrain&&C.style.map.terrain.getTerrainData(Me.coord),f.id,Ae,ke,s.a0.simpleSegment(0,2*Me.circleOffset,Me.circleArray.length,Me.circleArray.length/2),null,C.transform.zoom,null,null,null)}Ae.destroy(),ke.destroy()}Wr.disabled=new Wr(!1,1029,2305),Wr.backCCW=new Wr(!0,1029,2305);const Cu=s.an(new Float32Array(16));function of(C,o,f,y,b,E){const{horizontalAlign:R,verticalAlign:B}=s.au(C);return new s.P((-(R-.5)*o/b+y[0])*E,(-(B-.5)*f/b+y[1])*E)}function vo(C,o,f,y,b,E){const R=o.tileAnchorPoint.add(new s.P(o.translation[0],o.translation[1]));if(o.pitchWithMap){let B=y.mult(E);f||(B=B.rotate(-b));const O=R.add(B);return we(O.x,O.y,o.labelPlaneMatrix,o.getElevation).point}if(f){const B=rt(o.tileAnchorPoint.x+1,o.tileAnchorPoint.y,o).point.sub(C),O=Math.atan(B.y/B.x)+(B.x<0?Math.PI:0);return C.add(y.rotate(O))}return C.add(y)}function el(C,o,f,y,b,E,R,B,O,H,ee,te,he,ye){const Se=C.text.placedSymbolArray,ke=C.text.dynamicLayoutVertexArray,Ae=C.icon.dynamicLayoutVertexArray,Me={};ke.clear();for(let Re=0;Re<Se.length;Re++){const Ee=Se.get(Re),Ve=Ee.hidden||!Ee.crossTileID||C.allowVerticalPlacement&&!Ee.placedOrientation?null:y[Ee.crossTileID];if(Ve){const Ge=new s.P(Ee.anchorX,Ee.anchorY),tt={getElevation:ye,width:b.width,height:b.height,labelPlaneMatrix:E,pitchWithMap:f,projection:ee,tileAnchorPoint:Ge,translation:te,unwrappedTileID:he},yt=f?we(Ge.x,Ge.y,R,ye):rt(Ge.x,Ge.y,tt),Ct=ne(b.cameraToCenterDistance,yt.signedDistanceFromCamera);let Rt=s.ai(C.textSizeData,O,Ee)*Ct/s.ap;f&&(Rt*=C.tilePixelRatio/B);const{width:qt,height:Nt,anchor:It,textOffset:Jt,textBoxScale:vr}=Ve,Dt=of(It,qt,Nt,Jt,vr,Rt),jt=ee.getPitchedTextCorrection(b,Ge.add(new s.P(te[0],te[1])),he),mr=vo(yt.point,tt,o,Dt,b.angle,jt),an=C.allowVerticalPlacement&&Ee.placedOrientation===s.ah.vertical?Math.PI/2:0;for(let Sr=0;Sr<Ee.numGlyphs;Sr++)s.aj(ke,mr,an);H&&Ee.associatedIconIndex>=0&&(Me[Ee.associatedIconIndex]={shiftedAnchor:mr,angle:an})}else Ft(Ee.numGlyphs,ke)}if(H){Ae.clear();const Re=C.icon.placedSymbolArray;for(let Ee=0;Ee<Re.length;Ee++){const Ve=Re.get(Ee);if(Ve.hidden)Ft(Ve.numGlyphs,Ae);else{const Ge=Me[Ee];if(Ge)for(let tt=0;tt<Ve.numGlyphs;tt++)s.aj(Ae,Ge.shiftedAnchor,Ge.angle);else Ft(Ve.numGlyphs,Ae)}}C.icon.dynamicLayoutVertexBuffer.updateData(Ae)}C.text.dynamicLayoutVertexBuffer.updateData(ke)}function li(C,o,f){return f.iconsInText&&o?"symbolTextAndIcon":C?"symbolSDF":"symbolIcon"}function lf(C,o,f,y,b,E,R,B,O,H,ee,te){const he=C.context,ye=he.gl,Se=C.transform,ke=Fn(),Ae=B==="map",Me=O==="map",Re=B!=="viewport"&&f.layout.get("symbol-placement")!=="point",Ee=Ae&&!Me&&!Re,Ve=!Me&&Re,Ge=!f.layout.get("symbol-sort-key").isConstant();let tt=!1;const yt=C.depthModeForSublayer(0,Cr.ReadOnly),Ct=f._unevaluatedLayout.hasValue("text-variable-anchor")||f._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Rt=[],qt=ke.getCircleRadiusCorrection(Se);for(const Nt of y){const It=o.getTile(Nt),Jt=It.getBucket(f);if(!Jt)continue;const vr=b?Jt.text:Jt.icon;if(!vr||!vr.segments.get().length||!vr.hasVisibleVertices)continue;const Dt=vr.programConfigurations.get(f.id),jt=b||Jt.sdfIcons,mr=b?Jt.textSizeData:Jt.iconSizeData,an=Me||Se.pitch!==0,Sr=C.useProgram(li(jt,b,Jt),Dt),Pr=s.ag(mr,Se.zoom),sn=C.style.map.terrain&&C.style.map.terrain.getTerrainData(Nt);let sa,Ai,on,za,xa=[0,0],oa=null;if(b)Ai=It.glyphAtlasTexture,on=ye.LINEAR,sa=It.glyphAtlasTexture.size,Jt.iconsInText&&(xa=It.imageAtlasTexture.size,oa=It.imageAtlasTexture,za=an||C.options.rotating||C.options.zooming||mr.kind==="composite"||mr.kind==="camera"?ye.LINEAR:ye.NEAREST);else{const Ar=f.layout.get("icon-size").constantOr(0)!==1||Jt.iconsNeedLinear;Ai=It.imageAtlasTexture,on=jt||C.options.rotating||C.options.zooming||Ar||an?ye.LINEAR:ye.NEAREST,sa=It.imageAtlasTexture.size}const ba=pr(It,1,C.transform.zoom),Yi=Ve?Nt.posMatrix:Cu,ml=Ot(Yi,Me,Ae,C.transform,ba),dd=Kt(Yi,Me,Ae,C.transform,ba),gl=Kt(Nt.posMatrix,Me,Ae,C.transform,ba),di=ke.translatePosition(C.transform,It,E,R),hd=Ct&&Jt.hasTextData(),Df=f.layout.get("icon-text-fit")!=="none"&&hd&&Jt.hasIconData();if(Re){const Ar=C.style.map.terrain?(vl,yl)=>C.style.map.terrain.getElevation(Nt,vl,yl):null,wo=f.layout.get("text-rotation-alignment")==="map";pe(Jt,Nt.posMatrix,C,b,ml,gl,Me,H,wo,ke,Nt.toUnwrapped(),Se.width,Se.height,di,Ar)}const hi=Nt.posMatrix,fi=b&&Ct||Df,$s=Re||fi?Cu:ml,Ni=dd,Xn=jt&&f.paint.get(b?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let la;la=jt?Jt.iconsInText?Xh(mr.kind,Pr,Ee,Me,Re,fi,C,hi,$s,Ni,di,sa,xa,qt):wu(mr.kind,Pr,Ee,Me,Re,fi,C,hi,$s,Ni,di,b,sa,!0,qt):og(mr.kind,Pr,Ee,Me,Re,fi,C,hi,$s,Ni,di,b,sa,qt);const Ya={program:Sr,buffers:vr,uniformValues:la,atlasTexture:Ai,atlasTextureIcon:oa,atlasInterpolation:on,atlasInterpolationIcon:za,isSDF:jt,hasHalo:Xn};if(Ge&&Jt.canOverlap){tt=!0;const Ar=vr.segments.get();for(const wo of Ar)Rt.push({segments:new s.a0([wo]),sortKey:wo.sortKey,state:Ya,terrainData:sn})}else Rt.push({segments:vr.segments,sortKey:0,state:Ya,terrainData:sn})}tt&&Rt.sort((Nt,It)=>Nt.sortKey-It.sortKey);for(const Nt of Rt){const It=Nt.state;if(he.activeTexture.set(ye.TEXTURE0),It.atlasTexture.bind(It.atlasInterpolation,ye.CLAMP_TO_EDGE),It.atlasTextureIcon&&(he.activeTexture.set(ye.TEXTURE1),It.atlasTextureIcon&&It.atlasTextureIcon.bind(It.atlasInterpolationIcon,ye.CLAMP_TO_EDGE)),It.isSDF){const Jt=It.uniformValues;It.hasHalo&&(Jt.u_is_halo=1,uf(It.buffers,Nt.segments,f,C,It.program,yt,ee,te,Jt,Nt.terrainData)),Jt.u_is_halo=0}uf(It.buffers,Nt.segments,f,C,It.program,yt,ee,te,It.uniformValues,Nt.terrainData)}}function uf(C,o,f,y,b,E,R,B,O,H){const ee=y.context;b.draw(ee,ee.gl.TRIANGLES,E,R,B,Wr.disabled,O,H,f.id,C.layoutVertexBuffer,C.indexBuffer,o,f.paint,y.transform.zoom,C.programConfigurations.get(f.id),C.dynamicLayoutVertexBuffer,C.opacityVertexBuffer)}function cf(C,o,f,y){const b=C.context,E=b.gl,R=en.disabled,B=new Sn([E.ONE,E.ONE],s.aM.transparent,[!0,!0,!0,!0]),O=o.getBucket(f);if(!O)return;const H=y.key;let ee=f.heatmapFbos.get(H);ee||(ee=ku(b,o.tileSize,o.tileSize),f.heatmapFbos.set(H,ee)),b.bindFramebuffer.set(ee.framebuffer),b.viewport.set([0,0,o.tileSize,o.tileSize]),b.clear({color:s.aM.transparent});const te=O.programConfigurations.get(f.id),he=C.useProgram("heatmap",te),ye=C.style.map.terrain.getTerrainData(y);he.draw(b,E.TRIANGLES,Cr.disabled,R,B,Wr.disabled,Da(y.posMatrix,o,C.transform.zoom,f.paint.get("heatmap-intensity")),ye,f.id,O.layoutVertexBuffer,O.indexBuffer,O.segments,f.paint,C.transform.zoom,te)}function yo(C,o,f){const y=C.context,b=y.gl;y.setColorMode(C.colorModeForRenderPass());const E=Tu(y,o),R=f.key,B=o.heatmapFbos.get(R);B&&(y.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,B.colorAttachment.get()),y.activeTexture.set(b.TEXTURE1),E.bind(b.LINEAR,b.CLAMP_TO_EDGE),C.useProgram("heatmapTexture").draw(y,b.TRIANGLES,Cr.disabled,en.disabled,C.colorModeForRenderPass(),Wr.disabled,jc(C,o,0,1),null,o.id,C.rasterBoundsBuffer,C.quadTriangleIndexBuffer,C.rasterBoundsSegments,o.paint,C.transform.zoom),B.destroy(),o.heatmapFbos.delete(R))}function ku(C,o,f){var y,b;const E=C.gl,R=E.createTexture();E.bindTexture(E.TEXTURE_2D,R),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,E.LINEAR),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,E.LINEAR);const B=(y=C.HALF_FLOAT)!==null&&y!==void 0?y:E.UNSIGNED_BYTE,O=(b=C.RGBA16F)!==null&&b!==void 0?b:E.RGBA;E.texImage2D(E.TEXTURE_2D,0,O,o,f,0,E.RGBA,B,null);const H=C.createFramebuffer(o,f,!1,!1);return H.colorAttachment.set(R),H}function Tu(C,o){return o.colorRampTexture||(o.colorRampTexture=new Z(C,o.colorRamp,C.gl.RGBA)),o.colorRampTexture}function tl(C,o,f,y,b){if(!f||!y||!y.imageAtlas)return;const E=y.imageAtlas.patternPositions;let R=E[f.to.toString()],B=E[f.from.toString()];if(!R&&B&&(R=B),!B&&R&&(B=R),!R||!B){const O=b.getPaintProperty(o);R=E[O],B=E[O]}R&&B&&C.setConstantPatternPositions(R,B)}function Pu(C,o,f,y,b,E,R){const B=C.context.gl,O="fill-pattern",H=f.paint.get(O),ee=H&&H.constantOr(1),te=f.getCrossfadeParameters();let he,ye,Se,ke,Ae;R?(ye=ee&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",he=B.LINES):(ye=ee?"fillPattern":"fill",he=B.TRIANGLES);const Me=H.constantOr(null);for(const Re of y){const Ee=o.getTile(Re);if(ee&&!Ee.patternsLoaded())continue;const Ve=Ee.getBucket(f);if(!Ve)continue;const Ge=Ve.programConfigurations.get(f.id),tt=C.useProgram(ye,Ge),yt=C.style.map.terrain&&C.style.map.terrain.getTerrainData(Re);ee&&(C.context.activeTexture.set(B.TEXTURE0),Ee.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Ge.updatePaintBuffers(te)),tl(Ge,O,Me,Ee,f);const Ct=yt?Re:null,Rt=C.translatePosMatrix(Ct?Ct.posMatrix:Re.posMatrix,Ee,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));if(R){ke=Ve.indexBuffer2,Ae=Ve.segments2;const qt=[B.drawingBufferWidth,B.drawingBufferHeight];Se=ye==="fillOutlinePattern"&&ee?ng(Rt,C,te,Ee,qt):gx(Rt,qt)}else ke=Ve.indexBuffer,Ae=Ve.segments,Se=ee?rg(Rt,C,te,Ee):Yo(Rt);tt.draw(C.context,he,b,C.stencilModeForClipping(Re),E,Wr.disabled,Se,yt,f.id,Ve.layoutVertexBuffer,ke,Ae,f.paint,C.transform.zoom,Ge)}}function Wc(C,o,f,y,b,E,R){const B=C.context,O=B.gl,H="fill-extrusion-pattern",ee=f.paint.get(H),te=ee.constantOr(1),he=f.getCrossfadeParameters(),ye=f.paint.get("fill-extrusion-opacity"),Se=ee.constantOr(null);for(const ke of y){const Ae=o.getTile(ke),Me=Ae.getBucket(f);if(!Me)continue;const Re=C.style.map.terrain&&C.style.map.terrain.getTerrainData(ke),Ee=Me.programConfigurations.get(f.id),Ve=C.useProgram(te?"fillExtrusionPattern":"fillExtrusion",Ee);te&&(C.context.activeTexture.set(O.TEXTURE0),Ae.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),Ee.updatePaintBuffers(he)),tl(Ee,H,Se,Ae,f);const Ge=C.translatePosMatrix(ke.posMatrix,Ae,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),tt=f.paint.get("fill-extrusion-vertical-gradient"),yt=te?Bc(Ge,C,tt,ye,ke,he,Ae):bu(Ge,C,tt,ye);Ve.draw(B,B.gl.TRIANGLES,b,E,R,Wr.backCCW,yt,Re,f.id,Me.layoutVertexBuffer,Me.indexBuffer,Me.segments,f.paint,C.transform.zoom,Ee,C.style.map.terrain&&Me.centroidVertexBuffer)}}function rl(C,o,f,y,b,E,R){const B=C.context,O=B.gl,H=f.fbo;if(!H)return;const ee=C.useProgram("hillshade"),te=C.style.map.terrain&&C.style.map.terrain.getTerrainData(o);B.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,H.colorAttachment.get()),ee.draw(B,O.TRIANGLES,b,E,R,Wr.disabled,((he,ye,Se,ke)=>{const Ae=Se.paint.get("hillshade-shadow-color"),Me=Se.paint.get("hillshade-highlight-color"),Re=Se.paint.get("hillshade-accent-color");let Ee=Se.paint.get("hillshade-illumination-direction")*(Math.PI/180);Se.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ee-=he.transform.angle);const Ve=!he.options.moving;return{u_matrix:ke?ke.posMatrix:he.transform.calculatePosMatrix(ye.tileID.toUnwrapped(),Ve),u_image:0,u_latrange:Oc(0,ye.tileID),u_light:[Se.paint.get("hillshade-exaggeration"),Ee],u_shadow:Ae,u_highlight:Me,u_accent:Re}})(C,f,y,te?o:null),te,y.id,C.rasterBoundsBuffer,C.quadTriangleIndexBuffer,C.rasterBoundsSegments)}function nl(C,o,f,y,b,E){const R=C.context,B=R.gl,O=o.dem;if(O&&O.data){const H=O.dim,ee=O.stride,te=O.getPixels();if(R.activeTexture.set(B.TEXTURE1),R.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||C.getTileTexture(ee),o.demTexture){const ye=o.demTexture;ye.update(te,{premultiply:!1}),ye.bind(B.NEAREST,B.CLAMP_TO_EDGE)}else o.demTexture=new Z(R,te,B.RGBA,{premultiply:!1}),o.demTexture.bind(B.NEAREST,B.CLAMP_TO_EDGE);R.activeTexture.set(B.TEXTURE0);let he=o.fbo;if(!he){const ye=new Z(R,{width:H,height:H,data:null},B.RGBA);ye.bind(B.LINEAR,B.CLAMP_TO_EDGE),he=o.fbo=R.createFramebuffer(H,H,!0,!1),he.colorAttachment.set(ye.texture)}R.bindFramebuffer.set(he.framebuffer),R.viewport.set([0,0,H,H]),C.useProgram("hillshadePrepare").draw(R,B.TRIANGLES,y,b,E,Wr.disabled,((ye,Se)=>{const ke=Se.stride,Ae=s.H();return s.aP(Ae,0,s.X,-s.X,0,0,1),s.J(Ae,Ae,[0,-s.X,0]),{u_matrix:Ae,u_image:1,u_dimension:[ke,ke],u_zoom:ye.overscaledZ,u_unpack:Se.getUnpackVector()}})(o.tileID,O),null,f.id,C.rasterBoundsBuffer,C.quadTriangleIndexBuffer,C.rasterBoundsSegments),o.needsHillshadePrepare=!1}}function bg(C,o,f,y,b,E){const R=y.paint.get("raster-fade-duration");if(!E&&R>0){const B=v.now(),O=(B-C.timeAdded)/R,H=o?(B-o.timeAdded)/R:-1,ee=f.getSource(),te=b.coveringZoomLevel({tileSize:ee.tileSize,roundZoom:ee.roundZoom}),he=!o||Math.abs(o.tileID.overscaledZ-te)>Math.abs(C.tileID.overscaledZ-te),ye=he&&C.refreshedUponExpiration?1:s.ac(he?O:1-H,0,1);return C.refreshedUponExpiration&&O>=1&&(C.refreshedUponExpiration=!1),o?{opacity:1,mix:1-ye}:{opacity:ye,mix:0}}return{opacity:1,mix:0}}const df=new s.aM(1,0,0,1),Rr=new s.aM(0,1,0,1),Zc=new s.aM(0,0,1,1),Nx=new s.aM(1,0,1,1),_g=new s.aM(0,1,1,1);function al(C,o,f,y){Xc(C,0,o+f/2,C.transform.width,f,y)}function wg(C,o,f,y){Xc(C,o-f/2,0,f,C.transform.height,y)}function Xc(C,o,f,y,b,E){const R=C.context,B=R.gl;B.enable(B.SCISSOR_TEST),B.scissor(o*C.pixelRatio,f*C.pixelRatio,y*C.pixelRatio,b*C.pixelRatio),R.clear({color:E}),B.disable(B.SCISSOR_TEST)}function Sg(C,o,f){const y=C.context,b=y.gl,E=f.posMatrix,R=C.useProgram("debug"),B=Cr.disabled,O=en.disabled,H=C.colorModeForRenderPass(),ee="$debug",te=C.style.map.terrain&&C.style.map.terrain.getTerrainData(f);y.activeTexture.set(b.TEXTURE0);const he=o.getTileByID(f.key).latestRawTileData,ye=Math.floor((he&&he.byteLength||0)/1024),Se=o.getTile(f).tileSize,ke=512/Math.min(Se,512)*(f.overscaledZ/C.transform.zoom)*.5;let Ae=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(Ae+=` => ${f.overscaledZ}`),function(Me,Re){Me.initDebugOverlayCanvas();const Ee=Me.debugOverlayCanvas,Ve=Me.context.gl,Ge=Me.debugOverlayCanvas.getContext("2d");Ge.clearRect(0,0,Ee.width,Ee.height),Ge.shadowColor="white",Ge.shadowBlur=2,Ge.lineWidth=1.5,Ge.strokeStyle="white",Ge.textBaseline="top",Ge.font="bold 36px Open Sans, sans-serif",Ge.fillText(Re,5,5),Ge.strokeText(Re,5,5),Me.debugOverlayTexture.update(Ee),Me.debugOverlayTexture.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE)}(C,`${Ae} ${ye}kB`),R.draw(y,b.TRIANGLES,B,O,Sn.alphaBlended,Wr.disabled,_u(E,s.aM.transparent,ke),null,ee,C.debugBuffer,C.quadTriangleIndexBuffer,C.debugSegments),R.draw(y,b.LINE_STRIP,B,O,H,Wr.disabled,_u(E,s.aM.red),te,ee,C.debugBuffer,C.tileBorderIndexBuffer,C.debugSegments)}function Eg(C,o,f){const y=C.context,b=y.gl,E=C.colorModeForRenderPass(),R=new Cr(b.LEQUAL,Cr.ReadWrite,C.depthRangeFor3D),B=C.useProgram("terrain"),O=o.getTerrainMesh();y.bindFramebuffer.set(null),y.viewport.set([0,0,C.width,C.height]);for(const H of f){const ee=C.renderToTexture.getTexture(H),te=o.getTerrainData(H.tileID);y.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,ee.texture);const he=C.transform.calculatePosMatrix(H.tileID.toUnwrapped()),ye=o.getMeshFrameDelta(C.transform.zoom),Se=C.transform.calculateFogMatrix(H.tileID.toUnwrapped()),ke=Wh(he,ye,Se,C.style.sky,C.transform.pitch);B.draw(y,b.TRIANGLES,R,en.disabled,E,Wr.backCCW,ke,te,"terrain",O.vertexBuffer,O.indexBuffer,O.segments)}}class Kc{constructor(o,f,y){this.vertexBuffer=o,this.indexBuffer=f,this.segments=y}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class Yc{constructor(o,f){this.context=new Ax(o),this.transform=f,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=qe.maxUnderzooming+qe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new zc}resize(o,f,y){if(this.width=Math.floor(o*y),this.height=Math.floor(f*y),this.pixelRatio=y,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const b of this.style._order)this.style._layers[b].resize()}setup(){const o=this.context,f=new s.aX;f.emplaceBack(0,0),f.emplaceBack(s.X,0),f.emplaceBack(0,s.X),f.emplaceBack(s.X,s.X),this.tileExtentBuffer=o.createVertexBuffer(f,co.members),this.tileExtentSegments=s.a0.simpleSegment(0,0,4,2);const y=new s.aX;y.emplaceBack(0,0),y.emplaceBack(s.X,0),y.emplaceBack(0,s.X),y.emplaceBack(s.X,s.X),this.debugBuffer=o.createVertexBuffer(y,co.members),this.debugSegments=s.a0.simpleSegment(0,0,4,5);const b=new s.$;b.emplaceBack(0,0,0,0),b.emplaceBack(s.X,0,s.X,0),b.emplaceBack(0,s.X,0,s.X),b.emplaceBack(s.X,s.X,s.X,s.X),this.rasterBoundsBuffer=o.createVertexBuffer(b,Et.members),this.rasterBoundsSegments=s.a0.simpleSegment(0,0,4,2);const E=new s.aX;E.emplaceBack(0,0),E.emplaceBack(1,0),E.emplaceBack(0,1),E.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(E,co.members),this.viewportSegments=s.a0.simpleSegment(0,0,4,2);const R=new s.aZ;R.emplaceBack(0),R.emplaceBack(1),R.emplaceBack(3),R.emplaceBack(2),R.emplaceBack(0),this.tileBorderIndexBuffer=o.createIndexBuffer(R);const B=new s.aY;B.emplaceBack(0,1,2),B.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(B);const O=this.context.gl;this.stencilClearMode=new en({func:O.ALWAYS,mask:0},0,255,O.ZERO,O.ZERO,O.ZERO)}clearStencil(){const o=this.context,f=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const y=s.H();s.aP(y,0,this.width,this.height,0,0,1),s.K(y,y,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(o,f.TRIANGLES,Cr.disabled,this.stencilClearMode,Sn.disabled,Wr.disabled,Ma(y),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(o,f){if(this.currentStencilSource===o.source||!o.isTileClipped()||!f||!f.length)return;this.currentStencilSource=o.source;const y=this.context,b=y.gl;this.nextStencilID+f.length>256&&this.clearStencil(),y.setColorMode(Sn.disabled),y.setDepthMode(Cr.disabled);const E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const R of f){const B=this._tileClippingMaskIDs[R.key]=this.nextStencilID++,O=this.style.map.terrain&&this.style.map.terrain.getTerrainData(R);E.draw(y,b.TRIANGLES,Cr.disabled,new en({func:b.ALWAYS,mask:0},B,255,b.KEEP,b.KEEP,b.REPLACE),Sn.disabled,Wr.disabled,Ma(R.posMatrix),O,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,f=this.context.gl;return new en({func:f.NOTEQUAL,mask:255},o,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(o){const f=this.context.gl;return new en({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,f.KEEP,f.KEEP,f.REPLACE)}stencilConfigForOverlap(o){const f=this.context.gl,y=o.sort((R,B)=>B.overscaledZ-R.overscaledZ),b=y[y.length-1].overscaledZ,E=y[0].overscaledZ-b+1;if(E>1){this.currentStencilSource=void 0,this.nextStencilID+E>256&&this.clearStencil();const R={};for(let B=0;B<E;B++)R[B+b]=new en({func:f.GEQUAL,mask:255},B+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=E,[R,y]}return[{[b]:en.disabled},y]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new Sn([o.CONSTANT_COLOR,o.ONE],new s.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Sn.unblended:Sn.alphaBlended}depthModeForSublayer(o,f,y){if(!this.opaquePassEnabledForLayer())return Cr.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new Cr(y||this.context.gl.LEQUAL,f,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,f){this.style=o,this.options=f,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(v.now()),this.imageManager.beginFrame();const y=this.style._order,b=this.style.sourceCaches,E={},R={},B={};for(const O in b){const H=b[O];H.used&&H.prepare(this.context),E[O]=H.getVisibleCoordinates(),R[O]=E[O].slice().reverse(),B[O]=H.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let O=0;O<y.length;O++)if(this.style._layers[y[O]].is3D()){this.opaquePassCutoff=O;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const O of y){const H=this.style._layers[O];if(!H.hasOffscreenPass()||H.isHidden(this.transform.zoom))continue;const ee=R[H.source];(H.type==="custom"||ee.length)&&this.renderLayer(this,b[H.source],H,ee)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?s.aM.black:s.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(O,H){const ee=O.context,te=ee.gl,he=((Me,Re,Ee)=>({u_sky_color:Me.properties.get("sky-color"),u_horizon_color:Me.properties.get("horizon-color"),u_horizon:(Re.height/2+Re.getHorizon())*Ee,u_sky_horizon_blend:Me.properties.get("sky-horizon-blend")*Re.height/2*Ee}))(H,O.style.map.transform,O.pixelRatio),ye=new Cr(te.LEQUAL,Cr.ReadWrite,[0,1]),Se=en.disabled,ke=O.colorModeForRenderPass(),Ae=O.useProgram("sky");if(!H.mesh){const Me=new s.aX;Me.emplaceBack(-1,-1),Me.emplaceBack(1,-1),Me.emplaceBack(1,1),Me.emplaceBack(-1,1);const Re=new s.aY;Re.emplaceBack(0,1,2),Re.emplaceBack(0,2,3),H.mesh=new Kc(ee.createVertexBuffer(Me,co.members),ee.createIndexBuffer(Re),s.a0.simpleSegment(0,0,Me.length,Re.length))}Ae.draw(ee,te.TRIANGLES,ye,Se,ke,Wr.disabled,he,void 0,"sky",H.mesh.vertexBuffer,H.mesh.indexBuffer,H.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(o._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){const O=this.style._layers[y[this.currentLayer]],H=b[O.source],ee=E[O.source];this._renderTileClippingMasks(O,ee),this.renderLayer(this,H,O,ee)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){const O=this.style._layers[y[this.currentLayer]],H=b[O.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(O))continue;const ee=(O.type==="symbol"?B:R)[O.source];this._renderTileClippingMasks(O,E[O.source]),this.renderLayer(this,H,O,ee)}if(this.options.showTileBoundaries){const O=function(H,ee){let te=null;const he=Object.values(H._layers).flatMap(Ae=>Ae.source&&!Ae.isHidden(ee)?[H.sourceCaches[Ae.source]]:[]),ye=he.filter(Ae=>Ae.getSource().type==="vector"),Se=he.filter(Ae=>Ae.getSource().type!=="vector"),ke=Ae=>{(!te||te.getSource().maxzoom<Ae.getSource().maxzoom)&&(te=Ae)};return ye.forEach(Ae=>ke(Ae)),te||Se.forEach(Ae=>ke(Ae)),te}(this.style,this.transform.zoom);O&&function(H,ee,te){for(let he=0;he<te.length;he++)Sg(H,ee,te[he])}(this,O,O.getVisibleCoordinates())}this.options.showPadding&&function(O){const H=O.transform.padding;al(O,O.transform.height-(H.top||0),3,df),al(O,H.bottom||0,3,Rr),wg(O,H.left||0,3,Zc),wg(O,O.transform.width-(H.right||0),3,Nx);const ee=O.transform.centerPoint;(function(te,he,ye,Se){Xc(te,he-1,ye-10,2,20,Se),Xc(te,he-10,ye-1,20,2,Se)})(O,ee.x,O.transform.height-ee.y,_g)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(o){if(!this.style||!this.style.map||!this.style.map.terrain)return;const f=this.terrainFacilitator.matrix,y=this.transform.modelViewProjectionMatrix;let b=this.terrainFacilitator.dirty;b||(b=o?!s.a_(f,y):!s.a$(f,y)),b||(b=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),b&&(s.b0(f,y),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(E,R){const B=E.context,O=B.gl,H=Sn.unblended,ee=new Cr(O.LEQUAL,Cr.ReadWrite,[0,1]),te=R.getTerrainMesh(),he=R.sourceCache.getRenderableTiles(),ye=E.useProgram("terrainDepth");B.bindFramebuffer.set(R.getFramebuffer("depth").framebuffer),B.viewport.set([0,0,E.width/devicePixelRatio,E.height/devicePixelRatio]),B.clear({color:s.aM.transparent,depth:1});for(const Se of he){const ke=R.getTerrainData(Se.tileID),Ae={u_matrix:E.transform.calculatePosMatrix(Se.tileID.toUnwrapped()),u_ele_delta:R.getMeshFrameDelta(E.transform.zoom)};ye.draw(B,O.TRIANGLES,ee,en.disabled,H,Wr.backCCW,Ae,ke,"terrain",te.vertexBuffer,te.indexBuffer,te.segments)}B.bindFramebuffer.set(null),B.viewport.set([0,0,E.width,E.height])}(this,this.style.map.terrain),function(E,R){const B=E.context,O=B.gl,H=Sn.unblended,ee=new Cr(O.LEQUAL,Cr.ReadWrite,[0,1]),te=R.getTerrainMesh(),he=R.getCoordsTexture(),ye=R.sourceCache.getRenderableTiles(),Se=E.useProgram("terrainCoords");B.bindFramebuffer.set(R.getFramebuffer("coords").framebuffer),B.viewport.set([0,0,E.width/devicePixelRatio,E.height/devicePixelRatio]),B.clear({color:s.aM.transparent,depth:1}),R.coordsIndex=[];for(const ke of ye){const Ae=R.getTerrainData(ke.tileID);B.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,he.texture);const Me={u_matrix:E.transform.calculatePosMatrix(ke.tileID.toUnwrapped()),u_terrain_coords_id:(255-R.coordsIndex.length)/255,u_texture:0,u_ele_delta:R.getMeshFrameDelta(E.transform.zoom)};Se.draw(B,O.TRIANGLES,ee,en.disabled,H,Wr.backCCW,Me,Ae,"terrain",te.vertexBuffer,te.indexBuffer,te.segments),R.coordsIndex.push(ke.tileID.key)}B.bindFramebuffer.set(null),B.viewport.set([0,0,E.width,E.height])}(this,this.style.map.terrain))}renderLayer(o,f,y,b){if(!y.isHidden(this.transform.zoom)&&(y.type==="background"||y.type==="custom"||(b||[]).length))switch(this.id=y.id,y.type){case"symbol":(function(E,R,B,O,H){if(E.renderPass!=="translucent")return;const ee=en.disabled,te=E.colorModeForRenderPass();(B._unevaluatedLayout.hasValue("text-variable-anchor")||B._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(he,ye,Se,ke,Ae,Me,Re,Ee,Ve){const Ge=ye.transform,tt=Fn(),yt=Ae==="map",Ct=Me==="map";for(const Rt of he){const qt=ke.getTile(Rt),Nt=qt.getBucket(Se);if(!Nt||!Nt.text||!Nt.text.segments.get().length)continue;const It=s.ag(Nt.textSizeData,Ge.zoom),Jt=pr(qt,1,ye.transform.zoom),vr=Ot(Rt.posMatrix,Ct,yt,ye.transform,Jt),Dt=Se.layout.get("icon-text-fit")!=="none"&&Nt.hasIconData();if(It){const jt=Math.pow(2,Ge.zoom-qt.tileID.overscaledZ),mr=ye.style.map.terrain?(Sr,Pr)=>ye.style.map.terrain.getElevation(Rt,Sr,Pr):null,an=tt.translatePosition(Ge,qt,Re,Ee);el(Nt,yt,Ct,Ve,Ge,vr,Rt.posMatrix,jt,It,Dt,tt,an,Rt.toUnwrapped(),mr)}}}(O,E,B,R,B.layout.get("text-rotation-alignment"),B.layout.get("text-pitch-alignment"),B.paint.get("text-translate"),B.paint.get("text-translate-anchor"),H),B.paint.get("icon-opacity").constantOr(1)!==0&&lf(E,R,B,O,!1,B.paint.get("icon-translate"),B.paint.get("icon-translate-anchor"),B.layout.get("icon-rotation-alignment"),B.layout.get("icon-pitch-alignment"),B.layout.get("icon-keep-upright"),ee,te),B.paint.get("text-opacity").constantOr(1)!==0&&lf(E,R,B,O,!0,B.paint.get("text-translate"),B.paint.get("text-translate-anchor"),B.layout.get("text-rotation-alignment"),B.layout.get("text-pitch-alignment"),B.layout.get("text-keep-upright"),ee,te),R.map.showCollisionBoxes&&(Eu(E,R,B,O,!0),Eu(E,R,B,O,!1))})(o,f,y,b,this.style.placement.variableOffsets);break;case"circle":(function(E,R,B,O){if(E.renderPass!=="translucent")return;const H=B.paint.get("circle-opacity"),ee=B.paint.get("circle-stroke-width"),te=B.paint.get("circle-stroke-opacity"),he=!B.layout.get("circle-sort-key").isConstant();if(H.constantOr(1)===0&&(ee.constantOr(1)===0||te.constantOr(1)===0))return;const ye=E.context,Se=ye.gl,ke=E.depthModeForSublayer(0,Cr.ReadOnly),Ae=en.disabled,Me=E.colorModeForRenderPass(),Re=[];for(let Ee=0;Ee<O.length;Ee++){const Ve=O[Ee],Ge=R.getTile(Ve),tt=Ge.getBucket(B);if(!tt)continue;const yt=tt.programConfigurations.get(B.id),Ct=E.useProgram("circle",yt),Rt=tt.layoutVertexBuffer,qt=tt.indexBuffer,Nt=E.style.map.terrain&&E.style.map.terrain.getTerrainData(Ve),It={programConfiguration:yt,program:Ct,layoutVertexBuffer:Rt,indexBuffer:qt,uniformValues:vx(E,Ve,Ge,B),terrainData:Nt};if(he){const Jt=tt.segments.get();for(const vr of Jt)Re.push({segments:new s.a0([vr]),sortKey:vr.sortKey,state:It})}else Re.push({segments:tt.segments,sortKey:0,state:It})}he&&Re.sort((Ee,Ve)=>Ee.sortKey-Ve.sortKey);for(const Ee of Re){const{programConfiguration:Ve,program:Ge,layoutVertexBuffer:tt,indexBuffer:yt,uniformValues:Ct,terrainData:Rt}=Ee.state;Ge.draw(ye,Se.TRIANGLES,ke,Ae,Me,Wr.disabled,Ct,Rt,B.id,tt,yt,Ee.segments,B.paint,E.transform.zoom,Ve)}})(o,f,y,b);break;case"heatmap":(function(E,R,B,O){if(B.paint.get("heatmap-opacity")===0)return;const H=E.context;if(E.style.map.terrain){for(const ee of O){const te=R.getTile(ee);R.hasRenderableParent(ee)||(E.renderPass==="offscreen"?cf(E,te,B,ee):E.renderPass==="translucent"&&yo(E,B,ee))}H.viewport.set([0,0,E.width,E.height])}else E.renderPass==="offscreen"?function(ee,te,he,ye){const Se=ee.context,ke=Se.gl,Ae=en.disabled,Me=new Sn([ke.ONE,ke.ONE],s.aM.transparent,[!0,!0,!0,!0]);(function(Re,Ee,Ve){const Ge=Re.gl;Re.activeTexture.set(Ge.TEXTURE1),Re.viewport.set([0,0,Ee.width/4,Ee.height/4]);let tt=Ve.heatmapFbos.get(s.aU);tt?(Ge.bindTexture(Ge.TEXTURE_2D,tt.colorAttachment.get()),Re.bindFramebuffer.set(tt.framebuffer)):(tt=ku(Re,Ee.width/4,Ee.height/4),Ve.heatmapFbos.set(s.aU,tt))})(Se,ee,he),Se.clear({color:s.aM.transparent});for(let Re=0;Re<ye.length;Re++){const Ee=ye[Re];if(te.hasRenderableParent(Ee))continue;const Ve=te.getTile(Ee),Ge=Ve.getBucket(he);if(!Ge)continue;const tt=Ge.programConfigurations.get(he.id),yt=ee.useProgram("heatmap",tt),{zoom:Ct}=ee.transform;yt.draw(Se,ke.TRIANGLES,Cr.disabled,Ae,Me,Wr.disabled,Da(Ee.posMatrix,Ve,Ct,he.paint.get("heatmap-intensity")),null,he.id,Ge.layoutVertexBuffer,Ge.indexBuffer,Ge.segments,he.paint,ee.transform.zoom,tt)}Se.viewport.set([0,0,ee.width,ee.height])}(E,R,B,O):E.renderPass==="translucent"&&function(ee,te){const he=ee.context,ye=he.gl;he.setColorMode(ee.colorModeForRenderPass());const Se=te.heatmapFbos.get(s.aU);Se&&(he.activeTexture.set(ye.TEXTURE0),ye.bindTexture(ye.TEXTURE_2D,Se.colorAttachment.get()),he.activeTexture.set(ye.TEXTURE1),Tu(he,te).bind(ye.LINEAR,ye.CLAMP_TO_EDGE),ee.useProgram("heatmapTexture").draw(he,ye.TRIANGLES,Cr.disabled,en.disabled,ee.colorModeForRenderPass(),Wr.disabled,jc(ee,te,0,1),null,te.id,ee.viewportBuffer,ee.quadTriangleIndexBuffer,ee.viewportSegments,te.paint,ee.transform.zoom))}(E,B)})(o,f,y,b);break;case"line":(function(E,R,B,O){if(E.renderPass!=="translucent")return;const H=B.paint.get("line-opacity"),ee=B.paint.get("line-width");if(H.constantOr(1)===0||ee.constantOr(1)===0)return;const te=E.depthModeForSublayer(0,Cr.ReadOnly),he=E.colorModeForRenderPass(),ye=B.paint.get("line-dasharray"),Se=B.paint.get("line-pattern"),ke=Se.constantOr(1),Ae=B.paint.get("line-gradient"),Me=B.getCrossfadeParameters(),Re=ke?"linePattern":ye?"lineSDF":Ae?"lineGradient":"line",Ee=E.context,Ve=Ee.gl;let Ge=!0;for(const tt of O){const yt=R.getTile(tt);if(ke&&!yt.patternsLoaded())continue;const Ct=yt.getBucket(B);if(!Ct)continue;const Rt=Ct.programConfigurations.get(B.id),qt=E.context.program.get(),Nt=E.useProgram(Re,Rt),It=Ge||Nt.program!==qt,Jt=E.style.map.terrain&&E.style.map.terrain.getTerrainData(tt),vr=Se.constantOr(null);if(vr&&yt.imageAtlas){const mr=yt.imageAtlas,an=mr.patternPositions[vr.to.toString()],Sr=mr.patternPositions[vr.from.toString()];an&&Sr&&Rt.setConstantPatternPositions(an,Sr)}const Dt=Jt?tt:null,jt=ke?Jo(E,yt,B,Me,Dt):ye?yx(E,yt,B,ye,Me,Dt):Ae?ag(E,yt,B,Ct.lineClipsArray.length,Dt):Fc(E,yt,B,Dt);if(ke)Ee.activeTexture.set(Ve.TEXTURE0),yt.imageAtlasTexture.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE),Rt.updatePaintBuffers(Me);else if(ye&&(It||E.lineAtlas.dirty))Ee.activeTexture.set(Ve.TEXTURE0),E.lineAtlas.bind(Ee);else if(Ae){const mr=Ct.gradients[B.id];let an=mr.texture;if(B.gradientVersion!==mr.version){let Sr=256;if(B.stepInterpolant){const Pr=R.getSource().maxzoom,sn=tt.canonical.z===Pr?Math.ceil(1<<E.transform.maxZoom-tt.canonical.z):1;Sr=s.ac(s.aV(Ct.maxLineLength/s.X*1024*sn),256,Ee.maxTextureSize)}mr.gradient=s.aW({expression:B.gradientExpression(),evaluationKey:"lineProgress",resolution:Sr,image:mr.gradient||void 0,clips:Ct.lineClipsArray}),mr.texture?mr.texture.update(mr.gradient):mr.texture=new Z(Ee,mr.gradient,Ve.RGBA),mr.version=B.gradientVersion,an=mr.texture}Ee.activeTexture.set(Ve.TEXTURE0),an.bind(B.stepInterpolant?Ve.NEAREST:Ve.LINEAR,Ve.CLAMP_TO_EDGE)}Nt.draw(Ee,Ve.TRIANGLES,te,E.stencilModeForClipping(tt),he,Wr.disabled,jt,Jt,B.id,Ct.layoutVertexBuffer,Ct.indexBuffer,Ct.segments,B.paint,E.transform.zoom,Rt,Ct.layoutVertexBuffer2),Ge=!1}})(o,f,y,b);break;case"fill":(function(E,R,B,O){const H=B.paint.get("fill-color"),ee=B.paint.get("fill-opacity");if(ee.constantOr(1)===0)return;const te=E.colorModeForRenderPass(),he=B.paint.get("fill-pattern"),ye=E.opaquePassEnabledForLayer()&&!he.constantOr(1)&&H.constantOr(s.aM.transparent).a===1&&ee.constantOr(0)===1?"opaque":"translucent";if(E.renderPass===ye){const Se=E.depthModeForSublayer(1,E.renderPass==="opaque"?Cr.ReadWrite:Cr.ReadOnly);Pu(E,R,B,O,Se,te,!1)}if(E.renderPass==="translucent"&&B.paint.get("fill-antialias")){const Se=E.depthModeForSublayer(B.getPaintProperty("fill-outline-color")?2:0,Cr.ReadOnly);Pu(E,R,B,O,Se,te,!0)}})(o,f,y,b);break;case"fill-extrusion":(function(E,R,B,O){const H=B.paint.get("fill-extrusion-opacity");if(H!==0&&E.renderPass==="translucent"){const ee=new Cr(E.context.gl.LEQUAL,Cr.ReadWrite,E.depthRangeFor3D);if(H!==1||B.paint.get("fill-extrusion-pattern").constantOr(1))Wc(E,R,B,O,ee,en.disabled,Sn.disabled),Wc(E,R,B,O,ee,E.stencilModeFor3D(),E.colorModeForRenderPass());else{const te=E.colorModeForRenderPass();Wc(E,R,B,O,ee,en.disabled,te)}}})(o,f,y,b);break;case"hillshade":(function(E,R,B,O){if(E.renderPass!=="offscreen"&&E.renderPass!=="translucent")return;const H=E.context,ee=E.depthModeForSublayer(0,Cr.ReadOnly),te=E.colorModeForRenderPass(),[he,ye]=E.renderPass==="translucent"?E.stencilConfigForOverlap(O):[{},O];for(const Se of ye){const ke=R.getTile(Se);ke.needsHillshadePrepare!==void 0&&ke.needsHillshadePrepare&&E.renderPass==="offscreen"?nl(E,ke,B,ee,en.disabled,te):E.renderPass==="translucent"&&rl(E,Se,ke,B,ee,he[Se.overscaledZ],te)}H.viewport.set([0,0,E.width,E.height])})(o,f,y,b);break;case"raster":(function(E,R,B,O){if(E.renderPass!=="translucent"||B.paint.get("raster-opacity")===0||!O.length)return;const H=E.context,ee=H.gl,te=R.getSource(),he=E.useProgram("raster"),ye=E.colorModeForRenderPass(),[Se,ke]=te instanceof Vt?[{},O]:E.stencilConfigForOverlap(O),Ae=ke[ke.length-1].overscaledZ,Me=!E.options.moving;for(const Re of ke){const Ee=E.depthModeForSublayer(Re.overscaledZ-Ae,B.paint.get("raster-opacity")===1?Cr.ReadWrite:Cr.ReadOnly,ee.LESS),Ve=R.getTile(Re);Ve.registerFadeDuration(B.paint.get("raster-fade-duration"));const Ge=R.findLoadedParent(Re,0),tt=R.findLoadedSibling(Re),yt=bg(Ve,Ge||tt||null,R,B,E.transform,E.style.map.terrain);let Ct,Rt;const qt=B.paint.get("raster-resampling")==="nearest"?ee.NEAREST:ee.LINEAR;H.activeTexture.set(ee.TEXTURE0),Ve.texture.bind(qt,ee.CLAMP_TO_EDGE,ee.LINEAR_MIPMAP_NEAREST),H.activeTexture.set(ee.TEXTURE1),Ge?(Ge.texture.bind(qt,ee.CLAMP_TO_EDGE,ee.LINEAR_MIPMAP_NEAREST),Ct=Math.pow(2,Ge.tileID.overscaledZ-Ve.tileID.overscaledZ),Rt=[Ve.tileID.canonical.x*Ct%1,Ve.tileID.canonical.y*Ct%1]):Ve.texture.bind(qt,ee.CLAMP_TO_EDGE,ee.LINEAR_MIPMAP_NEAREST),Ve.texture.useMipmap&&H.extTextureFilterAnisotropic&&E.transform.pitch>20&&ee.texParameterf(ee.TEXTURE_2D,H.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,H.extTextureFilterAnisotropicMax);const Nt=E.style.map.terrain&&E.style.map.terrain.getTerrainData(Re),It=Nt?Re:null,Jt=It?It.posMatrix:E.transform.calculatePosMatrix(Re.toUnwrapped(),Me),vr=xx(Jt,Rt||[0,0],Ct||1,yt,B);te instanceof Vt?he.draw(H,ee.TRIANGLES,Ee,en.disabled,ye,Wr.disabled,vr,Nt,B.id,te.boundsBuffer,E.quadTriangleIndexBuffer,te.boundsSegments):he.draw(H,ee.TRIANGLES,Ee,Se[Re.overscaledZ],ye,Wr.disabled,vr,Nt,B.id,E.rasterBoundsBuffer,E.quadTriangleIndexBuffer,E.rasterBoundsSegments)}})(o,f,y,b);break;case"background":(function(E,R,B,O){const H=B.paint.get("background-color"),ee=B.paint.get("background-opacity");if(ee===0)return;const te=E.context,he=te.gl,ye=E.transform,Se=ye.tileSize,ke=B.paint.get("background-pattern");if(E.isPatternMissing(ke))return;const Ae=!ke&&H.a===1&&ee===1&&E.opaquePassEnabledForLayer()?"opaque":"translucent";if(E.renderPass!==Ae)return;const Me=en.disabled,Re=E.depthModeForSublayer(0,Ae==="opaque"?Cr.ReadWrite:Cr.ReadOnly),Ee=E.colorModeForRenderPass(),Ve=E.useProgram(ke?"backgroundPattern":"background"),Ge=O||ye.coveringTiles({tileSize:Se,terrain:E.style.map.terrain});ke&&(te.activeTexture.set(he.TEXTURE0),E.imageManager.bind(E.context));const tt=B.getCrossfadeParameters();for(const yt of Ge){const Ct=O?yt.posMatrix:E.transform.calculatePosMatrix(yt.toUnwrapped()),Rt=ke?Kh(Ct,ee,E,ke,{tileID:yt,tileSize:Se},tt):$c(Ct,ee,H),qt=E.style.map.terrain&&E.style.map.terrain.getTerrainData(yt);Ve.draw(te,he.TRIANGLES,Re,Me,Ee,Wr.disabled,Rt,qt,B.id,E.tileExtentBuffer,E.quadTriangleIndexBuffer,E.tileExtentSegments)}})(o,0,y,b);break;case"custom":(function(E,R,B){const O=E.context,H=B.implementation;if(E.renderPass==="offscreen"){const ee=H.prerender;ee&&(E.setCustomLayerDefaults(),O.setColorMode(E.colorModeForRenderPass()),ee.call(H,O.gl,E.transform.customLayerMatrix()),O.setDirty(),E.setBaseState())}else if(E.renderPass==="translucent"){E.setCustomLayerDefaults(),O.setColorMode(E.colorModeForRenderPass()),O.setStencilMode(en.disabled);const ee=H.renderingMode==="3d"?new Cr(E.context.gl.LEQUAL,Cr.ReadWrite,E.depthRangeFor3D):E.depthModeForSublayer(0,Cr.ReadOnly);O.setDepthMode(ee),H.render(O.gl,E.transform.customLayerMatrix(),{farZ:E.transform.farZ,nearZ:E.transform.nearZ,fov:E.transform._fov,modelViewProjectionMatrix:E.transform.modelViewProjectionMatrix,projectionMatrix:E.transform.projectionMatrix}),O.setDirty(),E.setBaseState(),O.bindFramebuffer.set(null)}})(o,0,y)}}translatePosMatrix(o,f,y,b,E){if(!y[0]&&!y[1])return o;const R=E?b==="map"?this.transform.angle:0:b==="viewport"?-this.transform.angle:0;if(R){const H=Math.sin(R),ee=Math.cos(R);y=[y[0]*ee-y[1]*H,y[0]*H+y[1]*ee]}const B=[E?y[0]:pr(f,y[0],this.transform.zoom),E?y[1]:pr(f,y[1],this.transform.zoom),0],O=new Float32Array(16);return s.J(O,o,B),O}saveTileTexture(o){const f=this._tileTextures[o.size[0]];f?f.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const f=this._tileTextures[o];return f&&f.length>0?f.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const f=this.imageManager.getPattern(o.from.toString()),y=this.imageManager.getPattern(o.to.toString());return!f||!y}useProgram(o,f){this.cache=this.cache||{};const y=o+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[y]||(this.cache[y]=new Zh(this.context,Os[o],f,Yh[o],this._showOverdrawInspector,this.style.map.terrain)),this.cache[y]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Z(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:o,drawingBufferHeight:f}=this.context.gl;return this.width!==o||this.height!==f}}class il{constructor(o,f){this.points=o,this.planes=f}static fromInvProjectionMatrix(o,f,y){const b=Math.pow(2,y),E=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(B=>{const O=1/(B=s.af([],B,o))[3]/f*b;return s.b1(B,B,[O,O,1/B[3],O])}),R=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(B=>{const O=function(he,ye){var Se=ye[0],ke=ye[1],Ae=ye[2],Me=Se*Se+ke*ke+Ae*Ae;return Me>0&&(Me=1/Math.sqrt(Me)),he[0]=ye[0]*Me,he[1]=ye[1]*Me,he[2]=ye[2]*Me,he}([],function(he,ye,Se){var ke=ye[0],Ae=ye[1],Me=ye[2],Re=Se[0],Ee=Se[1],Ve=Se[2];return he[0]=Ae*Ve-Me*Ee,he[1]=Me*Re-ke*Ve,he[2]=ke*Ee-Ae*Re,he}([],$([],E[B[0]],E[B[1]]),$([],E[B[2]],E[B[1]]))),H=-((ee=O)[0]*(te=E[B[1]])[0]+ee[1]*te[1]+ee[2]*te[2]);var ee,te;return O.concat(H)});return new il(E,R)}}class sl{constructor(o,f){this.min=o,this.max=f,this.center=function(y,b,E){return y[0]=.5*b[0],y[1]=.5*b[1],y[2]=.5*b[2],y}([],function(y,b,E){return y[0]=b[0]+E[0],y[1]=b[1]+E[1],y[2]=b[2]+E[2],y}([],this.min,this.max))}quadrant(o){const f=[o%2==0,o<2],y=V(this.min),b=V(this.max);for(let E=0;E<f.length;E++)y[E]=f[E]?this.min[E]:this.center[E],b[E]=f[E]?this.center[E]:this.max[E];return b[2]=this.max[2],new sl(y,b)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}intersects(o){const f=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let y=!0;for(let b=0;b<o.planes.length;b++){const E=o.planes[b];let R=0;for(let B=0;B<f.length;B++)s.b2(E,f[B])>=0&&R++;if(R===0)return 0;R!==f.length&&(y=!1)}if(y)return 2;for(let b=0;b<3;b++){let E=Number.MAX_VALUE,R=-Number.MAX_VALUE;for(let B=0;B<o.points.length;B++){const O=o.points[B][b]-this.min[b];E=Math.min(E,O),R=Math.max(R,O)}if(R<0||E>this.max[b]-this.min[b])return 0}return 1}}class ol{constructor(o=0,f=0,y=0,b=0){if(isNaN(o)||o<0||isNaN(f)||f<0||isNaN(y)||y<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=f,this.left=y,this.right=b}interpolate(o,f,y){return f.top!=null&&o.top!=null&&(this.top=s.y.number(o.top,f.top,y)),f.bottom!=null&&o.bottom!=null&&(this.bottom=s.y.number(o.bottom,f.bottom,y)),f.left!=null&&o.left!=null&&(this.left=s.y.number(o.left,f.left,y)),f.right!=null&&o.right!=null&&(this.right=s.y.number(o.right,f.right,y)),this}getCenter(o,f){const y=s.ac((this.left+o-this.right)/2,0,o),b=s.ac((this.top+f-this.bottom)/2,0,f);return new s.P(y,b)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new ol(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const hf=85.051129;class ll{constructor(o,f,y,b,E){this.tileSize=512,this._renderWorldCopies=E===void 0||!!E,this._minZoom=o||0,this._maxZoom=f||22,this._minPitch=y??0,this._maxPitch=b??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new s.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ol,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const o=new ll(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return o.apply(this),o}apply(o){this.tileSize=o.tileSize,this.latRange=o.latRange,this.lngRange=o.lngRange,this.width=o.width,this.height=o.height,this._center=o._center,this._elevation=o._elevation,this.minElevationForCurrentTile=o.minElevationForCurrentTile,this.zoom=o.zoom,this.angle=o.angle,this._fov=o._fov,this._pitch=o._pitch,this._unmodified=o._unmodified,this._edgeInsets=o._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(o){const f=-s.b3(o,-180,180)*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=function(){var y=new s.A(4);return s.A!=Float32Array&&(y[1]=0,y[2]=0),y[0]=1,y[3]=1,y}(),function(y,b,E){var R=b[0],B=b[1],O=b[2],H=b[3],ee=Math.sin(E),te=Math.cos(E);y[0]=R*te+O*ee,y[1]=B*te+H*ee,y[2]=R*-ee+O*te,y[3]=B*-ee+H*te}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const f=s.ac(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(o){const f=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this.tileZoom=Math.max(0,Math.floor(f)),this.scale=this.zoomScale(f),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(o){o!==this._elevation&&(this._elevation=o,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,f,y){this._unmodified=!1,this._edgeInsets.interpolate(o,f,y),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const f=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,f)}getVisibleUnwrappedCoordinates(o){const f=[new s.b4(0,o)];if(this._renderWorldCopies){const y=this.pointCoordinate(new s.P(0,0)),b=this.pointCoordinate(new s.P(this.width,0)),E=this.pointCoordinate(new s.P(this.width,this.height)),R=this.pointCoordinate(new s.P(0,this.height)),B=Math.floor(Math.min(y.x,b.x,E.x,R.x)),O=Math.floor(Math.max(y.x,b.x,E.x,R.x)),H=1;for(let ee=B-H;ee<=O+H;ee++)ee!==0&&f.push(new s.b4(ee,o))}return f}coveringTiles(o){var f,y;let b=this.coveringZoomLevel(o);const E=b;if(o.minzoom!==void 0&&b<o.minzoom)return[];o.maxzoom!==void 0&&b>o.maxzoom&&(b=o.maxzoom);const R=this.pointCoordinate(this.getCameraPoint()),B=s.Z.fromLngLat(this.center),O=Math.pow(2,b),H=[O*R.x,O*R.y,0],ee=[O*B.x,O*B.y,0],te=il.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,b);let he=o.minzoom||0;!o.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(he=b);const ye=o.terrain?2/Math.min(this.tileSize,o.tileSize)*this.tileSize:3,Se=Ee=>({aabb:new sl([Ee*O,0,0],[(Ee+1)*O,O,0]),zoom:0,x:0,y:0,wrap:Ee,fullyVisible:!1}),ke=[],Ae=[],Me=b,Re=o.reparseOverscaled?E:b;if(this._renderWorldCopies)for(let Ee=1;Ee<=3;Ee++)ke.push(Se(-Ee)),ke.push(Se(Ee));for(ke.push(Se(0));ke.length>0;){const Ee=ke.pop(),Ve=Ee.x,Ge=Ee.y;let tt=Ee.fullyVisible;if(!tt){const Nt=Ee.aabb.intersects(te);if(Nt===0)continue;tt=Nt===2}const yt=o.terrain?H:ee,Ct=Ee.aabb.distanceX(yt),Rt=Ee.aabb.distanceY(yt),qt=Math.max(Math.abs(Ct),Math.abs(Rt));if(Ee.zoom===Me||qt>ye+(1<<Me-Ee.zoom)-2&&Ee.zoom>=he){const Nt=Me-Ee.zoom,It=H[0]-.5-(Ve<<Nt),Jt=H[1]-.5-(Ge<<Nt);Ae.push({tileID:new s.S(Ee.zoom===Me?Re:Ee.zoom,Ee.wrap,Ee.zoom,Ve,Ge),distanceSq:W([ee[0]-.5-Ve,ee[1]-.5-Ge]),tileDistanceToCamera:Math.sqrt(It*It+Jt*Jt)})}else for(let Nt=0;Nt<4;Nt++){const It=(Ve<<1)+Nt%2,Jt=(Ge<<1)+(Nt>>1),vr=Ee.zoom+1;let Dt=Ee.aabb.quadrant(Nt);if(o.terrain){const jt=new s.S(vr,Ee.wrap,vr,It,Jt),mr=o.terrain.getMinMaxElevation(jt),an=(f=mr.minElevation)!==null&&f!==void 0?f:this.elevation,Sr=(y=mr.maxElevation)!==null&&y!==void 0?y:this.elevation;Dt=new sl([Dt.min[0],Dt.min[1],an],[Dt.max[0],Dt.max[1],Sr])}ke.push({aabb:Dt,zoom:vr,x:It,y:Jt,wrap:Ee.wrap,fullyVisible:tt})}}return Ae.sort((Ee,Ve)=>Ee.distanceSq-Ve.distanceSq).map(Ee=>Ee.tileID)}resize(o,f){this.width=o,this.height=f,this.pixelsToGLUnits=[2/o,-2/f],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const f=s.ac(o.lat,-85.051129,hf);return new s.P(s.O(o.lng)*this.worldSize,s.Q(f)*this.worldSize)}unproject(o){return new s.Z(o.x/this.worldSize,o.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(o){const f=this.elevation,y=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,b=this.pointLocation(this.centerPoint,o),E=o.getElevationForLngLatZoom(b,this.tileZoom);if(!(this.elevation-E))return;const R=y+f-E,B=Math.cos(this._pitch)*this.cameraToCenterDistance/R/s.b5(1,b.lat),O=this.scaleZoom(B/this.tileSize);this._elevation=E,this._center=b,this.zoom=O}setLocationAtPoint(o,f){const y=this.pointCoordinate(f),b=this.pointCoordinate(this.centerPoint),E=this.locationCoordinate(o),R=new s.Z(E.x-(y.x-b.x),E.y-(y.y-b.y));this.center=this.coordinateLocation(R),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(o,f){return f?this.coordinatePoint(this.locationCoordinate(o),f.getElevationForLngLatZoom(o,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(o))}pointLocation(o,f){return this.coordinateLocation(this.pointCoordinate(o,f))}locationCoordinate(o){return s.Z.fromLngLat(o)}coordinateLocation(o){return o&&o.toLngLat()}pointCoordinate(o,f){if(f){const he=f.pointCoordinate(o);if(he!=null)return he}const y=[o.x,o.y,0,1],b=[o.x,o.y,1,1];s.af(y,y,this.pixelMatrixInverse),s.af(b,b,this.pixelMatrixInverse);const E=y[3],R=b[3],B=y[1]/E,O=b[1]/R,H=y[2]/E,ee=b[2]/R,te=H===ee?0:(0-H)/(ee-H);return new s.Z(s.y.number(y[0]/E,b[0]/R,te)/this.worldSize,s.y.number(B,O,te)/this.worldSize)}coordinatePoint(o,f=0,y=this.pixelMatrix){const b=[o.x*this.worldSize,o.y*this.worldSize,f,1];return s.af(b,b,y),new s.P(b[0]/b[3],b[1]/b[3])}getBounds(){const o=Math.max(0,this.height/2-this.getHorizon());return new $e().extend(this.pointLocation(new s.P(0,o))).extend(this.pointLocation(new s.P(this.width,o))).extend(this.pointLocation(new s.P(this.width,this.height))).extend(this.pointLocation(new s.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new $e([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(o){o?(this.lngRange=[o.getWest(),o.getEast()],this.latRange=[o.getSouth(),o.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,hf])}calculateTileMatrix(o){const f=o.canonical,y=this.worldSize/this.zoomScale(f.z),b=f.x+Math.pow(2,f.z)*o.wrap,E=s.an(new Float64Array(16));return s.J(E,E,[b*y,f.y*y,0]),s.K(E,E,[y/s.X,y/s.X,1]),E}calculatePosMatrix(o,f=!1){const y=o.key,b=f?this._alignedPosMatrixCache:this._posMatrixCache;if(b[y])return b[y];const E=this.calculateTileMatrix(o);return s.L(E,f?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,E),b[y]=new Float32Array(E),b[y]}calculateFogMatrix(o){const f=o.key,y=this._fogMatrixCache;if(y[f])return y[f];const b=this.calculateTileMatrix(o);return s.L(b,this.fogMatrix,b),y[f]=new Float32Array(b),y[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(o,f){f=s.ac(+f,this.minZoom,this.maxZoom);const y={center:new s.N(o.lng,o.lat),zoom:f};let b=this.lngRange;if(!this._renderWorldCopies&&b===null){const Ee=179.9999999999;b=[-Ee,Ee]}const E=this.tileSize*this.zoomScale(y.zoom);let R=0,B=E,O=0,H=E,ee=0,te=0;const{x:he,y:ye}=this.size;if(this.latRange){const Ee=this.latRange;R=s.Q(Ee[1])*E,B=s.Q(Ee[0])*E,B-R<ye&&(ee=ye/(B-R))}b&&(O=s.b3(s.O(b[0])*E,0,E),H=s.b3(s.O(b[1])*E,0,E),H<O&&(H+=E),H-O<he&&(te=he/(H-O)));const{x:Se,y:ke}=this.project.call({worldSize:E},o);let Ae,Me;const Re=Math.max(te||0,ee||0);if(Re){const Ee=new s.P(te?(H+O)/2:Se,ee?(B+R)/2:ke);return y.center=this.unproject.call({worldSize:E},Ee).wrap(),y.zoom+=this.scaleZoom(Re),y}if(this.latRange){const Ee=ye/2;ke-Ee<R&&(Me=R+Ee),ke+Ee>B&&(Me=B-Ee)}if(b){const Ee=(O+H)/2;let Ve=Se;this._renderWorldCopies&&(Ve=s.b3(Se,Ee-E/2,Ee+E/2));const Ge=he/2;Ve-Ge<O&&(Ae=O+Ge),Ve+Ge>H&&(Ae=H-Ge)}if(Ae!==void 0||Me!==void 0){const Ee=new s.P(Ae??Se,Me??ke);y.center=this.unproject.call({worldSize:E},Ee).wrap()}return y}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const o=this._unmodified,{center:f,zoom:y}=this.getConstrained(this.center,this.zoom);this.center=f,this.zoom=y,this._unmodified=o,this._constraining=!1}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,f=this.point.x,y=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=s.b5(1,this.center.lat)*this.worldSize;let b=s.an(new Float64Array(16));s.K(b,b,[this.width/2,-this.height/2,1]),s.J(b,b,[1,-1,0]),this.labelPlaneMatrix=b,b=s.an(new Float64Array(16)),s.K(b,b,[1,-1,1]),s.J(b,b,[-1,-1,0]),s.K(b,b,[2/this.width,2/this.height,1]),this.glCoordMatrix=b;const E=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),R=Math.min(this.elevation,this.minElevationForCurrentTile),B=E-R*this._pixelPerMeter/Math.cos(this._pitch),O=R<0?B:E,H=Math.PI/2+this._pitch,ee=this._fov*(.5+o.y/this.height),te=Math.sin(ee)*O/Math.sin(s.ac(Math.PI-H-ee,.01,Math.PI-.01)),he=this.getHorizon(),ye=2*Math.atan(he/this.cameraToCenterDistance)*(.5+o.y/(2*he)),Se=Math.sin(ye)*O/Math.sin(s.ac(Math.PI-H-ye,.01,Math.PI-.01)),ke=Math.min(te,Se);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*ke+O),this.nearZ=this.height/50,b=new Float64Array(16),s.b6(b,this._fov,this.width/this.height,this.nearZ,this.farZ),b[8]=2*-o.x/this.width,b[9]=2*o.y/this.height,this.projectionMatrix=s.ae(b),s.K(b,b,[1,-1,1]),s.J(b,b,[0,0,-this.cameraToCenterDistance]),s.b7(b,b,this._pitch),s.ad(b,b,this.angle),s.J(b,b,[-f,-y,0]),this.mercatorMatrix=s.K([],b,[this.worldSize,this.worldSize,this.worldSize]),s.K(b,b,[1,1,this._pixelPerMeter]),this.pixelMatrix=s.L(new Float64Array(16),this.labelPlaneMatrix,b),s.J(b,b,[0,0,-this.elevation]),this.modelViewProjectionMatrix=b,this.invModelViewProjectionMatrix=s.as([],b),this.fogMatrix=new Float64Array(16),s.b6(this.fogMatrix,this._fov,this.width/this.height,E,this.farZ),this.fogMatrix[8]=2*-o.x/this.width,this.fogMatrix[9]=2*o.y/this.height,s.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),s.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),s.b7(this.fogMatrix,this.fogMatrix,this._pitch),s.ad(this.fogMatrix,this.fogMatrix,this.angle),s.J(this.fogMatrix,this.fogMatrix,[-f,-y,0]),s.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),s.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=s.L(new Float64Array(16),this.labelPlaneMatrix,b);const Ae=this.width%2/2,Me=this.height%2/2,Re=Math.cos(this.angle),Ee=Math.sin(this.angle),Ve=f-Math.round(f)+Re*Ae+Ee*Me,Ge=y-Math.round(y)+Re*Me+Ee*Ae,tt=new Float64Array(b);if(s.J(tt,tt,[Ve>.5?Ve-1:Ve,Ge>.5?Ge-1:Ge,0]),this.alignedModelViewProjectionMatrix=tt,b=s.as(new Float64Array(16),this.pixelMatrix),!b)throw new Error("failed to invert matrix");this.pixelMatrixInverse=b,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const o=this.pointCoordinate(new s.P(0,0)),f=[o.x*this.worldSize,o.y*this.worldSize,0,1];return s.af(f,f,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,o))}getCameraQueryGeometry(o){const f=this.getCameraPoint();if(o.length===1)return[o[0],f];{let y=f.x,b=f.y,E=f.x,R=f.y;for(const B of o)y=Math.min(y,B.x),b=Math.min(b,B.y),E=Math.max(E,B.x),R=Math.max(R,B.y);return[new s.P(y,b),new s.P(E,b),new s.P(E,R),new s.P(y,R),new s.P(y,b)]}}lngLatToCameraDepth(o,f){const y=this.locationCoordinate(o),b=[y.x*this.worldSize,y.y*this.worldSize,f,1];return s.af(b,b,this.modelViewProjectionMatrix),b[2]/b[3]}}function Iu(C,o){let f,y=!1,b=null,E=null;const R=()=>{b=null,y&&(C.apply(E,f),b=setTimeout(R,o),y=!1)};return(...B)=>(y=!0,E=this,f=B,b||R(),b)}class Jc{constructor(o){this._getCurrentHash=()=>{const f=window.location.hash.replace("#","");if(this._hashName){let y;return f.split("&").map(b=>b.split("=")).forEach(b=>{b[0]===this._hashName&&(y=b)}),(y&&y[1]||"").split("/")}return f.split("/")},this._onHashChange=()=>{const f=this._getCurrentHash();if(f.length>=3&&!f.some(y=>isNaN(y))){const y=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(f[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:y,pitch:+(f[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const f=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,f)},this._removeHash=()=>{const f=this._getCurrentHash();if(f.length===0)return;const y=f.join("/");let b=y;b.split("&").length>0&&(b=b.split("&")[0]),this._hashName&&(b=`${this._hashName}=${y}`);let E=window.location.hash.replace(b,"");E.startsWith("#&")?E=E.slice(0,1)+E.slice(2):E==="#"&&(E="");let R=window.location.href.replace(/(#.+)?$/,E);R=R.replace("&&","&"),window.history.replaceState(window.history.state,null,R)},this._updateHash=Iu(this._updateHashUnthrottled,300),this._hashName=o&&encodeURIComponent(o)}addTo(o){return this._map=o,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(o){const f=this._map.getCenter(),y=Math.round(100*this._map.getZoom())/100,b=Math.ceil((y*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,b),R=Math.round(f.lng*E)/E,B=Math.round(f.lat*E)/E,O=this._map.getBearing(),H=this._map.getPitch();let ee="";if(ee+=o?`/${R}/${B}/${y}`:`${y}/${B}/${R}`,(O||H)&&(ee+="/"+Math.round(10*O)/10),H&&(ee+=`/${Math.round(H)}`),this._hashName){const te=this._hashName;let he=!1;const ye=window.location.hash.slice(1).split("&").map(Se=>{const ke=Se.split("=")[0];return ke===te?(he=!0,`${ke}=${ee}`):Se}).filter(Se=>Se);return he||ye.push(`${te}=${ee}`),`#${ye.join("&")}`}return`#${ee}`}}const Qc={linearity:.3,easing:s.b8(0,0,.3,1)},ff=s.e({deceleration:2500,maxSpeed:1400},Qc),Mx=s.e({deceleration:20,maxSpeed:1400},Qc),Cg=s.e({deceleration:1e3,maxSpeed:360},Qc),ed=s.e({deceleration:1e3,maxSpeed:90},Qc);class pf{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:v.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,f=v.now();for(;o.length>0&&f-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const f={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:E}of this._inertiaBuffer)f.zoom+=E.zoomDelta||0,f.bearing+=E.bearingDelta||0,f.pitch+=E.pitchDelta||0,E.panDelta&&f.pan._add(E.panDelta),E.around&&(f.around=E.around),E.pinchAround&&(f.pinchAround=E.pinchAround);const y=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(f.pan.mag()){const E=Nu(f.pan.mag(),y,s.e({},ff,o||{}));b.offset=f.pan.mult(E.amount/f.pan.mag()),b.center=this._map.transform.center,Au(b,E)}if(f.zoom){const E=Nu(f.zoom,y,Mx);b.zoom=this._map.transform.zoom+E.amount,Au(b,E)}if(f.bearing){const E=Nu(f.bearing,y,Cg);b.bearing=this._map.transform.bearing+s.ac(E.amount,-179,179),Au(b,E)}if(f.pitch){const E=Nu(f.pitch,y,ed);b.pitch=this._map.transform.pitch+E.amount,Au(b,E)}if(b.zoom||b.bearing){const E=f.pinchAround===void 0?f.around:f.pinchAround;b.around=E?this._map.unproject(E):this._map.getCenter()}return this.clear(),s.e(b,{noMoveStart:!0})}}function Au(C,o){(!C.duration||C.duration<o.duration)&&(C.duration=o.duration,C.easing=o.easing)}function Nu(C,o,f){const{maxSpeed:y,linearity:b,deceleration:E}=f,R=s.ac(C*b/(o/1e3),-y,y),B=Math.abs(R)/(E*b);return{easing:f.easing,duration:1e3*B,amount:R*(B/2)}}class ia extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,f,y,b={}){const E=x.mousePos(f.getCanvas(),y),R=f.unproject(E);super(o,s.e({point:E,lngLat:R,originalEvent:y},b)),this._defaultPrevented=!1,this.target=f}}class xo extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,f,y){const b=o==="touchend"?y.changedTouches:y.touches,E=x.touchPos(f.getCanvasContainer(),b),R=E.map(O=>f.unproject(O)),B=E.reduce((O,H,ee,te)=>O.add(H.div(te.length)),new s.P(0,0));super(o,{points:E,point:B,lngLats:R,lngLat:f.unproject(B),originalEvent:y}),this._defaultPrevented=!1}}class kg extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,f,y){super(o,{originalEvent:y}),this._defaultPrevented=!1}}class Tg{constructor(o,f){this._map=o,this._clickTolerance=f.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new kg(o.type,this._map,o))}mousedown(o,f){return this._mousedownPos=f,this._firePreventable(new ia(o.type,this._map,o))}mouseup(o){this._map.fire(new ia(o.type,this._map,o))}click(o,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new ia(o.type,this._map,o))}dblclick(o){return this._firePreventable(new ia(o.type,this._map,o))}mouseover(o){this._map.fire(new ia(o.type,this._map,o))}mouseout(o){this._map.fire(new ia(o.type,this._map,o))}touchstart(o){return this._firePreventable(new xo(o.type,this._map,o))}touchmove(o){this._map.fire(new xo(o.type,this._map,o))}touchend(o){this._map.fire(new xo(o.type,this._map,o))}touchcancel(o){this._map.fire(new xo(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class En{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(o){this._map.fire(new ia(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ia("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._ignoreContextMenu||this._map.fire(new ia(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Pi{constructor(o){this._map=o}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(o){return this.transform.pointLocation(s.P.convert(o),this._map.terrain)}}class Xa{constructor(o,f){this._map=o,this._tr=new Pi(o),this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,f){this.isEnabled()&&o.shiftKey&&o.button===0&&(x.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(o,f){if(!this._active)return;const y=f;if(this._lastPos.equals(y)||!this._box&&y.dist(this._startPos)<this._clickTolerance)return;const b=this._startPos;this._lastPos=y,this._box||(this._box=x.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",o));const E=Math.min(b.x,y.x),R=Math.max(b.x,y.x),B=Math.min(b.y,y.y),O=Math.max(b.y,y.y);x.setTransform(this._box,`translate(${E}px,${B}px)`),this._box.style.width=R-E+"px",this._box.style.height=O-B+"px"}mouseupWindow(o,f){if(!this._active||o.button!==0)return;const y=this._startPos,b=f;if(this.reset(),x.suppressClick(),y.x!==b.x||y.y!==b.y)return this._map.fire(new s.k("boxzoomend",{originalEvent:o})),{cameraAnimation:E=>E.fitScreenCoordinates(y,b,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(x.remove(this._box),this._box=null),x.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,f){return this._map.fire(new s.k(o,{originalEvent:f}))}}function Mu(C,o){if(C.length!==o.length)throw new Error(`The number of touches and points are not equal - touches ${C.length}, points ${o.length}`);const f={};for(let y=0;y<C.length;y++)f[C[y].identifier]=o[y];return f}class mf{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,f,y){(this.centroid||y.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=o.timeStamp),y.length===this.numTouches&&(this.centroid=function(b){const E=new s.P(0,0);for(const R of b)E._add(R);return E.div(b.length)}(f),this.touches=Mu(y,f)))}touchmove(o,f,y){if(this.aborted||!this.centroid)return;const b=Mu(y,f);for(const E in this.touches){const R=b[E];(!R||R.dist(this.touches[E])>30)&&(this.aborted=!0)}}touchend(o,f,y){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),y.length===0){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class td{constructor(o){this.singleTap=new mf(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,f,y){this.singleTap.touchstart(o,f,y)}touchmove(o,f,y){this.singleTap.touchmove(o,f,y)}touchend(o,f,y){const b=this.singleTap.touchend(o,f,y);if(b){const E=o.timeStamp-this.lastTime<500,R=!this.lastTap||this.lastTap.dist(b)<30;if(E&&R||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class ul{constructor(o){this._tr=new Pi(o),this._zoomIn=new td({numTouches:1,numTaps:2}),this._zoomOut=new td({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,f,y){this._zoomIn.touchstart(o,f,y),this._zoomOut.touchstart(o,f,y)}touchmove(o,f,y){this._zoomIn.touchmove(o,f,y),this._zoomOut.touchmove(o,f,y)}touchend(o,f,y){const b=this._zoomIn.touchend(o,f,y),E=this._zoomOut.touchend(o,f,y),R=this._tr;return b?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:B=>B.easeTo({duration:300,zoom:R.zoom+1,around:R.unproject(b)},{originalEvent:o})}):E?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:B=>B.easeTo({duration:300,zoom:R.zoom-1,around:R.unproject(E)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gs{constructor(o){this._enabled=!!o.enable,this._moveStateManager=o.moveStateManager,this._clickTolerance=o.clickTolerance||1,this._moveFunction=o.move,this._activateOnStart=!!o.activateOnStart,o.assignEvents(this),this.reset()}reset(o){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(o)}_move(...o){const f=this._moveFunction(...o);if(f.bearingDelta||f.pitchDelta||f.around||f.panDelta)return this._active=!0,f}dragStart(o,f){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(o)&&(this._moveStateManager.startMove(o),this._lastPoint=f.length?f[0]:f,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(o,f){if(!this.isEnabled())return;const y=this._lastPoint;if(!y)return;if(o.preventDefault(),!this._moveStateManager.isValidMoveEvent(o))return void this.reset(o);const b=f.length?f[0]:f;return!this._moved&&b.dist(y)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=b,this._move(y,b))}dragEnd(o){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(o)&&(this._moved&&x.suppressClick(),this.reset(o))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const gf={0:1,2:2};class rd{constructor(o){this._correctEvent=o.checkCorrectEvent}startMove(o){const f=x.mouseButton(o);this._eventButton=f}endMove(o){delete this._eventButton}isValidStartEvent(o){return this._correctEvent(o)}isValidMoveEvent(o){return!function(f,y){const b=gf[y];return f.buttons===void 0||(f.buttons&b)!==b}(o,this._eventButton)}isValidEndEvent(o){return x.mouseButton(o)===this._eventButton}}class vf{constructor(){this._firstTouch=void 0}_isOneFingerTouch(o){return o.targetTouches.length===1}_isSameTouchEvent(o){return o.targetTouches[0].identifier===this._firstTouch}startMove(o){this._firstTouch=o.targetTouches[0].identifier}endMove(o){delete this._firstTouch}isValidStartEvent(o){return this._isOneFingerTouch(o)}isValidMoveEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}isValidEndEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}}const nd=C=>{C.mousedown=C.dragStart,C.mousemoveWindow=C.dragMove,C.mouseup=C.dragEnd,C.contextmenu=o=>{o.preventDefault()}},yf=({enable:C,clickTolerance:o,bearingDegreesPerPixelMoved:f=.8})=>{const y=new rd({checkCorrectEvent:b=>x.mouseButton(b)===0&&b.ctrlKey||x.mouseButton(b)===2});return new gs({clickTolerance:o,move:(b,E)=>({bearingDelta:(E.x-b.x)*f}),moveStateManager:y,enable:C,assignEvents:nd})},xf=({enable:C,clickTolerance:o,pitchDegreesPerPixelMoved:f=-.5})=>{const y=new rd({checkCorrectEvent:b=>x.mouseButton(b)===0&&b.ctrlKey||x.mouseButton(b)===2});return new gs({clickTolerance:o,move:(b,E)=>({pitchDelta:(E.y-b.y)*f}),moveStateManager:y,enable:C,assignEvents:nd})};class bo{constructor(o,f){this._clickTolerance=o.clickTolerance||1,this._map=f,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}_shouldBePrevented(o){return o<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(o,f,y){return this._calculateTransform(o,f,y)}touchmove(o,f,y){if(this._active){if(!this._shouldBePrevented(y.length))return o.preventDefault(),this._calculateTransform(o,f,y);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",o)}}touchend(o,f,y){this._calculateTransform(o,f,y),this._active&&this._shouldBePrevented(y.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,f,y){y.length>0&&(this._active=!0);const b=Mu(y,f),E=new s.P(0,0),R=new s.P(0,0);let B=0;for(const H in b){const ee=b[H],te=this._touches[H];te&&(E._add(ee),R._add(ee.sub(te)),B++,b[H]=ee)}if(this._touches=b,this._shouldBePrevented(B)||!R.mag())return;const O=R.div(B);return this._sum._add(O),this._sum.mag()<this._clickTolerance?void 0:{around:E.div(B),panDelta:O}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ad{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(o,f,y){this._firstTwoTouches||y.length<2||(this._firstTwoTouches=[y[0].identifier,y[1].identifier],this._start([f[0],f[1]]))}touchmove(o,f,y){if(!this._firstTwoTouches)return;o.preventDefault();const[b,E]=this._firstTwoTouches,R=Du(y,f,b),B=Du(y,f,E);if(!R||!B)return;const O=this._aroundCenter?null:R.add(B).div(2);return this._move([R,B],O,o)}touchend(o,f,y){if(!this._firstTwoTouches)return;const[b,E]=this._firstTwoTouches,R=Du(y,f,b),B=Du(y,f,E);R&&B||(this._active&&x.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Du(C,o,f){for(let y=0;y<C.length;y++)if(C[y].identifier===f)return o[y]}function bf(C,o){return Math.log(C/o)/Math.LN2}class _f extends ad{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,f){const y=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(bf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:bf(this._distance,y),pinchAround:f}}}function wf(C,o){return 180*C.angleWith(o)/Math.PI}class Sf extends ad{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,f,y){const b=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:wf(this._vector,b),pinchAround:f}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const f=25/(Math.PI*this._minDiameter)*360,y=wf(o,this._startVector);return Math.abs(y)<f}}function id(C){return Math.abs(C.y)>Math.abs(C.x)}class zu extends ad{constructor(o){super(),this._currentTouchCount=0,this._map=o}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(o,f,y){super.touchstart(o,f,y),this._currentTouchCount=y.length}_start(o){this._lastPoints=o,id(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,f,y){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const b=o[0].sub(this._lastPoints[0]),E=o[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(b,E,y.timeStamp),this._valid?(this._lastPoints=o,this._active=!0,{pitchDelta:(b.y+E.y)/2*-.5}):void 0}gestureBeginsVertically(o,f,y){if(this._valid!==void 0)return this._valid;const b=o.mag()>=2,E=f.mag()>=2;if(!b&&!E)return;if(!b||!E)return this._firstMove===void 0&&(this._firstMove=y),y-this._firstMove<100&&void 0;const R=o.y>0==f.y>0;return id(o)&&id(f)&&R}}const Pg={panStep:100,bearingStep:15,pitchStep:10};class ui{constructor(o){this._tr=new Pi(o);const f=Pg;this._panStep=f.panStep,this._bearingStep=f.bearingStep,this._pitchStep=f.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let f=0,y=0,b=0,E=0,R=0;switch(o.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:o.shiftKey?y=-1:(o.preventDefault(),E=-1);break;case 39:o.shiftKey?y=1:(o.preventDefault(),E=1);break;case 38:o.shiftKey?b=1:(o.preventDefault(),R=-1);break;case 40:o.shiftKey?b=-1:(o.preventDefault(),R=1);break;default:return}return this._rotationDisabled&&(y=0,b=0),{cameraAnimation:B=>{const O=this._tr;B.easeTo({duration:300,easeId:"keyboardHandler",easing:Xi,zoom:f?Math.round(O.zoom)+f*(o.shiftKey?2:1):O.zoom,bearing:O.bearing+y*this._bearingStep,pitch:O.pitch+b*this._pitchStep,offset:[-E*this._panStep,-R*this._panStep],center:O.center},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Xi(C){return C*(2-C)}const Ef=4.000244140625;class Ii{constructor(o,f){this._onTimeout=y=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(y)},this._map=o,this._tr=new Pi(o),this._triggerRenderFrame=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(o){return!!this._map.cooperativeGestures.isEnabled()&&!(o.ctrlKey||this._map.cooperativeGestures.isBypassed(o))}wheel(o){if(!this.isEnabled())return;if(this._shouldBePrevented(o))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",o);let f=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const y=v.now(),b=y-(this._lastWheelEventTime||0);this._lastWheelEventTime=y,f!==0&&f%Ef==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(b*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),o.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=o,this._delta-=f,this._active||this._start(o)),o.preventDefault()}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=x.mousePos(this._map.getCanvas(),o),y=this._tr;this._around=f.y>y.transform.height/2-y.transform.getHorizon()?s.N.convert(this._aroundCenter?y.center:y.unproject(f)):s.N.convert(y.center),this._aroundPoint=y.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._tr.transform;if(this._delta!==0){const O=this._type==="wheel"&&Math.abs(this._delta)>Ef?this._wheelZoomRate:this._defaultZoomRate;let H=2/(1+Math.exp(-Math.abs(this._delta*O)));this._delta<0&&H!==0&&(H=1/H);const ee=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):o.scale;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(ee*H))),this._type==="wheel"&&(this._startZoom=o.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const f=typeof this._targetZoom=="number"?this._targetZoom:o.zoom,y=this._startZoom,b=this._easing;let E,R=!1;const B=v.now()-this._lastWheelEventTime;if(this._type==="wheel"&&y&&b&&B){const O=Math.min(B/200,1),H=b(O);E=s.y.number(y,f,H),O<1?this._frameId||(this._frameId=!0):R=!0}else E=f,R=!0;return this._active=!0,R&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!R,zoomDelta:E-o.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let f=s.b9;if(this._prevEase){const y=this._prevEase,b=(v.now()-y.start)/y.duration,E=y.easing(b+.01)-y.easing(b),R=.27/Math.sqrt(E*E+1e-4)*.01,B=Math.sqrt(.0729-R*R);f=s.b8(R,B,.25,1)}return this._prevEase={start:v.now(),duration:o,easing:f},f}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class _o{constructor(o,f){this._clickZoom=o,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Dx{constructor(o){this._tr=new Pi(o),this.reset()}reset(){this._active=!1}dblclick(o,f){return o.preventDefault(),{cameraAnimation:y=>{y.easeTo({duration:300,zoom:this._tr.zoom+(o.shiftKey?-1:1),around:this._tr.unproject(f)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zx{constructor(){this._tap=new td({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(o,f,y){if(!this._swipePoint)if(this._tapTime){const b=f[0],E=o.timeStamp-this._tapTime<500,R=this._tapPoint.dist(b)<30;E&&R?y.length>0&&(this._swipePoint=b,this._swipeTouch=y[0].identifier):this.reset()}else this._tap.touchstart(o,f,y)}touchmove(o,f,y){if(this._tapTime){if(this._swipePoint){if(y[0].identifier!==this._swipeTouch)return;const b=f[0],E=b.y-this._swipePoint.y;return this._swipePoint=b,o.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(o,f,y)}touchend(o,f,y){if(this._tapTime)this._swipePoint&&y.length===0&&this.reset();else{const b=this._tap.touchend(o,f,y);b&&(this._tapTime=o.timeStamp,this._tapPoint=b)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ig{constructor(o,f,y){this._el=o,this._mousePan=f,this._touchPan=y}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ag{constructor(o,f,y){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=f,this._mousePitch=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Cf{constructor(o,f,y,b){this._el=o,this._touchZoom=f,this._touchRotate=y,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class cl{constructor(o,f){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=o,this._options=f,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const o=this._map.getCanvasContainer();o.classList.add("maplibregl-cooperative-gestures"),this._container=x.create("div","maplibregl-cooperative-gesture-screen",o);let f=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(f=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const y=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),b=document.createElement("div");b.className="maplibregl-desktop-message",b.textContent=f,this._container.appendChild(b);const E=document.createElement("div");E.className="maplibregl-mobile-message",E.textContent=y,this._container.appendChild(E),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(x.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(o){return o[this._bypassKey]}notifyGestureBlocked(o,f){this._enabled&&(this._map.fire(new s.k("cooperativegestureprevented",{gestureType:o,originalEvent:f})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const ci=C=>C.zoom||C.drag||C.pitch||C.rotate;class Wt extends s.k{}function sd(C){return C.panDelta&&C.panDelta.mag()||C.zoomDelta||C.bearingDelta||C.pitchDelta}class kf{constructor(o,f){this.handleWindowEvent=b=>{this.handleEvent(b,`${b.type}Window`)},this.handleEvent=(b,E)=>{if(b.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const R=b.type==="renderFrame"?void 0:b,B={needsRenderFrame:!1},O={},H={},ee=b.touches,te=ee?this._getMapTouches(ee):void 0,he=te?x.touchPos(this._map.getCanvas(),te):x.mousePos(this._map.getCanvas(),b);for(const{handlerName:ke,handler:Ae,allowed:Me}of this._handlers){if(!Ae.isEnabled())continue;let Re;this._blockedByActive(H,Me,ke)?Ae.reset():Ae[E||b.type]&&(Re=Ae[E||b.type](b,he,te),this.mergeHandlerResult(B,O,Re,ke,R),Re&&Re.needsRenderFrame&&this._triggerRenderFrame()),(Re||Ae.isActive())&&(H[ke]=Ae)}const ye={};for(const ke in this._previousActiveHandlers)H[ke]||(ye[ke]=R);this._previousActiveHandlers=H,(Object.keys(ye).length||sd(B))&&(this._changes.push([B,O,ye]),this._triggerRenderFrame()),(Object.keys(H).length||sd(B))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Se}=B;Se&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Se(this._map))},this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new pf(o),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f);const y=this._el;this._listeners=[[y,"touchstart",{passive:!0}],[y,"touchmove",{passive:!1}],[y,"touchend",void 0],[y,"touchcancel",void 0],[y,"mousedown",void 0],[y,"mousemove",void 0],[y,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[y,"mouseover",void 0],[y,"mouseout",void 0],[y,"dblclick",void 0],[y,"click",void 0],[y,"keydown",{capture:!1}],[y,"keyup",void 0],[y,"wheel",{passive:!1}],[y,"contextmenu",void 0],[window,"blur",void 0]];for(const[b,E,R]of this._listeners)x.addEventListener(b,E,b===document?this.handleWindowEvent:this.handleEvent,R)}destroy(){for(const[o,f,y]of this._listeners)x.removeEventListener(o,f,o===document?this.handleWindowEvent:this.handleEvent,y)}_addDefaultHandlers(o){const f=this._map,y=f.getCanvasContainer();this._add("mapEvent",new Tg(f,o));const b=f.boxZoom=new Xa(f,o);this._add("boxZoom",b),o.interactive&&o.boxZoom&&b.enable();const E=f.cooperativeGestures=new cl(f,o.cooperativeGestures);this._add("cooperativeGestures",E),o.cooperativeGestures&&E.enable();const R=new ul(f),B=new Dx(f);f.doubleClickZoom=new _o(B,R),this._add("tapZoom",R),this._add("clickZoom",B),o.interactive&&o.doubleClickZoom&&f.doubleClickZoom.enable();const O=new zx;this._add("tapDragZoom",O);const H=f.touchPitch=new zu(f);this._add("touchPitch",H),o.interactive&&o.touchPitch&&f.touchPitch.enable(o.touchPitch);const ee=yf(o),te=xf(o);f.dragRotate=new Ag(o,ee,te),this._add("mouseRotate",ee,["mousePitch"]),this._add("mousePitch",te,["mouseRotate"]),o.interactive&&o.dragRotate&&f.dragRotate.enable();const he=(({enable:Re,clickTolerance:Ee})=>{const Ve=new rd({checkCorrectEvent:Ge=>x.mouseButton(Ge)===0&&!Ge.ctrlKey});return new gs({clickTolerance:Ee,move:(Ge,tt)=>({around:tt,panDelta:tt.sub(Ge)}),activateOnStart:!0,moveStateManager:Ve,enable:Re,assignEvents:nd})})(o),ye=new bo(o,f);f.dragPan=new Ig(y,he,ye),this._add("mousePan",he),this._add("touchPan",ye,["touchZoom","touchRotate"]),o.interactive&&o.dragPan&&f.dragPan.enable(o.dragPan);const Se=new Sf,ke=new _f;f.touchZoomRotate=new Cf(y,ke,Se,O),this._add("touchRotate",Se,["touchPan","touchZoom"]),this._add("touchZoom",ke,["touchPan","touchRotate"]),o.interactive&&o.touchZoomRotate&&f.touchZoomRotate.enable(o.touchZoomRotate);const Ae=f.scrollZoom=new Ii(f,()=>this._triggerRenderFrame());this._add("scrollZoom",Ae,["mousePan"]),o.interactive&&o.scrollZoom&&f.scrollZoom.enable(o.scrollZoom);const Me=f.keyboard=new ui(f);this._add("keyboard",Me),o.interactive&&o.keyboard&&f.keyboard.enable(),this._add("blockableMapEvent",new En(f))}_add(o,f,y){this._handlers.push({handlerName:o,handler:f,allowed:y}),this._handlersById[o]=f}stop(o){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ci(this._eventsInProgress)||this.isZooming()}_blockedByActive(o,f,y){for(const b in o)if(b!==y&&(!f||f.indexOf(b)<0))return!0;return!1}_getMapTouches(o){const f=[];for(const y of o)this._el.contains(y.target)&&f.push(y);return f}mergeHandlerResult(o,f,y,b,E){if(!y)return;s.e(o,y);const R={handlerName:b,originalEvent:y.originalEvent||E};y.zoomDelta!==void 0&&(f.zoom=R),y.panDelta!==void 0&&(f.drag=R),y.pitchDelta!==void 0&&(f.pitch=R),y.bearingDelta!==void 0&&(f.rotate=R)}_applyChanges(){const o={},f={},y={};for(const[b,E,R]of this._changes)b.panDelta&&(o.panDelta=(o.panDelta||new s.P(0,0))._add(b.panDelta)),b.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+b.pitchDelta),b.around!==void 0&&(o.around=b.around),b.pinchAround!==void 0&&(o.pinchAround=b.pinchAround),b.noInertia&&(o.noInertia=b.noInertia),s.e(f,E),s.e(y,R);this._updateMapTransform(o,f,y),this._changes=[]}_updateMapTransform(o,f,y){const b=this._map,E=b._getTransformForUpdate(),R=b.terrain;if(!(sd(o)||R&&this._terrainMovement))return this._fireEvents(f,y,!0);let{panDelta:B,zoomDelta:O,bearingDelta:H,pitchDelta:ee,around:te,pinchAround:he}=o;he!==void 0&&(te=he),b._stop(!0),te=te||b.transform.centerPoint;const ye=E.pointLocation(B?te.sub(B):te);H&&(E.bearing+=H),ee&&(E.pitch+=ee),O&&(E.zoom+=O),R?this._terrainMovement||!f.drag&&!f.zoom?f.drag&&this._terrainMovement?E.center=E.pointLocation(E.centerPoint.sub(B)):E.setLocationAtPoint(ye,te):(this._terrainMovement=!0,this._map._elevationFreeze=!0,E.setLocationAtPoint(ye,te)):E.setLocationAtPoint(ye,te),b._applyUpdatedTransform(E),this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(f,y,!0)}_fireEvents(o,f,y){const b=ci(this._eventsInProgress),E=ci(o),R={};for(const te in o){const{originalEvent:he}=o[te];this._eventsInProgress[te]||(R[`${te}start`]=he),this._eventsInProgress[te]=o[te]}!b&&E&&this._fireEvent("movestart",E.originalEvent);for(const te in R)this._fireEvent(te,R[te]);E&&this._fireEvent("move",E.originalEvent);for(const te in o){const{originalEvent:he}=o[te];this._fireEvent(te,he)}const B={};let O;for(const te in this._eventsInProgress){const{handlerName:he,originalEvent:ye}=this._eventsInProgress[te];this._handlersById[he].isActive()||(delete this._eventsInProgress[te],O=f[he]||ye,B[`${te}end`]=O)}for(const te in B)this._fireEvent(te,B[te]);const H=ci(this._eventsInProgress),ee=(b||E)&&!H;if(ee&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const te=this._map._getTransformForUpdate();te.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(te)}if(y&&ee){this._updatingCamera=!0;const te=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),he=ye=>ye!==0&&-this._bearingSnap<ye&&ye<this._bearingSnap;!te||!te.essential&&v.prefersReducedMotion?(this._map.fire(new s.k("moveend",{originalEvent:O})),he(this._map.getBearing())&&this._map.resetNorth()):(he(te.bearing||this._map.getBearing())&&(te.bearing=0),te.freezeElevation=!0,this._map.easeTo(te,{originalEvent:O})),this._updatingCamera=!1}}_fireEvent(o,f){this._map.fire(new s.k(o,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{delete this._frameId,this.handleEvent(new Wt("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Ng extends s.E{constructor(o,f){super(),this._renderFrameCallback=()=>{const y=Math.min((v.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(y)),y<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=f.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new s.N(this.transform.center.lng,this.transform.center.lat)}setCenter(o,f){return this.jumpTo({center:o},f)}panBy(o,f,y){return o=s.P.convert(o).mult(-1),this.panTo(this.transform.center,s.e({offset:o},f),y)}panTo(o,f,y){return this.easeTo(s.e({center:o},f),y)}getZoom(){return this.transform.zoom}setZoom(o,f){return this.jumpTo({zoom:o},f),this}zoomTo(o,f,y){return this.easeTo(s.e({zoom:o},f),y)}zoomIn(o,f){return this.zoomTo(this.getZoom()+1,o,f),this}zoomOut(o,f){return this.zoomTo(this.getZoom()-1,o,f),this}getBearing(){return this.transform.bearing}setBearing(o,f){return this.jumpTo({bearing:o},f),this}getPadding(){return this.transform.padding}setPadding(o,f){return this.jumpTo({padding:o},f),this}rotateTo(o,f,y){return this.easeTo(s.e({bearing:o},f),y)}resetNorth(o,f){return this.rotateTo(0,s.e({duration:1e3},o),f),this}resetNorthPitch(o,f){return this.easeTo(s.e({bearing:0,pitch:0,duration:1e3},o),f),this}snapToNorth(o,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,f):this}getPitch(){return this.transform.pitch}setPitch(o,f){return this.jumpTo({pitch:o},f),this}cameraForBounds(o,f){o=$e.convert(o).adjustAntiMeridian();const y=f&&f.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),y,f)}_cameraForBoxAndBearing(o,f,y,b){const E={top:0,bottom:0,right:0,left:0};if(typeof(b=s.e({padding:E,offset:[0,0],maxZoom:this.transform.maxZoom},b)).padding=="number"){const Nt=b.padding;b.padding={top:Nt,bottom:Nt,right:Nt,left:Nt}}b.padding=s.e(E,b.padding);const R=this.transform,B=R.padding,O=new $e(o,f),H=R.project(O.getNorthWest()),ee=R.project(O.getNorthEast()),te=R.project(O.getSouthEast()),he=R.project(O.getSouthWest()),ye=s.ba(-y),Se=H.rotate(ye),ke=ee.rotate(ye),Ae=te.rotate(ye),Me=he.rotate(ye),Re=new s.P(Math.max(Se.x,ke.x,Me.x,Ae.x),Math.max(Se.y,ke.y,Me.y,Ae.y)),Ee=new s.P(Math.min(Se.x,ke.x,Me.x,Ae.x),Math.min(Se.y,ke.y,Me.y,Ae.y)),Ve=Re.sub(Ee),Ge=(R.width-(B.left+B.right+b.padding.left+b.padding.right))/Ve.x,tt=(R.height-(B.top+B.bottom+b.padding.top+b.padding.bottom))/Ve.y;if(tt<0||Ge<0)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const yt=Math.min(R.scaleZoom(R.scale*Math.min(Ge,tt)),b.maxZoom),Ct=s.P.convert(b.offset),Rt=new s.P((b.padding.left-b.padding.right)/2,(b.padding.top-b.padding.bottom)/2).rotate(s.ba(y)),qt=Ct.add(Rt).mult(R.scale/R.zoomScale(yt));return{center:R.unproject(H.add(te).div(2).sub(qt)),zoom:yt,bearing:y}}fitBounds(o,f,y){return this._fitInternal(this.cameraForBounds(o,f),f,y)}fitScreenCoordinates(o,f,y,b,E){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(s.P.convert(o)),this.transform.pointLocation(s.P.convert(f)),y,b),b,E)}_fitInternal(o,f,y){return o?(delete(f=s.e(o,f)).padding,f.linear?this.easeTo(f,y):this.flyTo(f,y)):this}jumpTo(o,f){this.stop();const y=this._getTransformForUpdate();let b=!1,E=!1,R=!1;return"zoom"in o&&y.zoom!==+o.zoom&&(b=!0,y.zoom=+o.zoom),o.center!==void 0&&(y.center=s.N.convert(o.center)),"bearing"in o&&y.bearing!==+o.bearing&&(E=!0,y.bearing=+o.bearing),"pitch"in o&&y.pitch!==+o.pitch&&(R=!0,y.pitch=+o.pitch),o.padding==null||y.isPaddingEqual(o.padding)||(y.padding=o.padding),this._applyUpdatedTransform(y),this.fire(new s.k("movestart",f)).fire(new s.k("move",f)),b&&this.fire(new s.k("zoomstart",f)).fire(new s.k("zoom",f)).fire(new s.k("zoomend",f)),E&&this.fire(new s.k("rotatestart",f)).fire(new s.k("rotate",f)).fire(new s.k("rotateend",f)),R&&this.fire(new s.k("pitchstart",f)).fire(new s.k("pitch",f)).fire(new s.k("pitchend",f)),this.fire(new s.k("moveend",f))}calculateCameraOptionsFromTo(o,f,y,b=0){const E=s.Z.fromLngLat(o,f),R=s.Z.fromLngLat(y,b),B=R.x-E.x,O=R.y-E.y,H=R.z-E.z,ee=Math.hypot(B,O,H);if(ee===0)throw new Error("Can't calculate camera options with same From and To");const te=Math.hypot(B,O),he=this.transform.scaleZoom(this.transform.cameraToCenterDistance/ee/this.transform.tileSize),ye=180*Math.atan2(B,-O)/Math.PI;let Se=180*Math.acos(te/ee)/Math.PI;return Se=H<0?90-Se:90+Se,{center:R.toLngLat(),zoom:he,pitch:Se,bearing:ye}}easeTo(o,f){var y;this._stop(!1,o.easeId),((o=s.e({offset:[0,0],duration:500,easing:s.b9},o)).animate===!1||!o.essential&&v.prefersReducedMotion)&&(o.duration=0);const b=this._getTransformForUpdate(),E=b.zoom,R=b.bearing,B=b.pitch,O=b.padding,H="bearing"in o?this._normalizeBearing(o.bearing,R):R,ee="pitch"in o?+o.pitch:B,te="padding"in o?o.padding:b.padding,he=s.P.convert(o.offset);let ye=b.centerPoint.add(he);const Se=b.pointLocation(ye),{center:ke,zoom:Ae}=b.getConstrained(s.N.convert(o.center||Se),(y=o.zoom)!==null&&y!==void 0?y:E);this._normalizeCenter(ke,b);const Me=b.project(Se),Re=b.project(ke).sub(Me),Ee=b.zoomScale(Ae-E);let Ve,Ge;o.around&&(Ve=s.N.convert(o.around),Ge=b.locationPoint(Ve));const tt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Ae!==E,this._rotating=this._rotating||R!==H,this._pitching=this._pitching||ee!==B,this._padding=!b.isPaddingEqual(te),this._easeId=o.easeId,this._prepareEase(f,o.noMoveStart,tt),this.terrain&&this._prepareElevation(ke),this._ease(yt=>{if(this._zooming&&(b.zoom=s.y.number(E,Ae,yt)),this._rotating&&(b.bearing=s.y.number(R,H,yt)),this._pitching&&(b.pitch=s.y.number(B,ee,yt)),this._padding&&(b.interpolatePadding(O,te,yt),ye=b.centerPoint.add(he)),this.terrain&&!o.freezeElevation&&this._updateElevation(yt),Ve)b.setLocationAtPoint(Ve,Ge);else{const Ct=b.zoomScale(b.zoom-E),Rt=Ae>E?Math.min(2,Ee):Math.max(.5,Ee),qt=Math.pow(Rt,1-yt),Nt=b.unproject(Me.add(Re.mult(yt*qt)).mult(Ct));b.setLocationAtPoint(b.renderWorldCopies?Nt.wrap():Nt,ye)}this._applyUpdatedTransform(b),this._fireMoveEvents(f)},yt=>{this.terrain&&o.freezeElevation&&this._finalizeElevation(),this._afterEase(f,yt)},o),this}_prepareEase(o,f,y={}){this._moving=!0,f||y.moving||this.fire(new s.k("movestart",o)),this._zooming&&!y.zooming&&this.fire(new s.k("zoomstart",o)),this._rotating&&!y.rotating&&this.fire(new s.k("rotatestart",o)),this._pitching&&!y.pitching&&this.fire(new s.k("pitchstart",o))}_prepareElevation(o){this._elevationCenter=o,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(o){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const f=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(o<1&&f!==this._elevationTarget){const y=this._elevationTarget-this._elevationStart;this._elevationStart+=o*(y-(f-(y*o+this._elevationStart))/(1-o)),this._elevationTarget=f}this.transform.elevation=s.y.number(this._elevationStart,this._elevationTarget,o)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(o){const f=o.getCameraPosition(),y=this.terrain.getElevationForLngLatZoom(f.lngLat,o.zoom);if(f.altitude<y){const b=this.calculateCameraOptionsFromTo(f.lngLat,y,o.center,o.elevation);return{pitch:b.pitch,zoom:b.zoom}}return{}}_applyUpdatedTransform(o){const f=[];if(this.terrain&&f.push(b=>this._elevateCameraIfInsideTerrain(b)),this.transformCameraUpdate&&f.push(b=>this.transformCameraUpdate(b)),!f.length)return;const y=o.clone();for(const b of f){const E=y.clone(),{center:R,zoom:B,pitch:O,bearing:H,elevation:ee}=b(E);R&&(E.center=R),B!==void 0&&(E.zoom=B),O!==void 0&&(E.pitch=O),H!==void 0&&(E.bearing=H),ee!==void 0&&(E.elevation=ee),y.apply(E)}this.transform.apply(y)}_fireMoveEvents(o){this.fire(new s.k("move",o)),this._zooming&&this.fire(new s.k("zoom",o)),this._rotating&&this.fire(new s.k("rotate",o)),this._pitching&&this.fire(new s.k("pitch",o))}_afterEase(o,f){if(this._easeId&&f&&this._easeId===f)return;delete this._easeId;const y=this._zooming,b=this._rotating,E=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,y&&this.fire(new s.k("zoomend",o)),b&&this.fire(new s.k("rotateend",o)),E&&this.fire(new s.k("pitchend",o)),this.fire(new s.k("moveend",o))}flyTo(o,f){var y;if(!o.essential&&v.prefersReducedMotion){const jt=s.M(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(jt,f)}this.stop(),o=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.b9},o);const b=this._getTransformForUpdate(),E=b.zoom,R=b.bearing,B=b.pitch,O=b.padding,H="bearing"in o?this._normalizeBearing(o.bearing,R):R,ee="pitch"in o?+o.pitch:B,te="padding"in o?o.padding:b.padding,he=s.P.convert(o.offset);let ye=b.centerPoint.add(he);const Se=b.pointLocation(ye),{center:ke,zoom:Ae}=b.getConstrained(s.N.convert(o.center||Se),(y=o.zoom)!==null&&y!==void 0?y:E);this._normalizeCenter(ke,b);const Me=b.zoomScale(Ae-E),Re=b.project(Se),Ee=b.project(ke).sub(Re);let Ve=o.curve;const Ge=Math.max(b.width,b.height),tt=Ge/Me,yt=Ee.mag();if("minZoom"in o){const jt=s.ac(Math.min(o.minZoom,E,Ae),b.minZoom,b.maxZoom),mr=Ge/b.zoomScale(jt-E);Ve=Math.sqrt(mr/yt*2)}const Ct=Ve*Ve;function Rt(jt){const mr=(tt*tt-Ge*Ge+(jt?-1:1)*Ct*Ct*yt*yt)/(2*(jt?tt:Ge)*Ct*yt);return Math.log(Math.sqrt(mr*mr+1)-mr)}function qt(jt){return(Math.exp(jt)-Math.exp(-jt))/2}function Nt(jt){return(Math.exp(jt)+Math.exp(-jt))/2}const It=Rt(!1);let Jt=function(jt){return Nt(It)/Nt(It+Ve*jt)},vr=function(jt){return Ge*((Nt(It)*(qt(mr=It+Ve*jt)/Nt(mr))-qt(It))/Ct)/yt;var mr},Dt=(Rt(!0)-It)/Ve;if(Math.abs(yt)<1e-6||!isFinite(Dt)){if(Math.abs(Ge-tt)<1e-6)return this.easeTo(o,f);const jt=tt<Ge?-1:1;Dt=Math.abs(Math.log(tt/Ge))/Ve,vr=()=>0,Jt=mr=>Math.exp(jt*Ve*mr)}return o.duration="duration"in o?+o.duration:1e3*Dt/("screenSpeed"in o?+o.screenSpeed/Ve:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=R!==H,this._pitching=ee!==B,this._padding=!b.isPaddingEqual(te),this._prepareEase(f,!1),this.terrain&&this._prepareElevation(ke),this._ease(jt=>{const mr=jt*Dt,an=1/Jt(mr);b.zoom=jt===1?Ae:E+b.scaleZoom(an),this._rotating&&(b.bearing=s.y.number(R,H,jt)),this._pitching&&(b.pitch=s.y.number(B,ee,jt)),this._padding&&(b.interpolatePadding(O,te,jt),ye=b.centerPoint.add(he)),this.terrain&&!o.freezeElevation&&this._updateElevation(jt);const Sr=jt===1?ke:b.unproject(Re.add(Ee.mult(vr(mr))).mult(an));b.setLocationAtPoint(b.renderWorldCopies?Sr.wrap():Sr,ye),this._applyUpdatedTransform(b),this._fireMoveEvents(f)},()=>{this.terrain&&o.freezeElevation&&this._finalizeElevation(),this._afterEase(f)},o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,f){var y;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const b=this._onEaseEnd;delete this._onEaseEnd,b.call(this,f)}return o||(y=this.handlers)===null||y===void 0||y.stop(!1),this}_ease(o,f,y){y.animate===!1||y.duration===0?(o(1),f()):(this._easeStart=v.now(),this._easeOptions=y,this._onEaseFrame=o,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(o,f){o=s.b3(o,-180,180);const y=Math.abs(o-f);return Math.abs(o-360-f)<y&&(o-=360),Math.abs(o+360-f)<y&&(o+=360),o}_normalizeCenter(o,f){if(!f.renderWorldCopies||f.lngRange)return;const y=o.lng-f.center.lng;o.lng+=y>180?-360:y<-180?360:0}queryTerrainElevation(o){return this.terrain?this.terrain.getElevationForLngLatZoom(s.N.convert(o),this.transform.tileZoom)-this.transform.elevation:null}}const dl={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class hl{constructor(o=dl){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=f=>{!f||f.sourceDataType!=="metadata"&&f.sourceDataType!=="visibility"&&f.dataType!=="style"&&f.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=o}getDefaultPosition(){return"bottom-right"}onAdd(o){return this._map=o,this._compact=this.options.compact,this._container=x.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=x.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=x.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){x.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(o,f){const y=this._map._getUIString(`AttributionControl.${f}`);o.title=y,o.setAttribute("aria-label",y)}_updateAttributions(){if(!this._map.style)return;let o=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=o.concat(this.options.customAttribution.map(b=>typeof b!="string"?"":b)):typeof this.options.customAttribution=="string"&&o.push(this.options.customAttribution)),this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const f=this._map.style.sourceCaches;for(const b in f){const E=f[b];if(E.used||E.usedForTerrain){const R=E.getSource();R.attribution&&o.indexOf(R.attribution)<0&&o.push(R.attribution)}}o=o.filter(b=>String(b).trim()),o.sort((b,E)=>b.length-E.length),o=o.filter((b,E)=>{for(let R=E+1;R<o.length;R++)if(o[R].indexOf(b)>=0)return!1;return!0});const y=o.join(" | ");y!==this._attribHTML&&(this._attribHTML=y,o.length?(this._innerContainer.innerHTML=y,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Tf{constructor(o={}){this._updateCompact=()=>{const f=this._container.children;if(f.length){const y=f[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&y.classList.add("maplibregl-compact"):y.classList.remove("maplibregl-compact")}},this.options=o}getDefaultPosition(){return"bottom-left"}onAdd(o){this._map=o,this._compact=this.options&&this.options.compact,this._container=x.create("div","maplibregl-ctrl");const f=x.create("a","maplibregl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://maplibre.org/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){x.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Ir{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const f=++this._id;return this._queue.push({callback:o,id:f,cancelled:!1}),f}remove(o){const f=this._currentlyRunning,y=f?this._queue.concat(f):this._queue;for(const b of y)if(b.id===o)return void(b.cancelled=!0)}run(o=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const f=this._currentlyRunning=this._queue;this._queue=[];for(const y of f)if(!y.cancelled&&(y.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Pf=s.Y([{name:"a_pos3d",type:"Int16",components:3}]);class Rx extends s.E{constructor(o){super(),this.sourceCache=o,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,o.usedForTerrain=!0,o.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(o,f){this.sourceCache.update(o,f),this._renderableTilesKeys=[];const y={};for(const b of o.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:f}))y[b.key]=!0,this._renderableTilesKeys.push(b.key),this._tiles[b.key]||(b.posMatrix=new Float64Array(16),s.aP(b.posMatrix,0,s.X,0,s.X,0,1),this._tiles[b.key]=new dt(b,this.tileSize));for(const b in this._tiles)y[b]||delete this._tiles[b]}freeRtt(o){for(const f in this._tiles){const y=this._tiles[f];(!o||y.tileID.equals(o)||y.tileID.isChildOf(o)||o.isChildOf(y.tileID))&&(y.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(o=>this.getTileByID(o))}getTileByID(o){return this._tiles[o]}getTerrainCoords(o){const f={};for(const y of this._renderableTilesKeys){const b=this._tiles[y].tileID;if(b.canonical.equals(o.canonical)){const E=o.clone();E.posMatrix=new Float64Array(16),s.aP(E.posMatrix,0,s.X,0,s.X,0,1),f[y]=E}else if(b.canonical.isChildOf(o.canonical)){const E=o.clone();E.posMatrix=new Float64Array(16);const R=b.canonical.z-o.canonical.z,B=b.canonical.x-(b.canonical.x>>R<<R),O=b.canonical.y-(b.canonical.y>>R<<R),H=s.X>>R;s.aP(E.posMatrix,0,H,0,H,0,1),s.J(E.posMatrix,E.posMatrix,[-B*H,-O*H,0]),f[y]=E}else if(o.canonical.isChildOf(b.canonical)){const E=o.clone();E.posMatrix=new Float64Array(16);const R=o.canonical.z-b.canonical.z,B=o.canonical.x-(o.canonical.x>>R<<R),O=o.canonical.y-(o.canonical.y>>R<<R),H=s.X>>R;s.aP(E.posMatrix,0,s.X,0,s.X,0,1),s.J(E.posMatrix,E.posMatrix,[B*H,O*H,0]),s.K(E.posMatrix,E.posMatrix,[1/2**R,1/2**R,0]),f[y]=E}}return f}getSourceTile(o,f){const y=this.sourceCache._source;let b=o.overscaledZ-this.deltaZoom;if(b>y.maxzoom&&(b=y.maxzoom),b<y.minzoom)return null;this._sourceTileCache[o.key]||(this._sourceTileCache[o.key]=o.scaledTo(b).key);let E=this.sourceCache.getTileByID(this._sourceTileCache[o.key]);if((!E||!E.dem)&&f)for(;b>=y.minzoom&&(!E||!E.dem);)E=this.sourceCache.getTileByID(o.scaledTo(b--).key);return E}tilesAfterTime(o=Date.now()){return Object.values(this._tiles).filter(f=>f.timeAdded>=o)}}class If{constructor(o,f,y){this.painter=o,this.sourceCache=new Rx(f),this.options=y,this.exaggeration=typeof y.exaggeration=="number"?y.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(o,f,y,b=s.X){var E;if(!(f>=0&&f<b&&y>=0&&y<b))return 0;const R=this.getTerrainData(o),B=(E=R.tile)===null||E===void 0?void 0:E.dem;if(!B)return 0;const O=function(Se,ke,Ae){var Me=ke[0],Re=ke[1];return Se[0]=Ae[0]*Me+Ae[4]*Re+Ae[12],Se[1]=Ae[1]*Me+Ae[5]*Re+Ae[13],Se}([],[f/b*s.X,y/b*s.X],R.u_terrain_matrix),H=[O[0]*B.dim,O[1]*B.dim],ee=Math.floor(H[0]),te=Math.floor(H[1]),he=H[0]-ee,ye=H[1]-te;return B.get(ee,te)*(1-he)*(1-ye)+B.get(ee+1,te)*he*(1-ye)+B.get(ee,te+1)*(1-he)*ye+B.get(ee+1,te+1)*he*ye}getElevationForLngLatZoom(o,f){if(!s.bb(f,o.wrap()))return 0;const{tileID:y,mercatorX:b,mercatorY:E}=this._getOverscaledTileIDFromLngLatZoom(o,f);return this.getElevation(y,b%s.X,E%s.X,s.X)}getElevation(o,f,y,b=s.X){return this.getDEMElevation(o,f,y,b)*this.exaggeration}getTerrainData(o){if(!this._emptyDemTexture){const b=this.painter.context,E=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Z(b,E,b.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Z(b,new s.R({width:1,height:1}),b.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(b.gl.NEAREST,b.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.an([])}const f=this.sourceCache.getSourceTile(o,!0);if(f&&f.dem&&(!f.demTexture||f.needsTerrainPrepare)){const b=this.painter.context;f.demTexture=this.painter.getTileTexture(f.dem.stride),f.demTexture?f.demTexture.update(f.dem.getPixels(),{premultiply:!1}):f.demTexture=new Z(b,f.dem.getPixels(),b.gl.RGBA,{premultiply:!1}),f.demTexture.bind(b.gl.NEAREST,b.gl.CLAMP_TO_EDGE),f.needsTerrainPrepare=!1}const y=f&&f+f.tileID.key+o.key;if(y&&!this._demMatrixCache[y]){const b=this.sourceCache.sourceCache._source.maxzoom;let E=o.canonical.z-f.tileID.canonical.z;o.overscaledZ>o.canonical.z&&(o.canonical.z>=b?E=o.canonical.z-b:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const R=o.canonical.x-(o.canonical.x>>E<<E),B=o.canonical.y-(o.canonical.y>>E<<E),O=s.bc(new Float64Array(16),[1/(s.X<<E),1/(s.X<<E),0]);s.J(O,O,[R*s.X,B*s.X,0]),this._demMatrixCache[o.key]={matrix:O,coord:o}}return{u_depth:2,u_terrain:3,u_terrain_dim:f&&f.dem&&f.dem.dim||1,u_terrain_matrix:y?this._demMatrixCache[o.key].matrix:this._emptyDemMatrix,u_terrain_unpack:f&&f.dem&&f.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(f&&f.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:f}}getFramebuffer(o){const f=this.painter,y=f.width/devicePixelRatio,b=f.height/devicePixelRatio;return!this._fbo||this._fbo.width===y&&this._fbo.height===b||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Z(f.context,{width:y,height:b,data:null},f.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(f.context.gl.NEAREST,f.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Z(f.context,{width:y,height:b,data:null},f.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(f.context.gl.NEAREST,f.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=f.context.createFramebuffer(y,b,!0,!1),this._fbo.depthAttachment.set(f.context.createRenderbuffer(f.context.gl.DEPTH_COMPONENT16,y,b))),this._fbo.colorAttachment.set(o==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const o=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const f=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let E=0,R=0;E<this._coordsTextureSize;E++)for(let B=0;B<this._coordsTextureSize;B++,R+=4)f[R+0]=255&B,f[R+1]=255&E,f[R+2]=B>>8<<4|E>>8,f[R+3]=0;const y=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(f.buffer)),b=new Z(o,y,o.gl.RGBA,{premultiply:!1});return b.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),this._coordsTexture=b,b}pointCoordinate(o){this.painter.maybeDrawDepthAndCoords(!0);const f=new Uint8Array(4),y=this.painter.context,b=y.gl,E=Math.round(o.x*this.painter.pixelRatio/devicePixelRatio),R=Math.round(o.y*this.painter.pixelRatio/devicePixelRatio),B=Math.round(this.painter.height/devicePixelRatio);y.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),b.readPixels(E,B-R-1,1,1,b.RGBA,b.UNSIGNED_BYTE,f),y.bindFramebuffer.set(null);const O=f[0]+(f[2]>>4<<8),H=f[1]+((15&f[2])<<8),ee=this.coordsIndex[255-f[3]],te=ee&&this.sourceCache.getTileByID(ee);if(!te)return null;const he=this._coordsTextureSize,ye=(1<<te.tileID.canonical.z)*he;return new s.Z((te.tileID.canonical.x*he+O)/ye+te.tileID.wrap,(te.tileID.canonical.y*he+H)/ye,this.getElevation(te.tileID,O,H,he))}depthAtPoint(o){const f=new Uint8Array(4),y=this.painter.context,b=y.gl;return y.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),b.readPixels(o.x,this.painter.height/devicePixelRatio-o.y-1,1,1,b.RGBA,b.UNSIGNED_BYTE,f),y.bindFramebuffer.set(null),(f[0]/16777216+f[1]/65536+f[2]/256+f[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const o=this.painter.context,f=new s.bd,y=new s.aY,b=this.meshSize,E=s.X/b,R=b*b;for(let te=0;te<=b;te++)for(let he=0;he<=b;he++)f.emplaceBack(he*E,te*E,0);for(let te=0;te<R;te+=b+1)for(let he=0;he<b;he++)y.emplaceBack(he+te,b+he+te+1,b+he+te+2),y.emplaceBack(he+te,b+he+te+2,he+te+1);const B=f.length,O=B+2*(b+1);for(const te of[0,1])for(let he=0;he<=b;he++)for(const ye of[0,1])f.emplaceBack(he*E,te*s.X,ye);for(let te=0;te<2*b;te+=2)y.emplaceBack(O+te,O+te+1,O+te+3),y.emplaceBack(O+te,O+te+3,O+te+2),y.emplaceBack(B+te,B+te+3,B+te+1),y.emplaceBack(B+te,B+te+2,B+te+3);const H=f.length,ee=H+2*(b+1);for(const te of[0,1])for(let he=0;he<=b;he++)for(const ye of[0,1])f.emplaceBack(te*s.X,he*E,ye);for(let te=0;te<2*b;te+=2)y.emplaceBack(H+te,H+te+1,H+te+3),y.emplaceBack(H+te,H+te+3,H+te+2),y.emplaceBack(ee+te,ee+te+3,ee+te+1),y.emplaceBack(ee+te,ee+te+2,ee+te+3);return this._mesh=new Kc(o.createVertexBuffer(f,Pf.members),o.createIndexBuffer(y),s.a0.simpleSegment(0,0,f.length,y.length)),this._mesh}getMeshFrameDelta(o){return 2*Math.PI*s.be/Math.pow(2,o)/5}getMinTileElevationForLngLatZoom(o,f){var y;const{tileID:b}=this._getOverscaledTileIDFromLngLatZoom(o,f);return(y=this.getMinMaxElevation(b).minElevation)!==null&&y!==void 0?y:0}getMinMaxElevation(o){const f=this.getTerrainData(o).tile,y={minElevation:null,maxElevation:null};return f&&f.dem&&(y.minElevation=f.dem.min*this.exaggeration,y.maxElevation=f.dem.max*this.exaggeration),y}_getOverscaledTileIDFromLngLatZoom(o,f){const y=s.Z.fromLngLat(o.wrap()),b=(1<<f)*s.X,E=y.x*b,R=y.y*b,B=Math.floor(E/s.X),O=Math.floor(R/s.X);return{tileID:new s.S(f,0,f,B,O),mercatorX:E,mercatorY:R}}}class Lx{constructor(o,f,y){this._context=o,this._size=f,this._tileSize=y,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const o of this._objects)o.texture.destroy(),o.fbo.destroy()}_createObject(o){const f=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),y=new Z(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return y.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),f.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),f.colorAttachment.set(y.texture),{id:o,fbo:f,texture:y,stamp:-1,inUse:!1}}getObjectForId(o){return this._objects[o]}useObject(o){o.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(f=>o.id!==f),this._recentlyUsed.push(o.id)}stampObject(o){o.stamp=++this._stamp}getOrCreateFreeObject(){for(const f of this._recentlyUsed)if(!this._objects[f].inUse)return this._objects[f];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const o=this._createObject(this._objects.length);return this._objects.push(o),o}freeObject(o){o.inUse=!1}freeAllObjects(){for(const o of this._objects)this.freeObject(o)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(o=>!o.inUse)===!1}}const fl={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Mg{constructor(o,f){this.painter=o,this.terrain=f,this.pool=new Lx(o.context,30,f.sourceCache.tileSize*f.qualityFactor)}destruct(){this.pool.destruct()}getTexture(o){return this.pool.getObjectForId(o.rtt[this._stacks.length-1].id).texture}prepareForRender(o,f){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=o._order.filter(y=>!o._layers[y].isHidden(f)),this._coordsDescendingInv={};for(const y in o.sourceCaches){this._coordsDescendingInv[y]={};const b=o.sourceCaches[y].getVisibleCoordinates();for(const E of b){const R=this.terrain.sourceCache.getTerrainCoords(E);for(const B in R)this._coordsDescendingInv[y][B]||(this._coordsDescendingInv[y][B]=[]),this._coordsDescendingInv[y][B].push(R[B])}}this._coordsDescendingInvStr={};for(const y of o._order){const b=o._layers[y],E=b.source;if(fl[b.type]&&!this._coordsDescendingInvStr[E]){this._coordsDescendingInvStr[E]={};for(const R in this._coordsDescendingInv[E])this._coordsDescendingInvStr[E][R]=this._coordsDescendingInv[E][R].map(B=>B.key).sort().join()}}for(const y of this._renderableTiles)for(const b in this._coordsDescendingInvStr){const E=this._coordsDescendingInvStr[b][y.tileID.key];E&&E!==y.rttCoords[b]&&(y.rtt=[])}}renderLayer(o){if(o.isHidden(this.painter.transform.zoom))return!1;const f=o.type,y=this.painter,b=this._renderableLayerIds[this._renderableLayerIds.length-1]===o.id;if(fl[f]&&(this._prevType&&fl[this._prevType]||this._stacks.push([]),this._prevType=f,this._stacks[this._stacks.length-1].push(o.id),!b))return!0;if(fl[this._prevType]||fl[f]&&b){this._prevType=f;const E=this._stacks.length-1,R=this._stacks[E]||[];for(const B of this._renderableTiles){if(this.pool.isFull()&&(Eg(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(B),B.rtt[E]){const H=this.pool.getObjectForId(B.rtt[E].id);if(H.stamp===B.rtt[E].stamp){this.pool.useObject(H);continue}}const O=this.pool.getOrCreateFreeObject();this.pool.useObject(O),this.pool.stampObject(O),B.rtt[E]={id:O.id,stamp:O.stamp},y.context.bindFramebuffer.set(O.fbo.framebuffer),y.context.clear({color:s.aM.transparent,stencil:0}),y.currentStencilSource=void 0;for(let H=0;H<R.length;H++){const ee=y.style._layers[R[H]],te=ee.source?this._coordsDescendingInv[ee.source][B.tileID.key]:[B.tileID];y.context.viewport.set([0,0,O.fbo.width,O.fbo.height]),y._renderTileClippingMasks(ee,te),y.renderLayer(y,y.style.sourceCaches[ee.source],ee,te),ee.source&&(B.rttCoords[ee.source]=this._coordsDescendingInvStr[ee.source][B.tileID.key])}}return Eg(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),fl[f]}return!1}}const Af={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Dg=h,Bx={hash:!1,interactive:!0,bearingSnap:7,attributionControl:dl,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},Nf=C=>{C.touchstart=C.dragStart,C.touchmoveWindow=C.dragMove,C.touchend=C.dragEnd},jx={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ox{constructor(o,f,y=!1){this.mousedown=R=>{this.startMouse(s.e({},R,{ctrlKey:!0,preventDefault:()=>R.preventDefault()}),x.mousePos(this.element,R)),x.addEventListener(window,"mousemove",this.mousemove),x.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=R=>{this.moveMouse(R,x.mousePos(this.element,R))},this.mouseup=R=>{this.mouseRotate.dragEnd(R),this.mousePitch&&this.mousePitch.dragEnd(R),this.offTemp()},this.touchstart=R=>{R.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=x.touchPos(this.element,R.targetTouches)[0],this.startTouch(R,this._startPos),x.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),x.addEventListener(window,"touchend",this.touchend))},this.touchmove=R=>{R.targetTouches.length!==1?this.reset():(this._lastPos=x.touchPos(this.element,R.targetTouches)[0],this.moveTouch(R,this._lastPos))},this.touchend=R=>{R.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const b=o.dragRotate._mouseRotate.getClickTolerance(),E=o.dragRotate._mousePitch.getClickTolerance();this.element=f,this.mouseRotate=yf({clickTolerance:b,enable:!0}),this.touchRotate=(({enable:R,clickTolerance:B,bearingDegreesPerPixelMoved:O=.8})=>{const H=new vf;return new gs({clickTolerance:B,move:(ee,te)=>({bearingDelta:(te.x-ee.x)*O}),moveStateManager:H,enable:R,assignEvents:Nf})})({clickTolerance:b,enable:!0}),this.map=o,y&&(this.mousePitch=xf({clickTolerance:E,enable:!0}),this.touchPitch=(({enable:R,clickTolerance:B,pitchDegreesPerPixelMoved:O=-.5})=>{const H=new vf;return new gs({clickTolerance:B,move:(ee,te)=>({pitchDelta:(te.y-ee.y)*O}),moveStateManager:H,enable:R,assignEvents:Nf})})({clickTolerance:E,enable:!0})),x.addEventListener(f,"mousedown",this.mousedown),x.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),x.addEventListener(f,"touchcancel",this.reset)}startMouse(o,f){this.mouseRotate.dragStart(o,f),this.mousePitch&&this.mousePitch.dragStart(o,f),x.disableDrag()}startTouch(o,f){this.touchRotate.dragStart(o,f),this.touchPitch&&this.touchPitch.dragStart(o,f),x.disableDrag()}moveMouse(o,f){const y=this.map,{bearingDelta:b}=this.mouseRotate.dragMove(o,f)||{};if(b&&y.setBearing(y.getBearing()+b),this.mousePitch){const{pitchDelta:E}=this.mousePitch.dragMove(o,f)||{};E&&y.setPitch(y.getPitch()+E)}}moveTouch(o,f){const y=this.map,{bearingDelta:b}=this.touchRotate.dragMove(o,f)||{};if(b&&y.setBearing(y.getBearing()+b),this.touchPitch){const{pitchDelta:E}=this.touchPitch.dragMove(o,f)||{};E&&y.setPitch(y.getPitch()+E)}}off(){const o=this.element;x.removeEventListener(o,"mousedown",this.mousedown),x.removeEventListener(o,"touchstart",this.touchstart,{passive:!1}),x.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),x.removeEventListener(window,"touchend",this.touchend),x.removeEventListener(o,"touchcancel",this.reset),this.offTemp()}offTemp(){x.enableDrag(),x.removeEventListener(window,"mousemove",this.mousemove),x.removeEventListener(window,"mouseup",this.mouseup),x.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),x.removeEventListener(window,"touchend",this.touchend)}}let Ka;function nn(C,o,f){const y=new s.N(C.lng,C.lat);if(C=new s.N(C.lng,C.lat),o){const b=new s.N(C.lng-360,C.lat),E=new s.N(C.lng+360,C.lat),R=f.locationPoint(C).distSqr(o);f.locationPoint(b).distSqr(o)<R?C=b:f.locationPoint(E).distSqr(o)<R&&(C=E)}for(;Math.abs(C.lng-f.center.lng)>180;){const b=f.locationPoint(C);if(b.x>=0&&b.y>=0&&b.x<=f.width&&b.y<=f.height)break;C.lng>f.center.lng?C.lng-=360:C.lng+=360}return C.lng!==y.lng&&f.locationPoint(C).y>f.height/2-f.getHorizon()?C:y}const pl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function od(C,o,f){const y=C.classList;for(const b in pl)y.remove(`maplibregl-${f}-anchor-${b}`);y.add(`maplibregl-${f}-anchor-${o}`)}class ld extends s.E{constructor(o){if(super(),this._onKeyPress=f=>{const y=f.code,b=f.charCode||f.keyCode;y!=="Space"&&y!=="Enter"&&b!==32&&b!==13||this.togglePopup()},this._onMapClick=f=>{const y=f.originalEvent.target,b=this._element;this._popup&&(y===b||b.contains(y))&&this.togglePopup()},this._update=f=>{var y;if(!this._map)return;const b=this._map.loaded()&&!this._map.isMoving();((f==null?void 0:f.type)==="terrain"||(f==null?void 0:f.type)==="render"&&!b)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?nn(this._lngLat,this._flatPos,this._map.transform):(y=this._lngLat)===null||y===void 0?void 0:y.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let E="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?E=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(E=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let R="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?R="rotateX(0deg)":this._pitchAlignment==="map"&&(R=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||f&&f.type!=="moveend"||(this._pos=this._pos.round()),x.setTransform(this._element,`${pl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${R} ${E}`),v.frameAsync(new AbortController).then(()=>{this._updateOpacity(f&&f.type==="moveend")}).catch(()=>{})},this._onMove=f=>{if(!this._isDragging){const y=this._clickTolerance||this._map._clickTolerance;this._isDragging=f.point.dist(this._pointerdownPos)>=y}this._isDragging&&(this._pos=f.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.k("dragstart"))),this.fire(new s.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.k("dragend")),this._state="inactive"},this._addDragHandler=f=>{this._element.contains(f.originalEvent.target)&&(f.preventDefault(),this._positionDelta=f.point.sub(this._pos).add(this._offset),this._pointerdownPos=f.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._subpixelPositioning=o&&o.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment!=="auto"?o.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(o==null?void 0:o.opacity,o==null?void 0:o.opacityWhenCovered),o&&o.element)this._element=o.element,this._offset=s.P.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=x.create("div");const f=x.createNS("http://www.w3.org/2000/svg","svg"),y=41,b=27;f.setAttributeNS(null,"display","block"),f.setAttributeNS(null,"height",`${y}px`),f.setAttributeNS(null,"width",`${b}px`),f.setAttributeNS(null,"viewBox",`0 0 ${b} ${y}`);const E=x.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"stroke","none"),E.setAttributeNS(null,"stroke-width","1"),E.setAttributeNS(null,"fill","none"),E.setAttributeNS(null,"fill-rule","evenodd");const R=x.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill-rule","nonzero");const B=x.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"transform","translate(3.0, 29.0)"),B.setAttributeNS(null,"fill","#000000");const O=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Me of O){const Re=x.createNS("http://www.w3.org/2000/svg","ellipse");Re.setAttributeNS(null,"opacity","0.04"),Re.setAttributeNS(null,"cx","10.5"),Re.setAttributeNS(null,"cy","5.80029008"),Re.setAttributeNS(null,"rx",Me.rx),Re.setAttributeNS(null,"ry",Me.ry),B.appendChild(Re)}const H=x.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"fill",this._color);const ee=x.createNS("http://www.w3.org/2000/svg","path");ee.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),H.appendChild(ee);const te=x.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"opacity","0.25"),te.setAttributeNS(null,"fill","#000000");const he=x.createNS("http://www.w3.org/2000/svg","path");he.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),te.appendChild(he);const ye=x.createNS("http://www.w3.org/2000/svg","g");ye.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ye.setAttributeNS(null,"fill","#FFFFFF");const Se=x.createNS("http://www.w3.org/2000/svg","g");Se.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ke=x.createNS("http://www.w3.org/2000/svg","circle");ke.setAttributeNS(null,"fill","#000000"),ke.setAttributeNS(null,"opacity","0.25"),ke.setAttributeNS(null,"cx","5.5"),ke.setAttributeNS(null,"cy","5.5"),ke.setAttributeNS(null,"r","5.4999962");const Ae=x.createNS("http://www.w3.org/2000/svg","circle");Ae.setAttributeNS(null,"fill","#FFFFFF"),Ae.setAttributeNS(null,"cx","5.5"),Ae.setAttributeNS(null,"cy","5.5"),Ae.setAttributeNS(null,"r","5.4999962"),Se.appendChild(ke),Se.appendChild(Ae),R.appendChild(B),R.appendChild(H),R.appendChild(te),R.appendChild(ye),R.appendChild(Se),f.appendChild(R),f.setAttributeNS(null,"height",y*this._scale+"px"),f.setAttributeNS(null,"width",b*this._scale+"px"),this._element.appendChild(f),this._offset=s.P.convert(o&&o.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",f=>{f.preventDefault()}),this._element.addEventListener("mousedown",f=>{f.preventDefault()}),od(this._element,this._anchor,"marker"),o&&o.className)for(const f of o.className.split(" "))this._element.classList.add(f);this._popup=null}addTo(o){return this.remove(),this._map=o,this._element.setAttribute("aria-label",o._getUIString("Marker.Title")),o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),o.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),x.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=s.N.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const b=Math.abs(13.5)/Math.SQRT2;o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(38.1-13.5+b)],"bottom-right":[-b,-1*(38.1-13.5+b)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(o){return this._subpixelPositioning=o,this}getPopup(){return this._popup}togglePopup(){const o=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:o?(o.isOpen()?o.remove():(o.setLngLat(this._lngLat),o.addTo(this._map)),this):this}_updateOpacity(o=!1){var f,y;if(!(!((f=this._map)===null||f===void 0)&&f.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(o)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const b=this._map,E=b.terrain.depthAtPoint(this._pos),R=b.terrain.getElevationForLngLatZoom(this._lngLat,b.transform.tileZoom);if(b.transform.lngLatToCameraDepth(this._lngLat,R)-E<.006)return void(this._element.style.opacity=this._opacity);const B=-this._offset.y/b.transform._pixelPerMeter,O=Math.sin(b.getPitch()*Math.PI/180)*B,H=b.terrain.depthAtPoint(new s.P(this._pos.x,this._pos.y-this._offset.y)),ee=b.transform.lngLatToCameraDepth(this._lngLat,R+O)-H>.006;!((y=this._popup)===null||y===void 0)&&y.isOpen()&&ee&&this._popup.remove(),this._element.style.opacity=ee?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(o){return this._offset=s.P.convert(o),this._update(),this}addClassName(o){this._element.classList.add(o)}removeClassName(o){this._element.classList.remove(o)}toggleClassName(o){return this._element.classList.toggle(o)}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&o!=="auto"?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(o,f){return o===void 0&&f===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),o!==void 0&&(this._opacity=o),f!==void 0&&(this._opacityWhenCovered=f),this._map&&this._updateOpacity(!0),this}}const zg={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ru=0,Lu=!1;const Ki={maxWidth:100,unit:"metric"};function Bu(C,o,f){const y=f&&f.maxWidth||100,b=C._container.clientHeight/2,E=C.unproject([0,b]),R=C.unproject([y,b]),B=E.distanceTo(R);if(f&&f.unit==="imperial"){const O=3.2808*B;O>5280?Yt(o,y,O/5280,C._getUIString("ScaleControl.Miles")):Yt(o,y,O,C._getUIString("ScaleControl.Feet"))}else f&&f.unit==="nautical"?Yt(o,y,B/1852,C._getUIString("ScaleControl.NauticalMiles")):B>=1e3?Yt(o,y,B/1e3,C._getUIString("ScaleControl.Kilometers")):Yt(o,y,B,C._getUIString("ScaleControl.Meters"))}function Yt(C,o,f,y){const b=function(E){const R=Math.pow(10,`${Math.floor(E)}`.length-1);let B=E/R;return B=B>=10?10:B>=5?5:B>=3?3:B>=2?2:B>=1?1:function(O){const H=Math.pow(10,Math.ceil(-Math.log(O)/Math.LN10));return Math.round(O*H)/H}(B),R*B}(f);C.style.width=o*(b/f)+"px",C.innerHTML=`${b}&nbsp;${y}`}const ur={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},ud=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function cd(C){if(C){if(typeof C=="number"){const o=Math.round(Math.abs(C)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,C),"top-left":new s.P(o,o),"top-right":new s.P(-o,o),bottom:new s.P(0,-C),"bottom-left":new s.P(o,-o),"bottom-right":new s.P(-o,-o),left:new s.P(C,0),right:new s.P(-C,0)}}if(C instanceof s.P||Array.isArray(C)){const o=s.P.convert(C);return{center:o,top:o,"top-left":o,"top-right":o,bottom:o,"bottom-left":o,"bottom-right":o,left:o,right:o}}return{center:s.P.convert(C.center||[0,0]),top:s.P.convert(C.top||[0,0]),"top-left":s.P.convert(C["top-left"]||[0,0]),"top-right":s.P.convert(C["top-right"]||[0,0]),bottom:s.P.convert(C.bottom||[0,0]),"bottom-left":s.P.convert(C["bottom-left"]||[0,0]),"bottom-right":s.P.convert(C["bottom-right"]||[0,0]),left:s.P.convert(C.left||[0,0]),right:s.P.convert(C.right||[0,0])}}return cd(new s.P(0,0))}const Mf=h;u.AJAXError=s.bh,u.Evented=s.E,u.LngLat=s.N,u.MercatorCoordinate=s.Z,u.Point=s.P,u.addProtocol=s.bi,u.config=s.a,u.removeProtocol=s.bj,u.AttributionControl=hl,u.BoxZoomHandler=Xa,u.CanvasSource=Mt,u.CooperativeGesturesHandler=cl,u.DoubleClickZoomHandler=_o,u.DragPanHandler=Ig,u.DragRotateHandler=Ag,u.EdgeInsets=ol,u.FullscreenControl=class extends s.E{constructor(C={}){super(),this._onFullscreenChange=()=>{var o;let f=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((o=f==null?void 0:f.shadowRoot)===null||o===void 0)&&o.fullscreenElement;)f=f.shadowRoot.fullscreenElement;f===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,C&&C.container&&(C.container instanceof HTMLElement?this._container=C.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(C){return this._map=C,this._container||(this._container=this._map.getContainer()),this._controlContainer=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){x.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const C=this._fullscreenButton=x.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);x.create("span","maplibregl-ctrl-icon",C).setAttribute("aria-hidden","true"),C.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const C=this._getTitle();this._fullscreenButton.setAttribute("aria-label",C),this._fullscreenButton.title=C}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new s.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},u.GeoJSONSource=bt,u.GeolocateControl=class extends s.E{constructor(C){super(),this._onSuccess=o=>{if(this._map){if(this._isOutOfMapMaxBounds(o))return this._setErrorState(),this.fire(new s.k("outofmaxbounds",o)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=o,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(o),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(o),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.k("geolocate",o)),this._finish()}},this._updateCamera=o=>{const f=new s.N(o.coords.longitude,o.coords.latitude),y=o.coords.accuracy,b=this._map.getBearing(),E=s.e({bearing:b},this.options.fitBoundsOptions),R=$e.fromLngLat(f,y);this._map.fitBounds(R,E,{geolocateSource:!0})},this._updateMarker=o=>{if(o){const f=new s.N(o.coords.longitude,o.coords.latitude);this._accuracyCircleMarker.setLngLat(f).addTo(this._map),this._userLocationDotMarker.setLngLat(f).addTo(this._map),this._accuracy=o.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=o=>{if(this._map){if(this.options.trackUserLocation)if(o.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(o.code===3&&Lu)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.k("error",o)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=x.create("button","maplibregl-ctrl-geolocate",this._container),x.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=o=>{if(this._map){if(o===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}else{const f=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=x.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new ld({element:this._dotElement}),this._circleElement=x.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ld({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",f=>{f.geolocateSource||this._watchState!=="ACTIVE_LOCK"||f.originalEvent&&f.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.k("trackuserlocationend")),this.fire(new s.k("userlocationlostfocus")))})}},this.options=s.e({},zg,C)}onAdd(C){return this._map=C,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return s._(this,arguments,void 0,function*(o=!1){if(Ka!==void 0&&!o)return Ka;if(window.navigator.permissions===void 0)return Ka=!!window.navigator.geolocation,Ka;try{Ka=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Ka=!!window.navigator.geolocation}return Ka})}().then(o=>this._finishSetupUI(o)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),x.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ru=0,Lu=!1}_isOutOfMapMaxBounds(C){const o=this._map.getMaxBounds(),f=C.coords;return o&&(f.longitude<o.getWest()||f.longitude>o.getEast()||f.latitude<o.getSouth()||f.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const C=this._map.getBounds(),o=C.getSouthEast(),f=C.getNorthEast(),y=o.distanceTo(f),b=Math.ceil(this._accuracy/(y/this._map._container.clientHeight)*2);this._circleElement.style.width=`${b}px`,this._circleElement.style.height=`${b}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ru--,Lu=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.k("trackuserlocationstart")),this.fire(new s.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let C;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ru++,Ru>1?(C={maximumAge:6e5,timeout:0},Lu=!0):(C=this.options.positionOptions,Lu=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,C)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},u.Hash=Jc,u.ImageSource=Vt,u.KeyboardHandler=ui,u.LngLatBounds=$e,u.LogoControl=Tf,u.Map=class extends Ng{constructor(C){s.bf.mark(s.bg.create);const o=Object.assign(Object.assign({},Bx),C);if(o.minZoom!=null&&o.maxZoom!=null&&o.minZoom>o.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(o.minPitch!=null&&o.maxPitch!=null&&o.minPitch>o.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(o.minPitch!=null&&o.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(o.maxPitch!=null&&o.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new ll(o.minZoom,o.maxZoom,o.minPitch,o.maxPitch,o.renderWorldCopies),{bearingSnap:o.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Ir,this._controls=[],this._mapId=s.a4(),this._contextLost=f=>{f.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new s.k("webglcontextlost",{originalEvent:f}))},this._contextRestored=f=>{this._setupPainter(),this.resize(),this._update(),this.fire(new s.k("webglcontextrestored",{originalEvent:f}))},this._onMapScroll=f=>{if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=o.interactive,this._maxTileCacheSize=o.maxTileCacheSize,this._maxTileCacheZoomLevels=o.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=o.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=o.preserveDrawingBuffer===!0,this._antialias=o.antialias===!0,this._trackResize=o.trackResize===!0,this._bearingSnap=o.bearingSnap,this._refreshExpiredTiles=o.refreshExpiredTiles===!0,this._fadeDuration=o.fadeDuration,this._crossSourceCollisions=o.crossSourceCollisions===!0,this._collectResourceTiming=o.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Af),o.locale),this._clickTolerance=o.clickTolerance,this._overridePixelRatio=o.pixelRatio,this._maxCanvasSize=o.maxCanvasSize,this.transformCameraUpdate=o.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=o.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=D.addThrottleControl(()=>this.isMoving()),this._requestManager=new j(o.transformRequest),typeof o.container=="string"){if(this._container=document.getElementById(o.container),!this._container)throw new Error(`Container '${o.container}' not found.`)}else{if(!(o.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=o.container}if(o.maxBounds&&this.setMaxBounds(o.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let f=!1;const y=Iu(b=>{this._trackResize&&!this._removed&&(this.resize(b),this.redraw())},50);this._resizeObserver=new ResizeObserver(b=>{f?y(b):f=!0}),this._resizeObserver.observe(this._container)}this.handlers=new kf(this,o),this._hash=o.hash&&new Jc(typeof o.hash=="string"&&o.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:o.center,zoom:o.zoom,bearing:o.bearing,pitch:o.pitch}),o.bounds&&(this.resize(),this.fitBounds(o.bounds,s.e({},o.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=o.localIdeographFontFamily,this._validateStyle=o.validateStyle,o.style&&this.setStyle(o.style,{localIdeographFontFamily:o.localIdeographFontFamily}),o.attributionControl&&this.addControl(new hl(typeof o.attributionControl=="boolean"?void 0:o.attributionControl)),o.maplibreLogo&&this.addControl(new Tf,o.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",f=>{this._update(f.dataType==="style"),this.fire(new s.k(`${f.dataType}data`,f))}),this.on("dataloading",f=>{this.fire(new s.k(`${f.dataType}dataloading`,f))}),this.on("dataabort",f=>{this.fire(new s.k("sourcedataabort",f))})}_getMapId(){return this._mapId}addControl(C,o){if(o===void 0&&(o=C.getDefaultPosition?C.getDefaultPosition():"top-right"),!C||!C.onAdd)return this.fire(new s.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=C.onAdd(this);this._controls.push(C);const y=this._controlPositions[o];return o.indexOf("bottom")!==-1?y.insertBefore(f,y.firstChild):y.appendChild(f),this}removeControl(C){if(!C||!C.onRemove)return this.fire(new s.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(C);return o>-1&&this._controls.splice(o,1),C.onRemove(this),this}hasControl(C){return this._controls.indexOf(C)>-1}calculateCameraOptionsFromTo(C,o,f,y){return y==null&&this.terrain&&(y=this.terrain.getElevationForLngLatZoom(f,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(C,o,f,y)}resize(C){var o;const f=this._containerDimensions(),y=f[0],b=f[1],E=this._getClampedPixelRatio(y,b);if(this._resizeCanvas(y,b,E),this.painter.resize(y,b,E),this.painter.overLimit()){const B=this.painter.context.gl;this._maxCanvasSize=[B.drawingBufferWidth,B.drawingBufferHeight];const O=this._getClampedPixelRatio(y,b);this._resizeCanvas(y,b,O),this.painter.resize(y,b,O)}this.transform.resize(y,b),(o=this._requestedCameraState)===null||o===void 0||o.resize(y,b);const R=!this._moving;return R&&(this.stop(),this.fire(new s.k("movestart",C)).fire(new s.k("move",C))),this.fire(new s.k("resize",C)),R&&this.fire(new s.k("moveend",C)),this}_getClampedPixelRatio(C,o){const{0:f,1:y}=this._maxCanvasSize,b=this.getPixelRatio(),E=C*b,R=o*b;return Math.min(E>f?f/E:1,R>y?y/R:1)*b}getPixelRatio(){var C;return(C=this._overridePixelRatio)!==null&&C!==void 0?C:devicePixelRatio}setPixelRatio(C){this._overridePixelRatio=C,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(C){return this.transform.setMaxBounds($e.convert(C)),this._update()}setMinZoom(C){if((C=C??-2)>=-2&&C<=this.transform.maxZoom)return this.transform.minZoom=C,this._update(),this.getZoom()<C&&this.setZoom(C),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(C){if((C=C??22)>=this.transform.minZoom)return this.transform.maxZoom=C,this._update(),this.getZoom()>C&&this.setZoom(C),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(C){if((C=C??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(C>=0&&C<=this.transform.maxPitch)return this.transform.minPitch=C,this._update(),this.getPitch()<C&&this.setPitch(C),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(C){if((C=C??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(C>=this.transform.minPitch)return this.transform.maxPitch=C,this._update(),this.getPitch()>C&&this.setPitch(C),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(C){return this.transform.renderWorldCopies=C,this._update()}project(C){return this.transform.locationPoint(s.N.convert(C),this.style&&this.terrain)}unproject(C){return this.transform.pointLocation(s.P.convert(C),this.terrain)}isMoving(){var C;return this._moving||((C=this.handlers)===null||C===void 0?void 0:C.isMoving())}isZooming(){var C;return this._zooming||((C=this.handlers)===null||C===void 0?void 0:C.isZooming())}isRotating(){var C;return this._rotating||((C=this.handlers)===null||C===void 0?void 0:C.isRotating())}_createDelegatedListener(C,o,f){if(C==="mouseenter"||C==="mouseover"){let y=!1;return{layers:o,listener:f,delegates:{mousemove:E=>{const R=o.filter(O=>this.getLayer(O)),B=R.length!==0?this.queryRenderedFeatures(E.point,{layers:R}):[];B.length?y||(y=!0,f.call(this,new ia(C,this,E.originalEvent,{features:B}))):y=!1},mouseout:()=>{y=!1}}}}if(C==="mouseleave"||C==="mouseout"){let y=!1;return{layers:o,listener:f,delegates:{mousemove:R=>{const B=o.filter(O=>this.getLayer(O));(B.length!==0?this.queryRenderedFeatures(R.point,{layers:B}):[]).length?y=!0:y&&(y=!1,f.call(this,new ia(C,this,R.originalEvent)))},mouseout:R=>{y&&(y=!1,f.call(this,new ia(C,this,R.originalEvent)))}}}}{const y=b=>{const E=o.filter(B=>this.getLayer(B)),R=E.length!==0?this.queryRenderedFeatures(b.point,{layers:E}):[];R.length&&(b.features=R,f.call(this,b),delete b.features)};return{layers:o,listener:f,delegates:{[C]:y}}}}_saveDelegatedListener(C,o){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[C]=this._delegatedListeners[C]||[],this._delegatedListeners[C].push(o)}_removeDelegatedListener(C,o,f){if(!this._delegatedListeners||!this._delegatedListeners[C])return;const y=this._delegatedListeners[C];for(let b=0;b<y.length;b++){const E=y[b];if(E.listener===f&&E.layers.length===o.length&&E.layers.every(R=>o.includes(R))){for(const R in E.delegates)this.off(R,E.delegates[R]);return void y.splice(b,1)}}}on(C,o,f){if(f===void 0)return super.on(C,o);const y=this._createDelegatedListener(C,typeof o=="string"?[o]:o,f);this._saveDelegatedListener(C,y);for(const b in y.delegates)this.on(b,y.delegates[b]);return this}once(C,o,f){if(f===void 0)return super.once(C,o);const y=typeof o=="string"?[o]:o,b=this._createDelegatedListener(C,y,f);for(const E in b.delegates){const R=b.delegates[E];b.delegates[E]=(...B)=>{this._removeDelegatedListener(C,y,f),R(...B)}}this._saveDelegatedListener(C,b);for(const E in b.delegates)this.once(E,b.delegates[E]);return this}off(C,o,f){return f===void 0?super.off(C,o):(this._removeDelegatedListener(C,typeof o=="string"?[o]:o,f),this)}queryRenderedFeatures(C,o){if(!this.style)return[];let f;const y=C instanceof s.P||Array.isArray(C),b=y?C:[[0,0],[this.transform.width,this.transform.height]];if(o=o||(y?{}:C)||{},b instanceof s.P||typeof b[0]=="number")f=[s.P.convert(b)];else{const E=s.P.convert(b[0]),R=s.P.convert(b[1]);f=[E,new s.P(R.x,E.y),R,new s.P(E.x,R.y),E]}return this.style.queryRenderedFeatures(f,o,this.transform)}querySourceFeatures(C,o){return this.style.querySourceFeatures(C,o)}setStyle(C,o){return(o=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},o)).diff!==!1&&o.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&C?(this._diffStyle(C,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._updateStyle(C,o))}setTransformRequest(C){return this._requestManager.setTransformRequest(C),this}_getUIString(C){const o=this._locale[C];if(o==null)throw new Error(`Missing UI string '${C}'`);return o}_updateStyle(C,o){if(o.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(C,o));const f=this.style&&o.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!C)),C?(this.style=new Rc(this,o||{}),this.style.setEventedParent(this,{style:this.style}),typeof C=="string"?this.style.loadURL(C,o,f):this.style.loadJSON(C,o,f),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Rc(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(C,o){if(typeof C=="string"){const f=this._requestManager.transformRequest(C,"Style");s.h(f,new AbortController).then(y=>{this._updateDiff(y.data,o)}).catch(y=>{y&&this.fire(new s.j(y))})}else typeof C=="object"&&this._updateDiff(C,o)}_updateDiff(C,o){try{this.style.setState(C,o)&&this._update(!0)}catch(f){s.w(`Unable to perform style diff: ${f.message||f.error||f}.  Rebuilding the style from scratch.`),this._updateStyle(C,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(C,o){return this._lazyInitEmptyStyle(),this.style.addSource(C,o),this._update(!0)}isSourceLoaded(C){const o=this.style&&this.style.sourceCaches[C];if(o!==void 0)return o.loaded();this.fire(new s.j(new Error(`There is no source with ID '${C}'`)))}setTerrain(C){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),C){const o=this.style.sourceCaches[C.source];if(!o)throw new Error(`cannot load terrain, because there exists no source with ID: ${C.source}`);this.terrain===null&&o.reload();for(const f in this.style._layers){const y=this.style._layers[f];y.type==="hillshade"&&y.source===C.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new If(this.painter,o,C),this.painter.renderToTexture=new Mg(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=f=>{f.dataType==="style"?this.terrain.sourceCache.freeRtt():f.dataType==="source"&&f.tile&&(f.sourceId!==C.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(f.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new s.k("terrain",{terrain:C})),this}getTerrain(){var C,o;return(o=(C=this.terrain)===null||C===void 0?void 0:C.options)!==null&&o!==void 0?o:null}areTilesLoaded(){const C=this.style&&this.style.sourceCaches;for(const o in C){const f=C[o]._tiles;for(const y in f){const b=f[y];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}removeSource(C){return this.style.removeSource(C),this._update(!0)}getSource(C){return this.style.getSource(C)}addImage(C,o,f={}){const{pixelRatio:y=1,sdf:b=!1,stretchX:E,stretchY:R,content:B,textFitWidth:O,textFitHeight:H}=f;if(this._lazyInitEmptyStyle(),!(o instanceof HTMLImageElement||s.b(o))){if(o.width===void 0||o.height===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:ee,height:te,data:he}=o,ye=o;return this.style.addImage(C,{data:new s.R({width:ee,height:te},new Uint8Array(he)),pixelRatio:y,stretchX:E,stretchY:R,content:B,textFitWidth:O,textFitHeight:H,sdf:b,version:0,userImage:ye}),ye.onAdd&&ye.onAdd(this,C),this}}{const{width:ee,height:te,data:he}=v.getImageData(o);this.style.addImage(C,{data:new s.R({width:ee,height:te},he),pixelRatio:y,stretchX:E,stretchY:R,content:B,textFitWidth:O,textFitHeight:H,sdf:b,version:0})}}updateImage(C,o){const f=this.style.getImage(C);if(!f)return this.fire(new s.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=o instanceof HTMLImageElement||s.b(o)?v.getImageData(o):o,{width:b,height:E,data:R}=y;if(b===void 0||E===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==f.data.width||E!==f.data.height)return this.fire(new s.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const B=!(o instanceof HTMLImageElement||s.b(o));return f.data.replace(R,B),this.style.updateImage(C,f),this}getImage(C){return this.style.getImage(C)}hasImage(C){return C?!!this.style.getImage(C):(this.fire(new s.j(new Error("Missing required image id"))),!1)}removeImage(C){this.style.removeImage(C)}loadImage(C){return D.getImage(this._requestManager.transformRequest(C,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(C,o){return this._lazyInitEmptyStyle(),this.style.addLayer(C,o),this._update(!0)}moveLayer(C,o){return this.style.moveLayer(C,o),this._update(!0)}removeLayer(C){return this.style.removeLayer(C),this._update(!0)}getLayer(C){return this.style.getLayer(C)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(C,o,f){return this.style.setLayerZoomRange(C,o,f),this._update(!0)}setFilter(C,o,f={}){return this.style.setFilter(C,o,f),this._update(!0)}getFilter(C){return this.style.getFilter(C)}setPaintProperty(C,o,f,y={}){return this.style.setPaintProperty(C,o,f,y),this._update(!0)}getPaintProperty(C,o){return this.style.getPaintProperty(C,o)}setLayoutProperty(C,o,f,y={}){return this.style.setLayoutProperty(C,o,f,y),this._update(!0)}getLayoutProperty(C,o){return this.style.getLayoutProperty(C,o)}setGlyphs(C,o={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(C,o),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(C,o,f={}){return this._lazyInitEmptyStyle(),this.style.addSprite(C,o,f,y=>{y||this._update(!0)}),this}removeSprite(C){return this._lazyInitEmptyStyle(),this.style.removeSprite(C),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(C,o={}){return this._lazyInitEmptyStyle(),this.style.setSprite(C,o,f=>{f||this._update(!0)}),this}setLight(C,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(C,o),this._update(!0)}getLight(){return this.style.getLight()}setSky(C){return this._lazyInitEmptyStyle(),this.style.setSky(C),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(C,o){return this.style.setFeatureState(C,o),this._update()}removeFeatureState(C,o){return this.style.removeFeatureState(C,o),this._update()}getFeatureState(C){return this.style.getFeatureState(C)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let C=0,o=0;return this._container&&(C=this._container.clientWidth||400,o=this._container.clientHeight||300),[C,o]}_setupContainer(){const C=this._container;C.classList.add("maplibregl-map");const o=this._canvasContainer=x.create("div","maplibregl-canvas-container",C);this._interactive&&o.classList.add("maplibregl-interactive"),this._canvas=x.create("canvas","maplibregl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const f=this._containerDimensions(),y=this._getClampedPixelRatio(f[0],f[1]);this._resizeCanvas(f[0],f[1],y);const b=this._controlContainer=x.create("div","maplibregl-control-container",C),E=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(R=>{E[R]=x.create("div",`maplibregl-ctrl-${R} `,b)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(C,o,f){this._canvas.width=Math.floor(f*C),this._canvas.height=Math.floor(f*o),this._canvas.style.width=`${C}px`,this._canvas.style.height=`${o}px`}_setupPainter(){const C={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let o=null;this._canvas.addEventListener("webglcontextcreationerror",y=>{o={requestedAttributes:C},y&&(o.statusMessage=y.statusMessage,o.type=y.type)},{once:!0});const f=this._canvas.getContext("webgl2",C)||this._canvas.getContext("webgl",C);if(!f){const y="Failed to initialize WebGL";throw o?(o.message=y,new Error(JSON.stringify(o))):new Error(y)}this.painter=new Yc(f,this.transform),S.testSupport(f)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(C){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||C,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(C){return this._update(),this._renderTaskQueue.add(C)}_cancelRenderFrame(C){this._renderTaskQueue.remove(C)}_render(C){const o=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(C),this._removed)return;let f=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const b=this.transform.zoom,E=v.now();this.style.zoomHistory.update(b,E);const R=new s.z(b,{now:E,fadeDuration:o,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),B=R.crossFadingFactor();B===1&&B===this._crossFadingFactor||(f=!0,this._crossFadingFactor=B),this.style.update(R)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,o,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:o,showPadding:this.showPadding}),this.fire(new s.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.bf.mark(s.bg.load),this.fire(new s.k("load"))),this.style&&(this.style.hasTransitions()||f)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const y=this._sourcesDirty||this._styleDirty||this._placementDirty;return y||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.k("idle")),!this._loaded||this._fullyLoaded||y||(this._fullyLoaded=!0,s.bf.mark(s.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var C;this._hash&&this._hash.remove();for(const f of this._controls)f.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),D.removeThrottleControl(this._imageQueueHandle),(C=this._resizeObserver)===null||C===void 0||C.disconnect();const o=this.painter.context.gl.getExtension("WEBGL_lose_context");o!=null&&o.loseContext&&o.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),x.remove(this._canvasContainer),x.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),s.bf.clearMetrics(),this._removed=!0,this.fire(new s.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,v.frameAsync(this._frameRequest).then(C=>{s.bf.frame(C),this._frameRequest=null,this._render(C)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(C){this._showTileBoundaries!==C&&(this._showTileBoundaries=C,this._update())}get showPadding(){return!!this._showPadding}set showPadding(C){this._showPadding!==C&&(this._showPadding=C,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(C){this._showCollisionBoxes!==C&&(this._showCollisionBoxes=C,C?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(C){this._showOverdrawInspector!==C&&(this._showOverdrawInspector=C,this._update())}get repaint(){return!!this._repaint}set repaint(C){this._repaint!==C&&(this._repaint=C,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(C){this._vertices=C,this._update()}get version(){return Dg}getCameraTargetElevation(){return this.transform.elevation}},u.MapMouseEvent=ia,u.MapTouchEvent=xo,u.MapWheelEvent=kg,u.Marker=ld,u.NavigationControl=class{constructor(C){this._updateZoomButtons=()=>{const o=this._map.getZoom(),f=o===this._map.getMaxZoom(),y=o===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=y,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",y.toString())},this._rotateCompassArrow=()=>{const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=o},this._setButtonTitle=(o,f)=>{const y=this._map._getUIString(`NavigationControl.${f}`);o.title=y,o.setAttribute("aria-label",y)},this.options=s.e({},jx,C),this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",o=>this._map.zoomIn({},{originalEvent:o})),x.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",o=>this._map.zoomOut({},{originalEvent:o})),x.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})}),this._compassIcon=x.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(C){return this._map=C,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ox(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){x.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(C,o){const f=x.create("button",C,this._container);return f.type="button",f.addEventListener("click",o),f}},u.Popup=class extends s.E{constructor(C){super(),this.remove=()=>(this._content&&x.remove(this._content),this._container&&(x.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new s.k("close"))),this),this._onMouseUp=o=>{this._update(o.point)},this._onMouseMove=o=>{this._update(o.point)},this._onDrag=o=>{this._update(o.point)},this._update=o=>{var f;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=x.create("div","maplibregl-popup",this._map.getContainer()),this._tip=x.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const B of this.options.className.split(" "))this._container.classList.add(B);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?nn(this._lngLat,this._flatPos,this._map.transform):(f=this._lngLat)===null||f===void 0?void 0:f.wrap(),this._trackPointer&&!o)return;const y=this._flatPos=this._pos=this._trackPointer&&o?o:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&o?o:this._map.transform.locationPoint(this._lngLat));let b=this.options.anchor;const E=cd(this.options.offset);if(!b){const B=this._container.offsetWidth,O=this._container.offsetHeight;let H;H=y.y+E.bottom.y<O?["top"]:y.y>this._map.transform.height-O?["bottom"]:[],y.x<B/2?H.push("left"):y.x>this._map.transform.width-B/2&&H.push("right"),b=H.length===0?"bottom":H.join("-")}let R=y.add(E[b]);this.options.subpixelPositioning||(R=R.round()),x.setTransform(this._container,`${pl[b]} translate(${R.x}px,${R.y}px)`),od(this._container,b,"popup")},this._onClose=()=>{this.remove()},this.options=s.e(Object.create(ur),C)}addTo(C){return this._map&&this.remove(),this._map=C,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(C){return this._lngLat=s.N.convert(C),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(C){return this.setDOMContent(document.createTextNode(C))}setHTML(C){const o=document.createDocumentFragment(),f=document.createElement("body");let y;for(f.innerHTML=C;y=f.firstChild,y;)o.appendChild(y);return this.setDOMContent(o)}getMaxWidth(){var C;return(C=this._container)===null||C===void 0?void 0:C.style.maxWidth}setMaxWidth(C){return this.options.maxWidth=C,this._update(),this}setDOMContent(C){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=x.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(C),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(C){return this._container&&this._container.classList.add(C),this}removeClassName(C){return this._container&&this._container.classList.remove(C),this}setOffset(C){return this.options.offset=C,this._update(),this}toggleClassName(C){if(this._container)return this._container.classList.toggle(C)}setSubpixelPositioning(C){this.options.subpixelPositioning=C}_createCloseButton(){this.options.closeButton&&(this._closeButton=x.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const C=this._container.querySelector(ud);C&&C.focus()}},u.RasterDEMTileSource=at,u.RasterTileSource=Ye,u.ScaleControl=class{constructor(C){this._onMove=()=>{Bu(this._map,this._container,this.options)},this.setUnit=o=>{this.options.unit=o,Bu(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Ki),C)}getDefaultPosition(){return"bottom-left"}onAdd(C){return this._map=C,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-scale",C.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){x.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},u.ScrollZoomHandler=Ii,u.Style=Rc,u.TerrainControl=class{constructor(C){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=C}onAdd(C){return this._map=C,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=x.create("button","maplibregl-ctrl-terrain",this._container),x.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){x.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},u.TwoFingersTouchPitchHandler=zu,u.TwoFingersTouchRotateHandler=Sf,u.TwoFingersTouchZoomHandler=_f,u.TwoFingersTouchZoomRotateHandler=Cf,u.VectorTileSource=Pe,u.VideoSource=Bt,u.addSourceType=(C,o)=>s._(void 0,void 0,void 0,function*(){if(ar(C))throw new Error(`A source type called "${C}" already exists.`);((f,y)=>{cr[f]=y})(C,o)}),u.clearPrewarmedResources=function(){const C=nt;C&&(C.isPreloaded()&&C.numActive()===1?(C.release(Oe),nt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},u.getMaxParallelImageRequests=function(){return s.a.MAX_PARALLEL_IMAGE_REQUESTS},u.getRTLTextPluginStatus=function(){return kt().getRTLTextPluginStatus()},u.getVersion=function(){return Mf},u.getWorkerCount=function(){return Fe.workerCount},u.getWorkerUrl=function(){return s.a.WORKER_URL},u.importScriptInWorkers=function(C){return He().broadcast("IS",C)},u.prewarm=function(){it().acquire(Oe)},u.setMaxParallelImageRequests=function(C){s.a.MAX_PARALLEL_IMAGE_REQUESTS=C},u.setRTLTextPlugin=function(C,o){return kt().setRTLTextPlugin(C,o)},u.setWorkerCount=function(C){Fe.workerCount=C},u.setWorkerUrl=function(C){s.a.WORKER_URL=C}});var i=r;return i})})(ZD);var NF=ZD.exports;const fh=R2(NF);function MF({locations:e,followLive:t=!1,latestEntity:r=null}){const n=se.useRef(null),a=se.useRef(null),i=se.useRef(new Map),u=MS(g=>g.set),s="https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json";se.useEffect(()=>{if(!a.current)return;if(n.current){setTimeout(()=>{var v;return(v=n.current)==null?void 0:v.resize()},100);return}setTimeout(()=>{!a.current||n.current||(n.current=new fh.Map({container:a.current,style:s,center:[-4.25,55.86],zoom:10}),n.current.addControl(new fh.NavigationControl,"top-right"))},50)},[s]),se.useEffect(()=>{if(!n.current||!a.current)return;const g=new ResizeObserver(()=>{n.current&&n.current.resize()});return g.observe(a.current),()=>g.disconnect()},[]);const h=se.useCallback(()=>{if(!n.current)return;const g=new Set;e.forEach(v=>{if(g.add(v.id),i.current.get(v.id))i.current.get(v.id).setLngLat([v.lon,v.lat]);else{const x=document.createElement("div");x.className="w-3 h-3 rounded-full bg-teal-400 border border-white/50",x.onclick=()=>u({id:v.id,type:v.type||"Location"});const S=new fh.Marker({element:x}).setLngLat([v.lon,v.lat]).addTo(n.current);i.current.set(v.id,S)}});for(const[v,x]of i.current)g.has(v)||(x.remove(),i.current.delete(v))},[e,u]);se.useEffect(()=>{const g=setTimeout(h,150);return()=>clearTimeout(g)},[h]);const p=se.useRef(0);return se.useEffect(()=>{if(!t||!r||!n.current)return;const g=e.find(x=>x.id===r.id);if(!g||typeof g.lat!="number"||typeof g.lon!="number")return;const v=Date.now();if(v-p.current<2e3){St(`New event: ${r.type||r.id}`);return}p.current=v,n.current.flyTo({center:[g.lon,g.lat],zoom:12,duration:1500})},[t,r,e]),se.useEffect(()=>OD(({id:v})=>{if(!n.current)return;const x=i.current.get(v);if(x){const P=x.getLngLat();n.current.flyTo({center:[P.lng,P.lat],zoom:12,duration:1500});return}const S=e.find(P=>P.id===v);S&&typeof S.lat=="number"&&typeof S.lon=="number"&&n.current.flyTo({center:[S.lon,S.lat],zoom:12,duration:1500})}),[e]),w.jsx("div",{ref:a,className:"w-full h-full rounded-lg overflow-hidden",style:{minHeight:0}})}const KD="http://localhost:8088/graphql".replace(/^http/,"ws").replace(/\/graphql\/?$/,"")+"/ws";function YD(e){let t=null,r=!1,n=500;const a=()=>{if(!r){try{t=new WebSocket(KD)}catch{i();return}t.onmessage=u=>{try{e(JSON.parse(u.data))}catch{}},t.onclose=i,t.onerror=i}},i=()=>{r||(setTimeout(a,n),n=Math.min(n*2,5e3))};return a(),()=>{r=!0;try{t==null||t.close()}catch{}}}const MT=1e3;function DF(e,t="timestamp",r="desc",n){const[a,i]=se.useState([]),[u,s]=se.useState(!0),[h,p]=se.useState(null),g=se.useRef(new Map),v=se.useRef(null),x=se.useCallback(S=>{v.current=S},[]);return se.useEffect(()=>((async()=>{s(!0),p(null);try{const N=new URLSearchParams;N.set("sort",t),N.set("order",r);const I=await fetch(`http://localhost:8081/entities?${N}`);if(!I.ok)throw new Error(`HTTP ${I.status}`);const A=await I.json();g.current=new Map(A.map(V=>[V.id,V]));const D=Array.from(g.current.values());D.sort((V,U)=>{var X,J;const $=((X=V.attrs)==null?void 0:X.timestamp)||"",W=((J=U.attrs)==null?void 0:J.timestamp)||"";return r==="desc"?W.localeCompare($):$.localeCompare(W)});const j=n?D.slice(0,n):D.slice(0,MT);i(j)}catch(N){p(N.message)}finally{s(!1)}})(),YD(N=>{if(N.t==="entity.upsert"&&N.data){const M=N.data;e&&M.type,g.current.set(M.id,M);const I=Array.from(g.current.values());I.sort((D,j)=>{var $,W;const V=(($=D.attrs)==null?void 0:$.timestamp)||"",U=((W=j.attrs)==null?void 0:W.timestamp)||"";return r==="desc"?U.localeCompare(V):V.localeCompare(U)});const A=n?I.slice(0,n):I.slice(0,MT);i(A),v.current&&v.current(M)}})),[e,t,r,n]),{entities:a,loading:u,error:h,onNewEntity:x}}const zF=Ti(e=>({followLiveMap:!1,followLiveGraph:!1,setFollowLiveMap:t=>e({followLiveMap:t}),setFollowLiveGraph:t=>e({followLiveGraph:t})})),RF=()=>{const{entities:e,loading:t,error:r,onNewEntity:n}=DF(),{followLiveMap:a,setFollowLiveMap:i}=zF(),[u,s]=se.useState(null);se.useEffect(()=>{n(p=>{s(p)})},[n]);const h=se.useMemo(()=>e.filter(p=>typeof p.attrs.lat=="number"&&typeof p.attrs.lon=="number").map(p=>({id:p.id,lat:p.attrs.lat,lon:p.attrs.lon,attrs:p.attrs,type:p.type})),[e]);return w.jsxs(Is,{title:"Map",header:w.jsxs("label",{className:"flex items-center gap-2 text-xs cursor-pointer",children:[w.jsx("input",{type:"checkbox",checked:a,onChange:p=>i(p.target.checked),className:"w-3 h-3"}),"Follow Live"]}),children:[t&&w.jsx("div",{className:"text-sm text-muted mb-2 flex-shrink-0 p-3",children:"Loading..."}),r&&w.jsxs("div",{className:"text-sm text-red-400 mb-2 flex-shrink-0 p-3",children:["Error: ",r]}),!t&&!r&&w.jsx("div",{className:"flex-1 min-h-0 p-3 flex flex-col",children:w.jsx(MF,{locations:h,followLive:a,latestEntity:u})})]})};function Y1(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function LF(e){if(Array.isArray(e))return e}function BF(e){if(Array.isArray(e))return Y1(e)}function pu(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function jF(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,QD(n.key),n)}}function mu(e,t,r){return t&&jF(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function wi(e,t){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=jS(e))||t){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i,u=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var h=r.next();return u=h.done,h},e:function(h){s=!0,i=h},f:function(){try{u||r.return==null||r.return()}finally{if(s)throw i}}}}function JD(e,t,r){return(t=QD(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function OF(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function FF(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,i,u,s=[],h=!0,p=!1;try{if(i=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;h=!1}else for(;!(h=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);h=!0);}catch(g){p=!0,a=g}finally{try{if(!h&&r.return!=null&&(u=r.return(),Object(u)!==u))return}finally{if(p)throw a}}return s}}function $F(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function VF(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Hn(e,t){return LF(e)||FF(e,t)||jS(e,t)||$F()}function Jy(e){return BF(e)||OF(e)||jS(e)||VF()}function UF(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function QD(e){var t=UF(e,"string");return typeof t=="symbol"?t:t+""}function ta(e){"@babel/helpers - typeof";return ta=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ta(e)}function jS(e,t){if(e){if(typeof e=="string")return Y1(e,t);var r={}.toString.call(e).slice(8,-1);return r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set"?Array.from(e):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Y1(e,t):void 0}}var Yn=typeof window>"u"?null:window,DT=Yn?Yn.navigator:null;Yn&&Yn.document;var qF=ta(""),ez=ta({}),HF=ta(function(){}),GF=typeof HTMLElement>"u"?"undefined":ta(HTMLElement),Fm=function(t){return t&&t.instanceString&&Nn(t.instanceString)?t.instanceString():null},dr=function(t){return t!=null&&ta(t)==qF},Nn=function(t){return t!=null&&ta(t)===HF},dn=function(t){return!$i(t)&&(Array.isArray?Array.isArray(t):t!=null&&t instanceof Array)},Ur=function(t){return t!=null&&ta(t)===ez&&!dn(t)&&t.constructor===Object},WF=function(t){return t!=null&&ta(t)===ez},Ht=function(t){return t!=null&&ta(t)===ta(1)&&!isNaN(t)},ZF=function(t){return Ht(t)&&Math.floor(t)===t},Qy=function(t){if(GF!=="undefined")return t!=null&&t instanceof HTMLElement},$i=function(t){return $m(t)||tz(t)},$m=function(t){return Fm(t)==="collection"&&t._private.single},tz=function(t){return Fm(t)==="collection"&&!t._private.single},OS=function(t){return Fm(t)==="core"},rz=function(t){return Fm(t)==="stylesheet"},XF=function(t){return Fm(t)==="event"},iu=function(t){return t==null?!0:!!(t===""||t.match(/^\s+$/))},KF=function(t){return typeof HTMLElement>"u"?!1:t instanceof HTMLElement},YF=function(t){return Ur(t)&&Ht(t.x1)&&Ht(t.x2)&&Ht(t.y1)&&Ht(t.y2)},JF=function(t){return WF(t)&&Nn(t.then)},QF=function(){return DT&&DT.userAgent.match(/msie|trident|edge/i)},Ih=function(t,r){r||(r=function(){if(arguments.length===1)return arguments[0];if(arguments.length===0)return"undefined";for(var i=[],u=0;u<arguments.length;u++)i.push(arguments[u]);return i.join("$")});var n=function(){var i=this,u=arguments,s,h=r.apply(i,u),p=n.cache;return(s=p[h])||(s=p[h]=t.apply(i,u)),s};return n.cache={},n},FS=Ih(function(e){return e.replace(/([A-Z])/g,function(t){return"-"+t.toLowerCase()})}),U0=Ih(function(e){return e.replace(/(-\w)/g,function(t){return t[1].toUpperCase()})}),nz=Ih(function(e,t){return e+t[0].toUpperCase()+t.substring(1)},function(e,t){return e+"$"+t}),zT=function(t){return iu(t)?t:t.charAt(0).toUpperCase()+t.substring(1)},Vl=function(t,r){return t.slice(-1*r.length)===r},ea="(?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))",e6="rgb[a]?\\(("+ea+"[%]?)\\s*,\\s*("+ea+"[%]?)\\s*,\\s*("+ea+"[%]?)(?:\\s*,\\s*("+ea+"))?\\)",t6="rgb[a]?\\((?:"+ea+"[%]?)\\s*,\\s*(?:"+ea+"[%]?)\\s*,\\s*(?:"+ea+"[%]?)(?:\\s*,\\s*(?:"+ea+"))?\\)",r6="hsl[a]?\\(("+ea+")\\s*,\\s*("+ea+"[%])\\s*,\\s*("+ea+"[%])(?:\\s*,\\s*("+ea+"))?\\)",n6="hsl[a]?\\((?:"+ea+")\\s*,\\s*(?:"+ea+"[%])\\s*,\\s*(?:"+ea+"[%])(?:\\s*,\\s*(?:"+ea+"))?\\)",a6="\\#[0-9a-fA-F]{3}",i6="\\#[0-9a-fA-F]{6}",az=function(t,r){return t<r?-1:t>r?1:0},s6=function(t,r){return-1*az(t,r)},xr=Object.assign!=null?Object.assign.bind(Object):function(e){for(var t=arguments,r=1;r<t.length;r++){var n=t[r];if(n!=null)for(var a=Object.keys(n),i=0;i<a.length;i++){var u=a[i];e[u]=n[u]}}return e},o6=function(t){if(!(!(t.length===4||t.length===7)||t[0]!=="#")){var r=t.length===4,n,a,i,u=16;return r?(n=parseInt(t[1]+t[1],u),a=parseInt(t[2]+t[2],u),i=parseInt(t[3]+t[3],u)):(n=parseInt(t[1]+t[2],u),a=parseInt(t[3]+t[4],u),i=parseInt(t[5]+t[6],u)),[n,a,i]}},l6=function(t){var r,n,a,i,u,s,h,p;function g(P,N,M){return M<0&&(M+=1),M>1&&(M-=1),M<1/6?P+(N-P)*6*M:M<1/2?N:M<2/3?P+(N-P)*(2/3-M)*6:P}var v=new RegExp("^"+r6+"$").exec(t);if(v){if(n=parseInt(v[1]),n<0?n=(360- -1*n%360)%360:n>360&&(n=n%360),n/=360,a=parseFloat(v[2]),a<0||a>100||(a=a/100,i=parseFloat(v[3]),i<0||i>100)||(i=i/100,u=v[4],u!==void 0&&(u=parseFloat(u),u<0||u>1)))return;if(a===0)s=h=p=Math.round(i*255);else{var x=i<.5?i*(1+a):i+a-i*a,S=2*i-x;s=Math.round(255*g(S,x,n+1/3)),h=Math.round(255*g(S,x,n)),p=Math.round(255*g(S,x,n-1/3))}r=[s,h,p,u]}return r},u6=function(t){var r,n=new RegExp("^"+e6+"$").exec(t);if(n){r=[];for(var a=[],i=1;i<=3;i++){var u=n[i];if(u[u.length-1]==="%"&&(a[i]=!0),u=parseFloat(u),a[i]&&(u=u/100*255),u<0||u>255)return;r.push(Math.floor(u))}var s=a[1]||a[2]||a[3],h=a[1]&&a[2]&&a[3];if(s&&!h)return;var p=n[4];if(p!==void 0){if(p=parseFloat(p),p<0||p>1)return;r.push(p)}}return r},c6=function(t){return d6[t.toLowerCase()]},iz=function(t){return(dn(t)?t:null)||c6(t)||o6(t)||u6(t)||l6(t)},d6={transparent:[0,0,0,0],aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],grey:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},sz=function(t){for(var r=t.map,n=t.keys,a=n.length,i=0;i<a;i++){var u=n[i];if(Ur(u))throw Error("Tried to set map with object key");i<n.length-1?(r[u]==null&&(r[u]={}),r=r[u]):r[u]=t.value}},oz=function(t){for(var r=t.map,n=t.keys,a=n.length,i=0;i<a;i++){var u=n[i];if(Ur(u))throw Error("Tried to get map with object key");if(r=r[u],r==null)return r}return r},Sv=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Vm(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var o_,RT;function Um(){if(RT)return o_;RT=1;function e(t){var r=typeof t;return t!=null&&(r=="object"||r=="function")}return o_=e,o_}var l_,LT;function h6(){if(LT)return l_;LT=1;var e=typeof Sv=="object"&&Sv&&Sv.Object===Object&&Sv;return l_=e,l_}var u_,BT;function q0(){if(BT)return u_;BT=1;var e=h6(),t=typeof self=="object"&&self&&self.Object===Object&&self,r=e||t||Function("return this")();return u_=r,u_}var c_,jT;function f6(){if(jT)return c_;jT=1;var e=q0(),t=function(){return e.Date.now()};return c_=t,c_}var d_,OT;function p6(){if(OT)return d_;OT=1;var e=/\s/;function t(r){for(var n=r.length;n--&&e.test(r.charAt(n)););return n}return d_=t,d_}var h_,FT;function m6(){if(FT)return h_;FT=1;var e=p6(),t=/^\s+/;function r(n){return n&&n.slice(0,e(n)+1).replace(t,"")}return h_=r,h_}var f_,$T;function $S(){if($T)return f_;$T=1;var e=q0(),t=e.Symbol;return f_=t,f_}var p_,VT;function g6(){if(VT)return p_;VT=1;var e=$S(),t=Object.prototype,r=t.hasOwnProperty,n=t.toString,a=e?e.toStringTag:void 0;function i(u){var s=r.call(u,a),h=u[a];try{u[a]=void 0;var p=!0}catch{}var g=n.call(u);return p&&(s?u[a]=h:delete u[a]),g}return p_=i,p_}var m_,UT;function v6(){if(UT)return m_;UT=1;var e=Object.prototype,t=e.toString;function r(n){return t.call(n)}return m_=r,m_}var g_,qT;function lz(){if(qT)return g_;qT=1;var e=$S(),t=g6(),r=v6(),n="[object Null]",a="[object Undefined]",i=e?e.toStringTag:void 0;function u(s){return s==null?s===void 0?a:n:i&&i in Object(s)?t(s):r(s)}return g_=u,g_}var v_,HT;function y6(){if(HT)return v_;HT=1;function e(t){return t!=null&&typeof t=="object"}return v_=e,v_}var y_,GT;function qm(){if(GT)return y_;GT=1;var e=lz(),t=y6(),r="[object Symbol]";function n(a){return typeof a=="symbol"||t(a)&&e(a)==r}return y_=n,y_}var x_,WT;function x6(){if(WT)return x_;WT=1;var e=m6(),t=Um(),r=qm(),n=NaN,a=/^[-+]0x[0-9a-f]+$/i,i=/^0b[01]+$/i,u=/^0o[0-7]+$/i,s=parseInt;function h(p){if(typeof p=="number")return p;if(r(p))return n;if(t(p)){var g=typeof p.valueOf=="function"?p.valueOf():p;p=t(g)?g+"":g}if(typeof p!="string")return p===0?p:+p;p=e(p);var v=i.test(p);return v||u.test(p)?s(p.slice(2),v?2:8):a.test(p)?n:+p}return x_=h,x_}var b_,ZT;function b6(){if(ZT)return b_;ZT=1;var e=Um(),t=f6(),r=x6(),n="Expected a function",a=Math.max,i=Math.min;function u(s,h,p){var g,v,x,S,P,N,M=0,I=!1,A=!1,D=!0;if(typeof s!="function")throw new TypeError(n);h=r(h)||0,e(p)&&(I=!!p.leading,A="maxWait"in p,x=A?a(r(p.maxWait)||0,h):x,D="trailing"in p?!!p.trailing:D);function j(Y){var G=g,oe=v;return g=v=void 0,M=Y,S=s.apply(oe,G),S}function V(Y){return M=Y,P=setTimeout(W,h),I?j(Y):S}function U(Y){var G=Y-N,oe=Y-M,ie=h-G;return A?i(ie,x-oe):ie}function $(Y){var G=Y-N,oe=Y-M;return N===void 0||G>=h||G<0||A&&oe>=x}function W(){var Y=t();if($(Y))return X(Y);P=setTimeout(W,U(Y))}function X(Y){return P=void 0,D&&g?j(Y):(g=v=void 0,S)}function J(){P!==void 0&&clearTimeout(P),M=0,g=N=v=P=void 0}function Z(){return P===void 0?S:X(t())}function K(){var Y=t(),G=$(Y);if(g=arguments,v=this,N=Y,G){if(P===void 0)return V(N);if(A)return clearTimeout(P),P=setTimeout(W,h),j(N)}return P===void 0&&(P=setTimeout(W,h)),S}return K.cancel=J,K.flush=Z,K}return b_=u,b_}var _6=b6(),Hm=Vm(_6),__=Yn?Yn.performance:null,uz=__&&__.now?function(){return __.now()}:function(){return Date.now()},w6=function(){if(Yn){if(Yn.requestAnimationFrame)return function(e){Yn.requestAnimationFrame(e)};if(Yn.mozRequestAnimationFrame)return function(e){Yn.mozRequestAnimationFrame(e)};if(Yn.webkitRequestAnimationFrame)return function(e){Yn.webkitRequestAnimationFrame(e)};if(Yn.msRequestAnimationFrame)return function(e){Yn.msRequestAnimationFrame(e)}}return function(e){e&&setTimeout(function(){e(uz())},1e3/60)}}(),e0=function(t){return w6(t)},Uo=uz,tc=9261,cz=65599,Ud=5381,dz=function(t){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:tc,n=r,a;a=t.next(),!a.done;)n=n*cz+a.value|0;return n},dm=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:tc;return r*cz+t|0},hm=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ud;return(r<<5)+r+t|0},S6=function(t,r){return t*2097152+r},Pl=function(t){return t[0]*2097152+t[1]},Ev=function(t,r){return[dm(t[0],r[0]),hm(t[1],r[1])]},XT=function(t,r){var n={value:0,done:!1},a=0,i=t.length,u={next:function(){return a<i?n.value=t[a++]:n.done=!0,n}};return dz(u,r)},bc=function(t,r){var n={value:0,done:!1},a=0,i=t.length,u={next:function(){return a<i?n.value=t.charCodeAt(a++):n.done=!0,n}};return dz(u,r)},hz=function(){return E6(arguments)},E6=function(t){for(var r,n=0;n<t.length;n++){var a=t[n];n===0?r=bc(a):r=bc(a,r)}return r};function C6(e,t,r,n,a){var i=a*Math.PI/180,u=Math.cos(i)*(e-r)-Math.sin(i)*(t-n)+r,s=Math.sin(i)*(e-r)+Math.cos(i)*(t-n)+n;return{x:u,y:s}}var k6=function(t,r,n,a,i,u){return{x:(t-n)*i+n,y:(r-a)*u+a}};function T6(e,t,r){if(r===0)return e;var n=(t.x1+t.x2)/2,a=(t.y1+t.y2)/2,i=t.w/t.h,u=1/i,s=C6(e.x,e.y,n,a,r),h=k6(s.x,s.y,n,a,i,u);return{x:h.x,y:h.y}}var KT=!0,P6=console.warn!=null,I6=console.trace!=null,VS=Number.MAX_SAFE_INTEGER||9007199254740991,fz=function(){return!0},t0=function(){return!1},YT=function(){return 0},US=function(){},Tn=function(t){throw new Error(t)},pz=function(t){if(t!==void 0)KT=!!t;else return KT},Jr=function(t){pz()&&(P6?console.warn(t):(console.log(t),I6&&console.trace()))},A6=function(t){return xr({},t)},to=function(t){return t==null?t:dn(t)?t.slice():Ur(t)?A6(t):t},N6=function(t){return t.slice()},mz=function(t,r){for(r=t="";t++<36;r+=t*51&52?(t^15?8^Math.random()*(t^20?16:4):4).toString(16):"-");return r},M6={},gz=function(){return M6},Pa=function(t){var r=Object.keys(t);return function(n){for(var a={},i=0;i<r.length;i++){var u=r[i],s=n==null?void 0:n[u];a[u]=s===void 0?t[u]:s}return a}},su=function(t,r,n){for(var a=t.length-1;a>=0;a--)t[a]===r&&t.splice(a,1)},qS=function(t){t.splice(0,t.length)},D6=function(t,r){for(var n=0;n<r.length;n++){var a=r[n];t.push(a)}},yi=function(t,r,n){return n&&(r=nz(n,r)),t[r]},Mo=function(t,r,n,a){n&&(r=nz(n,r)),t[r]=a},z6=function(){function e(){pu(this,e),this._obj={}}return mu(e,[{key:"set",value:function(r,n){return this._obj[r]=n,this}},{key:"delete",value:function(r){return this._obj[r]=void 0,this}},{key:"clear",value:function(){this._obj={}}},{key:"has",value:function(r){return this._obj[r]!==void 0}},{key:"get",value:function(r){return this._obj[r]}}])}(),Ro=typeof Map<"u"?Map:z6,R6="undefined",L6=function(){function e(t){if(pu(this,e),this._obj=Object.create(null),this.size=0,t!=null){var r;t.instanceString!=null&&t.instanceString()===this.instanceString()?r=t.toArray():r=t;for(var n=0;n<r.length;n++)this.add(r[n])}}return mu(e,[{key:"instanceString",value:function(){return"set"}},{key:"add",value:function(r){var n=this._obj;n[r]!==1&&(n[r]=1,this.size++)}},{key:"delete",value:function(r){var n=this._obj;n[r]===1&&(n[r]=0,this.size--)}},{key:"clear",value:function(){this._obj=Object.create(null)}},{key:"has",value:function(r){return this._obj[r]===1}},{key:"toArray",value:function(){var r=this;return Object.keys(this._obj).filter(function(n){return r.has(n)})}},{key:"forEach",value:function(r,n){return this.toArray().forEach(r,n)}}])}(),Fh=(typeof Set>"u"?"undefined":ta(Set))!==R6?Set:L6,H0=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(t===void 0||r===void 0||!OS(t)){Tn("An element must have a core reference and parameters set");return}var a=r.group;if(a==null&&(r.data&&r.data.source!=null&&r.data.target!=null?a="edges":a="nodes"),a!=="nodes"&&a!=="edges"){Tn("An element must be of type `nodes` or `edges`; you specified `"+a+"`");return}this.length=1,this[0]=this;var i=this._private={cy:t,single:!0,data:r.data||{},position:r.position||{x:0,y:0},autoWidth:void 0,autoHeight:void 0,autoPadding:void 0,compoundBoundsClean:!1,listeners:[],group:a,style:{},rstyle:{},styleCxts:[],styleKeys:{},removed:!0,selected:!!r.selected,selectable:r.selectable===void 0?!0:!!r.selectable,locked:!!r.locked,grabbed:!1,grabbable:r.grabbable===void 0?!0:!!r.grabbable,pannable:r.pannable===void 0?a==="edges":!!r.pannable,active:!1,classes:new Fh,animation:{current:[],queue:[]},rscratch:{},scratch:r.scratch||{},edges:[],children:[],parent:r.parent&&r.parent.isNode()?r.parent:null,traversalCache:{},backgrounding:!1,bbCache:null,bbCacheShift:{x:0,y:0},bodyBounds:null,overlayBounds:null,labelBounds:{all:null,source:null,target:null,main:null},arrowBounds:{source:null,target:null,"mid-source":null,"mid-target":null}};if(i.position.x==null&&(i.position.x=0),i.position.y==null&&(i.position.y=0),r.renderedPosition){var u=r.renderedPosition,s=t.pan(),h=t.zoom();i.position={x:(u.x-s.x)/h,y:(u.y-s.y)/h}}var p=[];dn(r.classes)?p=r.classes:dr(r.classes)&&(p=r.classes.split(/\s+/));for(var g=0,v=p.length;g<v;g++){var x=p[g];!x||x===""||i.classes.add(x)}this.createEmitter(),(n===void 0||n)&&this.restore();var S=r.style||r.css;S&&(Jr("Setting a `style` bypass at element creation should be done only when absolutely necessary.  Try to use the stylesheet instead."),this.style(S))},JT=function(t){return t={bfs:t.bfs||!t.dfs,dfs:t.dfs||!t.bfs},function(n,a,i){var u;Ur(n)&&!$i(n)&&(u=n,n=u.roots||u.root,a=u.visit,i=u.directed),i=arguments.length===2&&!Nn(a)?a:i,a=Nn(a)?a:function(){};for(var s=this._private.cy,h=n=dr(n)?this.filter(n):n,p=[],g=[],v={},x={},S={},P=0,N,M=this.byGroup(),I=M.nodes,A=M.edges,D=0;D<h.length;D++){var j=h[D],V=j.id();j.isNode()&&(p.unshift(j),t.bfs&&(S[V]=!0,g.push(j)),x[V]=0)}for(var U=function(){var Y=t.bfs?p.shift():p.pop(),G=Y.id();if(t.dfs){if(S[G])return 0;S[G]=!0,g.push(Y)}var oe=x[G],ie=v[G],ce=ie!=null?ie.source():null,fe=ie!=null?ie.target():null,de=ie==null?void 0:Y.same(ce)?fe[0]:ce[0],be;if(be=a(Y,ie,de,P++,oe),be===!0)return N=Y,1;if(be===!1)return 1;for(var ge=Y.connectedEdges().filter(function(et){return(!i||et.source().same(Y))&&A.has(et)}),xe=0;xe<ge.length;xe++){var Le=ge[xe],Oe=Le.connectedNodes().filter(function(et){return!et.same(Y)&&I.has(et)}),Fe=Oe.id();Oe.length!==0&&!S[Fe]&&(Oe=Oe[0],p.push(Oe),t.bfs&&(S[Fe]=!0,g.push(Oe)),v[Fe]=Le,x[Fe]=x[G]+1)}},$;p.length!==0&&($=U(),!($!==0&&$===1)););for(var W=s.collection(),X=0;X<g.length;X++){var J=g[X],Z=v[J.id()];Z!=null&&W.push(Z),W.push(J)}return{path:s.collection(W),found:s.collection(N)}}},fm={breadthFirstSearch:JT({bfs:!0}),depthFirstSearch:JT({dfs:!0})};fm.bfs=fm.breadthFirstSearch;fm.dfs=fm.depthFirstSearch;var cy={exports:{}},B6=cy.exports,QT;function j6(){return QT||(QT=1,function(e,t){(function(){var r,n,a,i,u,s,h,p,g,v,x,S,P,N,M;a=Math.floor,v=Math.min,n=function(I,A){return I<A?-1:I>A?1:0},g=function(I,A,D,j,V){var U;if(D==null&&(D=0),V==null&&(V=n),D<0)throw new Error("lo must be non-negative");for(j==null&&(j=I.length);D<j;)U=a((D+j)/2),V(A,I[U])<0?j=U:D=U+1;return[].splice.apply(I,[D,D-D].concat(A)),A},s=function(I,A,D){return D==null&&(D=n),I.push(A),N(I,0,I.length-1,D)},u=function(I,A){var D,j;return A==null&&(A=n),D=I.pop(),I.length?(j=I[0],I[0]=D,M(I,0,A)):j=D,j},p=function(I,A,D){var j;return D==null&&(D=n),j=I[0],I[0]=A,M(I,0,D),j},h=function(I,A,D){var j;return D==null&&(D=n),I.length&&D(I[0],A)<0&&(j=[I[0],A],A=j[0],I[0]=j[1],M(I,0,D)),A},i=function(I,A){var D,j,V,U,$,W;for(A==null&&(A=n),U=(function(){W=[];for(var X=0,J=a(I.length/2);0<=J?X<J:X>J;0<=J?X++:X--)W.push(X);return W}).apply(this).reverse(),$=[],j=0,V=U.length;j<V;j++)D=U[j],$.push(M(I,D,A));return $},P=function(I,A,D){var j;if(D==null&&(D=n),j=I.indexOf(A),j!==-1)return N(I,0,j,D),M(I,j,D)},x=function(I,A,D){var j,V,U,$,W;if(D==null&&(D=n),V=I.slice(0,A),!V.length)return V;for(i(V,D),W=I.slice(A),U=0,$=W.length;U<$;U++)j=W[U],h(V,j,D);return V.sort(D).reverse()},S=function(I,A,D){var j,V,U,$,W,X,J,Z,K;if(D==null&&(D=n),A*10<=I.length){if(U=I.slice(0,A).sort(D),!U.length)return U;for(V=U[U.length-1],J=I.slice(A),$=0,X=J.length;$<X;$++)j=J[$],D(j,V)<0&&(g(U,j,0,null,D),U.pop(),V=U[U.length-1]);return U}for(i(I,D),K=[],W=0,Z=v(A,I.length);0<=Z?W<Z:W>Z;0<=Z?++W:--W)K.push(u(I,D));return K},N=function(I,A,D,j){var V,U,$;for(j==null&&(j=n),V=I[D];D>A;){if($=D-1>>1,U=I[$],j(V,U)<0){I[D]=U,D=$;continue}break}return I[D]=V},M=function(I,A,D){var j,V,U,$,W;for(D==null&&(D=n),V=I.length,W=A,U=I[A],j=2*A+1;j<V;)$=j+1,$<V&&!(D(I[j],I[$])<0)&&(j=$),I[A]=I[j],A=j,j=2*A+1;return I[A]=U,N(I,W,A,D)},r=function(){I.push=s,I.pop=u,I.replace=p,I.pushpop=h,I.heapify=i,I.updateItem=P,I.nlargest=x,I.nsmallest=S;function I(A){this.cmp=A??n,this.nodes=[]}return I.prototype.push=function(A){return s(this.nodes,A,this.cmp)},I.prototype.pop=function(){return u(this.nodes,this.cmp)},I.prototype.peek=function(){return this.nodes[0]},I.prototype.contains=function(A){return this.nodes.indexOf(A)!==-1},I.prototype.replace=function(A){return p(this.nodes,A,this.cmp)},I.prototype.pushpop=function(A){return h(this.nodes,A,this.cmp)},I.prototype.heapify=function(){return i(this.nodes,this.cmp)},I.prototype.updateItem=function(A){return P(this.nodes,A,this.cmp)},I.prototype.clear=function(){return this.nodes=[]},I.prototype.empty=function(){return this.nodes.length===0},I.prototype.size=function(){return this.nodes.length},I.prototype.clone=function(){var A;return A=new I,A.nodes=this.nodes.slice(0),A},I.prototype.toArray=function(){return this.nodes.slice(0)},I.prototype.insert=I.prototype.push,I.prototype.top=I.prototype.peek,I.prototype.front=I.prototype.peek,I.prototype.has=I.prototype.contains,I.prototype.copy=I.prototype.clone,I}(),function(I,A){return e.exports=A()}(this,function(){return r})}).call(B6)}(cy)),cy.exports}var w_,eP;function O6(){return eP||(eP=1,w_=j6()),w_}var F6=O6(),Gm=Vm(F6),$6=Pa({root:null,weight:function(t){return 1},directed:!1}),V6={dijkstra:function(t){if(!Ur(t)){var r=arguments;t={root:r[0],weight:r[1],directed:r[2]}}var n=$6(t),a=n.root,i=n.weight,u=n.directed,s=this,h=i,p=dr(a)?this.filter(a)[0]:a[0],g={},v={},x={},S=this.byGroup(),P=S.nodes,N=S.edges;N.unmergeBy(function(oe){return oe.isLoop()});for(var M=function(ie){return g[ie.id()]},I=function(ie,ce){g[ie.id()]=ce,A.updateItem(ie)},A=new Gm(function(oe,ie){return M(oe)-M(ie)}),D=0;D<P.length;D++){var j=P[D];g[j.id()]=j.same(p)?0:1/0,A.push(j)}for(var V=function(ie,ce){for(var fe=(u?ie.edgesTo(ce):ie.edgesWith(ce)).intersect(N),de=1/0,be,ge=0;ge<fe.length;ge++){var xe=fe[ge],Le=h(xe);(Le<de||!be)&&(de=Le,be=xe)}return{edge:be,dist:de}};A.size()>0;){var U=A.pop(),$=M(U),W=U.id();if(x[W]=$,$!==1/0)for(var X=U.neighborhood().intersect(P),J=0;J<X.length;J++){var Z=X[J],K=Z.id(),Y=V(U,Z),G=$+Y.dist;G<M(Z)&&(I(Z,G),v[K]={node:U,edge:Y.edge})}}return{distanceTo:function(ie){var ce=dr(ie)?P.filter(ie)[0]:ie[0];return x[ce.id()]},pathTo:function(ie){var ce=dr(ie)?P.filter(ie)[0]:ie[0],fe=[],de=ce,be=de.id();if(ce.length>0)for(fe.unshift(ce);v[be];){var ge=v[be];fe.unshift(ge.edge),fe.unshift(ge.node),de=ge.node,be=de.id()}return s.spawn(fe)}}}},U6={kruskal:function(t){t=t||function(D){return 1};for(var r=this.byGroup(),n=r.nodes,a=r.edges,i=n.length,u=new Array(i),s=n,h=function(j){for(var V=0;V<u.length;V++){var U=u[V];if(U.has(j))return V}},p=0;p<i;p++)u[p]=this.spawn(n[p]);for(var g=a.sort(function(D,j){return t(D)-t(j)}),v=0;v<g.length;v++){var x=g[v],S=x.source()[0],P=x.target()[0],N=h(S),M=h(P),I=u[N],A=u[M];N!==M&&(s.merge(x),I.merge(A),u.splice(M,1))}return s}},q6=Pa({root:null,goal:null,weight:function(t){return 1},heuristic:function(t){return 0},directed:!1}),H6={aStar:function(t){var r=this.cy(),n=q6(t),a=n.root,i=n.goal,u=n.heuristic,s=n.directed,h=n.weight;a=r.collection(a)[0],i=r.collection(i)[0];var p=a.id(),g=i.id(),v={},x={},S={},P=new Gm(function(be,ge){return x[be.id()]-x[ge.id()]}),N=new Fh,M={},I={},A=function(ge,xe){P.push(ge),N.add(xe)},D,j,V=function(){D=P.pop(),j=D.id(),N.delete(j)},U=function(ge){return N.has(ge)};A(a,p),v[p]=0,x[p]=u(a);for(var $=0;P.size()>0;){if(V(),$++,j===g){for(var W=[],X=i,J=g,Z=I[J];W.unshift(X),Z!=null&&W.unshift(Z),X=M[J],X!=null;)J=X.id(),Z=I[J];return{found:!0,distance:v[j],path:this.spawn(W),steps:$}}S[j]=!0;for(var K=D._private.edges,Y=0;Y<K.length;Y++){var G=K[Y];if(this.hasElementWithId(G.id())&&!(s&&G.data("source")!==j)){var oe=G.source(),ie=G.target(),ce=oe.id()!==j?oe:ie,fe=ce.id();if(this.hasElementWithId(fe)&&!S[fe]){var de=v[j]+h(G);if(!U(fe)){v[fe]=de,x[fe]=de+u(ce),A(ce,fe),M[fe]=D,I[fe]=G;continue}de<v[fe]&&(v[fe]=de,x[fe]=de+u(ce),M[fe]=D,I[fe]=G)}}}}return{found:!1,distance:void 0,path:void 0,steps:$}}},G6=Pa({weight:function(t){return 1},directed:!1}),W6={floydWarshall:function(t){for(var r=this.cy(),n=G6(t),a=n.weight,i=n.directed,u=a,s=this.byGroup(),h=s.nodes,p=s.edges,g=h.length,v=g*g,x=function(Le){return h.indexOf(Le)},S=function(Le){return h[Le]},P=new Array(v),N=0;N<v;N++){var M=N%g,I=(N-M)/g;I===M?P[N]=0:P[N]=1/0}for(var A=new Array(v),D=new Array(v),j=0;j<p.length;j++){var V=p[j],U=V.source()[0],$=V.target()[0];if(U!==$){var W=x(U),X=x($),J=W*g+X,Z=u(V);if(P[J]>Z&&(P[J]=Z,A[J]=X,D[J]=V),!i){var K=X*g+W;!i&&P[K]>Z&&(P[K]=Z,A[K]=W,D[K]=V)}}}for(var Y=0;Y<g;Y++)for(var G=0;G<g;G++)for(var oe=G*g+Y,ie=0;ie<g;ie++){var ce=G*g+ie,fe=Y*g+ie;P[oe]+P[fe]<P[ce]&&(P[ce]=P[oe]+P[fe],A[ce]=A[oe])}var de=function(Le){return(dr(Le)?r.filter(Le):Le)[0]},be=function(Le){return x(de(Le))},ge={distance:function(Le,Oe){var Fe=be(Le),et=be(Oe);return P[Fe*g+et]},path:function(Le,Oe){var Fe=be(Le),et=be(Oe),nt=S(Fe);if(Fe===et)return nt.collection();if(A[Fe*g+et]==null)return r.collection();var mt=r.collection(),it=Fe,ze;for(mt.merge(nt);Fe!==et;)it=Fe,Fe=A[Fe*g+et],ze=D[it*g+Fe],mt.merge(ze),mt.merge(S(Fe));return mt}};return ge}},Z6=Pa({weight:function(t){return 1},directed:!1,root:null}),X6={bellmanFord:function(t){var r=this,n=Z6(t),a=n.weight,i=n.directed,u=n.root,s=a,h=this,p=this.cy(),g=this.byGroup(),v=g.edges,x=g.nodes,S=x.length,P=new Ro,N=!1,M=[];u=p.collection(u)[0],v.unmergeBy(function(Xe){return Xe.isLoop()});for(var I=v.length,A=function(Pe){var Ye=P.get(Pe.id());return Ye||(Ye={},P.set(Pe.id(),Ye)),Ye},D=function(Pe){return(dr(Pe)?p.$(Pe):Pe)[0]},j=function(Pe){return A(D(Pe)).dist},V=function(Pe){for(var Ye=arguments.length>1&&arguments[1]!==void 0?arguments[1]:u,at=D(Pe),bt=[],Et=at;;){if(Et==null)return r.spawn();var Vt=A(Et),Bt=Vt.edge,Mt=Vt.pred;if(bt.unshift(Et[0]),Et.same(Ye)&&bt.length>0)break;Bt!=null&&bt.unshift(Bt),Et=Mt}return h.spawn(bt)},U=0;U<S;U++){var $=x[U],W=A($);$.same(u)?W.dist=0:W.dist=1/0,W.pred=null,W.edge=null}for(var X=!1,J=function(Pe,Ye,at,bt,Et,Vt){var Bt=bt.dist+Vt;Bt<Et.dist&&!at.same(bt.edge)&&(Et.dist=Bt,Et.pred=Pe,Et.edge=at,X=!0)},Z=1;Z<S;Z++){X=!1;for(var K=0;K<I;K++){var Y=v[K],G=Y.source(),oe=Y.target(),ie=s(Y),ce=A(G),fe=A(oe);J(G,oe,Y,ce,fe,ie),i||J(oe,G,Y,fe,ce,ie)}if(!X)break}if(X)for(var de=[],be=0;be<I;be++){var ge=v[be],xe=ge.source(),Le=ge.target(),Oe=s(ge),Fe=A(xe).dist,et=A(Le).dist;if(Fe+Oe<et||!i&&et+Oe<Fe)if(N||(Jr("Graph contains a negative weight cycle for Bellman-Ford"),N=!0),t.findNegativeWeightCycles!==!1){var nt=[];Fe+Oe<et&&nt.push(xe),!i&&et+Oe<Fe&&nt.push(Le);for(var mt=nt.length,it=0;it<mt;it++){var ze=nt[it],He=[ze];He.push(A(ze).edge);for(var We=A(ze).pred;He.indexOf(We)===-1;)He.push(We),He.push(A(We).edge),We=A(We).pred;He=He.slice(He.indexOf(We));for(var ot=He[0].id(),xt=0,Tt=2;Tt<He.length;Tt+=2)He[Tt].id()<ot&&(ot=He[Tt].id(),xt=Tt);He=He.slice(xt).concat(He.slice(0,xt)),He.push(He[0]);var $e=He.map(function(Xe){return Xe.id()}).join(",");de.indexOf($e)===-1&&(M.push(h.spawn(He)),de.push($e))}}else break}return{distanceTo:j,pathTo:V,hasNegativeWeightCycle:N,negativeWeightCycles:M}}},K6=Math.sqrt(2),Y6=function(t,r,n){n.length===0&&Tn("Karger-Stein must be run on a connected (sub)graph");for(var a=n[t],i=a[1],u=a[2],s=r[i],h=r[u],p=n,g=p.length-1;g>=0;g--){var v=p[g],x=v[1],S=v[2];(r[x]===s&&r[S]===h||r[x]===h&&r[S]===s)&&p.splice(g,1)}for(var P=0;P<p.length;P++){var N=p[P];N[1]===h?(p[P]=N.slice(),p[P][1]=s):N[2]===h&&(p[P]=N.slice(),p[P][2]=s)}for(var M=0;M<r.length;M++)r[M]===h&&(r[M]=s);return p},S_=function(t,r,n,a){for(;n>a;){var i=Math.floor(Math.random()*r.length);r=Y6(i,t,r),n--}return r},J6={kargerStein:function(){var t=this,r=this.byGroup(),n=r.nodes,a=r.edges;a.unmergeBy(function(fe){return fe.isLoop()});var i=n.length,u=a.length,s=Math.ceil(Math.pow(Math.log(i)/Math.LN2,2)),h=Math.floor(i/K6);if(i<2){Tn("At least 2 nodes are required for Karger-Stein algorithm");return}for(var p=[],g=0;g<u;g++){var v=a[g];p.push([g,n.indexOf(v.source()),n.indexOf(v.target())])}for(var x=1/0,S=[],P=new Array(i),N=new Array(i),M=new Array(i),I=function(de,be){for(var ge=0;ge<i;ge++)be[ge]=de[ge]},A=0;A<=s;A++){for(var D=0;D<i;D++)N[D]=D;var j=S_(N,p.slice(),i,h),V=j.slice();I(N,M);var U=S_(N,j,h,2),$=S_(M,V,h,2);U.length<=$.length&&U.length<x?(x=U.length,S=U,I(N,P)):$.length<=U.length&&$.length<x&&(x=$.length,S=$,I(M,P))}for(var W=this.spawn(S.map(function(fe){return a[fe[0]]})),X=this.spawn(),J=this.spawn(),Z=P[0],K=0;K<P.length;K++){var Y=P[K],G=n[K];Y===Z?X.merge(G):J.merge(G)}var oe=function(de){var be=t.spawn();return de.forEach(function(ge){be.merge(ge),ge.connectedEdges().forEach(function(xe){t.contains(xe)&&!W.contains(xe)&&be.merge(xe)})}),be},ie=[oe(X),oe(J)],ce={cut:W,components:ie,partition1:X,partition2:J};return ce}},E_,Q6=function(t){return{x:t.x,y:t.y}},G0=function(t,r,n){return{x:t.x*r+n.x,y:t.y*r+n.y}},vz=function(t,r,n){return{x:(t.x-n.x)/r,y:(t.y-n.y)/r}},rh=function(t){return{x:t[0],y:t[1]}},e$=function(t){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:t.length,a=1/0,i=r;i<n;i++){var u=t[i];isFinite(u)&&(a=Math.min(u,a))}return a},t$=function(t){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:t.length,a=-1/0,i=r;i<n;i++){var u=t[i];isFinite(u)&&(a=Math.max(u,a))}return a},r$=function(t){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:t.length,a=0,i=0,u=r;u<n;u++){var s=t[u];isFinite(s)&&(a+=s,i++)}return a/i},n$=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:t.length,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,u=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0;a?t=t.slice(r,n):(n<t.length&&t.splice(n,t.length-n),r>0&&t.splice(0,r));for(var s=0,h=t.length-1;h>=0;h--){var p=t[h];u?isFinite(p)||(t[h]=-1/0,s++):t.splice(h,1)}i&&t.sort(function(x,S){return x-S});var g=t.length,v=Math.floor(g/2);return g%2!==0?t[v+1+s]:(t[v-1+s]+t[v+s])/2},a$=function(t){return Math.PI*t/180},Cv=function(t,r){return Math.atan2(r,t)-Math.PI/2},HS=Math.log2||function(e){return Math.log(e)/Math.log(2)},GS=function(t){return t>0?1:t<0?-1:0},_c=function(t,r){return Math.sqrt(Yu(t,r))},Yu=function(t,r){var n=r.x-t.x,a=r.y-t.y;return n*n+a*a},i$=function(t){for(var r=t.length,n=0,a=0;a<r;a++)n+=t[a];for(var i=0;i<r;i++)t[i]=t[i]/n;return t},fa=function(t,r,n,a){return(1-a)*(1-a)*t+2*(1-a)*a*r+a*a*n},ph=function(t,r,n,a){return{x:fa(t.x,r.x,n.x,a),y:fa(t.y,r.y,n.y,a)}},s$=function(t,r,n,a){var i={x:r.x-t.x,y:r.y-t.y},u=_c(t,r),s={x:i.x/u,y:i.y/u};return n=n??0,a=a??n*u,{x:t.x+s.x*a,y:t.y+s.y*a}},pm=function(t,r,n){return Math.max(t,Math.min(n,r))},ni=function(t){if(t==null)return{x1:1/0,y1:1/0,x2:-1/0,y2:-1/0,w:0,h:0};if(t.x1!=null&&t.y1!=null){if(t.x2!=null&&t.y2!=null&&t.x2>=t.x1&&t.y2>=t.y1)return{x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,w:t.x2-t.x1,h:t.y2-t.y1};if(t.w!=null&&t.h!=null&&t.w>=0&&t.h>=0)return{x1:t.x1,y1:t.y1,x2:t.x1+t.w,y2:t.y1+t.h,w:t.w,h:t.h}}},o$=function(t){return{x1:t.x1,x2:t.x2,w:t.w,y1:t.y1,y2:t.y2,h:t.h}},l$=function(t){t.x1=1/0,t.y1=1/0,t.x2=-1/0,t.y2=-1/0,t.w=0,t.h=0},u$=function(t,r){t.x1=Math.min(t.x1,r.x1),t.x2=Math.max(t.x2,r.x2),t.w=t.x2-t.x1,t.y1=Math.min(t.y1,r.y1),t.y2=Math.max(t.y2,r.y2),t.h=t.y2-t.y1},yz=function(t,r,n){t.x1=Math.min(t.x1,r),t.x2=Math.max(t.x2,r),t.w=t.x2-t.x1,t.y1=Math.min(t.y1,n),t.y2=Math.max(t.y2,n),t.h=t.y2-t.y1},dy=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return t.x1-=r,t.x2+=r,t.y1-=r,t.y2+=r,t.w=t.x2-t.x1,t.h=t.y2-t.y1,t},hy=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0],n,a,i,u;if(r.length===1)n=a=i=u=r[0];else if(r.length===2)n=i=r[0],u=a=r[1];else if(r.length===4){var s=Hn(r,4);n=s[0],a=s[1],i=s[2],u=s[3]}return t.x1-=u,t.x2+=a,t.y1-=n,t.y2+=i,t.w=t.x2-t.x1,t.h=t.y2-t.y1,t},tP=function(t,r){t.x1=r.x1,t.y1=r.y1,t.x2=r.x2,t.y2=r.y2,t.w=t.x2-t.x1,t.h=t.y2-t.y1},WS=function(t,r){return!(t.x1>r.x2||r.x1>t.x2||t.x2<r.x1||r.x2<t.x1||t.y2<r.y1||r.y2<t.y1||t.y1>r.y2||r.y1>t.y2)},Ul=function(t,r,n){return t.x1<=r&&r<=t.x2&&t.y1<=n&&n<=t.y2},rP=function(t,r){return Ul(t,r.x,r.y)},xz=function(t,r){return Ul(t,r.x1,r.y1)&&Ul(t,r.x2,r.y2)},c$=(E_=Math.hypot)!==null&&E_!==void 0?E_:function(e,t){return Math.sqrt(e*e+t*t)};function d$(e,t){if(e.length<3)throw new Error("Need at least 3 vertices");var r=function(W,X){return{x:W.x+X.x,y:W.y+X.y}},n=function(W,X){return{x:W.x-X.x,y:W.y-X.y}},a=function(W,X){return{x:W.x*X,y:W.y*X}},i=function(W,X){return W.x*X.y-W.y*X.x},u=function(W){var X=c$(W.x,W.y);return X===0?{x:0,y:0}:{x:W.x/X,y:W.y/X}},s=function(W){for(var X=0,J=0;J<W.length;J++){var Z=W[J],K=W[(J+1)%W.length];X+=Z.x*K.y-K.x*Z.y}return X/2},h=function(W,X,J,Z){var K=n(X,W),Y=n(Z,J),G=i(K,Y);if(Math.abs(G)<1e-9)return r(W,a(K,.5));var oe=i(n(J,W),Y)/G;return r(W,a(K,oe))},p=e.map(function($){return{x:$.x,y:$.y}});s(p)<0&&p.reverse();for(var g=p.length,v=[],x=0;x<g;x++){var S=p[x],P=p[(x+1)%g],N=n(P,S),M=u({x:N.y,y:-N.x});v.push(M)}for(var I=v.map(function($,W){var X=r(p[W],a($,t)),J=r(p[(W+1)%g],a($,t));return{p1:X,p2:J}}),A=[],D=0;D<g;D++){var j=I[(D-1+g)%g],V=I[D],U=h(j.p1,j.p2,V.p1,V.p2);A.push(U)}return A}function h$(e,t,r,n,a,i){var u=_$(e,t,r,n,a),s=d$(u,i),h=ni();return s.forEach(function(p){return yz(h,p.x,p.y)}),h}var bz=function(t,r,n,a,i,u,s){var h=arguments.length>7&&arguments[7]!==void 0?arguments[7]:"auto",p=h==="auto"?ou(i,u):h,g=i/2,v=u/2;p=Math.min(p,g,v);var x=p!==g,S=p!==v,P;if(x){var N=n-g+p-s,M=a-v-s,I=n+g-p+s,A=M;if(P=ql(t,r,n,a,N,M,I,A,!1),P.length>0)return P}if(S){var D=n+g+s,j=a-v+p-s,V=D,U=a+v-p+s;if(P=ql(t,r,n,a,D,j,V,U,!1),P.length>0)return P}if(x){var $=n-g+p-s,W=a+v+s,X=n+g-p+s,J=W;if(P=ql(t,r,n,a,$,W,X,J,!1),P.length>0)return P}if(S){var Z=n-g-s,K=a-v+p-s,Y=Z,G=a+v-p+s;if(P=ql(t,r,n,a,Z,K,Y,G,!1),P.length>0)return P}var oe;{var ie=n-g+p,ce=a-v+p;if(oe=Cp(t,r,n,a,ie,ce,p+s),oe.length>0&&oe[0]<=ie&&oe[1]<=ce)return[oe[0],oe[1]]}{var fe=n+g-p,de=a-v+p;if(oe=Cp(t,r,n,a,fe,de,p+s),oe.length>0&&oe[0]>=fe&&oe[1]<=de)return[oe[0],oe[1]]}{var be=n+g-p,ge=a+v-p;if(oe=Cp(t,r,n,a,be,ge,p+s),oe.length>0&&oe[0]>=be&&oe[1]>=ge)return[oe[0],oe[1]]}{var xe=n-g+p,Le=a+v-p;if(oe=Cp(t,r,n,a,xe,Le,p+s),oe.length>0&&oe[0]<=xe&&oe[1]>=Le)return[oe[0],oe[1]]}return[]},f$=function(t,r,n,a,i,u,s){var h=s,p=Math.min(n,i),g=Math.max(n,i),v=Math.min(a,u),x=Math.max(a,u);return p-h<=t&&t<=g+h&&v-h<=r&&r<=x+h},p$=function(t,r,n,a,i,u,s,h,p){var g={x1:Math.min(n,s,i)-p,x2:Math.max(n,s,i)+p,y1:Math.min(a,h,u)-p,y2:Math.max(a,h,u)+p};return!(t<g.x1||t>g.x2||r<g.y1||r>g.y2)},m$=function(t,r,n,a){n-=a;var i=r*r-4*t*n;if(i<0)return[];var u=Math.sqrt(i),s=2*t,h=(-r+u)/s,p=(-r-u)/s;return[h,p]},g$=function(t,r,n,a,i){var u=1e-5;t===0&&(t=u),r/=t,n/=t,a/=t;var s,h,p,g,v,x,S,P;if(h=(3*n-r*r)/9,p=-(27*a)+r*(9*n-2*(r*r)),p/=54,s=h*h*h+p*p,i[1]=0,S=r/3,s>0){v=p+Math.sqrt(s),v=v<0?-Math.pow(-v,1/3):Math.pow(v,1/3),x=p-Math.sqrt(s),x=x<0?-Math.pow(-x,1/3):Math.pow(x,1/3),i[0]=-S+v+x,S+=(v+x)/2,i[4]=i[2]=-S,S=Math.sqrt(3)*(-x+v)/2,i[3]=S,i[5]=-S;return}if(i[5]=i[3]=0,s===0){P=p<0?-Math.pow(-p,1/3):Math.pow(p,1/3),i[0]=-S+2*P,i[4]=i[2]=-(P+S);return}h=-h,g=h*h*h,g=Math.acos(p/Math.sqrt(g)),P=2*Math.sqrt(h),i[0]=-S+P*Math.cos(g/3),i[2]=-S+P*Math.cos((g+2*Math.PI)/3),i[4]=-S+P*Math.cos((g+4*Math.PI)/3)},v$=function(t,r,n,a,i,u,s,h){var p=1*n*n-4*n*i+2*n*s+4*i*i-4*i*s+s*s+a*a-4*a*u+2*a*h+4*u*u-4*u*h+h*h,g=1*9*n*i-3*n*n-3*n*s-6*i*i+3*i*s+9*a*u-3*a*a-3*a*h-6*u*u+3*u*h,v=1*3*n*n-6*n*i+n*s-n*t+2*i*i+2*i*t-s*t+3*a*a-6*a*u+a*h-a*r+2*u*u+2*u*r-h*r,x=1*n*i-n*n+n*t-i*t+a*u-a*a+a*r-u*r,S=[];g$(p,g,v,x,S);for(var P=1e-7,N=[],M=0;M<6;M+=2)Math.abs(S[M+1])<P&&S[M]>=0&&S[M]<=1&&N.push(S[M]);N.push(1),N.push(0);for(var I=-1,A,D,j,V=0;V<N.length;V++)A=Math.pow(1-N[V],2)*n+2*(1-N[V])*N[V]*i+N[V]*N[V]*s,D=Math.pow(1-N[V],2)*a+2*(1-N[V])*N[V]*u+N[V]*N[V]*h,j=Math.pow(A-t,2)+Math.pow(D-r,2),I>=0?j<I&&(I=j):I=j;return I},y$=function(t,r,n,a,i,u){var s=[t-n,r-a],h=[i-n,u-a],p=h[0]*h[0]+h[1]*h[1],g=s[0]*s[0]+s[1]*s[1],v=s[0]*h[0]+s[1]*h[1],x=v*v/p;return v<0?g:x>p?(t-i)*(t-i)+(r-u)*(r-u):g-x},xi=function(t,r,n){for(var a,i,u,s,h,p=0,g=0;g<n.length/2;g++)if(a=n[g*2],i=n[g*2+1],g+1<n.length/2?(u=n[(g+1)*2],s=n[(g+1)*2+1]):(u=n[(g+1-n.length/2)*2],s=n[(g+1-n.length/2)*2+1]),!(a==t&&u==t))if(a>=t&&t>=u||a<=t&&t<=u)h=(t-a)/(u-a)*(s-i)+i,h>r&&p++;else continue;return p%2!==0},qo=function(t,r,n,a,i,u,s,h,p){var g=new Array(n.length),v;h[0]!=null?(v=Math.atan(h[1]/h[0]),h[0]<0?v=v+Math.PI/2:v=-v-Math.PI/2):v=h;for(var x=Math.cos(-v),S=Math.sin(-v),P=0;P<g.length/2;P++)g[P*2]=u/2*(n[P*2]*x-n[P*2+1]*S),g[P*2+1]=s/2*(n[P*2+1]*x+n[P*2]*S),g[P*2]+=a,g[P*2+1]+=i;var N;if(p>0){var M=n0(g,-p);N=r0(M)}else N=g;return xi(t,r,N)},x$=function(t,r,n,a,i,u,s,h){for(var p=new Array(n.length*2),g=0;g<h.length;g++){var v=h[g];p[g*4+0]=v.startX,p[g*4+1]=v.startY,p[g*4+2]=v.stopX,p[g*4+3]=v.stopY;var x=Math.pow(v.cx-t,2)+Math.pow(v.cy-r,2);if(x<=Math.pow(v.radius,2))return!0}return xi(t,r,p)},r0=function(t){for(var r=new Array(t.length/2),n,a,i,u,s,h,p,g,v=0;v<t.length/4;v++){n=t[v*4],a=t[v*4+1],i=t[v*4+2],u=t[v*4+3],v<t.length/4-1?(s=t[(v+1)*4],h=t[(v+1)*4+1],p=t[(v+1)*4+2],g=t[(v+1)*4+3]):(s=t[0],h=t[1],p=t[2],g=t[3]);var x=ql(n,a,i,u,s,h,p,g,!0);r[v*2]=x[0],r[v*2+1]=x[1]}return r},n0=function(t,r){for(var n=new Array(t.length*2),a,i,u,s,h=0;h<t.length/2;h++){a=t[h*2],i=t[h*2+1],h<t.length/2-1?(u=t[(h+1)*2],s=t[(h+1)*2+1]):(u=t[0],s=t[1]);var p=s-i,g=-(u-a),v=Math.sqrt(p*p+g*g),x=p/v,S=g/v;n[h*4]=a+x*r,n[h*4+1]=i+S*r,n[h*4+2]=u+x*r,n[h*4+3]=s+S*r}return n},b$=function(t,r,n,a,i,u){var s=n-t,h=a-r;s/=i,h/=u;var p=Math.sqrt(s*s+h*h),g=p-1;if(g<0)return[];var v=g/p;return[(n-t)*v+t,(a-r)*v+r]},oc=function(t,r,n,a,i,u,s){return t-=i,r-=u,t/=n/2+s,r/=a/2+s,t*t+r*r<=1},Cp=function(t,r,n,a,i,u,s){var h=[n-t,a-r],p=[t-i,r-u],g=h[0]*h[0]+h[1]*h[1],v=2*(p[0]*h[0]+p[1]*h[1]),x=p[0]*p[0]+p[1]*p[1]-s*s,S=v*v-4*g*x;if(S<0)return[];var P=(-v+Math.sqrt(S))/(2*g),N=(-v-Math.sqrt(S))/(2*g),M=Math.min(P,N),I=Math.max(P,N),A=[];if(M>=0&&M<=1&&A.push(M),I>=0&&I<=1&&A.push(I),A.length===0)return[];var D=A[0]*h[0]+t,j=A[0]*h[1]+r;if(A.length>1){if(A[0]==A[1])return[D,j];var V=A[1]*h[0]+t,U=A[1]*h[1]+r;return[D,j,V,U]}else return[D,j]},C_=function(t,r,n){return r<=t&&t<=n||n<=t&&t<=r?t:t<=r&&r<=n||n<=r&&r<=t?r:n},ql=function(t,r,n,a,i,u,s,h,p){var g=t-i,v=n-t,x=s-i,S=r-u,P=a-r,N=h-u,M=x*S-N*g,I=v*S-P*g,A=N*v-x*P;if(A!==0){var D=M/A,j=I/A,V=.001,U=0-V,$=1+V;return U<=D&&D<=$&&U<=j&&j<=$?[t+D*v,r+D*P]:p?[t+D*v,r+D*P]:[]}else return M===0||I===0?C_(t,n,s)===s?[s,h]:C_(t,n,i)===i?[i,u]:C_(i,s,n)===n?[n,a]:[]:[]},_$=function(t,r,n,a,i){var u=[],s=a/2,h=i/2,p=r,g=n;u.push({x:p+s*t[0],y:g+h*t[1]});for(var v=1;v<t.length/2;v++)u.push({x:p+s*t[v*2],y:g+h*t[v*2+1]});return u},mm=function(t,r,n,a,i,u,s,h){var p=[],g,v=new Array(n.length),x=!0;u==null&&(x=!1);var S;if(x){for(var P=0;P<v.length/2;P++)v[P*2]=n[P*2]*u+a,v[P*2+1]=n[P*2+1]*s+i;if(h>0){var N=n0(v,-h);S=r0(N)}else S=v}else S=n;for(var M,I,A,D,j=0;j<S.length/2;j++)M=S[j*2],I=S[j*2+1],j<S.length/2-1?(A=S[(j+1)*2],D=S[(j+1)*2+1]):(A=S[0],D=S[1]),g=ql(t,r,a,i,M,I,A,D),g.length!==0&&p.push(g[0],g[1]);return p},w$=function(t,r,n,a,i,u,s,h,p){var g=[],v,x=new Array(n.length*2);p.forEach(function(A,D){D===0?(x[x.length-2]=A.startX,x[x.length-1]=A.startY):(x[D*4-2]=A.startX,x[D*4-1]=A.startY),x[D*4]=A.stopX,x[D*4+1]=A.stopY,v=Cp(t,r,a,i,A.cx,A.cy,A.radius),v.length!==0&&g.push(v[0],v[1])});for(var S=0;S<x.length/4;S++)v=ql(t,r,a,i,x[S*4],x[S*4+1],x[S*4+2],x[S*4+3],!1),v.length!==0&&g.push(v[0],v[1]);if(g.length>2){for(var P=[g[0],g[1]],N=Math.pow(P[0]-t,2)+Math.pow(P[1]-r,2),M=1;M<g.length/2;M++){var I=Math.pow(g[M*2]-t,2)+Math.pow(g[M*2+1]-r,2);I<=N&&(P[0]=g[M*2],P[1]=g[M*2+1],N=I)}return P}return g},kv=function(t,r,n){var a=[t[0]-r[0],t[1]-r[1]],i=Math.sqrt(a[0]*a[0]+a[1]*a[1]),u=(i-n)/i;return u<0&&(u=1e-5),[r[0]+u*a[0],r[1]+u*a[1]]},ei=function(t,r){var n=J1(t,r);return n=_z(n),n},_z=function(t){for(var r,n,a=t.length/2,i=1/0,u=1/0,s=-1/0,h=-1/0,p=0;p<a;p++)r=t[2*p],n=t[2*p+1],i=Math.min(i,r),s=Math.max(s,r),u=Math.min(u,n),h=Math.max(h,n);for(var g=2/(s-i),v=2/(h-u),x=0;x<a;x++)r=t[2*x]=t[2*x]*g,n=t[2*x+1]=t[2*x+1]*v,i=Math.min(i,r),s=Math.max(s,r),u=Math.min(u,n),h=Math.max(h,n);if(u<-1)for(var S=0;S<a;S++)n=t[2*S+1]=t[2*S+1]+(-1-u);return t},J1=function(t,r){var n=1/t*2*Math.PI,a=t%2===0?Math.PI/2+n/2:Math.PI/2;a+=r;for(var i=new Array(t*2),u,s=0;s<t;s++)u=s*n+a,i[2*s]=Math.cos(u),i[2*s+1]=Math.sin(-u);return i},ou=function(t,r){return Math.min(t/4,r/4,8)},wz=function(t,r){return Math.min(t/10,r/10,8)},ZS=function(){return 8},S$=function(t,r,n){return[t-2*r+n,2*(r-t),t]},Q1=function(t,r){return{heightOffset:Math.min(15,.05*r),widthOffset:Math.min(100,.25*t),ctrlPtOffsetPct:.05}};function k_(e,t){function r(v){for(var x=[],S=0;S<v.length;S++){var P=v[S],N=v[(S+1)%v.length],M={x:N.x-P.x,y:N.y-P.y},I={x:-M.y,y:M.x},A=Math.sqrt(I.x*I.x+I.y*I.y);x.push({x:I.x/A,y:I.y/A})}return x}function n(v,x){var S=1/0,P=-1/0,N=wi(v),M;try{for(N.s();!(M=N.n()).done;){var I=M.value,A=I.x*x.x+I.y*x.y;S=Math.min(S,A),P=Math.max(P,A)}}catch(D){N.e(D)}finally{N.f()}return{min:S,max:P}}function a(v,x){return!(v.max<x.min||x.max<v.min)}var i=[].concat(Jy(r(e)),Jy(r(t))),u=wi(i),s;try{for(u.s();!(s=u.n()).done;){var h=s.value,p=n(e,h),g=n(t,h);if(!a(p,g))return!1}}catch(v){u.e(v)}finally{u.f()}return!0}var E$=Pa({dampingFactor:.8,precision:1e-6,iterations:200,weight:function(t){return 1}}),C$={pageRank:function(t){for(var r=E$(t),n=r.dampingFactor,a=r.precision,i=r.iterations,u=r.weight,s=this._private.cy,h=this.byGroup(),p=h.nodes,g=h.edges,v=p.length,x=v*v,S=g.length,P=new Array(x),N=new Array(v),M=(1-n)/v,I=0;I<v;I++){for(var A=0;A<v;A++){var D=I*v+A;P[D]=0}N[I]=0}for(var j=0;j<S;j++){var V=g[j],U=V.data("source"),$=V.data("target");if(U!==$){var W=p.indexOfId(U),X=p.indexOfId($),J=u(V),Z=X*v+W;P[Z]+=J,N[W]+=J}}for(var K=1/v+M,Y=0;Y<v;Y++)if(N[Y]===0)for(var G=0;G<v;G++){var oe=G*v+Y;P[oe]=K}else for(var ie=0;ie<v;ie++){var ce=ie*v+Y;P[ce]=P[ce]/N[Y]+M}for(var fe=new Array(v),de=new Array(v),be,ge=0;ge<v;ge++)fe[ge]=1;for(var xe=0;xe<i;xe++){for(var Le=0;Le<v;Le++)de[Le]=0;for(var Oe=0;Oe<v;Oe++)for(var Fe=0;Fe<v;Fe++){var et=Oe*v+Fe;de[Oe]+=P[et]*fe[Fe]}i$(de),be=fe,fe=de,de=be;for(var nt=0,mt=0;mt<v;mt++){var it=be[mt]-fe[mt];nt+=it*it}if(nt<a)break}var ze={rank:function(We){return We=s.collection(We)[0],fe[p.indexOf(We)]}};return ze}},nP=Pa({root:null,weight:function(t){return 1},directed:!1,alpha:0}),mh={degreeCentralityNormalized:function(t){t=nP(t);var r=this.cy(),n=this.nodes(),a=n.length;if(t.directed){for(var g={},v={},x=0,S=0,P=0;P<a;P++){var N=n[P],M=N.id();t.root=N;var I=this.degreeCentrality(t);x<I.indegree&&(x=I.indegree),S<I.outdegree&&(S=I.outdegree),g[M]=I.indegree,v[M]=I.outdegree}return{indegree:function(D){return x==0?0:(dr(D)&&(D=r.filter(D)),g[D.id()]/x)},outdegree:function(D){return S===0?0:(dr(D)&&(D=r.filter(D)),v[D.id()]/S)}}}else{for(var i={},u=0,s=0;s<a;s++){var h=n[s];t.root=h;var p=this.degreeCentrality(t);u<p.degree&&(u=p.degree),i[h.id()]=p.degree}return{degree:function(D){return u===0?0:(dr(D)&&(D=r.filter(D)),i[D.id()]/u)}}}},degreeCentrality:function(t){t=nP(t);var r=this.cy(),n=this,a=t,i=a.root,u=a.weight,s=a.directed,h=a.alpha;if(i=r.collection(i)[0],s){for(var S=i.connectedEdges(),P=S.filter(function(U){return U.target().same(i)&&n.has(U)}),N=S.filter(function(U){return U.source().same(i)&&n.has(U)}),M=P.length,I=N.length,A=0,D=0,j=0;j<P.length;j++)A+=u(P[j]);for(var V=0;V<N.length;V++)D+=u(N[V]);return{indegree:Math.pow(M,1-h)*Math.pow(A,h),outdegree:Math.pow(I,1-h)*Math.pow(D,h)}}else{for(var p=i.connectedEdges().intersection(n),g=p.length,v=0,x=0;x<p.length;x++)v+=u(p[x]);return{degree:Math.pow(g,1-h)*Math.pow(v,h)}}}};mh.dc=mh.degreeCentrality;mh.dcn=mh.degreeCentralityNormalised=mh.degreeCentralityNormalized;var aP=Pa({harmonic:!0,weight:function(){return 1},directed:!1,root:null}),gh={closenessCentralityNormalized:function(t){for(var r=aP(t),n=r.harmonic,a=r.weight,i=r.directed,u=this.cy(),s={},h=0,p=this.nodes(),g=this.floydWarshall({weight:a,directed:i}),v=0;v<p.length;v++){for(var x=0,S=p[v],P=0;P<p.length;P++)if(v!==P){var N=g.distance(S,p[P]);n?x+=1/N:x+=N}n||(x=1/x),h<x&&(h=x),s[S.id()]=x}return{closeness:function(I){return h==0?0:(dr(I)?I=u.filter(I)[0].id():I=I.id(),s[I]/h)}}},closenessCentrality:function(t){var r=aP(t),n=r.root,a=r.weight,i=r.directed,u=r.harmonic;n=this.filter(n)[0];for(var s=this.dijkstra({root:n,weight:a,directed:i}),h=0,p=this.nodes(),g=0;g<p.length;g++){var v=p[g];if(!v.same(n)){var x=s.distanceTo(v);u?h+=1/x:h+=x}}return u?h:1/h}};gh.cc=gh.closenessCentrality;gh.ccn=gh.closenessCentralityNormalised=gh.closenessCentralityNormalized;var k$=Pa({weight:null,directed:!1}),e2={betweennessCentrality:function(t){for(var r=k$(t),n=r.directed,a=r.weight,i=a!=null,u=this.cy(),s=this.nodes(),h={},p={},g=0,v={set:function(D,j){p[D]=j,j>g&&(g=j)},get:function(D){return p[D]}},x=0;x<s.length;x++){var S=s[x],P=S.id();n?h[P]=S.outgoers().nodes():h[P]=S.openNeighborhood().nodes(),v.set(P,0)}for(var N=function(){for(var D=s[M].id(),j=[],V={},U={},$={},W=new Gm(function(Oe,Fe){return $[Oe]-$[Fe]}),X=0;X<s.length;X++){var J=s[X].id();V[J]=[],U[J]=0,$[J]=1/0}for(U[D]=1,$[D]=0,W.push(D);!W.empty();){var Z=W.pop();if(j.push(Z),i)for(var K=0;K<h[Z].length;K++){var Y=h[Z][K],G=u.getElementById(Z),oe=void 0;G.edgesTo(Y).length>0?oe=G.edgesTo(Y)[0]:oe=Y.edgesTo(G)[0];var ie=a(oe);Y=Y.id(),$[Y]>$[Z]+ie&&($[Y]=$[Z]+ie,W.nodes.indexOf(Y)<0?W.push(Y):W.updateItem(Y),U[Y]=0,V[Y]=[]),$[Y]==$[Z]+ie&&(U[Y]=U[Y]+U[Z],V[Y].push(Z))}else for(var ce=0;ce<h[Z].length;ce++){var fe=h[Z][ce].id();$[fe]==1/0&&(W.push(fe),$[fe]=$[Z]+1),$[fe]==$[Z]+1&&(U[fe]=U[fe]+U[Z],V[fe].push(Z))}}for(var de={},be=0;be<s.length;be++)de[s[be].id()]=0;for(;j.length>0;){for(var ge=j.pop(),xe=0;xe<V[ge].length;xe++){var Le=V[ge][xe];de[Le]=de[Le]+U[Le]/U[ge]*(1+de[ge])}ge!=s[M].id()&&v.set(ge,v.get(ge)+de[ge])}},M=0;M<s.length;M++)N();var I={betweenness:function(D){var j=u.collection(D).id();return v.get(j)},betweennessNormalized:function(D){if(g==0)return 0;var j=u.collection(D).id();return v.get(j)/g}};return I.betweennessNormalised=I.betweennessNormalized,I}};e2.bc=e2.betweennessCentrality;var T$=Pa({expandFactor:2,inflateFactor:2,multFactor:1,maxIterations:20,attributes:[function(e){return 1}]}),P$=function(t){return T$(t)},I$=function(t,r){for(var n=0,a=0;a<r.length;a++)n+=r[a](t);return n},A$=function(t,r,n){for(var a=0;a<r;a++)t[a*r+a]=n},Sz=function(t,r){for(var n,a=0;a<r;a++){n=0;for(var i=0;i<r;i++)n+=t[i*r+a];for(var u=0;u<r;u++)t[u*r+a]=t[u*r+a]/n}},N$=function(t,r,n){for(var a=new Array(n*n),i=0;i<n;i++){for(var u=0;u<n;u++)a[i*n+u]=0;for(var s=0;s<n;s++)for(var h=0;h<n;h++)a[i*n+h]+=t[i*n+s]*r[s*n+h]}return a},M$=function(t,r,n){for(var a=t.slice(0),i=1;i<n;i++)t=N$(t,a,r);return t},D$=function(t,r,n){for(var a=new Array(r*r),i=0;i<r*r;i++)a[i]=Math.pow(t[i],n);return Sz(a,r),a},z$=function(t,r,n,a){for(var i=0;i<n;i++){var u=Math.round(t[i]*Math.pow(10,a))/Math.pow(10,a),s=Math.round(r[i]*Math.pow(10,a))/Math.pow(10,a);if(u!==s)return!1}return!0},R$=function(t,r,n,a){for(var i=[],u=0;u<r;u++){for(var s=[],h=0;h<r;h++)Math.round(t[u*r+h]*1e3)/1e3>0&&s.push(n[h]);s.length!==0&&i.push(a.collection(s))}return i},L$=function(t,r){for(var n=0;n<t.length;n++)if(!r[n]||t[n].id()!==r[n].id())return!1;return!0},B$=function(t){for(var r=0;r<t.length;r++)for(var n=0;n<t.length;n++)r!=n&&L$(t[r],t[n])&&t.splice(n,1);return t},iP=function(t){for(var r=this.nodes(),n=this.edges(),a=this.cy(),i=P$(t),u={},s=0;s<r.length;s++)u[r[s].id()]=s;for(var h=r.length,p=h*h,g=new Array(p),v,x=0;x<p;x++)g[x]=0;for(var S=0;S<n.length;S++){var P=n[S],N=u[P.source().id()],M=u[P.target().id()],I=I$(P,i.attributes);g[N*h+M]+=I,g[M*h+N]+=I}A$(g,h,i.multFactor),Sz(g,h);for(var A=!0,D=0;A&&D<i.maxIterations;)A=!1,v=M$(g,h,i.expandFactor),g=D$(v,h,i.inflateFactor),z$(g,v,p,4)||(A=!0),D++;var j=R$(g,h,r,a);return j=B$(j),j},j$={markovClustering:iP,mcl:iP},O$=function(t){return t},Ez=function(t,r){return Math.abs(r-t)},sP=function(t,r,n){return t+Ez(r,n)},oP=function(t,r,n){return t+Math.pow(n-r,2)},F$=function(t){return Math.sqrt(t)},$$=function(t,r,n){return Math.max(t,Ez(r,n))},lp=function(t,r,n,a,i){for(var u=arguments.length>5&&arguments[5]!==void 0?arguments[5]:O$,s=a,h,p,g=0;g<t;g++)h=r(g),p=n(g),s=i(s,h,p);return u(s)},Ah={euclidean:function(t,r,n){return t>=2?lp(t,r,n,0,oP,F$):lp(t,r,n,0,sP)},squaredEuclidean:function(t,r,n){return lp(t,r,n,0,oP)},manhattan:function(t,r,n){return lp(t,r,n,0,sP)},max:function(t,r,n){return lp(t,r,n,-1/0,$$)}};Ah["squared-euclidean"]=Ah.squaredEuclidean;Ah.squaredeuclidean=Ah.squaredEuclidean;function W0(e,t,r,n,a,i){var u;return Nn(e)?u=e:u=Ah[e]||Ah.euclidean,t===0&&Nn(e)?u(a,i):u(t,r,n,a,i)}var V$=Pa({k:2,m:2,sensitivityThreshold:1e-4,distance:"euclidean",maxIterations:10,attributes:[],testMode:!1,testCentroids:null}),XS=function(t){return V$(t)},a0=function(t,r,n,a,i){var u=i!=="kMedoids",s=u?function(v){return n[v]}:function(v){return a[v](n)},h=function(x){return a[x](r)},p=n,g=r;return W0(t,a.length,s,h,p,g)},T_=function(t,r,n){for(var a=n.length,i=new Array(a),u=new Array(a),s=new Array(r),h=null,p=0;p<a;p++)i[p]=t.min(n[p]).value,u[p]=t.max(n[p]).value;for(var g=0;g<r;g++){h=[];for(var v=0;v<a;v++)h[v]=Math.random()*(u[v]-i[v])+i[v];s[g]=h}return s},Cz=function(t,r,n,a,i){for(var u=1/0,s=0,h=0;h<r.length;h++){var p=a0(n,t,r[h],a,i);p<u&&(u=p,s=h)}return s},kz=function(t,r,n){for(var a=[],i=null,u=0;u<r.length;u++)i=r[u],n[i.id()]===t&&a.push(i);return a},U$=function(t,r,n){return Math.abs(r-t)<=n},q$=function(t,r,n){for(var a=0;a<t.length;a++)for(var i=0;i<t[a].length;i++){var u=Math.abs(t[a][i]-r[a][i]);if(u>n)return!1}return!0},H$=function(t,r,n){for(var a=0;a<n;a++)if(t===r[a])return!0;return!1},lP=function(t,r){var n=new Array(r);if(t.length<50)for(var a=0;a<r;a++){for(var i=t[Math.floor(Math.random()*t.length)];H$(i,n,a);)i=t[Math.floor(Math.random()*t.length)];n[a]=i}else for(var u=0;u<r;u++)n[u]=t[Math.floor(Math.random()*t.length)];return n},uP=function(t,r,n){for(var a=0,i=0;i<r.length;i++)a+=a0("manhattan",r[i],t,n,"kMedoids");return a},G$=function(t){var r=this.cy(),n=this.nodes(),a=null,i=XS(t),u=new Array(i.k),s={},h;i.testMode?typeof i.testCentroids=="number"?(i.testCentroids,h=T_(n,i.k,i.attributes)):ta(i.testCentroids)==="object"?h=i.testCentroids:h=T_(n,i.k,i.attributes):h=T_(n,i.k,i.attributes);for(var p=!0,g=0;p&&g<i.maxIterations;){for(var v=0;v<n.length;v++)a=n[v],s[a.id()]=Cz(a,h,i.distance,i.attributes,"kMeans");p=!1;for(var x=0;x<i.k;x++){var S=kz(x,n,s);if(S.length!==0){for(var P=i.attributes.length,N=h[x],M=new Array(P),I=new Array(P),A=0;A<P;A++){I[A]=0;for(var D=0;D<S.length;D++)a=S[D],I[A]+=i.attributes[A](a);M[A]=I[A]/S.length,U$(M[A],N[A],i.sensitivityThreshold)||(p=!0)}h[x]=M,u[x]=r.collection(S)}}g++}return u},W$=function(t){var r=this.cy(),n=this.nodes(),a=null,i=XS(t),u=new Array(i.k),s,h={},p,g=new Array(i.k);i.testMode?typeof i.testCentroids=="number"||(ta(i.testCentroids)==="object"?s=i.testCentroids:s=lP(n,i.k)):s=lP(n,i.k);for(var v=!0,x=0;v&&x<i.maxIterations;){for(var S=0;S<n.length;S++)a=n[S],h[a.id()]=Cz(a,s,i.distance,i.attributes,"kMedoids");v=!1;for(var P=0;P<s.length;P++){var N=kz(P,n,h);if(N.length!==0){g[P]=uP(s[P],N,i.attributes);for(var M=0;M<N.length;M++)p=uP(N[M],N,i.attributes),p<g[P]&&(g[P]=p,s[P]=N[M],v=!0);u[P]=r.collection(N)}}x++}return u},Z$=function(t,r,n,a,i){for(var u,s,h=0;h<r.length;h++)for(var p=0;p<t.length;p++)a[h][p]=Math.pow(n[h][p],i.m);for(var g=0;g<t.length;g++)for(var v=0;v<i.attributes.length;v++){u=0,s=0;for(var x=0;x<r.length;x++)u+=a[x][g]*i.attributes[v](r[x]),s+=a[x][g];t[g][v]=u/s}},X$=function(t,r,n,a,i){for(var u=0;u<t.length;u++)r[u]=t[u].slice();for(var s,h,p,g=2/(i.m-1),v=0;v<n.length;v++)for(var x=0;x<a.length;x++){s=0;for(var S=0;S<n.length;S++)h=a0(i.distance,a[x],n[v],i.attributes,"cmeans"),p=a0(i.distance,a[x],n[S],i.attributes,"cmeans"),s+=Math.pow(h/p,g);t[x][v]=1/s}},K$=function(t,r,n,a){for(var i=new Array(n.k),u=0;u<i.length;u++)i[u]=[];for(var s,h,p=0;p<r.length;p++){s=-1/0,h=-1;for(var g=0;g<r[0].length;g++)r[p][g]>s&&(s=r[p][g],h=g);i[h].push(t[p])}for(var v=0;v<i.length;v++)i[v]=a.collection(i[v]);return i},cP=function(t){var r=this.cy(),n=this.nodes(),a=XS(t),i,u,s,h,p;h=new Array(n.length);for(var g=0;g<n.length;g++)h[g]=new Array(a.k);s=new Array(n.length);for(var v=0;v<n.length;v++)s[v]=new Array(a.k);for(var x=0;x<n.length;x++){for(var S=0,P=0;P<a.k;P++)s[x][P]=Math.random(),S+=s[x][P];for(var N=0;N<a.k;N++)s[x][N]=s[x][N]/S}u=new Array(a.k);for(var M=0;M<a.k;M++)u[M]=new Array(a.attributes.length);p=new Array(n.length);for(var I=0;I<n.length;I++)p[I]=new Array(a.k);for(var A=!0,D=0;A&&D<a.maxIterations;)A=!1,Z$(u,n,s,p,a),X$(s,h,u,n,a),q$(s,h,a.sensitivityThreshold)||(A=!0),D++;return i=K$(n,s,a,r),{clusters:i,degreeOfMembership:s}},Y$={kMeans:G$,kMedoids:W$,fuzzyCMeans:cP,fcm:cP},J$=Pa({distance:"euclidean",linkage:"min",mode:"threshold",threshold:1/0,addDendrogram:!1,dendrogramDepth:0,attributes:[]}),Q$={single:"min",complete:"max"},eV=function(t){var r=J$(t),n=Q$[r.linkage];return n!=null&&(r.linkage=n),r},dP=function(t,r,n,a,i){for(var u=0,s=1/0,h,p=i.attributes,g=function(X,J){return W0(i.distance,p.length,function(Z){return p[Z](X)},function(Z){return p[Z](J)},X,J)},v=0;v<t.length;v++){var x=t[v].key,S=n[x][a[x]];S<s&&(u=x,s=S)}if(i.mode==="threshold"&&s>=i.threshold||i.mode==="dendrogram"&&t.length===1)return!1;var P=r[u],N=r[a[u]],M;i.mode==="dendrogram"?M={left:P,right:N,key:P.key}:M={value:P.value.concat(N.value),key:P.key},t[P.index]=M,t.splice(N.index,1),r[P.key]=M;for(var I=0;I<t.length;I++){var A=t[I];P.key===A.key?h=1/0:i.linkage==="min"?(h=n[P.key][A.key],n[P.key][A.key]>n[N.key][A.key]&&(h=n[N.key][A.key])):i.linkage==="max"?(h=n[P.key][A.key],n[P.key][A.key]<n[N.key][A.key]&&(h=n[N.key][A.key])):i.linkage==="mean"?h=(n[P.key][A.key]*P.size+n[N.key][A.key]*N.size)/(P.size+N.size):i.mode==="dendrogram"?h=g(A.value,P.value):h=g(A.value[0],P.value[0]),n[P.key][A.key]=n[A.key][P.key]=h}for(var D=0;D<t.length;D++){var j=t[D].key;if(a[j]===P.key||a[j]===N.key){for(var V=j,U=0;U<t.length;U++){var $=t[U].key;n[j][$]<n[j][V]&&(V=$)}a[j]=V}t[D].index=D}return P.key=N.key=P.index=N.index=null,!0},nh=function(t,r,n){t&&(t.value?r.push(t.value):(t.left&&nh(t.left,r),t.right&&nh(t.right,r)))},t2=function(t,r){if(!t)return"";if(t.left&&t.right){var n=t2(t.left,r),a=t2(t.right,r),i=r.add({group:"nodes",data:{id:n+","+a}});return r.add({group:"edges",data:{source:n,target:i.id()}}),r.add({group:"edges",data:{source:a,target:i.id()}}),i.id()}else if(t.value)return t.value.id()},r2=function(t,r,n){if(!t)return[];var a=[],i=[],u=[];return r===0?(t.left&&nh(t.left,a),t.right&&nh(t.right,i),u=a.concat(i),[n.collection(u)]):r===1?t.value?[n.collection(t.value)]:(t.left&&nh(t.left,a),t.right&&nh(t.right,i),[n.collection(a),n.collection(i)]):t.value?[n.collection(t.value)]:(t.left&&(a=r2(t.left,r-1,n)),t.right&&(i=r2(t.right,r-1,n)),a.concat(i))},hP=function(t){for(var r=this.cy(),n=this.nodes(),a=eV(t),i=a.attributes,u=function(D,j){return W0(a.distance,i.length,function(V){return i[V](D)},function(V){return i[V](j)},D,j)},s=[],h=[],p=[],g=[],v=0;v<n.length;v++){var x={value:a.mode==="dendrogram"?n[v]:[n[v]],key:v,index:v};s[v]=x,g[v]=x,h[v]=[],p[v]=0}for(var S=0;S<s.length;S++)for(var P=0;P<=S;P++){var N=void 0;a.mode==="dendrogram"?N=S===P?1/0:u(s[S].value,s[P].value):N=S===P?1/0:u(s[S].value[0],s[P].value[0]),h[S][P]=N,h[P][S]=N,N<h[S][p[S]]&&(p[S]=P)}for(var M=dP(s,g,h,p,a);M;)M=dP(s,g,h,p,a);var I;return a.mode==="dendrogram"?(I=r2(s[0],a.dendrogramDepth,r),a.addDendrogram&&t2(s[0],r)):(I=new Array(s.length),s.forEach(function(A,D){A.key=A.index=null,I[D]=r.collection(A.value)})),I},tV={hierarchicalClustering:hP,hca:hP},rV=Pa({distance:"euclidean",preference:"median",damping:.8,maxIterations:1e3,minIterations:100,attributes:[]}),nV=function(t){var r=t.damping,n=t.preference;.5<=r&&r<1||Tn("Damping must range on [0.5, 1).  Got: ".concat(r));var a=["median","mean","min","max"];return a.some(function(i){return i===n})||Ht(n)||Tn("Preference must be one of [".concat(a.map(function(i){return"'".concat(i,"'")}).join(", "),"] or a number.  Got: ").concat(n)),rV(t)},aV=function(t,r,n,a){var i=function(s,h){return a[h](s)};return-W0(t,a.length,function(u){return i(r,u)},function(u){return i(n,u)},r,n)},iV=function(t,r){var n=null;return r==="median"?n=n$(t):r==="mean"?n=r$(t):r==="min"?n=e$(t):r==="max"?n=t$(t):n=r,n},sV=function(t,r,n){for(var a=[],i=0;i<t;i++)r[i*t+i]+n[i*t+i]>0&&a.push(i);return a},fP=function(t,r,n){for(var a=[],i=0;i<t;i++){for(var u=-1,s=-1/0,h=0;h<n.length;h++){var p=n[h];r[i*t+p]>s&&(u=p,s=r[i*t+p])}u>0&&a.push(u)}for(var g=0;g<n.length;g++)a[n[g]]=n[g];return a},oV=function(t,r,n){for(var a=fP(t,r,n),i=0;i<n.length;i++){for(var u=[],s=0;s<a.length;s++)a[s]===n[i]&&u.push(s);for(var h=-1,p=-1/0,g=0;g<u.length;g++){for(var v=0,x=0;x<u.length;x++)v+=r[u[x]*t+u[g]];v>p&&(h=g,p=v)}n[i]=u[h]}return a=fP(t,r,n),a},pP=function(t){for(var r=this.cy(),n=this.nodes(),a=nV(t),i={},u=0;u<n.length;u++)i[n[u].id()]=u;var s,h,p,g,v,x;s=n.length,h=s*s,p=new Array(h);for(var S=0;S<h;S++)p[S]=-1/0;for(var P=0;P<s;P++)for(var N=0;N<s;N++)P!==N&&(p[P*s+N]=aV(a.distance,n[P],n[N],a.attributes));g=iV(p,a.preference);for(var M=0;M<s;M++)p[M*s+M]=g;v=new Array(h);for(var I=0;I<h;I++)v[I]=0;x=new Array(h);for(var A=0;A<h;A++)x[A]=0;for(var D=new Array(s),j=new Array(s),V=new Array(s),U=0;U<s;U++)D[U]=0,j[U]=0,V[U]=0;for(var $=new Array(s*a.minIterations),W=0;W<$.length;W++)$[W]=0;var X;for(X=0;X<a.maxIterations;X++){for(var J=0;J<s;J++){for(var Z=-1/0,K=-1/0,Y=-1,G=0,oe=0;oe<s;oe++)D[oe]=v[J*s+oe],G=x[J*s+oe]+p[J*s+oe],G>=Z?(K=Z,Z=G,Y=oe):G>K&&(K=G);for(var ie=0;ie<s;ie++)v[J*s+ie]=(1-a.damping)*(p[J*s+ie]-Z)+a.damping*D[ie];v[J*s+Y]=(1-a.damping)*(p[J*s+Y]-K)+a.damping*D[Y]}for(var ce=0;ce<s;ce++){for(var fe=0,de=0;de<s;de++)D[de]=x[de*s+ce],j[de]=Math.max(0,v[de*s+ce]),fe+=j[de];fe-=j[ce],j[ce]=v[ce*s+ce],fe+=j[ce];for(var be=0;be<s;be++)x[be*s+ce]=(1-a.damping)*Math.min(0,fe-j[be])+a.damping*D[be];x[ce*s+ce]=(1-a.damping)*(fe-j[ce])+a.damping*D[ce]}for(var ge=0,xe=0;xe<s;xe++){var Le=x[xe*s+xe]+v[xe*s+xe]>0?1:0;$[X%a.minIterations*s+xe]=Le,ge+=Le}if(ge>0&&(X>=a.minIterations-1||X==a.maxIterations-1)){for(var Oe=0,Fe=0;Fe<s;Fe++){V[Fe]=0;for(var et=0;et<a.minIterations;et++)V[Fe]+=$[et*s+Fe];(V[Fe]===0||V[Fe]===a.minIterations)&&Oe++}if(Oe===s)break}}for(var nt=sV(s,v,x),mt=oV(s,p,nt),it={},ze=0;ze<nt.length;ze++)it[nt[ze]]=[];for(var He=0;He<n.length;He++){var We=i[n[He].id()],ot=mt[We];ot!=null&&it[ot].push(n[He])}for(var xt=new Array(nt.length),Tt=0;Tt<nt.length;Tt++)xt[Tt]=r.collection(it[nt[Tt]]);return xt},lV={affinityPropagation:pP,ap:pP},uV=Pa({root:void 0,directed:!1}),cV={hierholzer:function(t){if(!Ur(t)){var r=arguments;t={root:r[0],directed:r[1]}}var n=uV(t),a=n.root,i=n.directed,u=this,s=!1,h,p,g;a&&(g=dr(a)?this.filter(a)[0].id():a[0].id());var v={},x={};i?u.forEach(function(A){var D=A.id();if(A.isNode()){var j=A.indegree(!0),V=A.outdegree(!0),U=j-V,$=V-j;U==1?h?s=!0:h=D:$==1?p?s=!0:p=D:($>1||U>1)&&(s=!0),v[D]=[],A.outgoers().forEach(function(W){W.isEdge()&&v[D].push(W.id())})}else x[D]=[void 0,A.target().id()]}):u.forEach(function(A){var D=A.id();if(A.isNode()){var j=A.degree(!0);j%2&&(h?p?s=!0:p=D:h=D),v[D]=[],A.connectedEdges().forEach(function(V){return v[D].push(V.id())})}else x[D]=[A.source().id(),A.target().id()]});var S={found:!1,trail:void 0};if(s)return S;if(p&&h)if(i){if(g&&p!=g)return S;g=p}else{if(g&&p!=g&&h!=g)return S;g||(g=p)}else g||(g=u[0].id());var P=function(D){for(var j=D,V=[D],U,$,W;v[j].length;)U=v[j].shift(),$=x[U][0],W=x[U][1],j!=W?(v[W]=v[W].filter(function(X){return X!=U}),j=W):!i&&j!=$&&(v[$]=v[$].filter(function(X){return X!=U}),j=$),V.unshift(U),V.unshift(j);return V},N=[],M=[];for(M=P(g);M.length!=1;)v[M[0]].length==0?(N.unshift(u.getElementById(M.shift())),N.unshift(u.getElementById(M.shift()))):M=P(M.shift()).concat(M);N.unshift(u.getElementById(M.shift()));for(var I in v)if(v[I].length)return S;return S.found=!0,S.trail=this.spawn(N,!0),S}},Tv=function(){var t=this,r={},n=0,a=0,i=[],u=[],s={},h=function(x,S){for(var P=u.length-1,N=[],M=t.spawn();u[P].x!=x||u[P].y!=S;)N.push(u.pop().edge),P--;N.push(u.pop().edge),N.forEach(function(I){var A=I.connectedNodes().intersection(t);M.merge(I),A.forEach(function(D){var j=D.id(),V=D.connectedEdges().intersection(t);M.merge(D),r[j].cutVertex?M.merge(V.filter(function(U){return U.isLoop()})):M.merge(V)})}),i.push(M)},p=function(x,S,P){x===P&&(a+=1),r[S]={id:n,low:n++,cutVertex:!1};var N=t.getElementById(S).connectedEdges().intersection(t);if(N.size()===0)i.push(t.spawn(t.getElementById(S)));else{var M,I,A,D;N.forEach(function(j){M=j.source().id(),I=j.target().id(),A=M===S?I:M,A!==P&&(D=j.id(),s[D]||(s[D]=!0,u.push({x:S,y:A,edge:j})),A in r?r[S].low=Math.min(r[S].low,r[A].id):(p(x,A,S),r[S].low=Math.min(r[S].low,r[A].low),r[S].id<=r[A].low&&(r[S].cutVertex=!0,h(S,A))))})}};t.forEach(function(v){if(v.isNode()){var x=v.id();x in r||(a=0,p(x,x),r[x].cutVertex=a>1)}});var g=Object.keys(r).filter(function(v){return r[v].cutVertex}).map(function(v){return t.getElementById(v)});return{cut:t.spawn(g),components:i}},dV={hopcroftTarjanBiconnected:Tv,htbc:Tv,htb:Tv,hopcroftTarjanBiconnectedComponents:Tv},Pv=function(){var t=this,r={},n=0,a=[],i=[],u=t.spawn(t),s=function(p){i.push(p),r[p]={index:n,low:n++,explored:!1};var g=t.getElementById(p).connectedEdges().intersection(t);if(g.forEach(function(N){var M=N.target().id();M!==p&&(M in r||s(M),r[M].explored||(r[p].low=Math.min(r[p].low,r[M].low)))}),r[p].index===r[p].low){for(var v=t.spawn();;){var x=i.pop();if(v.merge(t.getElementById(x)),r[x].low=r[p].index,r[x].explored=!0,x===p)break}var S=v.edgesWith(v),P=v.merge(S);a.push(P),u=u.difference(P)}};return t.forEach(function(h){if(h.isNode()){var p=h.id();p in r||s(p)}}),{cut:u,components:a}},hV={tarjanStronglyConnected:Pv,tsc:Pv,tscc:Pv,tarjanStronglyConnectedComponents:Pv},Tz={};[fm,V6,U6,H6,W6,X6,J6,C$,mh,gh,e2,j$,Y$,tV,lV,cV,dV,hV].forEach(function(e){xr(Tz,e)});/*!
Embeddable Minimum Strictly-Compliant Promises/A+ 1.1.1 Thenable
Copyright (c) 2013-2014 Ralf S. Engelschall (http://engelschall.com)
Licensed under The MIT License (http://opensource.org/licenses/MIT)
*/var Pz=0,Iz=1,Az=2,Bs=function(t){if(!(this instanceof Bs))return new Bs(t);this.id="Thenable/1.0.7",this.state=Pz,this.fulfillValue=void 0,this.rejectReason=void 0,this.onFulfilled=[],this.onRejected=[],this.proxy={then:this.then.bind(this)},typeof t=="function"&&t.call(this,this.fulfill.bind(this),this.reject.bind(this))};Bs.prototype={fulfill:function(t){return mP(this,Iz,"fulfillValue",t)},reject:function(t){return mP(this,Az,"rejectReason",t)},then:function(t,r){var n=this,a=new Bs;return n.onFulfilled.push(vP(t,a,"fulfill")),n.onRejected.push(vP(r,a,"reject")),Nz(n),a.proxy}};var mP=function(t,r,n,a){return t.state===Pz&&(t.state=r,t[n]=a,Nz(t)),t},Nz=function(t){t.state===Iz?gP(t,"onFulfilled",t.fulfillValue):t.state===Az&&gP(t,"onRejected",t.rejectReason)},gP=function(t,r,n){if(t[r].length!==0){var a=t[r];t[r]=[];var i=function(){for(var s=0;s<a.length;s++)a[s](n)};typeof setImmediate=="function"?setImmediate(i):setTimeout(i,0)}},vP=function(t,r,n){return function(a){if(typeof t!="function")r[n].call(r,a);else{var i;try{i=t(a)}catch(u){r.reject(u);return}Mz(r,i)}}},Mz=function(t,r){if(t===r||t.proxy===r){t.reject(new TypeError("cannot resolve promise with itself"));return}var n;if(ta(r)==="object"&&r!==null||typeof r=="function")try{n=r.then}catch(i){t.reject(i);return}if(typeof n=="function"){var a=!1;try{n.call(r,function(i){a||(a=!0,i===r?t.reject(new TypeError("circular thenable chain")):Mz(t,i))},function(i){a||(a=!0,t.reject(i))})}catch(i){a||t.reject(i)}return}t.fulfill(r)};Bs.all=function(e){return new Bs(function(t,r){for(var n=new Array(e.length),a=0,i=function(h,p){n[h]=p,a++,a===e.length&&t(n)},u=0;u<e.length;u++)(function(s){var h=e[s],p=h!=null&&h.then!=null;if(p)h.then(function(v){i(s,v)},function(v){r(v)});else{var g=h;i(s,g)}})(u)})};Bs.resolve=function(e){return new Bs(function(t,r){t(e)})};Bs.reject=function(e){return new Bs(function(t,r){r(e)})};var $h=typeof Promise<"u"?Promise:Bs,n2=function(t,r,n){var a=OS(t),i=!a,u=this._private=xr({duration:1e3},r,n);if(u.target=t,u.style=u.style||u.css,u.started=!1,u.playing=!1,u.hooked=!1,u.applying=!1,u.progress=0,u.completes=[],u.frames=[],u.complete&&Nn(u.complete)&&u.completes.push(u.complete),i){var s=t.position();u.startPosition=u.startPosition||{x:s.x,y:s.y},u.startStyle=u.startStyle||t.cy().style().getAnimationStartStyle(t,u.style)}if(a){var h=t.pan();u.startPan={x:h.x,y:h.y},u.startZoom=t.zoom()}this.length=1,this[0]=this},wc=n2.prototype;xr(wc,{instanceString:function(){return"animation"},hook:function(){var t=this._private;if(!t.hooked){var r,n=t.target._private.animation;t.queue?r=n.queue:r=n.current,r.push(this),$i(t.target)&&t.target.cy().addToAnimationPool(t.target),t.hooked=!0}return this},play:function(){var t=this._private;return t.progress===1&&(t.progress=0),t.playing=!0,t.started=!1,t.stopped=!1,this.hook(),this},playing:function(){return this._private.playing},apply:function(){var t=this._private;return t.applying=!0,t.started=!1,t.stopped=!1,this.hook(),this},applying:function(){return this._private.applying},pause:function(){var t=this._private;return t.playing=!1,t.started=!1,this},stop:function(){var t=this._private;return t.playing=!1,t.started=!1,t.stopped=!0,this},rewind:function(){return this.progress(0)},fastforward:function(){return this.progress(1)},time:function(t){var r=this._private;return t===void 0?r.progress*r.duration:this.progress(t/r.duration)},progress:function(t){var r=this._private,n=r.playing;return t===void 0?r.progress:(n&&this.pause(),r.progress=t,r.started=!1,n&&this.play(),this)},completed:function(){return this._private.progress===1},reverse:function(){var t=this._private,r=t.playing;r&&this.pause(),t.progress=1-t.progress,t.started=!1;var n=function(p,g){var v=t[p];v!=null&&(t[p]=t[g],t[g]=v)};if(n("zoom","startZoom"),n("pan","startPan"),n("position","startPosition"),t.style)for(var a=0;a<t.style.length;a++){var i=t.style[a],u=i.name,s=t.startStyle[u];t.startStyle[u]=i,t.style[a]=s}return r&&this.play(),this},promise:function(t){var r=this._private,n;switch(t){case"frame":n=r.frames;break;default:case"complete":case"completed":n=r.completes}return new $h(function(a,i){n.push(function(){a()})})}});wc.complete=wc.completed;wc.run=wc.play;wc.running=wc.playing;var fV={animated:function(){return function(){var r=this,n=r.length!==void 0,a=n?r:[r],i=this._private.cy||this;if(!i.styleEnabled())return!1;var u=a[0];if(u)return u._private.animation.current.length>0}},clearQueue:function(){return function(){var r=this,n=r.length!==void 0,a=n?r:[r],i=this._private.cy||this;if(!i.styleEnabled())return this;for(var u=0;u<a.length;u++){var s=a[u];s._private.animation.queue=[]}return this}},delay:function(){return function(r,n){var a=this._private.cy||this;return a.styleEnabled()?this.animate({delay:r,duration:r,complete:n}):this}},delayAnimation:function(){return function(r,n){var a=this._private.cy||this;return a.styleEnabled()?this.animation({delay:r,duration:r,complete:n}):this}},animation:function(){return function(r,n){var a=this,i=a.length!==void 0,u=i?a:[a],s=this._private.cy||this,h=!i,p=!h;if(!s.styleEnabled())return this;var g=s.style();r=xr({},r,n);var v=Object.keys(r).length===0;if(v)return new n2(u[0],r);switch(r.duration===void 0&&(r.duration=400),r.duration){case"slow":r.duration=600;break;case"fast":r.duration=200;break}if(p&&(r.style=g.getPropsList(r.style||r.css),r.css=void 0),p&&r.renderedPosition!=null){var x=r.renderedPosition,S=s.pan(),P=s.zoom();r.position=vz(x,P,S)}if(h&&r.panBy!=null){var N=r.panBy,M=s.pan();r.pan={x:M.x+N.x,y:M.y+N.y}}var I=r.center||r.centre;if(h&&I!=null){var A=s.getCenterPan(I.eles,r.zoom);A!=null&&(r.pan=A)}if(h&&r.fit!=null){var D=r.fit,j=s.getFitViewport(D.eles||D.boundingBox,D.padding);j!=null&&(r.pan=j.pan,r.zoom=j.zoom)}if(h&&Ur(r.zoom)){var V=s.getZoomedViewport(r.zoom);V!=null?(V.zoomed&&(r.zoom=V.zoom),V.panned&&(r.pan=V.pan)):r.zoom=null}return new n2(u[0],r)}},animate:function(){return function(r,n){var a=this,i=a.length!==void 0,u=i?a:[a],s=this._private.cy||this;if(!s.styleEnabled())return this;n&&(r=xr({},r,n));for(var h=0;h<u.length;h++){var p=u[h],g=p.animated()&&(r.queue===void 0||r.queue),v=p.animation(r,g?{queue:!0}:void 0);v.play()}return this}},stop:function(){return function(r,n){var a=this,i=a.length!==void 0,u=i?a:[a],s=this._private.cy||this;if(!s.styleEnabled())return this;for(var h=0;h<u.length;h++){for(var p=u[h],g=p._private,v=g.animation.current,x=0;x<v.length;x++){var S=v[x],P=S._private;n&&(P.duration=0)}r&&(g.animation.queue=[]),n||(g.animation.current=[])}return s.notify("draw"),this}}},P_,yP;function Z0(){if(yP)return P_;yP=1;var e=Array.isArray;return P_=e,P_}var I_,xP;function pV(){if(xP)return I_;xP=1;var e=Z0(),t=qm(),r=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,n=/^\w*$/;function a(i,u){if(e(i))return!1;var s=typeof i;return s=="number"||s=="symbol"||s=="boolean"||i==null||t(i)?!0:n.test(i)||!r.test(i)||u!=null&&i in Object(u)}return I_=a,I_}var A_,bP;function mV(){if(bP)return A_;bP=1;var e=lz(),t=Um(),r="[object AsyncFunction]",n="[object Function]",a="[object GeneratorFunction]",i="[object Proxy]";function u(s){if(!t(s))return!1;var h=e(s);return h==n||h==a||h==r||h==i}return A_=u,A_}var N_,_P;function gV(){if(_P)return N_;_P=1;var e=q0(),t=e["__core-js_shared__"];return N_=t,N_}var M_,wP;function vV(){if(wP)return M_;wP=1;var e=gV(),t=function(){var n=/[^.]+$/.exec(e&&e.keys&&e.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}();function r(n){return!!t&&t in n}return M_=r,M_}var D_,SP;function yV(){if(SP)return D_;SP=1;var e=Function.prototype,t=e.toString;function r(n){if(n!=null){try{return t.call(n)}catch{}try{return n+""}catch{}}return""}return D_=r,D_}var z_,EP;function xV(){if(EP)return z_;EP=1;var e=mV(),t=vV(),r=Um(),n=yV(),a=/[\\^$.*+?()[\]{}|]/g,i=/^\[object .+?Constructor\]$/,u=Function.prototype,s=Object.prototype,h=u.toString,p=s.hasOwnProperty,g=RegExp("^"+h.call(p).replace(a,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function v(x){if(!r(x)||t(x))return!1;var S=e(x)?g:i;return S.test(n(x))}return z_=v,z_}var R_,CP;function bV(){if(CP)return R_;CP=1;function e(t,r){return t==null?void 0:t[r]}return R_=e,R_}var L_,kP;function KS(){if(kP)return L_;kP=1;var e=xV(),t=bV();function r(n,a){var i=t(n,a);return e(i)?i:void 0}return L_=r,L_}var B_,TP;function X0(){if(TP)return B_;TP=1;var e=KS(),t=e(Object,"create");return B_=t,B_}var j_,PP;function _V(){if(PP)return j_;PP=1;var e=X0();function t(){this.__data__=e?e(null):{},this.size=0}return j_=t,j_}var O_,IP;function wV(){if(IP)return O_;IP=1;function e(t){var r=this.has(t)&&delete this.__data__[t];return this.size-=r?1:0,r}return O_=e,O_}var F_,AP;function SV(){if(AP)return F_;AP=1;var e=X0(),t="__lodash_hash_undefined__",r=Object.prototype,n=r.hasOwnProperty;function a(i){var u=this.__data__;if(e){var s=u[i];return s===t?void 0:s}return n.call(u,i)?u[i]:void 0}return F_=a,F_}var $_,NP;function EV(){if(NP)return $_;NP=1;var e=X0(),t=Object.prototype,r=t.hasOwnProperty;function n(a){var i=this.__data__;return e?i[a]!==void 0:r.call(i,a)}return $_=n,$_}var V_,MP;function CV(){if(MP)return V_;MP=1;var e=X0(),t="__lodash_hash_undefined__";function r(n,a){var i=this.__data__;return this.size+=this.has(n)?0:1,i[n]=e&&a===void 0?t:a,this}return V_=r,V_}var U_,DP;function kV(){if(DP)return U_;DP=1;var e=_V(),t=wV(),r=SV(),n=EV(),a=CV();function i(u){var s=-1,h=u==null?0:u.length;for(this.clear();++s<h;){var p=u[s];this.set(p[0],p[1])}}return i.prototype.clear=e,i.prototype.delete=t,i.prototype.get=r,i.prototype.has=n,i.prototype.set=a,U_=i,U_}var q_,zP;function TV(){if(zP)return q_;zP=1;function e(){this.__data__=[],this.size=0}return q_=e,q_}var H_,RP;function Dz(){if(RP)return H_;RP=1;function e(t,r){return t===r||t!==t&&r!==r}return H_=e,H_}var G_,LP;function K0(){if(LP)return G_;LP=1;var e=Dz();function t(r,n){for(var a=r.length;a--;)if(e(r[a][0],n))return a;return-1}return G_=t,G_}var W_,BP;function PV(){if(BP)return W_;BP=1;var e=K0(),t=Array.prototype,r=t.splice;function n(a){var i=this.__data__,u=e(i,a);if(u<0)return!1;var s=i.length-1;return u==s?i.pop():r.call(i,u,1),--this.size,!0}return W_=n,W_}var Z_,jP;function IV(){if(jP)return Z_;jP=1;var e=K0();function t(r){var n=this.__data__,a=e(n,r);return a<0?void 0:n[a][1]}return Z_=t,Z_}var X_,OP;function AV(){if(OP)return X_;OP=1;var e=K0();function t(r){return e(this.__data__,r)>-1}return X_=t,X_}var K_,FP;function NV(){if(FP)return K_;FP=1;var e=K0();function t(r,n){var a=this.__data__,i=e(a,r);return i<0?(++this.size,a.push([r,n])):a[i][1]=n,this}return K_=t,K_}var Y_,$P;function MV(){if($P)return Y_;$P=1;var e=TV(),t=PV(),r=IV(),n=AV(),a=NV();function i(u){var s=-1,h=u==null?0:u.length;for(this.clear();++s<h;){var p=u[s];this.set(p[0],p[1])}}return i.prototype.clear=e,i.prototype.delete=t,i.prototype.get=r,i.prototype.has=n,i.prototype.set=a,Y_=i,Y_}var J_,VP;function DV(){if(VP)return J_;VP=1;var e=KS(),t=q0(),r=e(t,"Map");return J_=r,J_}var Q_,UP;function zV(){if(UP)return Q_;UP=1;var e=kV(),t=MV(),r=DV();function n(){this.size=0,this.__data__={hash:new e,map:new(r||t),string:new e}}return Q_=n,Q_}var ew,qP;function RV(){if(qP)return ew;qP=1;function e(t){var r=typeof t;return r=="string"||r=="number"||r=="symbol"||r=="boolean"?t!=="__proto__":t===null}return ew=e,ew}var tw,HP;function Y0(){if(HP)return tw;HP=1;var e=RV();function t(r,n){var a=r.__data__;return e(n)?a[typeof n=="string"?"string":"hash"]:a.map}return tw=t,tw}var rw,GP;function LV(){if(GP)return rw;GP=1;var e=Y0();function t(r){var n=e(this,r).delete(r);return this.size-=n?1:0,n}return rw=t,rw}var nw,WP;function BV(){if(WP)return nw;WP=1;var e=Y0();function t(r){return e(this,r).get(r)}return nw=t,nw}var aw,ZP;function jV(){if(ZP)return aw;ZP=1;var e=Y0();function t(r){return e(this,r).has(r)}return aw=t,aw}var iw,XP;function OV(){if(XP)return iw;XP=1;var e=Y0();function t(r,n){var a=e(this,r),i=a.size;return a.set(r,n),this.size+=a.size==i?0:1,this}return iw=t,iw}var sw,KP;function FV(){if(KP)return sw;KP=1;var e=zV(),t=LV(),r=BV(),n=jV(),a=OV();function i(u){var s=-1,h=u==null?0:u.length;for(this.clear();++s<h;){var p=u[s];this.set(p[0],p[1])}}return i.prototype.clear=e,i.prototype.delete=t,i.prototype.get=r,i.prototype.has=n,i.prototype.set=a,sw=i,sw}var ow,YP;function $V(){if(YP)return ow;YP=1;var e=FV(),t="Expected a function";function r(n,a){if(typeof n!="function"||a!=null&&typeof a!="function")throw new TypeError(t);var i=function(){var u=arguments,s=a?a.apply(this,u):u[0],h=i.cache;if(h.has(s))return h.get(s);var p=n.apply(this,u);return i.cache=h.set(s,p)||h,p};return i.cache=new(r.Cache||e),i}return r.Cache=e,ow=r,ow}var lw,JP;function VV(){if(JP)return lw;JP=1;var e=$V(),t=500;function r(n){var a=e(n,function(u){return i.size===t&&i.clear(),u}),i=a.cache;return a}return lw=r,lw}var uw,QP;function zz(){if(QP)return uw;QP=1;var e=VV(),t=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,r=/\\(\\)?/g,n=e(function(a){var i=[];return a.charCodeAt(0)===46&&i.push(""),a.replace(t,function(u,s,h,p){i.push(h?p.replace(r,"$1"):s||u)}),i});return uw=n,uw}var cw,eI;function Rz(){if(eI)return cw;eI=1;function e(t,r){for(var n=-1,a=t==null?0:t.length,i=Array(a);++n<a;)i[n]=r(t[n],n,t);return i}return cw=e,cw}var dw,tI;function UV(){if(tI)return dw;tI=1;var e=$S(),t=Rz(),r=Z0(),n=qm(),a=e?e.prototype:void 0,i=a?a.toString:void 0;function u(s){if(typeof s=="string")return s;if(r(s))return t(s,u)+"";if(n(s))return i?i.call(s):"";var h=s+"";return h=="0"&&1/s==-1/0?"-0":h}return dw=u,dw}var hw,rI;function Lz(){if(rI)return hw;rI=1;var e=UV();function t(r){return r==null?"":e(r)}return hw=t,hw}var fw,nI;function Bz(){if(nI)return fw;nI=1;var e=Z0(),t=pV(),r=zz(),n=Lz();function a(i,u){return e(i)?i:t(i,u)?[i]:r(n(i))}return fw=a,fw}var pw,aI;function YS(){if(aI)return pw;aI=1;var e=qm();function t(r){if(typeof r=="string"||e(r))return r;var n=r+"";return n=="0"&&1/r==-1/0?"-0":n}return pw=t,pw}var mw,iI;function qV(){if(iI)return mw;iI=1;var e=Bz(),t=YS();function r(n,a){a=e(a,n);for(var i=0,u=a.length;n!=null&&i<u;)n=n[t(a[i++])];return i&&i==u?n:void 0}return mw=r,mw}var gw,sI;function HV(){if(sI)return gw;sI=1;var e=qV();function t(r,n,a){var i=r==null?void 0:e(r,n);return i===void 0?a:i}return gw=t,gw}var GV=HV(),WV=Vm(GV),vw,oI;function ZV(){if(oI)return vw;oI=1;var e=KS(),t=function(){try{var r=e(Object,"defineProperty");return r({},"",{}),r}catch{}}();return vw=t,vw}var yw,lI;function XV(){if(lI)return yw;lI=1;var e=ZV();function t(r,n,a){n=="__proto__"&&e?e(r,n,{configurable:!0,enumerable:!0,value:a,writable:!0}):r[n]=a}return yw=t,yw}var xw,uI;function KV(){if(uI)return xw;uI=1;var e=XV(),t=Dz(),r=Object.prototype,n=r.hasOwnProperty;function a(i,u,s){var h=i[u];(!(n.call(i,u)&&t(h,s))||s===void 0&&!(u in i))&&e(i,u,s)}return xw=a,xw}var bw,cI;function YV(){if(cI)return bw;cI=1;var e=9007199254740991,t=/^(?:0|[1-9]\d*)$/;function r(n,a){var i=typeof n;return a=a??e,!!a&&(i=="number"||i!="symbol"&&t.test(n))&&n>-1&&n%1==0&&n<a}return bw=r,bw}var _w,dI;function JV(){if(dI)return _w;dI=1;var e=KV(),t=Bz(),r=YV(),n=Um(),a=YS();function i(u,s,h,p){if(!n(u))return u;s=t(s,u);for(var g=-1,v=s.length,x=v-1,S=u;S!=null&&++g<v;){var P=a(s[g]),N=h;if(P==="__proto__"||P==="constructor"||P==="prototype")return u;if(g!=x){var M=S[P];N=p?p(M,P,S):void 0,N===void 0&&(N=n(M)?M:r(s[g+1])?[]:{})}e(S,P,N),S=S[P]}return u}return _w=i,_w}var ww,hI;function QV(){if(hI)return ww;hI=1;var e=JV();function t(r,n,a){return r==null?r:e(r,n,a)}return ww=t,ww}var e8=QV(),t8=Vm(e8),Sw,fI;function r8(){if(fI)return Sw;fI=1;function e(t,r){var n=-1,a=t.length;for(r||(r=Array(a));++n<a;)r[n]=t[n];return r}return Sw=e,Sw}var Ew,pI;function n8(){if(pI)return Ew;pI=1;var e=Rz(),t=r8(),r=Z0(),n=qm(),a=zz(),i=YS(),u=Lz();function s(h){return r(h)?e(h,i):n(h)?[h]:t(a(u(h)))}return Ew=s,Ew}var a8=n8(),i8=Vm(a8),s8={data:function(t){var r={field:"data",bindingEvent:"data",allowBinding:!1,allowSetting:!1,allowGetting:!1,settingEvent:"data",settingTriggersEvent:!1,triggerFnName:"trigger",immutableKeys:{},updateStyle:!1,beforeGet:function(a){},beforeSet:function(a,i){},onSet:function(a){},canSet:function(a){return!0}};return t=xr({},r,t),function(a,i){var u=t,s=this,h=s.length!==void 0,p=h?s:[s],g=h?s[0]:s;if(dr(a)){var v=a.indexOf(".")!==-1,x=v&&i8(a);if(u.allowGetting&&i===void 0){var S;return g&&(u.beforeGet(g),x&&g._private[u.field][a]===void 0?S=WV(g._private[u.field],x):S=g._private[u.field][a]),S}else if(u.allowSetting&&i!==void 0){var P=!u.immutableKeys[a];if(P){var N=JD({},a,i);u.beforeSet(s,N);for(var M=0,I=p.length;M<I;M++){var A=p[M];u.canSet(A)&&(x&&g._private[u.field][a]===void 0?t8(A._private[u.field],x,i):A._private[u.field][a]=i)}u.updateStyle&&s.updateStyle(),u.onSet(s),u.settingTriggersEvent&&s[u.triggerFnName](u.settingEvent)}}}else if(u.allowSetting&&Ur(a)){var D=a,j,V,U=Object.keys(D);u.beforeSet(s,D);for(var $=0;$<U.length;$++){j=U[$],V=D[j];var W=!u.immutableKeys[j];if(W)for(var X=0;X<p.length;X++){var J=p[X];u.canSet(J)&&(J._private[u.field][j]=V)}}u.updateStyle&&s.updateStyle(),u.onSet(s),u.settingTriggersEvent&&s[u.triggerFnName](u.settingEvent)}else if(u.allowBinding&&Nn(a)){var Z=a;s.on(u.bindingEvent,Z)}else if(u.allowGetting&&a===void 0){var K;return g&&(u.beforeGet(g),K=g._private[u.field]),K}return s}},removeData:function(t){var r={field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!1,immutableKeys:{}};return t=xr({},r,t),function(a){var i=t,u=this,s=u.length!==void 0,h=s?u:[u];if(dr(a)){for(var p=a.split(/\s+/),g=p.length,v=0;v<g;v++){var x=p[v];if(!iu(x)){var S=!i.immutableKeys[x];if(S)for(var P=0,N=h.length;P<N;P++)h[P]._private[i.field][x]=void 0}}i.triggerEvent&&u[i.triggerFnName](i.event)}else if(a===void 0){for(var M=0,I=h.length;M<I;M++)for(var A=h[M]._private[i.field],D=Object.keys(A),j=0;j<D.length;j++){var V=D[j],U=!i.immutableKeys[V];U&&(A[V]=void 0)}i.triggerEvent&&u[i.triggerFnName](i.event)}return u}}},o8={eventAliasesOn:function(t){var r=t;r.addListener=r.listen=r.bind=r.on,r.unlisten=r.unbind=r.off=r.removeListener,r.trigger=r.emit,r.pon=r.promiseOn=function(n,a){var i=this,u=Array.prototype.slice.call(arguments,0);return new $h(function(s,h){var p=function(S){i.off.apply(i,v),s(S)},g=u.concat([p]),v=g.concat([]);i.on.apply(i,g)})}}},Yr={};[fV,s8,o8].forEach(function(e){xr(Yr,e)});var l8={animate:Yr.animate(),animation:Yr.animation(),animated:Yr.animated(),clearQueue:Yr.clearQueue(),delay:Yr.delay(),delayAnimation:Yr.delayAnimation(),stop:Yr.stop()},fy={classes:function(t){var r=this;if(t===void 0){var n=[];return r[0]._private.classes.forEach(function(P){return n.push(P)}),n}else dn(t)||(t=(t||"").match(/\S+/g)||[]);for(var a=[],i=new Fh(t),u=0;u<r.length;u++){for(var s=r[u],h=s._private,p=h.classes,g=!1,v=0;v<t.length;v++){var x=t[v],S=p.has(x);if(!S){g=!0;break}}g||(g=p.size!==t.length),g&&(h.classes=i,a.push(s))}return a.length>0&&this.spawn(a).updateStyle().emit("class"),r},addClass:function(t){return this.toggleClass(t,!0)},hasClass:function(t){var r=this[0];return r!=null&&r._private.classes.has(t)},toggleClass:function(t,r){dn(t)||(t=t.match(/\S+/g)||[]);for(var n=this,a=r===void 0,i=[],u=0,s=n.length;u<s;u++)for(var h=n[u],p=h._private.classes,g=!1,v=0;v<t.length;v++){var x=t[v],S=p.has(x),P=!1;r||a&&!S?(p.add(x),P=!0):(!r||a&&S)&&(p.delete(x),P=!0),!g&&P&&(i.push(h),g=!0)}return i.length>0&&this.spawn(i).updateStyle().emit("class"),n},removeClass:function(t){return this.toggleClass(t,!1)},flashClass:function(t,r){var n=this;if(r==null)r=250;else if(r===0)return n;return n.addClass(t),setTimeout(function(){n.removeClass(t)},r),n}};fy.className=fy.classNames=fy.classes;var $r={metaChar:"[\\!\\\"\\#\\$\\%\\&\\'\\(\\)\\*\\+\\,\\.\\/\\:\\;\\<\\=\\>\\?\\@\\[\\]\\^\\`\\{\\|\\}\\~]",comparatorOp:"=|\\!=|>|>=|<|<=|\\$=|\\^=|\\*=",boolOp:"\\?|\\!|\\^",string:`"(?:\\\\"|[^"])*"|'(?:\\\\'|[^'])*'`,number:ea,meta:"degree|indegree|outdegree",separator:"\\s*,\\s*",descendant:"\\s+",child:"\\s+>\\s+",subject:"\\$",group:"node|edge|\\*",directedEdge:"\\s+->\\s+",undirectedEdge:"\\s+<->\\s+"};$r.variable="(?:[\\w-.]|(?:\\\\"+$r.metaChar+"))+";$r.className="(?:[\\w-]|(?:\\\\"+$r.metaChar+"))+";$r.value=$r.string+"|"+$r.number;$r.id=$r.variable;(function(){var e,t,r;for(e=$r.comparatorOp.split("|"),r=0;r<e.length;r++)t=e[r],$r.comparatorOp+="|@"+t;for(e=$r.comparatorOp.split("|"),r=0;r<e.length;r++)t=e[r],!(t.indexOf("!")>=0)&&t!=="="&&($r.comparatorOp+="|\\!"+t)})();var un=function(){return{checks:[]}},nr={GROUP:0,COLLECTION:1,FILTER:2,DATA_COMPARE:3,DATA_EXIST:4,DATA_BOOL:5,META_COMPARE:6,STATE:7,ID:8,CLASS:9,UNDIRECTED_EDGE:10,DIRECTED_EDGE:11,NODE_SOURCE:12,NODE_TARGET:13,NODE_NEIGHBOR:14,CHILD:15,DESCENDANT:16,PARENT:17,ANCESTOR:18,COMPOUND_SPLIT:19,TRUE:20},a2=[{selector:":selected",matches:function(t){return t.selected()}},{selector:":unselected",matches:function(t){return!t.selected()}},{selector:":selectable",matches:function(t){return t.selectable()}},{selector:":unselectable",matches:function(t){return!t.selectable()}},{selector:":locked",matches:function(t){return t.locked()}},{selector:":unlocked",matches:function(t){return!t.locked()}},{selector:":visible",matches:function(t){return t.visible()}},{selector:":hidden",matches:function(t){return!t.visible()}},{selector:":transparent",matches:function(t){return t.transparent()}},{selector:":grabbed",matches:function(t){return t.grabbed()}},{selector:":free",matches:function(t){return!t.grabbed()}},{selector:":removed",matches:function(t){return t.removed()}},{selector:":inside",matches:function(t){return!t.removed()}},{selector:":grabbable",matches:function(t){return t.grabbable()}},{selector:":ungrabbable",matches:function(t){return!t.grabbable()}},{selector:":animated",matches:function(t){return t.animated()}},{selector:":unanimated",matches:function(t){return!t.animated()}},{selector:":parent",matches:function(t){return t.isParent()}},{selector:":childless",matches:function(t){return t.isChildless()}},{selector:":child",matches:function(t){return t.isChild()}},{selector:":orphan",matches:function(t){return t.isOrphan()}},{selector:":nonorphan",matches:function(t){return t.isChild()}},{selector:":compound",matches:function(t){return t.isNode()?t.isParent():t.source().isParent()||t.target().isParent()}},{selector:":loop",matches:function(t){return t.isLoop()}},{selector:":simple",matches:function(t){return t.isSimple()}},{selector:":active",matches:function(t){return t.active()}},{selector:":inactive",matches:function(t){return!t.active()}},{selector:":backgrounding",matches:function(t){return t.backgrounding()}},{selector:":nonbackgrounding",matches:function(t){return!t.backgrounding()}}].sort(function(e,t){return s6(e.selector,t.selector)}),u8=function(){for(var e={},t,r=0;r<a2.length;r++)t=a2[r],e[t.selector]=t.matches;return e}(),c8=function(t,r){return u8[t](r)},d8="("+a2.map(function(e){return e.selector}).join("|")+")",Ad=function(t){return t.replace(new RegExp("\\\\("+$r.metaChar+")","g"),function(r,n){return n})},Il=function(t,r,n){t[t.length-1]=n},i2=[{name:"group",query:!0,regex:"("+$r.group+")",populate:function(t,r,n){var a=Hn(n,1),i=a[0];r.checks.push({type:nr.GROUP,value:i==="*"?i:i+"s"})}},{name:"state",query:!0,regex:d8,populate:function(t,r,n){var a=Hn(n,1),i=a[0];r.checks.push({type:nr.STATE,value:i})}},{name:"id",query:!0,regex:"\\#("+$r.id+")",populate:function(t,r,n){var a=Hn(n,1),i=a[0];r.checks.push({type:nr.ID,value:Ad(i)})}},{name:"className",query:!0,regex:"\\.("+$r.className+")",populate:function(t,r,n){var a=Hn(n,1),i=a[0];r.checks.push({type:nr.CLASS,value:Ad(i)})}},{name:"dataExists",query:!0,regex:"\\[\\s*("+$r.variable+")\\s*\\]",populate:function(t,r,n){var a=Hn(n,1),i=a[0];r.checks.push({type:nr.DATA_EXIST,field:Ad(i)})}},{name:"dataCompare",query:!0,regex:"\\[\\s*("+$r.variable+")\\s*("+$r.comparatorOp+")\\s*("+$r.value+")\\s*\\]",populate:function(t,r,n){var a=Hn(n,3),i=a[0],u=a[1],s=a[2],h=new RegExp("^"+$r.string+"$").exec(s)!=null;h?s=s.substring(1,s.length-1):s=parseFloat(s),r.checks.push({type:nr.DATA_COMPARE,field:Ad(i),operator:u,value:s})}},{name:"dataBool",query:!0,regex:"\\[\\s*("+$r.boolOp+")\\s*("+$r.variable+")\\s*\\]",populate:function(t,r,n){var a=Hn(n,2),i=a[0],u=a[1];r.checks.push({type:nr.DATA_BOOL,field:Ad(u),operator:i})}},{name:"metaCompare",query:!0,regex:"\\[\\[\\s*("+$r.meta+")\\s*("+$r.comparatorOp+")\\s*("+$r.number+")\\s*\\]\\]",populate:function(t,r,n){var a=Hn(n,3),i=a[0],u=a[1],s=a[2];r.checks.push({type:nr.META_COMPARE,field:Ad(i),operator:u,value:parseFloat(s)})}},{name:"nextQuery",separator:!0,regex:$r.separator,populate:function(t,r){var n=t.currentSubject,a=t.edgeCount,i=t.compoundCount,u=t[t.length-1];n!=null&&(u.subject=n,t.currentSubject=null),u.edgeCount=a,u.compoundCount=i,t.edgeCount=0,t.compoundCount=0;var s=t[t.length++]=un();return s}},{name:"directedEdge",separator:!0,regex:$r.directedEdge,populate:function(t,r){if(t.currentSubject==null){var n=un(),a=r,i=un();return n.checks.push({type:nr.DIRECTED_EDGE,source:a,target:i}),Il(t,r,n),t.edgeCount++,i}else{var u=un(),s=r,h=un();return u.checks.push({type:nr.NODE_SOURCE,source:s,target:h}),Il(t,r,u),t.edgeCount++,h}}},{name:"undirectedEdge",separator:!0,regex:$r.undirectedEdge,populate:function(t,r){if(t.currentSubject==null){var n=un(),a=r,i=un();return n.checks.push({type:nr.UNDIRECTED_EDGE,nodes:[a,i]}),Il(t,r,n),t.edgeCount++,i}else{var u=un(),s=r,h=un();return u.checks.push({type:nr.NODE_NEIGHBOR,node:s,neighbor:h}),Il(t,r,u),h}}},{name:"child",separator:!0,regex:$r.child,populate:function(t,r){if(t.currentSubject==null){var n=un(),a=un(),i=t[t.length-1];return n.checks.push({type:nr.CHILD,parent:i,child:a}),Il(t,r,n),t.compoundCount++,a}else if(t.currentSubject===r){var u=un(),s=t[t.length-1],h=un(),p=un(),g=un(),v=un();return u.checks.push({type:nr.COMPOUND_SPLIT,left:s,right:h,subject:p}),p.checks=r.checks,r.checks=[{type:nr.TRUE}],v.checks.push({type:nr.TRUE}),h.checks.push({type:nr.PARENT,parent:v,child:g}),Il(t,s,u),t.currentSubject=p,t.compoundCount++,g}else{var x=un(),S=un(),P=[{type:nr.PARENT,parent:x,child:S}];return x.checks=r.checks,r.checks=P,t.compoundCount++,S}}},{name:"descendant",separator:!0,regex:$r.descendant,populate:function(t,r){if(t.currentSubject==null){var n=un(),a=un(),i=t[t.length-1];return n.checks.push({type:nr.DESCENDANT,ancestor:i,descendant:a}),Il(t,r,n),t.compoundCount++,a}else if(t.currentSubject===r){var u=un(),s=t[t.length-1],h=un(),p=un(),g=un(),v=un();return u.checks.push({type:nr.COMPOUND_SPLIT,left:s,right:h,subject:p}),p.checks=r.checks,r.checks=[{type:nr.TRUE}],v.checks.push({type:nr.TRUE}),h.checks.push({type:nr.ANCESTOR,ancestor:v,descendant:g}),Il(t,s,u),t.currentSubject=p,t.compoundCount++,g}else{var x=un(),S=un(),P=[{type:nr.ANCESTOR,ancestor:x,descendant:S}];return x.checks=r.checks,r.checks=P,t.compoundCount++,S}}},{name:"subject",modifier:!0,regex:$r.subject,populate:function(t,r){if(t.currentSubject!=null&&t.currentSubject!==r)return Jr("Redefinition of subject in selector `"+t.toString()+"`"),!1;t.currentSubject=r;var n=t[t.length-1],a=n.checks[0],i=a==null?null:a.type;i===nr.DIRECTED_EDGE?a.type=nr.NODE_TARGET:i===nr.UNDIRECTED_EDGE&&(a.type=nr.NODE_NEIGHBOR,a.node=a.nodes[1],a.neighbor=a.nodes[0],a.nodes=null)}}];i2.forEach(function(e){return e.regexObj=new RegExp("^"+e.regex)});var h8=function(t){for(var r,n,a,i=0;i<i2.length;i++){var u=i2[i],s=u.name,h=t.match(u.regexObj);if(h!=null){n=h,r=u,a=s;var p=h[0];t=t.substring(p.length);break}}return{expr:r,match:n,name:a,remaining:t}},f8=function(t){var r=t.match(/^\s+/);if(r){var n=r[0];t=t.substring(n.length)}return t},p8=function(t){var r=this,n=r.inputText=t,a=r[0]=un();for(r.length=1,n=f8(n);;){var i=h8(n);if(i.expr==null)return Jr("The selector `"+t+"`is invalid"),!1;var u=i.match.slice(1),s=i.expr.populate(r,a,u);if(s===!1)return!1;if(s!=null&&(a=s),n=i.remaining,n.match(/^\s*$/))break}var h=r[r.length-1];r.currentSubject!=null&&(h.subject=r.currentSubject),h.edgeCount=r.edgeCount,h.compoundCount=r.compoundCount;for(var p=0;p<r.length;p++){var g=r[p];if(g.compoundCount>0&&g.edgeCount>0)return Jr("The selector `"+t+"` is invalid because it uses both a compound selector and an edge selector"),!1;if(g.edgeCount>1)return Jr("The selector `"+t+"` is invalid because it uses multiple edge selectors"),!1;g.edgeCount===1&&Jr("The selector `"+t+"` is deprecated.  Edge selectors do not take effect on changes to source and target nodes after an edge is added, for performance reasons.  Use a class or data selector on edges instead, updating the class or data of an edge when your app detects a change in source or target nodes.")}return!0},m8=function(){if(this.toStringCache!=null)return this.toStringCache;for(var t=function(g){return g??""},r=function(g){return dr(g)?'"'+g+'"':t(g)},n=function(g){return" "+g+" "},a=function(g,v){var x=g.type,S=g.value;switch(x){case nr.GROUP:{var P=t(S);return P.substring(0,P.length-1)}case nr.DATA_COMPARE:{var N=g.field,M=g.operator;return"["+N+n(t(M))+r(S)+"]"}case nr.DATA_BOOL:{var I=g.operator,A=g.field;return"["+t(I)+A+"]"}case nr.DATA_EXIST:{var D=g.field;return"["+D+"]"}case nr.META_COMPARE:{var j=g.operator,V=g.field;return"[["+V+n(t(j))+r(S)+"]]"}case nr.STATE:return S;case nr.ID:return"#"+S;case nr.CLASS:return"."+S;case nr.PARENT:case nr.CHILD:return i(g.parent,v)+n(">")+i(g.child,v);case nr.ANCESTOR:case nr.DESCENDANT:return i(g.ancestor,v)+" "+i(g.descendant,v);case nr.COMPOUND_SPLIT:{var U=i(g.left,v),$=i(g.subject,v),W=i(g.right,v);return U+(U.length>0?" ":"")+$+W}case nr.TRUE:return""}},i=function(g,v){return g.checks.reduce(function(x,S,P){return x+(v===g&&P===0?"$":"")+a(S,v)},"")},u="",s=0;s<this.length;s++){var h=this[s];u+=i(h,h.subject),this.length>1&&s<this.length-1&&(u+=", ")}return this.toStringCache=u,u},g8={parse:p8,toString:m8},jz=function(t,r,n){var a,i=dr(t),u=Ht(t),s=dr(n),h,p,g=!1,v=!1,x=!1;switch(r.indexOf("!")>=0&&(r=r.replace("!",""),v=!0),r.indexOf("@")>=0&&(r=r.replace("@",""),g=!0),(i||s||g)&&(h=!i&&!u?"":""+t,p=""+n),g&&(t=h=h.toLowerCase(),n=p=p.toLowerCase()),r){case"*=":a=h.indexOf(p)>=0;break;case"$=":a=h.indexOf(p,h.length-p.length)>=0;break;case"^=":a=h.indexOf(p)===0;break;case"=":a=t===n;break;case">":x=!0,a=t>n;break;case">=":x=!0,a=t>=n;break;case"<":x=!0,a=t<n;break;case"<=":x=!0,a=t<=n;break;default:a=!1;break}return v&&(t!=null||!x)&&(a=!a),a},v8=function(t,r){switch(r){case"?":return!!t;case"!":return!t;case"^":return t===void 0}},y8=function(t){return t!==void 0},JS=function(t,r){return t.data(r)},x8=function(t,r){return t[r]()},Ln=[],_n=function(t,r){return t.checks.every(function(n){return Ln[n.type](n,r)})};Ln[nr.GROUP]=function(e,t){var r=e.value;return r==="*"||r===t.group()};Ln[nr.STATE]=function(e,t){var r=e.value;return c8(r,t)};Ln[nr.ID]=function(e,t){var r=e.value;return t.id()===r};Ln[nr.CLASS]=function(e,t){var r=e.value;return t.hasClass(r)};Ln[nr.META_COMPARE]=function(e,t){var r=e.field,n=e.operator,a=e.value;return jz(x8(t,r),n,a)};Ln[nr.DATA_COMPARE]=function(e,t){var r=e.field,n=e.operator,a=e.value;return jz(JS(t,r),n,a)};Ln[nr.DATA_BOOL]=function(e,t){var r=e.field,n=e.operator;return v8(JS(t,r),n)};Ln[nr.DATA_EXIST]=function(e,t){var r=e.field;return e.operator,y8(JS(t,r))};Ln[nr.UNDIRECTED_EDGE]=function(e,t){var r=e.nodes[0],n=e.nodes[1],a=t.source(),i=t.target();return _n(r,a)&&_n(n,i)||_n(n,a)&&_n(r,i)};Ln[nr.NODE_NEIGHBOR]=function(e,t){return _n(e.node,t)&&t.neighborhood().some(function(r){return r.isNode()&&_n(e.neighbor,r)})};Ln[nr.DIRECTED_EDGE]=function(e,t){return _n(e.source,t.source())&&_n(e.target,t.target())};Ln[nr.NODE_SOURCE]=function(e,t){return _n(e.source,t)&&t.outgoers().some(function(r){return r.isNode()&&_n(e.target,r)})};Ln[nr.NODE_TARGET]=function(e,t){return _n(e.target,t)&&t.incomers().some(function(r){return r.isNode()&&_n(e.source,r)})};Ln[nr.CHILD]=function(e,t){return _n(e.child,t)&&_n(e.parent,t.parent())};Ln[nr.PARENT]=function(e,t){return _n(e.parent,t)&&t.children().some(function(r){return _n(e.child,r)})};Ln[nr.DESCENDANT]=function(e,t){return _n(e.descendant,t)&&t.ancestors().some(function(r){return _n(e.ancestor,r)})};Ln[nr.ANCESTOR]=function(e,t){return _n(e.ancestor,t)&&t.descendants().some(function(r){return _n(e.descendant,r)})};Ln[nr.COMPOUND_SPLIT]=function(e,t){return _n(e.subject,t)&&_n(e.left,t)&&_n(e.right,t)};Ln[nr.TRUE]=function(){return!0};Ln[nr.COLLECTION]=function(e,t){var r=e.value;return r.has(t)};Ln[nr.FILTER]=function(e,t){var r=e.value;return r(t)};var b8=function(t){var r=this;if(r.length===1&&r[0].checks.length===1&&r[0].checks[0].type===nr.ID)return t.getElementById(r[0].checks[0].value).collection();var n=function(i){for(var u=0;u<r.length;u++){var s=r[u];if(_n(s,i))return!0}return!1};return r.text()==null&&(n=function(){return!0}),t.filter(n)},_8=function(t){for(var r=this,n=0;n<r.length;n++){var a=r[n];if(_n(a,t))return!0}return!1},w8={matches:_8,filter:b8},lu=function(t){this.inputText=t,this.currentSubject=null,this.compoundCount=0,this.edgeCount=0,this.length=0,t==null||dr(t)&&t.match(/^\s*$/)||($i(t)?this.addQuery({checks:[{type:nr.COLLECTION,value:t.collection()}]}):Nn(t)?this.addQuery({checks:[{type:nr.FILTER,value:t}]}):dr(t)?this.parse(t)||(this.invalid=!0):Tn("A selector must be created from a string; found "))},uu=lu.prototype;[g8,w8].forEach(function(e){return xr(uu,e)});uu.text=function(){return this.inputText};uu.size=function(){return this.length};uu.eq=function(e){return this[e]};uu.sameText=function(e){return!this.invalid&&!e.invalid&&this.text()===e.text()};uu.addQuery=function(e){this[this.length++]=e};uu.selector=uu.toString;var Ql={allAre:function(t){var r=new lu(t);return this.every(function(n){return r.matches(n)})},is:function(t){var r=new lu(t);return this.some(function(n){return r.matches(n)})},some:function(t,r){for(var n=0;n<this.length;n++){var a=r?t.apply(r,[this[n],n,this]):t(this[n],n,this);if(a)return!0}return!1},every:function(t,r){for(var n=0;n<this.length;n++){var a=r?t.apply(r,[this[n],n,this]):t(this[n],n,this);if(!a)return!1}return!0},same:function(t){if(this===t)return!0;t=this.cy().collection(t);var r=this.length,n=t.length;return r!==n?!1:r===1?this[0]===t[0]:this.every(function(a){return t.hasElementWithId(a.id())})},anySame:function(t){return t=this.cy().collection(t),this.some(function(r){return t.hasElementWithId(r.id())})},allAreNeighbors:function(t){t=this.cy().collection(t);var r=this.neighborhood();return t.every(function(n){return r.hasElementWithId(n.id())})},contains:function(t){t=this.cy().collection(t);var r=this;return t.every(function(n){return r.hasElementWithId(n.id())})}};Ql.allAreNeighbours=Ql.allAreNeighbors;Ql.has=Ql.contains;Ql.equal=Ql.equals=Ql.same;var ls=function(t,r){return function(a,i,u,s){var h=a,p=this,g;if(h==null?g="":$i(h)&&h.length===1&&(g=h.id()),p.length===1&&g){var v=p[0]._private,x=v.traversalCache=v.traversalCache||{},S=x[r]=x[r]||[],P=bc(g),N=S[P];return N||(S[P]=t.call(p,a,i,u,s))}else return t.call(p,a,i,u,s)}},Nh={parent:function(t){var r=[];if(this.length===1){var n=this[0]._private.parent;if(n)return n}for(var a=0;a<this.length;a++){var i=this[a],u=i._private.parent;u&&r.push(u)}return this.spawn(r,!0).filter(t)},parents:function(t){for(var r=[],n=this.parent();n.nonempty();){for(var a=0;a<n.length;a++){var i=n[a];r.push(i)}n=n.parent()}return this.spawn(r,!0).filter(t)},commonAncestors:function(t){for(var r,n=0;n<this.length;n++){var a=this[n],i=a.parents();r=r||i,r=r.intersect(i)}return r.filter(t)},orphans:function(t){return this.stdFilter(function(r){return r.isOrphan()}).filter(t)},nonorphans:function(t){return this.stdFilter(function(r){return r.isChild()}).filter(t)},children:ls(function(e){for(var t=[],r=0;r<this.length;r++)for(var n=this[r],a=n._private.children,i=0;i<a.length;i++)t.push(a[i]);return this.spawn(t,!0).filter(e)},"children"),siblings:function(t){return this.parent().children().not(this).filter(t)},isParent:function(){var t=this[0];if(t)return t.isNode()&&t._private.children.length!==0},isChildless:function(){var t=this[0];if(t)return t.isNode()&&t._private.children.length===0},isChild:function(){var t=this[0];if(t)return t.isNode()&&t._private.parent!=null},isOrphan:function(){var t=this[0];if(t)return t.isNode()&&t._private.parent==null},descendants:function(t){var r=[];function n(a){for(var i=0;i<a.length;i++){var u=a[i];r.push(u),u.children().nonempty()&&n(u.children())}}return n(this.children()),this.spawn(r,!0).filter(t)}};function QS(e,t,r,n){for(var a=[],i=new Fh,u=e.cy(),s=u.hasCompoundNodes(),h=0;h<e.length;h++){var p=e[h];r?a.push(p):s&&n(a,i,p)}for(;a.length>0;){var g=a.shift();t(g),i.add(g.id()),s&&n(a,i,g)}return e}function Oz(e,t,r){if(r.isParent())for(var n=r._private.children,a=0;a<n.length;a++){var i=n[a];t.has(i.id())||e.push(i)}}Nh.forEachDown=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return QS(this,e,t,Oz)};function Fz(e,t,r){if(r.isChild()){var n=r._private.parent;t.has(n.id())||e.push(n)}}Nh.forEachUp=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return QS(this,e,t,Fz)};function S8(e,t,r){Fz(e,t,r),Oz(e,t,r)}Nh.forEachUpAndDown=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return QS(this,e,t,S8)};Nh.ancestors=Nh.parents;var gm,$z;gm=$z={data:Yr.data({field:"data",bindingEvent:"data",allowBinding:!0,allowSetting:!0,settingEvent:"data",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,immutableKeys:{id:!0,source:!0,target:!0,parent:!0},updateStyle:!0}),removeData:Yr.removeData({field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!0,immutableKeys:{id:!0,source:!0,target:!0,parent:!0},updateStyle:!0}),scratch:Yr.data({field:"scratch",bindingEvent:"scratch",allowBinding:!0,allowSetting:!0,settingEvent:"scratch",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeScratch:Yr.removeData({field:"scratch",event:"scratch",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0}),rscratch:Yr.data({field:"rscratch",allowBinding:!1,allowSetting:!0,settingTriggersEvent:!1,allowGetting:!0}),removeRscratch:Yr.removeData({field:"rscratch",triggerEvent:!1}),id:function(){var t=this[0];if(t)return t._private.data.id}};gm.attr=gm.data;gm.removeAttr=gm.removeData;var E8=$z,J0={};function Cw(e){return function(t){var r=this;if(t===void 0&&(t=!0),r.length!==0)if(r.isNode()&&!r.removed()){for(var n=0,a=r[0],i=a._private.edges,u=0;u<i.length;u++){var s=i[u];!t&&s.isLoop()||(n+=e(a,s))}return n}else return}}xr(J0,{degree:Cw(function(e,t){return t.source().same(t.target())?2:1}),indegree:Cw(function(e,t){return t.target().same(e)?1:0}),outdegree:Cw(function(e,t){return t.source().same(e)?1:0})});function Nd(e,t){return function(r){for(var n,a=this.nodes(),i=0;i<a.length;i++){var u=a[i],s=u[e](r);s!==void 0&&(n===void 0||t(s,n))&&(n=s)}return n}}xr(J0,{minDegree:Nd("degree",function(e,t){return e<t}),maxDegree:Nd("degree",function(e,t){return e>t}),minIndegree:Nd("indegree",function(e,t){return e<t}),maxIndegree:Nd("indegree",function(e,t){return e>t}),minOutdegree:Nd("outdegree",function(e,t){return e<t}),maxOutdegree:Nd("outdegree",function(e,t){return e>t})});xr(J0,{totalDegree:function(t){for(var r=0,n=this.nodes(),a=0;a<n.length;a++)r+=n[a].degree(t);return r}});var zs,Vz,Uz=function(t,r,n){for(var a=0;a<t.length;a++){var i=t[a];if(!i.locked()){var u=i._private.position,s={x:r.x!=null?r.x-u.x:0,y:r.y!=null?r.y-u.y:0};i.isParent()&&!(s.x===0&&s.y===0)&&i.children().shift(s,n),i.dirtyBoundingBoxCache()}}},mI={field:"position",bindingEvent:"position",allowBinding:!0,allowSetting:!0,settingEvent:"position",settingTriggersEvent:!0,triggerFnName:"emitAndNotify",allowGetting:!0,validKeys:["x","y"],beforeGet:function(t){t.updateCompoundBounds()},beforeSet:function(t,r){Uz(t,r,!1)},onSet:function(t){t.dirtyCompoundBoundsCache()},canSet:function(t){return!t.locked()}};zs=Vz={position:Yr.data(mI),silentPosition:Yr.data(xr({},mI,{allowBinding:!1,allowSetting:!0,settingTriggersEvent:!1,allowGetting:!1,beforeSet:function(t,r){Uz(t,r,!0)},onSet:function(t){t.dirtyCompoundBoundsCache()}})),positions:function(t,r){if(Ur(t))r?this.silentPosition(t):this.position(t);else if(Nn(t)){var n=t,a=this.cy();a.startBatch();for(var i=0;i<this.length;i++){var u=this[i],s=void 0;(s=n(u,i))&&(r?u.silentPosition(s):u.position(s))}a.endBatch()}return this},silentPositions:function(t){return this.positions(t,!0)},shift:function(t,r,n){var a;if(Ur(t)?(a={x:Ht(t.x)?t.x:0,y:Ht(t.y)?t.y:0},n=r):dr(t)&&Ht(r)&&(a={x:0,y:0},a[t]=r),a!=null){var i=this.cy();i.startBatch();for(var u=0;u<this.length;u++){var s=this[u];if(!(i.hasCompoundNodes()&&s.isChild()&&s.ancestors().anySame(this))){var h=s.position(),p={x:h.x+a.x,y:h.y+a.y};n?s.silentPosition(p):s.position(p)}}i.endBatch()}return this},silentShift:function(t,r){return Ur(t)?this.shift(t,!0):dr(t)&&Ht(r)&&this.shift(t,r,!0),this},renderedPosition:function(t,r){var n=this[0],a=this.cy(),i=a.zoom(),u=a.pan(),s=Ur(t)?t:void 0,h=s!==void 0||r!==void 0&&dr(t);if(n&&n.isNode())if(h)for(var p=0;p<this.length;p++){var g=this[p];r!==void 0?g.position(t,(r-u[t])/i):s!==void 0&&g.position(vz(s,i,u))}else{var v=n.position();return s=G0(v,i,u),t===void 0?s:s[t]}else if(!h)return;return this},relativePosition:function(t,r){var n=this[0],a=this.cy(),i=Ur(t)?t:void 0,u=i!==void 0||r!==void 0&&dr(t),s=a.hasCompoundNodes();if(n&&n.isNode())if(u)for(var h=0;h<this.length;h++){var p=this[h],g=s?p.parent():null,v=g&&g.length>0,x=v;v&&(g=g[0]);var S=x?g.position():{x:0,y:0};r!==void 0?p.position(t,r+S[t]):i!==void 0&&p.position({x:i.x+S.x,y:i.y+S.y})}else{var P=n.position(),N=s?n.parent():null,M=N&&N.length>0,I=M;M&&(N=N[0]);var A=I?N.position():{x:0,y:0};return i={x:P.x-A.x,y:P.y-A.y},t===void 0?i:i[t]}else if(!u)return;return this}};zs.modelPosition=zs.point=zs.position;zs.modelPositions=zs.points=zs.positions;zs.renderedPoint=zs.renderedPosition;zs.relativePoint=zs.relativePosition;var C8=Vz,vh,gu;vh=gu={};gu.renderedBoundingBox=function(e){var t=this.boundingBox(e),r=this.cy(),n=r.zoom(),a=r.pan(),i=t.x1*n+a.x,u=t.x2*n+a.x,s=t.y1*n+a.y,h=t.y2*n+a.y;return{x1:i,x2:u,y1:s,y2:h,w:u-i,h:h-s}};gu.dirtyCompoundBoundsCache=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=this.cy();return!t.styleEnabled()||!t.hasCompoundNodes()?this:(this.forEachUp(function(r){if(r.isParent()){var n=r._private;n.compoundBoundsClean=!1,n.bbCache=null,e||r.emitAndNotify("bounds")}}),this)};gu.updateCompoundBounds=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=this.cy();if(!t.styleEnabled()||!t.hasCompoundNodes())return this;if(!e&&t.batching())return this;function r(u){if(!u.isParent())return;var s=u._private,h=u.children(),p=u.pstyle("compound-sizing-wrt-labels").value==="include",g={width:{val:u.pstyle("min-width").pfValue,left:u.pstyle("min-width-bias-left"),right:u.pstyle("min-width-bias-right")},height:{val:u.pstyle("min-height").pfValue,top:u.pstyle("min-height-bias-top"),bottom:u.pstyle("min-height-bias-bottom")}},v=h.boundingBox({includeLabels:p,includeOverlays:!1,useCache:!1}),x=s.position;(v.w===0||v.h===0)&&(v={w:u.pstyle("width").pfValue,h:u.pstyle("height").pfValue},v.x1=x.x-v.w/2,v.x2=x.x+v.w/2,v.y1=x.y-v.h/2,v.y2=x.y+v.h/2);function S(X,J,Z){var K=0,Y=0,G=J+Z;return X>0&&G>0&&(K=J/G*X,Y=Z/G*X),{biasDiff:K,biasComplementDiff:Y}}function P(X,J,Z,K){if(Z.units==="%")switch(K){case"width":return X>0?Z.pfValue*X:0;case"height":return J>0?Z.pfValue*J:0;case"average":return X>0&&J>0?Z.pfValue*(X+J)/2:0;case"min":return X>0&&J>0?X>J?Z.pfValue*J:Z.pfValue*X:0;case"max":return X>0&&J>0?X>J?Z.pfValue*X:Z.pfValue*J:0;default:return 0}else return Z.units==="px"?Z.pfValue:0}var N=g.width.left.value;g.width.left.units==="px"&&g.width.val>0&&(N=N*100/g.width.val);var M=g.width.right.value;g.width.right.units==="px"&&g.width.val>0&&(M=M*100/g.width.val);var I=g.height.top.value;g.height.top.units==="px"&&g.height.val>0&&(I=I*100/g.height.val);var A=g.height.bottom.value;g.height.bottom.units==="px"&&g.height.val>0&&(A=A*100/g.height.val);var D=S(g.width.val-v.w,N,M),j=D.biasDiff,V=D.biasComplementDiff,U=S(g.height.val-v.h,I,A),$=U.biasDiff,W=U.biasComplementDiff;s.autoPadding=P(v.w,v.h,u.pstyle("padding"),u.pstyle("padding-relative-to").value),s.autoWidth=Math.max(v.w,g.width.val),x.x=(-j+v.x1+v.x2+V)/2,s.autoHeight=Math.max(v.h,g.height.val),x.y=(-$+v.y1+v.y2+W)/2}for(var n=0;n<this.length;n++){var a=this[n],i=a._private;(!i.compoundBoundsClean||e)&&(r(a),t.batching()||(i.compoundBoundsClean=!0))}return this};var is=function(t){return t===1/0||t===-1/0?0:t},ks=function(t,r,n,a,i){a-r===0||i-n===0||r==null||n==null||a==null||i==null||(t.x1=r<t.x1?r:t.x1,t.x2=a>t.x2?a:t.x2,t.y1=n<t.y1?n:t.y1,t.y2=i>t.y2?i:t.y2,t.w=t.x2-t.x1,t.h=t.y2-t.y1)},Dl=function(t,r){return r==null?t:ks(t,r.x1,r.y1,r.x2,r.y2)},up=function(t,r,n){return yi(t,r,n)},Iv=function(t,r,n){if(!r.cy().headless()){var a=r._private,i=a.rstyle,u=i.arrowWidth/2,s=r.pstyle(n+"-arrow-shape").value,h,p;if(s!=="none"){n==="source"?(h=i.srcX,p=i.srcY):n==="target"?(h=i.tgtX,p=i.tgtY):(h=i.midX,p=i.midY);var g=a.arrowBounds=a.arrowBounds||{},v=g[n]=g[n]||{};v.x1=h-u,v.y1=p-u,v.x2=h+u,v.y2=p+u,v.w=v.x2-v.x1,v.h=v.y2-v.y1,dy(v,1),ks(t,v.x1,v.y1,v.x2,v.y2)}}},kw=function(t,r,n){if(!r.cy().headless()){var a;n?a=n+"-":a="";var i=r._private,u=i.rstyle,s=r.pstyle(a+"label").strValue;if(s){var h=r.pstyle("text-halign"),p=r.pstyle("text-valign"),g=up(u,"labelWidth",n),v=up(u,"labelHeight",n),x=up(u,"labelX",n),S=up(u,"labelY",n),P=r.pstyle(a+"text-margin-x").pfValue,N=r.pstyle(a+"text-margin-y").pfValue,M=r.isEdge(),I=r.pstyle(a+"text-rotation"),A=r.pstyle("text-outline-width").pfValue,D=r.pstyle("text-border-width").pfValue,j=D/2,V=r.pstyle("text-background-padding").pfValue,U=2,$=v,W=g,X=W/2,J=$/2,Z,K,Y,G;if(M)Z=x-X,K=x+X,Y=S-J,G=S+J;else{switch(h.value){case"left":Z=x-W,K=x;break;case"center":Z=x-X,K=x+X;break;case"right":Z=x,K=x+W;break}switch(p.value){case"top":Y=S-$,G=S;break;case"center":Y=S-J,G=S+J;break;case"bottom":Y=S,G=S+$;break}}var oe=P-Math.max(A,j)-V-U,ie=P+Math.max(A,j)+V+U,ce=N-Math.max(A,j)-V-U,fe=N+Math.max(A,j)+V+U;Z+=oe,K+=ie,Y+=ce,G+=fe;var de=n||"main",be=i.labelBounds,ge=be[de]=be[de]||{};ge.x1=Z,ge.y1=Y,ge.x2=K,ge.y2=G,ge.w=K-Z,ge.h=G-Y,ge.leftPad=oe,ge.rightPad=ie,ge.topPad=ce,ge.botPad=fe;var xe=M&&I.strValue==="autorotate",Le=I.pfValue!=null&&I.pfValue!==0;if(xe||Le){var Oe=xe?up(i.rstyle,"labelAngle",n):I.pfValue,Fe=Math.cos(Oe),et=Math.sin(Oe),nt=(Z+K)/2,mt=(Y+G)/2;if(!M){switch(h.value){case"left":nt=K;break;case"right":nt=Z;break}switch(p.value){case"top":mt=G;break;case"bottom":mt=Y;break}}var it=function(Xe,Pe){return Xe=Xe-nt,Pe=Pe-mt,{x:Xe*Fe-Pe*et+nt,y:Xe*et+Pe*Fe+mt}},ze=it(Z,Y),He=it(Z,G),We=it(K,Y),ot=it(K,G);Z=Math.min(ze.x,He.x,We.x,ot.x),K=Math.max(ze.x,He.x,We.x,ot.x),Y=Math.min(ze.y,He.y,We.y,ot.y),G=Math.max(ze.y,He.y,We.y,ot.y)}var xt=de+"Rot",Tt=be[xt]=be[xt]||{};Tt.x1=Z,Tt.y1=Y,Tt.x2=K,Tt.y2=G,Tt.w=K-Z,Tt.h=G-Y,ks(t,Z,Y,K,G),ks(i.labelBounds.all,Z,Y,K,G)}return t}},gI=function(t,r){if(!r.cy().headless()){var n=r.pstyle("outline-opacity").value,a=r.pstyle("outline-width").value,i=r.pstyle("outline-offset").value,u=a+i;qz(t,r,n,u,"outside",u/2)}},qz=function(t,r,n,a,i,u){if(!(n===0||a<=0||i==="inside")){var s=r.cy(),h=r.pstyle("shape").value,p=s.renderer().nodeShapes[h],g=r.position(),v=g.x,x=g.y,S=r.width(),P=r.height();if(p.hasMiterBounds){i==="center"&&(a/=2);var N=p.miterBounds(v,x,S,P,a);Dl(t,N)}else u!=null&&u>0&&hy(t,[u,u,u,u])}},k8=function(t,r){if(!r.cy().headless()){var n=r.pstyle("border-opacity").value,a=r.pstyle("border-width").pfValue,i=r.pstyle("border-position").value;qz(t,r,n,a,i)}},T8=function(t,r){var n=t._private.cy,a=n.styleEnabled(),i=n.headless(),u=ni(),s=t._private,h=t.isNode(),p=t.isEdge(),g,v,x,S,P,N,M=s.rstyle,I=h&&a?t.pstyle("bounds-expansion").pfValue:[0],A=function($e){return $e.pstyle("display").value!=="none"},D=!a||A(t)&&(!p||A(t.source())&&A(t.target()));if(D){var j=0,V=0;a&&r.includeOverlays&&(j=t.pstyle("overlay-opacity").value,j!==0&&(V=t.pstyle("overlay-padding").value));var U=0,$=0;a&&r.includeUnderlays&&(U=t.pstyle("underlay-opacity").value,U!==0&&($=t.pstyle("underlay-padding").value));var W=Math.max(V,$),X=0,J=0;if(a&&(X=t.pstyle("width").pfValue,J=X/2),h&&r.includeNodes){var Z=t.position();P=Z.x,N=Z.y;var K=t.outerWidth(),Y=K/2,G=t.outerHeight(),oe=G/2;g=P-Y,v=P+Y,x=N-oe,S=N+oe,ks(u,g,x,v,S),a&&gI(u,t),a&&r.includeOutlines&&!i&&gI(u,t),a&&k8(u,t)}else if(p&&r.includeEdges)if(a&&!i){var ie=t.pstyle("curve-style").strValue;if(g=Math.min(M.srcX,M.midX,M.tgtX),v=Math.max(M.srcX,M.midX,M.tgtX),x=Math.min(M.srcY,M.midY,M.tgtY),S=Math.max(M.srcY,M.midY,M.tgtY),g-=J,v+=J,x-=J,S+=J,ks(u,g,x,v,S),ie==="haystack"){var ce=M.haystackPts;if(ce&&ce.length===2){if(g=ce[0].x,x=ce[0].y,v=ce[1].x,S=ce[1].y,g>v){var fe=g;g=v,v=fe}if(x>S){var de=x;x=S,S=de}ks(u,g-J,x-J,v+J,S+J)}}else if(ie==="bezier"||ie==="unbundled-bezier"||Vl(ie,"segments")||Vl(ie,"taxi")){var be;switch(ie){case"bezier":case"unbundled-bezier":be=M.bezierPts;break;case"segments":case"taxi":case"round-segments":case"round-taxi":be=M.linePts;break}if(be!=null)for(var ge=0;ge<be.length;ge++){var xe=be[ge];g=xe.x-J,v=xe.x+J,x=xe.y-J,S=xe.y+J,ks(u,g,x,v,S)}}}else{var Le=t.source(),Oe=Le.position(),Fe=t.target(),et=Fe.position();if(g=Oe.x,v=et.x,x=Oe.y,S=et.y,g>v){var nt=g;g=v,v=nt}if(x>S){var mt=x;x=S,S=mt}g-=J,v+=J,x-=J,S+=J,ks(u,g,x,v,S)}if(a&&r.includeEdges&&p&&(Iv(u,t,"mid-source"),Iv(u,t,"mid-target"),Iv(u,t,"source"),Iv(u,t,"target")),a){var it=t.pstyle("ghost").value==="yes";if(it){var ze=t.pstyle("ghost-offset-x").pfValue,He=t.pstyle("ghost-offset-y").pfValue;ks(u,u.x1+ze,u.y1+He,u.x2+ze,u.y2+He)}}var We=s.bodyBounds=s.bodyBounds||{};tP(We,u),hy(We,I),dy(We,1),a&&(g=u.x1,v=u.x2,x=u.y1,S=u.y2,ks(u,g-W,x-W,v+W,S+W));var ot=s.overlayBounds=s.overlayBounds||{};tP(ot,u),hy(ot,I),dy(ot,1);var xt=s.labelBounds=s.labelBounds||{};xt.all!=null?l$(xt.all):xt.all=ni(),a&&r.includeLabels&&(r.includeMainLabels&&kw(u,t,null),p&&(r.includeSourceLabels&&kw(u,t,"source"),r.includeTargetLabels&&kw(u,t,"target")))}return u.x1=is(u.x1),u.y1=is(u.y1),u.x2=is(u.x2),u.y2=is(u.y2),u.w=is(u.x2-u.x1),u.h=is(u.y2-u.y1),u.w>0&&u.h>0&&D&&(hy(u,I),dy(u,1)),u},Hz=function(t){var r=0,n=function(u){return(u?1:0)<<r++},a=0;return a+=n(t.incudeNodes),a+=n(t.includeEdges),a+=n(t.includeLabels),a+=n(t.includeMainLabels),a+=n(t.includeSourceLabels),a+=n(t.includeTargetLabels),a+=n(t.includeOverlays),a+=n(t.includeOutlines),a},Gz=function(t){var r=function(s){return Math.round(s)};if(t.isEdge()){var n=t.source().position(),a=t.target().position();return XT([r(n.x),r(n.y),r(a.x),r(a.y)])}else{var i=t.position();return XT([r(i.x),r(i.y)])}},vI=function(t,r){var n=t._private,a,i=t.isEdge(),u=r==null?yI:Hz(r),s=u===yI;if(n.bbCache==null?(a=T8(t,vm),n.bbCache=a,n.bbCachePosKey=Gz(t)):a=n.bbCache,!s){var h=t.isNode();a=ni(),(r.includeNodes&&h||r.includeEdges&&!h)&&(r.includeOverlays?Dl(a,n.overlayBounds):Dl(a,n.bodyBounds)),r.includeLabels&&(r.includeMainLabels&&(!i||r.includeSourceLabels&&r.includeTargetLabels)?Dl(a,n.labelBounds.all):(r.includeMainLabels&&Dl(a,n.labelBounds.mainRot),r.includeSourceLabels&&Dl(a,n.labelBounds.sourceRot),r.includeTargetLabels&&Dl(a,n.labelBounds.targetRot))),a.w=a.x2-a.x1,a.h=a.y2-a.y1}return a},vm={includeNodes:!0,includeEdges:!0,includeLabels:!0,includeMainLabels:!0,includeSourceLabels:!0,includeTargetLabels:!0,includeOverlays:!0,includeUnderlays:!0,includeOutlines:!0,useCache:!0},yI=Hz(vm),xI=Pa(vm);gu.boundingBox=function(e){var t,r=e===void 0||e.useCache===void 0||e.useCache===!0,n=Ih(function(g){var v=g._private;return v.bbCache==null||v.styleDirty||v.bbCachePosKey!==Gz(g)},function(g){return g.id()});if(r&&this.length===1&&!n(this[0]))e===void 0?e=vm:e=xI(e),t=vI(this[0],e);else{t=ni(),e=e||vm;var a=xI(e),i=this,u=i.cy(),s=u.styleEnabled();this.edges().forEach(n),this.nodes().forEach(n),s&&this.recalculateRenderedStyle(r),this.updateCompoundBounds(!r);for(var h=0;h<i.length;h++){var p=i[h];n(p)&&p.dirtyBoundingBoxCache(),Dl(t,vI(p,a))}}return t.x1=is(t.x1),t.y1=is(t.y1),t.x2=is(t.x2),t.y2=is(t.y2),t.w=is(t.x2-t.x1),t.h=is(t.y2-t.y1),t};gu.dirtyBoundingBoxCache=function(){for(var e=0;e<this.length;e++){var t=this[e]._private;t.bbCache=null,t.bbCachePosKey=null,t.bodyBounds=null,t.overlayBounds=null,t.labelBounds.all=null,t.labelBounds.source=null,t.labelBounds.target=null,t.labelBounds.main=null,t.labelBounds.sourceRot=null,t.labelBounds.targetRot=null,t.labelBounds.mainRot=null,t.arrowBounds.source=null,t.arrowBounds.target=null,t.arrowBounds["mid-source"]=null,t.arrowBounds["mid-target"]=null}return this.emitAndNotify("bounds"),this};gu.boundingBoxAt=function(e){var t=this.nodes(),r=this.cy(),n=r.hasCompoundNodes(),a=r.collection();if(n&&(a=t.filter(function(p){return p.isParent()}),t=t.not(a)),Ur(e)){var i=e;e=function(){return i}}var u=function(g,v){return g._private.bbAtOldPos=e(g,v)},s=function(g){return g._private.bbAtOldPos};r.startBatch(),t.forEach(u).silentPositions(e),n&&(a.dirtyCompoundBoundsCache(),a.dirtyBoundingBoxCache(),a.updateCompoundBounds(!0));var h=o$(this.boundingBox({useCache:!1}));return t.silentPositions(s),n&&(a.dirtyCompoundBoundsCache(),a.dirtyBoundingBoxCache(),a.updateCompoundBounds(!0)),r.endBatch(),h};vh.boundingbox=vh.bb=vh.boundingBox;vh.renderedBoundingbox=vh.renderedBoundingBox;var P8=gu,kp,Wm;kp=Wm={};var Wz=function(t){t.uppercaseName=zT(t.name),t.autoName="auto"+t.uppercaseName,t.labelName="label"+t.uppercaseName,t.outerName="outer"+t.uppercaseName,t.uppercaseOuterName=zT(t.outerName),kp[t.name]=function(){var n=this[0],a=n._private,i=a.cy,u=i._private.styleEnabled;if(n)if(u){if(n.isParent())return n.updateCompoundBounds(),a[t.autoName]||0;var s=n.pstyle(t.name);switch(s.strValue){case"label":return n.recalculateRenderedStyle(),a.rstyle[t.labelName]||0;default:return s.pfValue}}else return 1},kp["outer"+t.uppercaseName]=function(){var n=this[0],a=n._private,i=a.cy,u=i._private.styleEnabled;if(n)if(u){var s=n[t.name](),h=n.pstyle("border-position").value,p;h==="center"?p=n.pstyle("border-width").pfValue:h==="outside"?p=2*n.pstyle("border-width").pfValue:p=0;var g=2*n.padding();return s+p+g}else return 1},kp["rendered"+t.uppercaseName]=function(){var n=this[0];if(n){var a=n[t.name]();return a*this.cy().zoom()}},kp["rendered"+t.uppercaseOuterName]=function(){var n=this[0];if(n){var a=n[t.outerName]();return a*this.cy().zoom()}}};Wz({name:"width"});Wz({name:"height"});Wm.padding=function(){var e=this[0],t=e._private;return e.isParent()?(e.updateCompoundBounds(),t.autoPadding!==void 0?t.autoPadding:e.pstyle("padding").pfValue):e.pstyle("padding").pfValue};Wm.paddedHeight=function(){var e=this[0];return e.height()+2*e.padding()};Wm.paddedWidth=function(){var e=this[0];return e.width()+2*e.padding()};var I8=Wm,A8=function(t,r){if(t.isEdge()&&t.takesUpSpace())return r(t)},N8=function(t,r){if(t.isEdge()&&t.takesUpSpace()){var n=t.cy();return G0(r(t),n.zoom(),n.pan())}},M8=function(t,r){if(t.isEdge()&&t.takesUpSpace()){var n=t.cy(),a=n.pan(),i=n.zoom();return r(t).map(function(u){return G0(u,i,a)})}},D8=function(t){return t.renderer().getControlPoints(t)},z8=function(t){return t.renderer().getSegmentPoints(t)},R8=function(t){return t.renderer().getSourceEndpoint(t)},L8=function(t){return t.renderer().getTargetEndpoint(t)},B8=function(t){return t.renderer().getEdgeMidpoint(t)},bI={controlPoints:{get:D8,mult:!0},segmentPoints:{get:z8,mult:!0},sourceEndpoint:{get:R8},targetEndpoint:{get:L8},midpoint:{get:B8}},j8=function(t){return"rendered"+t[0].toUpperCase()+t.substr(1)},O8=Object.keys(bI).reduce(function(e,t){var r=bI[t],n=j8(t);return e[t]=function(){return A8(this,r.get)},r.mult?e[n]=function(){return M8(this,r.get)}:e[n]=function(){return N8(this,r.get)},e},{}),F8=xr({},C8,P8,I8,O8);/*!
Event object based on jQuery events, MIT license

https://jquery.org/license/
https://tldrlegal.com/license/mit-license
https://github.com/jquery/jquery/blob/master/src/event.js
*/var Zz=function(t,r){this.recycle(t,r)};function cp(){return!1}function Av(){return!0}Zz.prototype={instanceString:function(){return"event"},recycle:function(t,r){if(this.isImmediatePropagationStopped=this.isPropagationStopped=this.isDefaultPrevented=cp,t!=null&&t.preventDefault?(this.type=t.type,this.isDefaultPrevented=t.defaultPrevented?Av:cp):t!=null&&t.type?r=t:this.type=t,r!=null&&(this.originalEvent=r.originalEvent,this.type=r.type!=null?r.type:this.type,this.cy=r.cy,this.target=r.target,this.position=r.position,this.renderedPosition=r.renderedPosition,this.namespace=r.namespace,this.layout=r.layout),this.cy!=null&&this.position!=null&&this.renderedPosition==null){var n=this.position,a=this.cy.zoom(),i=this.cy.pan();this.renderedPosition={x:n.x*a+i.x,y:n.y*a+i.y}}this.timeStamp=t&&t.timeStamp||Date.now()},preventDefault:function(){this.isDefaultPrevented=Av;var t=this.originalEvent;t&&t.preventDefault&&t.preventDefault()},stopPropagation:function(){this.isPropagationStopped=Av;var t=this.originalEvent;t&&t.stopPropagation&&t.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=Av,this.stopPropagation()},isDefaultPrevented:cp,isPropagationStopped:cp,isImmediatePropagationStopped:cp};var Xz=/^([^.]+)(\.(?:[^.]+))?$/,$8=".*",Kz={qualifierCompare:function(t,r){return t===r},eventMatches:function(){return!0},addEventFields:function(){},callbackContext:function(t){return t},beforeEmit:function(){},afterEmit:function(){},bubble:function(){return!1},parent:function(){return null},context:null},_I=Object.keys(Kz),V8={};function Q0(){for(var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:V8,t=arguments.length>1?arguments[1]:void 0,r=0;r<_I.length;r++){var n=_I[r];this[n]=e[n]||Kz[n]}this.context=t||this.context,this.listeners=[],this.emitting=0}var cu=Q0.prototype,Yz=function(t,r,n,a,i,u,s){Nn(a)&&(i=a,a=null),s&&(u==null?u=s:u=xr({},u,s));for(var h=dn(n)?n:n.split(/\s+/),p=0;p<h.length;p++){var g=h[p];if(!iu(g)){var v=g.match(Xz);if(v){var x=v[1],S=v[2]?v[2]:null,P=r(t,g,x,S,a,i,u);if(P===!1)break}}}},wI=function(t,r){return t.addEventFields(t.context,r),new Zz(r.type,r)},U8=function(t,r,n){if(XF(n)){r(t,n);return}else if(Ur(n)){r(t,wI(t,n));return}for(var a=dn(n)?n:n.split(/\s+/),i=0;i<a.length;i++){var u=a[i];if(!iu(u)){var s=u.match(Xz);if(s){var h=s[1],p=s[2]?s[2]:null,g=wI(t,{type:h,namespace:p,target:t.context});r(t,g)}}}};cu.on=cu.addListener=function(e,t,r,n,a){return Yz(this,function(i,u,s,h,p,g,v){Nn(g)&&i.listeners.push({event:u,callback:g,type:s,namespace:h,qualifier:p,conf:v})},e,t,r,n,a),this};cu.one=function(e,t,r,n){return this.on(e,t,r,n,{one:!0})};cu.removeListener=cu.off=function(e,t,r,n){var a=this;this.emitting!==0&&(this.listeners=N6(this.listeners));for(var i=this.listeners,u=function(p){var g=i[p];Yz(a,function(v,x,S,P,N,M){if((g.type===S||e==="*")&&(!P&&g.namespace!==".*"||g.namespace===P)&&(!N||v.qualifierCompare(g.qualifier,N))&&(!M||g.callback===M))return i.splice(p,1),!1},e,t,r,n)},s=i.length-1;s>=0;s--)u(s);return this};cu.removeAllListeners=function(){return this.removeListener("*")};cu.emit=cu.trigger=function(e,t,r){var n=this.listeners,a=n.length;return this.emitting++,dn(t)||(t=[t]),U8(this,function(i,u){r!=null&&(n=[{event:u.event,type:u.type,namespace:u.namespace,callback:r}],a=n.length);for(var s=function(){var g=n[h];if(g.type===u.type&&(!g.namespace||g.namespace===u.namespace||g.namespace===$8)&&i.eventMatches(i.context,g,u)){var v=[u];t!=null&&D6(v,t),i.beforeEmit(i.context,g,u),g.conf&&g.conf.one&&(i.listeners=i.listeners.filter(function(P){return P!==g}));var x=i.callbackContext(i.context,g,u),S=g.callback.apply(x,v);i.afterEmit(i.context,g,u),S===!1&&(u.stopPropagation(),u.preventDefault())}},h=0;h<a;h++)s();i.bubble(i.context)&&!u.isPropagationStopped()&&i.parent(i.context).emit(u,t)},e),this.emitting--,this};var q8={qualifierCompare:function(t,r){return t==null||r==null?t==null&&r==null:t.sameText(r)},eventMatches:function(t,r,n){var a=r.qualifier;return a!=null?t!==n.target&&$m(n.target)&&a.matches(n.target):!0},addEventFields:function(t,r){r.cy=t.cy(),r.target=t},callbackContext:function(t,r,n){return r.qualifier!=null?n.target:t},beforeEmit:function(t,r){r.conf&&r.conf.once&&r.conf.onceCollection.removeListener(r.event,r.qualifier,r.callback)},bubble:function(){return!0},parent:function(t){return t.isChild()?t.parent():t.cy()}},Nv=function(t){return dr(t)?new lu(t):t},Jz={createEmitter:function(){for(var t=0;t<this.length;t++){var r=this[t],n=r._private;n.emitter||(n.emitter=new Q0(q8,r))}return this},emitter:function(){return this._private.emitter},on:function(t,r,n){for(var a=Nv(r),i=0;i<this.length;i++){var u=this[i];u.emitter().on(t,a,n)}return this},removeListener:function(t,r,n){for(var a=Nv(r),i=0;i<this.length;i++){var u=this[i];u.emitter().removeListener(t,a,n)}return this},removeAllListeners:function(){for(var t=0;t<this.length;t++){var r=this[t];r.emitter().removeAllListeners()}return this},one:function(t,r,n){for(var a=Nv(r),i=0;i<this.length;i++){var u=this[i];u.emitter().one(t,a,n)}return this},once:function(t,r,n){for(var a=Nv(r),i=0;i<this.length;i++){var u=this[i];u.emitter().on(t,a,n,{once:!0,onceCollection:this})}},emit:function(t,r){for(var n=0;n<this.length;n++){var a=this[n];a.emitter().emit(t,r)}return this},emitAndNotify:function(t,r){if(this.length!==0)return this.cy().notify(t,this),this.emit(t,r),this}};Yr.eventAliasesOn(Jz);var Qz={nodes:function(t){return this.filter(function(r){return r.isNode()}).filter(t)},edges:function(t){return this.filter(function(r){return r.isEdge()}).filter(t)},byGroup:function(){for(var t=this.spawn(),r=this.spawn(),n=0;n<this.length;n++){var a=this[n];a.isNode()?t.push(a):r.push(a)}return{nodes:t,edges:r}},filter:function(t,r){if(t===void 0)return this;if(dr(t)||$i(t))return new lu(t).filter(this);if(Nn(t)){for(var n=this.spawn(),a=this,i=0;i<a.length;i++){var u=a[i],s=r?t.apply(r,[u,i,a]):t(u,i,a);s&&n.push(u)}return n}return this.spawn()},not:function(t){if(t){dr(t)&&(t=this.filter(t));for(var r=this.spawn(),n=0;n<this.length;n++){var a=this[n],i=t.has(a);i||r.push(a)}return r}else return this},absoluteComplement:function(){var t=this.cy();return t.mutableElements().not(this)},intersect:function(t){if(dr(t)){var r=t;return this.filter(r)}for(var n=this.spawn(),a=this,i=t,u=this.length<t.length,s=u?a:i,h=u?i:a,p=0;p<s.length;p++){var g=s[p];h.has(g)&&n.push(g)}return n},xor:function(t){var r=this._private.cy;dr(t)&&(t=r.$(t));var n=this.spawn(),a=this,i=t,u=function(h,p){for(var g=0;g<h.length;g++){var v=h[g],x=v._private.data.id,S=p.hasElementWithId(x);S||n.push(v)}};return u(a,i),u(i,a),n},diff:function(t){var r=this._private.cy;dr(t)&&(t=r.$(t));var n=this.spawn(),a=this.spawn(),i=this.spawn(),u=this,s=t,h=function(g,v,x){for(var S=0;S<g.length;S++){var P=g[S],N=P._private.data.id,M=v.hasElementWithId(N);M?i.merge(P):x.push(P)}};return h(u,s,n),h(s,u,a),{left:n,right:a,both:i}},add:function(t){var r=this._private.cy;if(!t)return this;if(dr(t)){var n=t;t=r.mutableElements().filter(n)}for(var a=this.spawnSelf(),i=0;i<t.length;i++){var u=t[i],s=!this.has(u);s&&a.push(u)}return a},merge:function(t){var r=this._private,n=r.cy;if(!t)return this;if(t&&dr(t)){var a=t;t=n.mutableElements().filter(a)}for(var i=r.map,u=0;u<t.length;u++){var s=t[u],h=s._private.data.id,p=!i.has(h);if(p){var g=this.length++;this[g]=s,i.set(h,{ele:s,index:g})}}return this},unmergeAt:function(t){var r=this[t],n=r.id(),a=this._private,i=a.map;this[t]=void 0,i.delete(n);var u=t===this.length-1;if(this.length>1&&!u){var s=this.length-1,h=this[s],p=h._private.data.id;this[s]=void 0,this[t]=h,i.set(p,{ele:h,index:t})}return this.length--,this},unmergeOne:function(t){t=t[0];var r=this._private,n=t._private.data.id,a=r.map,i=a.get(n);if(!i)return this;var u=i.index;return this.unmergeAt(u),this},unmerge:function(t){var r=this._private.cy;if(!t)return this;if(t&&dr(t)){var n=t;t=r.mutableElements().filter(n)}for(var a=0;a<t.length;a++)this.unmergeOne(t[a]);return this},unmergeBy:function(t){for(var r=this.length-1;r>=0;r--){var n=this[r];t(n)&&this.unmergeAt(r)}return this},map:function(t,r){for(var n=[],a=this,i=0;i<a.length;i++){var u=a[i],s=r?t.apply(r,[u,i,a]):t(u,i,a);n.push(s)}return n},reduce:function(t,r){for(var n=r,a=this,i=0;i<a.length;i++)n=t(n,a[i],i,a);return n},max:function(t,r){for(var n=-1/0,a,i=this,u=0;u<i.length;u++){var s=i[u],h=r?t.apply(r,[s,u,i]):t(s,u,i);h>n&&(n=h,a=s)}return{value:n,ele:a}},min:function(t,r){for(var n=1/0,a,i=this,u=0;u<i.length;u++){var s=i[u],h=r?t.apply(r,[s,u,i]):t(s,u,i);h<n&&(n=h,a=s)}return{value:n,ele:a}}},Hr=Qz;Hr.u=Hr["|"]=Hr["+"]=Hr.union=Hr.or=Hr.add;Hr["\\"]=Hr["!"]=Hr["-"]=Hr.difference=Hr.relativeComplement=Hr.subtract=Hr.not;Hr.n=Hr["&"]=Hr["."]=Hr.and=Hr.intersection=Hr.intersect;Hr["^"]=Hr["(+)"]=Hr["(-)"]=Hr.symmetricDifference=Hr.symdiff=Hr.xor;Hr.fnFilter=Hr.filterFn=Hr.stdFilter=Hr.filter;Hr.complement=Hr.abscomp=Hr.absoluteComplement;var H8={isNode:function(){return this.group()==="nodes"},isEdge:function(){return this.group()==="edges"},isLoop:function(){return this.isEdge()&&this.source()[0]===this.target()[0]},isSimple:function(){return this.isEdge()&&this.source()[0]!==this.target()[0]},group:function(){var t=this[0];if(t)return t._private.group}},eR=function(t,r){var n=t.cy(),a=n.hasCompoundNodes();function i(g){var v=g.pstyle("z-compound-depth");return v.value==="auto"?a?g.zDepth():0:v.value==="bottom"?-1:v.value==="top"?VS:0}var u=i(t)-i(r);if(u!==0)return u;function s(g){var v=g.pstyle("z-index-compare");return v.value==="auto"&&g.isNode()?1:0}var h=s(t)-s(r);if(h!==0)return h;var p=t.pstyle("z-index").value-r.pstyle("z-index").value;return p!==0?p:t.poolIndex()-r.poolIndex()},i0={forEach:function(t,r){if(Nn(t))for(var n=this.length,a=0;a<n;a++){var i=this[a],u=r?t.apply(r,[i,a,this]):t(i,a,this);if(u===!1)break}return this},toArray:function(){for(var t=[],r=0;r<this.length;r++)t.push(this[r]);return t},slice:function(t,r){var n=[],a=this.length;r==null&&(r=a),t==null&&(t=0),t<0&&(t=a+t),r<0&&(r=a+r);for(var i=t;i>=0&&i<r&&i<a;i++)n.push(this[i]);return this.spawn(n)},size:function(){return this.length},eq:function(t){return this[t]||this.spawn()},first:function(){return this[0]||this.spawn()},last:function(){return this[this.length-1]||this.spawn()},empty:function(){return this.length===0},nonempty:function(){return!this.empty()},sort:function(t){if(!Nn(t))return this;var r=this.toArray().sort(t);return this.spawn(r)},sortByZIndex:function(){return this.sort(eR)},zDepth:function(){var t=this[0];if(t){var r=t._private,n=r.group;if(n==="nodes"){var a=r.data.parent?t.parents().size():0;return t.isParent()?a:VS-1}else{var i=r.source,u=r.target,s=i.zDepth(),h=u.zDepth();return Math.max(s,h,0)}}}};i0.each=i0.forEach;var G8=function(){var t="undefined",r=(typeof Symbol>"u"?"undefined":ta(Symbol))!=t&&ta(Symbol.iterator)!=t;r&&(i0[Symbol.iterator]=function(){var n=this,a={value:void 0,done:!1},i=0,u=this.length;return JD({next:function(){return i<u?a.value=n[i++]:(a.value=void 0,a.done=!0),a}},Symbol.iterator,function(){return this})})};G8();var W8=Pa({nodeDimensionsIncludeLabels:!1}),py={layoutDimensions:function(t){t=W8(t);var r;if(!this.takesUpSpace())r={w:0,h:0};else if(t.nodeDimensionsIncludeLabels){var n=this.boundingBox();r={w:n.w,h:n.h}}else r={w:this.outerWidth(),h:this.outerHeight()};return(r.w===0||r.h===0)&&(r.w=r.h=1),r},layoutPositions:function(t,r,n){var a=this.nodes().filter(function(V){return!V.isParent()}),i=this.cy(),u=r.eles,s=function(U){return U.id()},h=Ih(n,s);t.emit({type:"layoutstart",layout:t}),t.animations=[];var p=function(U,$,W){var X={x:$.x1+$.w/2,y:$.y1+$.h/2},J={x:(W.x-X.x)*U,y:(W.y-X.y)*U};return{x:X.x+J.x,y:X.y+J.y}},g=r.spacingFactor&&r.spacingFactor!==1,v=function(){if(!g)return null;for(var U=ni(),$=0;$<a.length;$++){var W=a[$],X=h(W,$);yz(U,X.x,X.y)}return U},x=v(),S=Ih(function(V,U){var $=h(V,U);if(g){var W=Math.abs(r.spacingFactor);$=p(W,x,$)}return r.transform!=null&&($=r.transform(V,$)),$},s);if(r.animate){for(var P=0;P<a.length;P++){var N=a[P],M=S(N,P),I=r.animateFilter==null||r.animateFilter(N,P);if(I){var A=N.animation({position:M,duration:r.animationDuration,easing:r.animationEasing});t.animations.push(A)}else N.position(M)}if(r.fit){var D=i.animation({fit:{boundingBox:u.boundingBoxAt(S),padding:r.padding},duration:r.animationDuration,easing:r.animationEasing});t.animations.push(D)}else if(r.zoom!==void 0&&r.pan!==void 0){var j=i.animation({zoom:r.zoom,pan:r.pan,duration:r.animationDuration,easing:r.animationEasing});t.animations.push(j)}t.animations.forEach(function(V){return V.play()}),t.one("layoutready",r.ready),t.emit({type:"layoutready",layout:t}),$h.all(t.animations.map(function(V){return V.promise()})).then(function(){t.one("layoutstop",r.stop),t.emit({type:"layoutstop",layout:t})})}else a.positions(S),r.fit&&i.fit(r.eles,r.padding),r.zoom!=null&&i.zoom(r.zoom),r.pan&&i.pan(r.pan),t.one("layoutready",r.ready),t.emit({type:"layoutready",layout:t}),t.one("layoutstop",r.stop),t.emit({type:"layoutstop",layout:t});return this},layout:function(t){var r=this.cy();return r.makeLayout(xr({},t,{eles:this}))}};py.createLayout=py.makeLayout=py.layout;function tR(e,t,r){var n=r._private,a=n.styleCache=n.styleCache||[],i;return(i=a[e])!=null||(i=a[e]=t(r)),i}function ex(e,t){return e=bc(e),function(n){return tR(e,t,n)}}function tx(e,t){e=bc(e);var r=function(a){return t.call(a)};return function(){var a=this[0];if(a)return tR(e,r,a)}}var Ca={recalculateRenderedStyle:function(t){var r=this.cy(),n=r.renderer(),a=r.styleEnabled();return n&&a&&n.recalculateRenderedStyle(this,t),this},dirtyStyleCache:function(){var t=this.cy(),r=function(i){return i._private.styleCache=null};if(t.hasCompoundNodes()){var n;n=this.spawnSelf().merge(this.descendants()).merge(this.parents()),n.merge(n.connectedEdges()),n.forEach(r)}else this.forEach(function(a){r(a),a.connectedEdges().forEach(r)});return this},updateStyle:function(t){var r=this._private.cy;if(!r.styleEnabled())return this;if(r.batching()){var n=r._private.batchStyleEles;return n.merge(this),this}var a=r.hasCompoundNodes(),i=this;t=!!(t||t===void 0),a&&(i=this.spawnSelf().merge(this.descendants()).merge(this.parents()));var u=i;return t?u.emitAndNotify("style"):u.emit("style"),i.forEach(function(s){return s._private.styleDirty=!0}),this},cleanStyle:function(){var t=this.cy();if(t.styleEnabled())for(var r=0;r<this.length;r++){var n=this[r];n._private.styleDirty&&(n._private.styleDirty=!1,t.style().apply(n))}},parsedStyle:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=this[0],a=n.cy();if(a.styleEnabled()&&n){n._private.styleDirty&&(n._private.styleDirty=!1,a.style().apply(n));var i=n._private.style[t];return i??(r?a.style().getDefaultProperty(t):null)}},numericStyle:function(t){var r=this[0];if(r.cy().styleEnabled()&&r){var n=r.pstyle(t);return n.pfValue!==void 0?n.pfValue:n.value}},numericStyleUnits:function(t){var r=this[0];if(r.cy().styleEnabled()&&r)return r.pstyle(t).units},renderedStyle:function(t){var r=this.cy();if(!r.styleEnabled())return this;var n=this[0];if(n)return r.style().getRenderedStyle(n,t)},style:function(t,r){var n=this.cy();if(!n.styleEnabled())return this;var a=!1,i=n.style();if(Ur(t)){var u=t;i.applyBypass(this,u,a),this.emitAndNotify("style")}else if(dr(t))if(r===void 0){var s=this[0];return s?i.getStylePropertyValue(s,t):void 0}else i.applyBypass(this,t,r,a),this.emitAndNotify("style");else if(t===void 0){var h=this[0];return h?i.getRawStyle(h):void 0}return this},removeStyle:function(t){var r=this.cy();if(!r.styleEnabled())return this;var n=!1,a=r.style(),i=this;if(t===void 0)for(var u=0;u<i.length;u++){var s=i[u];a.removeAllBypasses(s,n)}else{t=t.split(/\s+/);for(var h=0;h<i.length;h++){var p=i[h];a.removeBypasses(p,t,n)}}return this.emitAndNotify("style"),this},show:function(){return this.css("display","element"),this},hide:function(){return this.css("display","none"),this},effectiveOpacity:function(){var t=this.cy();if(!t.styleEnabled())return 1;var r=t.hasCompoundNodes(),n=this[0];if(n){var a=n._private,i=n.pstyle("opacity").value;if(!r)return i;var u=a.data.parent?n.parents():null;if(u)for(var s=0;s<u.length;s++){var h=u[s],p=h.pstyle("opacity").value;i=p*i}return i}},transparent:function(){var t=this.cy();if(!t.styleEnabled())return!1;var r=this[0],n=r.cy().hasCompoundNodes();if(r)return n?r.effectiveOpacity()===0:r.pstyle("opacity").value===0},backgrounding:function(){var t=this.cy();if(!t.styleEnabled())return!1;var r=this[0];return!!r._private.backgrounding}};function Tw(e,t){var r=e._private,n=r.data.parent?e.parents():null;if(n)for(var a=0;a<n.length;a++){var i=n[a];if(!t(i))return!1}return!0}function eE(e){var t=e.ok,r=e.edgeOkViaNode||e.ok,n=e.parentOk||e.ok;return function(){var a=this.cy();if(!a.styleEnabled())return!0;var i=this[0],u=a.hasCompoundNodes();if(i){var s=i._private;if(!t(i))return!1;if(i.isNode())return!u||Tw(i,n);var h=s.source,p=s.target;return r(h)&&(!u||Tw(h,r))&&(h===p||r(p)&&(!u||Tw(p,r)))}}}var Vh=ex("eleTakesUpSpace",function(e){return e.pstyle("display").value==="element"&&e.width()!==0&&(e.isNode()?e.height()!==0:!0)});Ca.takesUpSpace=tx("takesUpSpace",eE({ok:Vh}));var Z8=ex("eleInteractive",function(e){return e.pstyle("events").value==="yes"&&e.pstyle("visibility").value==="visible"&&Vh(e)}),X8=ex("parentInteractive",function(e){return e.pstyle("visibility").value==="visible"&&Vh(e)});Ca.interactive=tx("interactive",eE({ok:Z8,parentOk:X8,edgeOkViaNode:Vh}));Ca.noninteractive=function(){var e=this[0];if(e)return!e.interactive()};var K8=ex("eleVisible",function(e){return e.pstyle("visibility").value==="visible"&&e.pstyle("opacity").pfValue!==0&&Vh(e)}),Y8=Vh;Ca.visible=tx("visible",eE({ok:K8,edgeOkViaNode:Y8}));Ca.hidden=function(){var e=this[0];if(e)return!e.visible()};Ca.isBundledBezier=tx("isBundledBezier",function(){return this.cy().styleEnabled()?!this.removed()&&this.pstyle("curve-style").value==="bezier"&&this.takesUpSpace():!1});Ca.bypass=Ca.css=Ca.style;Ca.renderedCss=Ca.renderedStyle;Ca.removeBypass=Ca.removeCss=Ca.removeStyle;Ca.pstyle=Ca.parsedStyle;var eu={};function SI(e){return function(){var t=arguments,r=[];if(t.length===2){var n=t[0],a=t[1];this.on(e.event,n,a)}else if(t.length===1&&Nn(t[0])){var i=t[0];this.on(e.event,i)}else if(t.length===0||t.length===1&&dn(t[0])){for(var u=t.length===1?t[0]:null,s=0;s<this.length;s++){var h=this[s],p=!e.ableField||h._private[e.ableField],g=h._private[e.field]!=e.value;if(e.overrideAble){var v=e.overrideAble(h);if(v!==void 0&&(p=v,!v))return this}p&&(h._private[e.field]=e.value,g&&r.push(h))}var x=this.spawn(r);x.updateStyle(),x.emit(e.event),u&&x.emit(u)}return this}}function Uh(e){eu[e.field]=function(){var t=this[0];if(t){if(e.overrideField){var r=e.overrideField(t);if(r!==void 0)return r}return t._private[e.field]}},eu[e.on]=SI({event:e.on,field:e.field,ableField:e.ableField,overrideAble:e.overrideAble,value:!0}),eu[e.off]=SI({event:e.off,field:e.field,ableField:e.ableField,overrideAble:e.overrideAble,value:!1})}Uh({field:"locked",overrideField:function(t){return t.cy().autolock()?!0:void 0},on:"lock",off:"unlock"});Uh({field:"grabbable",overrideField:function(t){return t.cy().autoungrabify()||t.pannable()?!1:void 0},on:"grabify",off:"ungrabify"});Uh({field:"selected",ableField:"selectable",overrideAble:function(t){return t.cy().autounselectify()?!1:void 0},on:"select",off:"unselect"});Uh({field:"selectable",overrideField:function(t){return t.cy().autounselectify()?!1:void 0},on:"selectify",off:"unselectify"});eu.deselect=eu.unselect;eu.grabbed=function(){var e=this[0];if(e)return e._private.grabbed};Uh({field:"active",on:"activate",off:"unactivate"});Uh({field:"pannable",on:"panify",off:"unpanify"});eu.inactive=function(){var e=this[0];if(e)return!e._private.active};var qa={},EI=function(t){return function(n){for(var a=this,i=[],u=0;u<a.length;u++){var s=a[u];if(s.isNode()){for(var h=!1,p=s.connectedEdges(),g=0;g<p.length;g++){var v=p[g],x=v.source(),S=v.target();if(t.noIncomingEdges&&S===s&&x!==s||t.noOutgoingEdges&&x===s&&S!==s){h=!0;break}}h||i.push(s)}}return this.spawn(i,!0).filter(n)}},CI=function(t){return function(r){for(var n=this,a=[],i=0;i<n.length;i++){var u=n[i];if(u.isNode())for(var s=u.connectedEdges(),h=0;h<s.length;h++){var p=s[h],g=p.source(),v=p.target();t.outgoing&&g===u?(a.push(p),a.push(v)):t.incoming&&v===u&&(a.push(p),a.push(g))}}return this.spawn(a,!0).filter(r)}},kI=function(t){return function(r){for(var n=this,a=[],i={};;){var u=t.outgoing?n.outgoers():n.incomers();if(u.length===0)break;for(var s=!1,h=0;h<u.length;h++){var p=u[h],g=p.id();i[g]||(i[g]=!0,a.push(p),s=!0)}if(!s)break;n=u}return this.spawn(a,!0).filter(r)}};qa.clearTraversalCache=function(){for(var e=0;e<this.length;e++)this[e]._private.traversalCache=null};xr(qa,{roots:EI({noIncomingEdges:!0}),leaves:EI({noOutgoingEdges:!0}),outgoers:ls(CI({outgoing:!0}),"outgoers"),successors:kI({outgoing:!0}),incomers:ls(CI({incoming:!0}),"incomers"),predecessors:kI({})});xr(qa,{neighborhood:ls(function(e){for(var t=[],r=this.nodes(),n=0;n<r.length;n++)for(var a=r[n],i=a.connectedEdges(),u=0;u<i.length;u++){var s=i[u],h=s.source(),p=s.target(),g=a===h?p:h;g.length>0&&t.push(g[0]),t.push(s[0])}return this.spawn(t,!0).filter(e)},"neighborhood"),closedNeighborhood:function(t){return this.neighborhood().add(this).filter(t)},openNeighborhood:function(t){return this.neighborhood(t)}});qa.neighbourhood=qa.neighborhood;qa.closedNeighbourhood=qa.closedNeighborhood;qa.openNeighbourhood=qa.openNeighborhood;xr(qa,{source:ls(function(t){var r=this[0],n;return r&&(n=r._private.source||r.cy().collection()),n&&t?n.filter(t):n},"source"),target:ls(function(t){var r=this[0],n;return r&&(n=r._private.target||r.cy().collection()),n&&t?n.filter(t):n},"target"),sources:TI({attr:"source"}),targets:TI({attr:"target"})});function TI(e){return function(r){for(var n=[],a=0;a<this.length;a++){var i=this[a],u=i._private[e.attr];u&&n.push(u)}return this.spawn(n,!0).filter(r)}}xr(qa,{edgesWith:ls(PI(),"edgesWith"),edgesTo:ls(PI({thisIsSrc:!0}),"edgesTo")});function PI(e){return function(r){var n=[],a=this._private.cy,i=e||{};dr(r)&&(r=a.$(r));for(var u=0;u<r.length;u++)for(var s=r[u]._private.edges,h=0;h<s.length;h++){var p=s[h],g=p._private.data,v=this.hasElementWithId(g.source)&&r.hasElementWithId(g.target),x=r.hasElementWithId(g.source)&&this.hasElementWithId(g.target),S=v||x;S&&((i.thisIsSrc||i.thisIsTgt)&&(i.thisIsSrc&&!v||i.thisIsTgt&&!x)||n.push(p))}return this.spawn(n,!0)}}xr(qa,{connectedEdges:ls(function(e){for(var t=[],r=this,n=0;n<r.length;n++){var a=r[n];if(a.isNode())for(var i=a._private.edges,u=0;u<i.length;u++){var s=i[u];t.push(s)}}return this.spawn(t,!0).filter(e)},"connectedEdges"),connectedNodes:ls(function(e){for(var t=[],r=this,n=0;n<r.length;n++){var a=r[n];a.isEdge()&&(t.push(a.source()[0]),t.push(a.target()[0]))}return this.spawn(t,!0).filter(e)},"connectedNodes"),parallelEdges:ls(II(),"parallelEdges"),codirectedEdges:ls(II({codirected:!0}),"codirectedEdges")});function II(e){var t={codirected:!1};return e=xr({},t,e),function(n){for(var a=[],i=this.edges(),u=e,s=0;s<i.length;s++)for(var h=i[s],p=h._private,g=p.source,v=g._private.data.id,x=p.data.target,S=g._private.edges,P=0;P<S.length;P++){var N=S[P],M=N._private.data,I=M.target,A=M.source,D=I===x&&A===v,j=v===I&&x===A;(u.codirected&&D||!u.codirected&&(D||j))&&a.push(N)}return this.spawn(a,!0).filter(n)}}xr(qa,{components:function(t){var r=this,n=r.cy(),a=n.collection(),i=t==null?r.nodes():t.nodes(),u=[];t!=null&&i.empty()&&(i=t.sources());var s=function(g,v){a.merge(g),i.unmerge(g),v.merge(g)};if(i.empty())return r.spawn();var h=function(){var g=n.collection();u.push(g);var v=i[0];s(v,g),r.bfs({directed:!1,roots:v,visit:function(S){return s(S,g)}}),g.forEach(function(x){x.connectedEdges().forEach(function(S){r.has(S)&&g.has(S.source())&&g.has(S.target())&&g.merge(S)})})};do h();while(i.length>0);return u},component:function(){var t=this[0];return t.cy().mutableElements().components(t)[0]}});qa.componentsOf=qa.components;var ka=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(t===void 0){Tn("A collection must have a reference to the core");return}var i=new Ro,u=!1;if(!r)r=[];else if(r.length>0&&Ur(r[0])&&!$m(r[0])){u=!0;for(var s=[],h=new Fh,p=0,g=r.length;p<g;p++){var v=r[p];v.data==null&&(v.data={});var x=v.data;if(x.id==null)x.id=mz();else if(t.hasElementWithId(x.id)||h.has(x.id))continue;var S=new H0(t,v,!1);s.push(S),h.add(x.id)}r=s}this.length=0;for(var P=0,N=r.length;P<N;P++){var M=r[P][0];if(M!=null){var I=M._private.data.id;(!n||!i.has(I))&&(n&&i.set(I,{index:this.length,ele:M}),this[this.length]=M,this.length++)}}this._private={eles:this,cy:t,get map(){return this.lazyMap==null&&this.rebuildMap(),this.lazyMap},set map(A){this.lazyMap=A},rebuildMap:function(){for(var D=this.lazyMap=new Ro,j=this.eles,V=0;V<j.length;V++){var U=j[V];D.set(U.id(),{index:V,ele:U})}}},n&&(this._private.map=i),u&&!a&&this.restore()},pn=H0.prototype=ka.prototype=Object.create(Array.prototype);pn.instanceString=function(){return"collection"};pn.spawn=function(e,t){return new ka(this.cy(),e,t)};pn.spawnSelf=function(){return this.spawn(this)};pn.cy=function(){return this._private.cy};pn.renderer=function(){return this._private.cy.renderer()};pn.element=function(){return this[0]};pn.collection=function(){return tz(this)?this:new ka(this._private.cy,[this])};pn.unique=function(){return new ka(this._private.cy,this,!0)};pn.hasElementWithId=function(e){return e=""+e,this._private.map.has(e)};pn.getElementById=function(e){e=""+e;var t=this._private.cy,r=this._private.map.get(e);return r?r.ele:new ka(t)};pn.$id=pn.getElementById;pn.poolIndex=function(){var e=this._private.cy,t=e._private.elements,r=this[0]._private.data.id;return t._private.map.get(r).index};pn.indexOf=function(e){var t=e[0]._private.data.id;return this._private.map.get(t).index};pn.indexOfId=function(e){return e=""+e,this._private.map.get(e).index};pn.json=function(e){var t=this.element(),r=this.cy();if(t==null&&e)return this;if(t!=null){var n=t._private;if(Ur(e)){if(r.startBatch(),e.data){t.data(e.data);var a=n.data;if(t.isEdge()){var i=!1,u={},s=e.data.source,h=e.data.target;s!=null&&s!=a.source&&(u.source=""+s,i=!0),h!=null&&h!=a.target&&(u.target=""+h,i=!0),i&&(t=t.move(u))}else{var p="parent"in e.data,g=e.data.parent;p&&(g!=null||a.parent!=null)&&g!=a.parent&&(g===void 0&&(g=null),g!=null&&(g=""+g),t=t.move({parent:g}))}}e.position&&t.position(e.position);var v=function(N,M,I){var A=e[N];A!=null&&A!==n[N]&&(A?t[M]():t[I]())};return v("removed","remove","restore"),v("selected","select","unselect"),v("selectable","selectify","unselectify"),v("locked","lock","unlock"),v("grabbable","grabify","ungrabify"),v("pannable","panify","unpanify"),e.classes!=null&&t.classes(e.classes),r.endBatch(),this}else if(e===void 0){var x={data:to(n.data),position:to(n.position),group:n.group,removed:n.removed,selected:n.selected,selectable:n.selectable,locked:n.locked,grabbable:n.grabbable,pannable:n.pannable,classes:null};x.classes="";var S=0;return n.classes.forEach(function(P){return x.classes+=S++===0?P:" "+P}),x}}};pn.jsons=function(){for(var e=[],t=0;t<this.length;t++){var r=this[t],n=r.json();e.push(n)}return e};pn.clone=function(){for(var e=this.cy(),t=[],r=0;r<this.length;r++){var n=this[r],a=n.json(),i=new H0(e,a,!1);t.push(i)}return new ka(e,t)};pn.copy=pn.clone;pn.restore=function(){for(var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=this,n=r.cy(),a=n._private,i=[],u=[],s,h=0,p=r.length;h<p;h++){var g=r[h];t&&!g.removed()||(g.isNode()?i.push(g):u.push(g))}s=i.concat(u);var v,x=function(){s.splice(v,1),v--};for(v=0;v<s.length;v++){var S=s[v],P=S._private,N=P.data;if(S.clearTraversalCache(),!(!t&&!P.removed)){if(N.id===void 0)N.id=mz();else if(Ht(N.id))N.id=""+N.id;else if(iu(N.id)||!dr(N.id)){Tn("Can not create element with invalid string ID `"+N.id+"`"),x();continue}else if(n.hasElementWithId(N.id)){Tn("Can not create second element with ID `"+N.id+"`"),x();continue}}var M=N.id;if(S.isNode()){var I=P.position;I.x==null&&(I.x=0),I.y==null&&(I.y=0)}if(S.isEdge()){for(var A=S,D=["source","target"],j=D.length,V=!1,U=0;U<j;U++){var $=D[U],W=N[$];Ht(W)&&(W=N[$]=""+N[$]),W==null||W===""?(Tn("Can not create edge `"+M+"` with unspecified "+$),V=!0):n.hasElementWithId(W)||(Tn("Can not create edge `"+M+"` with nonexistant "+$+" `"+W+"`"),V=!0)}if(V){x();continue}var X=n.getElementById(N.source),J=n.getElementById(N.target);X.same(J)?X._private.edges.push(A):(X._private.edges.push(A),J._private.edges.push(A)),A._private.source=X,A._private.target=J}P.map=new Ro,P.map.set(M,{ele:S,index:0}),P.removed=!1,t&&n.addToPool(S)}for(var Z=0;Z<i.length;Z++){var K=i[Z],Y=K._private.data;Ht(Y.parent)&&(Y.parent=""+Y.parent);var G=Y.parent,oe=G!=null;if(oe||K._private.parent){var ie=K._private.parent?n.collection().merge(K._private.parent):n.getElementById(G);if(ie.empty())Y.parent=void 0;else if(ie[0].removed())Jr("Node added with missing parent, reference to parent removed"),Y.parent=void 0,K._private.parent=null;else{for(var ce=!1,fe=ie;!fe.empty();){if(K.same(fe)){ce=!0,Y.parent=void 0;break}fe=fe.parent()}ce||(ie[0]._private.children.push(K),K._private.parent=ie[0],a.hasCompoundNodes=!0)}}}if(s.length>0){for(var de=s.length===r.length?r:new ka(n,s),be=0;be<de.length;be++){var ge=de[be];ge.isNode()||(ge.parallelEdges().clearTraversalCache(),ge.source().clearTraversalCache(),ge.target().clearTraversalCache())}var xe;a.hasCompoundNodes?xe=n.collection().merge(de).merge(de.connectedNodes()).merge(de.parent()):xe=de,xe.dirtyCompoundBoundsCache().dirtyBoundingBoxCache().updateStyle(e),e?de.emitAndNotify("add"):t&&de.emit("add")}return r};pn.removed=function(){var e=this[0];return e&&e._private.removed};pn.inside=function(){var e=this[0];return e&&!e._private.removed};pn.remove=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=this,n=[],a={},i=r._private.cy;function u(G){for(var oe=G._private.edges,ie=0;ie<oe.length;ie++)h(oe[ie])}function s(G){for(var oe=G._private.children,ie=0;ie<oe.length;ie++)h(oe[ie])}function h(G){var oe=a[G.id()];t&&G.removed()||oe||(a[G.id()]=!0,G.isNode()?(n.push(G),u(G),s(G)):n.unshift(G))}for(var p=0,g=r.length;p<g;p++){var v=r[p];h(v)}function x(G,oe){var ie=G._private.edges;su(ie,oe),G.clearTraversalCache()}function S(G){G.clearTraversalCache()}var P=[];P.ids={};function N(G,oe){oe=oe[0],G=G[0];var ie=G._private.children,ce=G.id();su(ie,oe),oe._private.parent=null,P.ids[ce]||(P.ids[ce]=!0,P.push(G))}r.dirtyCompoundBoundsCache(),t&&i.removeFromPool(n);for(var M=0;M<n.length;M++){var I=n[M];if(I.isEdge()){var A=I.source()[0],D=I.target()[0];x(A,I),x(D,I);for(var j=I.parallelEdges(),V=0;V<j.length;V++){var U=j[V];S(U),U.isBundledBezier()&&U.dirtyBoundingBoxCache()}}else{var $=I.parent();$.length!==0&&N($,I)}t&&(I._private.removed=!0)}var W=i._private.elements;i._private.hasCompoundNodes=!1;for(var X=0;X<W.length;X++){var J=W[X];if(J.isParent()){i._private.hasCompoundNodes=!0;break}}var Z=new ka(this.cy(),n);Z.size()>0&&(e?Z.emitAndNotify("remove"):t&&Z.emit("remove"));for(var K=0;K<P.length;K++){var Y=P[K];(!t||!Y.removed())&&Y.updateStyle()}return Z};pn.move=function(e){var t=this._private.cy,r=this,n=!1,a=!1,i=function(P){return P==null?P:""+P};if(e.source!==void 0||e.target!==void 0){var u=i(e.source),s=i(e.target),h=u!=null&&t.hasElementWithId(u),p=s!=null&&t.hasElementWithId(s);(h||p)&&(t.batch(function(){r.remove(n,a),r.emitAndNotify("moveout");for(var S=0;S<r.length;S++){var P=r[S],N=P._private.data;P.isEdge()&&(h&&(N.source=u),p&&(N.target=s))}r.restore(n,a)}),r.emitAndNotify("move"))}else if(e.parent!==void 0){var g=i(e.parent),v=g===null||t.hasElementWithId(g);if(v){var x=g===null?void 0:g;t.batch(function(){var S=r.remove(n,a);S.emitAndNotify("moveout");for(var P=0;P<r.length;P++){var N=r[P],M=N._private.data;N.isNode()&&(M.parent=x)}S.restore(n,a)}),r.emitAndNotify("move")}}return this};[Tz,l8,fy,Ql,Nh,E8,J0,F8,Jz,Qz,H8,i0,py,Ca,eu,qa].forEach(function(e){xr(pn,e)});var J8={add:function(t){var r,n=this;if($i(t)){var a=t;if(a._private.cy===n)r=a.restore();else{for(var i=[],u=0;u<a.length;u++){var s=a[u];i.push(s.json())}r=new ka(n,i)}}else if(dn(t)){var h=t;r=new ka(n,h)}else if(Ur(t)&&(dn(t.nodes)||dn(t.edges))){for(var p=t,g=[],v=["nodes","edges"],x=0,S=v.length;x<S;x++){var P=v[x],N=p[P];if(dn(N))for(var M=0,I=N.length;M<I;M++){var A=xr({group:P},N[M]);g.push(A)}}r=new ka(n,g)}else{var D=t;r=new H0(n,D).collection()}return r},remove:function(t){if(!$i(t)){if(dr(t)){var r=t;t=this.$(r)}}return t.remove()}};/*! Bezier curve function generator. Copyright Gaetan Renaudeau. MIT License: http://en.wikipedia.org/wiki/MIT_License */function Q8(e,t,r,n){var a=4,i=.001,u=1e-7,s=10,h=11,p=1/(h-1),g=typeof Float32Array<"u";if(arguments.length!==4)return!1;for(var v=0;v<4;++v)if(typeof arguments[v]!="number"||isNaN(arguments[v])||!isFinite(arguments[v]))return!1;e=Math.min(e,1),r=Math.min(r,1),e=Math.max(e,0),r=Math.max(r,0);var x=g?new Float32Array(h):new Array(h);function S(J,Z){return 1-3*Z+3*J}function P(J,Z){return 3*Z-6*J}function N(J){return 3*J}function M(J,Z,K){return((S(Z,K)*J+P(Z,K))*J+N(Z))*J}function I(J,Z,K){return 3*S(Z,K)*J*J+2*P(Z,K)*J+N(Z)}function A(J,Z){for(var K=0;K<a;++K){var Y=I(Z,e,r);if(Y===0)return Z;var G=M(Z,e,r)-J;Z-=G/Y}return Z}function D(){for(var J=0;J<h;++J)x[J]=M(J*p,e,r)}function j(J,Z,K){var Y,G,oe=0;do G=Z+(K-Z)/2,Y=M(G,e,r)-J,Y>0?K=G:Z=G;while(Math.abs(Y)>u&&++oe<s);return G}function V(J){for(var Z=0,K=1,Y=h-1;K!==Y&&x[K]<=J;++K)Z+=p;--K;var G=(J-x[K])/(x[K+1]-x[K]),oe=Z+G*p,ie=I(oe,e,r);return ie>=i?A(J,oe):ie===0?oe:j(J,Z,Z+p)}var U=!1;function $(){U=!0,(e!==t||r!==n)&&D()}var W=function(Z){return U||$(),e===t&&r===n?Z:Z===0?0:Z===1?1:M(V(Z),t,n)};W.getControlPoints=function(){return[{x:e,y:t},{x:r,y:n}]};var X="generateBezier("+[e,t,r,n]+")";return W.toString=function(){return X},W}/*! Runge-Kutta spring physics function generator. Adapted from Framer.js, copyright Koen Bok. MIT License: http://en.wikipedia.org/wiki/MIT_License */var eU=function(){function e(n){return-n.tension*n.x-n.friction*n.v}function t(n,a,i){var u={x:n.x+i.dx*a,v:n.v+i.dv*a,tension:n.tension,friction:n.friction};return{dx:u.v,dv:e(u)}}function r(n,a){var i={dx:n.v,dv:e(n)},u=t(n,a*.5,i),s=t(n,a*.5,u),h=t(n,a,s),p=1/6*(i.dx+2*(u.dx+s.dx)+h.dx),g=1/6*(i.dv+2*(u.dv+s.dv)+h.dv);return n.x=n.x+p*a,n.v=n.v+g*a,n}return function n(a,i,u){var s={x:-1,v:0,tension:null,friction:null},h=[0],p=0,g=1/1e4,v=16/1e3,x,S,P;for(a=parseFloat(a)||500,i=parseFloat(i)||20,u=u||null,s.tension=a,s.friction=i,x=u!==null,x?(p=n(a,i),S=p/u*v):S=v;P=r(P||s,S),h.push(1+P.x),p+=16,Math.abs(P.x)>g&&Math.abs(P.v)>g;);return x?function(N){return h[N*(h.length-1)|0]}:p}}(),hn=function(t,r,n,a){var i=Q8(t,r,n,a);return function(u,s,h){return u+(s-u)*i(h)}},my={linear:function(t,r,n){return t+(r-t)*n},ease:hn(.25,.1,.25,1),"ease-in":hn(.42,0,1,1),"ease-out":hn(0,0,.58,1),"ease-in-out":hn(.42,0,.58,1),"ease-in-sine":hn(.47,0,.745,.715),"ease-out-sine":hn(.39,.575,.565,1),"ease-in-out-sine":hn(.445,.05,.55,.95),"ease-in-quad":hn(.55,.085,.68,.53),"ease-out-quad":hn(.25,.46,.45,.94),"ease-in-out-quad":hn(.455,.03,.515,.955),"ease-in-cubic":hn(.55,.055,.675,.19),"ease-out-cubic":hn(.215,.61,.355,1),"ease-in-out-cubic":hn(.645,.045,.355,1),"ease-in-quart":hn(.895,.03,.685,.22),"ease-out-quart":hn(.165,.84,.44,1),"ease-in-out-quart":hn(.77,0,.175,1),"ease-in-quint":hn(.755,.05,.855,.06),"ease-out-quint":hn(.23,1,.32,1),"ease-in-out-quint":hn(.86,0,.07,1),"ease-in-expo":hn(.95,.05,.795,.035),"ease-out-expo":hn(.19,1,.22,1),"ease-in-out-expo":hn(1,0,0,1),"ease-in-circ":hn(.6,.04,.98,.335),"ease-out-circ":hn(.075,.82,.165,1),"ease-in-out-circ":hn(.785,.135,.15,.86),spring:function(t,r,n){if(n===0)return my.linear;var a=eU(t,r,n);return function(i,u,s){return i+(u-i)*a(s)}},"cubic-bezier":hn};function AI(e,t,r,n,a){if(n===1||t===r)return r;var i=a(t,r,n);return e==null||((e.roundValue||e.color)&&(i=Math.round(i)),e.min!==void 0&&(i=Math.max(i,e.min)),e.max!==void 0&&(i=Math.min(i,e.max))),i}function NI(e,t){return e.pfValue!=null||e.value!=null?e.pfValue!=null&&(t==null||t.type.units!=="%")?e.pfValue:e.value:e}function Md(e,t,r,n,a){var i=a!=null?a.type:null;r<0?r=0:r>1&&(r=1);var u=NI(e,a),s=NI(t,a);if(Ht(u)&&Ht(s))return AI(i,u,s,r,n);if(dn(u)&&dn(s)){for(var h=[],p=0;p<s.length;p++){var g=u[p],v=s[p];if(g!=null&&v!=null){var x=AI(i,g,v,r,n);h.push(x)}else h.push(v)}return h}}function tU(e,t,r,n){var a=!n,i=e._private,u=t._private,s=u.easing,h=u.startTime,p=n?e:e.cy(),g=p.style();if(!u.easingImpl)if(s==null)u.easingImpl=my.linear;else{var v;if(dr(s)){var x=g.parse("transition-timing-function",s);v=x.value}else v=s;var S,P;dr(v)?(S=v,P=[]):(S=v[1],P=v.slice(2).map(function(de){return+de})),P.length>0?(S==="spring"&&P.push(u.duration),u.easingImpl=my[S].apply(null,P)):u.easingImpl=my[S]}var N=u.easingImpl,M;if(u.duration===0?M=1:M=(r-h)/u.duration,u.applying&&(M=u.progress),M<0?M=0:M>1&&(M=1),u.delay==null){var I=u.startPosition,A=u.position;if(A&&a&&!e.locked()){var D={};dp(I.x,A.x)&&(D.x=Md(I.x,A.x,M,N)),dp(I.y,A.y)&&(D.y=Md(I.y,A.y,M,N)),e.position(D)}var j=u.startPan,V=u.pan,U=i.pan,$=V!=null&&n;$&&(dp(j.x,V.x)&&(U.x=Md(j.x,V.x,M,N)),dp(j.y,V.y)&&(U.y=Md(j.y,V.y,M,N)),e.emit("pan"));var W=u.startZoom,X=u.zoom,J=X!=null&&n;J&&(dp(W,X)&&(i.zoom=pm(i.minZoom,Md(W,X,M,N),i.maxZoom)),e.emit("zoom")),($||J)&&e.emit("viewport");var Z=u.style;if(Z&&Z.length>0&&a){for(var K=0;K<Z.length;K++){var Y=Z[K],G=Y.name,oe=Y,ie=u.startStyle[G],ce=g.properties[ie.name],fe=Md(ie,oe,M,N,ce);g.overrideBypass(e,G,fe)}e.emit("style")}}return u.progress=M,M}function dp(e,t){return e==null||t==null?!1:Ht(e)&&Ht(t)?!0:!!(e&&t)}function rU(e,t,r,n){var a=t._private;a.started=!0,a.startTime=r-a.progress*a.duration}function MI(e,t){var r=t._private.aniEles,n=[];function a(g,v){var x=g._private,S=x.animation.current,P=x.animation.queue,N=!1;if(S.length===0){var M=P.shift();M&&S.push(M)}for(var I=function(U){for(var $=U.length-1;$>=0;$--){var W=U[$];W()}U.splice(0,U.length)},A=S.length-1;A>=0;A--){var D=S[A],j=D._private;if(j.stopped){S.splice(A,1),j.hooked=!1,j.playing=!1,j.started=!1,I(j.frames);continue}!j.playing&&!j.applying||(j.playing&&j.applying&&(j.applying=!1),j.started||rU(g,D,e),tU(g,D,e,v),j.applying&&(j.applying=!1),I(j.frames),j.step!=null&&j.step(e),D.completed()&&(S.splice(A,1),j.hooked=!1,j.playing=!1,j.started=!1,I(j.completes)),N=!0)}return!v&&S.length===0&&P.length===0&&n.push(g),N}for(var i=!1,u=0;u<r.length;u++){var s=r[u],h=a(s);i=i||h}var p=a(t,!0);(i||p)&&(r.length>0?t.notify("draw",r):t.notify("draw")),r.unmerge(n),t.emit("step")}var nU={animate:Yr.animate(),animation:Yr.animation(),animated:Yr.animated(),clearQueue:Yr.clearQueue(),delay:Yr.delay(),delayAnimation:Yr.delayAnimation(),stop:Yr.stop(),addToAnimationPool:function(t){var r=this;r.styleEnabled()&&r._private.aniEles.merge(t)},stopAnimationLoop:function(){this._private.animationsRunning=!1},startAnimationLoop:function(){var t=this;if(t._private.animationsRunning=!0,!t.styleEnabled())return;function r(){t._private.animationsRunning&&e0(function(i){MI(i,t),r()})}var n=t.renderer();n&&n.beforeRender?n.beforeRender(function(i,u){MI(u,t)},n.beforeRenderPriorities.animations):r()}},aU={qualifierCompare:function(t,r){return t==null||r==null?t==null&&r==null:t.sameText(r)},eventMatches:function(t,r,n){var a=r.qualifier;return a!=null?t!==n.target&&$m(n.target)&&a.matches(n.target):!0},addEventFields:function(t,r){r.cy=t,r.target=t},callbackContext:function(t,r,n){return r.qualifier!=null?n.target:t}},Mv=function(t){return dr(t)?new lu(t):t},rR={createEmitter:function(){var t=this._private;return t.emitter||(t.emitter=new Q0(aU,this)),this},emitter:function(){return this._private.emitter},on:function(t,r,n){return this.emitter().on(t,Mv(r),n),this},removeListener:function(t,r,n){return this.emitter().removeListener(t,Mv(r),n),this},removeAllListeners:function(){return this.emitter().removeAllListeners(),this},one:function(t,r,n){return this.emitter().one(t,Mv(r),n),this},once:function(t,r,n){return this.emitter().one(t,Mv(r),n),this},emit:function(t,r){return this.emitter().emit(t,r),this},emitAndNotify:function(t,r){return this.emit(t),this.notify(t,r),this}};Yr.eventAliasesOn(rR);var s2={png:function(t){var r=this._private.renderer;return t=t||{},r.png(t)},jpg:function(t){var r=this._private.renderer;return t=t||{},t.bg=t.bg||"#fff",r.jpg(t)}};s2.jpeg=s2.jpg;var gy={layout:function(t){var r=this;if(t==null){Tn("Layout options must be specified to make a layout");return}if(t.name==null){Tn("A `name` must be specified to make a layout");return}var n=t.name,a=r.extension("layout",n);if(a==null){Tn("No such layout `"+n+"` found.  Did you forget to import it and `cytoscape.use()` it?");return}var i;dr(t.eles)?i=r.$(t.eles):i=t.eles!=null?t.eles:r.$();var u=new a(xr({},t,{cy:r,eles:i}));return u}};gy.createLayout=gy.makeLayout=gy.layout;var iU={notify:function(t,r){var n=this._private;if(this.batching()){n.batchNotifications=n.batchNotifications||{};var a=n.batchNotifications[t]=n.batchNotifications[t]||this.collection();r!=null&&a.merge(r);return}if(n.notificationsEnabled){var i=this.renderer();this.destroyed()||!i||i.notify(t,r)}},notifications:function(t){var r=this._private;return t===void 0?r.notificationsEnabled:(r.notificationsEnabled=!!t,this)},noNotifications:function(t){this.notifications(!1),t(),this.notifications(!0)},batching:function(){return this._private.batchCount>0},startBatch:function(){var t=this._private;return t.batchCount==null&&(t.batchCount=0),t.batchCount===0&&(t.batchStyleEles=this.collection(),t.batchNotifications={}),t.batchCount++,this},endBatch:function(){var t=this._private;if(t.batchCount===0)return this;if(t.batchCount--,t.batchCount===0){t.batchStyleEles.updateStyle();var r=this.renderer();Object.keys(t.batchNotifications).forEach(function(n){var a=t.batchNotifications[n];a.empty()?r.notify(n):r.notify(n,a)})}return this},batch:function(t){return this.startBatch(),t(),this.endBatch(),this},batchData:function(t){var r=this;return this.batch(function(){for(var n=Object.keys(t),a=0;a<n.length;a++){var i=n[a],u=t[i],s=r.getElementById(i);s.data(u)}})}},sU=Pa({hideEdgesOnViewport:!1,textureOnViewport:!1,motionBlur:!1,motionBlurOpacity:.05,pixelRatio:void 0,desktopTapThreshold:4,touchTapThreshold:8,wheelSensitivity:1,debug:!1,showFps:!1,webgl:!1,webglDebug:!1,webglDebugShowAtlases:!1,webglTexSize:2048,webglTexRows:36,webglTexRowsNodes:18,webglBatchSize:2048,webglTexPerBatch:14,webglBgColor:[255,255,255]}),o2={renderTo:function(t,r,n,a){var i=this._private.renderer;return i.renderTo(t,r,n,a),this},renderer:function(){return this._private.renderer},forceRender:function(){return this.notify("draw"),this},resize:function(){return this.invalidateSize(),this.emitAndNotify("resize"),this},initRenderer:function(t){var r=this,n=r.extension("renderer",t.name);if(n==null){Tn("Can not initialise: No such renderer `".concat(t.name,"` found. Did you forget to import it and `cytoscape.use()` it?"));return}t.wheelSensitivity!==void 0&&Jr("You have set a custom wheel sensitivity.  This will make your app zoom unnaturally when using mainstream mice.  You should change this value from the default only if you can guarantee that all your users will use the same hardware and OS configuration as your current machine.");var a=sU(t);a.cy=r,r._private.renderer=new n(a),this.notify("init")},destroyRenderer:function(){var t=this;t.notify("destroy");var r=t.container();if(r)for(r._cyreg=null;r.childNodes.length>0;)r.removeChild(r.childNodes[0]);t._private.renderer=null,t.mutableElements().forEach(function(n){var a=n._private;a.rscratch={},a.rstyle={},a.animation.current=[],a.animation.queue=[]})},onRender:function(t){return this.on("render",t)},offRender:function(t){return this.off("render",t)}};o2.invalidateDimensions=o2.resize;var vy={collection:function(t,r){return dr(t)?this.$(t):$i(t)?t.collection():dn(t)?(r||(r={}),new ka(this,t,r.unique,r.removed)):new ka(this)},nodes:function(t){var r=this.$(function(n){return n.isNode()});return t?r.filter(t):r},edges:function(t){var r=this.$(function(n){return n.isEdge()});return t?r.filter(t):r},$:function(t){var r=this._private.elements;return t?r.filter(t):r.spawnSelf()},mutableElements:function(){return this._private.elements}};vy.elements=vy.filter=vy.$;var ya={},$p="t",oU="f";ya.apply=function(e){for(var t=this,r=t._private,n=r.cy,a=n.collection(),i=0;i<e.length;i++){var u=e[i],s=t.getContextMeta(u);if(!s.empty){var h=t.getContextStyle(s),p=t.applyContextStyle(s,h,u);u._private.appliedInitStyle?t.updateTransitions(u,p.diffProps):u._private.appliedInitStyle=!0;var g=t.updateStyleHints(u);g&&a.push(u)}}return a};ya.getPropertiesDiff=function(e,t){var r=this,n=r._private.propDiffs=r._private.propDiffs||{},a=e+"-"+t,i=n[a];if(i)return i;for(var u=[],s={},h=0;h<r.length;h++){var p=r[h],g=e[h]===$p,v=t[h]===$p,x=g!==v,S=p.mappedProperties.length>0;if(x||v&&S){var P=void 0;x&&S||x?P=p.properties:S&&(P=p.mappedProperties);for(var N=0;N<P.length;N++){for(var M=P[N],I=M.name,A=!1,D=h+1;D<r.length;D++){var j=r[D],V=t[D]===$p;if(V&&(A=j.properties[M.name]!=null,A))break}!s[I]&&!A&&(s[I]=!0,u.push(I))}}}return n[a]=u,u};ya.getContextMeta=function(e){for(var t=this,r="",n,a=e._private.styleCxtKey||"",i=0;i<t.length;i++){var u=t[i],s=u.selector&&u.selector.matches(e);s?r+=$p:r+=oU}return n=t.getPropertiesDiff(a,r),e._private.styleCxtKey=r,{key:r,diffPropNames:n,empty:n.length===0}};ya.getContextStyle=function(e){var t=e.key,r=this,n=this._private.contextStyles=this._private.contextStyles||{};if(n[t])return n[t];for(var a={_private:{key:t}},i=0;i<r.length;i++){var u=r[i],s=t[i]===$p;if(s)for(var h=0;h<u.properties.length;h++){var p=u.properties[h];a[p.name]=p}}return n[t]=a,a};ya.applyContextStyle=function(e,t,r){for(var n=this,a=e.diffPropNames,i={},u=n.types,s=0;s<a.length;s++){var h=a[s],p=t[h],g=r.pstyle(h);if(!p)if(g)g.bypass?p={name:h,deleteBypassed:!0}:p={name:h,delete:!0};else continue;if(g!==p){if(p.mapped===u.fn&&g!=null&&g.mapping!=null&&g.mapping.value===p.value){var v=g.mapping,x=v.fnValue=p.value(r);if(x===v.prevFnValue)continue}var S=i[h]={prev:g};n.applyParsedProperty(r,p),S.next=r.pstyle(h),S.next&&S.next.bypass&&(S.next=S.next.bypassed)}}return{diffProps:i}};ya.updateStyleHints=function(e){var t=e._private,r=this,n=r.propertyGroupNames,a=r.propertyGroupKeys,i=function(We,ot,xt){return r.getPropertiesHash(We,ot,xt)},u=t.styleKey;if(e.removed())return!1;var s=t.group==="nodes",h=e._private.style;n=Object.keys(h);for(var p=0;p<a.length;p++){var g=a[p];t.styleKeys[g]=[tc,Ud]}for(var v=function(We,ot){return t.styleKeys[ot][0]=dm(We,t.styleKeys[ot][0])},x=function(We,ot){return t.styleKeys[ot][1]=hm(We,t.styleKeys[ot][1])},S=function(We,ot){v(We,ot),x(We,ot)},P=function(We,ot){for(var xt=0;xt<We.length;xt++){var Tt=We.charCodeAt(xt);v(Tt,ot),x(Tt,ot)}},N=2e9,M=function(We){return-128<We&&We<128&&Math.floor(We)!==We?N-(We*1024|0):We},I=0;I<n.length;I++){var A=n[I],D=h[A];if(D!=null){var j=this.properties[A],V=j.type,U=j.groupKey,$=void 0;j.hashOverride!=null?$=j.hashOverride(e,D):D.pfValue!=null&&($=D.pfValue);var W=j.enums==null?D.value:null,X=$!=null,J=W!=null,Z=X||J,K=D.units;if(V.number&&Z&&!V.multiple){var Y=X?$:W;S(M(Y),U),!X&&K!=null&&P(K,U)}else P(D.strValue,U)}}for(var G=[tc,Ud],oe=0;oe<a.length;oe++){var ie=a[oe],ce=t.styleKeys[ie];G[0]=dm(ce[0],G[0]),G[1]=hm(ce[1],G[1])}t.styleKey=S6(G[0],G[1]);var fe=t.styleKeys;t.labelDimsKey=Pl(fe.labelDimensions);var de=i(e,["label"],fe.labelDimensions);if(t.labelKey=Pl(de),t.labelStyleKey=Pl(Ev(fe.commonLabel,de)),!s){var be=i(e,["source-label"],fe.labelDimensions);t.sourceLabelKey=Pl(be),t.sourceLabelStyleKey=Pl(Ev(fe.commonLabel,be));var ge=i(e,["target-label"],fe.labelDimensions);t.targetLabelKey=Pl(ge),t.targetLabelStyleKey=Pl(Ev(fe.commonLabel,ge))}if(s){var xe=t.styleKeys,Le=xe.nodeBody,Oe=xe.nodeBorder,Fe=xe.nodeOutline,et=xe.backgroundImage,nt=xe.compound,mt=xe.pie,it=xe.stripe,ze=[Le,Oe,Fe,et,nt,mt,it].filter(function(He){return He!=null}).reduce(Ev,[tc,Ud]);t.nodeKey=Pl(ze),t.hasPie=mt!=null&&mt[0]!==tc&&mt[1]!==Ud,t.hasStripe=it!=null&&it[0]!==tc&&it[1]!==Ud}return u!==t.styleKey};ya.clearStyleHints=function(e){var t=e._private;t.styleCxtKey="",t.styleKeys={},t.styleKey=null,t.labelKey=null,t.labelStyleKey=null,t.sourceLabelKey=null,t.sourceLabelStyleKey=null,t.targetLabelKey=null,t.targetLabelStyleKey=null,t.nodeKey=null,t.hasPie=null,t.hasStripe=null};ya.applyParsedProperty=function(e,t){var r=this,n=t,a=e._private.style,i,u=r.types,s=r.properties[n.name].type,h=n.bypass,p=a[n.name],g=p&&p.bypass,v=e._private,x="mapping",S=function(Le){return Le==null?null:Le.pfValue!=null?Le.pfValue:Le.value},P=function(){var Le=S(p),Oe=S(n);r.checkTriggers(e,n.name,Le,Oe)};if(t.name==="curve-style"&&e.isEdge()&&(t.value!=="bezier"&&e.isLoop()||t.value==="haystack"&&(e.source().isParent()||e.target().isParent()))&&(n=t=this.parse(t.name,"bezier",h)),n.delete)return a[n.name]=void 0,P(),!0;if(n.deleteBypassed)return p?p.bypass?(p.bypassed=void 0,P(),!0):!1:(P(),!0);if(n.deleteBypass)return p?p.bypass?(a[n.name]=p.bypassed,P(),!0):!1:(P(),!0);var N=function(){Jr("Do not assign mappings to elements without corresponding data (i.e. ele `"+e.id()+"` has no mapping for property `"+n.name+"` with data field `"+n.field+"`); try a `["+n.field+"]` selector to limit scope to elements with `"+n.field+"` defined")};switch(n.mapped){case u.mapData:{for(var M=n.field.split("."),I=v.data,A=0;A<M.length&&I;A++){var D=M[A];I=I[D]}if(I==null)return N(),!1;var j;if(Ht(I)){var V=n.fieldMax-n.fieldMin;V===0?j=0:j=(I-n.fieldMin)/V}else return Jr("Do not use continuous mappers without specifying numeric data (i.e. `"+n.field+": "+I+"` for `"+e.id()+"` is non-numeric)"),!1;if(j<0?j=0:j>1&&(j=1),s.color){var U=n.valueMin[0],$=n.valueMax[0],W=n.valueMin[1],X=n.valueMax[1],J=n.valueMin[2],Z=n.valueMax[2],K=n.valueMin[3]==null?1:n.valueMin[3],Y=n.valueMax[3]==null?1:n.valueMax[3],G=[Math.round(U+($-U)*j),Math.round(W+(X-W)*j),Math.round(J+(Z-J)*j),Math.round(K+(Y-K)*j)];i={bypass:n.bypass,name:n.name,value:G,strValue:"rgb("+G[0]+", "+G[1]+", "+G[2]+")"}}else if(s.number){var oe=n.valueMin+(n.valueMax-n.valueMin)*j;i=this.parse(n.name,oe,n.bypass,x)}else return!1;if(!i)return N(),!1;i.mapping=n,n=i;break}case u.data:{for(var ie=n.field.split("."),ce=v.data,fe=0;fe<ie.length&&ce;fe++){var de=ie[fe];ce=ce[de]}if(ce!=null&&(i=this.parse(n.name,ce,n.bypass,x)),!i)return N(),!1;i.mapping=n,n=i;break}case u.fn:{var be=n.value,ge=n.fnValue!=null?n.fnValue:be(e);if(n.prevFnValue=ge,ge==null)return Jr("Custom function mappers may not return null (i.e. `"+n.name+"` for ele `"+e.id()+"` is null)"),!1;if(i=this.parse(n.name,ge,n.bypass,x),!i)return Jr("Custom function mappers may not return invalid values for the property type (i.e. `"+n.name+"` for ele `"+e.id()+"` is invalid)"),!1;i.mapping=to(n),n=i;break}case void 0:break;default:return!1}return h?(g?n.bypassed=p.bypassed:n.bypassed=p,a[n.name]=n):g?p.bypassed=n:a[n.name]=n,P(),!0};ya.cleanElements=function(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(this.clearStyleHints(n),n.dirtyCompoundBoundsCache(),n.dirtyBoundingBoxCache(),!t)n._private.style={};else for(var a=n._private.style,i=Object.keys(a),u=0;u<i.length;u++){var s=i[u],h=a[s];h!=null&&(h.bypass?h.bypassed=null:a[s]=null)}}};ya.update=function(){var e=this._private.cy,t=e.mutableElements();t.updateStyle()};ya.updateTransitions=function(e,t){var r=this,n=e._private,a=e.pstyle("transition-property").value,i=e.pstyle("transition-duration").pfValue,u=e.pstyle("transition-delay").pfValue;if(a.length>0&&i>0){for(var s={},h=!1,p=0;p<a.length;p++){var g=a[p],v=e.pstyle(g),x=t[g];if(x){var S=x.prev,P=S,N=x.next!=null?x.next:v,M=!1,I=void 0,A=1e-6;P&&(Ht(P.pfValue)&&Ht(N.pfValue)?(M=N.pfValue-P.pfValue,I=P.pfValue+A*M):Ht(P.value)&&Ht(N.value)?(M=N.value-P.value,I=P.value+A*M):dn(P.value)&&dn(N.value)&&(M=P.value[0]!==N.value[0]||P.value[1]!==N.value[1]||P.value[2]!==N.value[2],I=P.strValue),M&&(s[g]=N.strValue,this.applyBypass(e,g,I),h=!0))}}if(!h)return;n.transitioning=!0,new $h(function(D){u>0?e.delayAnimation(u).play().promise().then(D):D()}).then(function(){return e.animation({style:s,duration:i,easing:e.pstyle("transition-timing-function").value,queue:!1}).play().promise()}).then(function(){r.removeBypasses(e,a),e.emitAndNotify("style"),n.transitioning=!1})}else n.transitioning&&(this.removeBypasses(e,a),e.emitAndNotify("style"),n.transitioning=!1)};ya.checkTrigger=function(e,t,r,n,a,i){var u=this.properties[t],s=a(u);e.removed()||s!=null&&s(r,n,e)&&i(u)};ya.checkZOrderTrigger=function(e,t,r,n){var a=this;this.checkTrigger(e,t,r,n,function(i){return i.triggersZOrder},function(){a._private.cy.notify("zorder",e)})};ya.checkBoundsTrigger=function(e,t,r,n){this.checkTrigger(e,t,r,n,function(a){return a.triggersBounds},function(a){e.dirtyCompoundBoundsCache(),e.dirtyBoundingBoxCache()})};ya.checkConnectedEdgesBoundsTrigger=function(e,t,r,n){this.checkTrigger(e,t,r,n,function(a){return a.triggersBoundsOfConnectedEdges},function(a){e.connectedEdges().forEach(function(i){i.dirtyBoundingBoxCache()})})};ya.checkParallelEdgesBoundsTrigger=function(e,t,r,n){this.checkTrigger(e,t,r,n,function(a){return a.triggersBoundsOfParallelEdges},function(a){e.parallelEdges().forEach(function(i){i.dirtyBoundingBoxCache()})})};ya.checkTriggers=function(e,t,r,n){e.dirtyStyleCache(),this.checkZOrderTrigger(e,t,r,n),this.checkBoundsTrigger(e,t,r,n),this.checkConnectedEdgesBoundsTrigger(e,t,r,n),this.checkParallelEdgesBoundsTrigger(e,t,r,n)};var Zm={};Zm.applyBypass=function(e,t,r,n){var a=this,i=[],u=!0;if(t==="*"||t==="**"){if(r!==void 0)for(var s=0;s<a.properties.length;s++){var h=a.properties[s],p=h.name,g=this.parse(p,r,!0);g&&i.push(g)}}else if(dr(t)){var v=this.parse(t,r,!0);v&&i.push(v)}else if(Ur(t)){var x=t;n=r;for(var S=Object.keys(x),P=0;P<S.length;P++){var N=S[P],M=x[N];if(M===void 0&&(M=x[U0(N)]),M!==void 0){var I=this.parse(N,M,!0);I&&i.push(I)}}}else return!1;if(i.length===0)return!1;for(var A=!1,D=0;D<e.length;D++){for(var j=e[D],V={},U=void 0,$=0;$<i.length;$++){var W=i[$];if(n){var X=j.pstyle(W.name);U=V[W.name]={prev:X}}A=this.applyParsedProperty(j,to(W))||A,n&&(U.next=j.pstyle(W.name))}A&&this.updateStyleHints(j),n&&this.updateTransitions(j,V,u)}return A};Zm.overrideBypass=function(e,t,r){t=FS(t);for(var n=0;n<e.length;n++){var a=e[n],i=a._private.style[t],u=this.properties[t].type,s=u.color,h=u.mutiple,p=i?i.pfValue!=null?i.pfValue:i.value:null;!i||!i.bypass?this.applyBypass(a,t,r):(i.value=r,i.pfValue!=null&&(i.pfValue=r),s?i.strValue="rgb("+r.join(",")+")":h?i.strValue=r.join(" "):i.strValue=""+r,this.updateStyleHints(a)),this.checkTriggers(a,t,p,r)}};Zm.removeAllBypasses=function(e,t){return this.removeBypasses(e,this.propertyNames,t)};Zm.removeBypasses=function(e,t,r){for(var n=!0,a=0;a<e.length;a++){for(var i=e[a],u={},s=0;s<t.length;s++){var h=t[s],p=this.properties[h],g=i.pstyle(p.name);if(!(!g||!g.bypass)){var v="",x=this.parse(h,v,!0),S=u[p.name]={prev:g};this.applyParsedProperty(i,x),S.next=i.pstyle(p.name)}}this.updateStyleHints(i),r&&this.updateTransitions(i,u,n)}};var tE={};tE.getEmSizeInPixels=function(){var e=this.containerCss("font-size");return e!=null?parseFloat(e):1};tE.containerCss=function(e){var t=this._private.cy,r=t.container(),n=t.window();if(n&&r&&n.getComputedStyle)return n.getComputedStyle(r).getPropertyValue(e)};var io={};io.getRenderedStyle=function(e,t){return t?this.getStylePropertyValue(e,t,!0):this.getRawStyle(e,!0)};io.getRawStyle=function(e,t){var r=this;if(e=e[0],e){for(var n={},a=0;a<r.properties.length;a++){var i=r.properties[a],u=r.getStylePropertyValue(e,i.name,t);u!=null&&(n[i.name]=u,n[U0(i.name)]=u)}return n}};io.getIndexedStyle=function(e,t,r,n){var a=e.pstyle(t)[r][n];return a??e.cy().style().getDefaultProperty(t)[r][0]};io.getStylePropertyValue=function(e,t,r){var n=this;if(e=e[0],e){var a=n.properties[t];a.alias&&(a=a.pointsTo);var i=a.type,u=e.pstyle(a.name);if(u){var s=u.value,h=u.units,p=u.strValue;if(r&&i.number&&s!=null&&Ht(s)){var g=e.cy().zoom(),v=function(M){return M*g},x=function(M,I){return v(M)+I},S=dn(s),P=S?h.every(function(N){return N!=null}):h!=null;return P?S?s.map(function(N,M){return x(N,h[M])}).join(" "):x(s,h):S?s.map(function(N){return dr(N)?N:""+v(N)}).join(" "):""+v(s)}else if(p!=null)return p}return null}};io.getAnimationStartStyle=function(e,t){for(var r={},n=0;n<t.length;n++){var a=t[n],i=a.name,u=e.pstyle(i);u!==void 0&&(Ur(u)?u=this.parse(i,u.strValue):u=this.parse(i,u)),u&&(r[i]=u)}return r};io.getPropsList=function(e){var t=this,r=[],n=e,a=t.properties;if(n)for(var i=Object.keys(n),u=0;u<i.length;u++){var s=i[u],h=n[s],p=a[s]||a[FS(s)],g=this.parse(p.name,h);g&&r.push(g)}return r};io.getNonDefaultPropertiesHash=function(e,t,r){var n=r.slice(),a,i,u,s,h,p;for(h=0;h<t.length;h++)if(a=t[h],i=e.pstyle(a,!1),i!=null)if(i.pfValue!=null)n[0]=dm(s,n[0]),n[1]=hm(s,n[1]);else for(u=i.strValue,p=0;p<u.length;p++)s=u.charCodeAt(p),n[0]=dm(s,n[0]),n[1]=hm(s,n[1]);return n};io.getPropertiesHash=io.getNonDefaultPropertiesHash;var rx={};rx.appendFromJson=function(e){for(var t=this,r=0;r<e.length;r++){var n=e[r],a=n.selector,i=n.style||n.css,u=Object.keys(i);t.selector(a);for(var s=0;s<u.length;s++){var h=u[s],p=i[h];t.css(h,p)}}return t};rx.fromJson=function(e){var t=this;return t.resetToDefault(),t.appendFromJson(e),t};rx.json=function(){for(var e=[],t=this.defaultLength;t<this.length;t++){for(var r=this[t],n=r.selector,a=r.properties,i={},u=0;u<a.length;u++){var s=a[u];i[s.name]=s.strValue}e.push({selector:n?n.toString():"core",style:i})}return e};var rE={};rE.appendFromString=function(e){var t=this,r=this,n=""+e,a,i,u;n=n.replace(/[/][*](\s|.)+?[*][/]/g,"");function s(){n.length>a.length?n=n.substr(a.length):n=""}function h(){i.length>u.length?i=i.substr(u.length):i=""}for(;;){var p=n.match(/^\s*$/);if(p)break;var g=n.match(/^\s*((?:.|\s)+?)\s*\{((?:.|\s)+?)\}/);if(!g){Jr("Halting stylesheet parsing: String stylesheet contains more to parse but no selector and block found in: "+n);break}a=g[0];var v=g[1];if(v!=="core"){var x=new lu(v);if(x.invalid){Jr("Skipping parsing of block: Invalid selector found in string stylesheet: "+v),s();continue}}var S=g[2],P=!1;i=S;for(var N=[];;){var M=i.match(/^\s*$/);if(M)break;var I=i.match(/^\s*(.+?)\s*:\s*(.+?)(?:\s*;|\s*$)/);if(!I){Jr("Skipping parsing of block: Invalid formatting of style property and value definitions found in:"+S),P=!0;break}u=I[0];var A=I[1],D=I[2],j=t.properties[A];if(!j){Jr("Skipping property: Invalid property name in: "+u),h();continue}var V=r.parse(A,D);if(!V){Jr("Skipping property: Invalid property definition in: "+u),h();continue}N.push({name:A,val:D}),h()}if(P){s();break}r.selector(v);for(var U=0;U<N.length;U++){var $=N[U];r.css($.name,$.val)}s()}return r};rE.fromString=function(e){var t=this;return t.resetToDefault(),t.appendFromString(e),t};var qn={};(function(){var e=ea,t=t6,r=n6,n=a6,a=i6,i=function(He){return"^"+He+"\\s*\\(\\s*([\\w\\.]+)\\s*\\)$"},u=function(He){var We=e+"|\\w+|"+t+"|"+r+"|"+n+"|"+a;return"^"+He+"\\s*\\(([\\w\\.]+)\\s*\\,\\s*("+e+")\\s*\\,\\s*("+e+")\\s*,\\s*("+We+")\\s*\\,\\s*("+We+")\\)$"},s=[`^url\\s*\\(\\s*['"]?(.+?)['"]?\\s*\\)$`,"^(none)$","^(.+)$"];qn.types={time:{number:!0,min:0,units:"s|ms",implicitUnits:"ms"},percent:{number:!0,min:0,max:100,units:"%",implicitUnits:"%"},percentages:{number:!0,min:0,max:100,units:"%",implicitUnits:"%",multiple:!0},zeroOneNumber:{number:!0,min:0,max:1,unitless:!0},zeroOneNumbers:{number:!0,min:0,max:1,unitless:!0,multiple:!0},nOneOneNumber:{number:!0,min:-1,max:1,unitless:!0},nonNegativeInt:{number:!0,min:0,integer:!0,unitless:!0},nonNegativeNumber:{number:!0,min:0,unitless:!0},position:{enums:["parent","origin"]},nodeSize:{number:!0,min:0,enums:["label"]},number:{number:!0,unitless:!0},numbers:{number:!0,unitless:!0,multiple:!0},positiveNumber:{number:!0,unitless:!0,min:0,strictMin:!0},size:{number:!0,min:0},bidirectionalSize:{number:!0},bidirectionalSizeMaybePercent:{number:!0,allowPercent:!0},bidirectionalSizes:{number:!0,multiple:!0},sizeMaybePercent:{number:!0,min:0,allowPercent:!0},axisDirection:{enums:["horizontal","leftward","rightward","vertical","upward","downward","auto"]},axisDirectionExplicit:{enums:["leftward","rightward","upward","downward"]},axisDirectionPrimary:{enums:["horizontal","vertical"]},paddingRelativeTo:{enums:["width","height","average","min","max"]},bgWH:{number:!0,min:0,allowPercent:!0,enums:["auto"],multiple:!0},bgPos:{number:!0,allowPercent:!0,multiple:!0},bgRelativeTo:{enums:["inner","include-padding"],multiple:!0},bgRepeat:{enums:["repeat","repeat-x","repeat-y","no-repeat"],multiple:!0},bgFit:{enums:["none","contain","cover"],multiple:!0},bgCrossOrigin:{enums:["anonymous","use-credentials","null"],multiple:!0},bgClip:{enums:["none","node"],multiple:!0},bgContainment:{enums:["inside","over"],multiple:!0},boxSelection:{enums:["contain","overlap","none"]},color:{color:!0},colors:{color:!0,multiple:!0},fill:{enums:["solid","linear-gradient","radial-gradient"]},bool:{enums:["yes","no"]},bools:{enums:["yes","no"],multiple:!0},lineStyle:{enums:["solid","dotted","dashed"]},lineCap:{enums:["butt","round","square"]},linePosition:{enums:["center","inside","outside"]},lineJoin:{enums:["round","bevel","miter"]},borderStyle:{enums:["solid","dotted","dashed","double"]},curveStyle:{enums:["bezier","unbundled-bezier","haystack","segments","straight","straight-triangle","taxi","round-segments","round-taxi"]},radiusType:{enums:["arc-radius","influence-radius"],multiple:!0},fontFamily:{regex:'^([\\w- \\"]+(?:\\s*,\\s*[\\w- \\"]+)*)$'},fontStyle:{enums:["italic","normal","oblique"]},fontWeight:{enums:["normal","bold","bolder","lighter","100","200","300","400","500","600","800","900",100,200,300,400,500,600,700,800,900]},textDecoration:{enums:["none","underline","overline","line-through"]},textTransform:{enums:["none","uppercase","lowercase"]},textWrap:{enums:["none","wrap","ellipsis"]},textOverflowWrap:{enums:["whitespace","anywhere"]},textBackgroundShape:{enums:["rectangle","roundrectangle","round-rectangle","circle"]},nodeShape:{enums:["rectangle","roundrectangle","round-rectangle","cutrectangle","cut-rectangle","bottomroundrectangle","bottom-round-rectangle","barrel","ellipse","triangle","round-triangle","square","pentagon","round-pentagon","hexagon","round-hexagon","concavehexagon","concave-hexagon","heptagon","round-heptagon","octagon","round-octagon","tag","round-tag","star","diamond","round-diamond","vee","rhomboid","right-rhomboid","polygon"]},overlayShape:{enums:["roundrectangle","round-rectangle","ellipse"]},cornerRadius:{number:!0,min:0,units:"px|em",implicitUnits:"px",enums:["auto"]},compoundIncludeLabels:{enums:["include","exclude"]},arrowShape:{enums:["tee","triangle","triangle-tee","circle-triangle","triangle-cross","triangle-backcurve","vee","square","circle","diamond","chevron","none"]},arrowFill:{enums:["filled","hollow"]},arrowWidth:{number:!0,units:"%|px|em",implicitUnits:"px",enums:["match-line"]},display:{enums:["element","none"]},visibility:{enums:["hidden","visible"]},zCompoundDepth:{enums:["bottom","orphan","auto","top"]},zIndexCompare:{enums:["auto","manual"]},valign:{enums:["top","center","bottom"]},halign:{enums:["left","center","right"]},justification:{enums:["left","center","right","auto"]},text:{string:!0},data:{mapping:!0,regex:i("data")},layoutData:{mapping:!0,regex:i("layoutData")},scratch:{mapping:!0,regex:i("scratch")},mapData:{mapping:!0,regex:u("mapData")},mapLayoutData:{mapping:!0,regex:u("mapLayoutData")},mapScratch:{mapping:!0,regex:u("mapScratch")},fn:{mapping:!0,fn:!0},url:{regexes:s,singleRegexMatchValue:!0},urls:{regexes:s,singleRegexMatchValue:!0,multiple:!0},propList:{propList:!0},angle:{number:!0,units:"deg|rad",implicitUnits:"rad"},textRotation:{number:!0,units:"deg|rad",implicitUnits:"rad",enums:["none","autorotate"]},polygonPointList:{number:!0,multiple:!0,evenMultiple:!0,min:-1,max:1,unitless:!0},edgeDistances:{enums:["intersection","node-position","endpoints"]},edgeEndpoint:{number:!0,multiple:!0,units:"%|px|em|deg|rad",implicitUnits:"px",enums:["inside-to-node","outside-to-node","outside-to-node-or-label","outside-to-line","outside-to-line-or-label"],singleEnum:!0,validate:function(He,We){switch(He.length){case 2:return We[0]!=="deg"&&We[0]!=="rad"&&We[1]!=="deg"&&We[1]!=="rad";case 1:return dr(He[0])||We[0]==="deg"||We[0]==="rad";default:return!1}}},easing:{regexes:["^(spring)\\s*\\(\\s*("+e+")\\s*,\\s*("+e+")\\s*\\)$","^(cubic-bezier)\\s*\\(\\s*("+e+")\\s*,\\s*("+e+")\\s*,\\s*("+e+")\\s*,\\s*("+e+")\\s*\\)$"],enums:["linear","ease","ease-in","ease-out","ease-in-out","ease-in-sine","ease-out-sine","ease-in-out-sine","ease-in-quad","ease-out-quad","ease-in-out-quad","ease-in-cubic","ease-out-cubic","ease-in-out-cubic","ease-in-quart","ease-out-quart","ease-in-out-quart","ease-in-quint","ease-out-quint","ease-in-out-quint","ease-in-expo","ease-out-expo","ease-in-out-expo","ease-in-circ","ease-out-circ","ease-in-out-circ"]},gradientDirection:{enums:["to-bottom","to-top","to-left","to-right","to-bottom-right","to-bottom-left","to-top-right","to-top-left","to-right-bottom","to-left-bottom","to-right-top","to-left-top"]},boundsExpansion:{number:!0,multiple:!0,min:0,validate:function(He){var We=He.length;return We===1||We===2||We===4}}};var h={zeroNonZero:function(He,We){return(He==null||We==null)&&He!==We||He==0&&We!=0?!0:He!=0&&We==0},any:function(He,We){return He!=We},emptyNonEmpty:function(He,We){var ot=iu(He),xt=iu(We);return ot&&!xt||!ot&&xt}},p=qn.types,g=[{name:"label",type:p.text,triggersBounds:h.any,triggersZOrder:h.emptyNonEmpty},{name:"text-rotation",type:p.textRotation,triggersBounds:h.any},{name:"text-margin-x",type:p.bidirectionalSize,triggersBounds:h.any},{name:"text-margin-y",type:p.bidirectionalSize,triggersBounds:h.any}],v=[{name:"source-label",type:p.text,triggersBounds:h.any},{name:"source-text-rotation",type:p.textRotation,triggersBounds:h.any},{name:"source-text-margin-x",type:p.bidirectionalSize,triggersBounds:h.any},{name:"source-text-margin-y",type:p.bidirectionalSize,triggersBounds:h.any},{name:"source-text-offset",type:p.size,triggersBounds:h.any}],x=[{name:"target-label",type:p.text,triggersBounds:h.any},{name:"target-text-rotation",type:p.textRotation,triggersBounds:h.any},{name:"target-text-margin-x",type:p.bidirectionalSize,triggersBounds:h.any},{name:"target-text-margin-y",type:p.bidirectionalSize,triggersBounds:h.any},{name:"target-text-offset",type:p.size,triggersBounds:h.any}],S=[{name:"font-family",type:p.fontFamily,triggersBounds:h.any},{name:"font-style",type:p.fontStyle,triggersBounds:h.any},{name:"font-weight",type:p.fontWeight,triggersBounds:h.any},{name:"font-size",type:p.size,triggersBounds:h.any},{name:"text-transform",type:p.textTransform,triggersBounds:h.any},{name:"text-wrap",type:p.textWrap,triggersBounds:h.any},{name:"text-overflow-wrap",type:p.textOverflowWrap,triggersBounds:h.any},{name:"text-max-width",type:p.size,triggersBounds:h.any},{name:"text-outline-width",type:p.size,triggersBounds:h.any},{name:"line-height",type:p.positiveNumber,triggersBounds:h.any}],P=[{name:"text-valign",type:p.valign,triggersBounds:h.any},{name:"text-halign",type:p.halign,triggersBounds:h.any},{name:"color",type:p.color},{name:"text-outline-color",type:p.color},{name:"text-outline-opacity",type:p.zeroOneNumber},{name:"text-background-color",type:p.color},{name:"text-background-opacity",type:p.zeroOneNumber},{name:"text-background-padding",type:p.size,triggersBounds:h.any},{name:"text-border-opacity",type:p.zeroOneNumber},{name:"text-border-color",type:p.color},{name:"text-border-width",type:p.size,triggersBounds:h.any},{name:"text-border-style",type:p.borderStyle,triggersBounds:h.any},{name:"text-background-shape",type:p.textBackgroundShape,triggersBounds:h.any},{name:"text-justification",type:p.justification},{name:"box-select-labels",type:p.bool,triggersBounds:h.any}],N=[{name:"events",type:p.bool,triggersZOrder:h.any},{name:"text-events",type:p.bool,triggersZOrder:h.any},{name:"box-selection",type:p.boxSelection,triggersZOrder:h.any}],M=[{name:"display",type:p.display,triggersZOrder:h.any,triggersBounds:h.any,triggersBoundsOfConnectedEdges:h.any,triggersBoundsOfParallelEdges:function(He,We,ot){return He===We?!1:ot.pstyle("curve-style").value==="bezier"}},{name:"visibility",type:p.visibility,triggersZOrder:h.any},{name:"opacity",type:p.zeroOneNumber,triggersZOrder:h.zeroNonZero},{name:"text-opacity",type:p.zeroOneNumber},{name:"min-zoomed-font-size",type:p.size},{name:"z-compound-depth",type:p.zCompoundDepth,triggersZOrder:h.any},{name:"z-index-compare",type:p.zIndexCompare,triggersZOrder:h.any},{name:"z-index",type:p.number,triggersZOrder:h.any}],I=[{name:"overlay-padding",type:p.size,triggersBounds:h.any},{name:"overlay-color",type:p.color},{name:"overlay-opacity",type:p.zeroOneNumber,triggersBounds:h.zeroNonZero},{name:"overlay-shape",type:p.overlayShape,triggersBounds:h.any},{name:"overlay-corner-radius",type:p.cornerRadius}],A=[{name:"underlay-padding",type:p.size,triggersBounds:h.any},{name:"underlay-color",type:p.color},{name:"underlay-opacity",type:p.zeroOneNumber,triggersBounds:h.zeroNonZero},{name:"underlay-shape",type:p.overlayShape,triggersBounds:h.any},{name:"underlay-corner-radius",type:p.cornerRadius}],D=[{name:"transition-property",type:p.propList},{name:"transition-duration",type:p.time},{name:"transition-delay",type:p.time},{name:"transition-timing-function",type:p.easing}],j=function(He,We){return We.value==="label"?-He.poolIndex():We.pfValue},V=[{name:"height",type:p.nodeSize,triggersBounds:h.any,hashOverride:j},{name:"width",type:p.nodeSize,triggersBounds:h.any,hashOverride:j},{name:"shape",type:p.nodeShape,triggersBounds:h.any},{name:"shape-polygon-points",type:p.polygonPointList,triggersBounds:h.any},{name:"corner-radius",type:p.cornerRadius},{name:"background-color",type:p.color},{name:"background-fill",type:p.fill},{name:"background-opacity",type:p.zeroOneNumber},{name:"background-blacken",type:p.nOneOneNumber},{name:"background-gradient-stop-colors",type:p.colors},{name:"background-gradient-stop-positions",type:p.percentages},{name:"background-gradient-direction",type:p.gradientDirection},{name:"padding",type:p.sizeMaybePercent,triggersBounds:h.any},{name:"padding-relative-to",type:p.paddingRelativeTo,triggersBounds:h.any},{name:"bounds-expansion",type:p.boundsExpansion,triggersBounds:h.any}],U=[{name:"border-color",type:p.color},{name:"border-opacity",type:p.zeroOneNumber},{name:"border-width",type:p.size,triggersBounds:h.any},{name:"border-style",type:p.borderStyle},{name:"border-cap",type:p.lineCap},{name:"border-join",type:p.lineJoin},{name:"border-dash-pattern",type:p.numbers},{name:"border-dash-offset",type:p.number},{name:"border-position",type:p.linePosition}],$=[{name:"outline-color",type:p.color},{name:"outline-opacity",type:p.zeroOneNumber},{name:"outline-width",type:p.size,triggersBounds:h.any},{name:"outline-style",type:p.borderStyle},{name:"outline-offset",type:p.size,triggersBounds:h.any}],W=[{name:"background-image",type:p.urls},{name:"background-image-crossorigin",type:p.bgCrossOrigin},{name:"background-image-opacity",type:p.zeroOneNumbers},{name:"background-image-containment",type:p.bgContainment},{name:"background-image-smoothing",type:p.bools},{name:"background-position-x",type:p.bgPos},{name:"background-position-y",type:p.bgPos},{name:"background-width-relative-to",type:p.bgRelativeTo},{name:"background-height-relative-to",type:p.bgRelativeTo},{name:"background-repeat",type:p.bgRepeat},{name:"background-fit",type:p.bgFit},{name:"background-clip",type:p.bgClip},{name:"background-width",type:p.bgWH},{name:"background-height",type:p.bgWH},{name:"background-offset-x",type:p.bgPos},{name:"background-offset-y",type:p.bgPos}],X=[{name:"position",type:p.position,triggersBounds:h.any},{name:"compound-sizing-wrt-labels",type:p.compoundIncludeLabels,triggersBounds:h.any},{name:"min-width",type:p.size,triggersBounds:h.any},{name:"min-width-bias-left",type:p.sizeMaybePercent,triggersBounds:h.any},{name:"min-width-bias-right",type:p.sizeMaybePercent,triggersBounds:h.any},{name:"min-height",type:p.size,triggersBounds:h.any},{name:"min-height-bias-top",type:p.sizeMaybePercent,triggersBounds:h.any},{name:"min-height-bias-bottom",type:p.sizeMaybePercent,triggersBounds:h.any}],J=[{name:"line-style",type:p.lineStyle},{name:"line-color",type:p.color},{name:"line-fill",type:p.fill},{name:"line-cap",type:p.lineCap},{name:"line-opacity",type:p.zeroOneNumber},{name:"line-dash-pattern",type:p.numbers},{name:"line-dash-offset",type:p.number},{name:"line-outline-width",type:p.size},{name:"line-outline-color",type:p.color},{name:"line-gradient-stop-colors",type:p.colors},{name:"line-gradient-stop-positions",type:p.percentages},{name:"curve-style",type:p.curveStyle,triggersBounds:h.any,triggersBoundsOfParallelEdges:function(He,We){return He===We?!1:He==="bezier"||We==="bezier"}},{name:"haystack-radius",type:p.zeroOneNumber,triggersBounds:h.any},{name:"source-endpoint",type:p.edgeEndpoint,triggersBounds:h.any},{name:"target-endpoint",type:p.edgeEndpoint,triggersBounds:h.any},{name:"control-point-step-size",type:p.size,triggersBounds:h.any},{name:"control-point-distances",type:p.bidirectionalSizes,triggersBounds:h.any},{name:"control-point-weights",type:p.numbers,triggersBounds:h.any},{name:"segment-distances",type:p.bidirectionalSizes,triggersBounds:h.any},{name:"segment-weights",type:p.numbers,triggersBounds:h.any},{name:"segment-radii",type:p.numbers,triggersBounds:h.any},{name:"radius-type",type:p.radiusType,triggersBounds:h.any},{name:"taxi-turn",type:p.bidirectionalSizeMaybePercent,triggersBounds:h.any},{name:"taxi-turn-min-distance",type:p.size,triggersBounds:h.any},{name:"taxi-direction",type:p.axisDirection,triggersBounds:h.any},{name:"taxi-radius",type:p.number,triggersBounds:h.any},{name:"edge-distances",type:p.edgeDistances,triggersBounds:h.any},{name:"arrow-scale",type:p.positiveNumber,triggersBounds:h.any},{name:"loop-direction",type:p.angle,triggersBounds:h.any},{name:"loop-sweep",type:p.angle,triggersBounds:h.any},{name:"source-distance-from-node",type:p.size,triggersBounds:h.any},{name:"target-distance-from-node",type:p.size,triggersBounds:h.any}],Z=[{name:"ghost",type:p.bool,triggersBounds:h.any},{name:"ghost-offset-x",type:p.bidirectionalSize,triggersBounds:h.any},{name:"ghost-offset-y",type:p.bidirectionalSize,triggersBounds:h.any},{name:"ghost-opacity",type:p.zeroOneNumber}],K=[{name:"selection-box-color",type:p.color},{name:"selection-box-opacity",type:p.zeroOneNumber},{name:"selection-box-border-color",type:p.color},{name:"selection-box-border-width",type:p.size},{name:"active-bg-color",type:p.color},{name:"active-bg-opacity",type:p.zeroOneNumber},{name:"active-bg-size",type:p.size},{name:"outside-texture-bg-color",type:p.color},{name:"outside-texture-bg-opacity",type:p.zeroOneNumber}],Y=[];qn.pieBackgroundN=16,Y.push({name:"pie-size",type:p.sizeMaybePercent}),Y.push({name:"pie-hole",type:p.sizeMaybePercent}),Y.push({name:"pie-start-angle",type:p.angle});for(var G=1;G<=qn.pieBackgroundN;G++)Y.push({name:"pie-"+G+"-background-color",type:p.color}),Y.push({name:"pie-"+G+"-background-size",type:p.percent}),Y.push({name:"pie-"+G+"-background-opacity",type:p.zeroOneNumber});var oe=[];qn.stripeBackgroundN=16,oe.push({name:"stripe-size",type:p.sizeMaybePercent}),oe.push({name:"stripe-direction",type:p.axisDirectionPrimary});for(var ie=1;ie<=qn.stripeBackgroundN;ie++)oe.push({name:"stripe-"+ie+"-background-color",type:p.color}),oe.push({name:"stripe-"+ie+"-background-size",type:p.percent}),oe.push({name:"stripe-"+ie+"-background-opacity",type:p.zeroOneNumber});var ce=[],fe=qn.arrowPrefixes=["source","mid-source","target","mid-target"];[{name:"arrow-shape",type:p.arrowShape,triggersBounds:h.any},{name:"arrow-color",type:p.color},{name:"arrow-fill",type:p.arrowFill},{name:"arrow-width",type:p.arrowWidth}].forEach(function(ze){fe.forEach(function(He){var We=He+"-"+ze.name,ot=ze.type,xt=ze.triggersBounds;ce.push({name:We,type:ot,triggersBounds:xt})})},{});var de=qn.properties=[].concat(N,D,M,I,A,Z,P,S,g,v,x,V,U,$,W,Y,oe,X,J,ce,K),be=qn.propertyGroups={behavior:N,transition:D,visibility:M,overlay:I,underlay:A,ghost:Z,commonLabel:P,labelDimensions:S,mainLabel:g,sourceLabel:v,targetLabel:x,nodeBody:V,nodeBorder:U,nodeOutline:$,backgroundImage:W,pie:Y,stripe:oe,compound:X,edgeLine:J,edgeArrow:ce,core:K},ge=qn.propertyGroupNames={},xe=qn.propertyGroupKeys=Object.keys(be);xe.forEach(function(ze){ge[ze]=be[ze].map(function(He){return He.name}),be[ze].forEach(function(He){return He.groupKey=ze})});var Le=qn.aliases=[{name:"content",pointsTo:"label"},{name:"control-point-distance",pointsTo:"control-point-distances"},{name:"control-point-weight",pointsTo:"control-point-weights"},{name:"segment-distance",pointsTo:"segment-distances"},{name:"segment-weight",pointsTo:"segment-weights"},{name:"segment-radius",pointsTo:"segment-radii"},{name:"edge-text-rotation",pointsTo:"text-rotation"},{name:"padding-left",pointsTo:"padding"},{name:"padding-right",pointsTo:"padding"},{name:"padding-top",pointsTo:"padding"},{name:"padding-bottom",pointsTo:"padding"}];qn.propertyNames=de.map(function(ze){return ze.name});for(var Oe=0;Oe<de.length;Oe++){var Fe=de[Oe];de[Fe.name]=Fe}for(var et=0;et<Le.length;et++){var nt=Le[et],mt=de[nt.pointsTo],it={name:nt.name,alias:!0,pointsTo:mt};de.push(it),de[nt.name]=it}})();qn.getDefaultProperty=function(e){return this.getDefaultProperties()[e]};qn.getDefaultProperties=function(){var e=this._private;if(e.defaultProperties!=null)return e.defaultProperties;for(var t=xr({"selection-box-color":"#ddd","selection-box-opacity":.65,"selection-box-border-color":"#aaa","selection-box-border-width":1,"active-bg-color":"black","active-bg-opacity":.15,"active-bg-size":30,"outside-texture-bg-color":"#000","outside-texture-bg-opacity":.125,events:"yes","text-events":"no","text-valign":"top","text-halign":"center","text-justification":"auto","line-height":1,color:"#000","box-selection":"contain","text-outline-color":"#000","text-outline-width":0,"text-outline-opacity":1,"text-opacity":1,"text-decoration":"none","text-transform":"none","text-wrap":"none","text-overflow-wrap":"whitespace","text-max-width":9999,"text-background-color":"#000","text-background-opacity":0,"text-background-shape":"rectangle","text-background-padding":0,"text-border-opacity":0,"text-border-width":0,"text-border-style":"solid","text-border-color":"#000","font-family":"Helvetica Neue, Helvetica, sans-serif","font-style":"normal","font-weight":"normal","font-size":16,"min-zoomed-font-size":0,"text-rotation":"none","source-text-rotation":"none","target-text-rotation":"none",visibility:"visible",display:"element",opacity:1,"z-compound-depth":"auto","z-index-compare":"auto","z-index":0,label:"","text-margin-x":0,"text-margin-y":0,"source-label":"","source-text-offset":0,"source-text-margin-x":0,"source-text-margin-y":0,"target-label":"","target-text-offset":0,"target-text-margin-x":0,"target-text-margin-y":0,"overlay-opacity":0,"overlay-color":"#000","overlay-padding":10,"overlay-shape":"round-rectangle","overlay-corner-radius":"auto","underlay-opacity":0,"underlay-color":"#000","underlay-padding":10,"underlay-shape":"round-rectangle","underlay-corner-radius":"auto","transition-property":"none","transition-duration":0,"transition-delay":0,"transition-timing-function":"linear","box-select-labels":"no","background-blacken":0,"background-color":"#999","background-fill":"solid","background-opacity":1,"background-image":"none","background-image-crossorigin":"anonymous","background-image-opacity":1,"background-image-containment":"inside","background-image-smoothing":"yes","background-position-x":"50%","background-position-y":"50%","background-offset-x":0,"background-offset-y":0,"background-width-relative-to":"include-padding","background-height-relative-to":"include-padding","background-repeat":"no-repeat","background-fit":"none","background-clip":"node","background-width":"auto","background-height":"auto","border-color":"#000","border-opacity":1,"border-width":0,"border-style":"solid","border-dash-pattern":[4,2],"border-dash-offset":0,"border-cap":"butt","border-join":"miter","border-position":"center","outline-color":"#999","outline-opacity":1,"outline-width":0,"outline-offset":0,"outline-style":"solid",height:30,width:30,shape:"ellipse","shape-polygon-points":"-1, -1,   1, -1,   1, 1,   -1, 1","corner-radius":"auto","bounds-expansion":0,"background-gradient-direction":"to-bottom","background-gradient-stop-colors":"#999","background-gradient-stop-positions":"0%",ghost:"no","ghost-offset-y":0,"ghost-offset-x":0,"ghost-opacity":0,padding:0,"padding-relative-to":"width",position:"origin","compound-sizing-wrt-labels":"include","min-width":0,"min-width-bias-left":0,"min-width-bias-right":0,"min-height":0,"min-height-bias-top":0,"min-height-bias-bottom":0},{"pie-size":"100%","pie-hole":0,"pie-start-angle":"0deg"},[{name:"pie-{{i}}-background-color",value:"black"},{name:"pie-{{i}}-background-size",value:"0%"},{name:"pie-{{i}}-background-opacity",value:1}].reduce(function(h,p){for(var g=1;g<=qn.pieBackgroundN;g++){var v=p.name.replace("{{i}}",g),x=p.value;h[v]=x}return h},{}),{"stripe-size":"100%","stripe-direction":"horizontal"},[{name:"stripe-{{i}}-background-color",value:"black"},{name:"stripe-{{i}}-background-size",value:"0%"},{name:"stripe-{{i}}-background-opacity",value:1}].reduce(function(h,p){for(var g=1;g<=qn.stripeBackgroundN;g++){var v=p.name.replace("{{i}}",g),x=p.value;h[v]=x}return h},{}),{"line-style":"solid","line-color":"#999","line-fill":"solid","line-cap":"butt","line-opacity":1,"line-outline-width":0,"line-outline-color":"#000","line-gradient-stop-colors":"#999","line-gradient-stop-positions":"0%","control-point-step-size":40,"control-point-weights":.5,"segment-weights":.5,"segment-distances":20,"segment-radii":15,"radius-type":"arc-radius","taxi-turn":"50%","taxi-radius":15,"taxi-turn-min-distance":10,"taxi-direction":"auto","edge-distances":"intersection","curve-style":"haystack","haystack-radius":0,"arrow-scale":1,"loop-direction":"-45deg","loop-sweep":"-90deg","source-distance-from-node":0,"target-distance-from-node":0,"source-endpoint":"outside-to-node","target-endpoint":"outside-to-node","line-dash-pattern":[6,3],"line-dash-offset":0},[{name:"arrow-shape",value:"none"},{name:"arrow-color",value:"#999"},{name:"arrow-fill",value:"filled"},{name:"arrow-width",value:1}].reduce(function(h,p){return qn.arrowPrefixes.forEach(function(g){var v=g+"-"+p.name,x=p.value;h[v]=x}),h},{})),r={},n=0;n<this.properties.length;n++){var a=this.properties[n];if(!a.pointsTo){var i=a.name,u=t[i],s=this.parse(i,u);r[i]=s}}return e.defaultProperties=r,e.defaultProperties};qn.addDefaultStylesheet=function(){this.selector(":parent").css({shape:"rectangle",padding:10,"background-color":"#eee","border-color":"#ccc","border-width":1}).selector("edge").css({width:3}).selector(":loop").css({"curve-style":"bezier"}).selector("edge:compound").css({"curve-style":"bezier","source-endpoint":"outside-to-line","target-endpoint":"outside-to-line"}).selector(":selected").css({"background-color":"#0169D9","line-color":"#0169D9","source-arrow-color":"#0169D9","target-arrow-color":"#0169D9","mid-source-arrow-color":"#0169D9","mid-target-arrow-color":"#0169D9"}).selector(":parent:selected").css({"background-color":"#CCE1F9","border-color":"#aec8e5"}).selector(":active").css({"overlay-color":"black","overlay-padding":10,"overlay-opacity":.25}),this.defaultLength=this.length};var nx={};nx.parse=function(e,t,r,n){var a=this;if(Nn(t))return a.parseImplWarn(e,t,r,n);var i=n==="mapping"||n===!0||n===!1||n==null?"dontcare":n,u=r?"t":"f",s=""+t,h=hz(e,s,u,i),p=a.propCache=a.propCache||[],g;return(g=p[h])||(g=p[h]=a.parseImplWarn(e,t,r,n)),(r||n==="mapping")&&(g=to(g),g&&(g.value=to(g.value))),g};nx.parseImplWarn=function(e,t,r,n){var a=this.parseImpl(e,t,r,n);return!a&&t!=null&&Jr("The style property `".concat(e,": ").concat(t,"` is invalid")),a&&(a.name==="width"||a.name==="height")&&t==="label"&&Jr("The style value of `label` is deprecated for `"+a.name+"`"),a};nx.parseImpl=function(e,t,r,n){var a=this;e=FS(e);var i=a.properties[e],u=t,s=a.types;if(!i||t===void 0)return null;i.alias&&(i=i.pointsTo,e=i.name);var h=dr(t);h&&(t=t.trim());var p=i.type;if(!p)return null;if(r&&(t===""||t===null))return{name:e,value:t,bypass:!0,deleteBypass:!0};if(Nn(t))return{name:e,value:t,strValue:"fn",mapped:s.fn,bypass:r};var g,v;if(!(!h||n||t.length<7||t[1]!=="a")){if(t.length>=7&&t[0]==="d"&&(g=new RegExp(s.data.regex).exec(t))){if(r)return!1;var x=s.data;return{name:e,value:g,strValue:""+t,mapped:x,field:g[1],bypass:r}}else if(t.length>=10&&t[0]==="m"&&(v=new RegExp(s.mapData.regex).exec(t))){if(r||p.multiple)return!1;var S=s.mapData;if(!(p.color||p.number))return!1;var P=this.parse(e,v[4]);if(!P||P.mapped)return!1;var N=this.parse(e,v[5]);if(!N||N.mapped)return!1;if(P.pfValue===N.pfValue||P.strValue===N.strValue)return Jr("`"+e+": "+t+"` is not a valid mapper because the output range is zero; converting to `"+e+": "+P.strValue+"`"),this.parse(e,P.strValue);if(p.color){var M=P.value,I=N.value,A=M[0]===I[0]&&M[1]===I[1]&&M[2]===I[2]&&(M[3]===I[3]||(M[3]==null||M[3]===1)&&(I[3]==null||I[3]===1));if(A)return!1}return{name:e,value:v,strValue:""+t,mapped:S,field:v[1],fieldMin:parseFloat(v[2]),fieldMax:parseFloat(v[3]),valueMin:P.value,valueMax:N.value,bypass:r}}}if(p.multiple&&n!=="multiple"){var D;if(h?D=t.split(/\s+/):dn(t)?D=t:D=[t],p.evenMultiple&&D.length%2!==0)return null;for(var j=[],V=[],U=[],$="",W=!1,X=0;X<D.length;X++){var J=a.parse(e,D[X],r,"multiple");W=W||dr(J.value),j.push(J.value),U.push(J.pfValue!=null?J.pfValue:J.value),V.push(J.units),$+=(X>0?" ":"")+J.strValue}return p.validate&&!p.validate(j,V)?null:p.singleEnum&&W?j.length===1&&dr(j[0])?{name:e,value:j[0],strValue:j[0],bypass:r}:null:{name:e,value:j,pfValue:U,strValue:$,bypass:r,units:V}}var Z=function(){for(var it=0;it<p.enums.length;it++){var ze=p.enums[it];if(ze===t)return{name:e,value:t,strValue:""+t,bypass:r}}return null};if(p.number){var K,Y="px";if(p.units&&(K=p.units),p.implicitUnits&&(Y=p.implicitUnits),!p.unitless)if(h){var G="px|em"+(p.allowPercent?"|\\%":"");K&&(G=K);var oe=t.match("^("+ea+")("+G+")?$");oe&&(t=oe[1],K=oe[2]||Y)}else(!K||p.implicitUnits)&&(K=Y);if(t=parseFloat(t),isNaN(t)&&p.enums===void 0)return null;if(isNaN(t)&&p.enums!==void 0)return t=u,Z();if(p.integer&&!ZF(t)||p.min!==void 0&&(t<p.min||p.strictMin&&t===p.min)||p.max!==void 0&&(t>p.max||p.strictMax&&t===p.max))return null;var ie={name:e,value:t,strValue:""+t+(K||""),units:K,bypass:r};return p.unitless||K!=="px"&&K!=="em"?ie.pfValue=t:ie.pfValue=K==="px"||!K?t:this.getEmSizeInPixels()*t,(K==="ms"||K==="s")&&(ie.pfValue=K==="ms"?t:1e3*t),(K==="deg"||K==="rad")&&(ie.pfValue=K==="rad"?t:a$(t)),K==="%"&&(ie.pfValue=t/100),ie}else if(p.propList){var ce=[],fe=""+t;if(fe!=="none"){for(var de=fe.split(/\s*,\s*|\s+/),be=0;be<de.length;be++){var ge=de[be].trim();a.properties[ge]?ce.push(ge):Jr("`"+ge+"` is not a valid property name")}if(ce.length===0)return null}return{name:e,value:ce,strValue:ce.length===0?"none":ce.join(" "),bypass:r}}else if(p.color){var xe=iz(t);return xe?{name:e,value:xe,pfValue:xe,strValue:"rgb("+xe[0]+","+xe[1]+","+xe[2]+")",bypass:r}:null}else if(p.regex||p.regexes){if(p.enums){var Le=Z();if(Le)return Le}for(var Oe=p.regexes?p.regexes:[p.regex],Fe=0;Fe<Oe.length;Fe++){var et=new RegExp(Oe[Fe]),nt=et.exec(t);if(nt)return{name:e,value:p.singleRegexMatchValue?nt[1]:nt,strValue:""+t,bypass:r}}return null}else return p.string?{name:e,value:""+t,strValue:""+t,bypass:r}:p.enums?Z():null};var ga=function(t){if(!(this instanceof ga))return new ga(t);if(!OS(t)){Tn("A style must have a core reference");return}this._private={cy:t,coreStyle:{}},this.length=0,this.resetToDefault()},Ha=ga.prototype;Ha.instanceString=function(){return"style"};Ha.clear=function(){for(var e=this._private,t=e.cy,r=t.elements(),n=0;n<this.length;n++)this[n]=void 0;return this.length=0,e.contextStyles={},e.propDiffs={},this.cleanElements(r,!0),r.forEach(function(a){var i=a[0]._private;i.styleDirty=!0,i.appliedInitStyle=!1}),this};Ha.resetToDefault=function(){return this.clear(),this.addDefaultStylesheet(),this};Ha.core=function(e){return this._private.coreStyle[e]||this.getDefaultProperty(e)};Ha.selector=function(e){var t=e==="core"?null:new lu(e),r=this.length++;return this[r]={selector:t,properties:[],mappedProperties:[],index:r},this};Ha.css=function(){var e=this,t=arguments;if(t.length===1)for(var r=t[0],n=0;n<e.properties.length;n++){var a=e.properties[n],i=r[a.name];i===void 0&&(i=r[U0(a.name)]),i!==void 0&&this.cssRule(a.name,i)}else t.length===2&&this.cssRule(t[0],t[1]);return this};Ha.style=Ha.css;Ha.cssRule=function(e,t){var r=this.parse(e,t);if(r){var n=this.length-1;this[n].properties.push(r),this[n].properties[r.name]=r,r.name.match(/pie-(\d+)-background-size/)&&r.value&&(this._private.hasPie=!0),r.name.match(/stripe-(\d+)-background-size/)&&r.value&&(this._private.hasStripe=!0),r.mapped&&this[n].mappedProperties.push(r);var a=!this[n].selector;a&&(this._private.coreStyle[r.name]=r)}return this};Ha.append=function(e){return rz(e)?e.appendToStyle(this):dn(e)?this.appendFromJson(e):dr(e)&&this.appendFromString(e),this};ga.fromJson=function(e,t){var r=new ga(e);return r.fromJson(t),r};ga.fromString=function(e,t){return new ga(e).fromString(t)};[ya,Zm,tE,io,rx,rE,qn,nx].forEach(function(e){xr(Ha,e)});ga.types=Ha.types;ga.properties=Ha.properties;ga.propertyGroups=Ha.propertyGroups;ga.propertyGroupNames=Ha.propertyGroupNames;ga.propertyGroupKeys=Ha.propertyGroupKeys;var lU={style:function(t){if(t){var r=this.setStyle(t);r.update()}return this._private.style},setStyle:function(t){var r=this._private;return rz(t)?r.style=t.generateStyle(this):dn(t)?r.style=ga.fromJson(this,t):dr(t)?r.style=ga.fromString(this,t):r.style=ga(this),r.style},updateStyle:function(){this.mutableElements().updateStyle()}},uU="single",Sc={autolock:function(t){if(t!==void 0)this._private.autolock=!!t;else return this._private.autolock;return this},autoungrabify:function(t){if(t!==void 0)this._private.autoungrabify=!!t;else return this._private.autoungrabify;return this},autounselectify:function(t){if(t!==void 0)this._private.autounselectify=!!t;else return this._private.autounselectify;return this},selectionType:function(t){var r=this._private;if(r.selectionType==null&&(r.selectionType=uU),t!==void 0)(t==="additive"||t==="single")&&(r.selectionType=t);else return r.selectionType;return this},panningEnabled:function(t){if(t!==void 0)this._private.panningEnabled=!!t;else return this._private.panningEnabled;return this},userPanningEnabled:function(t){if(t!==void 0)this._private.userPanningEnabled=!!t;else return this._private.userPanningEnabled;return this},zoomingEnabled:function(t){if(t!==void 0)this._private.zoomingEnabled=!!t;else return this._private.zoomingEnabled;return this},userZoomingEnabled:function(t){if(t!==void 0)this._private.userZoomingEnabled=!!t;else return this._private.userZoomingEnabled;return this},boxSelectionEnabled:function(t){if(t!==void 0)this._private.boxSelectionEnabled=!!t;else return this._private.boxSelectionEnabled;return this},pan:function(){var t=arguments,r=this._private.pan,n,a,i,u,s;switch(t.length){case 0:return r;case 1:if(dr(t[0]))return n=t[0],r[n];if(Ur(t[0])){if(!this._private.panningEnabled)return this;i=t[0],u=i.x,s=i.y,Ht(u)&&(r.x=u),Ht(s)&&(r.y=s),this.emit("pan viewport")}break;case 2:if(!this._private.panningEnabled)return this;n=t[0],a=t[1],(n==="x"||n==="y")&&Ht(a)&&(r[n]=a),this.emit("pan viewport");break}return this.notify("viewport"),this},panBy:function(t,r){var n=arguments,a=this._private.pan,i,u,s,h,p;if(!this._private.panningEnabled)return this;switch(n.length){case 1:Ur(t)&&(s=n[0],h=s.x,p=s.y,Ht(h)&&(a.x+=h),Ht(p)&&(a.y+=p),this.emit("pan viewport"));break;case 2:i=t,u=r,(i==="x"||i==="y")&&Ht(u)&&(a[i]+=u),this.emit("pan viewport");break}return this.notify("viewport"),this},gc:function(){this.notify("gc")},fit:function(t,r){var n=this.getFitViewport(t,r);if(n){var a=this._private;a.zoom=n.zoom,a.pan=n.pan,this.emit("pan zoom viewport"),this.notify("viewport")}return this},getFitViewport:function(t,r){if(Ht(t)&&r===void 0&&(r=t,t=void 0),!(!this._private.panningEnabled||!this._private.zoomingEnabled)){var n;if(dr(t)){var a=t;t=this.$(a)}else if(YF(t)){var i=t;n={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2},n.w=n.x2-n.x1,n.h=n.y2-n.y1}else $i(t)||(t=this.mutableElements());if(!($i(t)&&t.empty())){n=n||t.boundingBox();var u=this.width(),s=this.height(),h;if(r=Ht(r)?r:0,!isNaN(u)&&!isNaN(s)&&u>0&&s>0&&!isNaN(n.w)&&!isNaN(n.h)&&n.w>0&&n.h>0){h=Math.min((u-2*r)/n.w,(s-2*r)/n.h),h=h>this._private.maxZoom?this._private.maxZoom:h,h=h<this._private.minZoom?this._private.minZoom:h;var p={x:(u-h*(n.x1+n.x2))/2,y:(s-h*(n.y1+n.y2))/2};return{zoom:h,pan:p}}}}},zoomRange:function(t,r){var n=this._private;if(r==null){var a=t;t=a.min,r=a.max}return Ht(t)&&Ht(r)&&t<=r?(n.minZoom=t,n.maxZoom=r):Ht(t)&&r===void 0&&t<=n.maxZoom?n.minZoom=t:Ht(r)&&t===void 0&&r>=n.minZoom&&(n.maxZoom=r),this},minZoom:function(t){return t===void 0?this._private.minZoom:this.zoomRange({min:t})},maxZoom:function(t){return t===void 0?this._private.maxZoom:this.zoomRange({max:t})},getZoomedViewport:function(t){var r=this._private,n=r.pan,a=r.zoom,i,u,s=!1;if(r.zoomingEnabled||(s=!0),Ht(t)?u=t:Ur(t)&&(u=t.level,t.position!=null?i=G0(t.position,a,n):t.renderedPosition!=null&&(i=t.renderedPosition),i!=null&&!r.panningEnabled&&(s=!0)),u=u>r.maxZoom?r.maxZoom:u,u=u<r.minZoom?r.minZoom:u,s||!Ht(u)||u===a||i!=null&&(!Ht(i.x)||!Ht(i.y)))return null;if(i!=null){var h=n,p=a,g=u,v={x:-g/p*(i.x-h.x)+i.x,y:-g/p*(i.y-h.y)+i.y};return{zoomed:!0,panned:!0,zoom:g,pan:v}}else return{zoomed:!0,panned:!1,zoom:u,pan:n}},zoom:function(t){if(t===void 0)return this._private.zoom;var r=this.getZoomedViewport(t),n=this._private;return r==null||!r.zoomed?this:(n.zoom=r.zoom,r.panned&&(n.pan.x=r.pan.x,n.pan.y=r.pan.y),this.emit("zoom"+(r.panned?" pan":"")+" viewport"),this.notify("viewport"),this)},viewport:function(t){var r=this._private,n=!0,a=!0,i=[],u=!1,s=!1;if(!t)return this;if(Ht(t.zoom)||(n=!1),Ur(t.pan)||(a=!1),!n&&!a)return this;if(n){var h=t.zoom;h<r.minZoom||h>r.maxZoom||!r.zoomingEnabled?u=!0:(r.zoom=h,i.push("zoom"))}if(a&&(!u||!t.cancelOnFailedZoom)&&r.panningEnabled){var p=t.pan;Ht(p.x)&&(r.pan.x=p.x,s=!1),Ht(p.y)&&(r.pan.y=p.y,s=!1),s||i.push("pan")}return i.length>0&&(i.push("viewport"),this.emit(i.join(" ")),this.notify("viewport")),this},center:function(t){var r=this.getCenterPan(t);return r&&(this._private.pan=r,this.emit("pan viewport"),this.notify("viewport")),this},getCenterPan:function(t,r){if(this._private.panningEnabled){if(dr(t)){var n=t;t=this.mutableElements().filter(n)}else $i(t)||(t=this.mutableElements());if(t.length!==0){var a=t.boundingBox(),i=this.width(),u=this.height();r=r===void 0?this._private.zoom:r;var s={x:(i-r*(a.x1+a.x2))/2,y:(u-r*(a.y1+a.y2))/2};return s}}},reset:function(){return!this._private.panningEnabled||!this._private.zoomingEnabled?this:(this.viewport({pan:{x:0,y:0},zoom:1}),this)},invalidateSize:function(){this._private.sizeCache=null},size:function(){var t=this._private,r=t.container,n=this;return t.sizeCache=t.sizeCache||(r?function(){var a=n.window().getComputedStyle(r),i=function(s){return parseFloat(a.getPropertyValue(s))};return{width:r.clientWidth-i("padding-left")-i("padding-right"),height:r.clientHeight-i("padding-top")-i("padding-bottom")}}():{width:1,height:1})},width:function(){return this.size().width},height:function(){return this.size().height},extent:function(){var t=this._private.pan,r=this._private.zoom,n=this.renderedExtent(),a={x1:(n.x1-t.x)/r,x2:(n.x2-t.x)/r,y1:(n.y1-t.y)/r,y2:(n.y2-t.y)/r};return a.w=a.x2-a.x1,a.h=a.y2-a.y1,a},renderedExtent:function(){var t=this.width(),r=this.height();return{x1:0,y1:0,x2:t,y2:r,w:t,h:r}},multiClickDebounceTime:function(t){if(t)this._private.multiClickDebounceTime=t;else return this._private.multiClickDebounceTime;return this}};Sc.centre=Sc.center;Sc.autolockNodes=Sc.autolock;Sc.autoungrabifyNodes=Sc.autoungrabify;var ym={data:Yr.data({field:"data",bindingEvent:"data",allowBinding:!0,allowSetting:!0,settingEvent:"data",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeData:Yr.removeData({field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0}),scratch:Yr.data({field:"scratch",bindingEvent:"scratch",allowBinding:!0,allowSetting:!0,settingEvent:"scratch",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeScratch:Yr.removeData({field:"scratch",event:"scratch",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0})};ym.attr=ym.data;ym.removeAttr=ym.removeData;var xm=function(t){var r=this;t=xr({},t);var n=t.container;n&&!Qy(n)&&Qy(n[0])&&(n=n[0]);var a=n?n._cyreg:null;a=a||{},a&&a.cy&&(a.cy.destroy(),a={});var i=a.readies=a.readies||[];n&&(n._cyreg=a),a.cy=r;var u=Yn!==void 0&&n!==void 0&&!t.headless,s=t;s.layout=xr({name:u?"grid":"null"},s.layout),s.renderer=xr({name:u?"canvas":"null"},s.renderer);var h=function(P,N,M){return N!==void 0?N:M!==void 0?M:P},p=this._private={container:n,ready:!1,options:s,elements:new ka(this),listeners:[],aniEles:new ka(this),data:s.data||{},scratch:{},layout:null,renderer:null,destroyed:!1,notificationsEnabled:!0,minZoom:1e-50,maxZoom:1e50,zoomingEnabled:h(!0,s.zoomingEnabled),userZoomingEnabled:h(!0,s.userZoomingEnabled),panningEnabled:h(!0,s.panningEnabled),userPanningEnabled:h(!0,s.userPanningEnabled),boxSelectionEnabled:h(!0,s.boxSelectionEnabled),autolock:h(!1,s.autolock,s.autolockNodes),autoungrabify:h(!1,s.autoungrabify,s.autoungrabifyNodes),autounselectify:h(!1,s.autounselectify),styleEnabled:s.styleEnabled===void 0?u:s.styleEnabled,zoom:Ht(s.zoom)?s.zoom:1,pan:{x:Ur(s.pan)&&Ht(s.pan.x)?s.pan.x:0,y:Ur(s.pan)&&Ht(s.pan.y)?s.pan.y:0},animation:{current:[],queue:[]},hasCompoundNodes:!1,multiClickDebounceTime:h(250,s.multiClickDebounceTime)};this.createEmitter(),this.selectionType(s.selectionType),this.zoomRange({min:s.minZoom,max:s.maxZoom});var g=function(P,N){var M=P.some(JF);if(M)return $h.all(P).then(N);N(P)};p.styleEnabled&&r.setStyle([]);var v=xr({},s,s.renderer);r.initRenderer(v);var x=function(P,N,M){r.notifications(!1);var I=r.mutableElements();I.length>0&&I.remove(),P!=null&&(Ur(P)||dn(P))&&r.add(P),r.one("layoutready",function(D){r.notifications(!0),r.emit(D),r.one("load",N),r.emitAndNotify("load")}).one("layoutstop",function(){r.one("done",M),r.emit("done")});var A=xr({},r._private.options.layout);A.eles=r.elements(),r.layout(A).run()};g([s.style,s.elements],function(S){var P=S[0],N=S[1];p.styleEnabled&&r.style().append(P),x(N,function(){r.startAnimationLoop(),p.ready=!0,Nn(s.ready)&&r.on("ready",s.ready);for(var M=0;M<i.length;M++){var I=i[M];r.on("ready",I)}a&&(a.readies=[]),r.emit("ready")},s.done)})},s0=xm.prototype;xr(s0,{instanceString:function(){return"core"},isReady:function(){return this._private.ready},destroyed:function(){return this._private.destroyed},ready:function(t){return this.isReady()?this.emitter().emit("ready",[],t):this.on("ready",t),this},destroy:function(){var t=this;if(!t.destroyed())return t.stopAnimationLoop(),t.destroyRenderer(),this.emit("destroy"),t._private.destroyed=!0,t},hasElementWithId:function(t){return this._private.elements.hasElementWithId(t)},getElementById:function(t){return this._private.elements.getElementById(t)},hasCompoundNodes:function(){return this._private.hasCompoundNodes},headless:function(){return this._private.renderer.isHeadless()},styleEnabled:function(){return this._private.styleEnabled},addToPool:function(t){return this._private.elements.merge(t),this},removeFromPool:function(t){return this._private.elements.unmerge(t),this},container:function(){return this._private.container||null},window:function(){var t=this._private.container;if(t==null)return Yn;var r=this._private.container.ownerDocument;return r===void 0||r==null?Yn:r.defaultView||Yn},mount:function(t){if(t!=null){var r=this,n=r._private,a=n.options;return!Qy(t)&&Qy(t[0])&&(t=t[0]),r.stopAnimationLoop(),r.destroyRenderer(),n.container=t,n.styleEnabled=!0,r.invalidateSize(),r.initRenderer(xr({},a,a.renderer,{name:a.renderer.name==="null"?"canvas":a.renderer.name})),r.startAnimationLoop(),r.style(a.style),r.emit("mount"),r}},unmount:function(){var t=this;return t.stopAnimationLoop(),t.destroyRenderer(),t.initRenderer({name:"null"}),t.emit("unmount"),t},options:function(){return to(this._private.options)},json:function(t){var r=this,n=r._private,a=r.mutableElements(),i=function(j){return r.getElementById(j.id())};if(Ur(t)){if(r.startBatch(),t.elements){var u={},s=function(j,V){for(var U=[],$=[],W=0;W<j.length;W++){var X=j[W];if(!X.data.id){Jr("cy.json() cannot handle elements without an ID attribute");continue}var J=""+X.data.id,Z=r.getElementById(J);u[J]=!0,Z.length!==0?$.push({ele:Z,json:X}):(V&&(X.group=V),U.push(X))}r.add(U);for(var K=0;K<$.length;K++){var Y=$[K],G=Y.ele,oe=Y.json;G.json(oe)}};if(dn(t.elements))s(t.elements);else for(var h=["nodes","edges"],p=0;p<h.length;p++){var g=h[p],v=t.elements[g];dn(v)&&s(v,g)}var x=r.collection();a.filter(function(D){return!u[D.id()]}).forEach(function(D){D.isParent()?x.merge(D):D.remove()}),x.forEach(function(D){return D.children().move({parent:null})}),x.forEach(function(D){return i(D).remove()})}t.style&&r.style(t.style),t.zoom!=null&&t.zoom!==n.zoom&&r.zoom(t.zoom),t.pan&&(t.pan.x!==n.pan.x||t.pan.y!==n.pan.y)&&r.pan(t.pan),t.data&&r.data(t.data);for(var S=["minZoom","maxZoom","zoomingEnabled","userZoomingEnabled","panningEnabled","userPanningEnabled","boxSelectionEnabled","autolock","autoungrabify","autounselectify","multiClickDebounceTime"],P=0;P<S.length;P++){var N=S[P];t[N]!=null&&r[N](t[N])}return r.endBatch(),this}else{var M=!!t,I={};M?I.elements=this.elements().map(function(D){return D.json()}):(I.elements={},a.forEach(function(D){var j=D.group();I.elements[j]||(I.elements[j]=[]),I.elements[j].push(D.json())})),this._private.styleEnabled&&(I.style=r.style().json()),I.data=to(r.data());var A=n.options;return I.zoomingEnabled=n.zoomingEnabled,I.userZoomingEnabled=n.userZoomingEnabled,I.zoom=n.zoom,I.minZoom=n.minZoom,I.maxZoom=n.maxZoom,I.panningEnabled=n.panningEnabled,I.userPanningEnabled=n.userPanningEnabled,I.pan=to(n.pan),I.boxSelectionEnabled=n.boxSelectionEnabled,I.renderer=to(A.renderer),I.hideEdgesOnViewport=A.hideEdgesOnViewport,I.textureOnViewport=A.textureOnViewport,I.wheelSensitivity=A.wheelSensitivity,I.motionBlur=A.motionBlur,I.multiClickDebounceTime=A.multiClickDebounceTime,I}}});s0.$id=s0.getElementById;[J8,nU,rR,s2,gy,iU,o2,vy,lU,Sc,ym].forEach(function(e){xr(s0,e)});var cU={fit:!0,directed:!1,direction:"downward",padding:30,circle:!1,grid:!1,spacingFactor:1.75,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,roots:void 0,depthSort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(t,r){return!0},ready:void 0,stop:void 0,transform:function(t,r){return r}},dU={maximal:!1,acyclic:!1},Dd=function(t){return t.scratch("breadthfirst")},DI=function(t,r){return t.scratch("breadthfirst",r)};function nR(e){this.options=xr({},cU,dU,e)}nR.prototype.run=function(){var e=this.options,t=e.cy,r=e.eles,n=r.nodes().filter(function(Ye){return Ye.isChildless()}),a=r,i=e.directed,u=e.acyclic||e.maximal||e.maximalAdjustments>0,s=!!e.boundingBox,h=ni(s?e.boundingBox:structuredClone(t.extent())),p;if($i(e.roots))p=e.roots;else if(dn(e.roots)){for(var g=[],v=0;v<e.roots.length;v++){var x=e.roots[v],S=t.getElementById(x);g.push(S)}p=t.collection(g)}else if(dr(e.roots))p=t.$(e.roots);else if(i)p=n.roots();else{var P=r.components();p=t.collection();for(var N=function(){var at=P[M],bt=at.maxDegree(!1),Et=at.filter(function(Vt){return Vt.degree(!1)===bt});p=p.add(Et)},M=0;M<P.length;M++)N()}var I=[],A={},D=function(at,bt){I[bt]==null&&(I[bt]=[]);var Et=I[bt].length;I[bt].push(at),DI(at,{index:Et,depth:bt})},j=function(at,bt){var Et=Dd(at),Vt=Et.depth,Bt=Et.index;I[Vt][Bt]=null,at.isChildless()&&D(at,bt)};a.bfs({roots:p,directed:e.directed,visit:function(at,bt,Et,Vt,Bt){var Mt=at[0],cr=Mt.id();Mt.isChildless()&&D(Mt,Bt),A[cr]=!0}});for(var V=[],U=0;U<n.length;U++){var $=n[U];A[$.id()]||V.push($)}var W=function(at){for(var bt=I[at],Et=0;Et<bt.length;Et++){var Vt=bt[Et];if(Vt==null){bt.splice(Et,1),Et--;continue}DI(Vt,{depth:at,index:Et})}},X=function(at,bt){for(var Et=Dd(at),Vt=at.incomers().filter(function(Xt){return Xt.isNode()&&r.has(Xt)}),Bt=-1,Mt=at.id(),cr=0;cr<Vt.length;cr++){var ar=Vt[cr],ft=Dd(ar);Bt=Math.max(Bt,ft.depth)}if(Et.depth<=Bt){if(!e.acyclic&&bt[Mt])return null;var fr=Bt+1;return j(at,fr),bt[Mt]=fr,!0}return!1};if(i&&u){var J=[],Z={},K=function(at){return J.push(at)},Y=function(){return J.shift()};for(n.forEach(function(Ye){return J.push(Ye)});J.length>0;){var G=Y(),oe=X(G,Z);if(oe)G.outgoers().filter(function(Ye){return Ye.isNode()&&r.has(Ye)}).forEach(K);else if(oe===null){Jr("Detected double maximal shift for node `"+G.id()+"`.  Bailing maximal adjustment due to cycle.  Use `options.maximal: true` only on DAGs.");break}}}var ie=0;if(e.avoidOverlap)for(var ce=0;ce<n.length;ce++){var fe=n[ce],de=fe.layoutDimensions(e),be=de.w,ge=de.h;ie=Math.max(ie,be,ge)}var xe={},Le=function(at){if(xe[at.id()])return xe[at.id()];for(var bt=Dd(at).depth,Et=at.neighborhood(),Vt=0,Bt=0,Mt=0;Mt<Et.length;Mt++){var cr=Et[Mt];if(!(cr.isEdge()||cr.isParent()||!n.has(cr))){var ar=Dd(cr);if(ar!=null){var ft=ar.index,fr=ar.depth;if(!(ft==null||fr==null)){var Xt=I[fr].length;fr<bt&&(Vt+=ft/Xt,Bt++)}}}}return Bt=Math.max(1,Bt),Vt=Vt/Bt,Bt===0&&(Vt=0),xe[at.id()]=Vt,Vt},Oe=function(at,bt){var Et=Le(at),Vt=Le(bt),Bt=Et-Vt;return Bt===0?az(at.id(),bt.id()):Bt};e.depthSort!==void 0&&(Oe=e.depthSort);for(var Fe=I.length,et=0;et<Fe;et++)I[et].sort(Oe),W(et);for(var nt=[],mt=0;mt<V.length;mt++)nt.push(V[mt]);var it=function(){for(var at=0;at<Fe;at++)W(at)};nt.length&&(I.unshift(nt),Fe=I.length,it());for(var ze=0,He=0;He<Fe;He++)ze=Math.max(I[He].length,ze);var We={x:h.x1+h.w/2,y:h.y1+h.h/2},ot=n.reduce(function(Ye,at){return function(bt){return{w:Ye.w===-1?bt.w:(Ye.w+bt.w)/2,h:Ye.h===-1?bt.h:(Ye.h+bt.h)/2}}(at.boundingBox({includeLabels:e.nodeDimensionsIncludeLabels}))},{w:-1,h:-1}),xt=Math.max(Fe===1?0:s?(h.h-e.padding*2-ot.h)/(Fe-1):(h.h-e.padding*2-ot.h)/(Fe+1),ie),Tt=I.reduce(function(Ye,at){return Math.max(Ye,at.length)},0),$e=function(at){var bt=Dd(at),Et=bt.depth,Vt=bt.index;if(e.circle){var Bt=Math.min(h.w/2/Fe,h.h/2/Fe);Bt=Math.max(Bt,ie);var Mt=Bt*Et+Bt-(Fe>0&&I[0].length<=3?Bt/2:0),cr=2*Math.PI/I[Et].length*Vt;return Et===0&&I[0].length===1&&(Mt=1),{x:We.x+Mt*Math.cos(cr),y:We.y+Mt*Math.sin(cr)}}else{var ar=I[Et].length,ft=Math.max(ar===1?0:s?(h.w-e.padding*2-ot.w)/((e.grid?Tt:ar)-1):(h.w-e.padding*2-ot.w)/((e.grid?Tt:ar)+1),ie),fr={x:We.x+(Vt+1-(ar+1)/2)*ft,y:We.y+(Et+1-(Fe+1)/2)*xt};return fr}},Xe={downward:0,leftward:90,upward:180,rightward:-90};Object.keys(Xe).indexOf(e.direction)===-1&&Tn("Invalid direction '".concat(e.direction,"' specified for breadthfirst layout. Valid values are: ").concat(Object.keys(Xe).join(", ")));var Pe=function(at){return T6($e(at),h,Xe[e.direction])};return r.nodes().layoutPositions(this,e,Pe),this};var hU={fit:!0,padding:30,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,spacingFactor:void 0,radius:void 0,startAngle:3/2*Math.PI,sweep:void 0,clockwise:!0,sort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(t,r){return!0},ready:void 0,stop:void 0,transform:function(t,r){return r}};function aR(e){this.options=xr({},hU,e)}aR.prototype.run=function(){var e=this.options,t=e,r=e.cy,n=t.eles,a=t.counterclockwise!==void 0?!t.counterclockwise:t.clockwise,i=n.nodes().not(":parent");t.sort&&(i=i.sort(t.sort));for(var u=ni(t.boundingBox?t.boundingBox:{x1:0,y1:0,w:r.width(),h:r.height()}),s={x:u.x1+u.w/2,y:u.y1+u.h/2},h=t.sweep===void 0?2*Math.PI-2*Math.PI/i.length:t.sweep,p=h/Math.max(1,i.length-1),g,v=0,x=0;x<i.length;x++){var S=i[x],P=S.layoutDimensions(t),N=P.w,M=P.h;v=Math.max(v,N,M)}if(Ht(t.radius)?g=t.radius:i.length<=1?g=0:g=Math.min(u.h,u.w)/2-v,i.length>1&&t.avoidOverlap){v*=1.75;var I=Math.cos(p)-Math.cos(0),A=Math.sin(p)-Math.sin(0),D=Math.sqrt(v*v/(I*I+A*A));g=Math.max(D,g)}var j=function(U,$){var W=t.startAngle+$*p*(a?1:-1),X=g*Math.cos(W),J=g*Math.sin(W),Z={x:s.x+X,y:s.y+J};return Z};return n.nodes().layoutPositions(this,t,j),this};var fU={fit:!0,padding:30,startAngle:3/2*Math.PI,sweep:void 0,clockwise:!0,equidistant:!1,minNodeSpacing:10,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,height:void 0,width:void 0,spacingFactor:void 0,concentric:function(t){return t.degree()},levelWidth:function(t){return t.maxDegree()/4},animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(t,r){return!0},ready:void 0,stop:void 0,transform:function(t,r){return r}};function iR(e){this.options=xr({},fU,e)}iR.prototype.run=function(){for(var e=this.options,t=e,r=t.counterclockwise!==void 0?!t.counterclockwise:t.clockwise,n=e.cy,a=t.eles,i=a.nodes().not(":parent"),u=ni(t.boundingBox?t.boundingBox:{x1:0,y1:0,w:n.width(),h:n.height()}),s={x:u.x1+u.w/2,y:u.y1+u.h/2},h=[],p=0,g=0;g<i.length;g++){var v=i[g],x=void 0;x=t.concentric(v),h.push({value:x,node:v}),v._private.scratch.concentric=x}i.updateStyle();for(var S=0;S<i.length;S++){var P=i[S],N=P.layoutDimensions(t);p=Math.max(p,N.w,N.h)}h.sort(function(xt,Tt){return Tt.value-xt.value});for(var M=t.levelWidth(i),I=[[]],A=I[0],D=0;D<h.length;D++){var j=h[D];if(A.length>0){var V=Math.abs(A[0].value-j.value);V>=M&&(A=[],I.push(A))}A.push(j)}var U=p+t.minNodeSpacing;if(!t.avoidOverlap){var $=I.length>0&&I[0].length>1,W=Math.min(u.w,u.h)/2-U,X=W/(I.length+$?1:0);U=Math.min(U,X)}for(var J=0,Z=0;Z<I.length;Z++){var K=I[Z],Y=t.sweep===void 0?2*Math.PI-2*Math.PI/K.length:t.sweep,G=K.dTheta=Y/Math.max(1,K.length-1);if(K.length>1&&t.avoidOverlap){var oe=Math.cos(G)-Math.cos(0),ie=Math.sin(G)-Math.sin(0),ce=Math.sqrt(U*U/(oe*oe+ie*ie));J=Math.max(ce,J)}K.r=J,J+=U}if(t.equidistant){for(var fe=0,de=0,be=0;be<I.length;be++){var ge=I[be],xe=ge.r-de;fe=Math.max(fe,xe)}de=0;for(var Le=0;Le<I.length;Le++){var Oe=I[Le];Le===0&&(de=Oe.r),Oe.r=de,de+=fe}}for(var Fe={},et=0;et<I.length;et++)for(var nt=I[et],mt=nt.dTheta,it=nt.r,ze=0;ze<nt.length;ze++){var He=nt[ze],We=t.startAngle+(r?1:-1)*mt*ze,ot={x:s.x+it*Math.cos(We),y:s.y+it*Math.sin(We)};Fe[He.node.id()]=ot}return a.nodes().layoutPositions(this,t,function(xt){var Tt=xt.id();return Fe[Tt]}),this};var Pw,pU={ready:function(){},stop:function(){},animate:!0,animationEasing:void 0,animationDuration:void 0,animateFilter:function(t,r){return!0},animationThreshold:250,refresh:20,fit:!0,padding:30,boundingBox:void 0,nodeDimensionsIncludeLabels:!1,randomize:!1,componentSpacing:40,nodeRepulsion:function(t){return 2048},nodeOverlap:4,idealEdgeLength:function(t){return 32},edgeElasticity:function(t){return 32},nestingFactor:1.2,gravity:1,numIter:1e3,initialTemp:1e3,coolingFactor:.99,minTemp:1};function ax(e){this.options=xr({},pU,e),this.options.layout=this;var t=this.options.eles.nodes(),r=this.options.eles.edges(),n=r.filter(function(a){var i=a.source().data("id"),u=a.target().data("id"),s=t.some(function(p){return p.data("id")===i}),h=t.some(function(p){return p.data("id")===u});return!s||!h});this.options.eles=this.options.eles.not(n)}ax.prototype.run=function(){var e=this.options,t=e.cy,r=this;r.stopped=!1,(e.animate===!0||e.animate===!1)&&r.emit({type:"layoutstart",layout:r}),e.debug===!0?Pw=!0:Pw=!1;var n=mU(t,r,e);Pw&&vU(n),e.randomize&&yU(n);var a=Uo(),i=function(){xU(n,t,e),e.fit===!0&&t.fit(e.padding)},u=function(x){return!(r.stopped||x>=e.numIter||(bU(n,e),n.temperature=n.temperature*e.coolingFactor,n.temperature<e.minTemp))},s=function(){if(e.animate===!0||e.animate===!1)i(),r.one("layoutstop",e.stop),r.emit({type:"layoutstop",layout:r});else{var x=e.eles.nodes(),S=oR(n,e,x);x.layoutPositions(r,e,S)}},h=0,p=!0;if(e.animate===!0){var g=function(){for(var x=0;p&&x<e.refresh;)p=u(h),h++,x++;if(!p)RI(n,e),s();else{var S=Uo();S-a>=e.animationThreshold&&i(),e0(g)}};g()}else{for(;p;)p=u(h),h++;RI(n,e),s()}return this};ax.prototype.stop=function(){return this.stopped=!0,this.thread&&this.thread.stop(),this.emit("layoutstop"),this};ax.prototype.destroy=function(){return this.thread&&this.thread.stop(),this};var mU=function(t,r,n){for(var a=n.eles.edges(),i=n.eles.nodes(),u=ni(n.boundingBox?n.boundingBox:{x1:0,y1:0,w:t.width(),h:t.height()}),s={isCompound:t.hasCompoundNodes(),layoutNodes:[],idToIndex:{},nodeSize:i.size(),graphSet:[],indexToGraph:[],layoutEdges:[],edgeSize:a.size(),temperature:n.initialTemp,clientWidth:u.w,clientHeight:u.h,boundingBox:u},h=n.eles.components(),p={},g=0;g<h.length;g++)for(var v=h[g],x=0;x<v.length;x++){var S=v[x];p[S.id()]=g}for(var g=0;g<s.nodeSize;g++){var P=i[g],N=P.layoutDimensions(n),M={};M.isLocked=P.locked(),M.id=P.data("id"),M.parentId=P.data("parent"),M.cmptId=p[P.id()],M.children=[],M.positionX=P.position("x"),M.positionY=P.position("y"),M.offsetX=0,M.offsetY=0,M.height=N.w,M.width=N.h,M.maxX=M.positionX+M.width/2,M.minX=M.positionX-M.width/2,M.maxY=M.positionY+M.height/2,M.minY=M.positionY-M.height/2,M.padLeft=parseFloat(P.style("padding")),M.padRight=parseFloat(P.style("padding")),M.padTop=parseFloat(P.style("padding")),M.padBottom=parseFloat(P.style("padding")),M.nodeRepulsion=Nn(n.nodeRepulsion)?n.nodeRepulsion(P):n.nodeRepulsion,s.layoutNodes.push(M),s.idToIndex[M.id]=g}for(var I=[],A=0,D=-1,j=[],g=0;g<s.nodeSize;g++){var P=s.layoutNodes[g],V=P.parentId;V!=null?s.layoutNodes[s.idToIndex[V]].children.push(P.id):(I[++D]=P.id,j.push(P.id))}for(s.graphSet.push(j);A<=D;){var U=I[A++],$=s.idToIndex[U],S=s.layoutNodes[$],W=S.children;if(W.length>0){s.graphSet.push(W);for(var g=0;g<W.length;g++)I[++D]=W[g]}}for(var g=0;g<s.graphSet.length;g++)for(var X=s.graphSet[g],x=0;x<X.length;x++){var J=s.idToIndex[X[x]];s.indexToGraph[J]=g}for(var g=0;g<s.edgeSize;g++){var Z=a[g],K={};K.id=Z.data("id"),K.sourceId=Z.data("source"),K.targetId=Z.data("target");var Y=Nn(n.idealEdgeLength)?n.idealEdgeLength(Z):n.idealEdgeLength,G=Nn(n.edgeElasticity)?n.edgeElasticity(Z):n.edgeElasticity,oe=s.idToIndex[K.sourceId],ie=s.idToIndex[K.targetId],ce=s.indexToGraph[oe],fe=s.indexToGraph[ie];if(ce!=fe){for(var de=gU(K.sourceId,K.targetId,s),be=s.graphSet[de],ge=0,M=s.layoutNodes[oe];be.indexOf(M.id)===-1;)M=s.layoutNodes[s.idToIndex[M.parentId]],ge++;for(M=s.layoutNodes[ie];be.indexOf(M.id)===-1;)M=s.layoutNodes[s.idToIndex[M.parentId]],ge++;Y*=ge*n.nestingFactor}K.idealLength=Y,K.elasticity=G,s.layoutEdges.push(K)}return s},gU=function(t,r,n){var a=sR(t,r,0,n);return 2>a.count?0:a.graph},sR=function(t,r,n,a){var i=a.graphSet[n];if(-1<i.indexOf(t)&&-1<i.indexOf(r))return{count:2,graph:n};for(var u=0,s=0;s<i.length;s++){var h=i[s],p=a.idToIndex[h],g=a.layoutNodes[p].children;if(g.length!==0){var v=a.indexToGraph[a.idToIndex[g[0]]],x=sR(t,r,v,a);if(x.count!==0)if(x.count===1){if(u++,u===2)break}else return x}}return{count:u,graph:n}},vU,yU=function(t,r){for(var n=t.clientWidth,a=t.clientHeight,i=0;i<t.nodeSize;i++){var u=t.layoutNodes[i];u.children.length===0&&!u.isLocked&&(u.positionX=Math.random()*n,u.positionY=Math.random()*a)}},oR=function(t,r,n){var a=t.boundingBox,i={x1:1/0,x2:-1/0,y1:1/0,y2:-1/0};return r.boundingBox&&(n.forEach(function(u){var s=t.layoutNodes[t.idToIndex[u.data("id")]];i.x1=Math.min(i.x1,s.positionX),i.x2=Math.max(i.x2,s.positionX),i.y1=Math.min(i.y1,s.positionY),i.y2=Math.max(i.y2,s.positionY)}),i.w=i.x2-i.x1,i.h=i.y2-i.y1),function(u,s){var h=t.layoutNodes[t.idToIndex[u.data("id")]];if(r.boundingBox){var p=i.w===0?.5:(h.positionX-i.x1)/i.w,g=i.h===0?.5:(h.positionY-i.y1)/i.h;return{x:a.x1+p*a.w,y:a.y1+g*a.h}}else return{x:h.positionX,y:h.positionY}}},xU=function(t,r,n){var a=n.layout,i=n.eles.nodes(),u=oR(t,n,i);i.positions(u),t.ready!==!0&&(t.ready=!0,a.one("layoutready",n.ready),a.emit({type:"layoutready",layout:this}))},bU=function(t,r,n){_U(t,r),EU(t),CU(t,r),kU(t),TU(t)},_U=function(t,r){for(var n=0;n<t.graphSet.length;n++)for(var a=t.graphSet[n],i=a.length,u=0;u<i;u++)for(var s=t.layoutNodes[t.idToIndex[a[u]]],h=u+1;h<i;h++){var p=t.layoutNodes[t.idToIndex[a[h]]];wU(s,p,t,r)}},zI=function(t){return-1+2*t*Math.random()},wU=function(t,r,n,a){var i=t.cmptId,u=r.cmptId;if(!(i!==u&&!n.isCompound)){var s=r.positionX-t.positionX,h=r.positionY-t.positionY,p=1;s===0&&h===0&&(s=zI(p),h=zI(p));var g=SU(t,r,s,h);if(g>0)var v=a.nodeOverlap*g,x=Math.sqrt(s*s+h*h),S=v*s/x,P=v*h/x;else var N=o0(t,s,h),M=o0(r,-1*s,-1*h),I=M.x-N.x,A=M.y-N.y,D=I*I+A*A,x=Math.sqrt(D),v=(t.nodeRepulsion+r.nodeRepulsion)/D,S=v*I/x,P=v*A/x;t.isLocked||(t.offsetX-=S,t.offsetY-=P),r.isLocked||(r.offsetX+=S,r.offsetY+=P)}},SU=function(t,r,n,a){if(n>0)var i=t.maxX-r.minX;else var i=r.maxX-t.minX;if(a>0)var u=t.maxY-r.minY;else var u=r.maxY-t.minY;return i>=0&&u>=0?Math.sqrt(i*i+u*u):0},o0=function(t,r,n){var a=t.positionX,i=t.positionY,u=t.height||1,s=t.width||1,h=n/r,p=u/s,g={};return r===0&&0<n||r===0&&0>n?(g.x=a,g.y=i+u/2,g):0<r&&-1*p<=h&&h<=p?(g.x=a+s/2,g.y=i+s*n/2/r,g):0>r&&-1*p<=h&&h<=p?(g.x=a-s/2,g.y=i-s*n/2/r,g):0<n&&(h<=-1*p||h>=p)?(g.x=a+u*r/2/n,g.y=i+u/2,g):(0>n&&(h<=-1*p||h>=p)&&(g.x=a-u*r/2/n,g.y=i-u/2),g)},EU=function(t,r){for(var n=0;n<t.edgeSize;n++){var a=t.layoutEdges[n],i=t.idToIndex[a.sourceId],u=t.layoutNodes[i],s=t.idToIndex[a.targetId],h=t.layoutNodes[s],p=h.positionX-u.positionX,g=h.positionY-u.positionY;if(!(p===0&&g===0)){var v=o0(u,p,g),x=o0(h,-1*p,-1*g),S=x.x-v.x,P=x.y-v.y,N=Math.sqrt(S*S+P*P),M=Math.pow(a.idealLength-N,2)/a.elasticity;if(N!==0)var I=M*S/N,A=M*P/N;else var I=0,A=0;u.isLocked||(u.offsetX+=I,u.offsetY+=A),h.isLocked||(h.offsetX-=I,h.offsetY-=A)}}},CU=function(t,r){if(r.gravity!==0)for(var n=1,a=0;a<t.graphSet.length;a++){var i=t.graphSet[a],u=i.length;if(a===0)var s=t.clientHeight/2,h=t.clientWidth/2;else var p=t.layoutNodes[t.idToIndex[i[0]]],g=t.layoutNodes[t.idToIndex[p.parentId]],s=g.positionX,h=g.positionY;for(var v=0;v<u;v++){var x=t.layoutNodes[t.idToIndex[i[v]]];if(!x.isLocked){var S=s-x.positionX,P=h-x.positionY,N=Math.sqrt(S*S+P*P);if(N>n){var M=r.gravity*S/N,I=r.gravity*P/N;x.offsetX+=M,x.offsetY+=I}}}}},kU=function(t,r){var n=[],a=0,i=-1;for(n.push.apply(n,t.graphSet[0]),i+=t.graphSet[0].length;a<=i;){var u=n[a++],s=t.idToIndex[u],h=t.layoutNodes[s],p=h.children;if(0<p.length&&!h.isLocked){for(var g=h.offsetX,v=h.offsetY,x=0;x<p.length;x++){var S=t.layoutNodes[t.idToIndex[p[x]]];S.offsetX+=g,S.offsetY+=v,n[++i]=p[x]}h.offsetX=0,h.offsetY=0}}},TU=function(t,r){for(var n=0;n<t.nodeSize;n++){var a=t.layoutNodes[n];0<a.children.length&&(a.maxX=void 0,a.minX=void 0,a.maxY=void 0,a.minY=void 0)}for(var n=0;n<t.nodeSize;n++){var a=t.layoutNodes[n];if(!(0<a.children.length||a.isLocked)){var i=PU(a.offsetX,a.offsetY,t.temperature);a.positionX+=i.x,a.positionY+=i.y,a.offsetX=0,a.offsetY=0,a.minX=a.positionX-a.width,a.maxX=a.positionX+a.width,a.minY=a.positionY-a.height,a.maxY=a.positionY+a.height,lR(a,t)}}for(var n=0;n<t.nodeSize;n++){var a=t.layoutNodes[n];0<a.children.length&&!a.isLocked&&(a.positionX=(a.maxX+a.minX)/2,a.positionY=(a.maxY+a.minY)/2,a.width=a.maxX-a.minX,a.height=a.maxY-a.minY)}},PU=function(t,r,n){var a=Math.sqrt(t*t+r*r);if(a>n)var i={x:n*t/a,y:n*r/a};else var i={x:t,y:r};return i},lR=function(t,r){var n=t.parentId;if(n!=null){var a=r.layoutNodes[r.idToIndex[n]],i=!1;if((a.maxX==null||t.maxX+a.padRight>a.maxX)&&(a.maxX=t.maxX+a.padRight,i=!0),(a.minX==null||t.minX-a.padLeft<a.minX)&&(a.minX=t.minX-a.padLeft,i=!0),(a.maxY==null||t.maxY+a.padBottom>a.maxY)&&(a.maxY=t.maxY+a.padBottom,i=!0),(a.minY==null||t.minY-a.padTop<a.minY)&&(a.minY=t.minY-a.padTop,i=!0),i)return lR(a,r)}},RI=function(t,r){for(var n=t.layoutNodes,a=[],i=0;i<n.length;i++){var u=n[i],s=u.cmptId,h=a[s]=a[s]||[];h.push(u)}for(var p=0,i=0;i<a.length;i++){var g=a[i];if(g){g.x1=1/0,g.x2=-1/0,g.y1=1/0,g.y2=-1/0;for(var v=0;v<g.length;v++){var x=g[v];g.x1=Math.min(g.x1,x.positionX-x.width/2),g.x2=Math.max(g.x2,x.positionX+x.width/2),g.y1=Math.min(g.y1,x.positionY-x.height/2),g.y2=Math.max(g.y2,x.positionY+x.height/2)}g.w=g.x2-g.x1,g.h=g.y2-g.y1,p+=g.w*g.h}}a.sort(function(A,D){return D.w*D.h-A.w*A.h});for(var S=0,P=0,N=0,M=0,I=Math.sqrt(p)*t.clientWidth/t.clientHeight,i=0;i<a.length;i++){var g=a[i];if(g){for(var v=0;v<g.length;v++){var x=g[v];x.isLocked||(x.positionX+=S-g.x1,x.positionY+=P-g.y1)}S+=g.w+r.componentSpacing,N+=g.w+r.componentSpacing,M=Math.max(M,g.h),N>I&&(P+=M+r.componentSpacing,S=0,N=0,M=0)}}},IU={fit:!0,padding:30,boundingBox:void 0,avoidOverlap:!0,avoidOverlapPadding:10,nodeDimensionsIncludeLabels:!1,spacingFactor:void 0,condense:!1,rows:void 0,cols:void 0,position:function(t){},sort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(t,r){return!0},ready:void 0,stop:void 0,transform:function(t,r){return r}};function uR(e){this.options=xr({},IU,e)}uR.prototype.run=function(){var e=this.options,t=e,r=e.cy,n=t.eles,a=n.nodes().not(":parent");t.sort&&(a=a.sort(t.sort));var i=ni(t.boundingBox?t.boundingBox:{x1:0,y1:0,w:r.width(),h:r.height()});if(i.h===0||i.w===0)n.nodes().layoutPositions(this,t,function(Le){return{x:i.x1,y:i.y1}});else{var u=a.size(),s=Math.sqrt(u*i.h/i.w),h=Math.round(s),p=Math.round(i.w/i.h*s),g=function(Oe){if(Oe==null)return Math.min(h,p);var Fe=Math.min(h,p);Fe==h?h=Oe:p=Oe},v=function(Oe){if(Oe==null)return Math.max(h,p);var Fe=Math.max(h,p);Fe==h?h=Oe:p=Oe},x=t.rows,S=t.cols!=null?t.cols:t.columns;if(x!=null&&S!=null)h=x,p=S;else if(x!=null&&S==null)h=x,p=Math.ceil(u/h);else if(x==null&&S!=null)p=S,h=Math.ceil(u/p);else if(p*h>u){var P=g(),N=v();(P-1)*N>=u?g(P-1):(N-1)*P>=u&&v(N-1)}else for(;p*h<u;){var M=g(),I=v();(I+1)*M>=u?v(I+1):g(M+1)}var A=i.w/p,D=i.h/h;if(t.condense&&(A=0,D=0),t.avoidOverlap)for(var j=0;j<a.length;j++){var V=a[j],U=V._private.position;(U.x==null||U.y==null)&&(U.x=0,U.y=0);var $=V.layoutDimensions(t),W=t.avoidOverlapPadding,X=$.w+W,J=$.h+W;A=Math.max(A,X),D=Math.max(D,J)}for(var Z={},K=function(Oe,Fe){return!!Z["c-"+Oe+"-"+Fe]},Y=function(Oe,Fe){Z["c-"+Oe+"-"+Fe]=!0},G=0,oe=0,ie=function(){oe++,oe>=p&&(oe=0,G++)},ce={},fe=0;fe<a.length;fe++){var de=a[fe],be=t.position(de);if(be&&(be.row!==void 0||be.col!==void 0)){var ge={row:be.row,col:be.col};if(ge.col===void 0)for(ge.col=0;K(ge.row,ge.col);)ge.col++;else if(ge.row===void 0)for(ge.row=0;K(ge.row,ge.col);)ge.row++;ce[de.id()]=ge,Y(ge.row,ge.col)}}var xe=function(Oe,Fe){var et,nt;if(Oe.locked()||Oe.isParent())return!1;var mt=ce[Oe.id()];if(mt)et=mt.col*A+A/2+i.x1,nt=mt.row*D+D/2+i.y1;else{for(;K(G,oe);)ie();et=oe*A+A/2+i.x1,nt=G*D+D/2+i.y1,Y(G,oe),ie()}return{x:et,y:nt}};a.layoutPositions(this,t,xe)}return this};var AU={ready:function(){},stop:function(){}};function nE(e){this.options=xr({},AU,e)}nE.prototype.run=function(){var e=this.options,t=e.eles,r=this;return e.cy,r.emit("layoutstart"),t.nodes().positions(function(){return{x:0,y:0}}),r.one("layoutready",e.ready),r.emit("layoutready"),r.one("layoutstop",e.stop),r.emit("layoutstop"),this};nE.prototype.stop=function(){return this};var NU={positions:void 0,zoom:void 0,pan:void 0,fit:!0,padding:30,spacingFactor:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(t,r){return!0},ready:void 0,stop:void 0,transform:function(t,r){return r}};function cR(e){this.options=xr({},NU,e)}cR.prototype.run=function(){var e=this.options,t=e.eles,r=t.nodes(),n=Nn(e.positions);function a(i){if(e.positions==null)return Q6(i.position());if(n)return e.positions(i);var u=e.positions[i._private.data.id];return u??null}return r.layoutPositions(this,e,function(i,u){var s=a(i);return i.locked()||s==null?!1:s}),this};var MU={fit:!0,padding:30,boundingBox:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(t,r){return!0},ready:void 0,stop:void 0,transform:function(t,r){return r}};function dR(e){this.options=xr({},MU,e)}dR.prototype.run=function(){var e=this.options,t=e.cy,r=e.eles,n=ni(e.boundingBox?e.boundingBox:{x1:0,y1:0,w:t.width(),h:t.height()}),a=function(u,s){return{x:n.x1+Math.round(Math.random()*n.w),y:n.y1+Math.round(Math.random()*n.h)}};return r.nodes().layoutPositions(this,e,a),this};var DU=[{name:"breadthfirst",impl:nR},{name:"circle",impl:aR},{name:"concentric",impl:iR},{name:"cose",impl:ax},{name:"grid",impl:uR},{name:"null",impl:nE},{name:"preset",impl:cR},{name:"random",impl:dR}];function hR(e){this.options=e,this.notifications=0}var LI=function(){},BI=function(){throw new Error("A headless instance can not render images")};hR.prototype={recalculateRenderedStyle:LI,notify:function(){this.notifications++},init:LI,isHeadless:function(){return!0},png:BI,jpg:BI};var aE={};aE.arrowShapeWidth=.3;aE.registerArrowShapes=function(){var e=this.arrowShapes={},t=this,r=function(p,g,v,x,S,P,N){var M=S.x-v/2-N,I=S.x+v/2+N,A=S.y-v/2-N,D=S.y+v/2+N,j=M<=p&&p<=I&&A<=g&&g<=D;return j},n=function(p,g,v,x,S){var P=p*Math.cos(x)-g*Math.sin(x),N=p*Math.sin(x)+g*Math.cos(x),M=P*v,I=N*v,A=M+S.x,D=I+S.y;return{x:A,y:D}},a=function(p,g,v,x){for(var S=[],P=0;P<p.length;P+=2){var N=p[P],M=p[P+1];S.push(n(N,M,g,v,x))}return S},i=function(p){for(var g=[],v=0;v<p.length;v++){var x=p[v];g.push(x.x,x.y)}return g},u=function(p){return p.pstyle("width").pfValue*p.pstyle("arrow-scale").pfValue*2},s=function(p,g){dr(g)&&(g=e[g]),e[p]=xr({name:p,points:[-.15,-.3,.15,-.3,.15,.3,-.15,.3],collide:function(x,S,P,N,M,I){var A=i(a(this.points,P+2*I,N,M)),D=xi(x,S,A);return D},roughCollide:r,draw:function(x,S,P,N){var M=a(this.points,S,P,N);t.arrowShapeImpl("polygon")(x,M)},spacing:function(x){return 0},gap:u},g)};s("none",{collide:t0,roughCollide:t0,draw:US,spacing:YT,gap:YT}),s("triangle",{points:[-.15,-.3,0,0,.15,-.3]}),s("arrow","triangle"),s("triangle-backcurve",{points:e.triangle.points,controlPoint:[0,-.15],roughCollide:r,draw:function(p,g,v,x,S){var P=a(this.points,g,v,x),N=this.controlPoint,M=n(N[0],N[1],g,v,x);t.arrowShapeImpl(this.name)(p,P,M)},gap:function(p){return u(p)*.8}}),s("triangle-tee",{points:[0,0,.15,-.3,-.15,-.3,0,0],pointsTee:[-.15,-.4,-.15,-.5,.15,-.5,.15,-.4],collide:function(p,g,v,x,S,P,N){var M=i(a(this.points,v+2*N,x,S)),I=i(a(this.pointsTee,v+2*N,x,S)),A=xi(p,g,M)||xi(p,g,I);return A},draw:function(p,g,v,x,S){var P=a(this.points,g,v,x),N=a(this.pointsTee,g,v,x);t.arrowShapeImpl(this.name)(p,P,N)}}),s("circle-triangle",{radius:.15,pointsTr:[0,-.15,.15,-.45,-.15,-.45,0,-.15],collide:function(p,g,v,x,S,P,N){var M=S,I=Math.pow(M.x-p,2)+Math.pow(M.y-g,2)<=Math.pow((v+2*N)*this.radius,2),A=i(a(this.points,v+2*N,x,S));return xi(p,g,A)||I},draw:function(p,g,v,x,S){var P=a(this.pointsTr,g,v,x);t.arrowShapeImpl(this.name)(p,P,x.x,x.y,this.radius*g)},spacing:function(p){return t.getArrowWidth(p.pstyle("width").pfValue,p.pstyle("arrow-scale").value)*this.radius}}),s("triangle-cross",{points:[0,0,.15,-.3,-.15,-.3,0,0],baseCrossLinePts:[-.15,-.4,-.15,-.4,.15,-.4,.15,-.4],crossLinePts:function(p,g){var v=this.baseCrossLinePts.slice(),x=g/p,S=3,P=5;return v[S]=v[S]-x,v[P]=v[P]-x,v},collide:function(p,g,v,x,S,P,N){var M=i(a(this.points,v+2*N,x,S)),I=i(a(this.crossLinePts(v,P),v+2*N,x,S)),A=xi(p,g,M)||xi(p,g,I);return A},draw:function(p,g,v,x,S){var P=a(this.points,g,v,x),N=a(this.crossLinePts(g,S),g,v,x);t.arrowShapeImpl(this.name)(p,P,N)}}),s("vee",{points:[-.15,-.3,0,0,.15,-.3,0,-.15],gap:function(p){return u(p)*.525}}),s("circle",{radius:.15,collide:function(p,g,v,x,S,P,N){var M=S,I=Math.pow(M.x-p,2)+Math.pow(M.y-g,2)<=Math.pow((v+2*N)*this.radius,2);return I},draw:function(p,g,v,x,S){t.arrowShapeImpl(this.name)(p,x.x,x.y,this.radius*g)},spacing:function(p){return t.getArrowWidth(p.pstyle("width").pfValue,p.pstyle("arrow-scale").value)*this.radius}}),s("tee",{points:[-.15,0,-.15,-.1,.15,-.1,.15,0],spacing:function(p){return 1},gap:function(p){return 1}}),s("square",{points:[-.15,0,.15,0,.15,-.3,-.15,-.3]}),s("diamond",{points:[-.15,-.15,0,-.3,.15,-.15,0,0],gap:function(p){return p.pstyle("width").pfValue*p.pstyle("arrow-scale").value}}),s("chevron",{points:[0,0,-.15,-.15,-.1,-.2,0,-.1,.1,-.2,.15,-.15],gap:function(p){return .95*p.pstyle("width").pfValue*p.pstyle("arrow-scale").value}})};var Mc={};Mc.projectIntoViewport=function(e,t){var r=this.cy,n=this.findContainerClientCoords(),a=n[0],i=n[1],u=n[4],s=r.pan(),h=r.zoom(),p=((e-a)/u-s.x)/h,g=((t-i)/u-s.y)/h;return[p,g]};Mc.findContainerClientCoords=function(){if(this.containerBB)return this.containerBB;var e=this.container,t=e.getBoundingClientRect(),r=this.cy.window().getComputedStyle(e),n=function(I){return parseFloat(r.getPropertyValue(I))},a={left:n("padding-left"),right:n("padding-right"),top:n("padding-top"),bottom:n("padding-bottom")},i={left:n("border-left-width"),right:n("border-right-width"),top:n("border-top-width"),bottom:n("border-bottom-width")},u=e.clientWidth,s=e.clientHeight,h=a.left+a.right,p=a.top+a.bottom,g=i.left+i.right,v=t.width/(u+g),x=u-h,S=s-p,P=t.left+a.left+i.left,N=t.top+a.top+i.top;return this.containerBB=[P,N,x,S,v]};Mc.invalidateContainerClientCoordsCache=function(){this.containerBB=null};Mc.findNearestElement=function(e,t,r,n){return this.findNearestElements(e,t,r,n)[0]};Mc.findNearestElements=function(e,t,r,n){var a=this,i=this,u=i.getCachedZSortedEles(),s=[],h=i.cy.zoom(),p=i.cy.hasCompoundNodes(),g=(n?24:8)/h,v=(n?8:2)/h,x=(n?8:2)/h,S=1/0,P,N;r&&(u=u.interactive);function M($,W){if($.isNode()){if(N)return;N=$,s.push($)}if($.isEdge()&&(W==null||W<S))if(P){if(P.pstyle("z-compound-depth").value===$.pstyle("z-compound-depth").value&&P.pstyle("z-compound-depth").value===$.pstyle("z-compound-depth").value){for(var X=0;X<s.length;X++)if(s[X].isEdge()){s[X]=$,P=$,S=W??S;break}}}else s.push($),P=$,S=W??S}function I($){var W=$.outerWidth()+2*v,X=$.outerHeight()+2*v,J=W/2,Z=X/2,K=$.position(),Y=$.pstyle("corner-radius").value==="auto"?"auto":$.pstyle("corner-radius").pfValue,G=$._private.rscratch;if(K.x-J<=e&&e<=K.x+J&&K.y-Z<=t&&t<=K.y+Z){var oe=i.nodeShapes[a.getNodeShape($)];if(oe.checkPoint(e,t,0,W,X,K.x,K.y,Y,G))return M($,0),!0}}function A($){var W=$._private,X=W.rscratch,J=$.pstyle("width").pfValue,Z=$.pstyle("arrow-scale").value,K=J/2+g,Y=K*K,G=K*2,fe=W.source,de=W.target,oe;if(X.edgeType==="segments"||X.edgeType==="straight"||X.edgeType==="haystack"){for(var ie=X.allpts,ce=0;ce+3<ie.length;ce+=2)if(f$(e,t,ie[ce],ie[ce+1],ie[ce+2],ie[ce+3],G)&&Y>(oe=y$(e,t,ie[ce],ie[ce+1],ie[ce+2],ie[ce+3])))return M($,oe),!0}else if(X.edgeType==="bezier"||X.edgeType==="multibezier"||X.edgeType==="self"||X.edgeType==="compound"){for(var ie=X.allpts,ce=0;ce+5<X.allpts.length;ce+=4)if(p$(e,t,ie[ce],ie[ce+1],ie[ce+2],ie[ce+3],ie[ce+4],ie[ce+5],G)&&Y>(oe=v$(e,t,ie[ce],ie[ce+1],ie[ce+2],ie[ce+3],ie[ce+4],ie[ce+5])))return M($,oe),!0}for(var fe=fe||W.source,de=de||W.target,be=a.getArrowWidth(J,Z),ge=[{name:"source",x:X.arrowStartX,y:X.arrowStartY,angle:X.srcArrowAngle},{name:"target",x:X.arrowEndX,y:X.arrowEndY,angle:X.tgtArrowAngle},{name:"mid-source",x:X.midX,y:X.midY,angle:X.midsrcArrowAngle},{name:"mid-target",x:X.midX,y:X.midY,angle:X.midtgtArrowAngle}],ce=0;ce<ge.length;ce++){var xe=ge[ce],Le=i.arrowShapes[$.pstyle(xe.name+"-arrow-shape").value],Oe=$.pstyle("width").pfValue;if(Le.roughCollide(e,t,be,xe.angle,{x:xe.x,y:xe.y},Oe,g)&&Le.collide(e,t,be,xe.angle,{x:xe.x,y:xe.y},Oe,g))return M($),!0}p&&s.length>0&&(I(fe),I(de))}function D($,W,X){return yi($,W,X)}function j($,W){var X=$._private,J=x,Z;W?Z=W+"-":Z="",$.boundingBox();var K=X.labelBounds[W||"main"],Y=$.pstyle(Z+"label").value,G=$.pstyle("text-events").strValue==="yes";if(!(!G||!Y)){var oe=D(X.rscratch,"labelX",W),ie=D(X.rscratch,"labelY",W),ce=D(X.rscratch,"labelAngle",W),fe=$.pstyle(Z+"text-margin-x").pfValue,de=$.pstyle(Z+"text-margin-y").pfValue,be=K.x1-J-fe,ge=K.x2+J-fe,xe=K.y1-J-de,Le=K.y2+J-de;if(ce){var Oe=Math.cos(ce),Fe=Math.sin(ce),et=function(ot,xt){return ot=ot-oe,xt=xt-ie,{x:ot*Oe-xt*Fe+oe,y:ot*Fe+xt*Oe+ie}},nt=et(be,xe),mt=et(be,Le),it=et(ge,xe),ze=et(ge,Le),He=[nt.x+fe,nt.y+de,it.x+fe,it.y+de,ze.x+fe,ze.y+de,mt.x+fe,mt.y+de];if(xi(e,t,He))return M($),!0}else if(Ul(K,e,t))return M($),!0}}for(var V=u.length-1;V>=0;V--){var U=u[V];U.isNode()?I(U)||j(U):A(U)||j(U)||j(U,"source")||j(U,"target")}return s};Mc.getAllInBox=function(e,t,r,n){var a=this.getCachedZSortedEles().interactive,i=this.cy.zoom(),u=2/i,s=[],h=Math.min(e,r),p=Math.max(e,r),g=Math.min(t,n),v=Math.max(t,n);e=h,r=p,t=g,n=v;var x=ni({x1:e,y1:t,x2:r,y2:n}),S=[{x:x.x1,y:x.y1},{x:x.x2,y:x.y1},{x:x.x2,y:x.y2},{x:x.x1,y:x.y2}],P=[[S[0],S[1]],[S[1],S[2]],[S[2],S[3]],[S[3],S[0]]];function N(ot,xt,Tt){return yi(ot,xt,Tt)}function M(ot,xt){var Tt=ot._private,$e=u,Xe="";ot.boundingBox();var Pe=Tt.labelBounds.main;if(!Pe)return null;var Ye=N(Tt.rscratch,"labelX",xt),at=N(Tt.rscratch,"labelY",xt),bt=N(Tt.rscratch,"labelAngle",xt),Et=ot.pstyle(Xe+"text-margin-x").pfValue,Vt=ot.pstyle(Xe+"text-margin-y").pfValue,Bt=Pe.x1-$e-Et,Mt=Pe.x2+$e-Et,cr=Pe.y1-$e-Vt,ar=Pe.y2+$e-Vt;if(bt){var ft=Math.cos(bt),fr=Math.sin(bt),Xt=function(dt,le){return dt=dt-Ye,le=le-at,{x:dt*ft-le*fr+Ye,y:dt*fr+le*ft+at}};return[Xt(Bt,cr),Xt(Mt,cr),Xt(Mt,ar),Xt(Bt,ar)]}else return[{x:Bt,y:cr},{x:Mt,y:cr},{x:Mt,y:ar},{x:Bt,y:ar}]}function I(ot,xt,Tt,$e){function Xe(Pe,Ye,at){return(at.y-Pe.y)*(Ye.x-Pe.x)>(Ye.y-Pe.y)*(at.x-Pe.x)}return Xe(ot,Tt,$e)!==Xe(xt,Tt,$e)&&Xe(ot,xt,Tt)!==Xe(ot,xt,$e)}for(var A=0;A<a.length;A++){var D=a[A];if(D.isNode()){var j=D,V=j.pstyle("text-events").strValue==="yes",U=j.pstyle("box-selection").strValue,$=j.pstyle("box-select-labels").strValue==="yes";if(U==="none")continue;var W=(U==="overlap"||$)&&V,X=j.boundingBox({includeNodes:!0,includeEdges:!1,includeLabels:W});if(U==="contain"){var J=!1;if($&&V){var Z=M(j);Z&&k_(Z,S)&&(s.push(j),J=!0)}!J&&xz(x,X)&&s.push(j)}else if(U==="overlap"&&WS(x,X)){var K=j.boundingBox({includeNodes:!0,includeEdges:!0,includeLabels:!1,includeMainLabels:!1,includeSourceLabels:!1,includeTargetLabels:!1}),Y=[{x:K.x1,y:K.y1},{x:K.x2,y:K.y1},{x:K.x2,y:K.y2},{x:K.x1,y:K.y2}];if(k_(Y,S))s.push(j);else{var G=M(j);G&&k_(G,S)&&s.push(j)}}}else{var oe=D,ie=oe._private,ce=ie.rscratch,fe=oe.pstyle("box-selection").strValue;if(fe==="none")continue;if(fe==="contain"){if(ce.startX!=null&&ce.startY!=null&&!Ul(x,ce.startX,ce.startY)||ce.endX!=null&&ce.endY!=null&&!Ul(x,ce.endX,ce.endY))continue;if(ce.edgeType==="bezier"||ce.edgeType==="multibezier"||ce.edgeType==="self"||ce.edgeType==="compound"||ce.edgeType==="segments"||ce.edgeType==="haystack"){for(var de=ie.rstyle.bezierPts||ie.rstyle.linePts||ie.rstyle.haystackPts,be=!0,ge=0;ge<de.length;ge++)if(!rP(x,de[ge])){be=!1;break}be&&s.push(oe)}else ce.edgeType==="straight"&&s.push(oe)}else if(fe==="overlap"){var xe=!1;if(ce.startX!=null&&ce.startY!=null&&ce.endX!=null&&ce.endY!=null&&(Ul(x,ce.startX,ce.startY)||Ul(x,ce.endX,ce.endY)))s.push(oe),xe=!0;else if(!xe&&ce.edgeType==="haystack"){for(var Le=ie.rstyle.haystackPts,Oe=0;Oe<Le.length;Oe++)if(rP(x,Le[Oe])){s.push(oe),xe=!0;break}}if(!xe){var Fe=ie.rstyle.bezierPts||ie.rstyle.linePts||ie.rstyle.haystackPts;if((!Fe||Fe.length<2)&&ce.edgeType==="straight"&&ce.startX!=null&&ce.startY!=null&&ce.endX!=null&&ce.endY!=null&&(Fe=[{x:ce.startX,y:ce.startY},{x:ce.endX,y:ce.endY}]),!Fe||Fe.length<2)continue;for(var et=0;et<Fe.length-1;et++){for(var nt=Fe[et],mt=Fe[et+1],it=0;it<P.length;it++){var ze=Hn(P[it],2),He=ze[0],We=ze[1];if(I(nt,mt,He,We)){s.push(oe),xe=!0;break}}if(xe)break}}}}}return s};var l0={};l0.calculateArrowAngles=function(e){var t=e._private.rscratch,r=t.edgeType==="haystack",n=t.edgeType==="bezier",a=t.edgeType==="multibezier",i=t.edgeType==="segments",u=t.edgeType==="compound",s=t.edgeType==="self",h,p,g,v,x,S,I,A;if(r?(g=t.haystackPts[0],v=t.haystackPts[1],x=t.haystackPts[2],S=t.haystackPts[3]):(g=t.arrowStartX,v=t.arrowStartY,x=t.arrowEndX,S=t.arrowEndY),I=t.midX,A=t.midY,i)h=g-t.segpts[0],p=v-t.segpts[1];else if(a||u||s||n){var P=t.allpts,N=fa(P[0],P[2],P[4],.1),M=fa(P[1],P[3],P[5],.1);h=g-N,p=v-M}else h=g-I,p=v-A;t.srcArrowAngle=Cv(h,p);var I=t.midX,A=t.midY;if(r&&(I=(g+x)/2,A=(v+S)/2),h=x-g,p=S-v,i){var P=t.allpts;if(P.length/2%2===0){var D=P.length/2,j=D-2;h=P[D]-P[j],p=P[D+1]-P[j+1]}else if(t.isRound)h=t.midVector[1],p=-t.midVector[0];else{var D=P.length/2-1,j=D-2;h=P[D]-P[j],p=P[D+1]-P[j+1]}}else if(a||u||s){var P=t.allpts,V=t.ctrlpts,U,$,W,X;if(V.length/2%2===0){var J=P.length/2-1,Z=J+2,K=Z+2;U=fa(P[J],P[Z],P[K],0),$=fa(P[J+1],P[Z+1],P[K+1],0),W=fa(P[J],P[Z],P[K],1e-4),X=fa(P[J+1],P[Z+1],P[K+1],1e-4)}else{var Z=P.length/2-1,J=Z-2,K=Z+2;U=fa(P[J],P[Z],P[K],.4999),$=fa(P[J+1],P[Z+1],P[K+1],.4999),W=fa(P[J],P[Z],P[K],.5),X=fa(P[J+1],P[Z+1],P[K+1],.5)}h=W-U,p=X-$}if(t.midtgtArrowAngle=Cv(h,p),t.midDispX=h,t.midDispY=p,h*=-1,p*=-1,i){var P=t.allpts;if(P.length/2%2!==0){if(!t.isRound){var D=P.length/2-1,Y=D+2;h=-(P[Y]-P[D]),p=-(P[Y+1]-P[D+1])}}}if(t.midsrcArrowAngle=Cv(h,p),i)h=x-t.segpts[t.segpts.length-2],p=S-t.segpts[t.segpts.length-1];else if(a||u||s||n){var P=t.allpts,G=P.length,N=fa(P[G-6],P[G-4],P[G-2],.9),M=fa(P[G-5],P[G-3],P[G-1],.9);h=x-N,p=S-M}else h=x-I,p=S-A;t.tgtArrowAngle=Cv(h,p)};l0.getArrowWidth=l0.getArrowHeight=function(e,t){var r=this.arrowWidthCache=this.arrowWidthCache||{},n=r[e+", "+t];return n||(n=Math.max(Math.pow(e*13.37,.9),29)*t,r[e+", "+t]=n,n)};var l2,u2,Ys={},ts={},jI,OI,rc,yy,To,Gu,Ju,Xs,zd,Dv,fR,pR,c2,d2,FI,$I=function(t,r,n){n.x=r.x-t.x,n.y=r.y-t.y,n.len=Math.sqrt(n.x*n.x+n.y*n.y),n.nx=n.x/n.len,n.ny=n.y/n.len,n.ang=Math.atan2(n.ny,n.nx)},zU=function(t,r){r.x=t.x*-1,r.y=t.y*-1,r.nx=t.nx*-1,r.ny=t.ny*-1,r.ang=t.ang>0?-(Math.PI-t.ang):Math.PI+t.ang},RU=function(t,r,n,a,i){if(t!==FI?$I(r,t,Ys):zU(ts,Ys),$I(r,n,ts),jI=Ys.nx*ts.ny-Ys.ny*ts.nx,OI=Ys.nx*ts.nx-Ys.ny*-ts.ny,To=Math.asin(Math.max(-1,Math.min(1,jI))),Math.abs(To)<1e-6){l2=r.x,u2=r.y,Ju=zd=0;return}rc=1,yy=!1,OI<0?To<0?To=Math.PI+To:(To=Math.PI-To,rc=-1,yy=!0):To>0&&(rc=-1,yy=!0),r.radius!==void 0?zd=r.radius:zd=a,Gu=To/2,Dv=Math.min(Ys.len/2,ts.len/2),i?(Xs=Math.abs(Math.cos(Gu)*zd/Math.sin(Gu)),Xs>Dv?(Xs=Dv,Ju=Math.abs(Xs*Math.sin(Gu)/Math.cos(Gu))):Ju=zd):(Xs=Math.min(Dv,zd),Ju=Math.abs(Xs*Math.sin(Gu)/Math.cos(Gu))),c2=r.x+ts.nx*Xs,d2=r.y+ts.ny*Xs,l2=c2-ts.ny*Ju*rc,u2=d2+ts.nx*Ju*rc,fR=r.x+Ys.nx*Xs,pR=r.y+Ys.ny*Xs,FI=r};function mR(e,t){t.radius===0?e.lineTo(t.cx,t.cy):e.arc(t.cx,t.cy,t.radius,t.startAngle,t.endAngle,t.counterClockwise)}function iE(e,t,r,n){var a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;return n===0||t.radius===0?{cx:t.x,cy:t.y,radius:0,startX:t.x,startY:t.y,stopX:t.x,stopY:t.y,startAngle:void 0,endAngle:void 0,counterClockwise:void 0}:(RU(e,t,r,n,a),{cx:l2,cy:u2,radius:Ju,startX:fR,startY:pR,stopX:c2,stopY:d2,startAngle:Ys.ang+Math.PI/2*rc,endAngle:ts.ang-Math.PI/2*rc,counterClockwise:yy})}var bm=.01,LU=Math.sqrt(2*bm),Ga={};Ga.findMidptPtsEtc=function(e,t){var r=t.posPts,n=t.intersectionPts,a=t.vectorNormInverse,i,u=e.pstyle("source-endpoint"),s=e.pstyle("target-endpoint"),h=u.units!=null&&s.units!=null,p=function(V,U,$,W){var X=W-U,J=$-V,Z=Math.sqrt(J*J+X*X);return{x:-X/Z,y:J/Z}},g=e.pstyle("edge-distances").value;switch(g){case"node-position":i=r;break;case"intersection":i=n;break;case"endpoints":{if(h){var v=this.manualEndptToPx(e.source()[0],u),x=Hn(v,2),S=x[0],P=x[1],N=this.manualEndptToPx(e.target()[0],s),M=Hn(N,2),I=M[0],A=M[1],D={x1:S,y1:P,x2:I,y2:A};a=p(S,P,I,A),i=D}else Jr("Edge ".concat(e.id()," has edge-distances:endpoints specified without manual endpoints specified via source-endpoint and target-endpoint.  Falling back on edge-distances:intersection (default).")),i=n;break}}return{midptPts:i,vectorNormInverse:a}};Ga.findHaystackPoints=function(e){for(var t=0;t<e.length;t++){var r=e[t],n=r._private,a=n.rscratch;if(!a.haystack){var i=Math.random()*2*Math.PI;a.source={x:Math.cos(i),y:Math.sin(i)},i=Math.random()*2*Math.PI,a.target={x:Math.cos(i),y:Math.sin(i)}}var u=n.source,s=n.target,h=u.position(),p=s.position(),g=u.width(),v=s.width(),x=u.height(),S=s.height(),P=r.pstyle("haystack-radius").value,N=P/2;a.haystackPts=a.allpts=[a.source.x*g*N+h.x,a.source.y*x*N+h.y,a.target.x*v*N+p.x,a.target.y*S*N+p.y],a.midX=(a.allpts[0]+a.allpts[2])/2,a.midY=(a.allpts[1]+a.allpts[3])/2,a.edgeType="haystack",a.haystack=!0,this.storeEdgeProjections(r),this.calculateArrowAngles(r),this.recalculateEdgeLabelProjections(r),this.calculateLabelAngles(r)}};Ga.findSegmentsPoints=function(e,t){var r=e._private.rscratch,n=e.pstyle("segment-weights"),a=e.pstyle("segment-distances"),i=e.pstyle("segment-radii"),u=e.pstyle("radius-type"),s=Math.min(n.pfValue.length,a.pfValue.length),h=i.pfValue[i.pfValue.length-1],p=u.pfValue[u.pfValue.length-1];r.edgeType="segments",r.segpts=[],r.radii=[],r.isArcRadius=[];for(var g=0;g<s;g++){var v=n.pfValue[g],x=a.pfValue[g],S=1-v,P=v,N=this.findMidptPtsEtc(e,t),M=N.midptPts,I=N.vectorNormInverse,A={x:M.x1*S+M.x2*P,y:M.y1*S+M.y2*P};r.segpts.push(A.x+I.x*x,A.y+I.y*x),r.radii.push(i.pfValue[g]!==void 0?i.pfValue[g]:h),r.isArcRadius.push((u.pfValue[g]!==void 0?u.pfValue[g]:p)==="arc-radius")}};Ga.findLoopPoints=function(e,t,r,n){var a=e._private.rscratch,i=t.dirCounts,u=t.srcPos,s=e.pstyle("control-point-distances"),h=s?s.pfValue[0]:void 0,p=e.pstyle("loop-direction").pfValue,g=e.pstyle("loop-sweep").pfValue,v=e.pstyle("control-point-step-size").pfValue;a.edgeType="self";var x=r,S=v;n&&(x=0,S=h);var P=p-Math.PI/2,N=P-g/2,M=P+g/2,I=p+"_"+g;x=i[I]===void 0?i[I]=0:++i[I],a.ctrlpts=[u.x+Math.cos(N)*1.4*S*(x/3+1),u.y+Math.sin(N)*1.4*S*(x/3+1),u.x+Math.cos(M)*1.4*S*(x/3+1),u.y+Math.sin(M)*1.4*S*(x/3+1)]};Ga.findCompoundLoopPoints=function(e,t,r,n){var a=e._private.rscratch;a.edgeType="compound";var i=t.srcPos,u=t.tgtPos,s=t.srcW,h=t.srcH,p=t.tgtW,g=t.tgtH,v=e.pstyle("control-point-step-size").pfValue,x=e.pstyle("control-point-distances"),S=x?x.pfValue[0]:void 0,P=r,N=v;n&&(P=0,N=S);var M=50,I={x:i.x-s/2,y:i.y-h/2},A={x:u.x-p/2,y:u.y-g/2},D={x:Math.min(I.x,A.x),y:Math.min(I.y,A.y)},j=.5,V=Math.max(j,Math.log(s*bm)),U=Math.max(j,Math.log(p*bm));a.ctrlpts=[D.x,D.y-(1+Math.pow(M,1.12)/100)*N*(P/3+1)*V,D.x-(1+Math.pow(M,1.12)/100)*N*(P/3+1)*U,D.y]};Ga.findStraightEdgePoints=function(e){e._private.rscratch.edgeType="straight"};Ga.findBezierPoints=function(e,t,r,n,a){var i=e._private.rscratch,u=e.pstyle("control-point-step-size").pfValue,s=e.pstyle("control-point-distances"),h=e.pstyle("control-point-weights"),p=s&&h?Math.min(s.value.length,h.value.length):1,g=s?s.pfValue[0]:void 0,v=h.value[0],x=n;i.edgeType=x?"multibezier":"bezier",i.ctrlpts=[];for(var S=0;S<p;S++){var P=(.5-t.eles.length/2+r)*u*(a?-1:1),N=void 0,M=GS(P);x&&(g=s?s.pfValue[S]:u,v=h.value[S]),n?N=g:N=g!==void 0?M*g:void 0;var I=N!==void 0?N:P,A=1-v,D=v,j=this.findMidptPtsEtc(e,t),V=j.midptPts,U=j.vectorNormInverse,$={x:V.x1*A+V.x2*D,y:V.y1*A+V.y2*D};i.ctrlpts.push($.x+U.x*I,$.y+U.y*I)}};Ga.findTaxiPoints=function(e,t){var r=e._private.rscratch;r.edgeType="segments";var n="vertical",a="horizontal",i="leftward",u="rightward",s="downward",h="upward",p="auto",g=t.posPts,v=t.srcW,x=t.srcH,S=t.tgtW,P=t.tgtH,N=e.pstyle("edge-distances").value,M=N!=="node-position",I=e.pstyle("taxi-direction").value,A=I,D=e.pstyle("taxi-turn"),j=D.units==="%",V=D.pfValue,U=V<0,$=e.pstyle("taxi-turn-min-distance").pfValue,W=M?(v+S)/2:0,X=M?(x+P)/2:0,J=g.x2-g.x1,Z=g.y2-g.y1,K=function(le,Be){return le>0?Math.max(le-Be,0):Math.min(le+Be,0)},Y=K(J,W),G=K(Z,X),oe=!1;A===p?I=Math.abs(Y)>Math.abs(G)?a:n:A===h||A===s?(I=n,oe=!0):(A===i||A===u)&&(I=a,oe=!0);var ie=I===n,ce=ie?G:Y,fe=ie?Z:J,de=GS(fe),be=!1;!(oe&&(j||U))&&(A===s&&fe<0||A===h&&fe>0||A===i&&fe>0||A===u&&fe<0)&&(de*=-1,ce=de*Math.abs(ce),be=!0);var ge;if(j){var xe=V<0?1+V:V;ge=xe*ce}else{var Le=V<0?ce:0;ge=Le+V*de}var Oe=function(le){return Math.abs(le)<$||Math.abs(le)>=Math.abs(ce)},Fe=Oe(ge),et=Oe(Math.abs(ce)-Math.abs(ge)),nt=Fe||et;if(nt&&!be)if(ie){var mt=Math.abs(fe)<=x/2,it=Math.abs(J)<=S/2;if(mt){var ze=(g.x1+g.x2)/2,He=g.y1,We=g.y2;r.segpts=[ze,He,ze,We]}else if(it){var ot=(g.y1+g.y2)/2,xt=g.x1,Tt=g.x2;r.segpts=[xt,ot,Tt,ot]}else r.segpts=[g.x1,g.y2]}else{var $e=Math.abs(fe)<=v/2,Xe=Math.abs(Z)<=P/2;if($e){var Pe=(g.y1+g.y2)/2,Ye=g.x1,at=g.x2;r.segpts=[Ye,Pe,at,Pe]}else if(Xe){var bt=(g.x1+g.x2)/2,Et=g.y1,Vt=g.y2;r.segpts=[bt,Et,bt,Vt]}else r.segpts=[g.x2,g.y1]}else if(ie){var Bt=g.y1+ge+(M?x/2*de:0),Mt=g.x1,cr=g.x2;r.segpts=[Mt,Bt,cr,Bt]}else{var ar=g.x1+ge+(M?v/2*de:0),ft=g.y1,fr=g.y2;r.segpts=[ar,ft,ar,fr]}if(r.isRound){var Xt=e.pstyle("taxi-radius").value,kt=e.pstyle("radius-type").value[0]==="arc-radius";r.radii=new Array(r.segpts.length/2).fill(Xt),r.isArcRadius=new Array(r.segpts.length/2).fill(kt)}};Ga.tryToCorrectInvalidPoints=function(e,t){var r=e._private.rscratch;if(r.edgeType==="bezier"){var n=t.srcPos,a=t.tgtPos,i=t.srcW,u=t.srcH,s=t.tgtW,h=t.tgtH,p=t.srcShape,g=t.tgtShape,v=t.srcCornerRadius,x=t.tgtCornerRadius,S=t.srcRs,P=t.tgtRs,N=!Ht(r.startX)||!Ht(r.startY),M=!Ht(r.arrowStartX)||!Ht(r.arrowStartY),I=!Ht(r.endX)||!Ht(r.endY),A=!Ht(r.arrowEndX)||!Ht(r.arrowEndY),D=3,j=this.getArrowWidth(e.pstyle("width").pfValue,e.pstyle("arrow-scale").value)*this.arrowShapeWidth,V=D*j,U=_c({x:r.ctrlpts[0],y:r.ctrlpts[1]},{x:r.startX,y:r.startY}),$=U<V,W=_c({x:r.ctrlpts[0],y:r.ctrlpts[1]},{x:r.endX,y:r.endY}),X=W<V,J=!1;if(N||M||$){J=!0;var Z={x:r.ctrlpts[0]-n.x,y:r.ctrlpts[1]-n.y},K=Math.sqrt(Z.x*Z.x+Z.y*Z.y),Y={x:Z.x/K,y:Z.y/K},G=Math.max(i,u),oe={x:r.ctrlpts[0]+Y.x*2*G,y:r.ctrlpts[1]+Y.y*2*G},ie=p.intersectLine(n.x,n.y,i,u,oe.x,oe.y,0,v,S);$?(r.ctrlpts[0]=r.ctrlpts[0]+Y.x*(V-U),r.ctrlpts[1]=r.ctrlpts[1]+Y.y*(V-U)):(r.ctrlpts[0]=ie[0]+Y.x*V,r.ctrlpts[1]=ie[1]+Y.y*V)}if(I||A||X){J=!0;var ce={x:r.ctrlpts[0]-a.x,y:r.ctrlpts[1]-a.y},fe=Math.sqrt(ce.x*ce.x+ce.y*ce.y),de={x:ce.x/fe,y:ce.y/fe},be=Math.max(i,u),ge={x:r.ctrlpts[0]+de.x*2*be,y:r.ctrlpts[1]+de.y*2*be},xe=g.intersectLine(a.x,a.y,s,h,ge.x,ge.y,0,x,P);X?(r.ctrlpts[0]=r.ctrlpts[0]+de.x*(V-W),r.ctrlpts[1]=r.ctrlpts[1]+de.y*(V-W)):(r.ctrlpts[0]=xe[0]+de.x*V,r.ctrlpts[1]=xe[1]+de.y*V)}J&&this.findEndpoints(e)}};Ga.storeAllpts=function(e){var t=e._private.rscratch;if(t.edgeType==="multibezier"||t.edgeType==="bezier"||t.edgeType==="self"||t.edgeType==="compound"){t.allpts=[],t.allpts.push(t.startX,t.startY);for(var r=0;r+1<t.ctrlpts.length;r+=2)t.allpts.push(t.ctrlpts[r],t.ctrlpts[r+1]),r+3<t.ctrlpts.length&&t.allpts.push((t.ctrlpts[r]+t.ctrlpts[r+2])/2,(t.ctrlpts[r+1]+t.ctrlpts[r+3])/2);t.allpts.push(t.endX,t.endY);var n,a;t.ctrlpts.length/2%2===0?(n=t.allpts.length/2-1,t.midX=t.allpts[n],t.midY=t.allpts[n+1]):(n=t.allpts.length/2-3,a=.5,t.midX=fa(t.allpts[n],t.allpts[n+2],t.allpts[n+4],a),t.midY=fa(t.allpts[n+1],t.allpts[n+3],t.allpts[n+5],a))}else if(t.edgeType==="straight")t.allpts=[t.startX,t.startY,t.endX,t.endY],t.midX=(t.startX+t.endX+t.arrowStartX+t.arrowEndX)/4,t.midY=(t.startY+t.endY+t.arrowStartY+t.arrowEndY)/4;else if(t.edgeType==="segments"){if(t.allpts=[],t.allpts.push(t.startX,t.startY),t.allpts.push.apply(t.allpts,t.segpts),t.allpts.push(t.endX,t.endY),t.isRound){t.roundCorners=[];for(var i=2;i+3<t.allpts.length;i+=2){var u=t.radii[i/2-1],s=t.isArcRadius[i/2-1];t.roundCorners.push(iE({x:t.allpts[i-2],y:t.allpts[i-1]},{x:t.allpts[i],y:t.allpts[i+1],radius:u},{x:t.allpts[i+2],y:t.allpts[i+3]},u,s))}}if(t.segpts.length%4===0){var h=t.segpts.length/2,p=h-2;t.midX=(t.segpts[p]+t.segpts[h])/2,t.midY=(t.segpts[p+1]+t.segpts[h+1])/2}else{var g=t.segpts.length/2-1;if(!t.isRound)t.midX=t.segpts[g],t.midY=t.segpts[g+1];else{var v={x:t.segpts[g],y:t.segpts[g+1]},x=t.roundCorners[g/2];if(x.radius===0){var S={x:t.segpts[g+2],y:t.segpts[g+3]};t.midX=v.x,t.midY=v.y,t.midVector=[v.y-S.y,S.x-v.x]}else{var P=[v.x-x.cx,v.y-x.cy],N=x.radius/Math.sqrt(Math.pow(P[0],2)+Math.pow(P[1],2));P=P.map(function(M){return M*N}),t.midX=x.cx+P[0],t.midY=x.cy+P[1],t.midVector=P}}}}};Ga.checkForInvalidEdgeWarning=function(e){var t=e[0]._private.rscratch;t.nodesOverlap||Ht(t.startX)&&Ht(t.startY)&&Ht(t.endX)&&Ht(t.endY)?t.loggedErr=!1:t.loggedErr||(t.loggedErr=!0,Jr("Edge `"+e.id()+"` has invalid endpoints and so it is impossible to draw.  Adjust your edge style (e.g. control points) accordingly or use an alternative edge type.  This is expected behaviour when the source node and the target node overlap."))};Ga.findEdgeControlPoints=function(e){var t=this;if(!(!e||e.length===0)){for(var r=this,n=r.cy,a=n.hasCompoundNodes(),i=new Ro,u=function(X,J){return[].concat(Jy(X),[J?1:0]).join("-")},s=[],h=[],p=0;p<e.length;p++){var g=e[p],v=g._private,x=g.pstyle("curve-style").value;if(!(g.removed()||!g.takesUpSpace())){if(x==="haystack"){h.push(g);continue}var S=x==="unbundled-bezier"||Vl(x,"segments")||x==="straight"||x==="straight-triangle"||Vl(x,"taxi"),P=x==="unbundled-bezier"||x==="bezier",N=v.source,M=v.target,I=N.poolIndex(),A=M.poolIndex(),D=[I,A].sort(),j=u(D,S),V=i.get(j);V==null&&(V={eles:[]},s.push({pairId:D,edgeIsUnbundled:S}),i.set(j,V)),V.eles.push(g),S&&(V.hasUnbundled=!0),P&&(V.hasBezier=!0)}}for(var U=function(){var X=s[$],J=X.pairId,Z=X.edgeIsUnbundled,K=u(J,Z),Y=i.get(K),G;if(!Y.hasUnbundled){var oe=Y.eles[0].parallelEdges().filter(function(kt){return kt.isBundledBezier()});qS(Y.eles),oe.forEach(function(kt){return Y.eles.push(kt)}),Y.eles.sort(function(kt,dt){return kt.poolIndex()-dt.poolIndex()})}var ie=Y.eles[0],ce=ie.source(),fe=ie.target();if(ce.poolIndex()>fe.poolIndex()){var de=ce;ce=fe,fe=de}var be=Y.srcPos=ce.position(),ge=Y.tgtPos=fe.position(),xe=Y.srcW=ce.outerWidth(),Le=Y.srcH=ce.outerHeight(),Oe=Y.tgtW=fe.outerWidth(),Fe=Y.tgtH=fe.outerHeight(),et=Y.srcShape=r.nodeShapes[t.getNodeShape(ce)],nt=Y.tgtShape=r.nodeShapes[t.getNodeShape(fe)],mt=Y.srcCornerRadius=ce.pstyle("corner-radius").value==="auto"?"auto":ce.pstyle("corner-radius").pfValue,it=Y.tgtCornerRadius=fe.pstyle("corner-radius").value==="auto"?"auto":fe.pstyle("corner-radius").pfValue,ze=Y.tgtRs=fe._private.rscratch,He=Y.srcRs=ce._private.rscratch;Y.dirCounts={north:0,west:0,south:0,east:0,northwest:0,southwest:0,northeast:0,southeast:0};for(var We=0;We<Y.eles.length;We++){var ot=Y.eles[We],xt=ot[0]._private.rscratch,Tt=ot.pstyle("curve-style").value,$e=Tt==="unbundled-bezier"||Vl(Tt,"segments")||Vl(Tt,"taxi"),Xe=!ce.same(ot.source());if(!Y.calculatedIntersection&&ce!==fe&&(Y.hasBezier||Y.hasUnbundled)){Y.calculatedIntersection=!0;var Pe=et.intersectLine(be.x,be.y,xe,Le,ge.x,ge.y,0,mt,He),Ye=Y.srcIntn=Pe,at=nt.intersectLine(ge.x,ge.y,Oe,Fe,be.x,be.y,0,it,ze),bt=Y.tgtIntn=at,Et=Y.intersectionPts={x1:Pe[0],x2:at[0],y1:Pe[1],y2:at[1]},Vt=Y.posPts={x1:be.x,x2:ge.x,y1:be.y,y2:ge.y},Bt=at[1]-Pe[1],Mt=at[0]-Pe[0],cr=Math.sqrt(Mt*Mt+Bt*Bt);Ht(cr)&&cr>=LU||(cr=Math.sqrt(Math.max(Mt*Mt,bm)+Math.max(Bt*Bt,bm)));var ar=Y.vector={x:Mt,y:Bt},ft=Y.vectorNorm={x:ar.x/cr,y:ar.y/cr},fr={x:-ft.y,y:ft.x};Y.nodesOverlap=!Ht(cr)||nt.checkPoint(Pe[0],Pe[1],0,Oe,Fe,ge.x,ge.y,it,ze)||et.checkPoint(at[0],at[1],0,xe,Le,be.x,be.y,mt,He),Y.vectorNormInverse=fr,G={nodesOverlap:Y.nodesOverlap,dirCounts:Y.dirCounts,calculatedIntersection:!0,hasBezier:Y.hasBezier,hasUnbundled:Y.hasUnbundled,eles:Y.eles,srcPos:ge,srcRs:ze,tgtPos:be,tgtRs:He,srcW:Oe,srcH:Fe,tgtW:xe,tgtH:Le,srcIntn:bt,tgtIntn:Ye,srcShape:nt,tgtShape:et,posPts:{x1:Vt.x2,y1:Vt.y2,x2:Vt.x1,y2:Vt.y1},intersectionPts:{x1:Et.x2,y1:Et.y2,x2:Et.x1,y2:Et.y1},vector:{x:-ar.x,y:-ar.y},vectorNorm:{x:-ft.x,y:-ft.y},vectorNormInverse:{x:-fr.x,y:-fr.y}}}var Xt=Xe?G:Y;xt.nodesOverlap=Xt.nodesOverlap,xt.srcIntn=Xt.srcIntn,xt.tgtIntn=Xt.tgtIntn,xt.isRound=Tt.startsWith("round"),a&&(ce.isParent()||ce.isChild()||fe.isParent()||fe.isChild())&&(ce.parents().anySame(fe)||fe.parents().anySame(ce)||ce.same(fe)&&ce.isParent())?t.findCompoundLoopPoints(ot,Xt,We,$e):ce===fe?t.findLoopPoints(ot,Xt,We,$e):Tt.endsWith("segments")?t.findSegmentsPoints(ot,Xt):Tt.endsWith("taxi")?t.findTaxiPoints(ot,Xt):Tt==="straight"||!$e&&Y.eles.length%2===1&&We===Math.floor(Y.eles.length/2)?t.findStraightEdgePoints(ot):t.findBezierPoints(ot,Xt,We,$e,Xe),t.findEndpoints(ot),t.tryToCorrectInvalidPoints(ot,Xt),t.checkForInvalidEdgeWarning(ot),t.storeAllpts(ot),t.storeEdgeProjections(ot),t.calculateArrowAngles(ot),t.recalculateEdgeLabelProjections(ot),t.calculateLabelAngles(ot)}},$=0;$<s.length;$++)U();this.findHaystackPoints(h)}};function gR(e){var t=[];if(e!=null){for(var r=0;r<e.length;r+=2){var n=e[r],a=e[r+1];t.push({x:n,y:a})}return t}}Ga.getSegmentPoints=function(e){var t=e[0]._private.rscratch;this.recalculateRenderedStyle(e);var r=t.edgeType;if(r==="segments")return gR(t.segpts)};Ga.getControlPoints=function(e){var t=e[0]._private.rscratch;this.recalculateRenderedStyle(e);var r=t.edgeType;if(r==="bezier"||r==="multibezier"||r==="self"||r==="compound")return gR(t.ctrlpts)};Ga.getEdgeMidpoint=function(e){var t=e[0]._private.rscratch;return this.recalculateRenderedStyle(e),{x:t.midX,y:t.midY}};var Xm={};Xm.manualEndptToPx=function(e,t){var r=this,n=e.position(),a=e.outerWidth(),i=e.outerHeight(),u=e._private.rscratch;if(t.value.length===2){var s=[t.pfValue[0],t.pfValue[1]];return t.units[0]==="%"&&(s[0]=s[0]*a),t.units[1]==="%"&&(s[1]=s[1]*i),s[0]+=n.x,s[1]+=n.y,s}else{var h=t.pfValue[0];h=-Math.PI/2+h;var p=2*Math.max(a,i),g=[n.x+Math.cos(h)*p,n.y+Math.sin(h)*p];return r.nodeShapes[this.getNodeShape(e)].intersectLine(n.x,n.y,a,i,g[0],g[1],0,e.pstyle("corner-radius").value==="auto"?"auto":e.pstyle("corner-radius").pfValue,u)}};Xm.findEndpoints=function(e){var t,r,n,a,i=this,u,s=e.source()[0],h=e.target()[0],p=s.position(),g=h.position(),v=e.pstyle("target-arrow-shape").value,x=e.pstyle("source-arrow-shape").value,S=e.pstyle("target-distance-from-node").pfValue,P=e.pstyle("source-distance-from-node").pfValue,N=s._private.rscratch,M=h._private.rscratch,I=e.pstyle("curve-style").value,A=e._private.rscratch,D=A.edgeType,j=Vl(I,"taxi"),V=D==="self"||D==="compound",U=D==="bezier"||D==="multibezier"||V,$=D!=="bezier",W=D==="straight"||D==="segments",X=D==="segments",J=U||$||W,Z=V||j,K=e.pstyle("source-endpoint"),Y=Z?"outside-to-node":K.value,G=s.pstyle("corner-radius").value==="auto"?"auto":s.pstyle("corner-radius").pfValue,oe=e.pstyle("target-endpoint"),ie=Z?"outside-to-node":oe.value,ce=h.pstyle("corner-radius").value==="auto"?"auto":h.pstyle("corner-radius").pfValue;A.srcManEndpt=K,A.tgtManEndpt=oe;var fe,de,be,ge,xe=(t=(oe==null||(r=oe.pfValue)===null||r===void 0?void 0:r.length)===2?oe.pfValue:null)!==null&&t!==void 0?t:[0,0],Le=(n=(K==null||(a=K.pfValue)===null||a===void 0?void 0:a.length)===2?K.pfValue:null)!==null&&n!==void 0?n:[0,0];if(U){var Oe=[A.ctrlpts[0],A.ctrlpts[1]],Fe=$?[A.ctrlpts[A.ctrlpts.length-2],A.ctrlpts[A.ctrlpts.length-1]]:Oe;fe=Fe,de=Oe}else if(W){var et=X?A.segpts.slice(0,2):[g.x+xe[0],g.y+xe[1]],nt=X?A.segpts.slice(A.segpts.length-2):[p.x+Le[0],p.y+Le[1]];fe=nt,de=et}if(ie==="inside-to-node")u=[g.x,g.y];else if(oe.units)u=this.manualEndptToPx(h,oe);else if(ie==="outside-to-line")u=A.tgtIntn;else if(ie==="outside-to-node"||ie==="outside-to-node-or-label"?be=fe:(ie==="outside-to-line"||ie==="outside-to-line-or-label")&&(be=[p.x,p.y]),u=i.nodeShapes[this.getNodeShape(h)].intersectLine(g.x,g.y,h.outerWidth(),h.outerHeight(),be[0],be[1],0,ce,M),ie==="outside-to-node-or-label"||ie==="outside-to-line-or-label"){var mt=h._private.rscratch,it=mt.labelWidth,ze=mt.labelHeight,He=mt.labelX,We=mt.labelY,ot=it/2,xt=ze/2,Tt=h.pstyle("text-valign").value;Tt==="top"?We-=xt:Tt==="bottom"&&(We+=xt);var $e=h.pstyle("text-halign").value;$e==="left"?He-=ot:$e==="right"&&(He+=ot);var Xe=mm(be[0],be[1],[He-ot,We-xt,He+ot,We-xt,He+ot,We+xt,He-ot,We+xt],g.x,g.y);if(Xe.length>0){var Pe=p,Ye=Yu(Pe,rh(u)),at=Yu(Pe,rh(Xe)),bt=Ye;if(at<Ye&&(u=Xe,bt=at),Xe.length>2){var Et=Yu(Pe,{x:Xe[2],y:Xe[3]});Et<bt&&(u=[Xe[2],Xe[3]])}}}var Vt=kv(u,fe,i.arrowShapes[v].spacing(e)+S),Bt=kv(u,fe,i.arrowShapes[v].gap(e)+S);if(A.endX=Bt[0],A.endY=Bt[1],A.arrowEndX=Vt[0],A.arrowEndY=Vt[1],Y==="inside-to-node")u=[p.x,p.y];else if(K.units)u=this.manualEndptToPx(s,K);else if(Y==="outside-to-line")u=A.srcIntn;else if(Y==="outside-to-node"||Y==="outside-to-node-or-label"?ge=de:(Y==="outside-to-line"||Y==="outside-to-line-or-label")&&(ge=[g.x,g.y]),u=i.nodeShapes[this.getNodeShape(s)].intersectLine(p.x,p.y,s.outerWidth(),s.outerHeight(),ge[0],ge[1],0,G,N),Y==="outside-to-node-or-label"||Y==="outside-to-line-or-label"){var Mt=s._private.rscratch,cr=Mt.labelWidth,ar=Mt.labelHeight,ft=Mt.labelX,fr=Mt.labelY,Xt=cr/2,kt=ar/2,dt=s.pstyle("text-valign").value;dt==="top"?fr-=kt:dt==="bottom"&&(fr+=kt);var le=s.pstyle("text-halign").value;le==="left"?ft-=Xt:le==="right"&&(ft+=Xt);var Be=mm(ge[0],ge[1],[ft-Xt,fr-kt,ft+Xt,fr-kt,ft+Xt,fr+kt,ft-Xt,fr+kt],p.x,p.y);if(Be.length>0){var qe=g,st=Yu(qe,rh(u)),ut=Yu(qe,rh(Be)),vt=st;if(ut<st&&(u=[Be[0],Be[1]],vt=ut),Be.length>2){var gt=Yu(qe,{x:Be[2],y:Be[3]});gt<vt&&(u=[Be[2],Be[3]])}}}var Ut=kv(u,de,i.arrowShapes[x].spacing(e)+P),Ot=kv(u,de,i.arrowShapes[x].gap(e)+P);A.startX=Ot[0],A.startY=Ot[1],A.arrowStartX=Ut[0],A.arrowStartY=Ut[1],J&&(!Ht(A.startX)||!Ht(A.startY)||!Ht(A.endX)||!Ht(A.endY)?A.badLine=!0:A.badLine=!1)};Xm.getSourceEndpoint=function(e){var t=e[0]._private.rscratch;switch(this.recalculateRenderedStyle(e),t.edgeType){case"haystack":return{x:t.haystackPts[0],y:t.haystackPts[1]};default:return{x:t.arrowStartX,y:t.arrowStartY}}};Xm.getTargetEndpoint=function(e){var t=e[0]._private.rscratch;switch(this.recalculateRenderedStyle(e),t.edgeType){case"haystack":return{x:t.haystackPts[2],y:t.haystackPts[3]};default:return{x:t.arrowEndX,y:t.arrowEndY}}};var sE={};function BU(e,t,r){for(var n=function(p,g,v,x){return fa(p,g,v,x)},a=t._private,i=a.rstyle.bezierPts,u=0;u<e.bezierProjPcts.length;u++){var s=e.bezierProjPcts[u];i.push({x:n(r[0],r[2],r[4],s),y:n(r[1],r[3],r[5],s)})}}sE.storeEdgeProjections=function(e){var t=e._private,r=t.rscratch,n=r.edgeType;if(t.rstyle.bezierPts=null,t.rstyle.linePts=null,t.rstyle.haystackPts=null,n==="multibezier"||n==="bezier"||n==="self"||n==="compound"){t.rstyle.bezierPts=[];for(var a=0;a+5<r.allpts.length;a+=4)BU(this,e,r.allpts.slice(a,a+6))}else if(n==="segments")for(var i=t.rstyle.linePts=[],a=0;a+1<r.allpts.length;a+=2)i.push({x:r.allpts[a],y:r.allpts[a+1]});else if(n==="haystack"){var u=r.haystackPts;t.rstyle.haystackPts=[{x:u[0],y:u[1]},{x:u[2],y:u[3]}]}t.rstyle.arrowWidth=this.getArrowWidth(e.pstyle("width").pfValue,e.pstyle("arrow-scale").value)*this.arrowShapeWidth};sE.recalculateEdgeProjections=function(e){this.findEdgeControlPoints(e)};var oo={};oo.recalculateNodeLabelProjection=function(e){var t=e.pstyle("label").strValue;if(!iu(t)){var r,n,a=e._private,i=e.width(),u=e.height(),s=e.padding(),h=e.position(),p=e.pstyle("text-halign").strValue,g=e.pstyle("text-valign").strValue,v=a.rscratch,x=a.rstyle;switch(p){case"left":r=h.x-i/2-s;break;case"right":r=h.x+i/2+s;break;default:r=h.x}switch(g){case"top":n=h.y-u/2-s;break;case"bottom":n=h.y+u/2+s;break;default:n=h.y}v.labelX=r,v.labelY=n,x.labelX=r,x.labelY=n,this.calculateLabelAngles(e),this.applyLabelDimensions(e)}};var vR=function(t,r){var n=Math.atan(r/t);return t===0&&n<0&&(n=n*-1),n},yR=function(t,r){var n=r.x-t.x,a=r.y-t.y;return vR(n,a)},jU=function(t,r,n,a){var i=pm(0,a-.001,1),u=pm(0,a+.001,1),s=ph(t,r,n,i),h=ph(t,r,n,u);return yR(s,h)};oo.recalculateEdgeLabelProjections=function(e){var t,r=e._private,n=r.rscratch,a=this,i={mid:e.pstyle("label").strValue,source:e.pstyle("source-label").strValue,target:e.pstyle("target-label").strValue};if(i.mid||i.source||i.target){t={x:n.midX,y:n.midY};var u=function(v,x,S){Mo(r.rscratch,v,x,S),Mo(r.rstyle,v,x,S)};u("labelX",null,t.x),u("labelY",null,t.y);var s=vR(n.midDispX,n.midDispY);u("labelAutoAngle",null,s);var h=function(){if(h.cache)return h.cache;for(var v=[],x=0;x+5<n.allpts.length;x+=4){var S={x:n.allpts[x],y:n.allpts[x+1]},P={x:n.allpts[x+2],y:n.allpts[x+3]},N={x:n.allpts[x+4],y:n.allpts[x+5]};v.push({p0:S,p1:P,p2:N,startDist:0,length:0,segments:[]})}var M=r.rstyle.bezierPts,I=a.bezierProjPcts.length;function A($,W,X,J,Z){var K=_c(W,X),Y=$.segments[$.segments.length-1],G={p0:W,p1:X,t0:J,t1:Z,startDist:Y?Y.startDist+Y.length:0,length:K};$.segments.push(G),$.length+=K}for(var D=0;D<v.length;D++){var j=v[D],V=v[D-1];V&&(j.startDist=V.startDist+V.length),A(j,j.p0,M[D*I],0,a.bezierProjPcts[0]);for(var U=0;U<I-1;U++)A(j,M[D*I+U],M[D*I+U+1],a.bezierProjPcts[U],a.bezierProjPcts[U+1]);A(j,M[D*I+I-1],j.p2,a.bezierProjPcts[I-1],1)}return h.cache=v},p=function(v){var x,S=v==="source";if(i[v]){var P=e.pstyle(v+"-text-offset").pfValue;switch(n.edgeType){case"self":case"compound":case"bezier":case"multibezier":{for(var N=h(),M,I=0,A=0,D=0;D<N.length;D++){for(var j=N[S?D:N.length-1-D],V=0;V<j.segments.length;V++){var U=j.segments[S?V:j.segments.length-1-V],$=D===N.length-1&&V===j.segments.length-1;if(I=A,A+=U.length,A>=P||$){M={cp:j,segment:U};break}}if(M)break}var W=M.cp,X=M.segment,J=(P-I)/X.length,Z=X.t1-X.t0,K=S?X.t0+Z*J:X.t1-Z*J;K=pm(0,K,1),t=ph(W.p0,W.p1,W.p2,K),x=jU(W.p0,W.p1,W.p2,K);break}case"straight":case"segments":case"haystack":{for(var Y=0,G,oe,ie,ce,fe=n.allpts.length,de=0;de+3<fe&&(S?(ie={x:n.allpts[de],y:n.allpts[de+1]},ce={x:n.allpts[de+2],y:n.allpts[de+3]}):(ie={x:n.allpts[fe-2-de],y:n.allpts[fe-1-de]},ce={x:n.allpts[fe-4-de],y:n.allpts[fe-3-de]}),G=_c(ie,ce),oe=Y,Y+=G,!(Y>=P));de+=2);var be=P-oe,ge=be/G;ge=pm(0,ge,1),t=s$(ie,ce,ge),x=yR(ie,ce);break}}u("labelX",v,t.x),u("labelY",v,t.y),u("labelAutoAngle",v,x)}};p("source"),p("target"),this.applyLabelDimensions(e)}};oo.applyLabelDimensions=function(e){this.applyPrefixedLabelDimensions(e),e.isEdge()&&(this.applyPrefixedLabelDimensions(e,"source"),this.applyPrefixedLabelDimensions(e,"target"))};oo.applyPrefixedLabelDimensions=function(e,t){var r=e._private,n=this.getLabelText(e,t),a=bc(n,e._private.labelDimsKey);if(yi(r.rscratch,"prefixedLabelDimsKey",t)!==a){Mo(r.rscratch,"prefixedLabelDimsKey",t,a);var i=this.calculateLabelDimensions(e,n),u=e.pstyle("line-height").pfValue,s=e.pstyle("text-wrap").strValue,h=yi(r.rscratch,"labelWrapCachedLines",t)||[],p=s!=="wrap"?1:Math.max(h.length,1),g=i.height/p,v=g*u,x=i.width,S=i.height+(p-1)*(u-1)*g;Mo(r.rstyle,"labelWidth",t,x),Mo(r.rscratch,"labelWidth",t,x),Mo(r.rstyle,"labelHeight",t,S),Mo(r.rscratch,"labelHeight",t,S),Mo(r.rscratch,"labelLineHeight",t,v)}};oo.getLabelText=function(e,t){var r=e._private,n=t?t+"-":"",a=e.pstyle(n+"label").strValue,i=e.pstyle("text-transform").value,u=function(Le,Oe){return Oe?(Mo(r.rscratch,Le,t,Oe),Oe):yi(r.rscratch,Le,t)};if(!a)return"";i=="none"||(i=="uppercase"?a=a.toUpperCase():i=="lowercase"&&(a=a.toLowerCase()));var s=e.pstyle("text-wrap").value;if(s==="wrap"){var h=u("labelKey");if(h!=null&&u("labelWrapKey")===h)return u("labelWrapCachedText");for(var p="",g=a.split(`
`),v=e.pstyle("text-max-width").pfValue,x=e.pstyle("text-overflow-wrap").value,S=x==="anywhere",P=[],N=/[\s\u200b]+|$/g,M=0;M<g.length;M++){var I=g[M],A=this.calculateLabelDimensions(e,I),D=A.width;if(S){var j=I.split("").join(p);I=j}if(D>v){var V=I.matchAll(N),U="",$=0,W=wi(V),X;try{for(W.s();!(X=W.n()).done;){var J=X.value,Z=J[0],K=I.substring($,J.index);$=J.index+Z.length;var Y=U.length===0?K:U+K+Z,G=this.calculateLabelDimensions(e,Y),oe=G.width;oe<=v?U+=K+Z:(U&&P.push(U),U=K+Z)}}catch(xe){W.e(xe)}finally{W.f()}U.match(/^[\s\u200b]+$/)||P.push(U)}else P.push(I)}u("labelWrapCachedLines",P),a=u("labelWrapCachedText",P.join(`
`)),u("labelWrapKey",h)}else if(s==="ellipsis"){var ie=e.pstyle("text-max-width").pfValue,ce="",fe="",de=!1;if(this.calculateLabelDimensions(e,a).width<ie)return a;for(var be=0;be<a.length;be++){var ge=this.calculateLabelDimensions(e,ce+a[be]+fe).width;if(ge>ie)break;ce+=a[be],be===a.length-1&&(de=!0)}return de||(ce+=fe),ce}return a};oo.getLabelJustification=function(e){var t=e.pstyle("text-justification").strValue,r=e.pstyle("text-halign").strValue;if(t==="auto")if(e.isNode())switch(r){case"left":return"right";case"right":return"left";default:return"center"}else return"center";else return t};oo.calculateLabelDimensions=function(e,t){var r=this,n=r.cy.window(),a=n.document,i=0,u=e.pstyle("font-style").strValue,s=e.pstyle("font-size").pfValue,h=e.pstyle("font-family").strValue,p=e.pstyle("font-weight").strValue,g=this.labelCalcCanvas,v=this.labelCalcCanvasContext;if(!g){g=this.labelCalcCanvas=a.createElement("canvas"),v=this.labelCalcCanvasContext=g.getContext("2d");var x=g.style;x.position="absolute",x.left="-9999px",x.top="-9999px",x.zIndex="-1",x.visibility="hidden",x.pointerEvents="none"}v.font="".concat(u," ").concat(p," ").concat(s,"px ").concat(h);for(var S=0,P=0,N=t.split(`
`),M=0;M<N.length;M++){var I=N[M],A=v.measureText(I),D=Math.ceil(A.width),j=s;S=Math.max(D,S),P+=j}return S+=i,P+=i,{width:S,height:P}};oo.calculateLabelAngle=function(e,t){var r=e._private,n=r.rscratch,a=e.isEdge(),i=t?t+"-":"",u=e.pstyle(i+"text-rotation"),s=u.strValue;return s==="none"?0:a&&s==="autorotate"?n.labelAutoAngle:s==="autorotate"?0:u.pfValue};oo.calculateLabelAngles=function(e){var t=this,r=e.isEdge(),n=e._private,a=n.rscratch;a.labelAngle=t.calculateLabelAngle(e),r&&(a.sourceLabelAngle=t.calculateLabelAngle(e,"source"),a.targetLabelAngle=t.calculateLabelAngle(e,"target"))};var xR={},VI=28,UI=!1;xR.getNodeShape=function(e){var t=this,r=e.pstyle("shape").value;if(r==="cutrectangle"&&(e.width()<VI||e.height()<VI))return UI||(Jr("The `cutrectangle` node shape can not be used at small sizes so `rectangle` is used instead"),UI=!0),"rectangle";if(e.isParent())return r==="rectangle"||r==="roundrectangle"||r==="round-rectangle"||r==="cutrectangle"||r==="cut-rectangle"||r==="barrel"?r:"rectangle";if(r==="polygon"){var n=e.pstyle("shape-polygon-points").value;return t.nodeShapes.makePolygon(n).name}return r};var ix={};ix.registerCalculationListeners=function(){var e=this.cy,t=e.collection(),r=this,n=function(u){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(t.merge(u),s)for(var h=0;h<u.length;h++){var p=u[h],g=p._private,v=g.rstyle;v.clean=!1,v.cleanConnected=!1}};r.binder(e).on("bounds.* dirty.*",function(u){var s=u.target;n(s)}).on("style.* background.*",function(u){var s=u.target;n(s,!1)});var a=function(u){if(u){var s=r.onUpdateEleCalcsFns;t.cleanStyle();for(var h=0;h<t.length;h++){var p=t[h],g=p._private.rstyle;p.isNode()&&!g.cleanConnected&&(n(p.connectedEdges()),g.cleanConnected=!0)}if(s)for(var v=0;v<s.length;v++){var x=s[v];x(u,t)}r.recalculateRenderedStyle(t),t=e.collection()}};r.flushRenderedStyleQueue=function(){a(!0)},r.beforeRender(a,r.beforeRenderPriorities.eleCalcs)};ix.onUpdateEleCalcs=function(e){var t=this.onUpdateEleCalcsFns=this.onUpdateEleCalcsFns||[];t.push(e)};ix.recalculateRenderedStyle=function(e,t){var r=function(j){return j._private.rstyle.cleanConnected};if(e.length!==0){var n=[],a=[];if(!this.destroyed){t===void 0&&(t=!0);for(var i=0;i<e.length;i++){var u=e[i],s=u._private,h=s.rstyle;u.isEdge()&&(!r(u.source())||!r(u.target()))&&(h.clean=!1),u.isEdge()&&u.isBundledBezier()&&u.parallelEdges().some(function(D){return!D._private.rstyle.clean&&D.isBundledBezier()})&&(h.clean=!1),!(t&&h.clean||u.removed())&&u.pstyle("display").value!=="none"&&(s.group==="nodes"?a.push(u):n.push(u),h.clean=!0)}for(var p=0;p<a.length;p++){var g=a[p],v=g._private,x=v.rstyle,S=g.position();this.recalculateNodeLabelProjection(g),x.nodeX=S.x,x.nodeY=S.y,x.nodeW=g.pstyle("width").pfValue,x.nodeH=g.pstyle("height").pfValue}this.recalculateEdgeProjections(n);for(var P=0;P<n.length;P++){var N=n[P],M=N._private,I=M.rstyle,A=M.rscratch;I.srcX=A.arrowStartX,I.srcY=A.arrowStartY,I.tgtX=A.arrowEndX,I.tgtY=A.arrowEndY,I.midX=A.midX,I.midY=A.midY,I.labelAngle=A.labelAngle,I.sourceLabelAngle=A.sourceLabelAngle,I.targetLabelAngle=A.targetLabelAngle}}}};var sx={};sx.updateCachedGrabbedEles=function(){var e=this.cachedZSortedEles;if(e){e.drag=[],e.nondrag=[];for(var t=[],r=0;r<e.length;r++){var n=e[r],a=n._private.rscratch;n.grabbed()&&!n.isParent()?t.push(n):a.inDragLayer?e.drag.push(n):e.nondrag.push(n)}for(var r=0;r<t.length;r++){var n=t[r];e.drag.push(n)}}};sx.invalidateCachedZSortedEles=function(){this.cachedZSortedEles=null};sx.getCachedZSortedEles=function(e){if(e||!this.cachedZSortedEles){var t=this.cy.mutableElements().toArray();t.sort(eR),t.interactive=t.filter(function(r){return r.interactive()}),this.cachedZSortedEles=t,this.updateCachedGrabbedEles()}else t=this.cachedZSortedEles;return t};var bR={};[Mc,l0,Ga,Xm,sE,oo,xR,ix,sx].forEach(function(e){xr(bR,e)});var _R={};_R.getCachedImage=function(e,t,r){var n=this,a=n.imageCache=n.imageCache||{},i=a[e];if(i)return i.image.complete||i.image.addEventListener("load",r),i.image;i=a[e]=a[e]||{};var u=i.image=new Image;u.addEventListener("load",r),u.addEventListener("error",function(){u.error=!0});var s="data:",h=e.substring(0,s.length).toLowerCase()===s;return h||(t=t==="null"?null:t,u.crossOrigin=t),u.src=e,u};var qh={};qh.registerBinding=function(e,t,r,n){var a=Array.prototype.slice.apply(arguments,[1]);if(Array.isArray(e)){for(var i=[],u=0;u<e.length;u++){var s=e[u];if(s!==void 0){var h=this.binder(s);i.push(h.on.apply(h,a))}}return i}var h=this.binder(e);return h.on.apply(h,a)};qh.binder=function(e){var t=this,r=t.cy.window(),n=e===r||e===r.document||e===r.document.body||KF(e);if(t.supportsPassiveEvents==null){var a=!1;try{var i=Object.defineProperty({},"passive",{get:function(){return a=!0,!0}});r.addEventListener("test",null,i)}catch{}t.supportsPassiveEvents=a}var u=function(h,p,g){var v=Array.prototype.slice.call(arguments);return n&&t.supportsPassiveEvents&&(v[2]={capture:g??!1,passive:!1,once:!1}),t.bindings.push({target:e,args:v}),(e.addEventListener||e.on).apply(e,v),this};return{on:u,addEventListener:u,addListener:u,bind:u}};qh.nodeIsDraggable=function(e){return e&&e.isNode()&&!e.locked()&&e.grabbable()};qh.nodeIsGrabbable=function(e){return this.nodeIsDraggable(e)&&e.interactive()};qh.load=function(){var e=this,t=e.cy.window(),r=function(le){return le.selected()},n=function(le){var Be=le.getRootNode();if(Be&&Be.nodeType===11&&Be.host!==void 0)return Be},a=function(le,Be,qe,st){le==null&&(le=e.cy);for(var ut=0;ut<Be.length;ut++){var vt=Be[ut];le.emit({originalEvent:qe,type:vt,position:st})}},i=function(le){return le.shiftKey||le.metaKey||le.ctrlKey},u=function(le,Be){var qe=!0;if(e.cy.hasCompoundNodes()&&le&&le.pannable())for(var st=0;Be&&st<Be.length;st++){var le=Be[st];if(le.isNode()&&le.isParent()&&!le.pannable()){qe=!1;break}}else qe=!0;return qe},s=function(le){le[0]._private.grabbed=!0},h=function(le){le[0]._private.grabbed=!1},p=function(le){le[0]._private.rscratch.inDragLayer=!0},g=function(le){le[0]._private.rscratch.inDragLayer=!1},v=function(le){le[0]._private.rscratch.isGrabTarget=!0},x=function(le){le[0]._private.rscratch.isGrabTarget=!1},S=function(le,Be){var qe=Be.addToList,st=qe.has(le);!st&&le.grabbable()&&!le.locked()&&(qe.merge(le),s(le))},P=function(le,Be){if(le.cy().hasCompoundNodes()&&!(Be.inDragLayer==null&&Be.addToList==null)){var qe=le.descendants();Be.inDragLayer&&(qe.forEach(p),qe.connectedEdges().forEach(p)),Be.addToList&&S(qe,Be)}},N=function(le,Be){Be=Be||{};var qe=le.cy().hasCompoundNodes();Be.inDragLayer&&(le.forEach(p),le.neighborhood().stdFilter(function(st){return!qe||st.isEdge()}).forEach(p)),Be.addToList&&le.forEach(function(st){S(st,Be)}),P(le,Be),A(le,{inDragLayer:Be.inDragLayer}),e.updateCachedGrabbedEles()},M=N,I=function(le){le&&(e.getCachedZSortedEles().forEach(function(Be){h(Be),g(Be),x(Be)}),e.updateCachedGrabbedEles())},A=function(le,Be){if(!(Be.inDragLayer==null&&Be.addToList==null)&&le.cy().hasCompoundNodes()){var qe=le.ancestors().orphans();if(!qe.same(le)){var st=qe.descendants().spawnSelf().merge(qe).unmerge(le).unmerge(le.descendants()),ut=st.connectedEdges();Be.inDragLayer&&(ut.forEach(p),st.forEach(p)),Be.addToList&&st.forEach(function(vt){S(vt,Be)})}}},D=function(){document.activeElement!=null&&document.activeElement.blur!=null&&document.activeElement.blur()},j=typeof MutationObserver<"u",V=typeof ResizeObserver<"u";j?(e.removeObserver=new MutationObserver(function(dt){for(var le=0;le<dt.length;le++){var Be=dt[le],qe=Be.removedNodes;if(qe)for(var st=0;st<qe.length;st++){var ut=qe[st];if(ut===e.container){e.destroy();break}}}}),e.container.parentNode&&e.removeObserver.observe(e.container.parentNode,{childList:!0})):e.registerBinding(e.container,"DOMNodeRemoved",function(dt){e.destroy()});var U=Hm(function(){e.cy.resize()},100);j&&(e.styleObserver=new MutationObserver(U),e.styleObserver.observe(e.container,{attributes:!0})),e.registerBinding(t,"resize",U),V&&(e.resizeObserver=new ResizeObserver(U),e.resizeObserver.observe(e.container));var $=function(le,Be){for(;le!=null;)Be(le),le=le.parentNode},W=function(){e.invalidateContainerClientCoordsCache()};$(e.container,function(dt){e.registerBinding(dt,"transitionend",W),e.registerBinding(dt,"animationend",W),e.registerBinding(dt,"scroll",W)}),e.registerBinding(e.container,"contextmenu",function(dt){dt.preventDefault()});var X=function(){return e.selection[4]!==0},J=function(le){for(var Be=e.findContainerClientCoords(),qe=Be[0],st=Be[1],ut=Be[2],vt=Be[3],gt=le.touches?le.touches:[le],Ut=!1,Ot=0;Ot<gt.length;Ot++){var Kt=gt[Ot];if(qe<=Kt.clientX&&Kt.clientX<=qe+ut&&st<=Kt.clientY&&Kt.clientY<=st+vt){Ut=!0;break}}if(!Ut)return!1;for(var we=e.container,ne=le.target,re=ne.parentNode,pe=!1;re;){if(re===we){pe=!0;break}re=re.parentNode}return!!pe};e.registerBinding(e.container,"mousedown",function(le){if(J(le)&&!(e.hoverData.which===1&&le.which!==1)){le.preventDefault(),D(),e.hoverData.capture=!0,e.hoverData.which=le.which;var Be=e.cy,qe=[le.clientX,le.clientY],st=e.projectIntoViewport(qe[0],qe[1]),ut=e.selection,vt=e.findNearestElements(st[0],st[1],!0,!1),gt=vt[0],Ut=e.dragData.possibleDragElements;e.hoverData.mdownPos=st,e.hoverData.mdownGPos=qe;var Ot=function(_e){return{originalEvent:le,type:_e,position:{x:st[0],y:st[1]}}},Kt=function(){e.hoverData.tapholdCancelled=!1,clearTimeout(e.hoverData.tapholdTimeout),e.hoverData.tapholdTimeout=setTimeout(function(){if(!e.hoverData.tapholdCancelled){var _e=e.hoverData.down;_e?_e.emit(Ot("taphold")):Be.emit(Ot("taphold"))}},e.tapholdDuration)};if(le.which==3){e.hoverData.cxtStarted=!0;var we={originalEvent:le,type:"cxttapstart",position:{x:st[0],y:st[1]}};gt?(gt.activate(),gt.emit(we),e.hoverData.down=gt):Be.emit(we),e.hoverData.downTime=new Date().getTime(),e.hoverData.cxtDragged=!1}else if(le.which==1){gt&&gt.activate();{if(gt!=null&&e.nodeIsGrabbable(gt)){var ne=function(_e){_e.emit(Ot("grab"))};if(v(gt),!gt.selected())Ut=e.dragData.possibleDragElements=Be.collection(),M(gt,{addToList:Ut}),gt.emit(Ot("grabon")).emit(Ot("grab"));else{Ut=e.dragData.possibleDragElements=Be.collection();var re=Be.$(function(pe){return pe.isNode()&&pe.selected()&&e.nodeIsGrabbable(pe)});N(re,{addToList:Ut}),gt.emit(Ot("grabon")),re.forEach(ne)}e.redrawHint("eles",!0),e.redrawHint("drag",!0)}e.hoverData.down=gt,e.hoverData.downs=vt,e.hoverData.downTime=new Date().getTime()}a(gt,["mousedown","tapstart","vmousedown"],le,{x:st[0],y:st[1]}),gt==null?(ut[4]=1,e.data.bgActivePosistion={x:st[0],y:st[1]},e.redrawHint("select",!0),e.redraw()):gt.pannable()&&(ut[4]=1),Kt()}ut[0]=ut[2]=st[0],ut[1]=ut[3]=st[1]}},!1);var Z=n(e.container);e.registerBinding([t,Z],"mousemove",function(le){var Be=e.hoverData.capture;if(!(!Be&&!J(le))){var qe=!1,st=e.cy,ut=st.zoom(),vt=[le.clientX,le.clientY],gt=e.projectIntoViewport(vt[0],vt[1]),Ut=e.hoverData.mdownPos,Ot=e.hoverData.mdownGPos,Kt=e.selection,we=null;!e.hoverData.draggingEles&&!e.hoverData.dragging&&!e.hoverData.selecting&&(we=e.findNearestElement(gt[0],gt[1],!0,!1));var ne=e.hoverData.last,re=e.hoverData.down,pe=[gt[0]-Kt[2],gt[1]-Kt[3]],_e=e.dragData.possibleDragElements,Ne;if(Ot){var De=vt[0]-Ot[0],Ue=De*De,Te=vt[1]-Ot[1],rt=Te*Te,ht=Ue+rt;e.hoverData.isOverThresholdDrag=Ne=ht>=e.desktopTapThreshold2}var Qe=i(le);Ne&&(e.hoverData.tapholdCancelled=!0);var wt=function(){var Er=e.hoverData.dragDelta=e.hoverData.dragDelta||[];Er.length===0?(Er.push(pe[0]),Er.push(pe[1])):(Er[0]+=pe[0],Er[1]+=pe[1])};qe=!0,a(we,["mousemove","vmousemove","tapdrag"],le,{x:gt[0],y:gt[1]});var At=function(Er){return{originalEvent:le,type:Er,position:{x:gt[0],y:gt[1]}}},Ft=function(){e.data.bgActivePosistion=void 0,e.hoverData.selecting||st.emit(At("boxstart")),Kt[4]=1,e.hoverData.selecting=!0,e.redrawHint("select",!0),e.redraw()};if(e.hoverData.which===3){if(Ne){var yr=At("cxtdrag");re?re.emit(yr):st.emit(yr),e.hoverData.cxtDragged=!0,(!e.hoverData.cxtOver||we!==e.hoverData.cxtOver)&&(e.hoverData.cxtOver&&e.hoverData.cxtOver.emit(At("cxtdragout")),e.hoverData.cxtOver=we,we&&we.emit(At("cxtdragover")))}}else if(e.hoverData.dragging){if(qe=!0,st.panningEnabled()&&st.userPanningEnabled()){var ir;if(e.hoverData.justStartedPan){var _r=e.hoverData.mdownPos;ir={x:(gt[0]-_r[0])*ut,y:(gt[1]-_r[1])*ut},e.hoverData.justStartedPan=!1}else ir={x:pe[0]*ut,y:pe[1]*ut};st.panBy(ir),st.emit(At("dragpan")),e.hoverData.dragged=!0}gt=e.projectIntoViewport(le.clientX,le.clientY)}else if(Kt[4]==1&&(re==null||re.pannable())){if(Ne){if(!e.hoverData.dragging&&st.boxSelectionEnabled()&&(Qe||!st.panningEnabled()||!st.userPanningEnabled()))Ft();else if(!e.hoverData.selecting&&st.panningEnabled()&&st.userPanningEnabled()){var pr=u(re,e.hoverData.downs);pr&&(e.hoverData.dragging=!0,e.hoverData.justStartedPan=!0,Kt[4]=0,e.data.bgActivePosistion=rh(Ut),e.redrawHint("select",!0),e.redraw())}re&&re.pannable()&&re.active()&&re.unactivate()}}else{if(re&&re.pannable()&&re.active()&&re.unactivate(),(!re||!re.grabbed())&&we!=ne&&(ne&&a(ne,["mouseout","tapdragout"],le,{x:gt[0],y:gt[1]}),we&&a(we,["mouseover","tapdragover"],le,{x:gt[0],y:gt[1]}),e.hoverData.last=we),re)if(Ne){if(st.boxSelectionEnabled()&&Qe)re&&re.grabbed()&&(I(_e),re.emit(At("freeon")),_e.emit(At("free")),e.dragData.didDrag&&(re.emit(At("dragfreeon")),_e.emit(At("dragfree")))),Ft();else if(re&&re.grabbed()&&e.nodeIsDraggable(re)){var Tr=!e.dragData.didDrag;Tr&&e.redrawHint("eles",!0),e.dragData.didDrag=!0,e.hoverData.draggingEles||N(_e,{inDragLayer:!0});var wr={x:0,y:0};if(Ht(pe[0])&&Ht(pe[1])&&(wr.x+=pe[0],wr.y+=pe[1],Tr)){var sr=e.hoverData.dragDelta;sr&&Ht(sr[0])&&Ht(sr[1])&&(wr.x+=sr[0],wr.y+=sr[1])}e.hoverData.draggingEles=!0,_e.silentShift(wr).emit(At("position")).emit(At("drag")),e.redrawHint("drag",!0),e.redraw()}}else wt();qe=!0}if(Kt[2]=gt[0],Kt[3]=gt[1],qe)return le.stopPropagation&&le.stopPropagation(),le.preventDefault&&le.preventDefault(),!1}},!1);var K,Y,G;e.registerBinding(t,"mouseup",function(le){if(!(e.hoverData.which===1&&le.which!==1&&e.hoverData.capture)){var Be=e.hoverData.capture;if(Be){e.hoverData.capture=!1;var qe=e.cy,st=e.projectIntoViewport(le.clientX,le.clientY),ut=e.selection,vt=e.findNearestElement(st[0],st[1],!0,!1),gt=e.dragData.possibleDragElements,Ut=e.hoverData.down,Ot=i(le);e.data.bgActivePosistion&&(e.redrawHint("select",!0),e.redraw()),e.hoverData.tapholdCancelled=!0,e.data.bgActivePosistion=void 0,Ut&&Ut.unactivate();var Kt=function(De){return{originalEvent:le,type:De,position:{x:st[0],y:st[1]}}};if(e.hoverData.which===3){var we=Kt("cxttapend");if(Ut?Ut.emit(we):qe.emit(we),!e.hoverData.cxtDragged){var ne=Kt("cxttap");Ut?Ut.emit(ne):qe.emit(ne)}e.hoverData.cxtDragged=!1,e.hoverData.which=null}else if(e.hoverData.which===1){if(a(vt,["mouseup","tapend","vmouseup"],le,{x:st[0],y:st[1]}),!e.dragData.didDrag&&!e.hoverData.dragged&&!e.hoverData.selecting&&!e.hoverData.isOverThresholdDrag&&(a(Ut,["click","tap","vclick"],le,{x:st[0],y:st[1]}),Y=!1,le.timeStamp-G<=qe.multiClickDebounceTime()?(K&&clearTimeout(K),Y=!0,G=null,a(Ut,["dblclick","dbltap","vdblclick"],le,{x:st[0],y:st[1]})):(K=setTimeout(function(){Y||a(Ut,["oneclick","onetap","voneclick"],le,{x:st[0],y:st[1]})},qe.multiClickDebounceTime()),G=le.timeStamp)),Ut==null&&!e.dragData.didDrag&&!e.hoverData.selecting&&!e.hoverData.dragged&&!i(le)&&(qe.$(r).unselect(["tapunselect"]),gt.length>0&&e.redrawHint("eles",!0),e.dragData.possibleDragElements=gt=qe.collection()),vt==Ut&&!e.dragData.didDrag&&!e.hoverData.selecting&&vt!=null&&vt._private.selectable&&(e.hoverData.dragging||(qe.selectionType()==="additive"||Ot?vt.selected()?vt.unselect(["tapunselect"]):vt.select(["tapselect"]):Ot||(qe.$(r).unmerge(vt).unselect(["tapunselect"]),vt.select(["tapselect"]))),e.redrawHint("eles",!0)),e.hoverData.selecting){var re=qe.collection(e.getAllInBox(ut[0],ut[1],ut[2],ut[3]));e.redrawHint("select",!0),re.length>0&&e.redrawHint("eles",!0),qe.emit(Kt("boxend"));var pe=function(De){return De.selectable()&&!De.selected()};qe.selectionType()==="additive"||Ot||qe.$(r).unmerge(re).unselect(),re.emit(Kt("box")).stdFilter(pe).select().emit(Kt("boxselect")),e.redraw()}if(e.hoverData.dragging&&(e.hoverData.dragging=!1,e.redrawHint("select",!0),e.redrawHint("eles",!0),e.redraw()),!ut[4]){e.redrawHint("drag",!0),e.redrawHint("eles",!0);var _e=Ut&&Ut.grabbed();I(gt),_e&&(Ut.emit(Kt("freeon")),gt.emit(Kt("free")),e.dragData.didDrag&&(Ut.emit(Kt("dragfreeon")),gt.emit(Kt("dragfree"))))}}ut[4]=0,e.hoverData.down=null,e.hoverData.cxtStarted=!1,e.hoverData.draggingEles=!1,e.hoverData.selecting=!1,e.hoverData.isOverThresholdDrag=!1,e.dragData.didDrag=!1,e.hoverData.dragged=!1,e.hoverData.dragDelta=[],e.hoverData.mdownPos=null,e.hoverData.mdownGPos=null,e.hoverData.which=null}}},!1);var oe=[],ie=4,ce,fe=1e5,de=function(le,Be){for(var qe=0;qe<le.length;qe++)if(le[qe]%Be!==0)return!1;return!0},be=function(le){for(var Be=Math.abs(le[0]),qe=1;qe<le.length;qe++)if(Math.abs(le[qe])!==Be)return!1;return!0},ge=function(le){var Be=!1,qe=le.deltaY;if(qe==null&&(le.wheelDeltaY!=null?qe=le.wheelDeltaY/4:le.wheelDelta!=null&&(qe=le.wheelDelta/4)),qe!==0){if(ce==null)if(oe.length>=ie){var st=oe;if(ce=de(st,5),!ce){var ut=Math.abs(st[0]);ce=be(st)&&ut>5}if(ce)for(var vt=0;vt<st.length;vt++)fe=Math.min(Math.abs(st[vt]),fe)}else oe.push(qe),Be=!0;else ce&&(fe=Math.min(Math.abs(qe),fe));if(!e.scrollingPage){var gt=e.cy,Ut=gt.zoom(),Ot=gt.pan(),Kt=e.projectIntoViewport(le.clientX,le.clientY),we=[Kt[0]*Ut+Ot.x,Kt[1]*Ut+Ot.y];if(e.hoverData.draggingEles||e.hoverData.dragging||e.hoverData.cxtStarted||X()){le.preventDefault();return}if(gt.panningEnabled()&&gt.userPanningEnabled()&&gt.zoomingEnabled()&&gt.userZoomingEnabled()){le.preventDefault(),e.data.wheelZooming=!0,clearTimeout(e.data.wheelTimeout),e.data.wheelTimeout=setTimeout(function(){e.data.wheelZooming=!1,e.redrawHint("eles",!0),e.redraw()},150);var ne;Be&&Math.abs(qe)>5&&(qe=GS(qe)*5),ne=qe/-250,ce&&(ne/=fe,ne*=3),ne=ne*e.wheelSensitivity;var re=le.deltaMode===1;re&&(ne*=33);var pe=gt.zoom()*Math.pow(10,ne);le.type==="gesturechange"&&(pe=e.gestureStartZoom*le.scale),gt.zoom({level:pe,renderedPosition:{x:we[0],y:we[1]}}),gt.emit({type:le.type==="gesturechange"?"pinchzoom":"scrollzoom",originalEvent:le,position:{x:Kt[0],y:Kt[1]}})}}}};e.registerBinding(e.container,"wheel",ge,!0),e.registerBinding(t,"scroll",function(le){e.scrollingPage=!0,clearTimeout(e.scrollingPageTimeout),e.scrollingPageTimeout=setTimeout(function(){e.scrollingPage=!1},250)},!0),e.registerBinding(e.container,"gesturestart",function(le){e.gestureStartZoom=e.cy.zoom(),e.hasTouchStarted||le.preventDefault()},!0),e.registerBinding(e.container,"gesturechange",function(dt){e.hasTouchStarted||ge(dt)},!0),e.registerBinding(e.container,"mouseout",function(le){var Be=e.projectIntoViewport(le.clientX,le.clientY);e.cy.emit({originalEvent:le,type:"mouseout",position:{x:Be[0],y:Be[1]}})},!1),e.registerBinding(e.container,"mouseover",function(le){var Be=e.projectIntoViewport(le.clientX,le.clientY);e.cy.emit({originalEvent:le,type:"mouseover",position:{x:Be[0],y:Be[1]}})},!1);var xe,Le,Oe,Fe,et,nt,mt,it,ze,He,We,ot,xt,Tt=function(le,Be,qe,st){return Math.sqrt((qe-le)*(qe-le)+(st-Be)*(st-Be))},$e=function(le,Be,qe,st){return(qe-le)*(qe-le)+(st-Be)*(st-Be)},Xe;e.registerBinding(e.container,"touchstart",Xe=function(le){if(e.hasTouchStarted=!0,!!J(le)){D(),e.touchData.capture=!0,e.data.bgActivePosistion=void 0;var Be=e.cy,qe=e.touchData.now,st=e.touchData.earlier;if(le.touches[0]){var ut=e.projectIntoViewport(le.touches[0].clientX,le.touches[0].clientY);qe[0]=ut[0],qe[1]=ut[1]}if(le.touches[1]){var ut=e.projectIntoViewport(le.touches[1].clientX,le.touches[1].clientY);qe[2]=ut[0],qe[3]=ut[1]}if(le.touches[2]){var ut=e.projectIntoViewport(le.touches[2].clientX,le.touches[2].clientY);qe[4]=ut[0],qe[5]=ut[1]}var vt=function(Qe){return{originalEvent:le,type:Qe,position:{x:qe[0],y:qe[1]}}};if(le.touches[1]){e.touchData.singleTouchMoved=!0,I(e.dragData.touchDragEles);var gt=e.findContainerClientCoords();ze=gt[0],He=gt[1],We=gt[2],ot=gt[3],xe=le.touches[0].clientX-ze,Le=le.touches[0].clientY-He,Oe=le.touches[1].clientX-ze,Fe=le.touches[1].clientY-He,xt=0<=xe&&xe<=We&&0<=Oe&&Oe<=We&&0<=Le&&Le<=ot&&0<=Fe&&Fe<=ot;var Ut=Be.pan(),Ot=Be.zoom();et=Tt(xe,Le,Oe,Fe),nt=$e(xe,Le,Oe,Fe),mt=[(xe+Oe)/2,(Le+Fe)/2],it=[(mt[0]-Ut.x)/Ot,(mt[1]-Ut.y)/Ot];var Kt=200,we=Kt*Kt;if(nt<we&&!le.touches[2]){var ne=e.findNearestElement(qe[0],qe[1],!0,!0),re=e.findNearestElement(qe[2],qe[3],!0,!0);ne&&ne.isNode()?(ne.activate().emit(vt("cxttapstart")),e.touchData.start=ne):re&&re.isNode()?(re.activate().emit(vt("cxttapstart")),e.touchData.start=re):Be.emit(vt("cxttapstart")),e.touchData.start&&(e.touchData.start._private.grabbed=!1),e.touchData.cxt=!0,e.touchData.cxtDragged=!1,e.data.bgActivePosistion=void 0,e.redraw();return}}if(le.touches[2])Be.boxSelectionEnabled()&&le.preventDefault();else if(!le.touches[1]){if(le.touches[0]){var pe=e.findNearestElements(qe[0],qe[1],!0,!0),_e=pe[0];if(_e!=null&&(_e.activate(),e.touchData.start=_e,e.touchData.starts=pe,e.nodeIsGrabbable(_e))){var Ne=e.dragData.touchDragEles=Be.collection(),De=null;e.redrawHint("eles",!0),e.redrawHint("drag",!0),_e.selected()?(De=Be.$(function(ht){return ht.selected()&&e.nodeIsGrabbable(ht)}),N(De,{addToList:Ne})):M(_e,{addToList:Ne}),v(_e),_e.emit(vt("grabon")),De?De.forEach(function(ht){ht.emit(vt("grab"))}):_e.emit(vt("grab"))}a(_e,["touchstart","tapstart","vmousedown"],le,{x:qe[0],y:qe[1]}),_e==null&&(e.data.bgActivePosistion={x:ut[0],y:ut[1]},e.redrawHint("select",!0),e.redraw()),e.touchData.singleTouchMoved=!1,e.touchData.singleTouchStartTime=+new Date,clearTimeout(e.touchData.tapholdTimeout),e.touchData.tapholdTimeout=setTimeout(function(){e.touchData.singleTouchMoved===!1&&!e.pinching&&!e.touchData.selecting&&a(e.touchData.start,["taphold"],le,{x:qe[0],y:qe[1]})},e.tapholdDuration)}}if(le.touches.length>=1){for(var Ue=e.touchData.startPosition=[null,null,null,null,null,null],Te=0;Te<qe.length;Te++)Ue[Te]=st[Te]=qe[Te];var rt=le.touches[0];e.touchData.startGPosition=[rt.clientX,rt.clientY]}}},!1);var Pe;e.registerBinding(t,"touchmove",Pe=function(le){var Be=e.touchData.capture;if(!(!Be&&!J(le))){var qe=e.selection,st=e.cy,ut=e.touchData.now,vt=e.touchData.earlier,gt=st.zoom();if(le.touches[0]){var Ut=e.projectIntoViewport(le.touches[0].clientX,le.touches[0].clientY);ut[0]=Ut[0],ut[1]=Ut[1]}if(le.touches[1]){var Ut=e.projectIntoViewport(le.touches[1].clientX,le.touches[1].clientY);ut[2]=Ut[0],ut[3]=Ut[1]}if(le.touches[2]){var Ut=e.projectIntoViewport(le.touches[2].clientX,le.touches[2].clientY);ut[4]=Ut[0],ut[5]=Ut[1]}var Ot=function(Za){return{originalEvent:le,type:Za,position:{x:ut[0],y:ut[1]}}},Kt=e.touchData.startGPosition,we;if(Be&&le.touches[0]&&Kt){for(var ne=[],re=0;re<ut.length;re++)ne[re]=ut[re]-vt[re];var pe=le.touches[0].clientX-Kt[0],_e=pe*pe,Ne=le.touches[0].clientY-Kt[1],De=Ne*Ne,Ue=_e+De;we=Ue>=e.touchTapThreshold2}if(Be&&e.touchData.cxt){le.preventDefault();var Te=le.touches[0].clientX-ze,rt=le.touches[0].clientY-He,ht=le.touches[1].clientX-ze,Qe=le.touches[1].clientY-He,wt=$e(Te,rt,ht,Qe),At=wt/nt,Ft=150,yr=Ft*Ft,ir=1.5,_r=ir*ir;if(At>=_r||wt>=yr){e.touchData.cxt=!1,e.data.bgActivePosistion=void 0,e.redrawHint("select",!0);var pr=Ot("cxttapend");e.touchData.start?(e.touchData.start.unactivate().emit(pr),e.touchData.start=null):st.emit(pr)}}if(Be&&e.touchData.cxt){var pr=Ot("cxtdrag");e.data.bgActivePosistion=void 0,e.redrawHint("select",!0),e.touchData.start?e.touchData.start.emit(pr):st.emit(pr),e.touchData.start&&(e.touchData.start._private.grabbed=!1),e.touchData.cxtDragged=!0;var Tr=e.findNearestElement(ut[0],ut[1],!0,!0);(!e.touchData.cxtOver||Tr!==e.touchData.cxtOver)&&(e.touchData.cxtOver&&e.touchData.cxtOver.emit(Ot("cxtdragout")),e.touchData.cxtOver=Tr,Tr&&Tr.emit(Ot("cxtdragover")))}else if(Be&&le.touches[2]&&st.boxSelectionEnabled())le.preventDefault(),e.data.bgActivePosistion=void 0,this.lastThreeTouch=+new Date,e.touchData.selecting||st.emit(Ot("boxstart")),e.touchData.selecting=!0,e.touchData.didSelect=!0,qe[4]=1,!qe||qe.length===0||qe[0]===void 0?(qe[0]=(ut[0]+ut[2]+ut[4])/3,qe[1]=(ut[1]+ut[3]+ut[5])/3,qe[2]=(ut[0]+ut[2]+ut[4])/3+1,qe[3]=(ut[1]+ut[3]+ut[5])/3+1):(qe[2]=(ut[0]+ut[2]+ut[4])/3,qe[3]=(ut[1]+ut[3]+ut[5])/3),e.redrawHint("select",!0),e.redraw();else if(Be&&le.touches[1]&&!e.touchData.didSelect&&st.zoomingEnabled()&&st.panningEnabled()&&st.userZoomingEnabled()&&st.userPanningEnabled()){le.preventDefault(),e.data.bgActivePosistion=void 0,e.redrawHint("select",!0);var wr=e.dragData.touchDragEles;if(wr){e.redrawHint("drag",!0);for(var sr=0;sr<wr.length;sr++){var kr=wr[sr]._private;kr.grabbed=!1,kr.rscratch.inDragLayer=!1}}var Er=e.touchData.start,Te=le.touches[0].clientX-ze,rt=le.touches[0].clientY-He,ht=le.touches[1].clientX-ze,Qe=le.touches[1].clientY-He,cn=Tt(Te,rt,ht,Qe),gn=cn/et;if(xt){var wn=Te-xe,oi=rt-Le,Mr=ht-Oe,Gi=Qe-Fe,Wi=(wn+Mr)/2,lt=(oi+Gi)/2,or=st.zoom(),Fr=or*gn,Gr=st.pan(),vn=it[0]*or+Gr.x,Zn=it[1]*or+Gr.y,Fn={x:-Fr/or*(vn-Gr.x-Wi)+vn,y:-Fr/or*(Zn-Gr.y-lt)+Zn};if(Er&&Er.active()){var wr=e.dragData.touchDragEles;I(wr),e.redrawHint("drag",!0),e.redrawHint("eles",!0),Er.unactivate().emit(Ot("freeon")),wr.emit(Ot("free")),e.dragData.didDrag&&(Er.emit(Ot("dragfreeon")),wr.emit(Ot("dragfree")))}st.viewport({zoom:Fr,pan:Fn,cancelOnFailedZoom:!0}),st.emit(Ot("pinchzoom")),et=cn,xe=Te,Le=rt,Oe=ht,Fe=Qe,e.pinching=!0}if(le.touches[0]){var Ut=e.projectIntoViewport(le.touches[0].clientX,le.touches[0].clientY);ut[0]=Ut[0],ut[1]=Ut[1]}if(le.touches[1]){var Ut=e.projectIntoViewport(le.touches[1].clientX,le.touches[1].clientY);ut[2]=Ut[0],ut[3]=Ut[1]}if(le.touches[2]){var Ut=e.projectIntoViewport(le.touches[2].clientX,le.touches[2].clientY);ut[4]=Ut[0],ut[5]=Ut[1]}}else if(le.touches[0]&&!e.touchData.didSelect){var jr=e.touchData.start,ps=e.touchData.last,Tr;if(!e.hoverData.draggingEles&&!e.swipePanning&&(Tr=e.findNearestElement(ut[0],ut[1],!0,!0)),Be&&jr!=null&&le.preventDefault(),Be&&jr!=null&&e.nodeIsDraggable(jr))if(we){var wr=e.dragData.touchDragEles,Na=!e.dragData.didDrag;Na&&N(wr,{inDragLayer:!0}),e.dragData.didDrag=!0;var Qr={x:0,y:0};if(Ht(ne[0])&&Ht(ne[1])&&(Qr.x+=ne[0],Qr.y+=ne[1],Na)){e.redrawHint("eles",!0);var aa=e.touchData.dragDelta;aa&&Ht(aa[0])&&Ht(aa[1])&&(Qr.x+=aa[0],Qr.y+=aa[1])}e.hoverData.draggingEles=!0,wr.silentShift(Qr).emit(Ot("position")).emit(Ot("drag")),e.redrawHint("drag",!0),e.touchData.startPosition[0]==vt[0]&&e.touchData.startPosition[1]==vt[1]&&e.redrawHint("eles",!0),e.redraw()}else{var aa=e.touchData.dragDelta=e.touchData.dragDelta||[];aa.length===0?(aa.push(ne[0]),aa.push(ne[1])):(aa[0]+=ne[0],aa[1]+=ne[1])}if(a(jr||Tr,["touchmove","tapdrag","vmousemove"],le,{x:ut[0],y:ut[1]}),(!jr||!jr.grabbed())&&Tr!=ps&&(ps&&ps.emit(Ot("tapdragout")),Tr&&Tr.emit(Ot("tapdragover"))),e.touchData.last=Tr,Be)for(var sr=0;sr<ut.length;sr++)ut[sr]&&e.touchData.startPosition[sr]&&we&&(e.touchData.singleTouchMoved=!0);if(Be&&(jr==null||jr.pannable())&&st.panningEnabled()&&st.userPanningEnabled()){var Wa=u(jr,e.touchData.starts);Wa&&(le.preventDefault(),e.data.bgActivePosistion||(e.data.bgActivePosistion=rh(e.touchData.startPosition)),e.swipePanning?(st.panBy({x:ne[0]*gt,y:ne[1]*gt}),st.emit(Ot("dragpan"))):we&&(e.swipePanning=!0,st.panBy({x:pe*gt,y:Ne*gt}),st.emit(Ot("dragpan")),jr&&(jr.unactivate(),e.redrawHint("select",!0),e.touchData.start=null)));var Ut=e.projectIntoViewport(le.touches[0].clientX,le.touches[0].clientY);ut[0]=Ut[0],ut[1]=Ut[1]}}for(var re=0;re<ut.length;re++)vt[re]=ut[re];Be&&le.touches.length>0&&!e.hoverData.draggingEles&&!e.swipePanning&&e.data.bgActivePosistion!=null&&(e.data.bgActivePosistion=void 0,e.redrawHint("select",!0),e.redraw())}},!1);var Ye;e.registerBinding(t,"touchcancel",Ye=function(le){var Be=e.touchData.start;e.touchData.capture=!1,Be&&Be.unactivate()});var at,bt,Et,Vt;if(e.registerBinding(t,"touchend",at=function(le){var Be=e.touchData.start,qe=e.touchData.capture;if(qe)le.touches.length===0&&(e.touchData.capture=!1),le.preventDefault();else return;var st=e.selection;e.swipePanning=!1,e.hoverData.draggingEles=!1;var ut=e.cy,vt=ut.zoom(),gt=e.touchData.now,Ut=e.touchData.earlier;if(le.touches[0]){var Ot=e.projectIntoViewport(le.touches[0].clientX,le.touches[0].clientY);gt[0]=Ot[0],gt[1]=Ot[1]}if(le.touches[1]){var Ot=e.projectIntoViewport(le.touches[1].clientX,le.touches[1].clientY);gt[2]=Ot[0],gt[3]=Ot[1]}if(le.touches[2]){var Ot=e.projectIntoViewport(le.touches[2].clientX,le.touches[2].clientY);gt[4]=Ot[0],gt[5]=Ot[1]}var Kt=function(yr){return{originalEvent:le,type:yr,position:{x:gt[0],y:gt[1]}}};Be&&Be.unactivate();var we;if(e.touchData.cxt){if(we=Kt("cxttapend"),Be?Be.emit(we):ut.emit(we),!e.touchData.cxtDragged){var ne=Kt("cxttap");Be?Be.emit(ne):ut.emit(ne)}e.touchData.start&&(e.touchData.start._private.grabbed=!1),e.touchData.cxt=!1,e.touchData.start=null,e.redraw();return}if(!le.touches[2]&&ut.boxSelectionEnabled()&&e.touchData.selecting){e.touchData.selecting=!1;var re=ut.collection(e.getAllInBox(st[0],st[1],st[2],st[3]));st[0]=void 0,st[1]=void 0,st[2]=void 0,st[3]=void 0,st[4]=0,e.redrawHint("select",!0),ut.emit(Kt("boxend"));var pe=function(yr){return yr.selectable()&&!yr.selected()};re.emit(Kt("box")).stdFilter(pe).select().emit(Kt("boxselect")),re.nonempty()&&e.redrawHint("eles",!0),e.redraw()}if(Be!=null&&Be.unactivate(),le.touches[2])e.data.bgActivePosistion=void 0,e.redrawHint("select",!0);else if(!le.touches[1]){if(!le.touches[0]){if(!le.touches[0]){e.data.bgActivePosistion=void 0,e.redrawHint("select",!0);var _e=e.dragData.touchDragEles;if(Be!=null){var Ne=Be._private.grabbed;I(_e),e.redrawHint("drag",!0),e.redrawHint("eles",!0),Ne&&(Be.emit(Kt("freeon")),_e.emit(Kt("free")),e.dragData.didDrag&&(Be.emit(Kt("dragfreeon")),_e.emit(Kt("dragfree")))),a(Be,["touchend","tapend","vmouseup","tapdragout"],le,{x:gt[0],y:gt[1]}),Be.unactivate(),e.touchData.start=null}else{var De=e.findNearestElement(gt[0],gt[1],!0,!0);a(De,["touchend","tapend","vmouseup","tapdragout"],le,{x:gt[0],y:gt[1]})}var Ue=e.touchData.startPosition[0]-gt[0],Te=Ue*Ue,rt=e.touchData.startPosition[1]-gt[1],ht=rt*rt,Qe=Te+ht,wt=Qe*vt*vt;e.touchData.singleTouchMoved||(Be||ut.$(":selected").unselect(["tapunselect"]),a(Be,["tap","vclick"],le,{x:gt[0],y:gt[1]}),bt=!1,le.timeStamp-Vt<=ut.multiClickDebounceTime()?(Et&&clearTimeout(Et),bt=!0,Vt=null,a(Be,["dbltap","vdblclick"],le,{x:gt[0],y:gt[1]})):(Et=setTimeout(function(){bt||a(Be,["onetap","voneclick"],le,{x:gt[0],y:gt[1]})},ut.multiClickDebounceTime()),Vt=le.timeStamp)),Be!=null&&!e.dragData.didDrag&&Be._private.selectable&&wt<e.touchTapThreshold2&&!e.pinching&&(ut.selectionType()==="single"?(ut.$(r).unmerge(Be).unselect(["tapunselect"]),Be.select(["tapselect"])):Be.selected()?Be.unselect(["tapunselect"]):Be.select(["tapselect"]),e.redrawHint("eles",!0)),e.touchData.singleTouchMoved=!0}}}for(var At=0;At<gt.length;At++)Ut[At]=gt[At];e.dragData.didDrag=!1,le.touches.length===0&&(e.touchData.dragDelta=[],e.touchData.startPosition=[null,null,null,null,null,null],e.touchData.startGPosition=null,e.touchData.didSelect=!1),le.touches.length<2&&(le.touches.length===1&&(e.touchData.startGPosition=[le.touches[0].clientX,le.touches[0].clientY]),e.pinching=!1,e.redrawHint("eles",!0),e.redraw())},!1),typeof TouchEvent>"u"){var Bt=[],Mt=function(le){return{clientX:le.clientX,clientY:le.clientY,force:1,identifier:le.pointerId,pageX:le.pageX,pageY:le.pageY,radiusX:le.width/2,radiusY:le.height/2,screenX:le.screenX,screenY:le.screenY,target:le.target}},cr=function(le){return{event:le,touch:Mt(le)}},ar=function(le){Bt.push(cr(le))},ft=function(le){for(var Be=0;Be<Bt.length;Be++){var qe=Bt[Be];if(qe.event.pointerId===le.pointerId){Bt.splice(Be,1);return}}},fr=function(le){var Be=Bt.filter(function(qe){return qe.event.pointerId===le.pointerId})[0];Be.event=le,Be.touch=Mt(le)},Xt=function(le){le.touches=Bt.map(function(Be){return Be.touch})},kt=function(le){return le.pointerType==="mouse"||le.pointerType===4};e.registerBinding(e.container,"pointerdown",function(dt){kt(dt)||(dt.preventDefault(),ar(dt),Xt(dt),Xe(dt))}),e.registerBinding(e.container,"pointerup",function(dt){kt(dt)||(ft(dt),Xt(dt),at(dt))}),e.registerBinding(e.container,"pointercancel",function(dt){kt(dt)||(ft(dt),Xt(dt),Ye(dt))}),e.registerBinding(e.container,"pointermove",function(dt){kt(dt)||(dt.preventDefault(),fr(dt),Xt(dt),Pe(dt))})}};var Zo={};Zo.generatePolygon=function(e,t){return this.nodeShapes[e]={renderer:this,name:e,points:t,draw:function(n,a,i,u,s,h){this.renderer.nodeShapeImpl("polygon",n,a,i,u,s,this.points)},intersectLine:function(n,a,i,u,s,h,p,g){return mm(s,h,this.points,n,a,i/2,u/2,p)},checkPoint:function(n,a,i,u,s,h,p,g){return qo(n,a,this.points,h,p,u,s,[0,-1],i)},hasMiterBounds:e!=="rectangle",miterBounds:function(n,a,i,u,s,h){return h$(this.points,n,a,i,u,s)}}};Zo.generateEllipse=function(){return this.nodeShapes.ellipse={renderer:this,name:"ellipse",draw:function(t,r,n,a,i,u){this.renderer.nodeShapeImpl(this.name,t,r,n,a,i)},intersectLine:function(t,r,n,a,i,u,s,h){return b$(i,u,t,r,n/2+s,a/2+s)},checkPoint:function(t,r,n,a,i,u,s,h){return oc(t,r,a,i,u,s,n)}}};Zo.generateRoundPolygon=function(e,t){return this.nodeShapes[e]={renderer:this,name:e,points:t,getOrCreateCorners:function(n,a,i,u,s,h,p){if(h[p]!==void 0&&h[p+"-cx"]===n&&h[p+"-cy"]===a)return h[p];h[p]=new Array(t.length/2),h[p+"-cx"]=n,h[p+"-cy"]=a;var g=i/2,v=u/2;s=s==="auto"?wz(i,u):s;for(var x=new Array(t.length/2),S=0;S<t.length/2;S++)x[S]={x:n+g*t[S*2],y:a+v*t[S*2+1]};var P,N,M,I,A=x.length;for(N=x[A-1],P=0;P<A;P++)M=x[P%A],I=x[(P+1)%A],h[p][P]=iE(N,M,I,s),N=M,M=I;return h[p]},draw:function(n,a,i,u,s,h,p){this.renderer.nodeShapeImpl("round-polygon",n,a,i,u,s,this.points,this.getOrCreateCorners(a,i,u,s,h,p,"drawCorners"))},intersectLine:function(n,a,i,u,s,h,p,g,v){return w$(s,h,this.points,n,a,i,u,p,this.getOrCreateCorners(n,a,i,u,g,v,"corners"))},checkPoint:function(n,a,i,u,s,h,p,g,v){return x$(n,a,this.points,h,p,u,s,this.getOrCreateCorners(h,p,u,s,g,v,"corners"))}}};Zo.generateRoundRectangle=function(){return this.nodeShapes["round-rectangle"]=this.nodeShapes.roundrectangle={renderer:this,name:"round-rectangle",points:ei(4,0),draw:function(t,r,n,a,i,u){this.renderer.nodeShapeImpl(this.name,t,r,n,a,i,this.points,u)},intersectLine:function(t,r,n,a,i,u,s,h){return bz(i,u,t,r,n,a,s,h)},checkPoint:function(t,r,n,a,i,u,s,h){var p=a/2,g=i/2;h=h==="auto"?ou(a,i):h,h=Math.min(p,g,h);var v=h*2;return!!(qo(t,r,this.points,u,s,a,i-v,[0,-1],n)||qo(t,r,this.points,u,s,a-v,i,[0,-1],n)||oc(t,r,v,v,u-p+h,s-g+h,n)||oc(t,r,v,v,u+p-h,s-g+h,n)||oc(t,r,v,v,u+p-h,s+g-h,n)||oc(t,r,v,v,u-p+h,s+g-h,n))}}};Zo.generateCutRectangle=function(){return this.nodeShapes["cut-rectangle"]=this.nodeShapes.cutrectangle={renderer:this,name:"cut-rectangle",cornerLength:ZS(),points:ei(4,0),draw:function(t,r,n,a,i,u){this.renderer.nodeShapeImpl(this.name,t,r,n,a,i,null,u)},generateCutTrianglePts:function(t,r,n,a,i){var u=i==="auto"?this.cornerLength:i,s=r/2,h=t/2,p=n-h,g=n+h,v=a-s,x=a+s;return{topLeft:[p,v+u,p+u,v,p+u,v+u],topRight:[g-u,v,g,v+u,g-u,v+u],bottomRight:[g,x-u,g-u,x,g-u,x-u],bottomLeft:[p+u,x,p,x-u,p+u,x-u]}},intersectLine:function(t,r,n,a,i,u,s,h){var p=this.generateCutTrianglePts(n+2*s,a+2*s,t,r,h),g=[].concat.apply([],[p.topLeft.splice(0,4),p.topRight.splice(0,4),p.bottomRight.splice(0,4),p.bottomLeft.splice(0,4)]);return mm(i,u,g,t,r)},checkPoint:function(t,r,n,a,i,u,s,h){var p=h==="auto"?this.cornerLength:h;if(qo(t,r,this.points,u,s,a,i-2*p,[0,-1],n)||qo(t,r,this.points,u,s,a-2*p,i,[0,-1],n))return!0;var g=this.generateCutTrianglePts(a,i,u,s);return xi(t,r,g.topLeft)||xi(t,r,g.topRight)||xi(t,r,g.bottomRight)||xi(t,r,g.bottomLeft)}}};Zo.generateBarrel=function(){return this.nodeShapes.barrel={renderer:this,name:"barrel",points:ei(4,0),draw:function(t,r,n,a,i,u){this.renderer.nodeShapeImpl(this.name,t,r,n,a,i)},intersectLine:function(t,r,n,a,i,u,s,h){var p=.15,g=.5,v=.85,x=this.generateBarrelBezierPts(n+2*s,a+2*s,t,r),S=function(M){var I=ph({x:M[0],y:M[1]},{x:M[2],y:M[3]},{x:M[4],y:M[5]},p),A=ph({x:M[0],y:M[1]},{x:M[2],y:M[3]},{x:M[4],y:M[5]},g),D=ph({x:M[0],y:M[1]},{x:M[2],y:M[3]},{x:M[4],y:M[5]},v);return[M[0],M[1],I.x,I.y,A.x,A.y,D.x,D.y,M[4],M[5]]},P=[].concat(S(x.topLeft),S(x.topRight),S(x.bottomRight),S(x.bottomLeft));return mm(i,u,P,t,r)},generateBarrelBezierPts:function(t,r,n,a){var i=r/2,u=t/2,s=n-u,h=n+u,p=a-i,g=a+i,v=Q1(t,r),x=v.heightOffset,S=v.widthOffset,P=v.ctrlPtOffsetPct*t,N={topLeft:[s,p+x,s+P,p,s+S,p],topRight:[h-S,p,h-P,p,h,p+x],bottomRight:[h,g-x,h-P,g,h-S,g],bottomLeft:[s+S,g,s+P,g,s,g-x]};return N.topLeft.isTop=!0,N.topRight.isTop=!0,N.bottomLeft.isBottom=!0,N.bottomRight.isBottom=!0,N},checkPoint:function(t,r,n,a,i,u,s,h){var p=Q1(a,i),g=p.heightOffset,v=p.widthOffset;if(qo(t,r,this.points,u,s,a,i-2*g,[0,-1],n)||qo(t,r,this.points,u,s,a-2*v,i,[0,-1],n))return!0;for(var x=this.generateBarrelBezierPts(a,i,u,s),S=function(W,X,J){var Z=J[4],K=J[2],Y=J[0],G=J[5],oe=J[1],ie=Math.min(Z,Y),ce=Math.max(Z,Y),fe=Math.min(G,oe),de=Math.max(G,oe);if(ie<=W&&W<=ce&&fe<=X&&X<=de){var be=S$(Z,K,Y),ge=m$(be[0],be[1],be[2],W),xe=ge.filter(function(Le){return 0<=Le&&Le<=1});if(xe.length>0)return xe[0]}return null},P=Object.keys(x),N=0;N<P.length;N++){var M=P[N],I=x[M],A=S(t,r,I);if(A!=null){var D=I[5],j=I[3],V=I[1],U=fa(D,j,V,A);if(I.isTop&&U<=r||I.isBottom&&r<=U)return!0}}return!1}}};Zo.generateBottomRoundrectangle=function(){return this.nodeShapes["bottom-round-rectangle"]=this.nodeShapes.bottomroundrectangle={renderer:this,name:"bottom-round-rectangle",points:ei(4,0),draw:function(t,r,n,a,i,u){this.renderer.nodeShapeImpl(this.name,t,r,n,a,i,this.points,u)},intersectLine:function(t,r,n,a,i,u,s,h){var p=t-(n/2+s),g=r-(a/2+s),v=g,x=t+(n/2+s),S=ql(i,u,t,r,p,g,x,v,!1);return S.length>0?S:bz(i,u,t,r,n,a,s,h)},checkPoint:function(t,r,n,a,i,u,s,h){h=h==="auto"?ou(a,i):h;var p=2*h;if(qo(t,r,this.points,u,s,a,i-p,[0,-1],n)||qo(t,r,this.points,u,s,a-p,i,[0,-1],n))return!0;var g=a/2+2*n,v=i/2+2*n,x=[u-g,s-v,u-g,s,u+g,s,u+g,s-v];return!!(xi(t,r,x)||oc(t,r,p,p,u+a/2-h,s+i/2-h,n)||oc(t,r,p,p,u-a/2+h,s+i/2-h,n))}}};Zo.registerNodeShapes=function(){var e=this.nodeShapes={},t=this;this.generateEllipse(),this.generatePolygon("triangle",ei(3,0)),this.generateRoundPolygon("round-triangle",ei(3,0)),this.generatePolygon("rectangle",ei(4,0)),e.square=e.rectangle,this.generateRoundRectangle(),this.generateCutRectangle(),this.generateBarrel(),this.generateBottomRoundrectangle();{var r=[0,1,1,0,0,-1,-1,0];this.generatePolygon("diamond",r),this.generateRoundPolygon("round-diamond",r)}this.generatePolygon("pentagon",ei(5,0)),this.generateRoundPolygon("round-pentagon",ei(5,0)),this.generatePolygon("hexagon",ei(6,0)),this.generateRoundPolygon("round-hexagon",ei(6,0)),this.generatePolygon("heptagon",ei(7,0)),this.generateRoundPolygon("round-heptagon",ei(7,0)),this.generatePolygon("octagon",ei(8,0)),this.generateRoundPolygon("round-octagon",ei(8,0));var n=new Array(20);{var a=J1(5,0),i=J1(5,Math.PI/5),u=.5*(3-Math.sqrt(5));u*=1.57;for(var s=0;s<i.length/2;s++)i[s*2]*=u,i[s*2+1]*=u;for(var s=0;s<20/4;s++)n[s*4]=a[s*2],n[s*4+1]=a[s*2+1],n[s*4+2]=i[s*2],n[s*4+3]=i[s*2+1]}n=_z(n),this.generatePolygon("star",n),this.generatePolygon("vee",[-1,-1,0,-.333,1,-1,0,1]),this.generatePolygon("rhomboid",[-1,-1,.333,-1,1,1,-.333,1]),this.generatePolygon("right-rhomboid",[-.333,-1,1,-1,.333,1,-1,1]),this.nodeShapes.concavehexagon=this.generatePolygon("concave-hexagon",[-1,-.95,-.75,0,-1,.95,1,.95,.75,0,1,-.95]);{var h=[-1,-1,.25,-1,1,0,.25,1,-1,1];this.generatePolygon("tag",h),this.generateRoundPolygon("round-tag",h)}e.makePolygon=function(p){var g=p.join("$"),v="polygon-"+g,x;return(x=this[v])?x:t.generatePolygon(v,p)}};var Km={};Km.timeToRender=function(){return this.redrawTotalTime/this.redrawCount};Km.redraw=function(e){e=e||gz();var t=this;t.averageRedrawTime===void 0&&(t.averageRedrawTime=0),t.lastRedrawTime===void 0&&(t.lastRedrawTime=0),t.lastDrawTime===void 0&&(t.lastDrawTime=0),t.requestedFrame=!0,t.renderOptions=e};Km.beforeRender=function(e,t){if(!this.destroyed){t==null&&Tn("Priority is not optional for beforeRender");var r=this.beforeRenderCallbacks;r.push({fn:e,priority:t}),r.sort(function(n,a){return a.priority-n.priority})}};var qI=function(t,r,n){for(var a=t.beforeRenderCallbacks,i=0;i<a.length;i++)a[i].fn(r,n)};Km.startRenderLoop=function(){var e=this,t=e.cy;if(!e.renderLoopStarted){e.renderLoopStarted=!0;var r=function(a){if(!e.destroyed){if(!t.batching())if(e.requestedFrame&&!e.skipFrame){qI(e,!0,a);var i=Uo();e.render(e.renderOptions);var u=e.lastDrawTime=Uo();e.averageRedrawTime===void 0&&(e.averageRedrawTime=u-i),e.redrawCount===void 0&&(e.redrawCount=0),e.redrawCount++,e.redrawTotalTime===void 0&&(e.redrawTotalTime=0);var s=u-i;e.redrawTotalTime+=s,e.lastRedrawTime=s,e.averageRedrawTime=e.averageRedrawTime/2+s/2,e.requestedFrame=!1}else qI(e,!1,a);e.skipFrame=!1,e0(r)}};e0(r)}};var OU=function(t){this.init(t)},wR=OU,Hh=wR.prototype;Hh.clientFunctions=["redrawHint","render","renderTo","matchCanvasSize","nodeShapeImpl","arrowShapeImpl"];Hh.init=function(e){var t=this;t.options=e,t.cy=e.cy;var r=t.container=e.cy.container(),n=t.cy.window();if(n){var a=n.document,i=a.head,u="__________cytoscape_stylesheet",s="__________cytoscape_container",h=a.getElementById(u)!=null;if(r.className.indexOf(s)<0&&(r.className=(r.className||"")+" "+s),!h){var p=a.createElement("style");p.id=u,p.textContent="."+s+" { position: relative; }",i.insertBefore(p,i.children[0])}var g=n.getComputedStyle(r),v=g.getPropertyValue("position");v==="static"&&Jr("A Cytoscape container has style position:static and so can not use UI extensions properly")}t.selection=[void 0,void 0,void 0,void 0,0],t.bezierProjPcts=[.05,.225,.4,.5,.6,.775,.95],t.hoverData={down:null,last:null,downTime:null,triggerMode:null,dragging:!1,initialPan:[null,null],capture:!1},t.dragData={possibleDragElements:[]},t.touchData={start:null,capture:!1,startPosition:[null,null,null,null,null,null],singleTouchStartTime:null,singleTouchMoved:!0,now:[null,null,null,null,null,null],earlier:[null,null,null,null,null,null]},t.redraws=0,t.showFps=e.showFps,t.debug=e.debug,t.webgl=e.webgl,t.hideEdgesOnViewport=e.hideEdgesOnViewport,t.textureOnViewport=e.textureOnViewport,t.wheelSensitivity=e.wheelSensitivity,t.motionBlurEnabled=e.motionBlur,t.forcedPixelRatio=Ht(e.pixelRatio)?e.pixelRatio:null,t.motionBlur=e.motionBlur,t.motionBlurOpacity=e.motionBlurOpacity,t.motionBlurTransparency=1-t.motionBlurOpacity,t.motionBlurPxRatio=1,t.mbPxRBlurry=1,t.minMbLowQualFrames=4,t.fullQualityMb=!1,t.clearedForMotionBlur=[],t.desktopTapThreshold=e.desktopTapThreshold,t.desktopTapThreshold2=e.desktopTapThreshold*e.desktopTapThreshold,t.touchTapThreshold=e.touchTapThreshold,t.touchTapThreshold2=e.touchTapThreshold*e.touchTapThreshold,t.tapholdDuration=500,t.bindings=[],t.beforeRenderCallbacks=[],t.beforeRenderPriorities={animations:400,eleCalcs:300,eleTxrDeq:200,lyrTxrDeq:150,lyrTxrSkip:100},t.registerNodeShapes(),t.registerArrowShapes(),t.registerCalculationListeners()};Hh.notify=function(e,t){var r=this,n=r.cy;if(!this.destroyed){if(e==="init"){r.load();return}if(e==="destroy"){r.destroy();return}(e==="add"||e==="remove"||e==="move"&&n.hasCompoundNodes()||e==="load"||e==="zorder"||e==="mount")&&r.invalidateCachedZSortedEles(),e==="viewport"&&r.redrawHint("select",!0),e==="gc"&&r.redrawHint("gc",!0),(e==="load"||e==="resize"||e==="mount")&&(r.invalidateContainerClientCoordsCache(),r.matchCanvasSize(r.container)),r.redrawHint("eles",!0),r.redrawHint("drag",!0),this.startRenderLoop(),this.redraw()}};Hh.destroy=function(){var e=this;e.destroyed=!0,e.cy.stopAnimationLoop();for(var t=0;t<e.bindings.length;t++){var r=e.bindings[t],n=r,a=n.target;(a.off||a.removeEventListener).apply(a,n.args)}if(e.bindings=[],e.beforeRenderCallbacks=[],e.onUpdateEleCalcsFns=[],e.removeObserver&&e.removeObserver.disconnect(),e.styleObserver&&e.styleObserver.disconnect(),e.resizeObserver&&e.resizeObserver.disconnect(),e.labelCalcDiv)try{document.body.removeChild(e.labelCalcDiv)}catch{}};Hh.isHeadless=function(){return!1};[aE,bR,_R,qh,Zo,Km].forEach(function(e){xr(Hh,e)});var Iw=1e3/60,SR={setupDequeueing:function(t){return function(){var n=this,a=this.renderer;if(!n.dequeueingSetup){n.dequeueingSetup=!0;var i=Hm(function(){a.redrawHint("eles",!0),a.redrawHint("drag",!0),a.redraw()},t.deqRedrawThreshold),u=function(p,g){var v=Uo(),x=a.averageRedrawTime,S=a.lastRedrawTime,P=[],N=a.cy.extent(),M=a.getPixelRatio();for(p||a.flushRenderedStyleQueue();;){var I=Uo(),A=I-v,D=I-g;if(S<Iw){var j=Iw-(p?x:0);if(D>=t.deqFastCost*j)break}else if(p){if(A>=t.deqCost*S||A>=t.deqAvgCost*x)break}else if(D>=t.deqNoDrawCost*Iw)break;var V=t.deq(n,M,N);if(V.length>0)for(var U=0;U<V.length;U++)P.push(V[U]);else break}P.length>0&&(t.onDeqd(n,P),!p&&t.shouldRedraw(n,P,M,N)&&i())},s=t.priority||US;a.beforeRender(u,s(n))}}}},FU=function(){function e(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t0;pu(this,e),this.idsByKey=new Ro,this.keyForId=new Ro,this.cachesByLvl=new Ro,this.lvls=[],this.getKey=t,this.doesEleInvalidateKey=r}return mu(e,[{key:"getIdsFor",value:function(r){r==null&&Tn("Can not get id list for null key");var n=this.idsByKey,a=this.idsByKey.get(r);return a||(a=new Fh,n.set(r,a)),a}},{key:"addIdForKey",value:function(r,n){r!=null&&this.getIdsFor(r).add(n)}},{key:"deleteIdForKey",value:function(r,n){r!=null&&this.getIdsFor(r).delete(n)}},{key:"getNumberOfIdsForKey",value:function(r){return r==null?0:this.getIdsFor(r).size}},{key:"updateKeyMappingFor",value:function(r){var n=r.id(),a=this.keyForId.get(n),i=this.getKey(r);this.deleteIdForKey(a,n),this.addIdForKey(i,n),this.keyForId.set(n,i)}},{key:"deleteKeyMappingFor",value:function(r){var n=r.id(),a=this.keyForId.get(n);this.deleteIdForKey(a,n),this.keyForId.delete(n)}},{key:"keyHasChangedFor",value:function(r){var n=r.id(),a=this.keyForId.get(n),i=this.getKey(r);return a!==i}},{key:"isInvalid",value:function(r){return this.keyHasChangedFor(r)||this.doesEleInvalidateKey(r)}},{key:"getCachesAt",value:function(r){var n=this.cachesByLvl,a=this.lvls,i=n.get(r);return i||(i=new Ro,n.set(r,i),a.push(r)),i}},{key:"getCache",value:function(r,n){return this.getCachesAt(n).get(r)}},{key:"get",value:function(r,n){var a=this.getKey(r),i=this.getCache(a,n);return i!=null&&this.updateKeyMappingFor(r),i}},{key:"getForCachedKey",value:function(r,n){var a=this.keyForId.get(r.id()),i=this.getCache(a,n);return i}},{key:"hasCache",value:function(r,n){return this.getCachesAt(n).has(r)}},{key:"has",value:function(r,n){var a=this.getKey(r);return this.hasCache(a,n)}},{key:"setCache",value:function(r,n,a){a.key=r,this.getCachesAt(n).set(r,a)}},{key:"set",value:function(r,n,a){var i=this.getKey(r);this.setCache(i,n,a),this.updateKeyMappingFor(r)}},{key:"deleteCache",value:function(r,n){this.getCachesAt(n).delete(r)}},{key:"delete",value:function(r,n){var a=this.getKey(r);this.deleteCache(a,n)}},{key:"invalidateKey",value:function(r){var n=this;this.lvls.forEach(function(a){return n.deleteCache(r,a)})}},{key:"invalidate",value:function(r){var n=r.id(),a=this.keyForId.get(n);this.deleteKeyMappingFor(r);var i=this.doesEleInvalidateKey(r);return i&&this.invalidateKey(a),i||this.getNumberOfIdsForKey(a)===0}}])}(),HI=25,zv=50,xy=-4,h2=3,ER=7.99,$U=8,VU=1024,UU=1024,qU=1024,HU=.2,GU=.8,WU=10,ZU=.15,XU=.1,KU=.9,YU=.9,JU=100,QU=1,ah={dequeue:"dequeue",downscale:"downscale",highQuality:"highQuality"},eq=Pa({getKey:null,doesEleInvalidateKey:t0,drawElement:null,getBoundingBox:null,getRotationPoint:null,getRotationOffset:null,isVisible:fz,allowEdgeTxrCaching:!0,allowParentTxrCaching:!0}),Tp=function(t,r){var n=this;n.renderer=t,n.onDequeues=[];var a=eq(r);xr(n,a),n.lookup=new FU(a.getKey,a.doesEleInvalidateKey),n.setupDequeueing()},ra=Tp.prototype;ra.reasons=ah;ra.getTextureQueue=function(e){var t=this;return t.eleImgCaches=t.eleImgCaches||{},t.eleImgCaches[e]=t.eleImgCaches[e]||[]};ra.getRetiredTextureQueue=function(e){var t=this,r=t.eleImgCaches.retired=t.eleImgCaches.retired||{},n=r[e]=r[e]||[];return n};ra.getElementQueue=function(){var e=this,t=e.eleCacheQueue=e.eleCacheQueue||new Gm(function(r,n){return n.reqs-r.reqs});return t};ra.getElementKeyToQueue=function(){var e=this,t=e.eleKeyToCacheQueue=e.eleKeyToCacheQueue||{};return t};ra.getElement=function(e,t,r,n,a){var i=this,u=this.renderer,s=u.cy.zoom(),h=this.lookup;if(!t||t.w===0||t.h===0||isNaN(t.w)||isNaN(t.h)||!e.visible()||e.removed()||!i.allowEdgeTxrCaching&&e.isEdge()||!i.allowParentTxrCaching&&e.isParent())return null;if(n==null&&(n=Math.ceil(HS(s*r))),n<xy)n=xy;else if(s>=ER||n>h2)return null;var p=Math.pow(2,n),g=t.h*p,v=t.w*p,x=u.eleTextBiggerThanMin(e,p);if(!this.isVisible(e,x))return null;var S=h.get(e,n);if(S&&S.invalidated&&(S.invalidated=!1,S.texture.invalidatedWidth-=S.width),S)return S;var P;if(g<=HI?P=HI:g<=zv?P=zv:P=Math.ceil(g/zv)*zv,g>qU||v>UU)return null;var N=i.getTextureQueue(P),M=N[N.length-2],I=function(){return i.recycleTexture(P,v)||i.addTexture(P,v)};M||(M=N[N.length-1]),M||(M=I()),M.width-M.usedWidth<v&&(M=I());for(var A=function(ie){return ie&&ie.scaledLabelShown===x},D=a&&a===ah.dequeue,j=a&&a===ah.highQuality,V=a&&a===ah.downscale,U,$=n+1;$<=h2;$++){var W=h.get(e,$);if(W){U=W;break}}var X=U&&U.level===n+1?U:null,J=function(){M.context.drawImage(X.texture.canvas,X.x,0,X.width,X.height,M.usedWidth,0,v,g)};if(M.context.setTransform(1,0,0,1,0,0),M.context.clearRect(M.usedWidth,0,v,P),A(X))J();else if(A(U))if(j){for(var Z=U.level;Z>n;Z--)X=i.getElement(e,t,r,Z,ah.downscale);J()}else return i.queueElement(e,U.level-1),U;else{var K;if(!D&&!j&&!V)for(var Y=n-1;Y>=xy;Y--){var G=h.get(e,Y);if(G){K=G;break}}if(A(K))return i.queueElement(e,n),K;M.context.translate(M.usedWidth,0),M.context.scale(p,p),this.drawElement(M.context,e,t,x,!1),M.context.scale(1/p,1/p),M.context.translate(-M.usedWidth,0)}return S={x:M.usedWidth,texture:M,level:n,scale:p,width:v,height:g,scaledLabelShown:x},M.usedWidth+=Math.ceil(v+$U),M.eleCaches.push(S),h.set(e,n,S),i.checkTextureFullness(M),S};ra.invalidateElements=function(e){for(var t=0;t<e.length;t++)this.invalidateElement(e[t])};ra.invalidateElement=function(e){var t=this,r=t.lookup,n=[],a=r.isInvalid(e);if(a){for(var i=xy;i<=h2;i++){var u=r.getForCachedKey(e,i);u&&n.push(u)}var s=r.invalidate(e);if(s)for(var h=0;h<n.length;h++){var p=n[h],g=p.texture;g.invalidatedWidth+=p.width,p.invalidated=!0,t.checkTextureUtility(g)}t.removeFromQueue(e)}};ra.checkTextureUtility=function(e){e.invalidatedWidth>=HU*e.width&&this.retireTexture(e)};ra.checkTextureFullness=function(e){var t=this,r=t.getTextureQueue(e.height);e.usedWidth/e.width>GU&&e.fullnessChecks>=WU?su(r,e):e.fullnessChecks++};ra.retireTexture=function(e){var t=this,r=e.height,n=t.getTextureQueue(r),a=this.lookup;su(n,e),e.retired=!0;for(var i=e.eleCaches,u=0;u<i.length;u++){var s=i[u];a.deleteCache(s.key,s.level)}qS(i);var h=t.getRetiredTextureQueue(r);h.push(e)};ra.addTexture=function(e,t){var r=this,n=r.getTextureQueue(e),a={};return n.push(a),a.eleCaches=[],a.height=e,a.width=Math.max(VU,t),a.usedWidth=0,a.invalidatedWidth=0,a.fullnessChecks=0,a.canvas=r.renderer.makeOffscreenCanvas(a.width,a.height),a.context=a.canvas.getContext("2d"),a};ra.recycleTexture=function(e,t){for(var r=this,n=r.getTextureQueue(e),a=r.getRetiredTextureQueue(e),i=0;i<a.length;i++){var u=a[i];if(u.width>=t)return u.retired=!1,u.usedWidth=0,u.invalidatedWidth=0,u.fullnessChecks=0,qS(u.eleCaches),u.context.setTransform(1,0,0,1,0,0),u.context.clearRect(0,0,u.width,u.height),su(a,u),n.push(u),u}};ra.queueElement=function(e,t){var r=this,n=r.getElementQueue(),a=r.getElementKeyToQueue(),i=this.getKey(e),u=a[i];if(u)u.level=Math.max(u.level,t),u.eles.merge(e),u.reqs++,n.updateItem(u);else{var s={eles:e.spawn().merge(e),level:t,reqs:1,key:i};n.push(s),a[i]=s}};ra.dequeue=function(e){for(var t=this,r=t.getElementQueue(),n=t.getElementKeyToQueue(),a=[],i=t.lookup,u=0;u<QU&&r.size()>0;u++){var s=r.pop(),h=s.key,p=s.eles[0],g=i.hasCache(p,s.level);if(n[h]=null,g)continue;a.push(s);var v=t.getBoundingBox(p);t.getElement(p,v,e,s.level,ah.dequeue)}return a};ra.removeFromQueue=function(e){var t=this,r=t.getElementQueue(),n=t.getElementKeyToQueue(),a=this.getKey(e),i=n[a];i!=null&&(i.eles.length===1?(i.reqs=VS,r.updateItem(i),r.pop(),n[a]=null):i.eles.unmerge(e))};ra.onDequeue=function(e){this.onDequeues.push(e)};ra.offDequeue=function(e){su(this.onDequeues,e)};ra.setupDequeueing=SR.setupDequeueing({deqRedrawThreshold:JU,deqCost:ZU,deqAvgCost:XU,deqNoDrawCost:KU,deqFastCost:YU,deq:function(t,r,n){return t.dequeue(r,n)},onDeqd:function(t,r){for(var n=0;n<t.onDequeues.length;n++){var a=t.onDequeues[n];a(r)}},shouldRedraw:function(t,r,n,a){for(var i=0;i<r.length;i++)for(var u=r[i].eles,s=0;s<u.length;s++){var h=u[s].boundingBox();if(WS(h,a))return!0}return!1},priority:function(t){return t.renderer.beforeRenderPriorities.eleTxrDeq}});var tq=1,Vp=-4,u0=2,rq=3.99,nq=50,aq=50,iq=.15,sq=.1,oq=.9,lq=.9,uq=1,GI=250,cq=4e3*4e3,WI=32767,dq=!0,CR=function(t){var r=this,n=r.renderer=t,a=n.cy;r.layersByLevel={},r.firstGet=!0,r.lastInvalidationTime=Uo()-2*GI,r.skipping=!1,r.eleTxrDeqs=a.collection(),r.scheduleElementRefinement=Hm(function(){r.refineElementTextures(r.eleTxrDeqs),r.eleTxrDeqs.unmerge(r.eleTxrDeqs)},aq),n.beforeRender(function(u,s){s-r.lastInvalidationTime<=GI?r.skipping=!0:r.skipping=!1},n.beforeRenderPriorities.lyrTxrSkip);var i=function(s,h){return h.reqs-s.reqs};r.layersQueue=new Gm(i),r.setupDequeueing()},Ia=CR.prototype,ZI=0,hq=Math.pow(2,53)-1;Ia.makeLayer=function(e,t){var r=Math.pow(2,t),n=Math.ceil(e.w*r),a=Math.ceil(e.h*r),i=this.renderer.makeOffscreenCanvas(n,a),u={id:ZI=++ZI%hq,bb:e,level:t,width:n,height:a,canvas:i,context:i.getContext("2d"),eles:[],elesQueue:[],reqs:0},s=u.context,h=-u.bb.x1,p=-u.bb.y1;return s.scale(r,r),s.translate(h,p),u};Ia.getLayers=function(e,t,r){var n=this,a=n.renderer,i=a.cy,u=i.zoom(),s=n.firstGet;if(n.firstGet=!1,r==null){if(r=Math.ceil(HS(u*t)),r<Vp)r=Vp;else if(u>=rq||r>u0)return null}n.validateLayersElesOrdering(r,e);var h=n.layersByLevel,p=Math.pow(2,r),g=h[r]=h[r]||[],v,x=n.levelIsComplete(r,e),S,P=function(){var J=function(oe){if(n.validateLayersElesOrdering(oe,e),n.levelIsComplete(oe,e))return S=h[oe],!0},Z=function(oe){if(!S)for(var ie=r+oe;Vp<=ie&&ie<=u0&&!J(ie);ie+=oe);};Z(1),Z(-1);for(var K=g.length-1;K>=0;K--){var Y=g[K];Y.invalid&&su(g,Y)}};if(!x)P();else return g;var N=function(){if(!v){v=ni();for(var J=0;J<e.length;J++)u$(v,e[J].boundingBox())}return v},M=function(J){J=J||{};var Z=J.after;N();var K=Math.ceil(v.w*p),Y=Math.ceil(v.h*p);if(K>WI||Y>WI)return null;var G=K*Y;if(G>cq)return null;var oe=n.makeLayer(v,r);if(Z!=null){var ie=g.indexOf(Z)+1;g.splice(ie,0,oe)}else(J.insert===void 0||J.insert)&&g.unshift(oe);return oe};if(n.skipping&&!s)return null;for(var I=null,A=e.length/tq,D=!s,j=0;j<e.length;j++){var V=e[j],U=V._private.rscratch,$=U.imgLayerCaches=U.imgLayerCaches||{},W=$[r];if(W){I=W;continue}if((!I||I.eles.length>=A||!xz(I.bb,V.boundingBox()))&&(I=M({insert:!0,after:I}),!I))return null;S||D?n.queueLayer(I,V):n.drawEleInLayer(I,V,r,t),I.eles.push(V),$[r]=I}return S||(D?null:g)};Ia.getEleLevelForLayerLevel=function(e,t){return e};Ia.drawEleInLayer=function(e,t,r,n){var a=this,i=this.renderer,u=e.context,s=t.boundingBox();s.w===0||s.h===0||!t.visible()||(r=a.getEleLevelForLayerLevel(r,n),i.setImgSmoothing(u,!1),i.drawCachedElement(u,t,null,null,r,dq),i.setImgSmoothing(u,!0))};Ia.levelIsComplete=function(e,t){var r=this,n=r.layersByLevel[e];if(!n||n.length===0)return!1;for(var a=0,i=0;i<n.length;i++){var u=n[i];if(u.reqs>0||u.invalid)return!1;a+=u.eles.length}return a===t.length};Ia.validateLayersElesOrdering=function(e,t){var r=this.layersByLevel[e];if(r)for(var n=0;n<r.length;n++){for(var a=r[n],i=-1,u=0;u<t.length;u++)if(a.eles[0]===t[u]){i=u;break}if(i<0){this.invalidateLayer(a);continue}for(var s=i,u=0;u<a.eles.length;u++)if(a.eles[u]!==t[s+u]){this.invalidateLayer(a);break}}};Ia.updateElementsInLayers=function(e,t){for(var r=this,n=$m(e[0]),a=0;a<e.length;a++)for(var i=n?null:e[a],u=n?e[a]:e[a].ele,s=u._private.rscratch,h=s.imgLayerCaches=s.imgLayerCaches||{},p=Vp;p<=u0;p++){var g=h[p];g&&(i&&r.getEleLevelForLayerLevel(g.level)!==i.level||t(g,u,i))}};Ia.haveLayers=function(){for(var e=this,t=!1,r=Vp;r<=u0;r++){var n=e.layersByLevel[r];if(n&&n.length>0){t=!0;break}}return t};Ia.invalidateElements=function(e){var t=this;e.length!==0&&(t.lastInvalidationTime=Uo(),!(e.length===0||!t.haveLayers())&&t.updateElementsInLayers(e,function(n,a,i){t.invalidateLayer(n)}))};Ia.invalidateLayer=function(e){if(this.lastInvalidationTime=Uo(),!e.invalid){var t=e.level,r=e.eles,n=this.layersByLevel[t];su(n,e),e.elesQueue=[],e.invalid=!0,e.replacement&&(e.replacement.invalid=!0);for(var a=0;a<r.length;a++){var i=r[a]._private.rscratch.imgLayerCaches;i&&(i[t]=null)}}};Ia.refineElementTextures=function(e){var t=this;t.updateElementsInLayers(e,function(n,a,i){var u=n.replacement;if(u||(u=n.replacement=t.makeLayer(n.bb,n.level),u.replaces=n,u.eles=n.eles),!u.reqs)for(var s=0;s<u.eles.length;s++)t.queueLayer(u,u.eles[s])})};Ia.enqueueElementRefinement=function(e){this.eleTxrDeqs.merge(e),this.scheduleElementRefinement()};Ia.queueLayer=function(e,t){var r=this,n=r.layersQueue,a=e.elesQueue,i=a.hasId=a.hasId||{};if(!e.replacement){if(t){if(i[t.id()])return;a.push(t),i[t.id()]=!0}e.reqs?(e.reqs++,n.updateItem(e)):(e.reqs=1,n.push(e))}};Ia.dequeue=function(e){for(var t=this,r=t.layersQueue,n=[],a=0;a<uq&&r.size()!==0;){var i=r.peek();if(i.replacement){r.pop();continue}if(i.replaces&&i!==i.replaces.replacement){r.pop();continue}if(i.invalid){r.pop();continue}var u=i.elesQueue.shift();u&&(t.drawEleInLayer(i,u,i.level,e),a++),n.length===0&&n.push(!0),i.elesQueue.length===0&&(r.pop(),i.reqs=0,i.replaces&&t.applyLayerReplacement(i),t.requestRedraw())}return n};Ia.applyLayerReplacement=function(e){var t=this,r=t.layersByLevel[e.level],n=e.replaces,a=r.indexOf(n);if(!(a<0||n.invalid)){r[a]=e;for(var i=0;i<e.eles.length;i++){var u=e.eles[i]._private,s=u.imgLayerCaches=u.imgLayerCaches||{};s&&(s[e.level]=e)}t.requestRedraw()}};Ia.requestRedraw=Hm(function(){var e=this.renderer;e.redrawHint("eles",!0),e.redrawHint("drag",!0),e.redraw()},100);Ia.setupDequeueing=SR.setupDequeueing({deqRedrawThreshold:nq,deqCost:iq,deqAvgCost:sq,deqNoDrawCost:oq,deqFastCost:lq,deq:function(t,r){return t.dequeue(r)},onDeqd:US,shouldRedraw:fz,priority:function(t){return t.renderer.beforeRenderPriorities.lyrTxrDeq}});var kR={},XI;function fq(e,t){for(var r=0;r<t.length;r++){var n=t[r];e.lineTo(n.x,n.y)}}function pq(e,t,r){for(var n,a=0;a<t.length;a++){var i=t[a];a===0&&(n=i),e.lineTo(i.x,i.y)}e.quadraticCurveTo(r.x,r.y,n.x,n.y)}function KI(e,t,r){e.beginPath&&e.beginPath();for(var n=t,a=0;a<n.length;a++){var i=n[a];e.lineTo(i.x,i.y)}var u=r,s=r[0];e.moveTo(s.x,s.y);for(var a=1;a<u.length;a++){var i=u[a];e.lineTo(i.x,i.y)}e.closePath&&e.closePath()}function mq(e,t,r,n,a){e.beginPath&&e.beginPath(),e.arc(r,n,a,0,Math.PI*2,!1);var i=t,u=i[0];e.moveTo(u.x,u.y);for(var s=0;s<i.length;s++){var h=i[s];e.lineTo(h.x,h.y)}e.closePath&&e.closePath()}function gq(e,t,r,n){e.arc(t,r,n,0,Math.PI*2,!1)}kR.arrowShapeImpl=function(e){return(XI||(XI={polygon:fq,"triangle-backcurve":pq,"triangle-tee":KI,"circle-triangle":mq,"triangle-cross":KI,circle:gq}))[e]};var lo={};lo.drawElement=function(e,t,r,n,a,i){var u=this;t.isNode()?u.drawNode(e,t,r,n,a,i):u.drawEdge(e,t,r,n,a,i)};lo.drawElementOverlay=function(e,t){var r=this;t.isNode()?r.drawNodeOverlay(e,t):r.drawEdgeOverlay(e,t)};lo.drawElementUnderlay=function(e,t){var r=this;t.isNode()?r.drawNodeUnderlay(e,t):r.drawEdgeUnderlay(e,t)};lo.drawCachedElementPortion=function(e,t,r,n,a,i,u,s){var h=this,p=r.getBoundingBox(t);if(!(p.w===0||p.h===0)){var g=r.getElement(t,p,n,a,i);if(g!=null){var v=s(h,t);if(v===0)return;var x=u(h,t),S=p.x1,P=p.y1,N=p.w,M=p.h,I,A,D,j,V;if(x!==0){var U=r.getRotationPoint(t);D=U.x,j=U.y,e.translate(D,j),e.rotate(x),V=h.getImgSmoothing(e),V||h.setImgSmoothing(e,!0);var $=r.getRotationOffset(t);I=$.x,A=$.y}else I=S,A=P;var W;v!==1&&(W=e.globalAlpha,e.globalAlpha=W*v),e.drawImage(g.texture.canvas,g.x,0,g.width,g.height,I,A,N,M),v!==1&&(e.globalAlpha=W),x!==0&&(e.rotate(-x),e.translate(-D,-j),V||h.setImgSmoothing(e,!1))}else r.drawElement(e,t)}};var vq=function(){return 0},yq=function(t,r){return t.getTextAngle(r,null)},xq=function(t,r){return t.getTextAngle(r,"source")},bq=function(t,r){return t.getTextAngle(r,"target")},_q=function(t,r){return r.effectiveOpacity()},Aw=function(t,r){return r.pstyle("text-opacity").pfValue*r.effectiveOpacity()};lo.drawCachedElement=function(e,t,r,n,a,i){var u=this,s=u.data,h=s.eleTxrCache,p=s.lblTxrCache,g=s.slbTxrCache,v=s.tlbTxrCache,x=t.boundingBox(),S=i===!0?h.reasons.highQuality:null;if(!(x.w===0||x.h===0||!t.visible())&&(!n||WS(x,n))){var P=t.isEdge(),N=t.element()._private.rscratch.badLine;u.drawElementUnderlay(e,t),u.drawCachedElementPortion(e,t,h,r,a,S,vq,_q),(!P||!N)&&u.drawCachedElementPortion(e,t,p,r,a,S,yq,Aw),P&&!N&&(u.drawCachedElementPortion(e,t,g,r,a,S,xq,Aw),u.drawCachedElementPortion(e,t,v,r,a,S,bq,Aw)),u.drawElementOverlay(e,t)}};lo.drawElements=function(e,t){for(var r=this,n=0;n<t.length;n++){var a=t[n];r.drawElement(e,a)}};lo.drawCachedElements=function(e,t,r,n){for(var a=this,i=0;i<t.length;i++){var u=t[i];a.drawCachedElement(e,u,r,n)}};lo.drawCachedNodes=function(e,t,r,n){for(var a=this,i=0;i<t.length;i++){var u=t[i];u.isNode()&&a.drawCachedElement(e,u,r,n)}};lo.drawLayeredElements=function(e,t,r,n){var a=this,i=a.data.lyrTxrCache.getLayers(t,r);if(i)for(var u=0;u<i.length;u++){var s=i[u],h=s.bb;h.w===0||h.h===0||e.drawImage(s.canvas,h.x1,h.y1,h.w,h.h)}else a.drawCachedElements(e,t,r,n)};var Xo={};Xo.drawEdge=function(e,t,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,i=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,u=this,s=t._private.rscratch;if(!(i&&!t.visible())&&!(s.badLine||s.allpts==null||isNaN(s.allpts[0]))){var h;r&&(h=r,e.translate(-h.x1,-h.y1));var p=i?t.pstyle("opacity").value:1,g=i?t.pstyle("line-opacity").value:1,v=t.pstyle("curve-style").value,x=t.pstyle("line-style").value,S=t.pstyle("width").pfValue,P=t.pstyle("line-cap").value,N=t.pstyle("line-outline-width").value,M=t.pstyle("line-outline-color").value,I=p*g,A=p*g,D=function(){var oe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:I;v==="straight-triangle"?(u.eleStrokeStyle(e,t,oe),u.drawEdgeTrianglePath(t,e,s.allpts)):(e.lineWidth=S,e.lineCap=P,u.eleStrokeStyle(e,t,oe),u.drawEdgePath(t,e,s.allpts,x),e.lineCap="butt")},j=function(){var oe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:I;if(e.lineWidth=S+N,e.lineCap=P,N>0)u.colorStrokeStyle(e,M[0],M[1],M[2],oe);else{e.lineCap="butt";return}v==="straight-triangle"?u.drawEdgeTrianglePath(t,e,s.allpts):(u.drawEdgePath(t,e,s.allpts,x),e.lineCap="butt")},V=function(){a&&u.drawEdgeOverlay(e,t)},U=function(){a&&u.drawEdgeUnderlay(e,t)},$=function(){var oe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:A;u.drawArrowheads(e,t,oe)},W=function(){u.drawElementText(e,t,null,n)};e.lineJoin="round";var X=t.pstyle("ghost").value==="yes";if(X){var J=t.pstyle("ghost-offset-x").pfValue,Z=t.pstyle("ghost-offset-y").pfValue,K=t.pstyle("ghost-opacity").value,Y=I*K;e.translate(J,Z),D(Y),$(Y),e.translate(-J,-Z)}else j();U(),D(),$(),V(),W(),r&&e.translate(h.x1,h.y1)}};var TR=function(t){if(!["overlay","underlay"].includes(t))throw new Error("Invalid state");return function(r,n){if(n.visible()){var a=n.pstyle("".concat(t,"-opacity")).value;if(a!==0){var i=this,u=i.usePaths(),s=n._private.rscratch,h=n.pstyle("".concat(t,"-padding")).pfValue,p=2*h,g=n.pstyle("".concat(t,"-color")).value;r.lineWidth=p,s.edgeType==="self"&&!u?r.lineCap="butt":r.lineCap="round",i.colorStrokeStyle(r,g[0],g[1],g[2],a),i.drawEdgePath(n,r,s.allpts,"solid")}}}};Xo.drawEdgeOverlay=TR("overlay");Xo.drawEdgeUnderlay=TR("underlay");Xo.drawEdgePath=function(e,t,r,n){var a=e._private.rscratch,i=t,u,s=!1,h=this.usePaths(),p=e.pstyle("line-dash-pattern").pfValue,g=e.pstyle("line-dash-offset").pfValue;if(h){var v=r.join("$"),x=a.pathCacheKey&&a.pathCacheKey===v;x?(u=t=a.pathCache,s=!0):(u=t=new Path2D,a.pathCacheKey=v,a.pathCache=u)}if(i.setLineDash)switch(n){case"dotted":i.setLineDash([1,1]);break;case"dashed":i.setLineDash(p),i.lineDashOffset=g;break;case"solid":i.setLineDash([]);break}if(!s&&!a.badLine)switch(t.beginPath&&t.beginPath(),t.moveTo(r[0],r[1]),a.edgeType){case"bezier":case"self":case"compound":case"multibezier":for(var S=2;S+3<r.length;S+=4)t.quadraticCurveTo(r[S],r[S+1],r[S+2],r[S+3]);break;case"straight":case"haystack":for(var P=2;P+1<r.length;P+=2)t.lineTo(r[P],r[P+1]);break;case"segments":if(a.isRound){var N=wi(a.roundCorners),M;try{for(N.s();!(M=N.n()).done;){var I=M.value;mR(t,I)}}catch(D){N.e(D)}finally{N.f()}t.lineTo(r[r.length-2],r[r.length-1])}else for(var A=2;A+1<r.length;A+=2)t.lineTo(r[A],r[A+1]);break}t=i,h?t.stroke(u):t.stroke(),t.setLineDash&&t.setLineDash([])};Xo.drawEdgeTrianglePath=function(e,t,r){t.fillStyle=t.strokeStyle;for(var n=e.pstyle("width").pfValue,a=0;a+1<r.length;a+=2){var i=[r[a+2]-r[a],r[a+3]-r[a+1]],u=Math.sqrt(i[0]*i[0]+i[1]*i[1]),s=[i[1]/u,-i[0]/u],h=[s[0]*n/2,s[1]*n/2];t.beginPath(),t.moveTo(r[a]-h[0],r[a+1]-h[1]),t.lineTo(r[a]+h[0],r[a+1]+h[1]),t.lineTo(r[a+2],r[a+3]),t.closePath(),t.fill()}};Xo.drawArrowheads=function(e,t,r){var n=t._private.rscratch,a=n.edgeType==="haystack";a||this.drawArrowhead(e,t,"source",n.arrowStartX,n.arrowStartY,n.srcArrowAngle,r),this.drawArrowhead(e,t,"mid-target",n.midX,n.midY,n.midtgtArrowAngle,r),this.drawArrowhead(e,t,"mid-source",n.midX,n.midY,n.midsrcArrowAngle,r),a||this.drawArrowhead(e,t,"target",n.arrowEndX,n.arrowEndY,n.tgtArrowAngle,r)};Xo.drawArrowhead=function(e,t,r,n,a,i,u){if(!(isNaN(n)||n==null||isNaN(a)||a==null||isNaN(i)||i==null)){var s=this,h=t.pstyle(r+"-arrow-shape").value;if(h!=="none"){var p=t.pstyle(r+"-arrow-fill").value==="hollow"?"both":"filled",g=t.pstyle(r+"-arrow-fill").value,v=t.pstyle("width").pfValue,x=t.pstyle(r+"-arrow-width"),S=x.value==="match-line"?v:x.pfValue;x.units==="%"&&(S*=v);var P=t.pstyle("opacity").value;u===void 0&&(u=P);var N=e.globalCompositeOperation;(u!==1||g==="hollow")&&(e.globalCompositeOperation="destination-out",s.colorFillStyle(e,255,255,255,1),s.colorStrokeStyle(e,255,255,255,1),s.drawArrowShape(t,e,p,v,h,S,n,a,i),e.globalCompositeOperation=N);var M=t.pstyle(r+"-arrow-color").value;s.colorFillStyle(e,M[0],M[1],M[2],u),s.colorStrokeStyle(e,M[0],M[1],M[2],u),s.drawArrowShape(t,e,g,v,h,S,n,a,i)}}};Xo.drawArrowShape=function(e,t,r,n,a,i,u,s,h){var p=this,g=this.usePaths()&&a!=="triangle-cross",v=!1,x,S=t,P={x:u,y:s},N=e.pstyle("arrow-scale").value,M=this.getArrowWidth(n,N),I=p.arrowShapes[a];if(g){var A=p.arrowPathCache=p.arrowPathCache||[],D=bc(a),j=A[D];j!=null?(x=t=j,v=!0):(x=t=new Path2D,A[D]=x)}v||(t.beginPath&&t.beginPath(),g?I.draw(t,1,0,{x:0,y:0},1):I.draw(t,M,h,P,n),t.closePath&&t.closePath()),t=S,g&&(t.translate(u,s),t.rotate(h),t.scale(M,M)),(r==="filled"||r==="both")&&(g?t.fill(x):t.fill()),(r==="hollow"||r==="both")&&(t.lineWidth=i/(g?M:1),t.lineJoin="miter",g?t.stroke(x):t.stroke()),g&&(t.scale(1/M,1/M),t.rotate(-h),t.translate(-u,-s))};var oE={};oE.safeDrawImage=function(e,t,r,n,a,i,u,s,h,p){if(!(a<=0||i<=0||h<=0||p<=0))try{e.drawImage(t,r,n,a,i,u,s,h,p)}catch(g){Jr(g)}};oE.drawInscribedImage=function(e,t,r,n,a){var i=this,u=r.position(),s=u.x,h=u.y,p=r.cy().style(),g=p.getIndexedStyle.bind(p),v=g(r,"background-fit","value",n),x=g(r,"background-repeat","value",n),S=r.width(),P=r.height(),N=r.padding()*2,M=S+(g(r,"background-width-relative-to","value",n)==="inner"?0:N),I=P+(g(r,"background-height-relative-to","value",n)==="inner"?0:N),A=r._private.rscratch,D=g(r,"background-clip","value",n),j=D==="node",V=g(r,"background-image-opacity","value",n)*a,U=g(r,"background-image-smoothing","value",n),$=r.pstyle("corner-radius").value;$!=="auto"&&($=r.pstyle("corner-radius").pfValue);var W=t.width||t.cachedW,X=t.height||t.cachedH;(W==null||X==null)&&(document.body.appendChild(t),W=t.cachedW=t.width||t.offsetWidth,X=t.cachedH=t.height||t.offsetHeight,document.body.removeChild(t));var J=W,Z=X;if(g(r,"background-width","value",n)!=="auto"&&(g(r,"background-width","units",n)==="%"?J=g(r,"background-width","pfValue",n)*M:J=g(r,"background-width","pfValue",n)),g(r,"background-height","value",n)!=="auto"&&(g(r,"background-height","units",n)==="%"?Z=g(r,"background-height","pfValue",n)*I:Z=g(r,"background-height","pfValue",n)),!(J===0||Z===0)){if(v==="contain"){var K=Math.min(M/J,I/Z);J*=K,Z*=K}else if(v==="cover"){var K=Math.max(M/J,I/Z);J*=K,Z*=K}var Y=s-M/2,G=g(r,"background-position-x","units",n),oe=g(r,"background-position-x","pfValue",n);G==="%"?Y+=(M-J)*oe:Y+=oe;var ie=g(r,"background-offset-x","units",n),ce=g(r,"background-offset-x","pfValue",n);ie==="%"?Y+=(M-J)*ce:Y+=ce;var fe=h-I/2,de=g(r,"background-position-y","units",n),be=g(r,"background-position-y","pfValue",n);de==="%"?fe+=(I-Z)*be:fe+=be;var ge=g(r,"background-offset-y","units",n),xe=g(r,"background-offset-y","pfValue",n);ge==="%"?fe+=(I-Z)*xe:fe+=xe,A.pathCache&&(Y-=s,fe-=h,s=0,h=0);var Le=e.globalAlpha;e.globalAlpha=V;var Oe=i.getImgSmoothing(e),Fe=!1;if(U==="no"&&Oe?(i.setImgSmoothing(e,!1),Fe=!0):U==="yes"&&!Oe&&(i.setImgSmoothing(e,!0),Fe=!0),x==="no-repeat")j&&(e.save(),A.pathCache?e.clip(A.pathCache):(i.nodeShapes[i.getNodeShape(r)].draw(e,s,h,M,I,$,A),e.clip())),i.safeDrawImage(e,t,0,0,W,X,Y,fe,J,Z),j&&e.restore();else{var et=e.createPattern(t,x);e.fillStyle=et,i.nodeShapes[i.getNodeShape(r)].draw(e,s,h,M,I,$,A),e.translate(Y,fe),e.fill(),e.translate(-Y,-fe)}e.globalAlpha=Le,Fe&&i.setImgSmoothing(e,Oe)}};var Dc={};Dc.eleTextBiggerThanMin=function(e,t){if(!t){var r=e.cy().zoom(),n=this.getPixelRatio(),a=Math.ceil(HS(r*n));t=Math.pow(2,a)}var i=e.pstyle("font-size").pfValue*t,u=e.pstyle("min-zoomed-font-size").pfValue;return!(i<u)};Dc.drawElementText=function(e,t,r,n,a){var i=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,u=this;if(n==null){if(i&&!u.eleTextBiggerThanMin(t))return}else if(n===!1)return;if(t.isNode()){var s=t.pstyle("label");if(!s||!s.value)return;var h=u.getLabelJustification(t);e.textAlign=h,e.textBaseline="bottom"}else{var p=t.element()._private.rscratch.badLine,g=t.pstyle("label"),v=t.pstyle("source-label"),x=t.pstyle("target-label");if(p||(!g||!g.value)&&(!v||!v.value)&&(!x||!x.value))return;e.textAlign="center",e.textBaseline="bottom"}var S=!r,P;r&&(P=r,e.translate(-P.x1,-P.y1)),a==null?(u.drawText(e,t,null,S,i),t.isEdge()&&(u.drawText(e,t,"source",S,i),u.drawText(e,t,"target",S,i))):u.drawText(e,t,a,S,i),r&&e.translate(P.x1,P.y1)};Dc.getFontCache=function(e){var t;this.fontCaches=this.fontCaches||[];for(var r=0;r<this.fontCaches.length;r++)if(t=this.fontCaches[r],t.context===e)return t;return t={context:e},this.fontCaches.push(t),t};Dc.setupTextStyle=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,n=t.pstyle("font-style").strValue,a=t.pstyle("font-size").pfValue+"px",i=t.pstyle("font-family").strValue,u=t.pstyle("font-weight").strValue,s=r?t.effectiveOpacity()*t.pstyle("text-opacity").value:1,h=t.pstyle("text-outline-opacity").value*s,p=t.pstyle("color").value,g=t.pstyle("text-outline-color").value;e.font=n+" "+u+" "+a+" "+i,e.lineJoin="round",this.colorFillStyle(e,p[0],p[1],p[2],s),this.colorStrokeStyle(e,g[0],g[1],g[2],h)};function wq(e,t,r,n,a){var i=Math.min(n,a),u=i/2,s=t+n/2,h=r+a/2;e.beginPath(),e.arc(s,h,u,0,Math.PI*2),e.closePath()}function YI(e,t,r,n,a){var i=arguments.length>5&&arguments[5]!==void 0?arguments[5]:5,u=Math.min(i,n/2,a/2);e.beginPath(),e.moveTo(t+u,r),e.lineTo(t+n-u,r),e.quadraticCurveTo(t+n,r,t+n,r+u),e.lineTo(t+n,r+a-u),e.quadraticCurveTo(t+n,r+a,t+n-u,r+a),e.lineTo(t+u,r+a),e.quadraticCurveTo(t,r+a,t,r+a-u),e.lineTo(t,r+u),e.quadraticCurveTo(t,r,t+u,r),e.closePath()}Dc.getTextAngle=function(e,t){var r,n=e._private,a=n.rscratch,i=t?t+"-":"",u=e.pstyle(i+"text-rotation");if(u.strValue==="autorotate"){var s=yi(a,"labelAngle",t);r=e.isEdge()?s:0}else u.strValue==="none"?r=0:r=u.pfValue;return r};Dc.drawText=function(e,t,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,i=t._private,u=i.rscratch,s=a?t.effectiveOpacity():1;if(!(a&&(s===0||t.pstyle("text-opacity").value===0))){r==="main"&&(r=null);var h=yi(u,"labelX",r),p=yi(u,"labelY",r),g,v,x=this.getLabelText(t,r);if(x!=null&&x!==""&&!isNaN(h)&&!isNaN(p)){this.setupTextStyle(e,t,a);var S=r?r+"-":"",P=yi(u,"labelWidth",r),N=yi(u,"labelHeight",r),M=t.pstyle(S+"text-margin-x").pfValue,I=t.pstyle(S+"text-margin-y").pfValue,A=t.isEdge(),D=t.pstyle("text-halign").value,j=t.pstyle("text-valign").value;A&&(D="center",j="center"),h+=M,p+=I;var V;switch(n?V=this.getTextAngle(t,r):V=0,V!==0&&(g=h,v=p,e.translate(g,v),e.rotate(V),h=0,p=0),j){case"top":break;case"center":p+=N/2;break;case"bottom":p+=N;break}var U=t.pstyle("text-background-opacity").value,$=t.pstyle("text-border-opacity").value,W=t.pstyle("text-border-width").pfValue,X=t.pstyle("text-background-padding").pfValue,J=t.pstyle("text-background-shape").strValue,Z=J==="round-rectangle"||J==="roundrectangle",K=J==="circle",Y=2;if(U>0||W>0&&$>0){var G=e.fillStyle,oe=e.strokeStyle,ie=e.lineWidth,ce=t.pstyle("text-background-color").value,fe=t.pstyle("text-border-color").value,de=t.pstyle("text-border-style").value,be=U>0,ge=W>0&&$>0,xe=h-X;switch(D){case"left":xe-=P;break;case"center":xe-=P/2;break}var Le=p-N-X,Oe=P+2*X,Fe=N+2*X;if(be&&(e.fillStyle="rgba(".concat(ce[0],",").concat(ce[1],",").concat(ce[2],",").concat(U*s,")")),ge&&(e.strokeStyle="rgba(".concat(fe[0],",").concat(fe[1],",").concat(fe[2],",").concat($*s,")"),e.lineWidth=W,e.setLineDash))switch(de){case"dotted":e.setLineDash([1,1]);break;case"dashed":e.setLineDash([4,2]);break;case"double":e.lineWidth=W/4,e.setLineDash([]);break;case"solid":default:e.setLineDash([]);break}if(Z?(e.beginPath(),YI(e,xe,Le,Oe,Fe,Y)):K?(e.beginPath(),wq(e,xe,Le,Oe,Fe)):(e.beginPath(),e.rect(xe,Le,Oe,Fe)),be&&e.fill(),ge&&e.stroke(),ge&&de==="double"){var et=W/2;e.beginPath(),Z?YI(e,xe+et,Le+et,Oe-2*et,Fe-2*et,Y):e.rect(xe+et,Le+et,Oe-2*et,Fe-2*et),e.stroke()}e.fillStyle=G,e.strokeStyle=oe,e.lineWidth=ie,e.setLineDash&&e.setLineDash([])}var nt=2*t.pstyle("text-outline-width").pfValue;if(nt>0&&(e.lineWidth=nt),t.pstyle("text-wrap").value==="wrap"){var mt=yi(u,"labelWrapCachedLines",r),it=yi(u,"labelLineHeight",r),ze=P/2,He=this.getLabelJustification(t);switch(He==="auto"||(D==="left"?He==="left"?h+=-P:He==="center"&&(h+=-ze):D==="center"?He==="left"?h+=-ze:He==="right"&&(h+=ze):D==="right"&&(He==="center"?h+=ze:He==="right"&&(h+=P))),j){case"top":p-=(mt.length-1)*it;break;case"center":case"bottom":p-=(mt.length-1)*it;break}for(var We=0;We<mt.length;We++)nt>0&&e.strokeText(mt[We],h,p),e.fillText(mt[We],h,p),p+=it}else nt>0&&e.strokeText(x,h,p),e.fillText(x,h,p);V!==0&&(e.rotate(-V),e.translate(-g,-v))}}};var vu={};vu.drawNode=function(e,t,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,i=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,u=this,s,h,p=t._private,g=p.rscratch,v=t.position();if(!(!Ht(v.x)||!Ht(v.y))&&!(i&&!t.visible())){var x=i?t.effectiveOpacity():1,S=u.usePaths(),P,N=!1,M=t.padding();s=t.width()+2*M,h=t.height()+2*M;var I;r&&(I=r,e.translate(-I.x1,-I.y1));for(var A=t.pstyle("background-image"),D=A.value,j=new Array(D.length),V=new Array(D.length),U=0,$=0;$<D.length;$++){var W=D[$],X=j[$]=W!=null&&W!=="none";if(X){var J=t.cy().style().getIndexedStyle(t,"background-image-crossorigin","value",$);U++,V[$]=u.getCachedImage(W,J,function(){p.backgroundTimestamp=Date.now(),t.emitAndNotify("background")})}}var Z=t.pstyle("background-blacken").value,K=t.pstyle("border-width").pfValue,Y=t.pstyle("background-opacity").value*x,G=t.pstyle("border-color").value,oe=t.pstyle("border-style").value,ie=t.pstyle("border-join").value,ce=t.pstyle("border-cap").value,fe=t.pstyle("border-position").value,de=t.pstyle("border-dash-pattern").pfValue,be=t.pstyle("border-dash-offset").pfValue,ge=t.pstyle("border-opacity").value*x,xe=t.pstyle("outline-width").pfValue,Le=t.pstyle("outline-color").value,Oe=t.pstyle("outline-style").value,Fe=t.pstyle("outline-opacity").value*x,et=t.pstyle("outline-offset").value,nt=t.pstyle("corner-radius").value;nt!=="auto"&&(nt=t.pstyle("corner-radius").pfValue);var mt=function(){var kt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Y;u.eleFillStyle(e,t,kt)},it=function(){var kt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ge;u.colorStrokeStyle(e,G[0],G[1],G[2],kt)},ze=function(){var kt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Fe;u.colorStrokeStyle(e,Le[0],Le[1],Le[2],kt)},He=function(kt,dt,le,Be){var qe=u.nodePathCache=u.nodePathCache||[],st=hz(le==="polygon"?le+","+Be.join(","):le,""+dt,""+kt,""+nt),ut=qe[st],vt,gt=!1;return ut!=null?(vt=ut,gt=!0,g.pathCache=vt):(vt=new Path2D,qe[st]=g.pathCache=vt),{path:vt,cacheHit:gt}},We=t.pstyle("shape").strValue,ot=t.pstyle("shape-polygon-points").pfValue;if(S){e.translate(v.x,v.y);var xt=He(s,h,We,ot);P=xt.path,N=xt.cacheHit}var Tt=function(){if(!N){var kt=v;S&&(kt={x:0,y:0}),u.nodeShapes[u.getNodeShape(t)].draw(P||e,kt.x,kt.y,s,h,nt,g)}S?e.fill(P):e.fill()},$e=function(){for(var kt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:x,dt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,le=p.backgrounding,Be=0,qe=0;qe<V.length;qe++){var st=t.cy().style().getIndexedStyle(t,"background-image-containment","value",qe);if(dt&&st==="over"||!dt&&st==="inside"){Be++;continue}j[qe]&&V[qe].complete&&!V[qe].error&&(Be++,u.drawInscribedImage(e,V[qe],t,qe,kt))}p.backgrounding=Be!==U,le!==p.backgrounding&&t.updateStyle(!1)},Xe=function(){var kt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,dt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:x;u.hasPie(t)&&(u.drawPie(e,t,dt),kt&&(S||u.nodeShapes[u.getNodeShape(t)].draw(e,v.x,v.y,s,h,nt,g)))},Pe=function(){var kt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,dt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:x;u.hasStripe(t)&&(e.save(),S?e.clip(g.pathCache):(u.nodeShapes[u.getNodeShape(t)].draw(e,v.x,v.y,s,h,nt,g),e.clip()),u.drawStripe(e,t,dt),e.restore(),kt&&(S||u.nodeShapes[u.getNodeShape(t)].draw(e,v.x,v.y,s,h,nt,g)))},Ye=function(){var kt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:x,dt=(Z>0?Z:-Z)*kt,le=Z>0?0:255;Z!==0&&(u.colorFillStyle(e,le,le,le,dt),S?e.fill(P):e.fill())},at=function(){if(K>0){if(e.lineWidth=K,e.lineCap=ce,e.lineJoin=ie,e.setLineDash)switch(oe){case"dotted":e.setLineDash([1,1]);break;case"dashed":e.setLineDash(de),e.lineDashOffset=be;break;case"solid":case"double":e.setLineDash([]);break}if(fe!=="center"){if(e.save(),e.lineWidth*=2,fe==="inside")S?e.clip(P):e.clip();else{var kt=new Path2D;kt.rect(-s/2-K,-h/2-K,s+2*K,h+2*K),kt.addPath(P),e.clip(kt,"evenodd")}S?e.stroke(P):e.stroke(),e.restore()}else S?e.stroke(P):e.stroke();if(oe==="double"){e.lineWidth=K/3;var dt=e.globalCompositeOperation;e.globalCompositeOperation="destination-out",S?e.stroke(P):e.stroke(),e.globalCompositeOperation=dt}e.setLineDash&&e.setLineDash([])}},bt=function(){if(xe>0){if(e.lineWidth=xe,e.lineCap="butt",e.setLineDash)switch(Oe){case"dotted":e.setLineDash([1,1]);break;case"dashed":e.setLineDash([4,2]);break;case"solid":case"double":e.setLineDash([]);break}var kt=v;S&&(kt={x:0,y:0});var dt=u.getNodeShape(t),le=K;fe==="inside"&&(le=0),fe==="outside"&&(le*=2);var Be=(s+le+(xe+et))/s,qe=(h+le+(xe+et))/h,st=s*Be,ut=h*qe,vt=u.nodeShapes[dt].points,gt;if(S){var Ut=He(st,ut,dt,vt);gt=Ut.path}if(dt==="ellipse")u.drawEllipsePath(gt||e,kt.x,kt.y,st,ut);else if(["round-diamond","round-heptagon","round-hexagon","round-octagon","round-pentagon","round-polygon","round-triangle","round-tag"].includes(dt)){var Ot=0,Kt=0,we=0;dt==="round-diamond"?Ot=(le+et+xe)*1.4:dt==="round-heptagon"?(Ot=(le+et+xe)*1.075,we=-(le/2+et+xe)/35):dt==="round-hexagon"?Ot=(le+et+xe)*1.12:dt==="round-pentagon"?(Ot=(le+et+xe)*1.13,we=-(le/2+et+xe)/15):dt==="round-tag"?(Ot=(le+et+xe)*1.12,Kt=(le/2+xe+et)*.07):dt==="round-triangle"&&(Ot=(le+et+xe)*(Math.PI/2),we=-(le+et/2+xe)/Math.PI),Ot!==0&&(Be=(s+Ot)/s,st=s*Be,["round-hexagon","round-tag"].includes(dt)||(qe=(h+Ot)/h,ut=h*qe)),nt=nt==="auto"?wz(st,ut):nt;for(var ne=st/2,re=ut/2,pe=nt+(le+xe+et)/2,_e=new Array(vt.length/2),Ne=new Array(vt.length/2),De=0;De<vt.length/2;De++)_e[De]={x:kt.x+Kt+ne*vt[De*2],y:kt.y+we+re*vt[De*2+1]};var Ue,Te,rt,ht,Qe=_e.length;for(Te=_e[Qe-1],Ue=0;Ue<Qe;Ue++)rt=_e[Ue%Qe],ht=_e[(Ue+1)%Qe],Ne[Ue]=iE(Te,rt,ht,pe),Te=rt,rt=ht;u.drawRoundPolygonPath(gt||e,kt.x+Kt,kt.y+we,s*Be,h*qe,vt,Ne)}else if(["roundrectangle","round-rectangle"].includes(dt))nt=nt==="auto"?ou(st,ut):nt,u.drawRoundRectanglePath(gt||e,kt.x,kt.y,st,ut,nt+(le+xe+et)/2);else if(["cutrectangle","cut-rectangle"].includes(dt))nt=nt==="auto"?ZS():nt,u.drawCutRectanglePath(gt||e,kt.x,kt.y,st,ut,null,nt+(le+xe+et)/4);else if(["bottomroundrectangle","bottom-round-rectangle"].includes(dt))nt=nt==="auto"?ou(st,ut):nt,u.drawBottomRoundRectanglePath(gt||e,kt.x,kt.y,st,ut,nt+(le+xe+et)/2);else if(dt==="barrel")u.drawBarrelPath(gt||e,kt.x,kt.y,st,ut);else if(dt.startsWith("polygon")||["rhomboid","right-rhomboid","round-tag","tag","vee"].includes(dt)){var wt=(le+xe+et)/s;vt=r0(n0(vt,wt)),u.drawPolygonPath(gt||e,kt.x,kt.y,s,h,vt)}else{var At=(le+xe+et)/s;vt=r0(n0(vt,-At)),u.drawPolygonPath(gt||e,kt.x,kt.y,s,h,vt)}if(S?e.stroke(gt):e.stroke(),Oe==="double"){e.lineWidth=le/3;var Ft=e.globalCompositeOperation;e.globalCompositeOperation="destination-out",S?e.stroke(gt):e.stroke(),e.globalCompositeOperation=Ft}e.setLineDash&&e.setLineDash([])}},Et=function(){a&&u.drawNodeOverlay(e,t,v,s,h)},Vt=function(){a&&u.drawNodeUnderlay(e,t,v,s,h)},Bt=function(){u.drawElementText(e,t,null,n)},Mt=t.pstyle("ghost").value==="yes";if(Mt){var cr=t.pstyle("ghost-offset-x").pfValue,ar=t.pstyle("ghost-offset-y").pfValue,ft=t.pstyle("ghost-opacity").value,fr=ft*x;e.translate(cr,ar),ze(),bt(),mt(ft*Y),Tt(),$e(fr,!0),it(ft*ge),at(),Xe(Z!==0||K!==0),Pe(Z!==0||K!==0),$e(fr,!1),Ye(fr),e.translate(-cr,-ar)}S&&e.translate(-v.x,-v.y),Vt(),S&&e.translate(v.x,v.y),ze(),bt(),mt(),Tt(),$e(x,!0),it(),at(),Xe(Z!==0||K!==0),Pe(Z!==0||K!==0),$e(x,!1),Ye(),S&&e.translate(-v.x,-v.y),Bt(),Et(),r&&e.translate(I.x1,I.y1)}};var PR=function(t){if(!["overlay","underlay"].includes(t))throw new Error("Invalid state");return function(r,n,a,i,u){var s=this;if(n.visible()){var h=n.pstyle("".concat(t,"-padding")).pfValue,p=n.pstyle("".concat(t,"-opacity")).value,g=n.pstyle("".concat(t,"-color")).value,v=n.pstyle("".concat(t,"-shape")).value,x=n.pstyle("".concat(t,"-corner-radius")).value;if(p>0){if(a=a||n.position(),i==null||u==null){var S=n.padding();i=n.width()+2*S,u=n.height()+2*S}s.colorFillStyle(r,g[0],g[1],g[2],p),s.nodeShapes[v].draw(r,a.x,a.y,i+h*2,u+h*2,x),r.fill()}}}};vu.drawNodeOverlay=PR("overlay");vu.drawNodeUnderlay=PR("underlay");vu.hasPie=function(e){return e=e[0],e._private.hasPie};vu.hasStripe=function(e){return e=e[0],e._private.hasStripe};vu.drawPie=function(e,t,r,n){t=t[0],n=n||t.position();var a=t.cy().style(),i=t.pstyle("pie-size"),u=t.pstyle("pie-hole"),s=t.pstyle("pie-start-angle").pfValue,h=n.x,p=n.y,g=t.width(),v=t.height(),x=Math.min(g,v)/2,S,P=0,N=this.usePaths();if(N&&(h=0,p=0),i.units==="%"?x=x*i.pfValue:i.pfValue!==void 0&&(x=i.pfValue/2),u.units==="%"?S=x*u.pfValue:u.pfValue!==void 0&&(S=u.pfValue/2),!(S>=x))for(var M=1;M<=a.pieBackgroundN;M++){var I=t.pstyle("pie-"+M+"-background-size").value,A=t.pstyle("pie-"+M+"-background-color").value,D=t.pstyle("pie-"+M+"-background-opacity").value*r,j=I/100;j+P>1&&(j=1-P);var V=1.5*Math.PI+2*Math.PI*P;V+=s;var U=2*Math.PI*j,$=V+U;I===0||P>=1||P+j>1||(S===0?(e.beginPath(),e.moveTo(h,p),e.arc(h,p,x,V,$),e.closePath()):(e.beginPath(),e.arc(h,p,x,V,$),e.arc(h,p,S,$,V,!0),e.closePath()),this.colorFillStyle(e,A[0],A[1],A[2],D),e.fill(),P+=j)}};vu.drawStripe=function(e,t,r,n){t=t[0],n=n||t.position();var a=t.cy().style(),i=n.x,u=n.y,s=t.width(),h=t.height(),p=0,g=this.usePaths();e.save();var v=t.pstyle("stripe-direction").value,x=t.pstyle("stripe-size");switch(v){case"vertical":break;case"righward":e.rotate(-Math.PI/2);break}var S=s,P=h;x.units==="%"?(S=S*x.pfValue,P=P*x.pfValue):x.pfValue!==void 0&&(S=x.pfValue,P=x.pfValue),g&&(i=0,u=0),u-=S/2,i-=P/2;for(var N=1;N<=a.stripeBackgroundN;N++){var M=t.pstyle("stripe-"+N+"-background-size").value,I=t.pstyle("stripe-"+N+"-background-color").value,A=t.pstyle("stripe-"+N+"-background-opacity").value*r,D=M/100;D+p>1&&(D=1-p),!(M===0||p>=1||p+D>1)&&(e.beginPath(),e.rect(i,u+P*p,S,P*D),e.closePath(),this.colorFillStyle(e,I[0],I[1],I[2],A),e.fill(),p+=D)}e.restore()};var si={},Sq=100;si.getPixelRatio=function(){var e=this.data.contexts[0];if(this.forcedPixelRatio!=null)return this.forcedPixelRatio;var t=this.cy.window(),r=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return(t.devicePixelRatio||1)/r};si.paintCache=function(e){for(var t=this.paintCaches=this.paintCaches||[],r=!0,n,a=0;a<t.length;a++)if(n=t[a],n.context===e){r=!1;break}return r&&(n={context:e},t.push(n)),n};si.createGradientStyleFor=function(e,t,r,n,a){var i,u=this.usePaths(),s=r.pstyle(t+"-gradient-stop-colors").value,h=r.pstyle(t+"-gradient-stop-positions").pfValue;if(n==="radial-gradient")if(r.isEdge()){var p=r.sourceEndpoint(),g=r.targetEndpoint(),v=r.midpoint(),x=_c(p,v),S=_c(g,v);i=e.createRadialGradient(v.x,v.y,0,v.x,v.y,Math.max(x,S))}else{var P=u?{x:0,y:0}:r.position(),N=r.paddedWidth(),M=r.paddedHeight();i=e.createRadialGradient(P.x,P.y,0,P.x,P.y,Math.max(N,M))}else if(r.isEdge()){var I=r.sourceEndpoint(),A=r.targetEndpoint();i=e.createLinearGradient(I.x,I.y,A.x,A.y)}else{var D=u?{x:0,y:0}:r.position(),j=r.paddedWidth(),V=r.paddedHeight(),U=j/2,$=V/2,W=r.pstyle("background-gradient-direction").value;switch(W){case"to-bottom":i=e.createLinearGradient(D.x,D.y-$,D.x,D.y+$);break;case"to-top":i=e.createLinearGradient(D.x,D.y+$,D.x,D.y-$);break;case"to-left":i=e.createLinearGradient(D.x+U,D.y,D.x-U,D.y);break;case"to-right":i=e.createLinearGradient(D.x-U,D.y,D.x+U,D.y);break;case"to-bottom-right":case"to-right-bottom":i=e.createLinearGradient(D.x-U,D.y-$,D.x+U,D.y+$);break;case"to-top-right":case"to-right-top":i=e.createLinearGradient(D.x-U,D.y+$,D.x+U,D.y-$);break;case"to-bottom-left":case"to-left-bottom":i=e.createLinearGradient(D.x+U,D.y-$,D.x-U,D.y+$);break;case"to-top-left":case"to-left-top":i=e.createLinearGradient(D.x+U,D.y+$,D.x-U,D.y-$);break}}if(!i)return null;for(var X=h.length===s.length,J=s.length,Z=0;Z<J;Z++)i.addColorStop(X?h[Z]:Z/(J-1),"rgba("+s[Z][0]+","+s[Z][1]+","+s[Z][2]+","+a+")");return i};si.gradientFillStyle=function(e,t,r,n){var a=this.createGradientStyleFor(e,"background",t,r,n);if(!a)return null;e.fillStyle=a};si.colorFillStyle=function(e,t,r,n,a){e.fillStyle="rgba("+t+","+r+","+n+","+a+")"};si.eleFillStyle=function(e,t,r){var n=t.pstyle("background-fill").value;if(n==="linear-gradient"||n==="radial-gradient")this.gradientFillStyle(e,t,n,r);else{var a=t.pstyle("background-color").value;this.colorFillStyle(e,a[0],a[1],a[2],r)}};si.gradientStrokeStyle=function(e,t,r,n){var a=this.createGradientStyleFor(e,"line",t,r,n);if(!a)return null;e.strokeStyle=a};si.colorStrokeStyle=function(e,t,r,n,a){e.strokeStyle="rgba("+t+","+r+","+n+","+a+")"};si.eleStrokeStyle=function(e,t,r){var n=t.pstyle("line-fill").value;if(n==="linear-gradient"||n==="radial-gradient")this.gradientStrokeStyle(e,t,n,r);else{var a=t.pstyle("line-color").value;this.colorStrokeStyle(e,a[0],a[1],a[2],r)}};si.matchCanvasSize=function(e){var t=this,r=t.data,n=t.findContainerClientCoords(),a=n[2],i=n[3],u=t.getPixelRatio(),s=t.motionBlurPxRatio;(e===t.data.bufferCanvases[t.MOTIONBLUR_BUFFER_NODE]||e===t.data.bufferCanvases[t.MOTIONBLUR_BUFFER_DRAG])&&(u=s);var h=a*u,p=i*u,g;if(!(h===t.canvasWidth&&p===t.canvasHeight)){t.fontCaches=null;var v=r.canvasContainer;v.style.width=a+"px",v.style.height=i+"px";for(var x=0;x<t.CANVAS_LAYERS;x++)g=r.canvases[x],g.width=h,g.height=p,g.style.width=a+"px",g.style.height=i+"px";for(var x=0;x<t.BUFFER_COUNT;x++)g=r.bufferCanvases[x],g.width=h,g.height=p,g.style.width=a+"px",g.style.height=i+"px";t.textureMult=1,u<=1&&(g=r.bufferCanvases[t.TEXTURE_BUFFER],t.textureMult=2,g.width=h*t.textureMult,g.height=p*t.textureMult),t.canvasWidth=h,t.canvasHeight=p,t.pixelRatio=u}};si.renderTo=function(e,t,r,n){this.render({forcedContext:e,forcedZoom:t,forcedPan:r,drawAllLayers:!0,forcedPxRatio:n})};si.clearCanvas=function(){var e=this,t=e.data;function r(n){n.clearRect(0,0,e.canvasWidth,e.canvasHeight)}r(t.contexts[e.NODE]),r(t.contexts[e.DRAG])};si.render=function(e){var t=this;e=e||gz();var r=t.cy,n=e.forcedContext,a=e.drawAllLayers,i=e.drawOnlyNodeLayer,u=e.forcedZoom,s=e.forcedPan,h=e.forcedPxRatio===void 0?this.getPixelRatio():e.forcedPxRatio,p=t.data,g=p.canvasNeedsRedraw,v=t.textureOnViewport&&!n&&(t.pinching||t.hoverData.dragging||t.swipePanning||t.data.wheelZooming),x=e.motionBlur!==void 0?e.motionBlur:t.motionBlur,S=t.motionBlurPxRatio,P=r.hasCompoundNodes(),N=t.hoverData.draggingEles,M=!!(t.hoverData.selecting||t.touchData.selecting);x=x&&!n&&t.motionBlurEnabled&&!M;var I=x;n||(t.prevPxRatio!==h&&(t.invalidateContainerClientCoordsCache(),t.matchCanvasSize(t.container),t.redrawHint("eles",!0),t.redrawHint("drag",!0)),t.prevPxRatio=h),!n&&t.motionBlurTimeout&&clearTimeout(t.motionBlurTimeout),x&&(t.mbFrames==null&&(t.mbFrames=0),t.mbFrames++,t.mbFrames<3&&(I=!1),t.mbFrames>t.minMbLowQualFrames&&(t.motionBlurPxRatio=t.mbPxRBlurry)),t.clearingMotionBlur&&(t.motionBlurPxRatio=1),t.textureDrawLastFrame&&!v&&(g[t.NODE]=!0,g[t.SELECT_BOX]=!0);var A=r.style(),D=r.zoom(),j=u!==void 0?u:D,V=r.pan(),U={x:V.x,y:V.y},$={zoom:D,pan:{x:V.x,y:V.y}},W=t.prevViewport,X=W===void 0||$.zoom!==W.zoom||$.pan.x!==W.pan.x||$.pan.y!==W.pan.y;!X&&!(N&&!P)&&(t.motionBlurPxRatio=1),s&&(U=s),j*=h,U.x*=h,U.y*=h;var J=t.getCachedZSortedEles();function Z(it,ze,He,We,ot){var xt=it.globalCompositeOperation;it.globalCompositeOperation="destination-out",t.colorFillStyle(it,255,255,255,t.motionBlurTransparency),it.fillRect(ze,He,We,ot),it.globalCompositeOperation=xt}function K(it,ze){var He,We,ot,xt;!t.clearingMotionBlur&&(it===p.bufferContexts[t.MOTIONBLUR_BUFFER_NODE]||it===p.bufferContexts[t.MOTIONBLUR_BUFFER_DRAG])?(He={x:V.x*S,y:V.y*S},We=D*S,ot=t.canvasWidth*S,xt=t.canvasHeight*S):(He=U,We=j,ot=t.canvasWidth,xt=t.canvasHeight),it.setTransform(1,0,0,1,0,0),ze==="motionBlur"?Z(it,0,0,ot,xt):!n&&(ze===void 0||ze)&&it.clearRect(0,0,ot,xt),a||(it.translate(He.x,He.y),it.scale(We,We)),s&&it.translate(s.x,s.y),u&&it.scale(u,u)}if(v||(t.textureDrawLastFrame=!1),v){if(t.textureDrawLastFrame=!0,!t.textureCache){t.textureCache={},t.textureCache.bb=r.mutableElements().boundingBox(),t.textureCache.texture=t.data.bufferCanvases[t.TEXTURE_BUFFER];var Y=t.data.bufferContexts[t.TEXTURE_BUFFER];Y.setTransform(1,0,0,1,0,0),Y.clearRect(0,0,t.canvasWidth*t.textureMult,t.canvasHeight*t.textureMult),t.render({forcedContext:Y,drawOnlyNodeLayer:!0,forcedPxRatio:h*t.textureMult});var $=t.textureCache.viewport={zoom:r.zoom(),pan:r.pan(),width:t.canvasWidth,height:t.canvasHeight};$.mpan={x:(0-$.pan.x)/$.zoom,y:(0-$.pan.y)/$.zoom}}g[t.DRAG]=!1,g[t.NODE]=!1;var G=p.contexts[t.NODE],oe=t.textureCache.texture,$=t.textureCache.viewport;G.setTransform(1,0,0,1,0,0),x?Z(G,0,0,$.width,$.height):G.clearRect(0,0,$.width,$.height);var ie=A.core("outside-texture-bg-color").value,ce=A.core("outside-texture-bg-opacity").value;t.colorFillStyle(G,ie[0],ie[1],ie[2],ce),G.fillRect(0,0,$.width,$.height);var D=r.zoom();K(G,!1),G.clearRect($.mpan.x,$.mpan.y,$.width/$.zoom/h,$.height/$.zoom/h),G.drawImage(oe,$.mpan.x,$.mpan.y,$.width/$.zoom/h,$.height/$.zoom/h)}else t.textureOnViewport&&!n&&(t.textureCache=null);var fe=r.extent(),de=t.pinching||t.hoverData.dragging||t.swipePanning||t.data.wheelZooming||t.hoverData.draggingEles||t.cy.animated(),be=t.hideEdgesOnViewport&&de,ge=[];if(ge[t.NODE]=!g[t.NODE]&&x&&!t.clearedForMotionBlur[t.NODE]||t.clearingMotionBlur,ge[t.NODE]&&(t.clearedForMotionBlur[t.NODE]=!0),ge[t.DRAG]=!g[t.DRAG]&&x&&!t.clearedForMotionBlur[t.DRAG]||t.clearingMotionBlur,ge[t.DRAG]&&(t.clearedForMotionBlur[t.DRAG]=!0),g[t.NODE]||a||i||ge[t.NODE]){var xe=x&&!ge[t.NODE]&&S!==1,G=n||(xe?t.data.bufferContexts[t.MOTIONBLUR_BUFFER_NODE]:p.contexts[t.NODE]),Le=x&&!xe?"motionBlur":void 0;K(G,Le),be?t.drawCachedNodes(G,J.nondrag,h,fe):t.drawLayeredElements(G,J.nondrag,h,fe),t.debug&&t.drawDebugPoints(G,J.nondrag),!a&&!x&&(g[t.NODE]=!1)}if(!i&&(g[t.DRAG]||a||ge[t.DRAG])){var xe=x&&!ge[t.DRAG]&&S!==1,G=n||(xe?t.data.bufferContexts[t.MOTIONBLUR_BUFFER_DRAG]:p.contexts[t.DRAG]);K(G,x&&!xe?"motionBlur":void 0),be?t.drawCachedNodes(G,J.drag,h,fe):t.drawCachedElements(G,J.drag,h,fe),t.debug&&t.drawDebugPoints(G,J.drag),!a&&!x&&(g[t.DRAG]=!1)}if(this.drawSelectionRectangle(e,K),x&&S!==1){var Oe=p.contexts[t.NODE],Fe=t.data.bufferCanvases[t.MOTIONBLUR_BUFFER_NODE],et=p.contexts[t.DRAG],nt=t.data.bufferCanvases[t.MOTIONBLUR_BUFFER_DRAG],mt=function(ze,He,We){ze.setTransform(1,0,0,1,0,0),We||!I?ze.clearRect(0,0,t.canvasWidth,t.canvasHeight):Z(ze,0,0,t.canvasWidth,t.canvasHeight);var ot=S;ze.drawImage(He,0,0,t.canvasWidth*ot,t.canvasHeight*ot,0,0,t.canvasWidth,t.canvasHeight)};(g[t.NODE]||ge[t.NODE])&&(mt(Oe,Fe,ge[t.NODE]),g[t.NODE]=!1),(g[t.DRAG]||ge[t.DRAG])&&(mt(et,nt,ge[t.DRAG]),g[t.DRAG]=!1)}t.prevViewport=$,t.clearingMotionBlur&&(t.clearingMotionBlur=!1,t.motionBlurCleared=!0,t.motionBlur=!0),x&&(t.motionBlurTimeout=setTimeout(function(){t.motionBlurTimeout=null,t.clearedForMotionBlur[t.NODE]=!1,t.clearedForMotionBlur[t.DRAG]=!1,t.motionBlur=!1,t.clearingMotionBlur=!v,t.mbFrames=0,g[t.NODE]=!0,g[t.DRAG]=!0,t.redraw()},Sq)),n||r.emit("render")};var hp;si.drawSelectionRectangle=function(e,t){var r=this,n=r.cy,a=r.data,i=n.style(),u=e.drawOnlyNodeLayer,s=e.drawAllLayers,h=a.canvasNeedsRedraw,p=e.forcedContext;if(r.showFps||!u&&h[r.SELECT_BOX]&&!s){var g=p||a.contexts[r.SELECT_BOX];if(t(g),r.selection[4]==1&&(r.hoverData.selecting||r.touchData.selecting)){var v=r.cy.zoom(),x=i.core("selection-box-border-width").value/v;g.lineWidth=x,g.fillStyle="rgba("+i.core("selection-box-color").value[0]+","+i.core("selection-box-color").value[1]+","+i.core("selection-box-color").value[2]+","+i.core("selection-box-opacity").value+")",g.fillRect(r.selection[0],r.selection[1],r.selection[2]-r.selection[0],r.selection[3]-r.selection[1]),x>0&&(g.strokeStyle="rgba("+i.core("selection-box-border-color").value[0]+","+i.core("selection-box-border-color").value[1]+","+i.core("selection-box-border-color").value[2]+","+i.core("selection-box-opacity").value+")",g.strokeRect(r.selection[0],r.selection[1],r.selection[2]-r.selection[0],r.selection[3]-r.selection[1]))}if(a.bgActivePosistion&&!r.hoverData.selecting){var v=r.cy.zoom(),S=a.bgActivePosistion;g.fillStyle="rgba("+i.core("active-bg-color").value[0]+","+i.core("active-bg-color").value[1]+","+i.core("active-bg-color").value[2]+","+i.core("active-bg-opacity").value+")",g.beginPath(),g.arc(S.x,S.y,i.core("active-bg-size").pfValue/v,0,2*Math.PI),g.fill()}var P=r.lastRedrawTime;if(r.showFps&&P){P=Math.round(P);var N=Math.round(1e3/P),M="1 frame = "+P+" ms = "+N+" fps";if(g.setTransform(1,0,0,1,0,0),g.fillStyle="rgba(255, 0, 0, 0.75)",g.strokeStyle="rgba(255, 0, 0, 0.75)",g.font="30px Arial",!hp){var I=g.measureText(M);hp=I.actualBoundingBoxAscent}g.fillText(M,0,hp);var A=60;g.strokeRect(0,hp+10,250,20),g.fillRect(0,hp+10,250*Math.min(N/A,1),20)}s||(h[r.SELECT_BOX]=!1)}};function JI(e,t,r){var n=e.createShader(t);if(e.shaderSource(n,r),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(n));return n}function Eq(e,t,r){var n=JI(e,e.VERTEX_SHADER,t),a=JI(e,e.FRAGMENT_SHADER,r),i=e.createProgram();if(e.attachShader(i,n),e.attachShader(i,a),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS))throw new Error("Could not initialize shaders");return i}function Cq(e,t,r){r===void 0&&(r=t);var n=e.makeOffscreenCanvas(t,r),a=n.context=n.getContext("2d");return n.clear=function(){return a.clearRect(0,0,n.width,n.height)},n.clear(),n}function lE(e){var t=e.pixelRatio,r=e.cy.zoom(),n=e.cy.pan();return{zoom:r*t,pan:{x:n.x*t,y:n.y*t}}}function kq(e){var t=e.pixelRatio,r=e.cy.zoom();return r*t}function Tq(e,t,r,n,a){var i=n*r+t.x,u=a*r+t.y;return u=Math.round(e.canvasHeight-u),[i,u]}function Pq(e){return e.pstyle("background-fill").value!=="solid"||e.pstyle("background-image").strValue!=="none"?!1:e.pstyle("border-width").value===0||e.pstyle("border-opacity").value===0?!0:e.pstyle("border-style").value==="solid"}function Iq(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function Wu(e,t,r){var n=e[0]/255,a=e[1]/255,i=e[2]/255,u=t,s=r||new Array(4);return s[0]=n*u,s[1]=a*u,s[2]=i*u,s[3]=u,s}function Rd(e,t){var r=t||new Array(4);return r[0]=(e>>0&255)/255,r[1]=(e>>8&255)/255,r[2]=(e>>16&255)/255,r[3]=(e>>24&255)/255,r}function Aq(e){return e[0]+(e[1]<<8)+(e[2]<<16)+(e[3]<<24)}function Nq(e,t){var r=e.createTexture();return r.buffer=function(n){e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_NEAREST),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),e.generateMipmap(e.TEXTURE_2D),e.bindTexture(e.TEXTURE_2D,null)},r.deleteTexture=function(){e.deleteTexture(r)},r}function IR(e,t){switch(t){case"float":return[1,e.FLOAT,4];case"vec2":return[2,e.FLOAT,4];case"vec3":return[3,e.FLOAT,4];case"vec4":return[4,e.FLOAT,4];case"int":return[1,e.INT,4];case"ivec2":return[2,e.INT,4]}}function AR(e,t,r){switch(t){case e.FLOAT:return new Float32Array(r);case e.INT:return new Int32Array(r)}}function Mq(e,t,r,n,a,i){switch(t){case e.FLOAT:return new Float32Array(r.buffer,i*n,a);case e.INT:return new Int32Array(r.buffer,i*n,a)}}function Dq(e,t,r,n){var a=IR(e,t),i=Hn(a,2),u=i[0],s=i[1],h=AR(e,s,n),p=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,p),e.bufferData(e.ARRAY_BUFFER,h,e.STATIC_DRAW),s===e.FLOAT?e.vertexAttribPointer(r,u,s,!1,0,0):s===e.INT&&e.vertexAttribIPointer(r,u,s,0,0),e.enableVertexAttribArray(r),e.bindBuffer(e.ARRAY_BUFFER,null),p}function Ks(e,t,r,n){var a=IR(e,r),i=Hn(a,3),u=i[0],s=i[1],h=i[2],p=AR(e,s,t*u),g=u*h,v=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,v),e.bufferData(e.ARRAY_BUFFER,t*g,e.DYNAMIC_DRAW),e.enableVertexAttribArray(n),s===e.FLOAT?e.vertexAttribPointer(n,u,s,!1,g,0):s===e.INT&&e.vertexAttribIPointer(n,u,s,g,0),e.vertexAttribDivisor(n,1),e.bindBuffer(e.ARRAY_BUFFER,null);for(var x=new Array(t),S=0;S<t;S++)x[S]=Mq(e,s,p,g,u,S);return v.dataArray=p,v.stride=g,v.size=u,v.getView=function(P){return x[P]},v.setPoint=function(P,N,M){var I=x[P];I[0]=N,I[1]=M},v.bufferSubData=function(P){e.bindBuffer(e.ARRAY_BUFFER,v),P?e.bufferSubData(e.ARRAY_BUFFER,0,p,0,P*u):e.bufferSubData(e.ARRAY_BUFFER,0,p)},v}function zq(e,t,r){for(var n=9,a=new Float32Array(t*n),i=new Array(t),u=0;u<t;u++){var s=u*n*4;i[u]=new Float32Array(a.buffer,s,n)}var h=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,h),e.bufferData(e.ARRAY_BUFFER,a.byteLength,e.DYNAMIC_DRAW);for(var p=0;p<3;p++){var g=r+p;e.enableVertexAttribArray(g),e.vertexAttribPointer(g,3,e.FLOAT,!1,3*12,p*12),e.vertexAttribDivisor(g,1)}return e.bindBuffer(e.ARRAY_BUFFER,null),h.getMatrixView=function(v){return i[v]},h.setData=function(v,x){i[x].set(v,0)},h.bufferSubData=function(){e.bindBuffer(e.ARRAY_BUFFER,h),e.bufferSubData(e.ARRAY_BUFFER,0,a)},h}function Rq(e){var t=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,t);var r=e.createTexture();return e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0),e.bindFramebuffer(e.FRAMEBUFFER,null),t.setFramebufferAttachmentSizes=function(n,a){e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n,a,0,e.RGBA,e.UNSIGNED_BYTE,null)},t}var QI=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function Nw(){var e=new QI(9);return QI!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function eA(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Lq(e,t,r){var n=t[0],a=t[1],i=t[2],u=t[3],s=t[4],h=t[5],p=t[6],g=t[7],v=t[8],x=r[0],S=r[1],P=r[2],N=r[3],M=r[4],I=r[5],A=r[6],D=r[7],j=r[8];return e[0]=x*n+S*u+P*p,e[1]=x*a+S*s+P*g,e[2]=x*i+S*h+P*v,e[3]=N*n+M*u+I*p,e[4]=N*a+M*s+I*g,e[5]=N*i+M*h+I*v,e[6]=A*n+D*u+j*p,e[7]=A*a+D*s+j*g,e[8]=A*i+D*h+j*v,e}function by(e,t,r){var n=t[0],a=t[1],i=t[2],u=t[3],s=t[4],h=t[5],p=t[6],g=t[7],v=t[8],x=r[0],S=r[1];return e[0]=n,e[1]=a,e[2]=i,e[3]=u,e[4]=s,e[5]=h,e[6]=x*n+S*u+p,e[7]=x*a+S*s+g,e[8]=x*i+S*h+v,e}function tA(e,t,r){var n=t[0],a=t[1],i=t[2],u=t[3],s=t[4],h=t[5],p=t[6],g=t[7],v=t[8],x=Math.sin(r),S=Math.cos(r);return e[0]=S*n+x*u,e[1]=S*a+x*s,e[2]=S*i+x*h,e[3]=S*u-x*n,e[4]=S*s-x*a,e[5]=S*h-x*i,e[6]=p,e[7]=g,e[8]=v,e}function f2(e,t,r){var n=r[0],a=r[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=a*t[3],e[4]=a*t[4],e[5]=a*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Bq(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}var jq=function(){function e(t,r,n,a){pu(this,e),this.debugID=Math.floor(Math.random()*1e4),this.r=t,this.texSize=r,this.texRows=n,this.texHeight=Math.floor(r/n),this.enableWrapping=!0,this.locked=!1,this.texture=null,this.needsBuffer=!0,this.freePointer={x:0,row:0},this.keyToLocation=new Map,this.canvas=a(t,r,r),this.scratch=a(t,r,this.texHeight,"scratch")}return mu(e,[{key:"lock",value:function(){this.locked=!0}},{key:"getKeys",value:function(){return new Set(this.keyToLocation.keys())}},{key:"getScale",value:function(r){var n=r.w,a=r.h,i=this.texHeight,u=this.texSize,s=i/a,h=n*s,p=a*s;return h>u&&(s=u/n,h=n*s,p=a*s),{scale:s,texW:h,texH:p}}},{key:"draw",value:function(r,n,a){var i=this;if(this.locked)throw new Error("can't draw, atlas is locked");var u=this.texSize,s=this.texRows,h=this.texHeight,p=this.getScale(n),g=p.scale,v=p.texW,x=p.texH,S=function(D,j){if(a&&j){var V=j.context,U=D.x,$=D.row,W=U,X=h*$;V.save(),V.translate(W,X),V.scale(g,g),a(V,n),V.restore()}},P=[null,null],N=function(){S(i.freePointer,i.canvas),P[0]={x:i.freePointer.x,y:i.freePointer.row*h,w:v,h:x},P[1]={x:i.freePointer.x+v,y:i.freePointer.row*h,w:0,h:x},i.freePointer.x+=v,i.freePointer.x==u&&(i.freePointer.x=0,i.freePointer.row++)},M=function(){var D=i.scratch,j=i.canvas;D.clear(),S({x:0,row:0},D);var V=u-i.freePointer.x,U=v-V,$=h;{var W=i.freePointer.x,X=i.freePointer.row*h,J=V;j.context.drawImage(D,0,0,J,$,W,X,J,$),P[0]={x:W,y:X,w:J,h:x}}{var Z=V,K=(i.freePointer.row+1)*h,Y=U;j&&j.context.drawImage(D,Z,0,Y,$,0,K,Y,$),P[1]={x:0,y:K,w:Y,h:x}}i.freePointer.x=U,i.freePointer.row++},I=function(){i.freePointer.x=0,i.freePointer.row++};if(this.freePointer.x+v<=u)N();else{if(this.freePointer.row>=s-1)return!1;this.freePointer.x===u?(I(),N()):this.enableWrapping?M():(I(),N())}return this.keyToLocation.set(r,P),this.needsBuffer=!0,P}},{key:"getOffsets",value:function(r){return this.keyToLocation.get(r)}},{key:"isEmpty",value:function(){return this.freePointer.x===0&&this.freePointer.row===0}},{key:"canFit",value:function(r){if(this.locked)return!1;var n=this.texSize,a=this.texRows,i=this.getScale(r),u=i.texW;return this.freePointer.x+u>n?this.freePointer.row<a-1:!0}},{key:"bufferIfNeeded",value:function(r){this.texture||(this.texture=Nq(r,this.debugID)),this.needsBuffer&&(this.texture.buffer(this.canvas),this.needsBuffer=!1,this.locked&&(this.canvas=null,this.scratch=null))}},{key:"dispose",value:function(){this.texture&&(this.texture.deleteTexture(),this.texture=null),this.canvas=null,this.scratch=null,this.locked=!0}}])}(),Oq=function(){function e(t,r,n,a){pu(this,e),this.r=t,this.texSize=r,this.texRows=n,this.createTextureCanvas=a,this.atlases=[],this.styleKeyToAtlas=new Map,this.markedKeys=new Set}return mu(e,[{key:"getKeys",value:function(){return new Set(this.styleKeyToAtlas.keys())}},{key:"_createAtlas",value:function(){var r=this.r,n=this.texSize,a=this.texRows,i=this.createTextureCanvas;return new jq(r,n,a,i)}},{key:"_getScratchCanvas",value:function(){if(!this.scratch){var r=this.r,n=this.texSize,a=this.texRows,i=this.createTextureCanvas,u=Math.floor(n/a);this.scratch=i(r,n,u,"scratch")}return this.scratch}},{key:"draw",value:function(r,n,a){var i=this.styleKeyToAtlas.get(r);return i||(i=this.atlases[this.atlases.length-1],(!i||!i.canFit(n))&&(i&&i.lock(),i=this._createAtlas(),this.atlases.push(i)),i.draw(r,n,a),this.styleKeyToAtlas.set(r,i)),i}},{key:"getAtlas",value:function(r){return this.styleKeyToAtlas.get(r)}},{key:"hasAtlas",value:function(r){return this.styleKeyToAtlas.has(r)}},{key:"markKeyForGC",value:function(r){this.markedKeys.add(r)}},{key:"gc",value:function(){var r=this,n=this.markedKeys;if(n.size===0){console.log("nothing to garbage collect");return}var a=[],i=new Map,u=null,s=wi(this.atlases),h;try{var p=function(){var v=h.value,x=v.getKeys(),S=Fq(n,x);if(S.size===0)return a.push(v),x.forEach(function(V){return i.set(V,v)}),1;u||(u=r._createAtlas(),a.push(u));var P=wi(x),N;try{for(P.s();!(N=P.n()).done;){var M=N.value;if(!S.has(M)){var I=v.getOffsets(M),A=Hn(I,2),D=A[0],j=A[1];u.canFit({w:D.w+j.w,h:D.h})||(u.lock(),u=r._createAtlas(),a.push(u)),v.canvas&&(r._copyTextureToNewAtlas(M,v,u),i.set(M,u))}}}catch(V){P.e(V)}finally{P.f()}v.dispose()};for(s.s();!(h=s.n()).done;)p()}catch(g){s.e(g)}finally{s.f()}this.atlases=a,this.styleKeyToAtlas=i,this.markedKeys=new Set}},{key:"_copyTextureToNewAtlas",value:function(r,n,a){var i=n.getOffsets(r),u=Hn(i,2),s=u[0],h=u[1];if(h.w===0)a.draw(r,s,function(x){x.drawImage(n.canvas,s.x,s.y,s.w,s.h,0,0,s.w,s.h)});else{var p=this._getScratchCanvas();p.clear(),p.context.drawImage(n.canvas,s.x,s.y,s.w,s.h,0,0,s.w,s.h),p.context.drawImage(n.canvas,h.x,h.y,h.w,h.h,s.w,0,h.w,h.h);var g=s.w+h.w,v=s.h;a.draw(r,{w:g,h:v},function(x){x.drawImage(p,0,0,g,v,0,0,g,v)})}}},{key:"getCounts",value:function(){return{keyCount:this.styleKeyToAtlas.size,atlasCount:new Set(this.styleKeyToAtlas.values()).size}}}])}();function Fq(e,t){return e.intersection?e.intersection(t):new Set(Jy(e).filter(function(r){return t.has(r)}))}var $q=function(){function e(t,r){pu(this,e),this.r=t,this.globalOptions=r,this.atlasSize=r.webglTexSize,this.maxAtlasesPerBatch=r.webglTexPerBatch,this.renderTypes=new Map,this.collections=new Map,this.typeAndIdToKey=new Map}return mu(e,[{key:"getAtlasSize",value:function(){return this.atlasSize}},{key:"addAtlasCollection",value:function(r,n){var a=this.globalOptions,i=a.webglTexSize,u=a.createTextureCanvas,s=n.texRows,h=this._cacheScratchCanvas(u),p=new Oq(this.r,i,s,h);this.collections.set(r,p)}},{key:"addRenderType",value:function(r,n){var a=n.collection;if(!this.collections.has(a))throw new Error("invalid atlas collection name '".concat(a,"'"));var i=this.collections.get(a),u=xr({type:r,atlasCollection:i},n);this.renderTypes.set(r,u)}},{key:"getRenderTypeOpts",value:function(r){return this.renderTypes.get(r)}},{key:"getAtlasCollection",value:function(r){return this.collections.get(r)}},{key:"_cacheScratchCanvas",value:function(r){var n=-1,a=-1,i=null;return function(u,s,h,p){return p?((!i||s!=n||h!=a)&&(n=s,a=h,i=r(u,s,h)),i):r(u,s,h)}}},{key:"_key",value:function(r,n){return"".concat(r,"-").concat(n)}},{key:"invalidate",value:function(r){var n=this,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=a.forceRedraw,u=i===void 0?!1:i,s=a.filterEle,h=s===void 0?function(){return!0}:s,p=a.filterType,g=p===void 0?function(){return!0}:p,v=!1,x=!1,S=wi(r),P;try{for(S.s();!(P=S.n()).done;){var N=P.value;if(h(N)){var M=wi(this.renderTypes.values()),I;try{var A=function(){var j=I.value,V=j.type;if(g(V)){var U=n.collections.get(j.collection),$=j.getKey(N),W=Array.isArray($)?$:[$];if(u)W.forEach(function(K){return U.markKeyForGC(K)}),x=!0;else{var X=j.getID?j.getID(N):N.id(),J=n._key(V,X),Z=n.typeAndIdToKey.get(J);Z!==void 0&&!Iq(W,Z)&&(v=!0,n.typeAndIdToKey.delete(J),Z.forEach(function(K){return U.markKeyForGC(K)}))}}};for(M.s();!(I=M.n()).done;)A()}catch(D){M.e(D)}finally{M.f()}}}}catch(D){S.e(D)}finally{S.f()}return x&&(this.gc(),v=!1),v}},{key:"gc",value:function(){var r=wi(this.collections.values()),n;try{for(r.s();!(n=r.n()).done;){var a=n.value;a.gc()}}catch(i){r.e(i)}finally{r.f()}}},{key:"getOrCreateAtlas",value:function(r,n,a,i){var u=this.renderTypes.get(n),s=this.collections.get(u.collection),h=!1,p=s.draw(i,a,function(x){u.drawClipped?(x.save(),x.beginPath(),x.rect(0,0,a.w,a.h),x.clip(),u.drawElement(x,r,a,!0,!0),x.restore()):u.drawElement(x,r,a,!0,!0),h=!0});if(h){var g=u.getID?u.getID(r):r.id(),v=this._key(n,g);this.typeAndIdToKey.has(v)?this.typeAndIdToKey.get(v).push(i):this.typeAndIdToKey.set(v,[i])}return p}},{key:"getAtlasInfo",value:function(r,n){var a=this,i=this.renderTypes.get(n),u=i.getKey(r),s=Array.isArray(u)?u:[u];return s.map(function(h){var p=i.getBoundingBox(r,h),g=a.getOrCreateAtlas(r,n,p,h),v=g.getOffsets(h),x=Hn(v,2),S=x[0],P=x[1];return{atlas:g,tex:S,tex1:S,tex2:P,bb:p}})}},{key:"getDebugInfo",value:function(){var r=[],n=wi(this.collections),a;try{for(n.s();!(a=n.n()).done;){var i=Hn(a.value,2),u=i[0],s=i[1],h=s.getCounts(),p=h.keyCount,g=h.atlasCount;r.push({type:u,keyCount:p,atlasCount:g})}}catch(v){n.e(v)}finally{n.f()}return r}}])}(),Vq=function(){function e(t){pu(this,e),this.globalOptions=t,this.atlasSize=t.webglTexSize,this.maxAtlasesPerBatch=t.webglTexPerBatch,this.batchAtlases=[]}return mu(e,[{key:"getMaxAtlasesPerBatch",value:function(){return this.maxAtlasesPerBatch}},{key:"getAtlasSize",value:function(){return this.atlasSize}},{key:"getIndexArray",value:function(){return Array.from({length:this.maxAtlasesPerBatch},function(r,n){return n})}},{key:"startBatch",value:function(){this.batchAtlases=[]}},{key:"getAtlasCount",value:function(){return this.batchAtlases.length}},{key:"getAtlases",value:function(){return this.batchAtlases}},{key:"canAddToCurrentBatch",value:function(r){return this.batchAtlases.length===this.maxAtlasesPerBatch?this.batchAtlases.includes(r):!0}},{key:"getAtlasIndexForBatch",value:function(r){var n=this.batchAtlases.indexOf(r);if(n<0){if(this.batchAtlases.length===this.maxAtlasesPerBatch)throw new Error("cannot add more atlases to batch");this.batchAtlases.push(r),n=this.batchAtlases.length-1}return n}}])}(),Uq=`
  float circleSD(vec2 p, float r) {
    return distance(vec2(0), p) - r; // signed distance
  }
`,qq=`
  float rectangleSD(vec2 p, vec2 b) {
    vec2 d = abs(p)-b;
    return distance(vec2(0),max(d,0.0)) + min(max(d.x,d.y),0.0);
  }
`,Hq=`
  float roundRectangleSD(vec2 p, vec2 b, vec4 cr) {
    cr.xy = (p.x > 0.0) ? cr.xy : cr.zw;
    cr.x  = (p.y > 0.0) ? cr.x  : cr.y;
    vec2 q = abs(p) - b + cr.x;
    return min(max(q.x, q.y), 0.0) + distance(vec2(0), max(q, 0.0)) - cr.x;
  }
`,Gq=`
  float ellipseSD(vec2 p, vec2 ab) {
    p = abs( p ); // symmetry

    // find root with Newton solver
    vec2 q = ab*(p-ab);
    float w = (q.x<q.y)? 1.570796327 : 0.0;
    for( int i=0; i<5; i++ ) {
      vec2 cs = vec2(cos(w),sin(w));
      vec2 u = ab*vec2( cs.x,cs.y);
      vec2 v = ab*vec2(-cs.y,cs.x);
      w = w + dot(p-u,v)/(dot(p-u,u)+dot(v,v));
    }
    
    // compute final point and distance
    float d = length(p-ab*vec2(cos(w),sin(w)));
    
    // return signed distance
    return (dot(p/ab,p/ab)>1.0) ? d : -d;
  }
`,Up={SCREEN:{name:"screen",screen:!0},PICKING:{name:"picking",picking:!0}},c0={IGNORE:1,USE_BB:2},Mw=0,rA=1,nA=2,Dw=3,Ld=4,Rv=5,fp=6,pp=7,Wq=function(){function e(t,r,n){pu(this,e),this.r=t,this.gl=r,this.maxInstances=n.webglBatchSize,this.atlasSize=n.webglTexSize,this.bgColor=n.bgColor,this.debug=n.webglDebug,this.batchDebugInfo=[],n.enableWrapping=!0,n.createTextureCanvas=Cq,this.atlasManager=new $q(t,n),this.batchManager=new Vq(n),this.simpleShapeOptions=new Map,this.program=this._createShaderProgram(Up.SCREEN),this.pickingProgram=this._createShaderProgram(Up.PICKING),this.vao=this._createVAO()}return mu(e,[{key:"addAtlasCollection",value:function(r,n){this.atlasManager.addAtlasCollection(r,n)}},{key:"addTextureAtlasRenderType",value:function(r,n){this.atlasManager.addRenderType(r,n)}},{key:"addSimpleShapeRenderType",value:function(r,n){this.simpleShapeOptions.set(r,n)}},{key:"invalidate",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.type,i=this.atlasManager;return a?i.invalidate(r,{filterType:function(s){return s===a},forceRedraw:!0}):i.invalidate(r)}},{key:"gc",value:function(){this.atlasManager.gc()}},{key:"_createShaderProgram",value:function(r){var n=this.gl,a=`#version 300 es
      precision highp float;

      uniform mat3 uPanZoomMatrix;
      uniform int  uAtlasSize;
      
      // instanced
      in vec2 aPosition; // a vertex from the unit square
      
      in mat3 aTransform; // used to transform verticies, eg into a bounding box
      in int aVertType; // the type of thing we are rendering

      // the z-index that is output when using picking mode
      in vec4 aIndex;
      
      // For textures
      in int aAtlasId; // which shader unit/atlas to use
      in vec4 aTex; // x/y/w/h of texture in atlas

      // for edges
      in vec4 aPointAPointB;
      in vec4 aPointCPointD;
      in vec2 aLineWidth; // also used for node border width

      // simple shapes
      in vec4 aCornerRadius; // for round-rectangle [top-right, bottom-right, top-left, bottom-left]
      in vec4 aColor; // also used for edges
      in vec4 aBorderColor; // aLineWidth is used for border width

      // output values passed to the fragment shader
      out vec2 vTexCoord;
      out vec4 vColor;
      out vec2 vPosition;
      // flat values are not interpolated
      flat out int vAtlasId; 
      flat out int vVertType;
      flat out vec2 vTopRight;
      flat out vec2 vBotLeft;
      flat out vec4 vCornerRadius;
      flat out vec4 vBorderColor;
      flat out vec2 vBorderWidth;
      flat out vec4 vIndex;
      
      void main(void) {
        int vid = gl_VertexID;
        vec2 position = aPosition; // TODO make this a vec3, simplifies some code below

        if(aVertType == `.concat(Mw,`) {
          float texX = aTex.x; // texture coordinates
          float texY = aTex.y;
          float texW = aTex.z;
          float texH = aTex.w;

          if(vid == 1 || vid == 2 || vid == 4) {
            texX += texW;
          }
          if(vid == 2 || vid == 4 || vid == 5) {
            texY += texH;
          }

          float d = float(uAtlasSize);
          vTexCoord = vec2(texX / d, texY / d); // tex coords must be between 0 and 1

          gl_Position = vec4(uPanZoomMatrix * aTransform * vec3(position, 1.0), 1.0);
        }
        else if(aVertType == `).concat(Ld," || aVertType == ").concat(pp,` 
             || aVertType == `).concat(Rv," || aVertType == ").concat(fp,`) { // simple shapes

          // the bounding box is needed by the fragment shader
          vBotLeft  = (aTransform * vec3(0, 0, 1)).xy; // flat
          vTopRight = (aTransform * vec3(1, 1, 1)).xy; // flat
          vPosition = (aTransform * vec3(position, 1)).xy; // will be interpolated

          // calculations are done in the fragment shader, just pass these along
          vColor = aColor;
          vCornerRadius = aCornerRadius;
          vBorderColor = aBorderColor;
          vBorderWidth = aLineWidth;

          gl_Position = vec4(uPanZoomMatrix * aTransform * vec3(position, 1.0), 1.0);
        }
        else if(aVertType == `).concat(rA,`) {
          vec2 source = aPointAPointB.xy;
          vec2 target = aPointAPointB.zw;

          // adjust the geometry so that the line is centered on the edge
          position.y = position.y - 0.5;

          // stretch the unit square into a long skinny rectangle
          vec2 xBasis = target - source;
          vec2 yBasis = normalize(vec2(-xBasis.y, xBasis.x));
          vec2 point = source + xBasis * position.x + yBasis * aLineWidth[0] * position.y;

          gl_Position = vec4(uPanZoomMatrix * vec3(point, 1.0), 1.0);
          vColor = aColor;
        } 
        else if(aVertType == `).concat(nA,`) {
          vec2 pointA = aPointAPointB.xy;
          vec2 pointB = aPointAPointB.zw;
          vec2 pointC = aPointCPointD.xy;
          vec2 pointD = aPointCPointD.zw;

          // adjust the geometry so that the line is centered on the edge
          position.y = position.y - 0.5;

          vec2 p0, p1, p2, pos;
          if(position.x == 0.0) { // The left side of the unit square
            p0 = pointA;
            p1 = pointB;
            p2 = pointC;
            pos = position;
          } else { // The right side of the unit square, use same approach but flip the geometry upside down
            p0 = pointD;
            p1 = pointC;
            p2 = pointB;
            pos = vec2(0.0, -position.y);
          }

          vec2 p01 = p1 - p0;
          vec2 p12 = p2 - p1;
          vec2 p21 = p1 - p2;

          // Find the normal vector.
          vec2 tangent = normalize(normalize(p12) + normalize(p01));
          vec2 normal = vec2(-tangent.y, tangent.x);

          // Find the vector perpendicular to p0 -> p1.
          vec2 p01Norm = normalize(vec2(-p01.y, p01.x));

          // Determine the bend direction.
          float sigma = sign(dot(p01 + p21, normal));
          float width = aLineWidth[0];

          if(sign(pos.y) == -sigma) {
            // This is an intersecting vertex. Adjust the position so that there's no overlap.
            vec2 point = 0.5 * width * normal * -sigma / dot(normal, p01Norm);
            gl_Position = vec4(uPanZoomMatrix * vec3(p1 + point, 1.0), 1.0);
          } else {
            // This is a non-intersecting vertex. Treat it like a mitre join.
            vec2 point = 0.5 * width * normal * sigma * dot(normal, p01Norm);
            gl_Position = vec4(uPanZoomMatrix * vec3(p1 + point, 1.0), 1.0);
          }

          vColor = aColor;
        } 
        else if(aVertType == `).concat(Dw,` && vid < 3) {
          // massage the first triangle into an edge arrow
          if(vid == 0)
            position = vec2(-0.15, -0.3);
          if(vid == 1)
            position = vec2(  0.0,  0.0);
          if(vid == 2)
            position = vec2( 0.15, -0.3);

          gl_Position = vec4(uPanZoomMatrix * aTransform * vec3(position, 1.0), 1.0);
          vColor = aColor;
        }
        else {
          gl_Position = vec4(2.0, 0.0, 0.0, 1.0); // discard vertex by putting it outside webgl clip space
        }

        vAtlasId = aAtlasId;
        vVertType = aVertType;
        vIndex = aIndex;
      }
    `),i=this.batchManager.getIndexArray(),u=`#version 300 es
      precision highp float;

      // declare texture unit for each texture atlas in the batch
      `.concat(i.map(function(p){return"uniform sampler2D uTexture".concat(p,";")}).join(`
	`),`

      uniform vec4 uBGColor;
      uniform float uZoom;

      in vec2 vTexCoord;
      in vec4 vColor;
      in vec2 vPosition; // model coordinates

      flat in int vAtlasId;
      flat in vec4 vIndex;
      flat in int vVertType;
      flat in vec2 vTopRight;
      flat in vec2 vBotLeft;
      flat in vec4 vCornerRadius;
      flat in vec4 vBorderColor;
      flat in vec2 vBorderWidth;

      out vec4 outColor;

      `).concat(Uq,`
      `).concat(qq,`
      `).concat(Hq,`
      `).concat(Gq,`

      vec4 blend(vec4 top, vec4 bot) { // blend colors with premultiplied alpha
        return vec4( 
          top.rgb + (bot.rgb * (1.0 - top.a)),
          top.a   + (bot.a   * (1.0 - top.a)) 
        );
      }

      vec4 distInterp(vec4 cA, vec4 cB, float d) { // interpolate color using Signed Distance
        // scale to the zoom level so that borders don't look blurry when zoomed in
        // note 1.5 is an aribitrary value chosen because it looks good
        return mix(cA, cB, 1.0 - smoothstep(0.0, 1.5 / uZoom, abs(d))); 
      }

      void main(void) {
        if(vVertType == `).concat(Mw,`) {
          // look up the texel from the texture unit
          `).concat(i.map(function(p){return"if(vAtlasId == ".concat(p,") outColor = texture(uTexture").concat(p,", vTexCoord);")}).join(`
	else `),`
        } 
        else if(vVertType == `).concat(Dw,`) {
          // mimics how canvas renderer uses context.globalCompositeOperation = 'destination-out';
          outColor = blend(vColor, uBGColor);
          outColor.a = 1.0; // make opaque, masks out line under arrow
        }
        else if(vVertType == `).concat(Ld,` && vBorderWidth == vec2(0.0)) { // simple rectangle with no border
          outColor = vColor; // unit square is already transformed to the rectangle, nothing else needs to be done
        }
        else if(vVertType == `).concat(Ld," || vVertType == ").concat(pp,` 
          || vVertType == `).concat(Rv," || vVertType == ").concat(fp,`) { // use SDF

          float outerBorder = vBorderWidth[0];
          float innerBorder = vBorderWidth[1];
          float borderPadding = outerBorder * 2.0;
          float w = vTopRight.x - vBotLeft.x - borderPadding;
          float h = vTopRight.y - vBotLeft.y - borderPadding;
          vec2 b = vec2(w/2.0, h/2.0); // half width, half height
          vec2 p = vPosition - vec2(vTopRight.x - b[0] - outerBorder, vTopRight.y - b[1] - outerBorder); // translate to center

          float d; // signed distance
          if(vVertType == `).concat(Ld,`) {
            d = rectangleSD(p, b);
          } else if(vVertType == `).concat(pp,` && w == h) {
            d = circleSD(p, b.x); // faster than ellipse
          } else if(vVertType == `).concat(pp,`) {
            d = ellipseSD(p, b);
          } else {
            d = roundRectangleSD(p, b, vCornerRadius.wzyx);
          }

          // use the distance to interpolate a color to smooth the edges of the shape, doesn't need multisampling
          // we must smooth colors inwards, because we can't change pixels outside the shape's bounding box
          if(d > 0.0) {
            if(d > outerBorder) {
              discard;
            } else {
              outColor = distInterp(vBorderColor, vec4(0), d - outerBorder);
            }
          } else {
            if(d > innerBorder) {
              vec4 outerColor = outerBorder == 0.0 ? vec4(0) : vBorderColor;
              vec4 innerBorderColor = blend(vBorderColor, vColor);
              outColor = distInterp(innerBorderColor, outerColor, d);
            } 
            else {
              vec4 outerColor;
              if(innerBorder == 0.0 && outerBorder == 0.0) {
                outerColor = vec4(0);
              } else if(innerBorder == 0.0) {
                outerColor = vBorderColor;
              } else {
                outerColor = blend(vBorderColor, vColor);
              }
              outColor = distInterp(vColor, outerColor, d - innerBorder);
            }
          }
        }
        else {
          outColor = vColor;
        }

        `).concat(r.picking?`if(outColor.a == 0.0) discard;
             else outColor = vIndex;`:"",`
      }
    `),s=Eq(n,a,u);s.aPosition=n.getAttribLocation(s,"aPosition"),s.aIndex=n.getAttribLocation(s,"aIndex"),s.aVertType=n.getAttribLocation(s,"aVertType"),s.aTransform=n.getAttribLocation(s,"aTransform"),s.aAtlasId=n.getAttribLocation(s,"aAtlasId"),s.aTex=n.getAttribLocation(s,"aTex"),s.aPointAPointB=n.getAttribLocation(s,"aPointAPointB"),s.aPointCPointD=n.getAttribLocation(s,"aPointCPointD"),s.aLineWidth=n.getAttribLocation(s,"aLineWidth"),s.aColor=n.getAttribLocation(s,"aColor"),s.aCornerRadius=n.getAttribLocation(s,"aCornerRadius"),s.aBorderColor=n.getAttribLocation(s,"aBorderColor"),s.uPanZoomMatrix=n.getUniformLocation(s,"uPanZoomMatrix"),s.uAtlasSize=n.getUniformLocation(s,"uAtlasSize"),s.uBGColor=n.getUniformLocation(s,"uBGColor"),s.uZoom=n.getUniformLocation(s,"uZoom"),s.uTextures=[];for(var h=0;h<this.batchManager.getMaxAtlasesPerBatch();h++)s.uTextures.push(n.getUniformLocation(s,"uTexture".concat(h)));return s}},{key:"_createVAO",value:function(){var r=[0,0,1,0,1,1,0,0,1,1,0,1];this.vertexCount=r.length/2;var n=this.maxInstances,a=this.gl,i=this.program,u=a.createVertexArray();return a.bindVertexArray(u),Dq(a,"vec2",i.aPosition,r),this.transformBuffer=zq(a,n,i.aTransform),this.indexBuffer=Ks(a,n,"vec4",i.aIndex),this.vertTypeBuffer=Ks(a,n,"int",i.aVertType),this.atlasIdBuffer=Ks(a,n,"int",i.aAtlasId),this.texBuffer=Ks(a,n,"vec4",i.aTex),this.pointAPointBBuffer=Ks(a,n,"vec4",i.aPointAPointB),this.pointCPointDBuffer=Ks(a,n,"vec4",i.aPointCPointD),this.lineWidthBuffer=Ks(a,n,"vec2",i.aLineWidth),this.colorBuffer=Ks(a,n,"vec4",i.aColor),this.cornerRadiusBuffer=Ks(a,n,"vec4",i.aCornerRadius),this.borderColorBuffer=Ks(a,n,"vec4",i.aBorderColor),a.bindVertexArray(null),u}},{key:"buffers",get:function(){var r=this;return this._buffers||(this._buffers=Object.keys(this).filter(function(n){return Vl(n,"Buffer")}).map(function(n){return r[n]})),this._buffers}},{key:"startFrame",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Up.SCREEN;this.panZoomMatrix=r,this.renderTarget=n,this.batchDebugInfo=[],this.wrappedCount=0,this.simpleCount=0,this.startBatch()}},{key:"startBatch",value:function(){this.instanceCount=0,this.batchManager.startBatch()}},{key:"endFrame",value:function(){this.endBatch()}},{key:"_isVisible",value:function(r,n){return r.visible()?n&&n.isVisible?n.isVisible(r):!0:!1}},{key:"drawTexture",value:function(r,n,a){var i=this.atlasManager,u=this.batchManager,s=i.getRenderTypeOpts(a);if(this._isVisible(r,s)&&!(r.isEdge()&&!this._isValidEdge(r))){if(this.renderTarget.picking&&s.getTexPickingMode){var h=s.getTexPickingMode(r);if(h===c0.IGNORE)return;if(h==c0.USE_BB){this.drawPickingRectangle(r,n,a);return}}var p=i.getAtlasInfo(r,a),g=wi(p),v;try{for(g.s();!(v=g.n()).done;){var x=v.value,S=x.atlas,P=x.tex1,N=x.tex2;u.canAddToCurrentBatch(S)||this.endBatch();for(var M=u.getAtlasIndexForBatch(S),I=0,A=[[P,!0],[N,!1]];I<A.length;I++){var D=Hn(A[I],2),j=D[0],V=D[1];if(j.w!=0){var U=this.instanceCount;this.vertTypeBuffer.getView(U)[0]=Mw;var $=this.indexBuffer.getView(U);Rd(n,$);var W=this.atlasIdBuffer.getView(U);W[0]=M;var X=this.texBuffer.getView(U);X[0]=j.x,X[1]=j.y,X[2]=j.w,X[3]=j.h;var J=this.transformBuffer.getMatrixView(U);this.setTransformMatrix(r,J,s,x,V),this.instanceCount++,V||this.wrappedCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}}}catch(Z){g.e(Z)}finally{g.f()}}}},{key:"setTransformMatrix",value:function(r,n,a,i){var u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,s=0;if(a.shapeProps&&a.shapeProps.padding&&(s=r.pstyle(a.shapeProps.padding).pfValue),i){var h=i.bb,p=i.tex1,g=i.tex2,v=p.w/(p.w+g.w);u||(v=1-v);var x=this._getAdjustedBB(h,s,u,v);this._applyTransformMatrix(n,x,a,r)}else{var S=a.getBoundingBox(r),P=this._getAdjustedBB(S,s,!0,1);this._applyTransformMatrix(n,P,a,r)}}},{key:"_applyTransformMatrix",value:function(r,n,a,i){var u,s;eA(r);var h=a.getRotation?a.getRotation(i):0;if(h!==0){var p=a.getRotationPoint(i),g=p.x,v=p.y;by(r,r,[g,v]),tA(r,r,h);var x=a.getRotationOffset(i);u=x.x+(n.xOffset||0),s=x.y+(n.yOffset||0)}else u=n.x1,s=n.y1;by(r,r,[u,s]),f2(r,r,[n.w,n.h])}},{key:"_getAdjustedBB",value:function(r,n,a,i){var u=r.x1,s=r.y1,h=r.w,p=r.h,g=r.yOffset;n&&(u-=n,s-=n,h+=2*n,p+=2*n);var v=0,x=h*i;return a&&i<1?h=x:!a&&i<1&&(v=h-x,u+=v,h=x),{x1:u,y1:s,w:h,h:p,xOffset:v,yOffset:g}}},{key:"drawPickingRectangle",value:function(r,n,a){var i=this.atlasManager.getRenderTypeOpts(a),u=this.instanceCount;this.vertTypeBuffer.getView(u)[0]=Ld;var s=this.indexBuffer.getView(u);Rd(n,s);var h=this.colorBuffer.getView(u);Wu([0,0,0],1,h);var p=this.transformBuffer.getMatrixView(u);this.setTransformMatrix(r,p,i),this.simpleCount++,this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}},{key:"drawNode",value:function(r,n,a){var i=this.simpleShapeOptions.get(a);if(this._isVisible(r,i)){var u=i.shapeProps,s=this._getVertTypeForShape(r,u.shape);if(s===void 0||i.isSimple&&!i.isSimple(r)){this.drawTexture(r,n,a);return}var h=this.instanceCount;if(this.vertTypeBuffer.getView(h)[0]=s,s===Rv||s===fp){var p=i.getBoundingBox(r),g=this._getCornerRadius(r,u.radius,p),v=this.cornerRadiusBuffer.getView(h);v[0]=g,v[1]=g,v[2]=g,v[3]=g,s===fp&&(v[0]=0,v[2]=0)}var x=this.indexBuffer.getView(h);Rd(n,x);var S=r.pstyle(u.color).value,P=r.pstyle(u.opacity).value,N=this.colorBuffer.getView(h);Wu(S,P,N);var M=this.lineWidthBuffer.getView(h);if(M[0]=0,M[1]=0,u.border){var I=r.pstyle("border-width").value;if(I>0){var A=r.pstyle("border-color").value,D=r.pstyle("border-opacity").value,j=this.borderColorBuffer.getView(h);Wu(A,D,j);var V=r.pstyle("border-position").value;if(V==="inside")M[0]=0,M[1]=-I;else if(V==="outside")M[0]=I,M[1]=0;else{var U=I/2;M[0]=U,M[1]=-U}}}var $=this.transformBuffer.getMatrixView(h);this.setTransformMatrix(r,$,i),this.simpleCount++,this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}},{key:"_getVertTypeForShape",value:function(r,n){var a=r.pstyle(n).value;switch(a){case"rectangle":return Ld;case"ellipse":return pp;case"roundrectangle":case"round-rectangle":return Rv;case"bottom-round-rectangle":return fp;default:return}}},{key:"_getCornerRadius",value:function(r,n,a){var i=a.w,u=a.h;if(r.pstyle(n).value==="auto")return ou(i,u);var s=r.pstyle(n).pfValue,h=i/2,p=u/2;return Math.min(s,p,h)}},{key:"drawEdgeArrow",value:function(r,n,a){if(r.visible()){var i=r._private.rscratch,u,s,h;if(a==="source"?(u=i.arrowStartX,s=i.arrowStartY,h=i.srcArrowAngle):(u=i.arrowEndX,s=i.arrowEndY,h=i.tgtArrowAngle),!(isNaN(u)||u==null||isNaN(s)||s==null||isNaN(h)||h==null)){var p=r.pstyle(a+"-arrow-shape").value;if(p!=="none"){var g=r.pstyle(a+"-arrow-color").value,v=r.pstyle("opacity").value,x=r.pstyle("line-opacity").value,S=v*x,P=r.pstyle("width").pfValue,N=r.pstyle("arrow-scale").value,M=this.r.getArrowWidth(P,N),I=this.instanceCount,A=this.transformBuffer.getMatrixView(I);eA(A),by(A,A,[u,s]),f2(A,A,[M,M]),tA(A,A,h),this.vertTypeBuffer.getView(I)[0]=Dw;var D=this.indexBuffer.getView(I);Rd(n,D);var j=this.colorBuffer.getView(I);Wu(g,S,j),this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}}}},{key:"drawEdgeLine",value:function(r,n){if(r.visible()){var a=this._getEdgePoints(r);if(a){var i=r.pstyle("opacity").value,u=r.pstyle("line-opacity").value,s=r.pstyle("width").pfValue,h=r.pstyle("line-color").value,p=i*u;if(a.length/2+this.instanceCount>this.maxInstances&&this.endBatch(),a.length==4){var g=this.instanceCount;this.vertTypeBuffer.getView(g)[0]=rA;var v=this.indexBuffer.getView(g);Rd(n,v);var x=this.colorBuffer.getView(g);Wu(h,p,x);var S=this.lineWidthBuffer.getView(g);S[0]=s;var P=this.pointAPointBBuffer.getView(g);P[0]=a[0],P[1]=a[1],P[2]=a[2],P[3]=a[3],this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}else for(var N=0;N<a.length-2;N+=2){var M=this.instanceCount;this.vertTypeBuffer.getView(M)[0]=nA;var I=this.indexBuffer.getView(M);Rd(n,I);var A=this.colorBuffer.getView(M);Wu(h,p,A);var D=this.lineWidthBuffer.getView(M);D[0]=s;var j=a[N-2],V=a[N-1],U=a[N],$=a[N+1],W=a[N+2],X=a[N+3],J=a[N+4],Z=a[N+5];N==0&&(j=2*U-W+.001,V=2*$-X+.001),N==a.length-4&&(J=2*W-U+.001,Z=2*X-$+.001);var K=this.pointAPointBBuffer.getView(M);K[0]=j,K[1]=V,K[2]=U,K[3]=$;var Y=this.pointCPointDBuffer.getView(M);Y[0]=W,Y[1]=X,Y[2]=J,Y[3]=Z,this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}}}},{key:"_isValidEdge",value:function(r){var n=r._private.rscratch;return!(n.badLine||n.allpts==null||isNaN(n.allpts[0]))}},{key:"_getEdgePoints",value:function(r){var n=r._private.rscratch;if(this._isValidEdge(r)){var a=n.allpts;if(a.length==4)return a;var i=this._getNumSegments(r);return this._getCurveSegmentPoints(a,i)}}},{key:"_getNumSegments",value:function(r){var n=15;return Math.min(Math.max(n,5),this.maxInstances)}},{key:"_getCurveSegmentPoints",value:function(r,n){if(r.length==4)return r;for(var a=Array((n+1)*2),i=0;i<=n;i++)if(i==0)a[0]=r[0],a[1]=r[1];else if(i==n)a[i*2]=r[r.length-2],a[i*2+1]=r[r.length-1];else{var u=i/n;this._setCurvePoint(r,u,a,i*2)}return a}},{key:"_setCurvePoint",value:function(r,n,a,i){if(r.length<=2)a[i]=r[0],a[i+1]=r[1];else{for(var u=Array(r.length-2),s=0;s<u.length;s+=2){var h=(1-n)*r[s]+n*r[s+2],p=(1-n)*r[s+1]+n*r[s+3];u[s]=h,u[s+1]=p}return this._setCurvePoint(u,n,a,i)}}},{key:"endBatch",value:function(){var r=this.gl,n=this.vao,a=this.vertexCount,i=this.instanceCount;if(i!==0){var u=this.renderTarget.picking?this.pickingProgram:this.program;r.useProgram(u),r.bindVertexArray(n);var s=wi(this.buffers),h;try{for(s.s();!(h=s.n()).done;){var p=h.value;p.bufferSubData(i)}}catch(P){s.e(P)}finally{s.f()}for(var g=this.batchManager.getAtlases(),v=0;v<g.length;v++)g[v].bufferIfNeeded(r);for(var x=0;x<g.length;x++)r.activeTexture(r.TEXTURE0+x),r.bindTexture(r.TEXTURE_2D,g[x].texture),r.uniform1i(u.uTextures[x],x);r.uniform1f(u.uZoom,kq(this.r)),r.uniformMatrix3fv(u.uPanZoomMatrix,!1,this.panZoomMatrix),r.uniform1i(u.uAtlasSize,this.batchManager.getAtlasSize());var S=Wu(this.bgColor,1);r.uniform4fv(u.uBGColor,S),r.drawArraysInstanced(r.TRIANGLES,0,a,i),r.bindVertexArray(null),r.bindTexture(r.TEXTURE_2D,null),this.debug&&this.batchDebugInfo.push({count:i,atlasCount:g.length}),this.startBatch()}}},{key:"getDebugInfo",value:function(){var r=this.atlasManager.getDebugInfo(),n=r.reduce(function(u,s){return u+s.atlasCount},0),a=this.batchDebugInfo,i=a.reduce(function(u,s){return u+s.count},0);return{atlasInfo:r,totalAtlases:n,wrappedCount:this.wrappedCount,simpleCount:this.simpleCount,batchCount:a.length,batchInfo:a,totalInstances:i}}}])}(),NR={};NR.initWebgl=function(e,t){var r=this,n=r.data.contexts[r.WEBGL];e.bgColor=Zq(r),e.webglTexSize=Math.min(e.webglTexSize,n.getParameter(n.MAX_TEXTURE_SIZE)),e.webglTexRows=Math.min(e.webglTexRows,54),e.webglTexRowsNodes=Math.min(e.webglTexRowsNodes,54),e.webglBatchSize=Math.min(e.webglBatchSize,16384),e.webglTexPerBatch=Math.min(e.webglTexPerBatch,n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS)),r.webglDebug=e.webglDebug,r.webglDebugShowAtlases=e.webglDebugShowAtlases,r.pickingFrameBuffer=Rq(n),r.pickingFrameBuffer.needsDraw=!0,r.drawing=new Wq(r,n,e);var a=function(v){return function(x){return r.getTextAngle(x,v)}},i=function(v){return function(x){var S=x.pstyle(v);return S&&S.value}},u=function(v){return function(x){return x.pstyle("".concat(v,"-opacity")).value>0}},s=function(v){var x=v.pstyle("text-events").strValue==="yes";return x?c0.USE_BB:c0.IGNORE},h=function(v){var x=v.position(),S=x.x,P=x.y,N=v.outerWidth(),M=v.outerHeight();return{w:N,h:M,x1:S-N/2,y1:P-M/2}};r.drawing.addAtlasCollection("node",{texRows:e.webglTexRowsNodes}),r.drawing.addAtlasCollection("label",{texRows:e.webglTexRows}),r.drawing.addTextureAtlasRenderType("node-body",{collection:"node",getKey:t.getStyleKey,getBoundingBox:t.getElementBox,drawElement:t.drawElement}),r.drawing.addSimpleShapeRenderType("node-body",{getBoundingBox:h,isSimple:Pq,shapeProps:{shape:"shape",color:"background-color",opacity:"background-opacity",radius:"corner-radius",border:!0}}),r.drawing.addSimpleShapeRenderType("node-overlay",{getBoundingBox:h,isVisible:u("overlay"),shapeProps:{shape:"overlay-shape",color:"overlay-color",opacity:"overlay-opacity",padding:"overlay-padding",radius:"overlay-corner-radius"}}),r.drawing.addSimpleShapeRenderType("node-underlay",{getBoundingBox:h,isVisible:u("underlay"),shapeProps:{shape:"underlay-shape",color:"underlay-color",opacity:"underlay-opacity",padding:"underlay-padding",radius:"underlay-corner-radius"}}),r.drawing.addTextureAtlasRenderType("label",{collection:"label",getTexPickingMode:s,getKey:zw(t.getLabelKey,null),getBoundingBox:Rw(t.getLabelBox,null),drawClipped:!0,drawElement:t.drawLabel,getRotation:a(null),getRotationPoint:t.getLabelRotationPoint,getRotationOffset:t.getLabelRotationOffset,isVisible:i("label")}),r.drawing.addTextureAtlasRenderType("edge-source-label",{collection:"label",getTexPickingMode:s,getKey:zw(t.getSourceLabelKey,"source"),getBoundingBox:Rw(t.getSourceLabelBox,"source"),drawClipped:!0,drawElement:t.drawSourceLabel,getRotation:a("source"),getRotationPoint:t.getSourceLabelRotationPoint,getRotationOffset:t.getSourceLabelRotationOffset,isVisible:i("source-label")}),r.drawing.addTextureAtlasRenderType("edge-target-label",{collection:"label",getTexPickingMode:s,getKey:zw(t.getTargetLabelKey,"target"),getBoundingBox:Rw(t.getTargetLabelBox,"target"),drawClipped:!0,drawElement:t.drawTargetLabel,getRotation:a("target"),getRotationPoint:t.getTargetLabelRotationPoint,getRotationOffset:t.getTargetLabelRotationOffset,isVisible:i("target-label")});var p=Hm(function(){console.log("garbage collect flag set"),r.data.gc=!0},1e4);r.onUpdateEleCalcs(function(g,v){var x=!1;v&&v.length>0&&(x|=r.drawing.invalidate(v)),x&&p()}),Xq(r)};function Zq(e){var t=e.cy.container(),r=t&&t.style&&t.style.backgroundColor||"white";return iz(r)}function MR(e,t){var r=e._private.rscratch;return yi(r,"labelWrapCachedLines",t)||[]}var zw=function(t,r){return function(n){var a=t(n),i=MR(n,r);return i.length>1?i.map(function(u,s){return"".concat(a,"_").concat(s)}):a}},Rw=function(t,r){return function(n,a){var i=t(n);if(typeof a=="string"){var u=a.indexOf("_");if(u>0){var s=Number(a.substring(u+1)),h=MR(n,r),p=i.h/h.length,g=p*s,v=i.y1+g;return{x1:i.x1,w:i.w,y1:v,h:p,yOffset:g}}}return i}};function Xq(e){{var t=e.render;e.render=function(i){i=i||{};var u=e.cy;e.webgl&&(u.zoom()>ER?(Kq(e),t.call(e,i)):(Yq(e),zR(e,i,Up.SCREEN)))}}{var r=e.matchCanvasSize;e.matchCanvasSize=function(i){r.call(e,i),e.pickingFrameBuffer.setFramebufferAttachmentSizes(e.canvasWidth,e.canvasHeight),e.pickingFrameBuffer.needsDraw=!0}}e.findNearestElements=function(i,u,s,h){return nH(e,i,u)};{var n=e.invalidateCachedZSortedEles;e.invalidateCachedZSortedEles=function(){n.call(e),e.pickingFrameBuffer.needsDraw=!0}}{var a=e.notify;e.notify=function(i,u){a.call(e,i,u),i==="viewport"||i==="bounds"?e.pickingFrameBuffer.needsDraw=!0:i==="background"&&e.drawing.invalidate(u,{type:"node-body"})}}}function Kq(e){var t=e.data.contexts[e.WEBGL];t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}function Yq(e){var t=function(n){n.save(),n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,e.canvasWidth,e.canvasHeight),n.restore()};t(e.data.contexts[e.NODE]),t(e.data.contexts[e.DRAG])}function Jq(e){var t=e.canvasWidth,r=e.canvasHeight,n=lE(e),a=n.pan,i=n.zoom,u=Nw();by(u,u,[a.x,a.y]),f2(u,u,[i,i]);var s=Nw();Bq(s,t,r);var h=Nw();return Lq(h,s,u),h}function DR(e,t){var r=e.canvasWidth,n=e.canvasHeight,a=lE(e),i=a.pan,u=a.zoom;t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,r,n),t.translate(i.x,i.y),t.scale(u,u)}function Qq(e,t){e.drawSelectionRectangle(t,function(r){return DR(e,r)})}function eH(e){var t=e.data.contexts[e.NODE];t.save(),DR(e,t),t.strokeStyle="rgba(0, 0, 0, 0.3)",t.beginPath(),t.moveTo(-1e3,0),t.lineTo(1e3,0),t.stroke(),t.beginPath(),t.moveTo(0,-1e3),t.lineTo(0,1e3),t.stroke(),t.restore()}function tH(e){var t=function(a,i,u){for(var s=a.atlasManager.getAtlasCollection(i),h=e.data.contexts[e.NODE],p=s.atlases,g=0;g<p.length;g++){var v=p[g],x=v.canvas;if(x){var S=x.width,P=x.height,N=S*g,M=x.height*u,I=.4;h.save(),h.scale(I,I),h.drawImage(x,N,M),h.strokeStyle="black",h.rect(N,M,S,P),h.stroke(),h.restore()}}},r=0;t(e.drawing,"node",r++),t(e.drawing,"label",r++)}function rH(e,t,r,n,a){var i,u,s,h,p=lE(e),g=p.pan,v=p.zoom;{var x=Tq(e,g,v,t,r),S=Hn(x,2),P=S[0],N=S[1],M=6;i=P-M/2,u=N-M/2,s=M,h=M}if(s===0||h===0)return[];var I=e.data.contexts[e.WEBGL];I.bindFramebuffer(I.FRAMEBUFFER,e.pickingFrameBuffer),e.pickingFrameBuffer.needsDraw&&(I.viewport(0,0,I.canvas.width,I.canvas.height),zR(e,null,Up.PICKING),e.pickingFrameBuffer.needsDraw=!1);var A=s*h,D=new Uint8Array(A*4);I.readPixels(i,u,s,h,I.RGBA,I.UNSIGNED_BYTE,D),I.bindFramebuffer(I.FRAMEBUFFER,null);for(var j=new Set,V=0;V<A;V++){var U=D.slice(V*4,V*4+4),$=Aq(U)-1;$>=0&&j.add($)}return j}function nH(e,t,r){var n=rH(e,t,r),a=e.getCachedZSortedEles(),i,u,s=wi(n),h;try{for(s.s();!(h=s.n()).done;){var p=h.value,g=a[p];if(!i&&g.isNode()&&(i=g),!u&&g.isEdge()&&(u=g),i&&u)break}}catch(v){s.e(v)}finally{s.f()}return[i,u].filter(Boolean)}function Lw(e,t,r){var n=e.drawing;t+=1,r.isNode()?(n.drawNode(r,t,"node-underlay"),n.drawNode(r,t,"node-body"),n.drawTexture(r,t,"label"),n.drawNode(r,t,"node-overlay")):(n.drawEdgeLine(r,t),n.drawEdgeArrow(r,t,"source"),n.drawEdgeArrow(r,t,"target"),n.drawTexture(r,t,"label"),n.drawTexture(r,t,"edge-source-label"),n.drawTexture(r,t,"edge-target-label"))}function zR(e,t,r){var n;e.webglDebug&&(n=performance.now());var a=e.drawing,i=0;if(r.screen&&e.data.canvasNeedsRedraw[e.SELECT_BOX]&&Qq(e,t),e.data.canvasNeedsRedraw[e.NODE]||r.picking){var u=e.data.contexts[e.WEBGL];r.screen?(u.clearColor(0,0,0,0),u.enable(u.BLEND),u.blendFunc(u.ONE,u.ONE_MINUS_SRC_ALPHA)):u.disable(u.BLEND),u.clear(u.COLOR_BUFFER_BIT|u.DEPTH_BUFFER_BIT),u.viewport(0,0,u.canvas.width,u.canvas.height);var s=Jq(e),h=e.getCachedZSortedEles();if(i=h.length,a.startFrame(s,r),r.screen){for(var p=0;p<h.nondrag.length;p++)Lw(e,p,h.nondrag[p]);for(var g=0;g<h.drag.length;g++)Lw(e,g,h.drag[g])}else if(r.picking)for(var v=0;v<h.length;v++)Lw(e,v,h[v]);a.endFrame(),r.screen&&e.webglDebugShowAtlases&&(eH(e),tH(e)),e.data.canvasNeedsRedraw[e.NODE]=!1,e.data.canvasNeedsRedraw[e.DRAG]=!1}if(e.webglDebug){var x=performance.now(),S=!1,P=Math.ceil(x-n),N=a.getDebugInfo(),M=["".concat(i," elements"),"".concat(N.totalInstances," instances"),"".concat(N.batchCount," batches"),"".concat(N.totalAtlases," atlases"),"".concat(N.wrappedCount," wrapped textures"),"".concat(N.simpleCount," simple shapes")].join(", ");if(S)console.log("WebGL (".concat(r.name,") - time ").concat(P,"ms, ").concat(M));else{console.log("WebGL (".concat(r.name,") - frame time ").concat(P,"ms")),console.log("Totals:"),console.log("  ".concat(M)),console.log("Texture Atlases Used:");var I=N.atlasInfo,A=wi(I),D;try{for(A.s();!(D=A.n()).done;){var j=D.value;console.log("  ".concat(j.type,": ").concat(j.keyCount," keys, ").concat(j.atlasCount," atlases"))}}catch(V){A.e(V)}finally{A.f()}console.log("")}}e.data.gc&&(console.log("Garbage Collect!"),e.data.gc=!1,a.gc())}var yu={};yu.drawPolygonPath=function(e,t,r,n,a,i){var u=n/2,s=a/2;e.beginPath&&e.beginPath(),e.moveTo(t+u*i[0],r+s*i[1]);for(var h=1;h<i.length/2;h++)e.lineTo(t+u*i[h*2],r+s*i[h*2+1]);e.closePath()};yu.drawRoundPolygonPath=function(e,t,r,n,a,i,u){u.forEach(function(s){return mR(e,s)}),e.closePath()};yu.drawRoundRectanglePath=function(e,t,r,n,a,i){var u=n/2,s=a/2,h=i==="auto"?ou(n,a):Math.min(i,s,u);e.beginPath&&e.beginPath(),e.moveTo(t,r-s),e.arcTo(t+u,r-s,t+u,r,h),e.arcTo(t+u,r+s,t,r+s,h),e.arcTo(t-u,r+s,t-u,r,h),e.arcTo(t-u,r-s,t,r-s,h),e.lineTo(t,r-s),e.closePath()};yu.drawBottomRoundRectanglePath=function(e,t,r,n,a,i){var u=n/2,s=a/2,h=i==="auto"?ou(n,a):i;e.beginPath&&e.beginPath(),e.moveTo(t,r-s),e.lineTo(t+u,r-s),e.lineTo(t+u,r),e.arcTo(t+u,r+s,t,r+s,h),e.arcTo(t-u,r+s,t-u,r,h),e.lineTo(t-u,r-s),e.lineTo(t,r-s),e.closePath()};yu.drawCutRectanglePath=function(e,t,r,n,a,i,u){var s=n/2,h=a/2,p=u==="auto"?ZS():u;e.beginPath&&e.beginPath(),e.moveTo(t-s+p,r-h),e.lineTo(t+s-p,r-h),e.lineTo(t+s,r-h+p),e.lineTo(t+s,r+h-p),e.lineTo(t+s-p,r+h),e.lineTo(t-s+p,r+h),e.lineTo(t-s,r+h-p),e.lineTo(t-s,r-h+p),e.closePath()};yu.drawBarrelPath=function(e,t,r,n,a){var i=n/2,u=a/2,s=t-i,h=t+i,p=r-u,g=r+u,v=Q1(n,a),x=v.widthOffset,S=v.heightOffset,P=v.ctrlPtOffsetPct*x;e.beginPath&&e.beginPath(),e.moveTo(s,p+S),e.lineTo(s,g-S),e.quadraticCurveTo(s+P,g,s+x,g),e.lineTo(h-x,g),e.quadraticCurveTo(h-P,g,h,g-S),e.lineTo(h,p+S),e.quadraticCurveTo(h-P,p,h-x,p),e.lineTo(s+x,p),e.quadraticCurveTo(s+P,p,s,p+S),e.closePath()};var aA=Math.sin(0),iA=Math.cos(0),p2={},m2={},RR=Math.PI/40;for(var Bd=0*Math.PI;Bd<2*Math.PI;Bd+=RR)p2[Bd]=Math.sin(Bd),m2[Bd]=Math.cos(Bd);yu.drawEllipsePath=function(e,t,r,n,a){if(e.beginPath&&e.beginPath(),e.ellipse)e.ellipse(t,r,n/2,a/2,0,0,2*Math.PI);else for(var i,u,s=n/2,h=a/2,p=0*Math.PI;p<2*Math.PI;p+=RR)i=t-s*p2[p]*aA+s*m2[p]*iA,u=r+h*m2[p]*aA+h*p2[p]*iA,p===0?e.moveTo(i,u):e.lineTo(i,u);e.closePath()};var Ym={};Ym.createBuffer=function(e,t){var r=document.createElement("canvas");return r.width=e,r.height=t,[r,r.getContext("2d")]};Ym.bufferCanvasImage=function(e){var t=this.cy,r=t.mutableElements(),n=r.boundingBox(),a=this.findContainerClientCoords(),i=e.full?Math.ceil(n.w):a[2],u=e.full?Math.ceil(n.h):a[3],s=Ht(e.maxWidth)||Ht(e.maxHeight),h=this.getPixelRatio(),p=1;if(e.scale!==void 0)i*=e.scale,u*=e.scale,p=e.scale;else if(s){var g=1/0,v=1/0;Ht(e.maxWidth)&&(g=p*e.maxWidth/i),Ht(e.maxHeight)&&(v=p*e.maxHeight/u),p=Math.min(g,v),i*=p,u*=p}s||(i*=h,u*=h,p*=h);var x=document.createElement("canvas");x.width=i,x.height=u,x.style.width=i+"px",x.style.height=u+"px";var S=x.getContext("2d");if(i>0&&u>0){S.clearRect(0,0,i,u),S.globalCompositeOperation="source-over";var P=this.getCachedZSortedEles();if(e.full)S.translate(-n.x1*p,-n.y1*p),S.scale(p,p),this.drawElements(S,P),S.scale(1/p,1/p),S.translate(n.x1*p,n.y1*p);else{var N=t.pan(),M={x:N.x*p,y:N.y*p};p*=t.zoom(),S.translate(M.x,M.y),S.scale(p,p),this.drawElements(S,P),S.scale(1/p,1/p),S.translate(-M.x,-M.y)}e.bg&&(S.globalCompositeOperation="destination-over",S.fillStyle=e.bg,S.rect(0,0,i,u),S.fill())}return x};function aH(e,t){for(var r=atob(e),n=new ArrayBuffer(r.length),a=new Uint8Array(n),i=0;i<r.length;i++)a[i]=r.charCodeAt(i);return new Blob([n],{type:t})}function sA(e){var t=e.indexOf(",");return e.substr(t+1)}function LR(e,t,r){var n=function(){return t.toDataURL(r,e.quality)};switch(e.output){case"blob-promise":return new $h(function(a,i){try{t.toBlob(function(u){u!=null?a(u):i(new Error("`canvas.toBlob()` sent a null value in its callback"))},r,e.quality)}catch(u){i(u)}});case"blob":return aH(sA(n()),r);case"base64":return sA(n());case"base64uri":default:return n()}}Ym.png=function(e){return LR(e,this.bufferCanvasImage(e),"image/png")};Ym.jpg=function(e){return LR(e,this.bufferCanvasImage(e),"image/jpeg")};var BR={};BR.nodeShapeImpl=function(e,t,r,n,a,i,u,s){switch(e){case"ellipse":return this.drawEllipsePath(t,r,n,a,i);case"polygon":return this.drawPolygonPath(t,r,n,a,i,u);case"round-polygon":return this.drawRoundPolygonPath(t,r,n,a,i,u,s);case"roundrectangle":case"round-rectangle":return this.drawRoundRectanglePath(t,r,n,a,i,s);case"cutrectangle":case"cut-rectangle":return this.drawCutRectanglePath(t,r,n,a,i,u,s);case"bottomroundrectangle":case"bottom-round-rectangle":return this.drawBottomRoundRectanglePath(t,r,n,a,i,s);case"barrel":return this.drawBarrelPath(t,r,n,a,i)}};var iH=jR,Nr=jR.prototype;Nr.CANVAS_LAYERS=3;Nr.SELECT_BOX=0;Nr.DRAG=1;Nr.NODE=2;Nr.WEBGL=3;Nr.CANVAS_TYPES=["2d","2d","2d","webgl2"];Nr.BUFFER_COUNT=3;Nr.TEXTURE_BUFFER=0;Nr.MOTIONBLUR_BUFFER_NODE=1;Nr.MOTIONBLUR_BUFFER_DRAG=2;function jR(e){var t=this,r=t.cy.window(),n=r.document;e.webgl&&(Nr.CANVAS_LAYERS=t.CANVAS_LAYERS=4,console.log("webgl rendering enabled")),t.data={canvases:new Array(Nr.CANVAS_LAYERS),contexts:new Array(Nr.CANVAS_LAYERS),canvasNeedsRedraw:new Array(Nr.CANVAS_LAYERS),bufferCanvases:new Array(Nr.BUFFER_COUNT),bufferContexts:new Array(Nr.CANVAS_LAYERS)};var a="-webkit-tap-highlight-color",i="rgba(0,0,0,0)";t.data.canvasContainer=n.createElement("div");var u=t.data.canvasContainer.style;t.data.canvasContainer.style[a]=i,u.position="relative",u.zIndex="0",u.overflow="hidden";var s=e.cy.container();s.appendChild(t.data.canvasContainer),s.style[a]=i;var h={"-webkit-user-select":"none","-moz-user-select":"-moz-none","user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)","outline-style":"none"};QF()&&(h["-ms-touch-action"]="none",h["touch-action"]="none");for(var p=0;p<Nr.CANVAS_LAYERS;p++){var g=t.data.canvases[p]=n.createElement("canvas"),v=Nr.CANVAS_TYPES[p];t.data.contexts[p]=g.getContext(v),t.data.contexts[p]||Tn("Could not create canvas of type "+v),Object.keys(h).forEach(function(it){g.style[it]=h[it]}),g.style.position="absolute",g.setAttribute("data-id","layer"+p),g.style.zIndex=String(Nr.CANVAS_LAYERS-p),t.data.canvasContainer.appendChild(g),t.data.canvasNeedsRedraw[p]=!1}t.data.topCanvas=t.data.canvases[0],t.data.canvases[Nr.NODE].setAttribute("data-id","layer"+Nr.NODE+"-node"),t.data.canvases[Nr.SELECT_BOX].setAttribute("data-id","layer"+Nr.SELECT_BOX+"-selectbox"),t.data.canvases[Nr.DRAG].setAttribute("data-id","layer"+Nr.DRAG+"-drag"),t.data.canvases[Nr.WEBGL]&&t.data.canvases[Nr.WEBGL].setAttribute("data-id","layer"+Nr.WEBGL+"-webgl");for(var p=0;p<Nr.BUFFER_COUNT;p++)t.data.bufferCanvases[p]=n.createElement("canvas"),t.data.bufferContexts[p]=t.data.bufferCanvases[p].getContext("2d"),t.data.bufferCanvases[p].style.position="absolute",t.data.bufferCanvases[p].setAttribute("data-id","buffer"+p),t.data.bufferCanvases[p].style.zIndex=String(-p-1),t.data.bufferCanvases[p].style.visibility="hidden";t.pathsEnabled=!0;var x=ni(),S=function(ze){return{x:(ze.x1+ze.x2)/2,y:(ze.y1+ze.y2)/2}},P=function(ze){return{x:-ze.w/2,y:-ze.h/2}},N=function(ze){var He=ze[0]._private,We=He.oldBackgroundTimestamp===He.backgroundTimestamp;return!We},M=function(ze){return ze[0]._private.nodeKey},I=function(ze){return ze[0]._private.labelStyleKey},A=function(ze){return ze[0]._private.sourceLabelStyleKey},D=function(ze){return ze[0]._private.targetLabelStyleKey},j=function(ze,He,We,ot,xt){return t.drawElement(ze,He,We,!1,!1,xt)},V=function(ze,He,We,ot,xt){return t.drawElementText(ze,He,We,ot,"main",xt)},U=function(ze,He,We,ot,xt){return t.drawElementText(ze,He,We,ot,"source",xt)},$=function(ze,He,We,ot,xt){return t.drawElementText(ze,He,We,ot,"target",xt)},W=function(ze){return ze.boundingBox(),ze[0]._private.bodyBounds},X=function(ze){return ze.boundingBox(),ze[0]._private.labelBounds.main||x},J=function(ze){return ze.boundingBox(),ze[0]._private.labelBounds.source||x},Z=function(ze){return ze.boundingBox(),ze[0]._private.labelBounds.target||x},K=function(ze,He){return He},Y=function(ze){return S(W(ze))},G=function(ze,He,We){var ot=ze?ze+"-":"";return{x:He.x+We.pstyle(ot+"text-margin-x").pfValue,y:He.y+We.pstyle(ot+"text-margin-y").pfValue}},oe=function(ze,He,We){var ot=ze[0]._private.rscratch;return{x:ot[He],y:ot[We]}},ie=function(ze){return G("",oe(ze,"labelX","labelY"),ze)},ce=function(ze){return G("source",oe(ze,"sourceLabelX","sourceLabelY"),ze)},fe=function(ze){return G("target",oe(ze,"targetLabelX","targetLabelY"),ze)},de=function(ze){return P(W(ze))},be=function(ze){return P(J(ze))},ge=function(ze){return P(Z(ze))},xe=function(ze){var He=X(ze),We=P(X(ze));if(ze.isNode()){switch(ze.pstyle("text-halign").value){case"left":We.x=-He.w-(He.leftPad||0);break;case"right":We.x=-(He.rightPad||0);break}switch(ze.pstyle("text-valign").value){case"top":We.y=-He.h-(He.topPad||0);break;case"bottom":We.y=-(He.botPad||0);break}}return We},Le=t.data.eleTxrCache=new Tp(t,{getKey:M,doesEleInvalidateKey:N,drawElement:j,getBoundingBox:W,getRotationPoint:Y,getRotationOffset:de,allowEdgeTxrCaching:!1,allowParentTxrCaching:!1}),Oe=t.data.lblTxrCache=new Tp(t,{getKey:I,drawElement:V,getBoundingBox:X,getRotationPoint:ie,getRotationOffset:xe,isVisible:K}),Fe=t.data.slbTxrCache=new Tp(t,{getKey:A,drawElement:U,getBoundingBox:J,getRotationPoint:ce,getRotationOffset:be,isVisible:K}),et=t.data.tlbTxrCache=new Tp(t,{getKey:D,drawElement:$,getBoundingBox:Z,getRotationPoint:fe,getRotationOffset:ge,isVisible:K}),nt=t.data.lyrTxrCache=new CR(t);t.onUpdateEleCalcs(function(ze,He){Le.invalidateElements(He),Oe.invalidateElements(He),Fe.invalidateElements(He),et.invalidateElements(He),nt.invalidateElements(He);for(var We=0;We<He.length;We++){var ot=He[We]._private;ot.oldBackgroundTimestamp=ot.backgroundTimestamp}});var mt=function(ze){for(var He=0;He<ze.length;He++)nt.enqueueElementRefinement(ze[He].ele)};Le.onDequeue(mt),Oe.onDequeue(mt),Fe.onDequeue(mt),et.onDequeue(mt),e.webgl&&t.initWebgl(e,{getStyleKey:M,getLabelKey:I,getSourceLabelKey:A,getTargetLabelKey:D,drawElement:j,drawLabel:V,drawSourceLabel:U,drawTargetLabel:$,getElementBox:W,getLabelBox:X,getSourceLabelBox:J,getTargetLabelBox:Z,getElementRotationPoint:Y,getElementRotationOffset:de,getLabelRotationPoint:ie,getSourceLabelRotationPoint:ce,getTargetLabelRotationPoint:fe,getLabelRotationOffset:xe,getSourceLabelRotationOffset:be,getTargetLabelRotationOffset:ge})}Nr.redrawHint=function(e,t){var r=this;switch(e){case"eles":r.data.canvasNeedsRedraw[Nr.NODE]=t;break;case"drag":r.data.canvasNeedsRedraw[Nr.DRAG]=t;break;case"select":r.data.canvasNeedsRedraw[Nr.SELECT_BOX]=t;break;case"gc":r.data.gc=!0;break}};var sH=typeof Path2D<"u";Nr.path2dEnabled=function(e){if(e===void 0)return this.pathsEnabled;this.pathsEnabled=!!e};Nr.usePaths=function(){return sH&&this.pathsEnabled};Nr.setImgSmoothing=function(e,t){e.imageSmoothingEnabled!=null?e.imageSmoothingEnabled=t:(e.webkitImageSmoothingEnabled=t,e.mozImageSmoothingEnabled=t,e.msImageSmoothingEnabled=t)};Nr.getImgSmoothing=function(e){return e.imageSmoothingEnabled!=null?e.imageSmoothingEnabled:e.webkitImageSmoothingEnabled||e.mozImageSmoothingEnabled||e.msImageSmoothingEnabled};Nr.makeOffscreenCanvas=function(e,t){var r;if((typeof OffscreenCanvas>"u"?"undefined":ta(OffscreenCanvas))!=="undefined")r=new OffscreenCanvas(e,t);else{var n=this.cy.window(),a=n.document;r=a.createElement("canvas"),r.width=e,r.height=t}return r};[kR,lo,Xo,oE,Dc,vu,si,NR,yu,Ym,BR].forEach(function(e){xr(Nr,e)});var oH=[{name:"null",impl:hR},{name:"base",impl:wR},{name:"canvas",impl:iH}],lH=[{type:"layout",extensions:DU},{type:"renderer",extensions:oH}],OR={},FR={};function $R(e,t,r){var n=r,a=function(W){Jr("Can not register `"+t+"` for `"+e+"` since `"+W+"` already exists in the prototype and can not be overridden")};if(e==="core"){if(xm.prototype[t])return a(t);xm.prototype[t]=r}else if(e==="collection"){if(ka.prototype[t])return a(t);ka.prototype[t]=r}else if(e==="layout"){for(var i=function(W){this.options=W,r.call(this,W),Ur(this._private)||(this._private={}),this._private.cy=W.cy,this._private.listeners=[],this.createEmitter()},u=i.prototype=Object.create(r.prototype),s=[],h=0;h<s.length;h++){var p=s[h];u[p]=u[p]||function(){return this}}u.start&&!u.run?u.run=function(){return this.start(),this}:!u.start&&u.run&&(u.start=function(){return this.run(),this});var g=r.prototype.stop;u.stop=function(){var $=this.options;if($&&$.animate){var W=this.animations;if(W)for(var X=0;X<W.length;X++)W[X].stop()}return g?g.call(this):this.emit("layoutstop"),this},u.destroy||(u.destroy=function(){return this}),u.cy=function(){return this._private.cy};var v=function(W){return W._private.cy},x={addEventFields:function(W,X){X.layout=W,X.cy=v(W),X.target=W},bubble:function(){return!0},parent:function(W){return v(W)}};xr(u,{createEmitter:function(){return this._private.emitter=new Q0(x,this),this},emitter:function(){return this._private.emitter},on:function(W,X){return this.emitter().on(W,X),this},one:function(W,X){return this.emitter().one(W,X),this},once:function(W,X){return this.emitter().one(W,X),this},removeListener:function(W,X){return this.emitter().removeListener(W,X),this},removeAllListeners:function(){return this.emitter().removeAllListeners(),this},emit:function(W,X){return this.emitter().emit(W,X),this}}),Yr.eventAliasesOn(u),n=i}else if(e==="renderer"&&t!=="null"&&t!=="base"){var S=VR("renderer","base"),P=S.prototype,N=r,M=r.prototype,I=function(){S.apply(this,arguments),N.apply(this,arguments)},A=I.prototype;for(var D in P){var j=P[D],V=M[D]!=null;if(V)return a(D);A[D]=j}for(var U in M)A[U]=M[U];P.clientFunctions.forEach(function($){A[$]=A[$]||function(){Tn("Renderer does not implement `renderer."+$+"()` on its prototype")}}),n=I}else if(e==="__proto__"||e==="constructor"||e==="prototype")return Tn(e+" is an illegal type to be registered, possibly lead to prototype pollutions");return sz({map:OR,keys:[e,t],value:n})}function VR(e,t){return oz({map:OR,keys:[e,t]})}function uH(e,t,r,n,a){return sz({map:FR,keys:[e,t,r,n],value:a})}function cH(e,t,r,n){return oz({map:FR,keys:[e,t,r,n]})}var g2=function(){if(arguments.length===2)return VR.apply(null,arguments);if(arguments.length===3)return $R.apply(null,arguments);if(arguments.length===4)return cH.apply(null,arguments);if(arguments.length===5)return uH.apply(null,arguments);Tn("Invalid extension access syntax")};xm.prototype.extension=g2;lH.forEach(function(e){e.extensions.forEach(function(t){$R(e.type,t.name,t.impl)})});var d0=function(){if(!(this instanceof d0))return new d0;this.length=0},Ec=d0.prototype;Ec.instanceString=function(){return"stylesheet"};Ec.selector=function(e){var t=this.length++;return this[t]={selector:e,properties:[]},this};Ec.css=function(e,t){var r=this.length-1;if(dr(e))this[r].properties.push({name:e,value:t});else if(Ur(e))for(var n=e,a=Object.keys(n),i=0;i<a.length;i++){var u=a[i],s=n[u];if(s!=null){var h=ga.properties[u]||ga.properties[U0(u)];if(h!=null){var p=h.name,g=s;this[r].properties.push({name:p,value:g})}}}return this};Ec.style=Ec.css;Ec.generateStyle=function(e){var t=new ga(e);return this.appendToStyle(t)};Ec.appendToStyle=function(e){for(var t=0;t<this.length;t++){var r=this[t],n=r.selector,a=r.properties;e.selector(n);for(var i=0;i<a.length;i++){var u=a[i];e.css(u.name,u.value)}}return e};var dH="3.33.1",Cc=function(t){if(t===void 0&&(t={}),Ur(t))return new xm(t);if(dr(t))return g2.apply(g2,arguments)};Cc.use=function(e){var t=Array.prototype.slice.call(arguments,1);return t.unshift(Cc),e.apply(null,t),this};Cc.warnings=function(e){return pz(e)};Cc.version=dH;Cc.stylesheet=Cc.Stylesheet=d0;function hH({elements:e,followLive:t=!1,latestEntity:r=null,layout:n="breadthfirst",showEdgeLabels:a=!0}){const i=se.useRef(null),u=se.useRef(null),[s,h]=se.useState(!1),p=se.useRef(null),g=MS(S=>S.set),v=se.useRef(null);se.useEffect(()=>{if(!i.current||u.current||s)return;const S=()=>{if(!i.current)return;const P=i.current.offsetWidth,N=i.current.offsetHeight;if(P===0||N===0){setTimeout(S,100);return}try{const M=Cc({container:i.current,elements:[],style:[{selector:"node",style:{"background-color":"#22d3ee",label:"data(label)",color:"#cbd5e1","font-size":12}},{selector:"edge",style:{"line-color":"#64748b","target-arrow-color":"#64748b","target-arrow-shape":"triangle","curve-style":"bezier",label:"data(label)","font-size":10}},{selector:".selected",style:{"border-width":4,"border-color":"#fff"}}]});M.style().selector("edge").style("label",a?"data(label)":"").update(),M.on("tap","node",I=>{const A=I.target.id(),D=I.target.data("type");p.current=A,g({id:A,type:D}),M.elements().removeClass("selected"),I.target.addClass("selected")}),u.current=M,h(!0)}catch(M){console.error("Failed to initialize graph:",M)}};setTimeout(S,50)},[s,g]),se.useEffect(()=>{if(!(!u.current||!s))try{u.current.style().selector("edge").style("label",a?"data(label)":"").update()}catch(S){console.error("Failed to update edge labels:",S)}},[a,s]),se.useEffect(()=>{if(!(!u.current||!s))return v.current&&clearTimeout(v.current),v.current=window.setTimeout(()=>{if(u.current)try{const S=p.current;if(u.current.elements().remove(),e.nodes.length>0||e.edges.length>0){if(u.current.add([...e.nodes,...e.edges]),S){const P=u.current.getElementById(S);P&&P.nonempty()&&P.addClass("selected")}u.current.layout({name:n,animate:!0,animationDuration:500}).run()}}catch(S){console.error("Failed to update graph:",S)}},500),()=>{v.current&&clearTimeout(v.current)}},[e,n,s]),se.useEffect(()=>{if(!u.current||!s)return;const S=new ResizeObserver(()=>{u.current&&u.current.resize()});return i.current&&S.observe(i.current),()=>{S.disconnect()}},[s]),se.useEffect(()=>s?OD(({id:P})=>{if(!u.current)return;const N=u.current.getElementById(P);N&&N.nonempty()&&(u.current.elements().removeClass("selected"),N.addClass("selected"),u.current.animate({fit:{eles:N,padding:50},duration:250}))}):void 0,[s]);const x=se.useRef(0);return se.useEffect(()=>{if(!t||!r||!u.current||!s)return;const S=u.current.getElementById(r.id);if(!S||S.empty())return;const P=Date.now();if(P-x.current<2e3){St(`New event: ${r.type||r.id}`);return}x.current=P,u.current.elements().removeClass("selected"),S.addClass("selected"),u.current.animate({fit:{eles:S,padding:50},duration:250})},[t,r,s]),w.jsx("div",{ref:i,className:"rounded-lg bg-black/20",style:{width:"100%",height:"100%",minHeight:"300px",position:"absolute",top:0,left:0,right:0,bottom:0}})}function fH(e="hour"){const[t,r]=se.useState([]),[n,a]=se.useState(!1),[i,u]=se.useState(null);return se.useEffect(()=>{a(!0),u(null),fetch(`http://localhost:8081/events/counts?bucket=${e}`).then(h=>{if(!h.ok)throw new Error(`HTTP ${h.status}`);return h.json()}).then(h=>{r(h),a(!1)}).catch(h=>{u(String(h)),a(!1)})},[e]),{data:t,loading:n,error:i}}const _m=Ti(e=>({playing:!1,speed:1,cursor:null,rangeStart:null,rangeEnd:null,setRange:(t,r)=>e({rangeStart:t,rangeEnd:r,cursor:t}),play:()=>e({playing:!0}),pause:()=>e({playing:!1}),seek:t=>e({cursor:t}),setSpeed:t=>e({speed:t})}));function pH(){const{playing:e,speed:t,pause:r,play:n,seek:a,setSpeed:i,cursor:u,rangeStart:s,rangeEnd:h}=_m(),p=x=>{i(parseFloat(x.target.value))},g=x=>{if(s&&h){const S=new Date(s).getTime(),P=new Date(h).getTime(),N=parseFloat(x.target.value)/100,M=new Date(S+(P-S)*N);a(M.toISOString())}},v=()=>{if(!u||!s||!h)return 0;const x=new Date(s).getTime(),S=new Date(h).getTime(),P=new Date(u).getTime();return S===x?0:(P-x)/(S-x)*100};return w.jsx("div",{className:"bg-panel rounded-lg p-3 border border-white/10",children:w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsx("button",{onClick:e?r:n,className:"px-4 py-2 bg-white/10 hover:bg-white/20 rounded transition-colors",children:e?" Pause":" Play"}),w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx("label",{className:"text-sm opacity-80",children:"Speed:"}),w.jsxs("select",{value:t,onChange:p,className:"px-2 py-1 bg-black/20 border border-white/10 rounded text-sm",children:[w.jsx("option",{value:.25,children:"0.25x"}),w.jsx("option",{value:.5,children:"0.5x"}),w.jsx("option",{value:1,children:"1x"}),w.jsx("option",{value:2,children:"2x"}),w.jsx("option",{value:4,children:"4x"})]})]}),u&&w.jsx("div",{className:"text-sm opacity-60",children:new Date(u).toLocaleString()}),s&&h&&w.jsx("div",{className:"flex-1",children:w.jsx("input",{type:"range",min:"0",max:"100",value:v(),onChange:g,className:"w-full"})})]})})}function mH(){const{rangeStart:e,rangeEnd:t,setRange:r}=_m(),[n,a]=se.useState(e?e.slice(0,16):""),[i,u]=se.useState(t?t.slice(0,16):""),s=()=>{const h=n?new Date(n).toISOString():null,p=i?new Date(i).toISOString():null;r(h,p)};return w.jsx("div",{className:"bg-panel rounded-lg p-3 border border-white/10",children:w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx("label",{className:"text-sm opacity-80",children:"From:"}),w.jsx("input",{type:"datetime-local",value:n,onChange:h=>a(h.target.value),className:"px-2 py-1 bg-black/20 border border-white/10 rounded text-sm"})]}),w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx("label",{className:"text-sm opacity-80",children:"To:"}),w.jsx("input",{type:"datetime-local",value:i,onChange:h=>u(h.target.value),className:"px-2 py-1 bg-black/20 border border-white/10 rounded text-sm"})]}),w.jsx("button",{onClick:s,className:"px-3 py-1 bg-white/10 hover:bg-white/20 rounded text-sm transition-colors",children:"Set Range"})]})})}function gH(){const{playing:e,speed:t,cursor:r,rangeStart:n,rangeEnd:a,seek:i,pause:u}=_m(),s=se.useRef(Date.now());se.useEffect(()=>{if(!e||!r||!n||!a){s.current=Date.now();return}new Date(n).getTime();const h=new Date(a).getTime(),p=new Date(r).getTime();if(p>=h){u();return}const g=setInterval(()=>{const v=Date.now(),x=(v-s.current)/1e3;s.current=v;const S=x*t,P=p+S*1e3;P>=h?(i(new Date(h).toISOString()),u()):i(new Date(P).toISOString())},100);return()=>clearInterval(g)},[e,t,r,n,a,i,u])}const vH=()=>{gH();const{cursor:e}=_m(),{data:t,loading:r,error:n}=fH("hour");if(r)return w.jsx(Is,{title:"Timeline",children:w.jsx("div",{className:"h-28 rounded-lg bg-black/20 flex items-center justify-center text-muted",children:"Loading..."})});if(n)return w.jsx(Is,{title:"Timeline",children:w.jsxs("div",{className:"h-28 rounded-lg bg-black/20 flex items-center justify-center text-red-400 text-sm",children:["Error: ",n]})});const a=t.length>0?Math.max(...t.map(i=>i.c)):1;return w.jsx(Is,{title:"Timeline",children:w.jsxs("div",{className:"space-y-3",children:[w.jsx(mH,{}),w.jsx(pH,{}),w.jsxs("div",{className:"h-28 rounded-lg bg-black/20 p-3 relative",children:[e&&w.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 bg-yellow-400 z-10",style:{left:`${(()=>{if(!t.length)return 0;const i=new Date(e).getTime(),u=new Date(t[0].ts).getTime(),s=new Date(t[t.length-1].ts).getTime();if(s===u)return 0;const h=(i-u)/(s-u)*100;return Math.max(0,Math.min(100,h))})()}%`}}),t.length===0?w.jsx("div",{className:"h-full flex items-center justify-center text-muted text-sm",children:"No event data"}):w.jsx("div",{className:"h-full flex items-end gap-[2px] relative",children:t.map((i,u)=>{const s=a>0?i.c/a*100:0,h=new Date(i.ts).getTime(),p=e&&Math.abs(new Date(e).getTime()-h)<36e5;return w.jsx("div",{className:`flex-1 rounded-t-sm transition-all cursor-pointer ${p?"bg-yellow-500/80 hover:bg-yellow-400":"bg-teal-500/80 hover:bg-teal-400"}`,style:{height:`${Math.max(s,i.c>0?10:0)}%`,minWidth:t.length>20?"1px":"2px",maxWidth:t.length===1?"20%":"none"},title:`${i.ts}: ${i.c} event${i.c!==1?"s":""}`,onClick:()=>{const{seek:g}=_m.getState();g(new Date(i.ts).toISOString())}},u)})})]})]})})},yH=({data:e,config:t})=>{const[r,n]=se.useState(null),[a,i]=se.useState("asc"),[u,s]=se.useState(""),[h,p]=se.useState(1),g=(t==null?void 0:t.pageSize)||20,v=se.useMemo(()=>{if(!e)return[];if(Array.isArray(e))return e;if(Array.isArray(e.entities))return e.entities;if(Array.isArray(e.relationships))return e.relationships;const A=Object.values(e).find(D=>Array.isArray(D));return A||[e]},[e]),x=se.useMemo(()=>{if(t!=null&&t.columns)return t.columns;if(v.length===0)return[];const A=v[0];return Object.keys(A).filter(j=>{const V=A[j];return V!=null&&(typeof V!="object"||Array.isArray(V))})},[v,t==null?void 0:t.columns]),S=se.useMemo(()=>{let A=v;if(u){const D=u.toLowerCase();A=A.filter(j=>Object.values(j).some(V=>String(V).toLowerCase().includes(D)))}return r&&(A=[...A].sort((D,j)=>{const V=D[r],U=j[r],$=V<U?-1:V>U?1:0;return a==="asc"?$:-$})),A},[v,u,r,a]),P=se.useMemo(()=>{const A=(h-1)*g;return S.slice(A,A+g)},[S,h,g]),N=Math.ceil(S.length/g),M=A=>{r===A?i(a==="asc"?"desc":"asc"):(n(A),i("asc")),p(1)},I=A=>A==null?"":typeof A=="object"?JSON.stringify(A):String(A);return v.length===0?w.jsx("div",{className:"text-sm text-white/70 p-4",children:"No data to display"}):w.jsxs("div",{className:"flex flex-col h-full",children:[w.jsx("div",{className:"p-2 border-b border-white/10",children:w.jsx("input",{type:"text",placeholder:"Filter rows...",value:u,onChange:A=>{s(A.target.value),p(1)},className:"w-full bg-black/30 rounded px-2 py-1 text-white text-xs"})}),w.jsx("div",{className:"flex-1 overflow-auto",children:w.jsxs("table",{className:"w-full text-xs",children:[w.jsx("thead",{className:"sticky top-0 bg-black/50",children:w.jsx("tr",{children:x.map(A=>w.jsx("th",{className:"px-2 py-1 text-left border-b border-white/10 cursor-pointer hover:bg-white/10 text-white/80",onClick:()=>M(A),children:w.jsxs("div",{className:"flex items-center gap-1",children:[A,r===A&&w.jsx("span",{className:"text-xs",children:a==="asc"?"":""})]})},A))})}),w.jsx("tbody",{children:P.map((A,D)=>w.jsx("tr",{className:"border-b border-white/5 hover:bg-white/5",children:x.map(j=>w.jsx("td",{className:"px-2 py-1 text-white/80",children:I(A[j])},j))},D))})]})}),N>1&&w.jsxs("div",{className:"flex items-center justify-between p-2 border-t border-white/10 text-xs text-white/70",children:[w.jsxs("div",{children:["Showing ",(h-1)*g+1,"-",Math.min(h*g,S.length)," of ",S.length]}),w.jsxs("div",{className:"flex gap-2",children:[w.jsx("button",{onClick:()=>p(A=>Math.max(1,A-1)),disabled:h===1,className:"px-2 py-1 rounded bg-white/10 hover:bg-white/20 disabled:opacity-50 disabled:cursor-not-allowed",children:"Prev"}),w.jsxs("span",{className:"px-2 py-1",children:[h," / ",N]}),w.jsx("button",{onClick:()=>p(A=>Math.min(N,A+1)),disabled:h===N,className:"px-2 py-1 rounded bg-white/10 hover:bg-white/20 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})]})},xH=({data:e,config:t})=>{const r=se.useMemo(()=>{if(e!=null&&e.items&&Array.isArray(e.items))return e.items.map(v=>({label:String(v.label||v.name||"Unknown"),value:typeof v.value=="number"?v.value:0}));let a=[];if(t!=null&&t.sourcePath){const v=t.sourcePath.split(".");let x=e;for(const S of v)x=x==null?void 0:x[S];Array.isArray(x)&&(a=x)}else Array.isArray(e)?a=e:Array.isArray(e==null?void 0:e.entities)?a=e.entities:Array.isArray(e==null?void 0:e.relationships)&&(a=e.relationships);if(a.length===0)return[];const i=(t==null?void 0:t.labelKey)||"type",u=(t==null?void 0:t.valueMode)||"count",s=t==null?void 0:t.valueKey,h=new Map;for(const v of a){const x=String(v[i]||v.type||"Unknown");if(u==="count")h.set(x,(h.get(x)||0)+1);else if(s){const S=typeof v[s]=="number"?v[s]:0;if(u==="sum")h.set(x,(h.get(x)||0)+S);else if(u==="avg"){const P=h.get(x)||0;h.set(x,P+S)}}}let p=Array.from(h.entries()).map(([v,x])=>({label:v,value:u==="avg"?x/a.filter(S=>String(S[i]||S.type||"Unknown")===v).length:x}));p.sort((v,x)=>x.value-v.value);const g=(t==null?void 0:t.limit)||10;return p.slice(0,g)},[e,t]);if(r.length===0)return w.jsx("div",{className:"text-sm text-white/70 p-4",children:"No data to display"});const n=Math.max(...r.map(a=>a.value));return w.jsx("div",{className:"flex flex-col gap-2 p-3",children:r.map((a,i)=>w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx("div",{className:"text-xs text-white/80 w-24 truncate",title:a.label,children:a.label}),w.jsx("div",{className:"flex-1 relative",children:w.jsx("div",{className:"h-6 bg-teal-600 rounded transition-all",style:{width:`${a.value/n*100}%`}})}),w.jsx("div",{className:"text-xs text-white/90 w-16 text-right",children:typeof a.value=="number"?a.value.toLocaleString():a.value})]},i))})},bH=({data:e,config:t})=>{const r=se.useRef(null),n=se.useRef(null),a=(t==null?void 0:t.styleUrl)||void 0||"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json";return se.useEffect(()=>{if(!(!r.current||n.current))return n.current=new fh.Map({container:r.current,style:a,center:[0,20],zoom:2}),n.current.addControl(new fh.NavigationControl,"top-right"),()=>{n.current&&(n.current.remove(),n.current=null)}},[a]),se.useEffect(()=>{if(!n.current||!e)return;const i=(t==null?void 0:t.latKey)||"lat",u=(t==null?void 0:t.lonKey)||"lon",s=t==null?void 0:t.intensityKey;let h=[];const p=x=>{if(Array.isArray(x))x.forEach(S=>p(S));else if(x&&typeof x=="object")if(typeof x[i]=="number"&&typeof x[u]=="number"){const S=s&&typeof x[s]=="number"?x[s]:x.intensity||1;h.push([x[u],x[i],S])}else Object.values(x).forEach(S=>{S&&typeof S=="object"&&p(S)})};if(p(e),h.length===0)return;const g={type:"FeatureCollection",features:h.map(([x,S,P])=>({type:"Feature",geometry:{type:"Point",coordinates:[x,S]},properties:{intensity:P}}))};if(n.current.getSource("heat-source")&&(n.current.getLayer("heat-layer")&&n.current.removeLayer("heat-layer"),n.current.removeSource("heat-source")),n.current.addSource("heat-source",{type:"geojson",data:g}),n.current.addLayer({id:"heat-layer",type:"heatmap",source:"heat-source",maxzoom:15,paint:{"heatmap-weight":{property:"intensity",type:"exponential",stops:[[0,0],[1,1]]},"heatmap-intensity":["interpolate",["linear"],["zoom"],0,1,9,3],"heatmap-color":["interpolate",["linear"],["heatmap-density"],0,"rgba(33,102,172,0)",.2,"rgb(103,169,207)",.4,"rgb(209,229,240)",.6,"rgb(253,219,199)",.8,"rgb(239,138,98)",1,"rgb(178,24,43)"],"heatmap-radius":["interpolate",["linear"],["zoom"],0,2,9,20],"heatmap-opacity":.6}}),h.length>0){const x=new fh.LngLatBounds;h.forEach(([S,P])=>x.extend([S,P])),n.current.fitBounds(x,{padding:50,duration:1e3})}},[e,t,n.current]),w.jsxs("div",{className:"w-full h-full rounded-lg overflow-hidden relative",style:{minHeight:"300px"},children:[w.jsx("div",{ref:r,className:"w-full h-full"}),!e&&w.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 text-white/70",children:"No coordinate data available"})]})},oA=({title:e,message:t,actionLabel:r,onAction:n,icon:a})=>w.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center min-h-[200px]",children:[a&&w.jsx("div",{className:"mb-4 text-white/40",children:a}),w.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:e}),w.jsx("p",{className:"text-sm text-white/70 mb-4 max-w-md",children:t}),r&&n&&w.jsx("button",{onClick:n,className:"px-4 py-2 bg-teal-600 hover:bg-teal-700 rounded text-white text-sm font-medium transition-colors",children:r})]});class _H{constructor(){Pd(this,"ws",null);Pd(this,"handlers",new Map);Pd(this,"queue",[]);Pd(this,"reconnectDelay",500);Pd(this,"stopped",!1)}subscribe(t,r){var a;if(!t)throw new Error("Topic is required for dashboard stream subscription");const n=this.handlers.get(t)??new Set;return n.add(r),this.handlers.set(t,n),((a=this.ws)==null?void 0:a.readyState)===WebSocket.OPEN?this.send({action:"subscribe",topic:t}):this.ensureSocket(),()=>{var u;const i=this.handlers.get(t);i&&(i.delete(r),i.size===0?(this.handlers.delete(t),((u=this.ws)==null?void 0:u.readyState)===WebSocket.OPEN&&this.send({action:"unsubscribe",topic:t})):this.handlers.set(t,i))}}stop(){var t;this.stopped=!0;try{(t=this.ws)==null||t.close()}catch{}this.ws=null,this.handlers.clear()}ensureSocket(){if(!this.stopped&&!(this.ws&&(this.ws.readyState===WebSocket.OPEN||this.ws.readyState===WebSocket.CONNECTING))){try{this.ws=new WebSocket(KD)}catch{this.scheduleReconnect();return}this.ws.onopen=()=>{var t,r;for(this.reconnectDelay=500;this.queue.length>0&&((t=this.ws)==null?void 0:t.readyState)===WebSocket.OPEN;){const n=this.queue.shift();try{(r=this.ws)==null||r.send(JSON.stringify(n))}catch{this.queue.unshift(n);break}}for(const n of this.handlers.keys())this.send({action:"subscribe",topic:n})},this.ws.onmessage=t=>{try{const r=JSON.parse(t.data),n=r.topic;if(n&&this.handlers.has(n))for(const a of this.handlers.get(n)??[])try{a(r)}catch(i){console.error("Dashboard handler error",i)}}catch(r){console.warn("Failed to parse dashboard stream payload",r)}},this.ws.onclose=()=>{this.stopped||this.scheduleReconnect()},this.ws.onerror=()=>{this.stopped||this.scheduleReconnect()}}}scheduleReconnect(){var t;if(!this.stopped){try{(t=this.ws)==null||t.close()}catch{}this.ws=null,setTimeout(()=>this.ensureSocket(),this.reconnectDelay),this.reconnectDelay=Math.min(this.reconnectDelay*2,5e3)}}send(t){var r;if(((r=this.ws)==null?void 0:r.readyState)===WebSocket.OPEN)try{this.ws.send(JSON.stringify(t));return}catch{}this.queue.push(t),this.ensureSocket()}}const wH=new _H;function UR({type:e,query:t,refreshSec:r=30,config:n,onQueryChange:a}){var U,$,W;const[i,u]=Ke.useState(null),[s,h]=Ke.useState(null),[p,g]=Ke.useState(!1),[v,x]=Ke.useState(null),[S,P]=Ke.useState({isOpen:!1,title:"",message:""}),[N,M]=Ke.useState([]),I=Ke.useMemo(()=>{const X=typeof(n==null?void 0:n.liveTopic)=="string"?n.liveTopic:void 0;if(X)return X;const J=typeof(n==null?void 0:n.liveSourceId)=="string"?n.liveSourceId:void 0;return J?`datasource.${J}`:void 0},[n]),A=Ke.useMemo(()=>{const X=(n==null?void 0:n.liveLimit)??(n==null?void 0:n.live_limit),J=typeof X=="number"?X:X?parseInt(String(X),10):NaN;return Number.isFinite(J)&&J>0?J:200},[n]);Ke.useEffect(()=>{if(!I){M([]);return}const X=wH.subscribe(I,J=>{const Z=(J==null?void 0:J.data)??J;if(!Z)return;const K=Z.id??`${Date.now()}-${Math.random().toString(16).slice(2)}`;M(Y=>{const G=Y.filter(oe=>oe.id!==K);return[{...Z,id:K},...G].slice(0,A)})});return()=>X()},[I,A]),Ke.useEffect(()=>{I&&N.length>0&&(x(null),h(null),g(!1))},[I,N.length]),Ke.useEffect(()=>{if(!t){u(null),h(null),g(!1),x(null);return}let X=!1,J;const Z=async()=>{g(!0),h(null);try{const K=await LS(t.gql,{});if(!X){u(K);const Y=GD(K),G=BS(e);if(!K1(Y.shape,e)&&Y.confidence==="high"){x({detected:Y.shape,expected:G});const ie=Array.isArray(G)?G.map(ce=>as(ce)).join(" or "):as(G);if(P({isOpen:!0,title:"Query Shape Mismatch",message:`This query returns ${as(Y.shape)}; this panel expects ${ie}. The panel will show an empty state until you change the query.`}),!t.shapeHint&&t.id)try{await qr.updateQuery(t.id,{shapeHint:Y.shape})}catch{}}else if(x(null),!t.shapeHint&&t.id&&Y.confidence==="high")try{await qr.updateQuery(t.id,{shapeHint:Y.shape})}catch{}g(!1)}}catch(K){X||(h(K.message),u(null),x(null),g(!1))}};return Z(),!I&&r&&r>=5&&(J=window.setInterval(Z,r*1e3)),()=>{X=!0,J&&clearInterval(J)}},[t==null?void 0:t.gql,t==null?void 0:t.id,r,e,I]);const D=Ke.useMemo(()=>!I||N.length===0?null:e==="metric"?{value:N.length,entities:N}:e==="timeline"?null:{entities:N},[N,I,e]),j=D??i,V=!!D;if(!t)return w.jsx(oA,{title:"No Query Selected",message:WD(e),actionLabel:a?"Select Query":void 0,onAction:a});if(p&&!V)return w.jsx("div",{className:"text-sm text-muted p-4",children:"Loading..."});if(s&&!V)return w.jsxs("div",{className:"p-4",children:[w.jsxs("div",{className:"text-red-400 text-sm mb-2",children:["Error: ",s]}),a&&w.jsx("button",{onClick:a,className:"text-xs text-teal-400 hover:text-teal-300 underline",children:"Change query"})]});if(v&&!V){const X=Array.isArray(v.expected)?v.expected.map(J=>as(J)).join(" or "):as(v.expected);return w.jsxs(w.Fragment,{children:[w.jsx(oA,{title:"Query Shape Mismatch",message:`This query returns ${as(v.detected)}, but this panel expects ${X}. Please select a compatible query.`,actionLabel:a?"Change Query":void 0,onAction:a}),w.jsx(so,{isOpen:S.isOpen,onClose:()=>P({isOpen:!1,title:"",message:""}),title:S.title,message:S.message,variant:"info"})]})}if(e==="metric"){let X="";if(j)if(typeof j.value=="number")X=j.value;else if((U=j.result)!=null&&U.value&&typeof j.result.value=="number")X=j.result.value;else if(Array.isArray(j.entities))X=j.entities.length;else if(Array.isArray(j.relationships))X=j.relationships.length;else{const J=Object.values(j).find(Z=>Array.isArray(Z));if(J)X=J.length;else{const Z=Object.values(j)[0];Z!=null&&(X=String(Z))}}return w.jsxs("div",{className:"text-center p-4",children:[I&&w.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs uppercase tracking-wide text-emerald-200 mb-2",children:[w.jsx("span",{className:"flex h-2 w-2 rounded-full bg-emerald-300 animate-pulse"}),"Live"]}),w.jsx("div",{className:"text-3xl font-bold text-white",children:String(X)})]})}if(e==="graph"){const X=(j==null?void 0:j.entities)||[],J=(j==null?void 0:j.relationships)||[],Z=X.length>0?X:(($=j==null?void 0:j.data)==null?void 0:$.entities)||Object.values(j||{}).flat().filter(ie=>ie&&typeof ie=="object"&&ie.id&&ie.type),K=J.length>0?J:((W=j==null?void 0:j.data)==null?void 0:W.relationships)||[],Y=Z.map(ie=>{var ce;return{data:{id:ie.id,label:ie.type==="Location"&&((ce=ie.attrs)!=null&&ce.name)?ie.attrs.name:ie.id,type:ie.type}}}),G=new Set(Y.map(ie=>ie.data.id)),oe=K.filter(ie=>G.has(ie.fromId)&&G.has(ie.toId)).map((ie,ce)=>({data:{id:`edge-${ce}`,source:ie.fromId,target:ie.toId,label:ie.type}}));return w.jsx(Is,{title:"Graph",children:w.jsx(hH,{elements:{nodes:Y,edges:oe}})})}return e==="timeline"?w.jsx(vH,{}):e==="map"?w.jsx(RF,{}):e==="table"?w.jsxs("div",{className:"flex flex-col h-full",children:[I&&w.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 text-xs uppercase tracking-wide text-emerald-200 border-b border-emerald-400/30 bg-emerald-500/10",children:[w.jsx("span",{className:"flex h-2 w-2 rounded-full bg-emerald-300 animate-pulse"}),"Live stream"]}),w.jsx(yH,{data:j,config:n})]}):e==="topbar"?w.jsx(xH,{data:j,config:n}):e==="geoheat"?w.jsx(bH,{data:j,config:n}):w.jsx("pre",{className:"text-xs overflow-auto max-h-64 text-white bg-black/20 p-2 rounded",children:JSON.stringify(j,null,2)})}function SH(e){if(typeof e!="object"||e===null)return{ok:!1,errors:[{path:"",message:"Input must be an object"}]};const t=e;if(t.version!==1)return{ok:!1,errors:[{path:"/version",message:"Unsupported version (expected 1)"}]};if(!t.dashboard||typeof t.dashboard!="object")return{ok:!1,errors:[{path:"/dashboard",message:"Missing or invalid dashboard"}]};const r=t.dashboard;if(!r.name||typeof r.name!="string")return{ok:!1,errors:[{path:"/dashboard/name",message:"Dashboard name is required"}]};if(!Array.isArray(t.panels))return{ok:!1,errors:[{path:"/panels",message:"Panels must be an array"}]};for(let n=0;n<t.panels.length;n++){const a=t.panels[n];if(typeof a!="object"||a===null)return{ok:!1,errors:[{path:`/panels/${n}`,message:"Panel must be an object"}]};const i=a;if(!i.title||typeof i.title!="string")return{ok:!1,errors:[{path:`/panels/${n}/title`,message:"Panel title is required"}]};if(!i.type||typeof i.type!="string")return{ok:!1,errors:[{path:`/panels/${n}/type`,message:"Panel type is required"}]}}return{ok:!0,data:e}}function EH(e,t){return t.length===0?!0:t.some(r=>e.includes(r))}function CH(e){if(e!=null)return e<5?5:e>86400?86400:e}async function kH(e){const t=await qr.getDashboard(e),r=t.panels||[],n=await qr.getQueries(),a=new Map(n.map(i=>[i.id,i.name]));return{version:1,exportedAt:new Date().toISOString(),meta:{notes:`Exported from ${location.host}`},dashboard:{id:t.id,name:t.name,visibilityRoles:t.visibilityRoles??[],config:t.config??{}},panels:r.map(i=>({id:i.id,title:i.title,type:i.type,queryRef:i.queryId?a.has(i.queryId)?{name:a.get(i.queryId)}:{id:i.queryId}:void 0,refreshSec:i.refreshSec,config:i.config??{}}))}}async function TH(e){const t=SH(e);if(!t.ok){const s=t.errors.map(h=>`${h.path}: ${h.message}`).join("; ");throw new Error(`Invalid dashboard export: ${s}`)}const r=t.data,n=await qr.createDashboard({name:r.dashboard.name,visibilityRoles:r.dashboard.visibilityRoles??[],config:r.dashboard.config??{}});r.dashboard.visibilityRoles&&r.dashboard.visibilityRoles.length>0&&await qr.updateDashboard(n.id,{visibilityRoles:r.dashboard.visibilityRoles});const a=await qr.getQueries(),i=[];function u(s){if(s){if("id"in s&&s.id&&a.some(p=>p.id===s.id))return s.id;if("name"in s&&s.name){const h=a.find(p=>{var g;return((g=p.name)==null?void 0:g.toLowerCase())===s.name.toLowerCase()});if(h)return h.id;i.push(s.name)}}}for(const s of r.panels){const h=u(s.queryRef);await qr.createPanel(n.id,{title:s.title,type:s.type,queryId:h,refreshSec:CH(s.refreshSec),config:s.config??{}})}return{dashboardId:n.id,unresolvedQueries:i}}function PH(e,t){return e.filter(r=>{const n=r.visibilityRoles??[];return n.length===0||EH(t,n)})}const IH=({isOpen:e,onClose:t,onConfirm:r,title:n,message:a,defaultValue:i="",placeholder:u="",confirmText:s="OK",cancelText:h="Cancel"})=>{const[p,g]=se.useState(i);se.useEffect(()=>{e&&g(i)},[e,i]);const v=()=>{r(p),t()},x=S=>{S.key==="Enter"?v():S.key==="Escape"&&t()};return w.jsx(eo,{isOpen:e,onClose:t,title:n,children:w.jsxs("div",{className:"space-y-4",children:[w.jsx("p",{className:"text-white/80",children:a}),w.jsx("input",{type:"text",value:p,onChange:S=>g(S.target.value),onKeyDown:x,placeholder:u,className:"w-full px-3 py-2 bg-black/20 border border-white/10 rounded focus:outline-none focus:border-white/30 text-white",autoFocus:!0}),w.jsxs("div",{className:"flex gap-2 justify-end",children:[w.jsx("button",{onClick:t,className:"px-4 py-2 bg-white/10 hover:bg-white/20 rounded text-white text-sm",children:h}),w.jsx("button",{onClick:v,className:"px-4 py-2 bg-teal-600 hover:bg-teal-700 rounded text-white text-sm",children:s})]})]})})};function AH(){const{dashboards:e,panels:t,queries:r,loadDashboards:n,loadPanels:a,loadQueries:i,defaultDashboardId:u,setDefaultDashboard:s}=sc(),{user:h}=Nc(),[p,g]=Ke.useState(null),[v,x]=Ke.useState(!1),[S,P]=Ke.useState(null),[N,M]=Ke.useState(""),[I,A]=Ke.useState(""),[D,j]=Ke.useState("dashboards"),[V,U]=Ke.useState({isOpen:!1,title:"",message:"",variant:"info"}),[$,W]=Ke.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{},danger:!1}),[X,J]=Ke.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{},defaultValue:""}),Z=Ke.useRef(null),[K,Y]=Ke.useState([]),G=(h==null?void 0:h.roles)||[],oe=Ke.useMemo(()=>{const Xe=PH(e,G),Pe=I.trim().toLowerCase();return Pe?Xe.filter(Ye=>Ye.name.toLowerCase().includes(Pe)):Xe},[e,G,I]);Ke.useEffect(()=>{n(),i()},[n,i]),Ke.useEffect(()=>{let Xe=!1;return qr.listDatasources().then(Pe=>{Xe||Y(Pe)}).catch(()=>{Xe||Y([])}),()=>{Xe=!0}},[]),Ke.useEffect(()=>{p&&a(p)},[p,a]);const ie=p?t[p]||[]:[],ce=p?e.find(Xe=>Xe.id===p)??null:null,fe=(ce==null?void 0:ce.config)??void 0,de=fe&&typeof fe.description=="string"?fe.description:null,be=ce?ce.isDefault??ce.id===u:!1,ge=ie.length,xe=ie.filter(Xe=>Xe.queryId).length,Le=Math.max(0,ge-xe),Oe=async(Xe,Pe)=>{if(p){x(!0);try{await qr.createPanel(p,{title:`${Xe} panel`,type:Xe,queryId:Pe,refreshSec:30,position:ie.length}),await a(p)}catch(Ye){U({isOpen:!0,title:"Error",message:Ye.message,variant:"error"})}finally{x(!1)}}},Fe=async(Xe,Pe)=>{if(!p)return;const Ye=ie.find(bt=>bt.id===Xe);if(!Ye)return;if(Pe){const bt=r.find(Vt=>Vt.id===Pe),Et=(bt==null?void 0:bt.shapeHint)??"unknown";if(!K1(Et,Ye.type)){U({isOpen:!0,title:"Incompatible Query",message:`${(bt==null?void 0:bt.name)??"Query"} returns ${Et} data which is incompatible with the ${Ye.type} panel. Choose a compatible query or update the query shape.`,variant:"error"});return}}const at={...Ye.config||{},...Pe!==void 0?{queryId:Pe}:{}};Ye.refreshSec!==void 0&&(at.refreshSec=Ye.refreshSec);try{await qr.updatePanel(p,Xe,{queryId:Pe,refreshSec:Ye.refreshSec,config:at}),await a(p)}catch(bt){U({isOpen:!0,title:"Error",message:bt.message,variant:"error"})}},et=async(Xe,Pe)=>{var Et,Vt;if(!p)return;const Ye=Pe?Math.max(5,Math.min(86400,Pe)):void 0,at=ie.find(Bt=>Bt.id===Xe),bt={...(at==null?void 0:at.config)||{},...at!=null&&at.queryId?{queryId:at.queryId}:{},...(Et=at==null?void 0:at.config)!=null&&Et.liveSourceId?{liveSourceId:at.config.liveSourceId}:{},...(Vt=at==null?void 0:at.config)!=null&&Vt.liveLimit?{liveLimit:at.config.liveLimit}:{}};Ye!==void 0?bt.refreshSec=Ye:delete bt.refreshSec;try{await qr.updatePanel(p,Xe,{refreshSec:Ye,config:bt}),await a(p)}catch(Bt){U({isOpen:!0,title:"Error",message:Bt.message,variant:"error"})}},nt=async(Xe,Pe)=>{if(!p)return;const Ye=ie.find(bt=>bt.id===Xe);if(!Ye)return;const at={...Ye.config||{},...Ye.queryId?{queryId:Ye.queryId}:{}};Ye.refreshSec!==void 0&&(at.refreshSec=Ye.refreshSec),Pe?at.liveSourceId=Pe:delete at.liveSourceId;try{await qr.updatePanel(p,Xe,{config:at,queryId:Ye.queryId,refreshSec:Ye.refreshSec}),await a(p)}catch(bt){U({isOpen:!0,title:"Error",message:bt.message,variant:"error"})}},mt=async(Xe,Pe)=>{var bt;if(!p)return;const Ye=ie.find(Et=>Et.id===Xe);if(!Ye)return;const at={...Ye.config||{},...Ye.queryId?{queryId:Ye.queryId}:{}};Ye.refreshSec!==void 0&&(at.refreshSec=Ye.refreshSec),(bt=Ye.config)!=null&&bt.liveSourceId&&(at.liveSourceId=Ye.config.liveSourceId),Pe&&Pe>0?at.liveLimit=Pe:delete at.liveLimit;try{await qr.updatePanel(p,Xe,{config:at,queryId:Ye.queryId,refreshSec:Ye.refreshSec}),await a(p)}catch(Et){U({isOpen:!0,title:"Error",message:Et.message,variant:"error"})}},it=async(Xe,Pe)=>{try{await qr.updateDashboard(Xe,{name:Pe}),await n(),P(null)}catch(Ye){U({isOpen:!0,title:"Error",message:Ye.message,variant:"error"})}},ze=async Xe=>{x(!0);try{const Pe=await qr.getDashboard(Xe),Ye=await qr.createDashboard({name:`${Pe.name} (copy)`,visibilityRoles:Pe.visibilityRoles,config:Pe.config});for(const at of Pe.panels)await qr.createPanel(Ye.id,{title:at.title,type:at.type,queryId:at.queryId,refreshSec:at.refreshSec,config:at.config,position:at.position});await n(),g(Ye.id),St("Dashboard duplicated")}catch(Pe){U({isOpen:!0,title:"Error",message:Pe.message,variant:"error"})}finally{x(!1)}},He=async Xe=>{W({isOpen:!0,title:"Delete Dashboard",message:"Delete this dashboard? This cannot be undone.",danger:!0,onConfirm:async()=>{x(!0);try{await qr.deleteDashboard(Xe),await n(),p===Xe&&g(null),St("Dashboard deleted")}catch(Pe){U({isOpen:!0,title:"Error",message:Pe.message,variant:"error"})}finally{x(!1)}}})},We=async Xe=>{try{const Pe=await kH(Xe),Ye=new Blob([JSON.stringify(Pe,null,2)],{type:"application/json"}),at=URL.createObjectURL(Ye),bt=document.createElement("a");bt.href=at;const Et=e.find(Vt=>Vt.id===Xe);bt.download=`${((Et==null?void 0:Et.name)||"dashboard").replace(/\s+/g,"_")}_export.json`,bt.click(),URL.revokeObjectURL(at),St("Dashboard exported")}catch(Pe){U({isOpen:!0,title:"Export Error",message:Pe.message,variant:"error"})}},ot=async Xe=>{x(!0);try{const Pe=await Xe.text(),Ye=JSON.parse(Pe),{dashboardId:at,unresolvedQueries:bt}=await TH(Ye);await n(),await i(),g(at),bt.length>0?St(`Imported with ${bt.length} unresolved queries`):St("Dashboard imported successfully")}catch(Pe){U({isOpen:!0,title:"Import Error",message:Pe.message,variant:"error"})}finally{x(!1)}},xt=async Xe=>{if(p){x(!0);try{await qr.deletePanel(p,Xe),await a(p)}catch(Pe){U({isOpen:!0,title:"Error",message:Pe.message,variant:"error"})}finally{x(!1)}}},Tt=async()=>{J({isOpen:!0,title:"New Dashboard",message:"Name your dashboard",defaultValue:"",onConfirm:async Xe=>{const Pe=Xe.trim()||"Untitled";x(!0);try{const Ye=await qr.createDashboard({name:Pe});await n(),g(Ye.id)}catch(Ye){U({isOpen:!0,title:"Error",message:Ye.message,variant:"error"})}finally{x(!1)}}})},$e=async Xe=>{if(Xe&&Xe===u){St("Already the console default");return}if(!Xe&&!u){St("No default dashboard set");return}try{x(!0),await s(Xe),St(Xe?"Console home will load this dashboard by default":"Console default dashboard cleared")}catch(Pe){U({isOpen:!0,title:"Default Dashboard",message:String((Pe==null?void 0:Pe.message)||Pe),variant:"error"})}finally{x(!1)}};return w.jsxs("div",{className:"h-full px-4 pb-6 pt-4 overflow-hidden",children:[w.jsx("input",{ref:Z,type:"file",accept:"application/json",className:"hidden",onChange:Xe=>{var Ye;const Pe=(Ye=Xe.target.files)==null?void 0:Ye[0];Pe&&ot(Pe),Z.current&&(Z.current.value="")}}),w.jsxs("div",{className:"grid h-full min-h-0 gap-4 xl:grid-cols-[320px,minmax(0,1fr)] lg:grid-cols-[280px,minmax(0,1fr)]",children:[w.jsx(Is,{title:"Workspace",header:w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsxs("div",{className:"inline-flex rounded-full bg-white/10 p-1",children:[w.jsx("button",{onClick:()=>j("dashboards"),className:`flex items-center justify-center h-8 w-8 rounded-full transition-colors ${D==="dashboards"?"bg-teal-600 text-white":"text-white/70 hover:text-white"}`,"aria-label":"Dashboards",children:w.jsx("svg",{"aria-hidden":"true",viewBox:"0 0 20 20",fill:"currentColor",className:"h-4 w-4",children:w.jsx("path",{d:"M3 3h6v6H3V3zm8 0h6v4h-6V3zM3 11h4v6H3v-6zm6 0h8v6H9v-6z"})})}),w.jsx("button",{onClick:()=>j("library"),className:`flex items-center justify-center h-8 w-8 rounded-full transition-colors ${D==="library"?"bg-teal-600 text-white":"text-white/70 hover:text-white"}`,"aria-label":"Panel presets",children:w.jsxs("svg",{"aria-hidden":"true",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.8",className:"h-4 w-4",children:[w.jsx("path",{d:"M4 7h16M4 12h10M4 17h7",strokeLinecap:"round",strokeLinejoin:"round"}),w.jsx("path",{d:"M17 16.5 19 18l3-3",strokeLinecap:"round",strokeLinejoin:"round"})]})})]}),D==="dashboards"&&w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx("button",{onClick:()=>{var Xe;return(Xe=Z.current)==null?void 0:Xe.click()},className:"flex h-8 w-8 items-center justify-center rounded-full bg-purple-600 hover:bg-purple-700 text-white disabled:opacity-50","aria-label":"Import dashboard",disabled:v,children:w.jsx("svg",{"aria-hidden":"true",viewBox:"0 0 20 20",fill:"currentColor",className:"h-4 w-4",children:w.jsx("path",{d:"M10 14l4-4H6l4 4zm0-12a8 8 0 100 16 8 8 0 000-16z"})})}),w.jsx("button",{onClick:Tt,className:"flex h-8 w-8 items-center justify-center rounded-full bg-teal-600 hover:bg-teal-700 text-white disabled:opacity-50","aria-label":"New dashboard",disabled:v,children:w.jsx("svg",{"aria-hidden":"true",viewBox:"0 0 20 20",fill:"currentColor",className:"h-4 w-4",children:w.jsx("path",{d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"})})})]})]}),children:w.jsx("div",{className:"flex-1 overflow-auto p-3 space-y-3",children:D==="dashboards"?w.jsxs(w.Fragment,{children:[w.jsx("input",{type:"search",value:I,onChange:Xe=>A(Xe.target.value),placeholder:"Search dashboards",className:"w-full bg-white/5 border border-white/10 rounded px-3 py-2 text-sm text-white placeholder:text-white/40 focus:outline-none focus:border-teal-500"}),w.jsx("div",{className:"space-y-2",children:oe.length===0?w.jsx("div",{className:"text-sm text-white/60 border border-dashed border-white/10 rounded-lg p-4",children:e.length===0?"No dashboards yet. Create one to start composing a view.":"No dashboards match that search."}):w.jsx("ul",{className:"space-y-1",children:oe.map(Xe=>{var Vt;const Pe=Xe.id===p,Ye=((Vt=t[Xe.id])==null?void 0:Vt.length)??0,at=Xe.isDefault??Xe.id===u,bt=Xe.config,Et=bt&&typeof bt.description=="string"?bt.description:null;return w.jsx("li",{children:w.jsxs("button",{onClick:()=>{g(Xe.id),P(null)},className:`w-full text-left px-3 py-2 rounded-lg border transition-colors ${Pe?"border-teal-500/80 bg-teal-500/10 text-white":"border-white/10 hover:border-white/20 text-white/80 hover:text-white"}`,children:[w.jsxs("div",{className:"flex items-center justify-between gap-3",children:[w.jsx("span",{className:"text-sm font-medium",children:Xe.name}),w.jsxs("div",{className:"flex items-center gap-2",children:[at&&w.jsx("span",{className:"inline-flex items-center gap-1 rounded-full border border-teal-400/60 bg-teal-500/10 px-2 py-[2px] text-[10px] uppercase tracking-wide text-teal-200",children:" Default"}),w.jsxs("span",{className:"text-xs text-white/50",children:[Ye," panels"]})]})]}),Et&&w.jsx("p",{className:"text-xs text-white/40 mt-1 line-clamp-2",children:Et})]})},Xe.id)})})})]}):w.jsxs("div",{className:"space-y-3",children:[w.jsx("p",{className:"text-xs text-white/60",children:"Drop-in visual building blocks. Pick a preset, then tune the query and settings on the right."}),w.jsxs("div",{className:"text-[11px] uppercase tracking-wide text-white/40",children:[r.length," saved queries available"]}),w.jsx("div",{className:"space-y-2",children:w.jsx(AF,{onPick:Xe=>{Oe(Xe)},variant:"single-column"})}),w.jsx("div",{className:"rounded-lg border border-white/10 bg-white/5 px-3 py-2 text-[11px] text-white/50",children:"Hint: assign saved queries to each panel in the Panels section."})]})})}),w.jsx("div",{className:"flex min-h-0 flex-col gap-4",children:ce?w.jsxs(w.Fragment,{children:[w.jsx(Is,{title:"Dashboard overview",fill:!1,header:w.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[be?w.jsxs(w.Fragment,{children:[w.jsx("span",{className:"inline-flex items-center gap-1 rounded-full border border-teal-400/60 bg-teal-500/10 px-2 py-[2px] text-[11px] uppercase tracking-wide text-teal-200",children:" Default on console"}),w.jsx("button",{onClick:()=>$e(null),className:"px-2 py-1 text-xs rounded border border-white/20 text-white/80 hover:text-white hover:border-white/40 disabled:opacity-50",disabled:v,children:"Unset"})]}):w.jsx("button",{onClick:()=>$e(ce.id),className:"px-2 py-1 text-xs rounded bg-teal-600 hover:bg-teal-700 text-white disabled:opacity-50",disabled:v,children:"Use on console"}),w.jsx("div",{className:"h-4 w-px bg-white/20"}),w.jsx("button",{onClick:()=>We(ce.id),className:"px-2 py-1 text-xs rounded bg-white/10 hover:bg-white/20 text-white disabled:opacity-50",disabled:v,children:"Export"}),w.jsx("button",{onClick:()=>ze(ce.id),className:"px-2 py-1 text-xs rounded bg-blue-600 hover:bg-blue-700 text-white disabled:opacity-50",disabled:v,children:"Duplicate"}),w.jsx("button",{onClick:()=>He(ce.id),className:"px-2 py-1 text-xs rounded bg-red-600 hover:bg-red-700 text-white disabled:opacity-50",disabled:v,children:"Delete"})]}),children:w.jsxs("div",{className:"p-4 space-y-4",children:[w.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[S===ce.id?w.jsx("input",{type:"text",value:N,onChange:Xe=>M(Xe.target.value),onBlur:()=>{N.trim()?it(ce.id,N.trim()):P(null)},onKeyDown:Xe=>{Xe.key==="Enter"&&N.trim()&&it(ce.id,N.trim()),Xe.key==="Escape"&&P(null)},className:"bg-white/5 border border-teal-500/60 focus:border-teal-400 focus:outline-none rounded px-3 py-2 text-base text-white",autoFocus:!0}):w.jsx("button",{onClick:()=>{M(ce.name),P(ce.id)},className:"text-lg font-semibold text-white hover:text-teal-300",children:ce.name}),w.jsx("span",{className:"text-xs text-white/40",children:"Click name to rename"})]}),de&&w.jsx("p",{className:"text-sm text-white/60 max-w-3xl",children:de}),w.jsxs("div",{className:"grid gap-3 sm:grid-cols-3",children:[w.jsxs("div",{className:"rounded-lg bg-white/5 border border-white/10 px-3 py-2",children:[w.jsx("div",{className:"text-[11px] uppercase tracking-wide text-white/50",children:"Panels"}),w.jsx("div",{className:"text-xl font-semibold text-white",children:ge})]}),w.jsxs("div",{className:"rounded-lg bg-white/5 border border-white/10 px-3 py-2",children:[w.jsx("div",{className:"text-[11px] uppercase tracking-wide text-white/50",children:"Panels with query"}),w.jsx("div",{className:"text-xl font-semibold text-white",children:xe})]}),w.jsxs("div",{className:"rounded-lg bg-white/5 border border-white/10 px-3 py-2",children:[w.jsx("div",{className:"text-[11px] uppercase tracking-wide text-white/50",children:"Unassigned"}),w.jsx("div",{className:`text-xl font-semibold ${Le>0?"text-amber-300":"text-white"}`,children:Le})]})]})]})}),w.jsx(Is,{title:"Panels in this dashboard",className:"min-h-[280px]",children:w.jsx("div",{className:"p-4 space-y-4 overflow-auto",children:ie.length===0?w.jsx("div",{className:"border border-dashed border-white/10 rounded-lg p-6 text-center text-sm text-white/60",children:"No panels yet. Use the panel library above to add visual blocks."}):w.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:ie.map(Xe=>{const Pe=r.find(Mt=>Mt.id===Xe.queryId),Ye=BS(Xe.type),at=Xe.queryId?as((Pe==null?void 0:Pe.shapeHint)??"unknown"):as(Ye),bt=Xe.config||{},Et=typeof bt.liveSourceId=="string"?bt.liveSourceId:"",Vt=bt.liveLimit?Number(bt.liveLimit):200,Bt=["table","graph","geoheat","map","metric"].includes(Xe.type);return w.jsx(Is,{title:Xe.title,header:w.jsx("button",{className:"text-[11px] uppercase tracking-wide text-rose-300 hover:text-rose-200",onClick:()=>{W({isOpen:!0,title:"Remove Panel",message:"Remove this panel?",danger:!1,onConfirm:()=>xt(Xe.id)})},children:"Remove"}),children:w.jsxs("div",{className:"p-3 flex flex-col gap-3 min-h-[220px]",children:[w.jsxs("div",{className:"grid gap-2",children:[w.jsxs("div",{children:[w.jsx("label",{className:"text-xs text-white/60 block",children:"Query"}),w.jsxs("div",{className:"relative mt-1",children:[w.jsxs("select",{"data-panel-id":Xe.id,value:Xe.queryId||"",onChange:Mt=>Fe(Xe.id,Mt.target.value||void 0),className:"w-full appearance-none rounded-md border border-white/15 bg-black/40 px-3 py-2 pr-8 text-sm text-white focus:border-emerald-400 focus:outline-none focus:ring-2 focus:ring-emerald-400/40",children:[w.jsx("option",{value:"",children:" No query "}),(()=>{const Mt=[],cr=[];return r.forEach(ar=>{const ft=ar.shapeHint||"unknown";K1(ft,Xe.type)?Mt.push(ar):cr.push(ar)}),w.jsxs(w.Fragment,{children:[Mt.length>0&&w.jsx("optgroup",{label:" Compatible",className:"text-white/70 bg-black",children:Mt.map(ar=>w.jsxs("option",{value:ar.id,children:[ar.name," ",ar.shapeHint&&`[${as(ar.shapeHint)}]`]},ar.id))}),cr.length>0&&w.jsx("optgroup",{label:" Incompatible",className:"text-white/40 bg-black",children:cr.map(ar=>w.jsxs("option",{value:ar.id,disabled:!0,children:[ar.name," ",ar.shapeHint&&`[${as(ar.shapeHint)}]`]},ar.id))})]})})()]}),w.jsx("span",{className:"pointer-events-none absolute inset-y-0 right-2 flex items-center text-white/40",children:""})]}),!Xe.queryId&&w.jsx("p",{className:"text-xs text-white/45 italic mt-1",children:WD(Xe.type)})]}),Bt&&w.jsxs("div",{className:"grid gap-2",children:[w.jsxs("div",{children:[w.jsx("label",{className:"text-xs text-white/60 block",children:"Live Source"}),w.jsxs("div",{className:"relative mt-1",children:[w.jsxs("select",{value:Et,onChange:Mt=>nt(Xe.id,Mt.target.value||void 0),className:"w-full appearance-none rounded-md border border-white/15 bg-black/40 px-3 py-2 pr-8 text-sm text-white focus:border-emerald-400 focus:outline-none focus:ring-2 focus:ring-emerald-400/40",children:[w.jsx("option",{value:"",children:" No live stream "}),K.map(Mt=>w.jsxs("option",{value:Mt.id,children:[Mt.name," ",Mt.status?`(${Mt.status})`:""]},Mt.id))]}),w.jsx("span",{className:"pointer-events-none absolute inset-y-0 right-2 flex items-center text-white/40",children:""})]}),w.jsx("p",{className:"text-[11px] text-white/40 mt-1",children:"Bind a datasource to stream dashboard updates via WebSocket."})]}),Et&&w.jsxs("div",{className:"grid grid-cols-[minmax(0,0.65fr)_minmax(0,1fr)] gap-2",children:[w.jsxs("div",{children:[w.jsx("label",{className:"text-xs text-white/60 block",children:"Live buffer (rows)"}),w.jsx("input",{type:"number",min:10,max:5e3,value:Vt||200,onChange:Mt=>mt(Xe.id,Mt.target.value?Math.max(10,Math.min(5e3,parseInt(Mt.target.value,10))):void 0),className:"mt-1 w-full bg-white/5 border border-emerald-500/40 rounded px-2 py-2 text-sm text-white focus:outline-none focus:border-emerald-400"})]}),w.jsx("div",{className:"text-[11px] text-emerald-200/70 bg-emerald-500/10 border border-emerald-500/30 rounded px-3 py-2",children:"Streaming enabled  refresh interval is ignored while live updates arrive."})]})]}),w.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[w.jsxs("div",{children:[w.jsx("label",{className:"text-xs text-white/60 block",children:"Refresh (sec)"}),w.jsx("input",{type:"number",min:"5",max:"86400",value:Xe.refreshSec||30,onChange:Mt=>et(Xe.id,Mt.target.value?parseInt(Mt.target.value):void 0),disabled:!!Et,className:"mt-1 w-full bg-white/5 border border-white/15 rounded px-2 py-2 text-sm text-white focus:outline-none focus:border-teal-400 disabled:opacity-40 disabled:cursor-not-allowed"}),Et&&w.jsx("p",{className:"text-[11px] text-white/45 mt-1",children:"Refresh scheduling is paused while live streaming is active."})]}),w.jsxs("div",{children:[w.jsx("label",{className:"text-xs text-white/60 block",children:"Expected shape"}),w.jsx("div",{className:"mt-1 text-xs text-white/50 px-2 py-2 bg-white/5 border border-white/10 rounded",children:at})]})]})]}),w.jsx("div",{className:"flex-1 min-h-0 border border-white/10 rounded-lg overflow-hidden",children:w.jsx(UR,{type:Xe.type,query:Pe||null,refreshSec:Xe.refreshSec,config:Xe.config,onQueryChange:()=>{const Mt=document.querySelector(`select[data-panel-id="${Xe.id}"]`);Mt&&(Mt.focus(),Mt.scrollIntoView({behavior:"smooth",block:"center"}))}})})]})},Xe.id)})})})})]}):w.jsx(Is,{title:"Pick a dashboard",children:w.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center gap-3 text-center p-6 text-white/60",children:[w.jsx("p",{className:"text-base font-medium text-white/70",children:"Select or create a dashboard to begin."}),w.jsx("p",{className:"text-sm max-w-sm",children:"Dashboards stitch saved queries into rich panels. You can mix timelines, geo maps, entity tables, and metrics in a single view."})]})})})]}),w.jsx(so,{isOpen:V.isOpen,onClose:()=>U({...V,isOpen:!1}),title:V.title,message:V.message,variant:V.variant}),w.jsx(HD,{isOpen:$.isOpen,onClose:()=>W({...$,isOpen:!1}),onConfirm:$.onConfirm,title:$.title,message:$.message,danger:$.danger}),w.jsx(IH,{isOpen:X.isOpen,onClose:()=>J({...X,isOpen:!1}),onConfirm:X.onConfirm,title:X.title,message:X.message,defaultValue:X.defaultValue})]})}const Ns=Ti((e,t)=>({alerts:[],unread:0,filters:{},load:async()=>{try{const{status:r,severity:n}=t().filters,a=await br.get("/alerts",{params:{status:r,severity:n}});e({alerts:a.data})}catch(r){const n=(r==null?void 0:r.message)||"";if(n.includes("Unauthorized")||n.includes("403")||n.includes("404")||n.includes("Not Found")){e({alerts:[]});return}throw r}},setFilters:r=>e({filters:{...t().filters,...r}}),ack:async r=>{try{await br.post(`/alerts/${r}/ack`),await t().load()}catch(n){const a=(n==null?void 0:n.message)||"";if(a.includes("Unauthorized")||a.includes("403")||a.includes("404")||a.includes("Not Found"))return;throw n}},resolve:async r=>{try{await br.post(`/alerts/${r}/resolve`),await t().load()}catch(n){const a=(n==null?void 0:n.message)||"";if(a.includes("Unauthorized")||a.includes("403")||a.includes("404")||a.includes("Not Found"))return;throw n}}}));YD(e=>{if((e==null?void 0:e.t)==="alert.created"){const t=e.data;t.suppressedByKind&&(t.suppressedBy={kind:t.suppressedByKind,id:t.suppressedById||0,name:t.suppressedByName||""}),Ns.setState(r=>({alerts:[t,...r.alerts],unread:r.unread+(e.data.status==="open"?1:0)}))}else if((e==null?void 0:e.t)==="alert.updated"){const t=e.data;t.suppressedByKind&&(t.suppressedBy={kind:t.suppressedByKind,id:t.suppressedById||0,name:t.suppressedByName||""}),Ns.setState(r=>({alerts:r.alerts.map(n=>n.id===e.data.id?{...n,...t}:n)}))}});const NH="modulepreload",MH=function(e){return"/"+e},lA={},wm=function(t,r,n){let a=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),s=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));a=Promise.allSettled(r.map(h=>{if(h=MH(h),h in lA)return;lA[h]=!0;const p=h.endsWith(".css"),g=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${g}`))return;const v=document.createElement("link");if(v.rel=p?"stylesheet":NH,p||(v.as="script"),v.crossOrigin="",v.href=h,s&&v.setAttribute("nonce",s),document.head.appendChild(v),p)return new Promise((x,S)=>{v.addEventListener("load",x),v.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${h}`)))})}))}function i(u){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=u,window.dispatchEvent(s),!s.defaultPrevented)throw u}return a.then(u=>{for(const s of u||[])s.status==="rejected"&&i(s.reason);return t().catch(i)})},Zu=e=>({...e,createdBy:e.createdBy||e.created_by,createdAt:e.createdAt||e.created_at,updatedAt:e.updatedAt||e.updated_at,resolvedAt:e.resolvedAt||e.resolved_at,prioritySuggestion:e.prioritySuggestion||e.priority_suggestion,ownerSuggestion:e.ownerSuggestion||e.owner_suggestion,similarCaseIds:e.similarCaseIds||e.similar_case_ids,mlVersion:e.mlVersion||e.ml_version}),us=Ti((e,t)=>({loading:!1,items:[],selected:null,setSelected:r=>e({selected:r}),list:async(r={})=>{e({loading:!0});try{const a=((await br.get("/cases",{params:r})).data??[]).map(Zu);e({items:a})}catch(n){const a=(n==null?void 0:n.message)||"";if(a.includes("404")||a.includes("Not Found")){e({items:[]});return}if(a.includes("401")||a.includes("Unauthorized"))try{const{refresh:i}=await wm(async()=>{const{refresh:h}=await Promise.resolve().then(()=>cm);return{refresh:h}},void 0);await i();const s=((await br.get("/cases",{params:r})).data??[]).map(Zu);e({items:s});return}catch{throw n}throw n}finally{e({loading:!1})}},get:async r=>{try{const n=await br.get(`/cases/${r}`);return Zu(n.data)}catch(n){const a=(n==null?void 0:n.message)||"";throw a.includes("401")||a.includes("403")||a.includes("404")||a.includes("Unauthorized")||a.includes("Not Found")?new Error("Case not found"):n}},create:async r=>{var u,s;const n={...r,priority:(u=r.priority)==null?void 0:u.toLowerCase(),status:(s=r.status)==null?void 0:s.toLowerCase()},a=await br.post("/cases",n),i=Zu(a.data);return await t().list(),i},update:async(r,n)=>{var a,i;try{const u={...n,priority:(a=n.priority)==null?void 0:a.toLowerCase(),status:(i=n.status)==null?void 0:i.toLowerCase()},s=await br.patch(`/cases/${r}`,u),h=Zu(s.data);return e(p=>{var g;return{items:p.items.map(v=>v.id===r?h:v),selected:((g=p.selected)==null?void 0:g.id)===r?h:p.selected}}),h}catch(u){const s=(u==null?void 0:u.message)||"";throw s.includes("401")||s.includes("403")||s.includes("404")||s.includes("Unauthorized")||s.includes("Not Found")?new Error("Failed to update case"):u}},listNotes:async r=>{try{return(await br.get(`/cases/${r}/notes`)).data??[]}catch(n){const a=(n==null?void 0:n.message)||"";if(a.includes("401")||a.includes("403")||a.includes("404")||a.includes("Unauthorized")||a.includes("Not Found"))return[];throw n}},addNote:async(r,n)=>(await br.post(`/cases/${r}/notes`,{body:n})).data,assignAlerts:async(r,n)=>{try{await br.post(`/cases/${r}/alerts:assign`,{alertIds:n})}catch(a){const i=(a==null?void 0:a.message)||"";throw i.includes("401")||i.includes("403")||i.includes("404")||i.includes("Unauthorized")||i.includes("Not Found")?new Error("Failed to assign alerts"):a}},adoptPriority:async r=>{try{const n=await br.patch(`/cases/${r}/adopt/priority`),a=Zu(n.data);return e(i=>{var u;return{items:i.items.map(s=>s.id===r?a:s),selected:((u=i.selected)==null?void 0:u.id)===r?a:i.selected}}),a}catch(n){const a=(n==null?void 0:n.message)||"";throw a.includes("401")||a.includes("403")||a.includes("404")||a.includes("Unauthorized")||a.includes("Not Found")?new Error("Failed to adopt priority suggestion"):n}},adoptOwner:async r=>{try{const n=await br.patch(`/cases/${r}/adopt/owner`),a=Zu(n.data);return e(i=>{var u;return{items:i.items.map(s=>s.id===r?a:s),selected:((u=i.selected)==null?void 0:u.id)===r?a:i.selected}}),a}catch(n){const a=(n==null?void 0:n.message)||"";throw a.includes("401")||a.includes("403")||a.includes("404")||a.includes("Unauthorized")||a.includes("Not Found")?new Error("Failed to adopt owner suggestion"):n}}}));function qR({isOpen:e,onClose:t,case:r,onSubmit:n}){const[a,i]=se.useState(""),[u,s]=se.useState(""),[h,p]=se.useState("medium"),[g,v]=se.useState("open"),[x,S]=se.useState(""),[P,N]=se.useState(!1),[M,I]=se.useState(null);se.useEffect(()=>{r&&r.id?(i(r.title||""),s(r.description||""),p(r.priority||"medium"),v(r.status||"open"),S(r.owner||"")):r&&r.title?(i(r.title||""),s(""),p("medium"),v("open"),S("")):(i(""),s(""),p("medium"),v("open"),S("")),I(null)},[r,e]);const A=async D=>{if(D.preventDefault(),!a.trim()){I("Title is required");return}N(!0),I(null);try{await n({title:a.trim(),description:u.trim()||null,priority:h.toLowerCase(),status:g.toLowerCase(),owner:x.trim()||null}),t()}catch(j){I((j==null?void 0:j.message)||"Failed to save case")}finally{N(!1)}};return w.jsx(eo,{isOpen:e,onClose:t,title:r&&r.id?"Edit Case":"Create Case",children:w.jsxs("form",{onSubmit:A,className:"space-y-4",children:[M&&w.jsx("div",{className:"bg-red-600/20 border border-red-600 rounded px-3 py-2 text-red-200 text-sm",children:M}),w.jsxs("div",{children:[w.jsxs("label",{className:"block text-sm font-medium text-white/80 mb-1",children:["Title ",w.jsx("span",{className:"text-red-400",children:"*"})]}),w.jsx("input",{type:"text",className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white focus:outline-none focus:border-teal-500",value:a,onChange:D=>i(D.target.value),required:!0,autoFocus:!0})]}),w.jsxs("div",{children:[w.jsx("label",{className:"block text-sm font-medium text-white/80 mb-1",children:"Description"}),w.jsx("textarea",{className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white focus:outline-none focus:border-teal-500 h-24 resize-none",value:u,onChange:D=>s(D.target.value)})]}),w.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[w.jsxs("div",{children:[w.jsx("label",{className:"block text-sm font-medium text-white/80 mb-1",children:"Priority"}),w.jsxs("select",{className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white focus:outline-none focus:border-teal-500",value:h,onChange:D=>p(D.target.value),children:[w.jsx("option",{value:"low",children:"Low"}),w.jsx("option",{value:"medium",children:"Medium"}),w.jsx("option",{value:"high",children:"High"}),w.jsx("option",{value:"critical",children:"Critical"})]})]}),w.jsxs("div",{children:[w.jsx("label",{className:"block text-sm font-medium text-white/80 mb-1",children:"Status"}),w.jsxs("select",{className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white focus:outline-none focus:border-teal-500",value:g,onChange:D=>v(D.target.value),children:[w.jsx("option",{value:"open",children:"Open"}),w.jsx("option",{value:"in_progress",children:"In Progress"}),w.jsx("option",{value:"resolved",children:"Resolved"}),w.jsx("option",{value:"closed",children:"Closed"})]})]})]}),w.jsxs("div",{children:[w.jsx("label",{className:"block text-sm font-medium text-white/80 mb-1",children:"Owner"}),w.jsx("input",{type:"text",className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white focus:outline-none focus:border-teal-500",value:x,onChange:D=>S(D.target.value),placeholder:"user@example.com"})]}),w.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[w.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 rounded text-white/80 hover:text-white hover:bg-white/10",disabled:P,children:"Cancel"}),w.jsx("button",{type:"submit",className:"px-4 py-2 rounded bg-teal-600 hover:bg-teal-700 text-white",disabled:P,children:P?"Saving...":r?"Update":"Create"})]})]})})}const HR=Ti(()=>({loadLogs:async e=>{var t;try{return(await br.get(`/alerts/${e}/actions/logs`)).data||[]}catch(r){const n=(t=r==null?void 0:r.response)==null?void 0:t.status,a=(r==null?void 0:r.message)||"";return n===401||n===403||n===404||a.includes("Unauthorized")||a.includes("Forbidden")||a.includes("Not Found")?[]:(console.error("Failed to load action logs:",a),[])}},previewRoutes:async e=>{var t;try{return(await br.post(`/alerts/${e}/actions/preview`)).data||[]}catch(r){const n=(t=r==null?void 0:r.response)==null?void 0:t.status,a=(r==null?void 0:r.message)||"";return n===401||n===403||n===404||a.includes("Unauthorized")||a.includes("Forbidden")||a.includes("Not Found")?[]:(console.error("Failed to preview routes:",a),[])}},retry:async(e,t)=>{var r;try{return(await br.post(`/alerts/${e}/actions/retry`,{dest:t})).data}catch(n){const a=(r=n==null?void 0:n.response)==null?void 0:r.status,i=(n==null?void 0:n.message)||"";throw a===401||a===403||a===404||i.includes("Unauthorized")||i.includes("Forbidden")||i.includes("Not Found")||console.error("Failed to retry action:",i),n}},retryAllFailed:async e=>{var t;try{return(await br.post(`/alerts/${e}/actions/retry-all-failed`)).data||[]}catch(r){const n=(t=r==null?void 0:r.response)==null?void 0:t.status,a=(r==null?void 0:r.message)||"";throw n===401||n===403||n===404||a.includes("Unauthorized")||a.includes("Forbidden")||a.includes("Not Found")||console.error("Failed to retry all failed actions:",a),r}}}));function Bw(e){return{id:e.id,ruleId:e.ruleId??null,playbookId:e.playbookId,mode:e.mode,matchTypes:e.matchTypes??[],matchSeverities:e.matchSeverities??[],matchTags:e.matchTags??[],maxPerMinute:e.maxPerMinute??30,maxConcurrent:e.maxConcurrent??5,dailyQuota:e.dailyQuota??500,enabled:e.enabled??!0,createdBy:e.createdBy,createdAt:e.createdAt,updatedAt:e.updatedAt}}function jw(e){return{id:String(e.id),alertId:e.alertId,bindingId:e.bindingId??null,playbookId:e.playbookId,mode:e.mode,decision:e.decision,reason:e.reason,requestedBy:e.requestedBy,startedAt:e.startedAt,finishedAt:e.finishedAt,success:e.success,outputRef:e.outputRef}}const uE=Ti((e,t)=>({bindings:[],auditByAlertId:{},previewByAlertId:{},loading:!1,error:void 0,clearError:()=>e({error:void 0}),list:async r=>{var n;e({loading:!0});try{const i=((await br.get("/bindings",{params:r})).data??[]).map(Bw);return e({bindings:i,loading:!1,error:void 0}),i}catch(a){const i=(n=a==null?void 0:a.response)==null?void 0:n.status,u=(a==null?void 0:a.message)||"Failed to load bindings";return i===401||i===403?(e({loading:!1}),[]):(console.error("Failed to list bindings:",u),e({loading:!1,error:u}),[])}},create:async r=>{var n;try{const a=await br.post("/bindings",{ruleId:r.ruleId??null,playbookId:r.playbookId,mode:r.mode,matchTypes:r.matchTypes??[],matchSeverities:r.matchSeverities??[],matchTags:r.matchTags??[],maxPerMinute:r.maxPerMinute??30,maxConcurrent:r.maxConcurrent??5,dailyQuota:r.dailyQuota??500,enabled:r.enabled??!0}),i=Bw(a.data);return e({bindings:[...t().bindings,i],error:void 0}),i}catch(a){const i=(n=a==null?void 0:a.response)==null?void 0:n.status,u=(a==null?void 0:a.message)||"Failed to create binding";throw i===401||i===403?(e({error:u}),a):(console.error("Failed to create binding:",u),e({error:u}),a)}},update:async(r,n)=>{var a;try{const i=await br.put(`/bindings/${r}`,{ruleId:n.ruleId??null,playbookId:n.playbookId,mode:n.mode,matchTypes:n.matchTypes??[],matchSeverities:n.matchSeverities??[],matchTags:n.matchTags??[],maxPerMinute:n.maxPerMinute??30,maxConcurrent:n.maxConcurrent??5,dailyQuota:n.dailyQuota??500,enabled:n.enabled??!0}),u=Bw(i.data);return e({bindings:t().bindings.map(s=>s.id===u.id?u:s),error:void 0}),u}catch(i){const u=(a=i==null?void 0:i.response)==null?void 0:a.status,s=(i==null?void 0:i.message)||"Failed to update binding";throw u===401||u===403?(e({error:s}),i):(console.error("Failed to update binding:",s),e({error:s}),i)}},remove:async r=>{var n;try{return await br.delete(`/bindings/${r}`),e({bindings:t().bindings.filter(a=>a.id!==r),error:void 0}),!0}catch(a){const i=(n=a==null?void 0:a.response)==null?void 0:n.status,u=(a==null?void 0:a.message)||"Failed to delete binding";return i===401||i===403?(e({error:u}),!1):(console.error("Failed to delete binding:",u),e({error:u}),!1)}},preview:async r=>{var n;try{const i=((await br.post(`/alerts/${r}/bindings/evaluate`)).data??[]).map(jw);return e({previewByAlertId:{...t().previewByAlertId,[r]:i},error:void 0}),i}catch(a){const i=(n=a==null?void 0:a.response)==null?void 0:n.status,u=(a==null?void 0:a.message)||"Failed to preview bindings";return i===401||i===403?[]:(console.error("Failed to preview bindings:",u),e({error:u}),[])}},run:async(r,n)=>{var a;try{const i=await br.post(`/alerts/${r}/bindings/run`,{bindingId:n}),u=jw(i.data),s=t().auditByAlertId[r]??[];return e({auditByAlertId:{...t().auditByAlertId,[r]:[u,...s]},previewByAlertId:t().previewByAlertId,error:void 0}),await t().preview(r),u}catch(i){const u=(a=i==null?void 0:i.response)==null?void 0:a.status,s=(i==null?void 0:i.message)||"Failed to run binding";throw u===401||u===403?(e({error:s}),i):(console.error("Failed to run binding:",s),e({error:s}),i)}},loadAudit:async r=>{var n;try{const i=((await br.get(`/alerts/${r}/bindings/audit`)).data??[]).map(jw);return e({auditByAlertId:{...t().auditByAlertId,[r]:i},previewByAlertId:t().previewByAlertId,error:void 0}),i}catch(a){const i=(n=a==null?void 0:a.response)==null?void 0:n.status,u=(a==null?void 0:a.message)||"Failed to load audit";return i===401||i===403?[]:(console.error("Failed to load bindings audit:",u),e({error:u}),[])}}}));function cE({className:e="",variant:t="default",...r}){const n="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold transition-colors",a={default:"bg-primary text-primary-foreground",secondary:"bg-secondary text-secondary-foreground",destructive:"bg-destructive text-destructive-foreground",outline:"border border-input bg-background"};return w.jsx("div",{className:`${n} ${a[t]} ${e}`.trim(),...r})}function DH({alertId:e}){const{loadLogs:t,retryAllFailed:r}=HR(),{loadAudit:n,auditByAlertId:a}=uE(),[i,u]=se.useState([]),[s,h]=se.useState(!0),[p,g]=se.useState(!1),v=On("analyst")||On("admin"),x=a[e]??[];se.useEffect(()=>{S(),P();const D=setInterval(()=>{document.hidden||(S(),P())},1e4);return()=>clearInterval(D)},[e]);const S=async()=>{h(!0);try{const D=await t(e);u(D)}catch{}finally{h(!1)}},P=async()=>{try{await n(e)}catch{}},N=async()=>{g(!0);try{await r(e),St("Retry scheduled for all failed destinations"),await S()}catch{}finally{g(!1)}},M=D=>D==="success"?"bg-green-600":D==="failed"?"bg-red-600":D==="retry"||D==="retry_scheduled"?"bg-amber-600":"bg-gray-600",I=D=>{if(!D)return null;const j=new Date(D),V=new Date,U=j.getTime()-V.getTime();if(U<=0)return"Now";const $=Math.floor(U/6e4);return $<1?"<1m":$<60?`~${$}m`:`~${Math.floor($/60)}h`};if(s&&i.length===0)return w.jsx("div",{className:"text-white/60 text-sm",children:"Loading delivery trace..."});if(i.length===0)return w.jsxs("div",{className:"space-y-4",children:[w.jsx("div",{className:"text-white/60 text-sm",children:"No delivery attempts yet"}),w.jsx(uA,{runs:x})]});const A=i.some(D=>D.status==="failed"||D.status==="retry");return w.jsxs("div",{className:"space-y-4",children:[w.jsxs("div",{className:"flex items-center justify-between",children:[w.jsx("h3",{className:"text-lg font-semibold text-white",children:"Delivery Trace"}),w.jsxs("div",{className:"flex gap-2",children:[w.jsx("button",{onClick:S,className:"px-3 py-1.5 text-sm text-white/80 hover:text-white bg-white/5 hover:bg-white/10 rounded border border-white/20",children:"Refresh"}),v&&A&&w.jsx("button",{onClick:N,disabled:p,className:"px-3 py-1.5 text-sm bg-teal-600 hover:bg-teal-700 disabled:opacity-50 text-white rounded",children:p?"Retrying...":"Retry Failed"})]})]}),w.jsx("div",{className:"space-y-2",children:i.map(D=>w.jsxs("div",{className:"bg-white/5 rounded-lg p-3 border border-white/10",children:[w.jsxs("div",{className:"flex items-start justify-between mb-2",children:[w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx(cE,{className:`${M(D.status)} text-white text-xs`,children:D.status}),w.jsx("span",{className:"text-sm font-medium text-white",children:D.dest}),w.jsxs("span",{className:"text-xs text-white/60",children:["Attempt #",D.attempt]})]}),D.status==="retry"&&D.scheduledAt&&w.jsxs("span",{className:"text-xs text-amber-400",children:["Next retry in ",I(D.scheduledAt)]})]}),D.httpStatus&&w.jsxs("div",{className:"text-xs text-white/60 mb-1",children:["HTTP ",D.httpStatus]}),D.error&&w.jsx("div",{className:"text-xs text-red-400 mb-1 truncate",title:D.error,children:D.error}),w.jsx("div",{className:"text-xs text-white/40",children:D.sentAt?`Sent: ${new Date(D.sentAt).toLocaleString()}`:`Created: ${new Date(D.createdAt).toLocaleString()}`})]},D.id))}),w.jsx(uA,{runs:x})]})}function uA({runs:e}){return!e||e.length===0?w.jsx("div",{className:"text-white/50 text-xs bg-white/5 border border-white/10 rounded-lg px-3 py-2",children:"No playbook binding activity yet."}):w.jsxs("div",{className:"space-y-2",children:[w.jsx("h4",{className:"text-sm font-semibold text-white",children:"Playbook Runs"}),e.map(t=>w.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-lg px-3 py-2 text-xs text-white/80",children:[w.jsxs("div",{className:"flex justify-between",children:[w.jsxs("span",{className:"font-mono",children:["Binding ",t.bindingId??"global"]}),w.jsx("span",{className:"text-white/50",children:t.startedAt})]}),w.jsxs("div",{className:"flex justify-between mt-1",children:[w.jsxs("span",{className:"capitalize",children:["Mode: ",t.mode.replace("_"," ")]}),w.jsxs("span",{className:"text-teal-300",children:["Decision: ",t.decision]})]}),t.reason&&w.jsxs("div",{className:"text-yellow-200 mt-1",children:["Reason: ",t.reason]}),t.outputRef&&w.jsxs("div",{className:"text-white/60 mt-1",children:["Output: ",t.outputRef]}),typeof t.success=="boolean"&&w.jsxs("div",{className:"text-white/50 mt-1",children:["Success: ",t.success?"yes":"no"]})]},t.id))]})}function zH({alertId:e}){const{previewRoutes:t,retry:r}=HR(),[n,a]=se.useState([]),[i,u]=se.useState(!0),[s,h]=se.useState(null),p=On("analyst")||On("admin");se.useEffect(()=>{g()},[e]);const g=async()=>{u(!0);try{const x=await t(e);a(x)}catch{}finally{u(!1)}},v=async x=>{h(x);try{const S=x.split(":")[0];await r(e,S),St(`Retry scheduled for ${S}`),await g()}catch{}finally{h(null)}};return i&&n.length===0?w.jsx("div",{className:"text-white/60 text-sm",children:"Loading routing preview..."}):n.length===0?w.jsx("div",{className:"text-white/60 text-sm",children:"No routes configured"}):w.jsxs("div",{className:"space-y-4",children:[w.jsxs("div",{className:"flex items-center justify-between",children:[w.jsx("h3",{className:"text-lg font-semibold text-white",children:"Routing Preview"}),w.jsx("button",{onClick:g,className:"px-3 py-1.5 text-sm text-white/80 hover:text-white bg-white/5 hover:bg-white/10 rounded border border-white/20",children:"Refresh"})]}),w.jsx("div",{className:"space-y-2",children:n.map((x,S)=>w.jsxs("div",{className:"bg-white/5 rounded-lg p-3 border border-white/10",children:[w.jsxs("div",{className:"flex items-start justify-between mb-2",children:[w.jsxs("div",{className:"flex items-center gap-2",children:[x.wouldSend?w.jsx("span",{className:"text-green-400 text-lg",children:""}):x.suppressed?w.jsx("span",{className:"text-purple-400 text-lg",children:""}):w.jsx("span",{className:"text-gray-400 text-lg",children:""}),w.jsx("span",{className:"text-sm font-medium text-white",children:x.dest})]}),p&&!x.wouldSend&&!x.suppressed&&w.jsx("button",{onClick:()=>v(x.dest),disabled:s===x.dest,className:"px-3 py-1.5 text-sm bg-teal-600 hover:bg-teal-700 disabled:opacity-50 text-white rounded",children:s===x.dest?"Retrying...":"Retry Now"})]}),w.jsx("div",{className:"text-sm text-white/70 mb-1",children:x.reason}),x.suppressed&&w.jsx("div",{className:"text-xs text-purple-400",children:"Alert is suppressed"})]},S))})]})}const mp=(e,t)=>`${e}:${t}`,GR=Ti((e,t)=>({actions:[],playbooks:[],runs:{},loading:!1,error:null,listActions:async()=>{try{const r="http://localhost:8091",n=bi(),a={};n&&(a.Authorization=`Bearer ${n}`);const i=await fetch(`${r}/enrich/actions`,{headers:a});if(!i.ok){if(i.status===404){e({actions:[]});return}throw new Error(`HTTP ${i.status}: ${i.statusText}`)}const u=await i.json();e({actions:u||[]})}catch(r){const n=(r==null?void 0:r.message)||"";if(n.includes("404")||n.includes("Not Found")){e({actions:[]});return}console.error("Failed to load actions:",n),e({error:n,actions:[]})}},listPlaybooks:async()=>{try{const r="http://localhost:8091",n=bi(),a={};n&&(a.Authorization=`Bearer ${n}`);const i=await fetch(`${r}/enrich/playbooks`,{headers:a});if(!i.ok){if(i.status===404){e({playbooks:[]});return}throw new Error(`HTTP ${i.status}: ${i.statusText}`)}const u=await i.json();e({playbooks:u||[]})}catch(r){const n=(r==null?void 0:r.message)||"";if(n.includes("404")||n.includes("Not Found")){e({playbooks:[]});return}console.error("Failed to load playbooks:",n),e({error:n,playbooks:[]})}},runAction:async(r,n,a,i=!1)=>{try{const u="http://localhost:8091",s=(await wm(async()=>{const{getToken:S}=await Promise.resolve().then(()=>cm);return{getToken:S}},void 0)).getToken(),h={"Content-Type":"application/json"};s&&(h.Authorization=`Bearer ${s}`);const p=await fetch(`${u}/enrich/run`,{method:"POST",headers:h,body:JSON.stringify({subjectKind:r,subjectId:n,actionId:a,attachAsNote:i})});if(!p.ok){const S=await p.json().catch(()=>({detail:p.statusText}));throw new Error(`HTTP ${p.status}: ${S.detail||p.statusText}`)}const g=await p.json(),v=mp(r,n),x=t().runs[v]||[];return e({runs:{...t().runs,[v]:[g,...x]}}),typeof localStorage<"u"&&localStorage.setItem("halcyon:lastEnrichAction",a),g}catch(u){const s=(u==null?void 0:u.message)||"Failed to run action";throw e({error:s}),u}},runPlaybook:async(r,n,a,i=!1)=>{try{const u="http://localhost:8091",s=(await wm(async()=>{const{getToken:S}=await Promise.resolve().then(()=>cm);return{getToken:S}},void 0)).getToken(),h={"Content-Type":"application/json"};s&&(h.Authorization=`Bearer ${s}`);const p=await fetch(`${u}/enrich/playbooks/run`,{method:"POST",headers:h,body:JSON.stringify({subjectKind:r,subjectId:n,playbookId:a,attachAsNote:i})});if(!p.ok){const S=await p.json().catch(()=>({detail:p.statusText}));throw new Error(`HTTP ${p.status}: ${S.detail||p.statusText}`)}const g=await p.json(),v=mp(r,n),x=t().runs[v]||[];return e({runs:{...t().runs,[v]:[g,...x]}}),typeof localStorage<"u"&&localStorage.setItem("halcyon:lastEnrichPlaybook",a),g}catch(u){const s=(u==null?void 0:u.message)||"Failed to run playbook";throw e({error:s}),u}},listRuns:async(r,n)=>{try{const a="http://localhost:8091",i=bi(),u={};i&&(u.Authorization=`Bearer ${i}`);const s=`${a}/enrich/runs?subjectKind=${r}&subjectId=${n}`,h=await fetch(s,{headers:u});if(!h.ok){if(h.status===404){const v=mp(r,n);e({runs:{...t().runs,[v]:[]}});return}throw new Error(`HTTP ${h.status}: ${h.statusText}`)}const p=await h.json(),g=mp(r,n);e({runs:{...t().runs,[g]:p||[]}})}catch(a){const i=(a==null?void 0:a.message)||"";if(i.includes("404")||i.includes("Not Found")){const u=mp(r,n);e({runs:{...t().runs,[u]:[]}});return}console.error("Failed to load runs:",i),e({error:i})}}}));function WR({run:e,onClose:t,onAttachAsNote:r,canAttachAsNote:n=!1}){const[a,i]=se.useState(!1),u=()=>{const h=JSON.stringify(e.output||e,null,2);navigator.clipboard.writeText(h),i(!0),setTimeout(()=>i(!1),2e3)},s=h=>h==="success"?"text-green-400":h==="failed"?"text-red-400":h==="running"?"text-yellow-400":"text-gray-400";return w.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center",children:w.jsxs("div",{className:"bg-panel border border-white/20 rounded-lg w-full max-w-3xl max-h-[90vh] flex flex-col",children:[w.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/10",children:[w.jsx("h2",{className:"text-xl font-semibold text-white",children:"Run Output"}),w.jsxs("div",{className:"flex items-center gap-2",children:[n&&r&&w.jsx("button",{onClick:r,className:"px-3 py-1 text-sm bg-teal-600 hover:bg-teal-700 rounded text-white",children:"Attach as Note"}),w.jsx("button",{onClick:u,className:"px-3 py-1 text-sm bg-gray-600 hover:bg-gray-700 rounded text-white",children:a?"Copied!":"Copy"}),w.jsx("button",{onClick:t,className:"text-white/60 hover:text-white text-2xl",children:""})]})]}),w.jsxs("div",{className:"flex-1 overflow-auto p-6",children:[e.error&&w.jsxs("div",{className:"mb-4 p-3 bg-red-900/20 border border-red-500/50 rounded",children:[w.jsx("h3",{className:"text-sm font-semibold text-red-400 mb-1",children:"Error"}),w.jsx("p",{className:"text-white text-sm",children:e.error})]}),e.steps&&e.steps.length>0&&w.jsxs("div",{className:"mb-4",children:[w.jsx("h3",{className:"text-sm font-semibold text-white/60 mb-2",children:"Steps"}),w.jsx("div",{className:"space-y-2",children:e.steps.map((h,p)=>w.jsxs("div",{className:"p-3 bg-white/5 rounded border border-white/10",children:[w.jsxs("div",{className:"flex items-center justify-between mb-2",children:[w.jsx("span",{className:"text-sm font-medium text-white",children:h.stepId||h.kind}),w.jsx("span",{className:`text-xs ${s(h.status)}`,children:h.status})]}),h.output&&w.jsxs("details",{className:"mt-2",children:[w.jsx("summary",{className:"text-xs text-white/60 cursor-pointer",children:"Output"}),w.jsx("pre",{className:"mt-2 p-2 bg-black/30 rounded text-xs text-white overflow-auto max-h-40",children:JSON.stringify(h.output,null,2)})]}),h.error&&w.jsx("p",{className:"mt-2 text-xs text-red-400",children:h.error}),w.jsxs("p",{className:"mt-1 text-xs text-white/40",children:["Duration: ",h.durationMs,"ms"]})]},p))})]}),e.output&&w.jsxs("div",{children:[w.jsx("h3",{className:"text-sm font-semibold text-white/60 mb-2",children:"Output"}),w.jsx("pre",{className:"p-4 bg-black/30 rounded text-sm text-white overflow-auto max-h-96",children:JSON.stringify(e.output,null,2)})]}),!e.output&&!e.error&&!e.steps&&w.jsx("div",{className:"text-center text-white/60 py-8",children:"No output available"})]})]})})}function ZR({subjectKind:e,subjectId:t}){const{actions:r,runs:n,loading:a,listActions:i,runAction:u,listRuns:s}=GR(),[h,p]=se.useState(""),[g,v]=se.useState(null),[x,S]=se.useState(null),P=On("analyst")||On("admin"),N=String(t),M=`${e}:${N}`,I=n[M]||[],A=typeof localStorage<"u"?localStorage.getItem("halcyon:lastEnrichAction"):null;se.useEffect(()=>{i(),s(e,N)},[e,N,i,s]);const D=async $=>{if(P){S($);try{await u(e,N,$,!1),St("Action completed successfully"),await s(e,N)}catch(W){St(`Failed to run action: ${(W==null?void 0:W.message)||"Unknown error"}`)}finally{S(null)}}},j=r.filter($=>$.name.toLowerCase().includes(h.toLowerCase())||$.kind.toLowerCase().includes(h.toLowerCase())),V=$=>$==="success"?"bg-green-600":$==="failed"?"bg-red-600":$==="running"?"bg-yellow-600":"bg-gray-600",U=$=>$?$<1e3?`${$}ms`:`${($/1e3).toFixed(2)}s`:"N/A";return w.jsxs("div",{className:"space-y-4",children:[w.jsxs("div",{children:[w.jsxs("div",{className:"flex items-center justify-between mb-3",children:[w.jsx("h3",{className:"text-sm font-semibold text-white",children:"Actions"}),w.jsx("input",{type:"text",placeholder:"Search actions...",value:h,onChange:$=>p($.target.value),className:"bg-panel border border-white/20 rounded px-3 py-1 text-sm text-white placeholder-white/40 focus:outline-none focus:border-teal-500"})]}),a&&r.length===0?w.jsx("div",{className:"text-center text-white/60 py-4",children:"Loading actions..."}):j.length===0?w.jsx("div",{className:"text-center text-white/60 py-4",children:"No actions found"}):w.jsx("div",{className:"space-y-2",children:j.map($=>w.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded border border-white/10",children:[w.jsxs("div",{className:"flex-1",children:[w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx("span",{className:"text-sm font-medium text-white",children:$.name}),A===$.id&&w.jsx("span",{className:"text-xs bg-teal-600 px-2 py-0.5 rounded",children:"Last used"})]}),w.jsx("span",{className:"text-xs text-white/60",children:$.kind})]}),P&&w.jsx("button",{onClick:()=>D($.id),disabled:x===$.id,className:"px-3 py-1 text-sm bg-teal-600 hover:bg-teal-700 disabled:bg-gray-600 disabled:cursor-not-allowed rounded text-white",children:x===$.id?"Running...":"Run"})]},$.id))})]}),w.jsxs("div",{children:[w.jsx("h3",{className:"text-sm font-semibold text-white mb-3",children:"History"}),I.length===0?w.jsx("div",{className:"text-center text-white/60 py-4",children:"No runs yet"}):w.jsx("div",{className:"space-y-2",children:I.filter($=>$.kind==="action").map($=>{var W,X;return w.jsxs("div",{className:"p-3 bg-white/5 rounded border border-white/10 cursor-pointer hover:bg-white/10",onClick:()=>v($),children:[w.jsxs("div",{className:"flex items-center justify-between mb-1",children:[w.jsx("span",{className:"text-sm font-medium text-white",children:((W=$.ref)==null?void 0:W.actionId)||"Unknown action"}),w.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${V($.status)}`,children:$.status})]}),w.jsxs("div",{className:"flex items-center gap-4 text-xs text-white/60",children:[w.jsx("span",{children:$.startedAt?new Date($.startedAt).toLocaleString():"N/A"}),((X=$.metrics)==null?void 0:X.latencyMs)&&w.jsxs("span",{children:["Duration: ",U($.metrics.latencyMs)]})]})]},$.id)})})]}),g&&w.jsx(WR,{run:g,onClose:()=>v(null),canAttachAsNote:e==="case"||e==="alert"&&g.subjectId})]})}function XR({subjectKind:e,subjectId:t}){const{playbooks:r,runs:n,loading:a,listPlaybooks:i,runPlaybook:u,listRuns:s}=GR(),[h,p]=se.useState(null),[g,v]=se.useState(null),x=On("analyst")||On("admin"),S=String(t),P=`${e}:${S}`,N=n[P]||[],M=typeof localStorage<"u"?localStorage.getItem("halcyon:lastEnrichPlaybook"):null;se.useEffect(()=>{i(),s(e,S)},[e,S,i,s]);const I=async j=>{if(x){v(j);try{await u(e,S,j,!1),St("Playbook completed successfully"),await s(e,S)}catch(V){St(`Failed to run playbook: ${(V==null?void 0:V.message)||"Unknown error"}`)}finally{v(null)}}},A=j=>j==="success"?"text-green-400":j==="failed"?"text-red-400":j==="running"?"text-yellow-400":"text-gray-400",D=j=>j==="success"?"bg-green-600":j==="failed"?"bg-red-600":j==="running"||j==="pending"?"bg-yellow-600":"bg-gray-600";return w.jsxs("div",{className:"space-y-4",children:[w.jsxs("div",{children:[w.jsx("h3",{className:"text-sm font-semibold text-white mb-3",children:"Playbooks"}),a&&r.length===0?w.jsx("div",{className:"text-center text-white/60 py-4",children:"Loading playbooks..."}):r.length===0?w.jsx("div",{className:"text-center text-white/60 py-4",children:"No playbooks available"}):w.jsx("div",{className:"space-y-2",children:r.map(j=>w.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded border border-white/10",children:[w.jsxs("div",{className:"flex-1",children:[w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx("span",{className:"text-sm font-medium text-white",children:j.name}),M===j.id&&w.jsx("span",{className:"text-xs bg-teal-600 px-2 py-0.5 rounded",children:"Last used"})]}),w.jsxs("span",{className:"text-xs text-white/60",children:["v",j.version]})]}),x&&w.jsx("button",{onClick:()=>I(j.id),disabled:g===j.id,className:"px-3 py-1 text-sm bg-teal-600 hover:bg-teal-700 disabled:bg-gray-600 disabled:cursor-not-allowed rounded text-white",children:g===j.id?"Running...":"Run"})]},j.id))})]}),w.jsxs("div",{children:[w.jsx("h3",{className:"text-sm font-semibold text-white mb-3",children:"Playbook Runs"}),N.length===0?w.jsx("div",{className:"text-center text-white/60 py-4",children:"No runs yet"}):w.jsx("div",{className:"space-y-3",children:N.filter(j=>j.kind==="playbook").map(j=>{var V,U;return w.jsxs("div",{className:"p-3 bg-white/5 rounded border border-white/10 cursor-pointer hover:bg-white/10",onClick:()=>p(j),children:[w.jsxs("div",{className:"flex items-center justify-between mb-2",children:[w.jsx("span",{className:"text-sm font-medium text-white",children:((V=j.ref)==null?void 0:V.playbookId)||"Unknown playbook"}),w.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${A(j.status)}`,children:j.status})]}),j.steps&&j.steps.length>0&&w.jsx("div",{className:"flex gap-2 flex-wrap mb-2",children:j.steps.map(($,W)=>w.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${D($.status)}`,title:`${$.stepId||$.kind}: ${$.status}`,children:$.stepId||$.kind},W))}),w.jsxs("div",{className:"flex items-center gap-4 text-xs text-white/60",children:[w.jsx("span",{children:j.startedAt?new Date(j.startedAt).toLocaleString():"N/A"}),((U=j.metrics)==null?void 0:U.durationMs)&&w.jsxs("span",{children:["Duration: ",j.metrics.durationMs,"ms"]})]})]},j.id)})})]}),h&&w.jsx(WR,{run:h,onClose:()=>p(null),canAttachAsNote:e==="case"||e==="alert"&&h.subjectId})]})}function RH({alert:e,onClose:t}){const[r,n]=se.useState("details"),{previewByAlertId:a,auditByAlertId:i,preview:u,run:s,loadAudit:h}=uE(),p=a[e.id]??[],g=i[e.id]??[];se.useEffect(()=>{r==="bindings"&&(u(e.id).catch(S=>{console.warn("Failed to preview bindings",S)}),h(e.id).catch(S=>{console.warn("Failed to load binding audit",S)}))},[r,e.id,u,h]);const v=async S=>{if(!S){St("Binding does not have an ID (global binding)  cannot force run.");return}try{await s(e.id,S),St("Binding triggered"),await h(e.id)}catch(P){St((P==null?void 0:P.message)||"Failed to run binding")}},x=[{id:"details",label:"Details"},{id:"trace",label:"Trace"},{id:"preview",label:"Preview"},{id:"bindings",label:"Bindings"},{id:"enrich",label:"Enrich"},{id:"playbooks",label:"Playbooks"}];return w.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center",children:w.jsxs("div",{className:"bg-panel border border-white/20 rounded-lg w-full max-w-4xl max-h-[90vh] flex flex-col",children:[w.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/10",children:[w.jsxs("h2",{className:"text-xl font-semibold text-white",children:["Alert #",e.id]}),w.jsx("button",{onClick:t,className:"text-white/60 hover:text-white text-2xl",children:""})]}),w.jsx("div",{className:"flex border-b border-white/10",children:x.map(S=>w.jsx("button",{onClick:()=>n(S.id),className:`px-4 py-2 text-sm font-medium transition-colors ${r===S.id?"text-white border-b-2 border-teal-500":"text-white/60 hover:text-white/80"}`,children:S.label},S.id))}),w.jsxs("div",{className:"flex-1 overflow-auto p-6",children:[r==="details"&&w.jsxs("div",{className:"space-y-4",children:[w.jsxs("div",{children:[w.jsx("h3",{className:"text-sm text-white/60 mb-1",children:"Message"}),w.jsx("p",{className:"text-white",children:e.message})]}),w.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[w.jsxs("div",{children:[w.jsx("h3",{className:"text-sm text-white/60 mb-1",children:"Severity"}),w.jsx("p",{className:"text-white",children:e.severity})]}),w.jsxs("div",{children:[w.jsx("h3",{className:"text-sm text-white/60 mb-1",children:"Status"}),w.jsx("p",{className:"text-white",children:e.status})]}),e.count&&w.jsxs("div",{children:[w.jsx("h3",{className:"text-sm text-white/60 mb-1",children:"Count"}),w.jsx("p",{className:"text-white",children:e.count})]}),e.entityId&&w.jsxs("div",{children:[w.jsx("h3",{className:"text-sm text-white/60 mb-1",children:"Entity ID"}),w.jsx("p",{className:"text-white",children:e.entityId})]})]}),e.fingerprint&&w.jsxs("div",{children:[w.jsx("h3",{className:"text-sm text-white/60 mb-1",children:"Fingerprint"}),w.jsx("p",{className:"text-white font-mono text-xs",children:e.fingerprint})]}),e.suppressedBy&&w.jsxs("div",{children:[w.jsx("h3",{className:"text-sm text-white/60 mb-1",children:"Suppressed"}),w.jsxs("p",{className:"text-purple-400",children:[e.suppressedBy.kind,": ",e.suppressedBy.name]})]}),w.jsxs("div",{children:[w.jsx("h3",{className:"text-sm text-white/60 mb-1",children:"Created"}),w.jsx("p",{className:"text-white text-sm",children:(()=>{try{if(!e.createdAt)return"N/A";const S=new Date(e.createdAt);return isNaN(S.getTime())?"Invalid Date":S.toLocaleString()}catch{return"Invalid Date"}})()})]})]}),r==="trace"&&w.jsx(DH,{alertId:e.id}),r==="preview"&&w.jsx(zH,{alertId:e.id}),r==="bindings"&&w.jsxs("div",{className:"space-y-6",children:[w.jsxs("div",{children:[w.jsx("h3",{className:"text-sm font-semibold text-white",children:"Binding Decisions"}),w.jsx("p",{className:"text-xs text-white/60 mb-3",children:"Preview shows how bindings match this alert and highlights guardrail reasons. Manual runs override guardrails for analyst/admins."}),w.jsxs("div",{className:"overflow-hidden border border-white/10 rounded-lg",children:[w.jsxs("div",{className:"grid grid-cols-12 text-xs font-semibold uppercase tracking-wide text-white/70 bg-white/10 px-3 py-2",children:[w.jsx("span",{className:"col-span-2",children:"Binding"}),w.jsx("span",{className:"col-span-2",children:"Mode"}),w.jsx("span",{className:"col-span-3",children:"Decision"}),w.jsx("span",{className:"col-span-3",children:"Reason"}),w.jsx("span",{className:"col-span-2 text-right",children:"Action"})]}),p.length===0?w.jsx("div",{className:"px-3 py-4 text-sm text-white/60",children:"No bindings matched this alert."}):p.map(S=>w.jsxs("div",{className:"grid grid-cols-12 items-center px-3 py-3 border-t border-white/10 text-sm text-white/80",children:[w.jsx("div",{className:"col-span-2 text-xs font-mono",children:S.bindingId??"global"}),w.jsx("div",{className:"col-span-2 capitalize",children:S.mode.replace("_"," ")}),w.jsx("div",{className:"col-span-3",children:w.jsx("span",{className:`px-2 py-1 rounded text-xs ${S.decision==="suggested"?"bg-teal-500/20 text-teal-300":S.decision.includes("fail")?"bg-red-500/20 text-red-300":"bg-white/10 text-white"}`,children:S.decision})}),w.jsx("div",{className:"col-span-3 text-xs text-white/60",children:S.reason||""}),w.jsx("div",{className:"col-span-2 text-right",children:S.decision==="suggested"&&w.jsx("button",{className:"px-3 py-1 rounded bg-teal-600 hover:bg-teal-500 text-xs text-white",onClick:()=>v(S.bindingId),children:"Run now"})})]},S.id))]})]}),w.jsxs("div",{children:[w.jsx("h3",{className:"text-sm font-semibold text-white",children:"Recent Runs"}),w.jsx("p",{className:"text-xs text-white/60 mb-3",children:"Timeline of binding evaluations and runs for this alert."}),w.jsx("div",{className:"space-y-3",children:g.length===0?w.jsx("div",{className:"text-sm text-white/60",children:"No audit entries yet."}):g.map(S=>w.jsxs("div",{className:"bg-black/30 border border-white/10 rounded-lg px-3 py-2 text-sm text-white/80",children:[w.jsxs("div",{className:"flex items-center justify-between text-xs text-white/60",children:[w.jsxs("span",{children:["Binding ",S.bindingId??"global"]}),w.jsx("span",{children:S.startedAt})]}),w.jsxs("div",{className:"flex items-center justify-between mt-1",children:[w.jsxs("span",{className:"text-white capitalize",children:["Mode: ",S.mode.replace("_"," ")]}),w.jsxs("span",{className:"text-teal-300 text-xs",children:["Decision: ",S.decision]})]}),S.reason&&w.jsxs("div",{className:"text-xs text-yellow-300 mt-1",children:["Reason: ",S.reason]}),S.outputRef&&w.jsxs("div",{className:"text-xs text-white/50 mt-1",children:["Output: ",S.outputRef]}),typeof S.success=="boolean"&&w.jsxs("div",{className:"text-xs text-white/60 mt-1",children:["Success: ",S.success?"yes":"no"]})]},S.id))})]})]}),r==="enrich"&&w.jsx(ZR,{subjectKind:"alert",subjectId:e.id}),r==="playbooks"&&w.jsx(XR,{subjectKind:"alert",subjectId:e.id})]})]})})}function LH({onCaseChipClick:e}){const{alerts:t,filters:r,setFilters:n,load:a,ack:i,resolve:u}=Ns(),{create:s,assignAlerts:h}=us(),[p,g]=se.useState({isOpen:!1,message:""}),[v,x]=se.useState(new Set),[S,P]=se.useState(!1),[N,M]=se.useState(""),[I,A]=se.useState(null),D=On("analyst")||On("admin");se.useEffect(()=>{a()},[a,r.status,r.severity]);const j=Z=>Z==="high"?"text-red-400":Z==="medium"?"text-yellow-400":"text-blue-400",V=Z=>Z==="open"?"bg-blue-600":Z==="ack"?"bg-yellow-600":"bg-gray-600",U=async Z=>{try{await i(Z)}catch(K){const Y=(K==null?void 0:K.message)||"";if(Y.includes("Unauthorized")||Y.includes("403")||Y.includes("404")||Y.includes("Not Found"))return;g({isOpen:!0,message:Y||"Failed to acknowledge alert"})}},$=async Z=>{try{await u(Z)}catch(K){const Y=(K==null?void 0:K.message)||"";if(Y.includes("Unauthorized")||Y.includes("403")||Y.includes("404")||Y.includes("Not Found"))return;g({isOpen:!0,message:Y||"Failed to resolve alert"})}},W=Z=>{x(K=>{const Y=new Set(K);return Y.has(Z)?Y.delete(Z):Y.add(Z),Y})},X=async Z=>{try{const K=await s(Z);await h(K.id,Array.from(v)),x(new Set),P(!1),await a(),St("Case created and alerts assigned")}catch(K){const Y=(K==null?void 0:K.message)||"";!Y.includes("401")&&!Y.includes("403")&&!Y.includes("404")&&!Y.includes("Unauthorized")&&!Y.includes("Not Found")&&g({isOpen:!0,message:Y||"Failed to create case"})}},J=async Z=>{if(!Z.title||Z.title.trim()===""){if(v.size===0)throw new Error("No alerts selected");const K=t.filter(ie=>v.has(ie.id));if(K.length===0)throw new Error("No alerts selected");const Y=K[0],G=Y.severity.toUpperCase(),oe=Y.message||Y.fingerprint||"Alert";Z.title=`[${G}] ${oe}`}await X(Z)};return w.jsxs(w.Fragment,{children:[w.jsxs("div",{className:"space-y-3",children:[w.jsxs("div",{className:"flex gap-2 items-center",children:[w.jsxs("select",{className:"bg-panel border border-white/20 rounded px-3 py-2 text-white focus:outline-none focus:border-teal-500",value:r.status??"",onChange:Z=>n({status:Z.target.value||void 0}),children:[w.jsx("option",{value:"",className:"bg-panel text-white",children:"All Status"}),w.jsx("option",{value:"open",className:"bg-panel text-white",children:"Open"}),w.jsx("option",{value:"ack",className:"bg-panel text-white",children:"Acknowledged"}),w.jsx("option",{value:"resolved",className:"bg-panel text-white",children:"Resolved"})]}),w.jsxs("select",{className:"bg-panel border border-white/20 rounded px-3 py-2 text-white focus:outline-none focus:border-teal-500",value:r.severity??"",onChange:Z=>n({severity:Z.target.value||void 0}),children:[w.jsx("option",{value:"",className:"bg-panel text-white",children:"All Severity"}),w.jsx("option",{value:"low",className:"bg-panel text-white",children:"Low"}),w.jsx("option",{value:"medium",className:"bg-panel text-white",children:"Medium"}),w.jsx("option",{value:"high",className:"bg-panel text-white",children:"High"})]}),D&&v.size>0&&w.jsxs("button",{onClick:()=>{const Z=t.filter(K=>v.has(K.id));if(Z.length>0){const K=Z[0],Y=K.severity.toUpperCase(),G=K.message||K.fingerprint||"Alert";M(`[${Y}] ${G}`)}P(!0)},className:"px-3 py-2 text-sm bg-teal-600 hover:bg-teal-700 rounded text-white",children:["Open as Case (",v.size,")"]})]}),w.jsx("div",{className:"rounded border border-gray-800 divide-y divide-gray-800",children:t.length===0?w.jsxs("div",{className:"p-6 text-center text-gray-500",children:[w.jsx("div",{className:"mb-2",children:"No alerts found"}),w.jsx("div",{className:"text-xs text-gray-600",children:"Create a rule or generate events to see alerts here"})]}):t.map(Z=>w.jsxs("div",{className:"p-3 flex items-center gap-3 cursor-pointer hover:bg-white/5",onClick:()=>A(Z),children:[D&&w.jsx("input",{type:"checkbox",checked:v.has(Z.id),onChange:K=>{K.stopPropagation(),W(Z.id)},onClick:K=>K.stopPropagation(),className:"w-4 h-4"}),w.jsxs("div",{className:"flex-1",children:[w.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[w.jsx("div",{className:"text-xs text-gray-400",children:(()=>{try{const K=Z.firstSeen||Z.createdAt;if(!K)return"N/A";const Y=new Date(K);return isNaN(Y.getTime())?"Invalid Date":Y.toLocaleString()}catch{return"Invalid Date"}})()}),Z.count&&Z.count>1&&w.jsxs("div",{className:"text-xs bg-yellow-600 px-2 py-0.5 rounded cursor-help",title:`Deduped ${Z.count-1} time(s) in mute window. First seen: ${(()=>{try{if(!Z.firstSeen)return"N/A";const K=new Date(Z.firstSeen);return isNaN(K.getTime())?"Invalid Date":K.toLocaleString()}catch{return"Invalid Date"}})()}, Last seen: ${(()=>{try{if(!Z.lastSeen)return"N/A";const K=new Date(Z.lastSeen);return isNaN(K.getTime())?"Invalid Date":K.toLocaleString()}catch{return"Invalid Date"}})()}`,children:["",Z.count]})]}),w.jsx("div",{className:"font-medium",children:Z.message}),w.jsxs("div",{className:"text-xs text-gray-500 flex gap-3 mt-1 flex-wrap",children:[w.jsxs("span",{className:j(Z.severity),children:["severity: ",Z.severity]}),w.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${V(Z.status)}`,children:Z.status}),Z.caseId&&w.jsxs("span",{className:"px-2 py-0.5 rounded text-xs bg-teal-600/30 text-teal-300 border border-teal-500/50 cursor-pointer hover:bg-teal-600/40",onClick:K=>{K.stopPropagation(),e==null||e(Z.caseId)},children:["Case #",Z.caseId]}),Z.suppressedBy&&w.jsxs("span",{className:"px-2 py-0.5 rounded text-xs bg-purple-600/30 text-purple-300 border border-purple-500/50 cursor-help",title:`Suppressed by ${Z.suppressedBy.kind}: ${Z.suppressedBy.name}`,children:["Suppressed by: ",Z.suppressedBy.name]}),Z.entityId&&w.jsxs("span",{children:["entity: ",Z.entityId]}),Z.lastSeen&&Z.count&&Z.count>1&&w.jsxs("span",{className:"text-gray-600",title:`Last seen: ${(()=>{try{const K=new Date(Z.lastSeen);return isNaN(K.getTime())?"Invalid Date":K.toLocaleString()}catch{return"Invalid Date"}})()}`,children:["last: ",(()=>{try{const K=new Date(Z.lastSeen);return isNaN(K.getTime())?"N/A":K.toLocaleTimeString()}catch{return"N/A"}})()]})]})]}),w.jsxs("div",{className:"flex gap-2",children:[Z.status==="open"&&w.jsx("button",{className:"btn btn-sm",onClick:K=>{K.stopPropagation(),U(Z.id)},children:"Acknowledge"}),(Z.status==="open"||Z.status==="ack")&&w.jsx("button",{className:"btn btn-sm",onClick:K=>{K.stopPropagation(),$(Z.id)},children:"Resolve"})]})]},Z.id))})]}),w.jsx(qR,{isOpen:S,onClose:()=>{P(!1),x(new Set),M("")},onSubmit:J,case:N?{title:N}:null}),w.jsx(so,{isOpen:p.isOpen,onClose:()=>g({isOpen:!1,message:""}),title:"Error",message:p.message,variant:"error"}),I&&w.jsx(RH,{alert:I,onClose:()=>A(null)})]})}const _y={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},v2=new Map,Lv=e=>{const t=v2.get(e);return t?Object.fromEntries(Object.entries(t.stores).map(([r,n])=>[r,n.getState()])):{}},BH=(e,t,r)=>{if(e===void 0)return{type:"untracked",connection:t.connect(r)};const n=v2.get(r.name);if(n)return{type:"tracked",store:e,...n};const a={connection:t.connect(r),stores:{}};return v2.set(r.name,a),{type:"tracked",store:e,...a}},jH=(e,t={})=>(r,n,a)=>{const{enabled:i,anonymousActionType:u,store:s,...h}=t;let p;try{p=(i??(_y?"production":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!p)return(_y?"production":void 0)!=="production"&&i&&console.warn("[zustand devtools middleware] Please install/enable Redux devtools extension"),e(r,n,a);const{connection:g,...v}=BH(s,p,h);let x=!0;a.setState=(N,M,I)=>{const A=r(N,M);if(!x)return A;const D=I===void 0?{type:u||"anonymous"}:typeof I=="string"?{type:I}:I;return s===void 0?(g==null||g.send(D,n()),A):(g==null||g.send({...D,type:`${s}/${D.type}`},{...Lv(h.name),[s]:a.getState()}),A)};const S=(...N)=>{const M=x;x=!1,r(...N),x=M},P=e(a.setState,n,a);if(v.type==="untracked"?g==null||g.init(P):(v.stores[v.store]=a,g==null||g.init(Object.fromEntries(Object.entries(v.stores).map(([N,M])=>[N,N===v.store?P:M.getState()])))),a.dispatchFromDevtools&&typeof a.dispatch=="function"){let N=!1;const M=a.dispatch;a.dispatch=(...I)=>{(_y?"production":void 0)!=="production"&&I[0].type==="__setState"&&!N&&(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),N=!0),M(...I)}}return g.subscribe(N=>{var M;switch(N.type){case"ACTION":if(typeof N.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return Ow(N.payload,I=>{if(I.type==="__setState"){if(s===void 0){S(I.state);return}Object.keys(I.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format. 
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);const A=I.state[s];if(A==null)return;JSON.stringify(a.getState())!==JSON.stringify(A)&&S(A);return}a.dispatchFromDevtools&&typeof a.dispatch=="function"&&a.dispatch(I)});case"DISPATCH":switch(N.payload.type){case"RESET":return S(P),s===void 0?g==null?void 0:g.init(a.getState()):g==null?void 0:g.init(Lv(h.name));case"COMMIT":if(s===void 0){g==null||g.init(a.getState());return}return g==null?void 0:g.init(Lv(h.name));case"ROLLBACK":return Ow(N.state,I=>{if(s===void 0){S(I),g==null||g.init(a.getState());return}S(I[s]),g==null||g.init(Lv(h.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return Ow(N.state,I=>{if(s===void 0){S(I);return}JSON.stringify(a.getState())!==JSON.stringify(I[s])&&S(I[s])});case"IMPORT_STATE":{const{nextLiftedState:I}=N.payload,A=(M=I.computedStates.slice(-1)[0])==null?void 0:M.state;if(!A)return;S(s===void 0?A:A[s]),g==null||g.send(null,I);return}case"PAUSE_RECORDING":return x=!x}return}}),P},OH=jH,Ow=(e,t)=>{let r;try{r=JSON.parse(e)}catch(n){console.error("[zustand devtools middleware] Could not parse the received json",n)}r!==void 0&&t(r)};function FH(e,t){let r;try{r=e()}catch{return}return{getItem:a=>{var i;const u=h=>h===null?null:JSON.parse(h,void 0),s=(i=r.getItem(a))!=null?i:null;return s instanceof Promise?s.then(u):u(s)},setItem:(a,i)=>r.setItem(a,JSON.stringify(i,void 0)),removeItem:a=>r.removeItem(a)}}const Sm=e=>t=>{try{const r=e(t);return r instanceof Promise?r:{then(n){return Sm(n)(r)},catch(n){return this}}}catch(r){return{then(n){return this},catch(n){return Sm(n)(r)}}}},$H=(e,t)=>(r,n,a)=>{let i={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:M=>M,version:0,merge:(M,I)=>({...I,...M}),...t},u=!1;const s=new Set,h=new Set;let p;try{p=i.getStorage()}catch{}if(!p)return e((...M)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),r(...M)},n,a);const g=Sm(i.serialize),v=()=>{const M=i.partialize({...n()});let I;const A=g({state:M,version:i.version}).then(D=>p.setItem(i.name,D)).catch(D=>{I=D});if(I)throw I;return A},x=a.setState;a.setState=(M,I)=>{x(M,I),v()};const S=e((...M)=>{r(...M),v()},n,a);let P;const N=()=>{var M;if(!p)return;u=!1,s.forEach(A=>A(n()));const I=((M=i.onRehydrateStorage)==null?void 0:M.call(i,n()))||void 0;return Sm(p.getItem.bind(p))(i.name).then(A=>{if(A)return i.deserialize(A)}).then(A=>{if(A)if(typeof A.version=="number"&&A.version!==i.version){if(i.migrate)return i.migrate(A.state,A.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return A.state}).then(A=>{var D;return P=i.merge(A,(D=n())!=null?D:S),r(P,!0),v()}).then(()=>{I==null||I(P,void 0),u=!0,h.forEach(A=>A(P))}).catch(A=>{I==null||I(void 0,A)})};return a.persist={setOptions:M=>{i={...i,...M},M.getStorage&&(p=M.getStorage())},clearStorage:()=>{p==null||p.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>N(),hasHydrated:()=>u,onHydrate:M=>(s.add(M),()=>{s.delete(M)}),onFinishHydration:M=>(h.add(M),()=>{h.delete(M)})},N(),P||S},VH=(e,t)=>(r,n,a)=>{let i={storage:FH(()=>localStorage),partialize:N=>N,version:0,merge:(N,M)=>({...M,...N}),...t},u=!1;const s=new Set,h=new Set;let p=i.storage;if(!p)return e((...N)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),r(...N)},n,a);const g=()=>{const N=i.partialize({...n()});return p.setItem(i.name,{state:N,version:i.version})},v=a.setState;a.setState=(N,M)=>{v(N,M),g()};const x=e((...N)=>{r(...N),g()},n,a);a.getInitialState=()=>x;let S;const P=()=>{var N,M;if(!p)return;u=!1,s.forEach(A=>{var D;return A((D=n())!=null?D:x)});const I=((M=i.onRehydrateStorage)==null?void 0:M.call(i,(N=n())!=null?N:x))||void 0;return Sm(p.getItem.bind(p))(i.name).then(A=>{if(A)if(typeof A.version=="number"&&A.version!==i.version){if(i.migrate)return[!0,i.migrate(A.state,A.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,A.state];return[!1,void 0]}).then(A=>{var D;const[j,V]=A;if(S=i.merge(V,(D=n())!=null?D:x),r(S,!0),j)return g()}).then(()=>{I==null||I(S,void 0),S=n(),u=!0,h.forEach(A=>A(S))}).catch(A=>{I==null||I(void 0,A)})};return a.persist={setOptions:N=>{i={...i,...N},N.storage&&(p=N.storage)},clearStorage:()=>{p==null||p.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>P(),hasHydrated:()=>u,onHydrate:N=>(s.add(N),()=>{s.delete(N)}),onFinishHydration:N=>(h.add(N),()=>{h.delete(N)})},i.skipHydration||P(),S||x},UH=(e,t)=>"getStorage"in t||"serialize"in t||"deserialize"in t?((_y?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),$H(e,t)):VH(e,t),qH=UH,HH="http://localhost:8091";async function es(e,t,r){const n=bi(),a={"Content-Type":"application/json"};n&&(a.Authorization=`Bearer ${n}`);const i=`${HH}${t}`,u={method:e,headers:a};r&&(e==="POST"||e==="PUT")&&(u.body=JSON.stringify(r));const s=await fetch(i,u);if(!s.ok){const p=await s.text();throw new Error(`HTTP ${s.status}: ${p||s.statusText}`)}return{data:await s.json()}}function Bv(e){return{steps:e.steps.map(r=>{var i;let n;["geoip","whois","virustotal","reverse_geocode","keyword_match","http_get","http_post"].includes(r.type)?n="enrich":r.type==="output"?n="attach_note":n=r.type||r.kind||"enrich";const a={kind:n,actionId:["geoip","whois","virustotal","reverse_geocode","keyword_match","http_get","http_post"].includes(r.type)?r.type:void 0,stepId:r.id||r.stepId,onError:r.onFail==="stop"?"fail":r.onFail==="continue"?"continue":r.onError||"continue",config:r.params||r.config||{},next:r.next||[],name:r.name};return n==="attach_note"&&(a.text=((i=r.params)==null?void 0:i.text)||r.text||r.name||"Enrichment summary attached by playbook"),a}),version:e.version||"1.0.0",entry:e.entry}}const xu=Ti()(qH((e,t)=>({items:[],versions:[],selection:[],isDirty:!1,load:async r=>{try{const n=r?{status:r}:{},a=r?`?status=${r}`:"",i=await es("GET",`/playbooks${a}`);e({items:i.data})}catch(n){St(`Failed to load playbooks: ${n.message}`),console.error("Failed to load playbooks:",n)}},open:async r=>{var n,a,i,u;try{const h=(await es("GET",`/playbooks/${r}`)).data,g=(((n=h.jsonBody)==null?void 0:n.steps)||h.steps||[]).map(S=>{const P={id:S.stepId||S.id||`step-${Date.now()}-${Math.random()}`,type:S.actionId||S.kind||S.type,name:S.name||S.stepId,params:S.config||S.params||{},onFail:S.onError==="fail"?"stop":"continue",next:S.next||[]};return S.kind==="attach_note"&&S.text&&(P.params={...P.params,text:S.text}),P}),v={...h,jsonBody:{steps:g,version:((a=h.jsonBody)==null?void 0:a.version)||h.version||"1.0.0",entry:((i=h.jsonBody)==null?void 0:i.entry)||((u=g[0])==null?void 0:u.id)}};e({current:v,isDirty:!1});const x=await es("GET",`/playbooks/${r}/versions`);e({versions:x.data})}catch(s){St(`Failed to open playbook: ${s.message}`),console.error("Failed to open playbook:",s)}},createDraft:async r=>{try{const n=r.jsonBody||{steps:[],version:"1.0.0"},a=Bv(n),i={name:r.name||"Untitled Playbook",description:r.description,jsonBody:a,status:"draft"},u=await es("POST","/playbooks",i);return await t().load("draft"),St("Draft created"),u.data}catch(n){throw St(`Failed to create draft: ${n.message}`),n}},update:async(r,n)=>{var a,i,u,s;try{const h={};n.name!==void 0&&(h.name=n.name),n.description!==void 0&&(h.description=n.description),n.status!==void 0&&(h.status=n.status),n.releaseNotes!==void 0&&(h.releaseNotes=n.releaseNotes),n.jsonBody!==void 0&&(h.jsonBody=Bv(n.jsonBody));const g=(await es("PUT",`/playbooks/${r}`,h)).data,x=(((a=g.jsonBody)==null?void 0:a.steps)||g.steps||[]).map(P=>({id:P.stepId||P.id||`step-${Date.now()}-${Math.random()}`,type:P.actionId||P.kind||P.type,name:P.name||P.stepId,params:P.config||P.params||{},onFail:P.onError==="fail"?"stop":"continue",next:P.next||[]})),S={...g,jsonBody:{steps:x,version:((i=g.jsonBody)==null?void 0:i.version)||g.version||"1.0.0",entry:((u=g.jsonBody)==null?void 0:u.entry)||((s=x[0])==null?void 0:s.id)}};e({current:S,isDirty:!1}),St("Playbook updated")}catch(h){throw St(`Failed to update playbook: ${h.message}`),h}},del:async r=>{try{await es("DELETE",`/playbooks/${r}`),e({current:void 0}),await t().load(),St("Playbook deleted")}catch(n){throw St(`Failed to delete playbook: ${n.message}`),n}},validate:async r=>{try{const n=Bv(r),a=await es("POST","/playbooks/validate",{jsonBody:n});return{isValid:a.data.isValid,warnings:a.data.warnings||[],errors:a.data.error?[a.data.error]:[]}}catch(n){return{isValid:!1,errors:[n.message]}}},testRun:async r=>{try{const n=Bv(r),a=await es("POST","/playbooks/test-run",{jsonBody:n});return{logs:a.data.steps||[],success:a.data.status==="success"}}catch{return{logs:[],success:!1}}},listVersions:async r=>{try{const n=await es("GET",`/playbooks/${r}/versions`);e({versions:n.data})}catch(n){console.error("Failed to list versions:",n)}},rollback:async(r,n)=>{try{const a=await es("POST",`/playbooks/${r}/rollback/${n}`);e({current:a.data,isDirty:!1}),await t().listVersions(r),St(`Rolled back to version ${n}`)}catch(a){throw St(`Failed to rollback: ${a.message}`),a}},aiGenerate:async r=>{try{return(await es("POST","/playbooks/ai/generate",{prompt:r})).data.playbook}catch(n){throw St(`AI generation failed: ${n.message}`),n}},aiExplain:async r=>{try{return(await es("POST","/playbooks/ai/explain",{step:r})).data.explanation}catch(n){throw new Error(`AI explanation failed: ${n.message}`)}},setCurrentJson:r=>{const n=t().current;if(!n)return;const a={...n,jsonBody:r(n.jsonBody)};e({current:a,isDirty:!0})},setSelection:r=>e({selection:r}),markDirty:r=>e({isDirty:r})}),{name:"playbooks"}));function GH(){const[e,t]=se.useState(`{
  "match": { "type": "Event", "attrs.severity": "high" },
  "window": "5m",
  "threshold": 3,
  "group_by": "attrs.source",
  "message": "High severity burst from \${attrs.source}"
}`),[r,n]=se.useState("High severity burst"),[a,i]=se.useState("high"),[u,s]=se.useState(!1),[h,p]=se.useState(""),[g,v]=se.useState({isOpen:!1,message:""}),[x,S]=se.useState(""),[P,N]=se.useState(null),[M,I]=se.useState(!1),[A,D]=se.useState(null),[j,V]=se.useState(""),[U,$]=se.useState(""),[W,X]=se.useState(""),[J,Z]=se.useState("suggest"),[K,Y]=se.useState(""),[G,oe]=se.useState(30),[ie,ce]=se.useState(5),[fe,de]=se.useState(500),[be,ge]=se.useState(!0),{bindings:xe,list:Le,create:Oe,update:Fe,remove:et,error:nt,clearError:mt}=uE(),{items:it,load:ze}=xu();se.useEffect(()=>{ze("published").catch(Pe=>{console.warn("Failed to load playbooks",Pe)})},[ze]);async function He(){var Pe,Ye;s(!0),p("");try{let at;try{at=JSON.parse(e)}catch(Et){v({isOpen:!0,message:`Invalid JSON: ${Et.message}`}),s(!1);return}const bt={name:r,severity:a,conditionJson:at,actionsJson:[{type:"slack",config:{}}],enabled:!0};await br.post("/alerts/rules",bt),St("Rule saved successfully!"),n(""),t(`{
  "match": { "type": "Event", "attrs.severity": "high" },
  "window": "5m",
  "threshold": 3,
  "group_by": "attrs.source",
  "message": "High severity burst from \${attrs.source}"
}`),p("")}catch(at){const bt=((Ye=(Pe=at.response)==null?void 0:Pe.data)==null?void 0:Ye.detail)||at.message||"Unknown error occurred";if(bt.includes("404")||bt.includes("Not Found")){p("Rules API not available - backend routes may not be configured"),s(!1);return}v({isOpen:!0,message:bt}),s(!1)}finally{s(!1)}}const We=se.useMemo(()=>P==null?[]:xe.filter(Pe=>Pe.ruleId===P),[xe,P]);async function ot(){if(mt(),!x){St("Enter a rule ID to load bindings");return}const Pe=Number(x);if(Number.isNaN(Pe)){St("Rule ID must be a number");return}await Le({ruleId:Pe}),N(Pe)}function xt(Pe){var Ye;if(mt(),!P){St("Load a rule's bindings first");return}Pe?(D(Pe),V(Pe.matchTypes.join(", ")),$(Pe.matchSeverities.join(", ")),X(Pe.matchTags.join(", ")),Z(Pe.mode),Y(Pe.playbookId),oe(Pe.maxPerMinute),ce(Pe.maxConcurrent),de(Pe.dailyQuota),ge(Pe.enabled)):(D(null),V("Event"),$("high"),X(""),Z("suggest"),Y(((Ye=it[0])==null?void 0:Ye.id)??""),oe(30),ce(5),de(500),ge(!0)),I(!0)}async function Tt(){if(!P)return;if(!K){St("Select a playbook");return}const Pe={ruleId:P,playbookId:K,mode:J,matchTypes:j.split(",").map(Ye=>Ye.trim()).filter(Boolean),matchSeverities:U.split(",").map(Ye=>Ye.trim()).filter(Boolean),matchTags:W.split(",").map(Ye=>Ye.trim()).filter(Boolean),maxPerMinute:G,maxConcurrent:ie,dailyQuota:fe,enabled:be};try{A?(await Fe(A.id,Pe),St("Binding updated")):(await Oe(Pe),St("Binding created")),await ot(),I(!1)}catch(Ye){console.error("Failed to save binding",Ye)}}async function $e(Pe){if(!confirm(`Delete binding for playbook ${Pe.playbookId}?`))return;await et(Pe.id)&&(St("Binding removed"),await ot())}const Xe=nt?w.jsx("div",{className:"text-xs text-red-400 bg-red-900/20 border border-red-700 px-3 py-2 rounded",children:nt}):null;return w.jsxs(w.Fragment,{children:[w.jsxs("div",{className:"space-y-3",children:[w.jsxs("div",{className:"text-xs text-gray-500 p-2 bg-panel/50 rounded border border-gray-700",children:[" Use ",w.jsx("strong",{children:"Silences"})," for ad-hoc suppression and ",w.jsx("strong",{children:"Maintenance"})," for scheduled windows. Suppressed alerts do not notify but still stream to UI."]}),w.jsxs("div",{children:[w.jsx("label",{className:"block text-sm font-medium mb-1 text-white",children:"Rule Name"}),w.jsx("input",{type:"text",className:"bg-panel border border-white/20 rounded px-3 py-2 text-white placeholder-gray-400 focus:outline-none focus:border-teal-500 w-full",value:r,onChange:Pe=>n(Pe.target.value),placeholder:"High severity burst"})]}),w.jsxs("div",{children:[w.jsx("label",{className:"block text-sm font-medium mb-1 text-white",children:"Severity"}),w.jsxs("select",{className:"bg-panel border border-white/20 rounded px-3 py-2 text-white focus:outline-none focus:border-teal-500",value:a,onChange:Pe=>i(Pe.target.value),children:[w.jsx("option",{value:"low",className:"bg-panel text-white",children:"Low"}),w.jsx("option",{value:"medium",className:"bg-panel text-white",children:"Medium"}),w.jsx("option",{value:"high",className:"bg-panel text-white",children:"High"})]})]}),w.jsxs("div",{children:[w.jsx("label",{className:"block text-sm font-medium mb-1 text-white",children:"Condition JSON"}),w.jsx("textarea",{className:"w-full h-56 font-mono p-2 bg-black/40 border border-gray-800 rounded text-sm text-white placeholder-gray-400 focus:outline-none focus:border-teal-500",value:e,onChange:Pe=>t(Pe.target.value)})]}),w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx("button",{className:"bg-teal-600 hover:bg-teal-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white px-4 py-2 rounded transition-colors",onClick:He,disabled:u,children:u?"Saving...":"Save Rule"}),h&&w.jsx("span",{className:"text-xs text-yellow-400 italic",children:h})]})]}),w.jsx(so,{isOpen:g.isOpen,onClose:()=>v({isOpen:!1,message:""}),title:"Error",message:g.message,variant:"error"}),w.jsxs("div",{className:"mt-10 space-y-4",children:[w.jsxs("div",{className:"flex items-end gap-3",children:[w.jsxs("div",{className:"flex-1",children:[w.jsx("label",{className:"block text-sm font-medium text-white mb-1",children:"Rule ID"}),w.jsx("input",{className:"bg-panel border border-white/20 rounded px-3 py-2 text-white placeholder-gray-400 focus:outline-none focus:border-teal-500 w-full",placeholder:"Enter rule ID to manage bindings",value:x,onChange:Pe=>S(Pe.target.value)})]}),w.jsx("button",{onClick:ot,className:"bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded",children:"Load Bindings"}),w.jsx("button",{onClick:()=>xt(),disabled:!P,className:"bg-teal-600 hover:bg-teal-500 disabled:bg-gray-600 disabled:cursor-not-allowed text-white px-4 py-2 rounded",children:"Add Binding"})]}),w.jsx("div",{className:"text-xs text-white/70",children:"Bind playbooks to this rule to automatically suggest, dry-run, or auto-run enrichments when alerts fire. Use filters to target specific severities, entity types, or tags."}),Xe,P&&w.jsxs("div",{className:"bg-black/40 border border-white/10 rounded-lg overflow-hidden",children:[w.jsxs("div",{className:"grid grid-cols-12 text-xs font-semibold uppercase tracking-wide text-white/70 bg-white/10 px-3 py-2",children:[w.jsx("span",{className:"col-span-1",children:"ID"}),w.jsx("span",{className:"col-span-2",children:"Playbook"}),w.jsx("span",{className:"col-span-2",children:"Mode"}),w.jsx("span",{className:"col-span-2",children:"Match Types"}),w.jsx("span",{className:"col-span-2",children:"Severities"}),w.jsx("span",{className:"col-span-1",children:"Tags"}),w.jsx("span",{className:"col-span-2 text-right",children:"Guardrails"})]}),We.length===0?w.jsx("div",{className:"px-3 py-4 text-sm text-white/60",children:"No bindings configured for this rule."}):We.map(Pe=>w.jsxs("div",{className:"grid grid-cols-12 items-center px-3 py-3 border-t border-white/10 text-sm text-white/80",children:[w.jsx("div",{className:"col-span-1 text-xs font-mono",children:Pe.id}),w.jsx("div",{className:"col-span-2 text-xs font-mono truncate",children:Pe.playbookId}),w.jsx("div",{className:"col-span-2 capitalize",children:Pe.mode.replace("_"," ")}),w.jsx("div",{className:"col-span-2 truncate",children:Pe.matchTypes.join(", ")||"Any"}),w.jsx("div",{className:"col-span-2 truncate",children:Pe.matchSeverities.join(", ")||"Any"}),w.jsx("div",{className:"col-span-1 truncate text-xs",children:Pe.matchTags.join(", ")||"Any"}),w.jsxs("div",{className:"col-span-2 text-right space-x-2",children:[w.jsxs("span",{className:"text-xs text-white/60",children:[Pe.maxPerMinute,"/min  ",Pe.maxConcurrent," conc  ",Pe.dailyQuota,"/day"]}),w.jsx("button",{className:"text-teal-400 hover:text-teal-200 text-xs",onClick:()=>xt(Pe),children:"Edit"}),w.jsx("button",{className:"text-red-400 hover:text-red-200 text-xs",onClick:()=>$e(Pe),children:"Delete"})]})]},Pe.id))]})]}),w.jsx(eo,{isOpen:M,onClose:()=>I(!1),title:A?"Edit Binding":"Add Binding",children:w.jsxs("div",{className:"space-y-3 text-sm",children:[w.jsxs("div",{children:[w.jsx("label",{className:"block text-xs font-semibold text-white mb-1",children:"Playbook"}),w.jsxs("select",{className:"bg-panel border border-white/20 rounded px-3 py-2 text-white w-full",value:K,onChange:Pe=>Y(Pe.target.value),children:[w.jsx("option",{value:"",disabled:!0,className:"bg-panel text-white/70",children:"Select playbook"}),it.map(Pe=>w.jsxs("option",{value:Pe.id,className:"bg-panel text-white",children:[Pe.name," (",Pe.id,")"]},Pe.id))]})]}),w.jsxs("div",{children:[w.jsx("label",{className:"block text-xs font-semibold text-white mb-1",children:"Mode"}),w.jsxs("select",{className:"bg-panel border border-white/20 rounded px-3 py-2 text-white w-full",value:J,onChange:Pe=>Z(Pe.target.value),children:[w.jsx("option",{value:"suggest",className:"bg-panel text-white",children:"Suggest"}),w.jsx("option",{value:"dry_run",className:"bg-panel text-white",children:"Dry Run"}),w.jsx("option",{value:"auto_run",className:"bg-panel text-white",children:"Auto Run"})]})]}),w.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[w.jsxs("div",{children:[w.jsx("label",{className:"block text-xs font-semibold text-white mb-1",children:"Match Types"}),w.jsx("input",{className:"bg-panel border border-white/20 rounded px-3 py-2 text-white w-full",placeholder:"Event, Anomaly",value:j,onChange:Pe=>V(Pe.target.value)})]}),w.jsxs("div",{children:[w.jsx("label",{className:"block text-xs font-semibold text-white mb-1",children:"Match Severities"}),w.jsx("input",{className:"bg-panel border border-white/20 rounded px-3 py-2 text-white w-full",placeholder:"high, critical",value:U,onChange:Pe=>$(Pe.target.value)})]}),w.jsxs("div",{children:[w.jsx("label",{className:"block text-xs font-semibold text-white mb-1",children:"Match Tags"}),w.jsx("input",{className:"bg-panel border border-white/20 rounded px-3 py-2 text-white w-full",placeholder:"finance, edge",value:W,onChange:Pe=>X(Pe.target.value)})]})]}),w.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[w.jsxs("div",{children:[w.jsx("label",{className:"block text-xs font-semibold text-white mb-1",children:"Max / Minute"}),w.jsx("input",{type:"number",className:"bg-panel border border-white/20 rounded px-3 py-2 text-white w-full",value:G,min:0,onChange:Pe=>oe(Number(Pe.target.value))})]}),w.jsxs("div",{children:[w.jsx("label",{className:"block text-xs font-semibold text-white mb-1",children:"Max Concurrent"}),w.jsx("input",{type:"number",className:"bg-panel border border-white/20 rounded px-3 py-2 text-white w-full",value:ie,min:0,onChange:Pe=>ce(Number(Pe.target.value))})]}),w.jsxs("div",{children:[w.jsx("label",{className:"block text-xs font-semibold text-white mb-1",children:"Daily Quota"}),w.jsx("input",{type:"number",className:"bg-panel border border-white/20 rounded px-3 py-2 text-white w-full",value:fe,min:0,onChange:Pe=>de(Number(Pe.target.value))})]})]}),w.jsxs("label",{className:"flex items-center gap-2 text-xs text-white",children:[w.jsx("input",{type:"checkbox",className:"accent-teal-500",checked:be,onChange:Pe=>ge(Pe.target.checked)}),"Enabled"]}),w.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[w.jsx("button",{className:"px-4 py-2 rounded bg-gray-700 hover:bg-gray-600 text-white",onClick:()=>I(!1),children:"Cancel"}),w.jsx("button",{className:"px-4 py-2 rounded bg-teal-600 hover:bg-teal-500 text-white",onClick:Tt,children:A?"Update Binding":"Create Binding"})]})]})})]})}const KR=Ti((e,t)=>({silences:[],maintenance:[],loading:!1,error:null,loadSilences:async(r=!1)=>{e({loading:!0,error:null});try{const n=await br.get(`/silences?include_expired=${r}`);e({silences:n.data,loading:!1})}catch(n){const a=(n==null?void 0:n.message)||"";if(a.includes("404")||a.includes("Not Found"))e({silences:[],loading:!1,error:null});else if(a.includes("401")||a.includes("Unauthorized"))try{const{refresh:i}=await wm(async()=>{const{refresh:s}=await Promise.resolve().then(()=>cm);return{refresh:s}},void 0);await i();const u=await br.get(`/silences?include_expired=${r}`);e({silences:u.data,loading:!1})}catch{e({error:"Unauthorized - please log in again",loading:!1})}else e({error:(n==null?void 0:n.message)||"Failed to load silences",loading:!1})}},createSilence:async r=>{e({error:null});try{const n=await br.post("/silences",r);return await t().loadSilences(),n.data.id}catch(n){throw e({error:(n==null?void 0:n.message)||"Failed to create silence"}),n}},deleteSilence:async r=>{e({error:null});try{await br.delete(`/silences/${r}`),await t().loadSilences()}catch(n){if((n==null?void 0:n.status)===404)await t().loadSilences();else throw e({error:(n==null?void 0:n.message)||"Failed to delete silence"}),n}},loadMaintenance:async(r=!1)=>{e({loading:!0,error:null});try{const n=await br.get(`/maintenance?include_expired=${r}`);e({maintenance:n.data,loading:!1})}catch(n){const a=(n==null?void 0:n.message)||"";if(a.includes("404")||a.includes("Not Found"))e({maintenance:[],loading:!1,error:null});else if(a.includes("401")||a.includes("Unauthorized"))try{const{refresh:i}=await wm(async()=>{const{refresh:s}=await Promise.resolve().then(()=>cm);return{refresh:s}},void 0);await i();const u=await br.get(`/maintenance?include_expired=${r}`);e({maintenance:u.data,loading:!1})}catch{e({error:"Unauthorized - please log in again",loading:!1})}else e({error:(n==null?void 0:n.message)||"Failed to load maintenance windows",loading:!1})}},createMaintenance:async r=>{e({error:null});try{const n=await br.post("/maintenance",r);return await t().loadMaintenance(),n.data.id}catch(n){throw e({error:(n==null?void 0:n.message)||"Failed to create maintenance window"}),n}},deleteMaintenance:async r=>{e({error:null});try{await br.delete(`/maintenance/${r}`),await t().loadMaintenance()}catch(n){if((n==null?void 0:n.status)===404)await t().loadMaintenance();else throw e({error:(n==null?void 0:n.message)||"Failed to delete maintenance window"}),n}},reset:()=>{e({silences:[],maintenance:[],loading:!1,error:null})}}));function WH(){const{silences:e,loading:t,error:r,loadSilences:n,createSilence:a,deleteSilence:i}=KR(),[u,s]=se.useState(!1),[h,p]=se.useState({name:"",match_json:"{}",starts_at:"",ends_at:"",reason:""}),[g,v]=se.useState({isOpen:!1,message:""});se.useEffect(()=>{n()},[n]);const x=async()=>{try{const M=JSON.parse(h.match_json);await a({name:h.name,match_json:M,starts_at:h.starts_at||new Date().toISOString(),ends_at:h.ends_at||new Date(Date.now()+36e5).toISOString(),reason:h.reason||void 0}),St("Silence created"),s(!1),p({name:"",match_json:"{}",starts_at:"",ends_at:"",reason:""})}catch(M){v({isOpen:!0,message:(M==null?void 0:M.message)||"Failed to create silence"})}},S=async M=>{try{await i(M),St("Silence deleted")}catch(I){v({isOpen:!0,message:(I==null?void 0:I.message)||"Failed to delete silence"})}},P=new Date,N=e.filter(M=>new Date(M.ends_at)>=P);return w.jsxs(w.Fragment,{children:[w.jsxs("div",{className:"space-y-3",children:[w.jsxs("div",{className:"flex justify-between items-center",children:[w.jsx("h3",{className:"text-sm font-medium",children:"Alert Silences"}),w.jsx("button",{onClick:()=>s(!u),className:"px-3 py-1.5 bg-teal-600 hover:bg-teal-700 rounded text-sm",children:u?"Cancel":"Create Silence"})]}),u&&w.jsxs("div",{className:"p-4 border border-gray-700 rounded space-y-3",children:[w.jsx("input",{type:"text",placeholder:"Name",value:h.name,onChange:M=>p({...h,name:M.target.value}),className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white focus:outline-none focus:border-teal-500"}),w.jsx("textarea",{placeholder:'Match JSON (e.g., {"type":"Event","attrs.source":"edge-1"})',value:h.match_json,onChange:M=>p({...h,match_json:M.target.value}),className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white focus:outline-none focus:border-teal-500",rows:3}),w.jsx("input",{type:"datetime-local",placeholder:"Start time",value:h.starts_at,onChange:M=>p({...h,starts_at:M.target.value}),className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white focus:outline-none focus:border-teal-500"}),w.jsx("input",{type:"datetime-local",placeholder:"End time",value:h.ends_at,onChange:M=>p({...h,ends_at:M.target.value}),className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white focus:outline-none focus:border-teal-500"}),w.jsx("input",{type:"text",placeholder:"Reason (optional)",value:h.reason,onChange:M=>p({...h,reason:M.target.value}),className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white focus:outline-none focus:border-teal-500"}),w.jsx("button",{onClick:x,className:"px-4 py-2 bg-teal-600 hover:bg-teal-700 rounded",children:"Create"})]}),t&&w.jsx("div",{className:"text-gray-500 text-sm",children:"Loading..."}),r&&!t&&w.jsx("div",{className:"text-red-500 text-sm",children:r}),!t&&N.length===0&&w.jsxs("div",{className:"p-6 text-center text-gray-500",children:[w.jsx("div",{className:"mb-2",children:"No active silences"}),w.jsx("div",{className:"text-xs text-gray-600",children:"Create a silence to suppress matching alerts"})]}),N.length>0&&w.jsx("div",{className:"rounded border border-gray-800 divide-y divide-gray-800",children:N.map(M=>w.jsxs("div",{className:"p-3 flex items-center justify-between",children:[w.jsxs("div",{className:"flex-1",children:[w.jsx("div",{className:"font-medium",children:M.name}),w.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[w.jsxs("div",{children:["Match: ",JSON.stringify(M.match_json)]}),w.jsxs("div",{children:["Active: ",new Date(M.starts_at).toLocaleString(),"  ",new Date(M.ends_at).toLocaleString()]}),M.reason&&w.jsxs("div",{children:["Reason: ",M.reason]})]})]}),w.jsx("button",{onClick:()=>S(M.id),className:"px-3 py-1.5 bg-red-600/20 hover:bg-red-600/30 rounded text-sm text-red-400",children:"Delete"})]},M.id))})]}),w.jsx(so,{isOpen:g.isOpen,title:"Error",message:g.message,onClose:()=>v({isOpen:!1,message:""})})]})}function ZH(){const{maintenance:e,loading:t,error:r,loadMaintenance:n,createMaintenance:a,deleteMaintenance:i}=KR(),[u,s]=se.useState(!1),[h,p]=se.useState({name:"",match_json:"{}",starts_at:"",ends_at:"",reason:""}),[g,v]=se.useState({isOpen:!1,message:""});se.useEffect(()=>{n()},[n]);const x=async()=>{try{const M=JSON.parse(h.match_json);await a({name:h.name,match_json:M,starts_at:h.starts_at||new Date().toISOString(),ends_at:h.ends_at||new Date(Date.now()+36e5).toISOString(),reason:h.reason||void 0}),St("Maintenance window created"),s(!1),p({name:"",match_json:"{}",starts_at:"",ends_at:"",reason:""})}catch(M){v({isOpen:!0,message:(M==null?void 0:M.message)||"Failed to create maintenance window"})}},S=async M=>{try{await i(M),St("Maintenance window deleted")}catch(I){v({isOpen:!0,message:(I==null?void 0:I.message)||"Failed to delete maintenance window"})}},P=new Date,N=e.filter(M=>new Date(M.ends_at)>=P);return w.jsxs(w.Fragment,{children:[w.jsxs("div",{className:"space-y-3",children:[w.jsxs("div",{className:"flex justify-between items-center",children:[w.jsx("h3",{className:"text-sm font-medium",children:"Maintenance Windows"}),w.jsx("button",{onClick:()=>s(!u),className:"px-3 py-1.5 bg-teal-600 hover:bg-teal-700 rounded text-sm",children:u?"Cancel":"Create Window"})]}),u&&w.jsxs("div",{className:"p-4 border border-gray-700 rounded space-y-3",children:[w.jsx("input",{type:"text",placeholder:"Name",value:h.name,onChange:M=>p({...h,name:M.target.value}),className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white focus:outline-none focus:border-teal-500"}),w.jsx("textarea",{placeholder:'Match JSON (e.g., {"type":"Event","attrs.source":"edge-1"})',value:h.match_json,onChange:M=>p({...h,match_json:M.target.value}),className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white focus:outline-none focus:border-teal-500",rows:3}),w.jsx("input",{type:"datetime-local",placeholder:"Start time",value:h.starts_at,onChange:M=>p({...h,starts_at:M.target.value}),className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white focus:outline-none focus:border-teal-500"}),w.jsx("input",{type:"datetime-local",placeholder:"End time",value:h.ends_at,onChange:M=>p({...h,ends_at:M.target.value}),className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white focus:outline-none focus:border-teal-500"}),w.jsx("input",{type:"text",placeholder:"Reason (optional)",value:h.reason,onChange:M=>p({...h,reason:M.target.value}),className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white focus:outline-none focus:border-teal-500"}),w.jsx("button",{onClick:x,className:"px-4 py-2 bg-teal-600 hover:bg-teal-700 rounded",children:"Create"})]}),t&&w.jsx("div",{className:"text-gray-500 text-sm",children:"Loading..."}),r&&!t&&w.jsx("div",{className:"text-red-500 text-sm",children:r}),!t&&N.length===0&&w.jsxs("div",{className:"p-6 text-center text-gray-500",children:[w.jsx("div",{className:"mb-2",children:"No active maintenance windows"}),w.jsx("div",{className:"text-xs text-gray-600",children:"Create a window to suppress matching alerts during maintenance"})]}),N.length>0&&w.jsx("div",{className:"rounded border border-gray-800 divide-y divide-gray-800",children:N.map(M=>w.jsxs("div",{className:"p-3 flex items-center justify-between",children:[w.jsxs("div",{className:"flex-1",children:[w.jsx("div",{className:"font-medium",children:M.name}),w.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[w.jsxs("div",{children:["Match: ",JSON.stringify(M.match_json)]}),w.jsxs("div",{children:["Active: ",new Date(M.starts_at).toLocaleString(),"  ",new Date(M.ends_at).toLocaleString()]}),M.reason&&w.jsxs("div",{children:["Reason: ",M.reason]})]})]}),w.jsx("button",{onClick:()=>S(M.id),className:"px-3 py-1.5 bg-red-600/20 hover:bg-red-600/30 rounded text-sm text-red-400",children:"Delete"})]},M.id))})]}),w.jsx(so,{isOpen:g.isOpen,title:"Error",message:g.message,onClose:()=>v({isOpen:!1,message:""})})]})}function XH(){const[e,t]=se.useState("list"),r=Ns(i=>i.load),n=Ns(i=>i.setFilters),a=()=>Ns.setState({unread:0});return se.useEffect(()=>{r().finally(a),n({})},[]),se.useEffect(()=>{const i=()=>{document.hidden||Ns.setState({unread:0})};return document.addEventListener("visibilitychange",i),()=>document.removeEventListener("visibilitychange",i)},[]),w.jsxs("div",{className:"h-full flex flex-col p-4",children:[w.jsxs("div",{className:"flex gap-4 border-b border-gray-800 mb-4",children:[w.jsx("button",{onClick:()=>t("list"),className:`px-4 py-2 text-sm font-medium ${e==="list"?"border-b-2 border-teal-500 text-teal-400":"text-gray-400 hover:text-white"}`,children:"List"}),w.jsx("button",{onClick:()=>t("rules"),className:`px-4 py-2 text-sm font-medium ${e==="rules"?"border-b-2 border-teal-500 text-teal-400":"text-gray-400 hover:text-white"}`,children:"Rules"}),w.jsx("button",{onClick:()=>t("silences"),className:`px-4 py-2 text-sm font-medium ${e==="silences"?"border-b-2 border-teal-500 text-teal-400":"text-gray-400 hover:text-white"}`,children:"Silences"}),w.jsx("button",{onClick:()=>t("maintenance"),className:`px-4 py-2 text-sm font-medium ${e==="maintenance"?"border-b-2 border-teal-500 text-teal-400":"text-gray-400 hover:text-white"}`,children:"Maintenance"})]}),w.jsxs("div",{className:"flex-1 overflow-auto",children:[e==="list"&&w.jsx(LH,{onCaseChipClick:i=>{window.dispatchEvent(new CustomEvent("navigate-to-cases",{detail:{caseId:i}}))}}),e==="rules"&&w.jsx(GH,{}),e==="silences"&&w.jsx(WH,{}),e==="maintenance"&&w.jsx(ZH,{})]})]})}function YR({score:e,className:t=""}){if(e==null)return null;let r="bg-slate-500";e>=.8?r="bg-green-600":e>=.5&&(r="bg-amber-500");const n=Math.round(e*100);return w.jsxs(cE,{className:`${r} text-white text-xs ${t}`,title:`Confidence: ${n}%`,children:[n,"%"]})}function KH({onSelect:e}){const{items:t,loading:r,list:n,selected:a}=us(),[i,u]=se.useState(""),[s,h]=se.useState(""),[p,g]=se.useState(""),[v,x]=se.useState("");se.useEffect(()=>{const N={};i&&(N.status=i),s&&(N.priority=s),p.trim()&&(N.owner=p.trim()),v.trim()&&(N.search=v.trim()),n(N)},[i,s,p,v,n]);const S=N=>N==="open"?"bg-blue-600":N==="in_progress"?"bg-yellow-600":N==="resolved"?"bg-green-600":"bg-gray-600",P=N=>N==="critical"?"text-red-400":N==="high"?"text-orange-400":N==="medium"?"text-yellow-400":"text-blue-400";return w.jsxs("div",{className:"space-y-3",children:[w.jsxs("div",{className:"space-y-2",children:[w.jsx("input",{type:"text",className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white text-sm focus:outline-none focus:border-teal-500",placeholder:"Search cases...",value:v,onChange:N=>x(N.target.value)}),w.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[w.jsxs("select",{className:"bg-panel border border-white/20 rounded px-2 py-1 text-white text-sm focus:outline-none focus:border-teal-500",value:i,onChange:N=>u(N.target.value),children:[w.jsx("option",{value:"",children:"All Status"}),w.jsx("option",{value:"open",children:"Open"}),w.jsx("option",{value:"in_progress",children:"In Progress"}),w.jsx("option",{value:"resolved",children:"Resolved"}),w.jsx("option",{value:"closed",children:"Closed"})]}),w.jsxs("select",{className:"bg-panel border border-white/20 rounded px-2 py-1 text-white text-sm focus:outline-none focus:border-teal-500",value:s,onChange:N=>h(N.target.value),children:[w.jsx("option",{value:"",children:"All Priority"}),w.jsx("option",{value:"low",children:"Low"}),w.jsx("option",{value:"medium",children:"Medium"}),w.jsx("option",{value:"high",children:"High"}),w.jsx("option",{value:"critical",children:"Critical"})]})]}),w.jsx("input",{type:"text",className:"w-full bg-panel border border-white/20 rounded px-2 py-1 text-white text-sm focus:outline-none focus:border-teal-500",placeholder:"Filter by owner...",value:p,onChange:N=>g(N.target.value)})]}),r?w.jsx("div",{className:"text-white/60 text-sm text-center py-4",children:"Loading..."}):t.length===0?w.jsx("div",{className:"text-white/60 text-sm text-center py-4",children:"No cases found"}):w.jsx("div",{className:"space-y-1",children:t.map(N=>w.jsxs("div",{className:`p-3 rounded border cursor-pointer transition-colors ${(a==null?void 0:a.id)===N.id?"bg-teal-600/20 border-teal-500":"bg-white/5 border-white/10 hover:bg-white/10"}`,onClick:()=>e(N),children:[w.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1",children:[w.jsx("h4",{className:"font-medium text-white text-sm flex-1",children:N.title}),w.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${S(N.status)}`,children:N.status.replace("_"," ")})]}),w.jsxs("div",{className:"flex items-center gap-2 text-xs flex-wrap",children:[w.jsx("span",{className:P(N.priority),children:N.priority}),N.prioritySuggestion&&N.prioritySuggestion!==N.priority&&w.jsxs(w.Fragment,{children:[w.jsx("span",{className:"text-white/40",children:""}),w.jsxs("span",{className:"text-purple-400 flex items-center gap-1",title:"AI suggested priority",children:["AI: ",N.prioritySuggestion,w.jsx(YR,{score:N.priorityScore})]})]}),N.owner&&w.jsxs(w.Fragment,{children:[w.jsx("span",{className:"text-white/40",children:""}),w.jsx("span",{className:"text-white/60",children:N.owner})]})]}),N.description&&w.jsx("p",{className:"text-xs text-white/70 mt-1 line-clamp-2",children:N.description})]},N.id))})]})}function YH({caseData:e,onUpdate:t}){const[r,n]=se.useState(null),[a,i]=se.useState(""),{update:u}=us(),s=On("analyst")||On("admin"),h=S=>S==="open"?"bg-blue-600":S==="in_progress"?"bg-yellow-600":S==="resolved"?"bg-green-600":"bg-gray-600",p=S=>S==="critical"?"text-red-400":S==="high"?"text-orange-400":S==="medium"?"text-yellow-400":"text-blue-400",g=S=>{s&&(n(S),i(S==="status"?e.status:S==="priority"?e.priority:e.owner||""))},v=async()=>{if(r)try{const S={};r==="status"?S.status=a:r==="priority"?S.priority=a:S.owner=a.trim()||null;const P=await u(e.id,S);t(P),n(null)}catch{n(null)}},x=()=>{n(null),i("")};return w.jsxs("div",{className:"space-y-3 pb-4 border-b border-white/10",children:[w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx("span",{className:"text-sm text-white/60",children:"Status:"}),r==="status"&&s?w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsxs("select",{className:"bg-panel border border-white/20 rounded px-2 py-1 text-white text-sm focus:outline-none focus:border-teal-500",value:a,onChange:S=>i(S.target.value),autoFocus:!0,children:[w.jsx("option",{value:"open",children:"Open"}),w.jsx("option",{value:"in_progress",children:"In Progress"}),w.jsx("option",{value:"resolved",children:"Resolved"}),w.jsx("option",{value:"closed",children:"Closed"})]}),w.jsx("button",{onClick:v,className:"px-2 py-1 text-xs bg-teal-600 hover:bg-teal-700 rounded text-white",children:"Save"}),w.jsx("button",{onClick:x,className:"px-2 py-1 text-xs bg-white/10 hover:bg-white/20 rounded text-white/80",children:"Cancel"})]}):w.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${h(e.status)} ${s?"cursor-pointer hover:opacity-80":""}`,onClick:()=>g("status"),children:e.status.replace("_"," ")})]}),w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx("span",{className:"text-sm text-white/60",children:"Priority:"}),r==="priority"&&s?w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsxs("select",{className:"bg-panel border border-white/20 rounded px-2 py-1 text-white text-sm focus:outline-none focus:border-teal-500",value:a,onChange:S=>i(S.target.value),autoFocus:!0,children:[w.jsx("option",{value:"low",children:"Low"}),w.jsx("option",{value:"medium",children:"Medium"}),w.jsx("option",{value:"high",children:"High"}),w.jsx("option",{value:"critical",children:"Critical"})]}),w.jsx("button",{onClick:v,className:"px-2 py-1 text-xs bg-teal-600 hover:bg-teal-700 rounded text-white",children:"Save"}),w.jsx("button",{onClick:x,className:"px-2 py-1 text-xs bg-white/10 hover:bg-white/20 rounded text-white/80",children:"Cancel"})]}):w.jsx("span",{className:`font-medium ${p(e.priority)} ${s?"cursor-pointer hover:underline":""}`,onClick:()=>g("priority"),children:e.priority})]}),w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx("span",{className:"text-sm text-white/60",children:"Owner:"}),r==="owner"&&s?w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx("input",{type:"text",className:"bg-panel border border-white/20 rounded px-2 py-1 text-white text-sm focus:outline-none focus:border-teal-500",value:a,onChange:S=>i(S.target.value),placeholder:"user@example.com",autoFocus:!0}),w.jsx("button",{onClick:v,className:"px-2 py-1 text-xs bg-teal-600 hover:bg-teal-700 rounded text-white",children:"Save"}),w.jsx("button",{onClick:x,className:"px-2 py-1 text-xs bg-white/10 hover:bg-white/20 rounded text-white/80",children:"Cancel"})]}):w.jsx("span",{className:`text-white/80 ${s&&!e.owner?"cursor-pointer hover:underline":""}`,onClick:()=>e.owner||s?g("owner"):void 0,children:e.owner||(s?"Click to assign":"Unassigned")})]}),e.resolvedAt&&w.jsxs("div",{className:"text-sm text-white/60",children:["Resolved: ",new Date(e.resolvedAt).toLocaleString()]})]})}function JH({caseId:e}){const[t,r]=se.useState([]),[n,a]=se.useState(!1),[i,u]=se.useState(""),[s,h]=se.useState(!1),{listNotes:p,addNote:g}=us(),v=On("analyst")||On("admin");se.useEffect(()=>{x()},[e]);const x=async()=>{a(!0);try{const P=await p(e);r(P)}catch{r([])}finally{a(!1)}},S=async P=>{if(P.preventDefault(),!(!i.trim()||!v)){h(!0);try{await g(e,i.trim()),u(""),await x()}catch{}finally{h(!1)}}};return n?w.jsx("div",{className:"text-white/60 text-sm",children:"Loading notes..."}):w.jsxs("div",{className:"space-y-4",children:[w.jsx("h3",{className:"text-lg font-semibold text-white",children:"Notes"}),t.length===0?w.jsx("div",{className:"text-white/60 text-sm",children:"No notes yet"}):w.jsx("div",{className:"space-y-3",children:t.map(P=>w.jsxs("div",{className:"bg-white/5 rounded p-3 border border-white/10",children:[w.jsxs("div",{className:"flex items-center justify-between mb-2",children:[w.jsx("span",{className:"text-sm font-medium text-white/80",children:P.author||"Unknown"}),w.jsx("span",{className:"text-xs text-white/60",children:new Date(P.createdAt).toLocaleString()})]}),w.jsx("p",{className:"text-sm text-white/90 whitespace-pre-wrap",children:P.body})]},P.id))}),v&&w.jsxs("form",{onSubmit:S,className:"space-y-2",children:[w.jsx("textarea",{className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white text-sm focus:outline-none focus:border-teal-500 h-24 resize-none",value:i,onChange:P=>u(P.target.value),placeholder:"Add a note...",disabled:s}),w.jsx("div",{className:"flex justify-end",children:w.jsx("button",{type:"submit",className:"px-4 py-2 rounded bg-teal-600 hover:bg-teal-700 text-white text-sm",disabled:!i.trim()||s,children:s?"Adding...":"Add Note"})})]})]})}function QH({caseId:e,onAlertClick:t}){const[r,n]=se.useState([]),[a,i]=se.useState(!1),{alerts:u}=Ns();se.useEffect(()=>{const p=u.filter(g=>g.caseId===e);n(p)},[e,u]);const s=p=>p==="high"?"text-red-400":p==="medium"?"text-yellow-400":"text-blue-400",h=p=>p==="open"?"bg-blue-600":p==="ack"?"bg-yellow-600":"bg-gray-600";return a?w.jsx("div",{className:"text-white/60 text-sm",children:"Loading alerts..."}):w.jsxs("div",{className:"space-y-4",children:[w.jsxs("h3",{className:"text-lg font-semibold text-white",children:["Linked Alerts ",r.length>0&&w.jsxs("span",{className:"text-white/60 text-sm",children:["(",r.length,")"]})]}),r.length===0?w.jsx("div",{className:"text-white/60 text-sm",children:"No alerts linked to this case"}):w.jsx("div",{className:"space-y-2",children:r.map(p=>w.jsx("div",{className:"bg-white/5 rounded p-3 border border-white/10 hover:bg-white/10 cursor-pointer transition-colors",onClick:()=>t==null?void 0:t(p.id),children:w.jsx("div",{className:"flex items-start justify-between gap-2",children:w.jsxs("div",{className:"flex-1",children:[w.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[w.jsx("span",{className:`text-sm font-medium ${s(p.severity)}`,children:p.severity}),w.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${h(p.status)}`,children:p.status}),p.count&&p.count>1&&w.jsxs("span",{className:"text-xs text-white/60",children:["",p.count]})]}),w.jsx("p",{className:"text-sm text-white/90",children:p.message}),w.jsx("p",{className:"text-xs text-white/60 mt-1",children:new Date(p.createdAt).toLocaleString()})]})})},p.id))})]})}const JR=Ti(()=>({provideFeedback:async e=>{var t;try{return(await br.post(`/ml/cases/${e.caseId}/feedback`,{suggestionType:e.suggestionType,suggestedValue:e.suggestedValue,finalValue:e.finalValue||null,action:e.action,score:e.score||null})).data}catch(r){const n=(t=r==null?void 0:r.response)==null?void 0:t.status,a=(r==null?void 0:r.message)||"";throw n===401||n===403||n===404||a.includes("Unauthorized")||a.includes("Forbidden")||a.includes("Not Found")||console.error("Failed to submit feedback:",a),r}},getFeedback:async e=>{var t;try{return(await br.get(`/ml/cases/${e}/feedback`)).data||[]}catch(r){const n=(t=r==null?void 0:r.response)==null?void 0:t.status,a=(r==null?void 0:r.message)||"";return n===401||n===403||n===404||a.includes("Unauthorized")||a.includes("Forbidden")||a.includes("Not Found")?[]:(console.error("Failed to load feedback:",a),[])}}}));function cA({caseData:e,suggestionType:t,suggestedValue:r,score:n,onFeedbackSubmitted:a}){const{provideFeedback:i}=JR(),[u,s]=se.useState(!1),[h,p]=se.useState(!1),[g,v]=se.useState("");if(!On("analyst")&&!On("admin"))return null;const x=async(M,I)=>{s(!0);try{await i({caseId:e.id,suggestionType:t,suggestedValue:r,finalValue:I,action:M,score:n||void 0}),St("Feedback submitted","success"),p(!1),a==null||a()}catch{}finally{s(!1)}},S=()=>{x("accepted")},P=()=>{p(!0)},N=()=>{g?x("overridden",g):x("rejected")};return h?w.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[w.jsx("span",{className:"text-muted",children:"What did you choose?"}),t==="priority"?w.jsxs("select",{value:g,onChange:M=>v(M.target.value),className:"px-2 py-1 bg-gray-800 border border-gray-700 rounded text-white text-sm",children:[w.jsx("option",{value:"",children:"Rejected"}),w.jsx("option",{value:"low",children:"Low"}),w.jsx("option",{value:"medium",children:"Medium"}),w.jsx("option",{value:"high",children:"High"}),w.jsx("option",{value:"critical",children:"Critical"})]}):w.jsx("input",{type:"text",value:g,onChange:M=>v(M.target.value),placeholder:"Owner email",className:"px-2 py-1 bg-gray-800 border border-gray-700 rounded text-white text-sm w-32"}),w.jsx("button",{onClick:N,disabled:u,className:"px-2 py-1 text-xs bg-teal-600 hover:bg-teal-700 rounded text-white disabled:opacity-50",children:"Submit"}),w.jsx("button",{onClick:()=>{p(!1),v("")},className:"px-2 py-1 text-xs bg-gray-600 hover:bg-gray-700 rounded text-white",children:"Cancel"})]}):w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx("span",{className:"text-sm text-muted",children:"Was this helpful?"}),w.jsx("button",{onClick:S,disabled:u,className:"w-7 h-7 p-0 bg-transparent hover:bg-white/10 rounded disabled:opacity-50",title:"Mark as helpful",children:""}),w.jsx("button",{onClick:P,disabled:u,className:"w-7 h-7 p-0 bg-transparent hover:bg-white/10 rounded disabled:opacity-50",title:"Mark as not helpful",children:""})]})}function e7({caseData:e,onUpdate:t}){const{adoptPriority:r,adoptOwner:n,get:a}=us(),[i,u]=se.useState(null),s=On("analyst")||On("admin"),h=async()=>{if(e.prioritySuggestion){u("priority");try{const x=await r(e.id);t(x),St("Priority suggestion adopted")}catch{}finally{u(null)}}},p=async()=>{if(e.ownerSuggestion){u("owner");try{const x=await n(e.id);t(x),St("Owner suggestion adopted")}catch{}finally{u(null)}}},g=async x=>{try{const S=await a(x);window.dispatchEvent(new CustomEvent("navigate-to-cases",{detail:{caseId:x}}))}catch{}},v=x=>x?x==="critical"?"text-red-400":x==="high"?"text-orange-400":x==="medium"?"text-yellow-400":"text-blue-400":"text-white/60";return!e.prioritySuggestion&&!e.ownerSuggestion&&(!e.similarCaseIds||e.similarCaseIds.length===0)?null:w.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[w.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Insights (AI)"}),w.jsxs("div",{className:"space-y-4",children:[e.prioritySuggestion&&w.jsxs("div",{className:"space-y-2",children:[w.jsxs("div",{className:"flex items-center justify-between",children:[w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsxs("div",{children:[w.jsx("div",{className:"text-sm text-white/60 mb-1",children:"Suggested Priority"}),w.jsx("div",{className:`text-lg font-medium ${v(e.prioritySuggestion)}`,children:e.prioritySuggestion})]}),w.jsx(YR,{score:e.priorityScore})]}),s&&w.jsx("button",{onClick:h,disabled:i==="priority",className:"px-3 py-1.5 text-sm bg-teal-600 hover:bg-teal-700 rounded text-white disabled:opacity-50",children:i==="priority"?"Adopting...":"Adopt"})]}),w.jsx(cA,{caseData:e,suggestionType:"priority",suggestedValue:e.prioritySuggestion,score:e.priorityScore,onFeedbackSubmitted:t})]}),e.ownerSuggestion&&w.jsxs("div",{className:"space-y-2",children:[w.jsxs("div",{className:"flex items-center justify-between",children:[w.jsxs("div",{children:[w.jsx("div",{className:"text-sm text-white/60 mb-1",children:"Suggested Owner"}),w.jsx("div",{className:"text-lg text-white/90",children:e.ownerSuggestion})]}),s&&w.jsx("button",{onClick:p,disabled:i==="owner",className:"px-3 py-1.5 text-sm bg-teal-600 hover:bg-teal-700 rounded text-white disabled:opacity-50",children:i==="owner"?"Adopting...":"Adopt"})]}),w.jsx(cA,{caseData:e,suggestionType:"owner",suggestedValue:e.ownerSuggestion,onFeedbackSubmitted:t})]}),e.similarCaseIds&&e.similarCaseIds.length>0&&w.jsxs("div",{children:[w.jsx("div",{className:"text-sm text-white/60 mb-2",children:"Related Cases"}),w.jsx("div",{className:"flex gap-2 flex-wrap",children:e.similarCaseIds.map(x=>w.jsxs("button",{onClick:()=>g(x),className:"px-2 py-1 text-xs bg-teal-600/30 hover:bg-teal-600/40 border border-teal-500/50 rounded text-teal-300 cursor-pointer transition-colors",children:["#",x]},x))})]}),e.mlVersion&&w.jsxs("div",{className:"text-xs text-white/40 pt-2 border-t border-white/10",children:["ML Model: v",e.mlVersion]})]})]})}function t7({caseId:e}){const{getFeedback:t}=JR(),[r,n]=se.useState([]),[a,i]=se.useState(!0),[u,s]=se.useState(!1);se.useEffect(()=>{h()},[e]);const h=async()=>{i(!0);try{const g=await t(e);n(g)}catch{}finally{i(!1)}};if(a||r.length===0)return null;const p=g=>g==="accepted"?"bg-green-600":g==="rejected"?"bg-red-600":"bg-amber-600";return w.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[w.jsxs("button",{onClick:()=>s(!u),className:"flex items-center justify-between w-full text-left",children:[w.jsxs("h3",{className:"text-lg font-semibold text-white",children:["Feedback History (",r.length,")"]}),w.jsx("span",{className:"text-white/60 text-sm",children:u?"":""})]}),u&&w.jsx("div",{className:"mt-4 space-y-3",children:r.map(g=>w.jsxs("div",{className:"bg-white/5 rounded p-3 border border-white/5",children:[w.jsxs("div",{className:"flex items-start justify-between mb-2",children:[w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx(cE,{className:`${p(g.action)} text-white text-xs`,children:g.action}),w.jsx("span",{className:"text-sm text-white/80 capitalize",children:g.suggestionType})]}),w.jsx("span",{className:"text-xs text-white/40",children:new Date(g.createdAt).toLocaleString()})]}),w.jsxs("div",{className:"text-sm text-white/70",children:["Suggested: ",w.jsx("span",{className:"font-medium",children:g.suggestedValue}),g.finalValue&&w.jsxs(w.Fragment,{children:["  ",w.jsx("span",{className:"font-medium",children:g.finalValue})]})]}),g.userId&&w.jsxs("div",{className:"text-xs text-white/40 mt-1",children:["By: ",g.userId]})]},g.id))})]})}function r7({caseId:e,onAlertClick:t}){const[r,n]=se.useState(null),[a,i]=se.useState(!1),{get:u}=us();se.useEffect(()=>{s()},[e]);const s=async()=>{i(!0);try{const p=await u(e);n(p)}catch{n(null)}finally{i(!1)}},h=p=>{n(p),s()};return a?w.jsx("div",{className:"text-white/60 text-sm",children:"Loading case..."}):r?w.jsxs("div",{className:"space-y-6",children:[w.jsxs("div",{children:[w.jsx("h2",{className:"text-2xl font-semibold text-white mb-2",children:r.title}),r.description&&w.jsx("p",{className:"text-white/80 text-sm",children:r.description}),w.jsxs("div",{className:"text-xs text-white/60 mt-2",children:["Created ",new Date(r.createdAt).toLocaleString()," by ",r.createdBy||"Unknown"]})]}),w.jsx(YH,{caseData:r,onUpdate:h}),w.jsx(e7,{caseData:r,onUpdate:h}),w.jsx(t7,{caseId:e}),w.jsx(QH,{caseId:e,onAlertClick:t}),w.jsx(JH,{caseId:e}),w.jsxs("div",{className:"border-t border-white/10 pt-6",children:[w.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Enrichment"}),w.jsx(ZR,{subjectKind:"case",subjectId:e})]}),w.jsxs("div",{className:"border-t border-white/10 pt-6",children:[w.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Playbooks"}),w.jsx(XR,{subjectKind:"case",subjectId:e})]})]}):w.jsx("div",{className:"text-white/60 text-sm",children:"Case not found"})}function n7(){return w.jsx("div",{className:"h-full flex items-center justify-center text-white/60",children:w.jsxs("div",{className:"text-center",children:[w.jsx("p",{className:"text-lg mb-2",children:"No case selected"}),w.jsx("p",{className:"text-sm",children:"Select a case from the list to view details"})]})})}function a7({onCreated:e}){const[t,r]=se.useState(!1),{create:n}=us(),a=async i=>{await n(i),e()};return w.jsxs(w.Fragment,{children:[w.jsx("button",{onClick:()=>r(!0),className:"px-3 py-1.5 text-sm bg-teal-600 hover:bg-teal-700 rounded text-white",children:"New Case"}),w.jsx(qR,{isOpen:t,onClose:()=>r(!1),onSubmit:a})]})}function i7(){const{list:e,selected:t,setSelected:r}=us(),[n,a]=se.useState(null),i=On("analyst")||On("admin");se.useEffect(()=>{e().catch(h=>{const p=(h==null?void 0:h.message)||"";!p.includes("401")&&!p.includes("403")&&!p.includes("404")&&!p.includes("Unauthorized")&&!p.includes("Not Found")&&a(p)})},[e]);const u=()=>{e()},s=h=>{window.dispatchEvent(new CustomEvent("navigate-to-alerts",{detail:{alertId:h}}))};return w.jsxs("div",{className:"h-full grid grid-cols-12 gap-3 p-3",children:[w.jsxs("div",{className:"col-span-4 bg-panel rounded-2xl p-3 overflow-auto",children:[w.jsxs("div",{className:"flex items-center justify-between mb-3",children:[w.jsx("h2",{className:"text-lg font-semibold text-white",children:"Cases"}),i&&w.jsx(a7,{onCreated:u})]}),w.jsx(KH,{onSelect:r})]}),w.jsx("div",{className:"col-span-8 bg-panel rounded-2xl p-3 overflow-auto",children:t?w.jsx(r7,{caseId:t.id,onAlertClick:s}):w.jsx(n7,{})}),n&&w.jsx(so,{isOpen:!0,title:"Error",message:n,onClose:()=>a(null),variant:"error"})]})}function Aa(e){if(typeof e=="string"||typeof e=="number")return""+e;let t="";if(Array.isArray(e))for(let r=0,n;r<e.length;r++)(n=Aa(e[r]))!==""&&(t+=(t&&" ")+n);else for(let r in e)e[r]&&(t+=(t&&" ")+r);return t}const{useDebugValue:s7}=Ke,{useSyncExternalStoreWithSelector:o7}=BD,l7=e=>e;function QR(e,t=l7,r){const n=o7(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,r);return s7(n),n}const dA=(e,t)=>{const r=MD(e),n=(a,i=t)=>QR(r,a,i);return Object.assign(n,r),n},u7=(e,t)=>e?dA(e,t):dA;function va(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[n,a]of e)if(!Object.is(a,t.get(n)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}const r=Object.keys(e);if(r.length!==Object.keys(t).length)return!1;for(const n of r)if(!Object.prototype.hasOwnProperty.call(t,n)||!Object.is(e[n],t[n]))return!1;return!0}var c7={value:()=>{}};function ox(){for(var e=0,t=arguments.length,r={},n;e<t;++e){if(!(n=arguments[e]+"")||n in r||/[\s.]/.test(n))throw new Error("illegal type: "+n);r[n]=[]}return new wy(r)}function wy(e){this._=e}function d7(e,t){return e.trim().split(/^|\s+/).map(function(r){var n="",a=r.indexOf(".");if(a>=0&&(n=r.slice(a+1),r=r.slice(0,a)),r&&!t.hasOwnProperty(r))throw new Error("unknown type: "+r);return{type:r,name:n}})}wy.prototype=ox.prototype={constructor:wy,on:function(e,t){var r=this._,n=d7(e+"",r),a,i=-1,u=n.length;if(arguments.length<2){for(;++i<u;)if((a=(e=n[i]).type)&&(a=h7(r[a],e.name)))return a;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++i<u;)if(a=(e=n[i]).type)r[a]=hA(r[a],e.name,t);else if(t==null)for(a in r)r[a]=hA(r[a],e.name,null);return this},copy:function(){var e={},t=this._;for(var r in t)e[r]=t[r].slice();return new wy(e)},call:function(e,t){if((a=arguments.length-2)>0)for(var r=new Array(a),n=0,a,i;n<a;++n)r[n]=arguments[n+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(i=this._[e],n=0,a=i.length;n<a;++n)i[n].value.apply(t,r)},apply:function(e,t,r){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var n=this._[e],a=0,i=n.length;a<i;++a)n[a].value.apply(t,r)}};function h7(e,t){for(var r=0,n=e.length,a;r<n;++r)if((a=e[r]).name===t)return a.value}function hA(e,t,r){for(var n=0,a=e.length;n<a;++n)if(e[n].name===t){e[n]=c7,e=e.slice(0,n).concat(e.slice(n+1));break}return r!=null&&e.push({name:t,value:r}),e}var y2="http://www.w3.org/1999/xhtml";const fA={svg:"http://www.w3.org/2000/svg",xhtml:y2,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function lx(e){var t=e+="",r=t.indexOf(":");return r>=0&&(t=e.slice(0,r))!=="xmlns"&&(e=e.slice(r+1)),fA.hasOwnProperty(t)?{space:fA[t],local:e}:e}function f7(e){return function(){var t=this.ownerDocument,r=this.namespaceURI;return r===y2&&t.documentElement.namespaceURI===y2?t.createElement(e):t.createElementNS(r,e)}}function p7(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function eL(e){var t=lx(e);return(t.local?p7:f7)(t)}function m7(){}function dE(e){return e==null?m7:function(){return this.querySelector(e)}}function g7(e){typeof e!="function"&&(e=dE(e));for(var t=this._groups,r=t.length,n=new Array(r),a=0;a<r;++a)for(var i=t[a],u=i.length,s=n[a]=new Array(u),h,p,g=0;g<u;++g)(h=i[g])&&(p=e.call(h,h.__data__,g,i))&&("__data__"in h&&(p.__data__=h.__data__),s[g]=p);return new Ui(n,this._parents)}function v7(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function y7(){return[]}function tL(e){return e==null?y7:function(){return this.querySelectorAll(e)}}function x7(e){return function(){return v7(e.apply(this,arguments))}}function b7(e){typeof e=="function"?e=x7(e):e=tL(e);for(var t=this._groups,r=t.length,n=[],a=[],i=0;i<r;++i)for(var u=t[i],s=u.length,h,p=0;p<s;++p)(h=u[p])&&(n.push(e.call(h,h.__data__,p,u)),a.push(h));return new Ui(n,a)}function rL(e){return function(){return this.matches(e)}}function nL(e){return function(t){return t.matches(e)}}var _7=Array.prototype.find;function w7(e){return function(){return _7.call(this.children,e)}}function S7(){return this.firstElementChild}function E7(e){return this.select(e==null?S7:w7(typeof e=="function"?e:nL(e)))}var C7=Array.prototype.filter;function k7(){return Array.from(this.children)}function T7(e){return function(){return C7.call(this.children,e)}}function P7(e){return this.selectAll(e==null?k7:T7(typeof e=="function"?e:nL(e)))}function I7(e){typeof e!="function"&&(e=rL(e));for(var t=this._groups,r=t.length,n=new Array(r),a=0;a<r;++a)for(var i=t[a],u=i.length,s=n[a]=[],h,p=0;p<u;++p)(h=i[p])&&e.call(h,h.__data__,p,i)&&s.push(h);return new Ui(n,this._parents)}function aL(e){return new Array(e.length)}function A7(){return new Ui(this._enter||this._groups.map(aL),this._parents)}function h0(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}h0.prototype={constructor:h0,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function N7(e){return function(){return e}}function M7(e,t,r,n,a,i){for(var u=0,s,h=t.length,p=i.length;u<p;++u)(s=t[u])?(s.__data__=i[u],n[u]=s):r[u]=new h0(e,i[u]);for(;u<h;++u)(s=t[u])&&(a[u]=s)}function D7(e,t,r,n,a,i,u){var s,h,p=new Map,g=t.length,v=i.length,x=new Array(g),S;for(s=0;s<g;++s)(h=t[s])&&(x[s]=S=u.call(h,h.__data__,s,t)+"",p.has(S)?a[s]=h:p.set(S,h));for(s=0;s<v;++s)S=u.call(e,i[s],s,i)+"",(h=p.get(S))?(n[s]=h,h.__data__=i[s],p.delete(S)):r[s]=new h0(e,i[s]);for(s=0;s<g;++s)(h=t[s])&&p.get(x[s])===h&&(a[s]=h)}function z7(e){return e.__data__}function R7(e,t){if(!arguments.length)return Array.from(this,z7);var r=t?D7:M7,n=this._parents,a=this._groups;typeof e!="function"&&(e=N7(e));for(var i=a.length,u=new Array(i),s=new Array(i),h=new Array(i),p=0;p<i;++p){var g=n[p],v=a[p],x=v.length,S=L7(e.call(g,g&&g.__data__,p,n)),P=S.length,N=s[p]=new Array(P),M=u[p]=new Array(P),I=h[p]=new Array(x);r(g,v,N,M,I,S,t);for(var A=0,D=0,j,V;A<P;++A)if(j=N[A]){for(A>=D&&(D=A+1);!(V=M[D])&&++D<P;);j._next=V||null}}return u=new Ui(u,n),u._enter=s,u._exit=h,u}function L7(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function B7(){return new Ui(this._exit||this._groups.map(aL),this._parents)}function j7(e,t,r){var n=this.enter(),a=this,i=this.exit();return typeof e=="function"?(n=e(n),n&&(n=n.selection())):n=n.append(e+""),t!=null&&(a=t(a),a&&(a=a.selection())),r==null?i.remove():r(i),n&&a?n.merge(a).order():a}function O7(e){for(var t=e.selection?e.selection():e,r=this._groups,n=t._groups,a=r.length,i=n.length,u=Math.min(a,i),s=new Array(a),h=0;h<u;++h)for(var p=r[h],g=n[h],v=p.length,x=s[h]=new Array(v),S,P=0;P<v;++P)(S=p[P]||g[P])&&(x[P]=S);for(;h<a;++h)s[h]=r[h];return new Ui(s,this._parents)}function F7(){for(var e=this._groups,t=-1,r=e.length;++t<r;)for(var n=e[t],a=n.length-1,i=n[a],u;--a>=0;)(u=n[a])&&(i&&u.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(u,i),i=u);return this}function $7(e){e||(e=V7);function t(v,x){return v&&x?e(v.__data__,x.__data__):!v-!x}for(var r=this._groups,n=r.length,a=new Array(n),i=0;i<n;++i){for(var u=r[i],s=u.length,h=a[i]=new Array(s),p,g=0;g<s;++g)(p=u[g])&&(h[g]=p);h.sort(t)}return new Ui(a,this._parents).order()}function V7(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function U7(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function q7(){return Array.from(this)}function H7(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var n=e[t],a=0,i=n.length;a<i;++a){var u=n[a];if(u)return u}return null}function G7(){let e=0;for(const t of this)++e;return e}function W7(){return!this.node()}function Z7(e){for(var t=this._groups,r=0,n=t.length;r<n;++r)for(var a=t[r],i=0,u=a.length,s;i<u;++i)(s=a[i])&&e.call(s,s.__data__,i,a);return this}function X7(e){return function(){this.removeAttribute(e)}}function K7(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Y7(e,t){return function(){this.setAttribute(e,t)}}function J7(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Q7(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttribute(e):this.setAttribute(e,r)}}function e9(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,r)}}function t9(e,t){var r=lx(e);if(arguments.length<2){var n=this.node();return r.local?n.getAttributeNS(r.space,r.local):n.getAttribute(r)}return this.each((t==null?r.local?K7:X7:typeof t=="function"?r.local?e9:Q7:r.local?J7:Y7)(r,t))}function iL(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function r9(e){return function(){this.style.removeProperty(e)}}function n9(e,t,r){return function(){this.style.setProperty(e,t,r)}}function a9(e,t,r){return function(){var n=t.apply(this,arguments);n==null?this.style.removeProperty(e):this.style.setProperty(e,n,r)}}function i9(e,t,r){return arguments.length>1?this.each((t==null?r9:typeof t=="function"?a9:n9)(e,t,r??"")):Mh(this.node(),e)}function Mh(e,t){return e.style.getPropertyValue(t)||iL(e).getComputedStyle(e,null).getPropertyValue(t)}function s9(e){return function(){delete this[e]}}function o9(e,t){return function(){this[e]=t}}function l9(e,t){return function(){var r=t.apply(this,arguments);r==null?delete this[e]:this[e]=r}}function u9(e,t){return arguments.length>1?this.each((t==null?s9:typeof t=="function"?l9:o9)(e,t)):this.node()[e]}function sL(e){return e.trim().split(/^|\s+/)}function hE(e){return e.classList||new oL(e)}function oL(e){this._node=e,this._names=sL(e.getAttribute("class")||"")}oL.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function lL(e,t){for(var r=hE(e),n=-1,a=t.length;++n<a;)r.add(t[n])}function uL(e,t){for(var r=hE(e),n=-1,a=t.length;++n<a;)r.remove(t[n])}function c9(e){return function(){lL(this,e)}}function d9(e){return function(){uL(this,e)}}function h9(e,t){return function(){(t.apply(this,arguments)?lL:uL)(this,e)}}function f9(e,t){var r=sL(e+"");if(arguments.length<2){for(var n=hE(this.node()),a=-1,i=r.length;++a<i;)if(!n.contains(r[a]))return!1;return!0}return this.each((typeof t=="function"?h9:t?c9:d9)(r,t))}function p9(){this.textContent=""}function m9(e){return function(){this.textContent=e}}function g9(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function v9(e){return arguments.length?this.each(e==null?p9:(typeof e=="function"?g9:m9)(e)):this.node().textContent}function y9(){this.innerHTML=""}function x9(e){return function(){this.innerHTML=e}}function b9(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function _9(e){return arguments.length?this.each(e==null?y9:(typeof e=="function"?b9:x9)(e)):this.node().innerHTML}function w9(){this.nextSibling&&this.parentNode.appendChild(this)}function S9(){return this.each(w9)}function E9(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function C9(){return this.each(E9)}function k9(e){var t=typeof e=="function"?e:eL(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function T9(){return null}function P9(e,t){var r=typeof e=="function"?e:eL(e),n=t==null?T9:typeof t=="function"?t:dE(t);return this.select(function(){return this.insertBefore(r.apply(this,arguments),n.apply(this,arguments)||null)})}function I9(){var e=this.parentNode;e&&e.removeChild(this)}function A9(){return this.each(I9)}function N9(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function M9(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function D9(e){return this.select(e?M9:N9)}function z9(e){return arguments.length?this.property("__data__",e):this.node().__data__}function R9(e){return function(t){e.call(this,t,this.__data__)}}function L9(e){return e.trim().split(/^|\s+/).map(function(t){var r="",n=t.indexOf(".");return n>=0&&(r=t.slice(n+1),t=t.slice(0,n)),{type:t,name:r}})}function B9(e){return function(){var t=this.__on;if(t){for(var r=0,n=-1,a=t.length,i;r<a;++r)i=t[r],(!e.type||i.type===e.type)&&i.name===e.name?this.removeEventListener(i.type,i.listener,i.options):t[++n]=i;++n?t.length=n:delete this.__on}}}function j9(e,t,r){return function(){var n=this.__on,a,i=R9(t);if(n){for(var u=0,s=n.length;u<s;++u)if((a=n[u]).type===e.type&&a.name===e.name){this.removeEventListener(a.type,a.listener,a.options),this.addEventListener(a.type,a.listener=i,a.options=r),a.value=t;return}}this.addEventListener(e.type,i,r),a={type:e.type,name:e.name,value:t,listener:i,options:r},n?n.push(a):this.__on=[a]}}function O9(e,t,r){var n=L9(e+""),a,i=n.length,u;if(arguments.length<2){var s=this.node().__on;if(s){for(var h=0,p=s.length,g;h<p;++h)for(a=0,g=s[h];a<i;++a)if((u=n[a]).type===g.type&&u.name===g.name)return g.value}return}for(s=t?j9:B9,a=0;a<i;++a)this.each(s(n[a],t,r));return this}function cL(e,t,r){var n=iL(e),a=n.CustomEvent;typeof a=="function"?a=new a(t,r):(a=n.document.createEvent("Event"),r?(a.initEvent(t,r.bubbles,r.cancelable),a.detail=r.detail):a.initEvent(t,!1,!1)),e.dispatchEvent(a)}function F9(e,t){return function(){return cL(this,e,t)}}function $9(e,t){return function(){return cL(this,e,t.apply(this,arguments))}}function V9(e,t){return this.each((typeof t=="function"?$9:F9)(e,t))}function*U9(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var n=e[t],a=0,i=n.length,u;a<i;++a)(u=n[a])&&(yield u)}var dL=[null];function Ui(e,t){this._groups=e,this._parents=t}function Jm(){return new Ui([[document.documentElement]],dL)}function q9(){return this}Ui.prototype=Jm.prototype={constructor:Ui,select:g7,selectAll:b7,selectChild:E7,selectChildren:P7,filter:I7,data:R7,enter:A7,exit:B7,join:j7,merge:O7,selection:q9,order:F7,sort:$7,call:U7,nodes:q7,node:H7,size:G7,empty:W7,each:Z7,attr:t9,style:i9,property:u9,classed:f9,text:v9,html:_9,raise:S9,lower:C9,append:k9,insert:P9,remove:A9,clone:D9,datum:z9,on:O9,dispatch:V9,[Symbol.iterator]:U9};function ss(e){return typeof e=="string"?new Ui([[document.querySelector(e)]],[document.documentElement]):new Ui([[e]],dL)}function H9(e){let t;for(;t=e.sourceEvent;)e=t;return e}function Ts(e,t){if(e=H9(e),t===void 0&&(t=e.currentTarget),t){var r=t.ownerSVGElement||t;if(r.createSVGPoint){var n=r.createSVGPoint();return n.x=e.clientX,n.y=e.clientY,n=n.matrixTransform(t.getScreenCTM().inverse()),[n.x,n.y]}if(t.getBoundingClientRect){var a=t.getBoundingClientRect();return[e.clientX-a.left-t.clientLeft,e.clientY-a.top-t.clientTop]}}return[e.pageX,e.pageY]}const G9={passive:!1},Em={capture:!0,passive:!1};function Fw(e){e.stopImmediatePropagation()}function yh(e){e.preventDefault(),e.stopImmediatePropagation()}function hL(e){var t=e.document.documentElement,r=ss(e).on("dragstart.drag",yh,Em);"onselectstart"in t?r.on("selectstart.drag",yh,Em):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function fL(e,t){var r=e.document.documentElement,n=ss(e).on("dragstart.drag",null);t&&(n.on("click.drag",yh,Em),setTimeout(function(){n.on("click.drag",null)},0)),"onselectstart"in r?n.on("selectstart.drag",null):(r.style.MozUserSelect=r.__noselect,delete r.__noselect)}const jv=e=>()=>e;function x2(e,{sourceEvent:t,subject:r,target:n,identifier:a,active:i,x:u,y:s,dx:h,dy:p,dispatch:g}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:r,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},identifier:{value:a,enumerable:!0,configurable:!0},active:{value:i,enumerable:!0,configurable:!0},x:{value:u,enumerable:!0,configurable:!0},y:{value:s,enumerable:!0,configurable:!0},dx:{value:h,enumerable:!0,configurable:!0},dy:{value:p,enumerable:!0,configurable:!0},_:{value:g}})}x2.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function W9(e){return!e.ctrlKey&&!e.button}function Z9(){return this.parentNode}function X9(e,t){return t??{x:e.x,y:e.y}}function K9(){return navigator.maxTouchPoints||"ontouchstart"in this}function Y9(){var e=W9,t=Z9,r=X9,n=K9,a={},i=ox("start","drag","end"),u=0,s,h,p,g,v=0;function x(j){j.on("mousedown.drag",S).filter(n).on("touchstart.drag",M).on("touchmove.drag",I,G9).on("touchend.drag touchcancel.drag",A).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function S(j,V){if(!(g||!e.call(this,j,V))){var U=D(this,t.call(this,j,V),j,V,"mouse");U&&(ss(j.view).on("mousemove.drag",P,Em).on("mouseup.drag",N,Em),hL(j.view),Fw(j),p=!1,s=j.clientX,h=j.clientY,U("start",j))}}function P(j){if(yh(j),!p){var V=j.clientX-s,U=j.clientY-h;p=V*V+U*U>v}a.mouse("drag",j)}function N(j){ss(j.view).on("mousemove.drag mouseup.drag",null),fL(j.view,p),yh(j),a.mouse("end",j)}function M(j,V){if(e.call(this,j,V)){var U=j.changedTouches,$=t.call(this,j,V),W=U.length,X,J;for(X=0;X<W;++X)(J=D(this,$,j,V,U[X].identifier,U[X]))&&(Fw(j),J("start",j,U[X]))}}function I(j){var V=j.changedTouches,U=V.length,$,W;for($=0;$<U;++$)(W=a[V[$].identifier])&&(yh(j),W("drag",j,V[$]))}function A(j){var V=j.changedTouches,U=V.length,$,W;for(g&&clearTimeout(g),g=setTimeout(function(){g=null},500),$=0;$<U;++$)(W=a[V[$].identifier])&&(Fw(j),W("end",j,V[$]))}function D(j,V,U,$,W,X){var J=i.copy(),Z=Ts(X||U,V),K,Y,G;if((G=r.call(j,new x2("beforestart",{sourceEvent:U,target:x,identifier:W,active:u,x:Z[0],y:Z[1],dx:0,dy:0,dispatch:J}),$))!=null)return K=G.x-Z[0]||0,Y=G.y-Z[1]||0,function oe(ie,ce,fe){var de=Z,be;switch(ie){case"start":a[W]=oe,be=u++;break;case"end":delete a[W],--u;case"drag":Z=Ts(fe||ce,V),be=u;break}J.call(ie,j,new x2(ie,{sourceEvent:ce,subject:G,target:x,identifier:W,active:be,x:Z[0]+K,y:Z[1]+Y,dx:Z[0]-de[0],dy:Z[1]-de[1],dispatch:J}),$)}}return x.filter=function(j){return arguments.length?(e=typeof j=="function"?j:jv(!!j),x):e},x.container=function(j){return arguments.length?(t=typeof j=="function"?j:jv(j),x):t},x.subject=function(j){return arguments.length?(r=typeof j=="function"?j:jv(j),x):r},x.touchable=function(j){return arguments.length?(n=typeof j=="function"?j:jv(!!j),x):n},x.on=function(){var j=i.on.apply(i,arguments);return j===i?x:j},x.clickDistance=function(j){return arguments.length?(v=(j=+j)*j,x):Math.sqrt(v)},x}function fE(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function pL(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function Qm(){}var Cm=.7,f0=1/Cm,xh="\\s*([+-]?\\d+)\\s*",km="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ao="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",J9=/^#([0-9a-f]{3,8})$/,Q9=new RegExp(`^rgb\\(${xh},${xh},${xh}\\)$`),eG=new RegExp(`^rgb\\(${ao},${ao},${ao}\\)$`),tG=new RegExp(`^rgba\\(${xh},${xh},${xh},${km}\\)$`),rG=new RegExp(`^rgba\\(${ao},${ao},${ao},${km}\\)$`),nG=new RegExp(`^hsl\\(${km},${ao},${ao}\\)$`),aG=new RegExp(`^hsla\\(${km},${ao},${ao},${km}\\)$`),pA={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};fE(Qm,Tm,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:mA,formatHex:mA,formatHex8:iG,formatHsl:sG,formatRgb:gA,toString:gA});function mA(){return this.rgb().formatHex()}function iG(){return this.rgb().formatHex8()}function sG(){return mL(this).formatHsl()}function gA(){return this.rgb().formatRgb()}function Tm(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=J9.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?vA(t):r===3?new Si(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?Ov(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?Ov(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Q9.exec(e))?new Si(t[1],t[2],t[3],1):(t=eG.exec(e))?new Si(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=tG.exec(e))?Ov(t[1],t[2],t[3],t[4]):(t=rG.exec(e))?Ov(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=nG.exec(e))?bA(t[1],t[2]/100,t[3]/100,1):(t=aG.exec(e))?bA(t[1],t[2]/100,t[3]/100,t[4]):pA.hasOwnProperty(e)?vA(pA[e]):e==="transparent"?new Si(NaN,NaN,NaN,0):null}function vA(e){return new Si(e>>16&255,e>>8&255,e&255,1)}function Ov(e,t,r,n){return n<=0&&(e=t=r=NaN),new Si(e,t,r,n)}function oG(e){return e instanceof Qm||(e=Tm(e)),e?(e=e.rgb(),new Si(e.r,e.g,e.b,e.opacity)):new Si}function b2(e,t,r,n){return arguments.length===1?oG(e):new Si(e,t,r,n??1)}function Si(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}fE(Si,b2,pL(Qm,{brighter(e){return e=e==null?f0:Math.pow(f0,e),new Si(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Cm:Math.pow(Cm,e),new Si(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Si(fc(this.r),fc(this.g),fc(this.b),p0(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:yA,formatHex:yA,formatHex8:lG,formatRgb:xA,toString:xA}));function yA(){return`#${lc(this.r)}${lc(this.g)}${lc(this.b)}`}function lG(){return`#${lc(this.r)}${lc(this.g)}${lc(this.b)}${lc((isNaN(this.opacity)?1:this.opacity)*255)}`}function xA(){const e=p0(this.opacity);return`${e===1?"rgb(":"rgba("}${fc(this.r)}, ${fc(this.g)}, ${fc(this.b)}${e===1?")":`, ${e})`}`}function p0(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function fc(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function lc(e){return e=fc(e),(e<16?"0":"")+e.toString(16)}function bA(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new As(e,t,r,n)}function mL(e){if(e instanceof As)return new As(e.h,e.s,e.l,e.opacity);if(e instanceof Qm||(e=Tm(e)),!e)return new As;if(e instanceof As)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,a=Math.min(t,r,n),i=Math.max(t,r,n),u=NaN,s=i-a,h=(i+a)/2;return s?(t===i?u=(r-n)/s+(r<n)*6:r===i?u=(n-t)/s+2:u=(t-r)/s+4,s/=h<.5?i+a:2-i-a,u*=60):s=h>0&&h<1?0:u,new As(u,s,h,e.opacity)}function uG(e,t,r,n){return arguments.length===1?mL(e):new As(e,t,r,n??1)}function As(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}fE(As,uG,pL(Qm,{brighter(e){return e=e==null?f0:Math.pow(f0,e),new As(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Cm:Math.pow(Cm,e),new As(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,a=2*r-n;return new Si($w(e>=240?e-240:e+120,a,n),$w(e,a,n),$w(e<120?e+240:e-120,a,n),this.opacity)},clamp(){return new As(_A(this.h),Fv(this.s),Fv(this.l),p0(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=p0(this.opacity);return`${e===1?"hsl(":"hsla("}${_A(this.h)}, ${Fv(this.s)*100}%, ${Fv(this.l)*100}%${e===1?")":`, ${e})`}`}}));function _A(e){return e=(e||0)%360,e<0?e+360:e}function Fv(e){return Math.max(0,Math.min(1,e||0))}function $w(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}const gL=e=>()=>e;function cG(e,t){return function(r){return e+r*t}}function dG(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function hG(e){return(e=+e)==1?vL:function(t,r){return r-t?dG(t,r,e):gL(isNaN(t)?r:t)}}function vL(e,t){var r=t-e;return r?cG(e,r):gL(isNaN(e)?t:e)}const wA=function e(t){var r=hG(t);function n(a,i){var u=r((a=b2(a)).r,(i=b2(i)).r),s=r(a.g,i.g),h=r(a.b,i.b),p=vL(a.opacity,i.opacity);return function(g){return a.r=u(g),a.g=s(g),a.b=h(g),a.opacity=p(g),a+""}}return n.gamma=e,n}(1);function zl(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}var _2=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Vw=new RegExp(_2.source,"g");function fG(e){return function(){return e}}function pG(e){return function(t){return e(t)+""}}function mG(e,t){var r=_2.lastIndex=Vw.lastIndex=0,n,a,i,u=-1,s=[],h=[];for(e=e+"",t=t+"";(n=_2.exec(e))&&(a=Vw.exec(t));)(i=a.index)>r&&(i=t.slice(r,i),s[u]?s[u]+=i:s[++u]=i),(n=n[0])===(a=a[0])?s[u]?s[u]+=a:s[++u]=a:(s[++u]=null,h.push({i:u,x:zl(n,a)})),r=Vw.lastIndex;return r<t.length&&(i=t.slice(r),s[u]?s[u]+=i:s[++u]=i),s.length<2?h[0]?pG(h[0].x):fG(t):(t=h.length,function(p){for(var g=0,v;g<t;++g)s[(v=h[g]).i]=v.x(p);return s.join("")})}var SA=180/Math.PI,w2={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function yL(e,t,r,n,a,i){var u,s,h;return(u=Math.sqrt(e*e+t*t))&&(e/=u,t/=u),(h=e*r+t*n)&&(r-=e*h,n-=t*h),(s=Math.sqrt(r*r+n*n))&&(r/=s,n/=s,h/=s),e*n<t*r&&(e=-e,t=-t,h=-h,u=-u),{translateX:a,translateY:i,rotate:Math.atan2(t,e)*SA,skewX:Math.atan(h)*SA,scaleX:u,scaleY:s}}var $v;function gG(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?w2:yL(t.a,t.b,t.c,t.d,t.e,t.f)}function vG(e){return e==null||($v||($v=document.createElementNS("http://www.w3.org/2000/svg","g")),$v.setAttribute("transform",e),!(e=$v.transform.baseVal.consolidate()))?w2:(e=e.matrix,yL(e.a,e.b,e.c,e.d,e.e,e.f))}function xL(e,t,r,n){function a(p){return p.length?p.pop()+" ":""}function i(p,g,v,x,S,P){if(p!==v||g!==x){var N=S.push("translate(",null,t,null,r);P.push({i:N-4,x:zl(p,v)},{i:N-2,x:zl(g,x)})}else(v||x)&&S.push("translate("+v+t+x+r)}function u(p,g,v,x){p!==g?(p-g>180?g+=360:g-p>180&&(p+=360),x.push({i:v.push(a(v)+"rotate(",null,n)-2,x:zl(p,g)})):g&&v.push(a(v)+"rotate("+g+n)}function s(p,g,v,x){p!==g?x.push({i:v.push(a(v)+"skewX(",null,n)-2,x:zl(p,g)}):g&&v.push(a(v)+"skewX("+g+n)}function h(p,g,v,x,S,P){if(p!==v||g!==x){var N=S.push(a(S)+"scale(",null,",",null,")");P.push({i:N-4,x:zl(p,v)},{i:N-2,x:zl(g,x)})}else(v!==1||x!==1)&&S.push(a(S)+"scale("+v+","+x+")")}return function(p,g){var v=[],x=[];return p=e(p),g=e(g),i(p.translateX,p.translateY,g.translateX,g.translateY,v,x),u(p.rotate,g.rotate,v,x),s(p.skewX,g.skewX,v,x),h(p.scaleX,p.scaleY,g.scaleX,g.scaleY,v,x),p=g=null,function(S){for(var P=-1,N=x.length,M;++P<N;)v[(M=x[P]).i]=M.x(S);return v.join("")}}}var yG=xL(gG,"px, ","px)","deg)"),xG=xL(vG,", ",")",")"),bG=1e-12;function EA(e){return((e=Math.exp(e))+1/e)/2}function _G(e){return((e=Math.exp(e))-1/e)/2}function wG(e){return((e=Math.exp(2*e))-1)/(e+1)}const SG=function e(t,r,n){function a(i,u){var s=i[0],h=i[1],p=i[2],g=u[0],v=u[1],x=u[2],S=g-s,P=v-h,N=S*S+P*P,M,I;if(N<bG)I=Math.log(x/p)/t,M=function($){return[s+$*S,h+$*P,p*Math.exp(t*$*I)]};else{var A=Math.sqrt(N),D=(x*x-p*p+n*N)/(2*p*r*A),j=(x*x-p*p-n*N)/(2*x*r*A),V=Math.log(Math.sqrt(D*D+1)-D),U=Math.log(Math.sqrt(j*j+1)-j);I=(U-V)/t,M=function($){var W=$*I,X=EA(V),J=p/(r*A)*(X*wG(t*W+V)-_G(V));return[s+J*S,h+J*P,p*X/EA(t*W+V)]}}return M.duration=I*1e3*t/Math.SQRT2,M}return a.rho=function(i){var u=Math.max(.001,+i),s=u*u,h=s*s;return e(u,s,h)},a}(Math.SQRT2,2,4);var Dh=0,Pp=0,gp=0,bL=1e3,m0,Ip,g0=0,kc=0,ux=0,Pm=typeof performance=="object"&&performance.now?performance:Date,_L=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function pE(){return kc||(_L(EG),kc=Pm.now()+ux)}function EG(){kc=0}function v0(){this._call=this._time=this._next=null}v0.prototype=wL.prototype={constructor:v0,restart:function(e,t,r){if(typeof e!="function")throw new TypeError("callback is not a function");r=(r==null?pE():+r)+(t==null?0:+t),!this._next&&Ip!==this&&(Ip?Ip._next=this:m0=this,Ip=this),this._call=e,this._time=r,S2()},stop:function(){this._call&&(this._call=null,this._time=1/0,S2())}};function wL(e,t,r){var n=new v0;return n.restart(e,t,r),n}function CG(){pE(),++Dh;for(var e=m0,t;e;)(t=kc-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Dh}function CA(){kc=(g0=Pm.now())+ux,Dh=Pp=0;try{CG()}finally{Dh=0,TG(),kc=0}}function kG(){var e=Pm.now(),t=e-g0;t>bL&&(ux-=t,g0=e)}function TG(){for(var e,t=m0,r,n=1/0;t;)t._call?(n>t._time&&(n=t._time),e=t,t=t._next):(r=t._next,t._next=null,t=e?e._next=r:m0=r);Ip=e,S2(n)}function S2(e){if(!Dh){Pp&&(Pp=clearTimeout(Pp));var t=e-kc;t>24?(e<1/0&&(Pp=setTimeout(CA,e-Pm.now()-ux)),gp&&(gp=clearInterval(gp))):(gp||(g0=Pm.now(),gp=setInterval(kG,bL)),Dh=1,_L(CA))}}function kA(e,t,r){var n=new v0;return t=t==null?0:+t,n.restart(a=>{n.stop(),e(a+t)},t,r),n}var PG=ox("start","end","cancel","interrupt"),IG=[],SL=0,TA=1,E2=2,Sy=3,PA=4,C2=5,Ey=6;function cx(e,t,r,n,a,i){var u=e.__transition;if(!u)e.__transition={};else if(r in u)return;AG(e,r,{name:t,index:n,group:a,on:PG,tween:IG,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:SL})}function mE(e,t){var r=js(e,t);if(r.state>SL)throw new Error("too late; already scheduled");return r}function uo(e,t){var r=js(e,t);if(r.state>Sy)throw new Error("too late; already running");return r}function js(e,t){var r=e.__transition;if(!r||!(r=r[t]))throw new Error("transition not found");return r}function AG(e,t,r){var n=e.__transition,a;n[t]=r,r.timer=wL(i,0,r.time);function i(p){r.state=TA,r.timer.restart(u,r.delay,r.time),r.delay<=p&&u(p-r.delay)}function u(p){var g,v,x,S;if(r.state!==TA)return h();for(g in n)if(S=n[g],S.name===r.name){if(S.state===Sy)return kA(u);S.state===PA?(S.state=Ey,S.timer.stop(),S.on.call("interrupt",e,e.__data__,S.index,S.group),delete n[g]):+g<t&&(S.state=Ey,S.timer.stop(),S.on.call("cancel",e,e.__data__,S.index,S.group),delete n[g])}if(kA(function(){r.state===Sy&&(r.state=PA,r.timer.restart(s,r.delay,r.time),s(p))}),r.state=E2,r.on.call("start",e,e.__data__,r.index,r.group),r.state===E2){for(r.state=Sy,a=new Array(x=r.tween.length),g=0,v=-1;g<x;++g)(S=r.tween[g].value.call(e,e.__data__,r.index,r.group))&&(a[++v]=S);a.length=v+1}}function s(p){for(var g=p<r.duration?r.ease.call(null,p/r.duration):(r.timer.restart(h),r.state=C2,1),v=-1,x=a.length;++v<x;)a[v].call(e,g);r.state===C2&&(r.on.call("end",e,e.__data__,r.index,r.group),h())}function h(){r.state=Ey,r.timer.stop(),delete n[t];for(var p in n)return;delete e.__transition}}function Cy(e,t){var r=e.__transition,n,a,i=!0,u;if(r){t=t==null?null:t+"";for(u in r){if((n=r[u]).name!==t){i=!1;continue}a=n.state>E2&&n.state<C2,n.state=Ey,n.timer.stop(),n.on.call(a?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete r[u]}i&&delete e.__transition}}function NG(e){return this.each(function(){Cy(this,e)})}function MG(e,t){var r,n;return function(){var a=uo(this,e),i=a.tween;if(i!==r){n=r=i;for(var u=0,s=n.length;u<s;++u)if(n[u].name===t){n=n.slice(),n.splice(u,1);break}}a.tween=n}}function DG(e,t,r){var n,a;if(typeof r!="function")throw new Error;return function(){var i=uo(this,e),u=i.tween;if(u!==n){a=(n=u).slice();for(var s={name:t,value:r},h=0,p=a.length;h<p;++h)if(a[h].name===t){a[h]=s;break}h===p&&a.push(s)}i.tween=a}}function zG(e,t){var r=this._id;if(e+="",arguments.length<2){for(var n=js(this.node(),r).tween,a=0,i=n.length,u;a<i;++a)if((u=n[a]).name===e)return u.value;return null}return this.each((t==null?MG:DG)(r,e,t))}function gE(e,t,r){var n=e._id;return e.each(function(){var a=uo(this,n);(a.value||(a.value={}))[t]=r.apply(this,arguments)}),function(a){return js(a,n).value[t]}}function EL(e,t){var r;return(typeof t=="number"?zl:t instanceof Tm?wA:(r=Tm(t))?(t=r,wA):mG)(e,t)}function RG(e){return function(){this.removeAttribute(e)}}function LG(e){return function(){this.removeAttributeNS(e.space,e.local)}}function BG(e,t,r){var n,a=r+"",i;return function(){var u=this.getAttribute(e);return u===a?null:u===n?i:i=t(n=u,r)}}function jG(e,t,r){var n,a=r+"",i;return function(){var u=this.getAttributeNS(e.space,e.local);return u===a?null:u===n?i:i=t(n=u,r)}}function OG(e,t,r){var n,a,i;return function(){var u,s=r(this),h;return s==null?void this.removeAttribute(e):(u=this.getAttribute(e),h=s+"",u===h?null:u===n&&h===a?i:(a=h,i=t(n=u,s)))}}function FG(e,t,r){var n,a,i;return function(){var u,s=r(this),h;return s==null?void this.removeAttributeNS(e.space,e.local):(u=this.getAttributeNS(e.space,e.local),h=s+"",u===h?null:u===n&&h===a?i:(a=h,i=t(n=u,s)))}}function $G(e,t){var r=lx(e),n=r==="transform"?xG:EL;return this.attrTween(e,typeof t=="function"?(r.local?FG:OG)(r,n,gE(this,"attr."+e,t)):t==null?(r.local?LG:RG)(r):(r.local?jG:BG)(r,n,t))}function VG(e,t){return function(r){this.setAttribute(e,t.call(this,r))}}function UG(e,t){return function(r){this.setAttributeNS(e.space,e.local,t.call(this,r))}}function qG(e,t){var r,n;function a(){var i=t.apply(this,arguments);return i!==n&&(r=(n=i)&&UG(e,i)),r}return a._value=t,a}function HG(e,t){var r,n;function a(){var i=t.apply(this,arguments);return i!==n&&(r=(n=i)&&VG(e,i)),r}return a._value=t,a}function GG(e,t){var r="attr."+e;if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;var n=lx(e);return this.tween(r,(n.local?qG:HG)(n,t))}function WG(e,t){return function(){mE(this,e).delay=+t.apply(this,arguments)}}function ZG(e,t){return t=+t,function(){mE(this,e).delay=t}}function XG(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?WG:ZG)(t,e)):js(this.node(),t).delay}function KG(e,t){return function(){uo(this,e).duration=+t.apply(this,arguments)}}function YG(e,t){return t=+t,function(){uo(this,e).duration=t}}function JG(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?KG:YG)(t,e)):js(this.node(),t).duration}function QG(e,t){if(typeof t!="function")throw new Error;return function(){uo(this,e).ease=t}}function eW(e){var t=this._id;return arguments.length?this.each(QG(t,e)):js(this.node(),t).ease}function tW(e,t){return function(){var r=t.apply(this,arguments);if(typeof r!="function")throw new Error;uo(this,e).ease=r}}function rW(e){if(typeof e!="function")throw new Error;return this.each(tW(this._id,e))}function nW(e){typeof e!="function"&&(e=rL(e));for(var t=this._groups,r=t.length,n=new Array(r),a=0;a<r;++a)for(var i=t[a],u=i.length,s=n[a]=[],h,p=0;p<u;++p)(h=i[p])&&e.call(h,h.__data__,p,i)&&s.push(h);return new Ho(n,this._parents,this._name,this._id)}function aW(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,r=e._groups,n=t.length,a=r.length,i=Math.min(n,a),u=new Array(n),s=0;s<i;++s)for(var h=t[s],p=r[s],g=h.length,v=u[s]=new Array(g),x,S=0;S<g;++S)(x=h[S]||p[S])&&(v[S]=x);for(;s<n;++s)u[s]=t[s];return new Ho(u,this._parents,this._name,this._id)}function iW(e){return(e+"").trim().split(/^|\s+/).every(function(t){var r=t.indexOf(".");return r>=0&&(t=t.slice(0,r)),!t||t==="start"})}function sW(e,t,r){var n,a,i=iW(t)?mE:uo;return function(){var u=i(this,e),s=u.on;s!==n&&(a=(n=s).copy()).on(t,r),u.on=a}}function oW(e,t){var r=this._id;return arguments.length<2?js(this.node(),r).on.on(e):this.each(sW(r,e,t))}function lW(e){return function(){var t=this.parentNode;for(var r in this.__transition)if(+r!==e)return;t&&t.removeChild(this)}}function uW(){return this.on("end.remove",lW(this._id))}function cW(e){var t=this._name,r=this._id;typeof e!="function"&&(e=dE(e));for(var n=this._groups,a=n.length,i=new Array(a),u=0;u<a;++u)for(var s=n[u],h=s.length,p=i[u]=new Array(h),g,v,x=0;x<h;++x)(g=s[x])&&(v=e.call(g,g.__data__,x,s))&&("__data__"in g&&(v.__data__=g.__data__),p[x]=v,cx(p[x],t,r,x,p,js(g,r)));return new Ho(i,this._parents,t,r)}function dW(e){var t=this._name,r=this._id;typeof e!="function"&&(e=tL(e));for(var n=this._groups,a=n.length,i=[],u=[],s=0;s<a;++s)for(var h=n[s],p=h.length,g,v=0;v<p;++v)if(g=h[v]){for(var x=e.call(g,g.__data__,v,h),S,P=js(g,r),N=0,M=x.length;N<M;++N)(S=x[N])&&cx(S,t,r,N,x,P);i.push(x),u.push(g)}return new Ho(i,u,t,r)}var hW=Jm.prototype.constructor;function fW(){return new hW(this._groups,this._parents)}function pW(e,t){var r,n,a;return function(){var i=Mh(this,e),u=(this.style.removeProperty(e),Mh(this,e));return i===u?null:i===r&&u===n?a:a=t(r=i,n=u)}}function CL(e){return function(){this.style.removeProperty(e)}}function mW(e,t,r){var n,a=r+"",i;return function(){var u=Mh(this,e);return u===a?null:u===n?i:i=t(n=u,r)}}function gW(e,t,r){var n,a,i;return function(){var u=Mh(this,e),s=r(this),h=s+"";return s==null&&(h=s=(this.style.removeProperty(e),Mh(this,e))),u===h?null:u===n&&h===a?i:(a=h,i=t(n=u,s))}}function vW(e,t){var r,n,a,i="style."+t,u="end."+i,s;return function(){var h=uo(this,e),p=h.on,g=h.value[i]==null?s||(s=CL(t)):void 0;(p!==r||a!==g)&&(n=(r=p).copy()).on(u,a=g),h.on=n}}function yW(e,t,r){var n=(e+="")=="transform"?yG:EL;return t==null?this.styleTween(e,pW(e,n)).on("end.style."+e,CL(e)):typeof t=="function"?this.styleTween(e,gW(e,n,gE(this,"style."+e,t))).each(vW(this._id,e)):this.styleTween(e,mW(e,n,t),r).on("end.style."+e,null)}function xW(e,t,r){return function(n){this.style.setProperty(e,t.call(this,n),r)}}function bW(e,t,r){var n,a;function i(){var u=t.apply(this,arguments);return u!==a&&(n=(a=u)&&xW(e,u,r)),n}return i._value=t,i}function _W(e,t,r){var n="style."+(e+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;return this.tween(n,bW(e,t,r??""))}function wW(e){return function(){this.textContent=e}}function SW(e){return function(){var t=e(this);this.textContent=t??""}}function EW(e){return this.tween("text",typeof e=="function"?SW(gE(this,"text",e)):wW(e==null?"":e+""))}function CW(e){return function(t){this.textContent=e.call(this,t)}}function kW(e){var t,r;function n(){var a=e.apply(this,arguments);return a!==r&&(t=(r=a)&&CW(a)),t}return n._value=e,n}function TW(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,kW(e))}function PW(){for(var e=this._name,t=this._id,r=kL(),n=this._groups,a=n.length,i=0;i<a;++i)for(var u=n[i],s=u.length,h,p=0;p<s;++p)if(h=u[p]){var g=js(h,t);cx(h,e,r,p,u,{time:g.time+g.delay+g.duration,delay:0,duration:g.duration,ease:g.ease})}return new Ho(n,this._parents,e,r)}function IW(){var e,t,r=this,n=r._id,a=r.size();return new Promise(function(i,u){var s={value:u},h={value:function(){--a===0&&i()}};r.each(function(){var p=uo(this,n),g=p.on;g!==e&&(t=(e=g).copy(),t._.cancel.push(s),t._.interrupt.push(s),t._.end.push(h)),p.on=t}),a===0&&i()})}var AW=0;function Ho(e,t,r,n){this._groups=e,this._parents=t,this._name=r,this._id=n}function kL(){return++AW}var Po=Jm.prototype;Ho.prototype={constructor:Ho,select:cW,selectAll:dW,selectChild:Po.selectChild,selectChildren:Po.selectChildren,filter:nW,merge:aW,selection:fW,transition:PW,call:Po.call,nodes:Po.nodes,node:Po.node,size:Po.size,empty:Po.empty,each:Po.each,on:oW,attr:$G,attrTween:GG,style:yW,styleTween:_W,text:EW,textTween:TW,remove:uW,tween:zG,delay:XG,duration:JG,ease:eW,easeVarying:rW,end:IW,[Symbol.iterator]:Po[Symbol.iterator]};function NW(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var MW={time:null,delay:0,duration:250,ease:NW};function DW(e,t){for(var r;!(r=e.__transition)||!(r=r[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return r}function zW(e){var t,r;e instanceof Ho?(t=e._id,e=e._name):(t=kL(),(r=MW).time=pE(),e=e==null?null:e+"");for(var n=this._groups,a=n.length,i=0;i<a;++i)for(var u=n[i],s=u.length,h,p=0;p<s;++p)(h=u[p])&&cx(h,e,t,p,u,r||DW(h,t));return new Ho(n,this._parents,e,t)}Jm.prototype.interrupt=NG;Jm.prototype.transition=zW;const Vv=e=>()=>e;function RW(e,{sourceEvent:t,target:r,transform:n,dispatch:a}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},transform:{value:n,enumerable:!0,configurable:!0},_:{value:a}})}function Lo(e,t,r){this.k=e,this.x=t,this.y=r}Lo.prototype={constructor:Lo,scale:function(e){return e===1?this:new Lo(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new Lo(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var jo=new Lo(1,0,0);Lo.prototype;function Uw(e){e.stopImmediatePropagation()}function vp(e){e.preventDefault(),e.stopImmediatePropagation()}function LW(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function BW(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function IA(){return this.__zoom||jo}function jW(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function OW(){return navigator.maxTouchPoints||"ontouchstart"in this}function FW(e,t,r){var n=e.invertX(t[0][0])-r[0][0],a=e.invertX(t[1][0])-r[1][0],i=e.invertY(t[0][1])-r[0][1],u=e.invertY(t[1][1])-r[1][1];return e.translate(a>n?(n+a)/2:Math.min(0,n)||Math.max(0,a),u>i?(i+u)/2:Math.min(0,i)||Math.max(0,u))}function TL(){var e=LW,t=BW,r=FW,n=jW,a=OW,i=[0,1/0],u=[[-1/0,-1/0],[1/0,1/0]],s=250,h=SG,p=ox("start","zoom","end"),g,v,x,S=500,P=150,N=0,M=10;function I(G){G.property("__zoom",IA).on("wheel.zoom",W,{passive:!1}).on("mousedown.zoom",X).on("dblclick.zoom",J).filter(a).on("touchstart.zoom",Z).on("touchmove.zoom",K).on("touchend.zoom touchcancel.zoom",Y).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}I.transform=function(G,oe,ie,ce){var fe=G.selection?G.selection():G;fe.property("__zoom",IA),G!==fe?V(G,oe,ie,ce):fe.interrupt().each(function(){U(this,arguments).event(ce).start().zoom(null,typeof oe=="function"?oe.apply(this,arguments):oe).end()})},I.scaleBy=function(G,oe,ie,ce){I.scaleTo(G,function(){var fe=this.__zoom.k,de=typeof oe=="function"?oe.apply(this,arguments):oe;return fe*de},ie,ce)},I.scaleTo=function(G,oe,ie,ce){I.transform(G,function(){var fe=t.apply(this,arguments),de=this.__zoom,be=ie==null?j(fe):typeof ie=="function"?ie.apply(this,arguments):ie,ge=de.invert(be),xe=typeof oe=="function"?oe.apply(this,arguments):oe;return r(D(A(de,xe),be,ge),fe,u)},ie,ce)},I.translateBy=function(G,oe,ie,ce){I.transform(G,function(){return r(this.__zoom.translate(typeof oe=="function"?oe.apply(this,arguments):oe,typeof ie=="function"?ie.apply(this,arguments):ie),t.apply(this,arguments),u)},null,ce)},I.translateTo=function(G,oe,ie,ce,fe){I.transform(G,function(){var de=t.apply(this,arguments),be=this.__zoom,ge=ce==null?j(de):typeof ce=="function"?ce.apply(this,arguments):ce;return r(jo.translate(ge[0],ge[1]).scale(be.k).translate(typeof oe=="function"?-oe.apply(this,arguments):-oe,typeof ie=="function"?-ie.apply(this,arguments):-ie),de,u)},ce,fe)};function A(G,oe){return oe=Math.max(i[0],Math.min(i[1],oe)),oe===G.k?G:new Lo(oe,G.x,G.y)}function D(G,oe,ie){var ce=oe[0]-ie[0]*G.k,fe=oe[1]-ie[1]*G.k;return ce===G.x&&fe===G.y?G:new Lo(G.k,ce,fe)}function j(G){return[(+G[0][0]+ +G[1][0])/2,(+G[0][1]+ +G[1][1])/2]}function V(G,oe,ie,ce){G.on("start.zoom",function(){U(this,arguments).event(ce).start()}).on("interrupt.zoom end.zoom",function(){U(this,arguments).event(ce).end()}).tween("zoom",function(){var fe=this,de=arguments,be=U(fe,de).event(ce),ge=t.apply(fe,de),xe=ie==null?j(ge):typeof ie=="function"?ie.apply(fe,de):ie,Le=Math.max(ge[1][0]-ge[0][0],ge[1][1]-ge[0][1]),Oe=fe.__zoom,Fe=typeof oe=="function"?oe.apply(fe,de):oe,et=h(Oe.invert(xe).concat(Le/Oe.k),Fe.invert(xe).concat(Le/Fe.k));return function(nt){if(nt===1)nt=Fe;else{var mt=et(nt),it=Le/mt[2];nt=new Lo(it,xe[0]-mt[0]*it,xe[1]-mt[1]*it)}be.zoom(null,nt)}})}function U(G,oe,ie){return!ie&&G.__zooming||new $(G,oe)}function $(G,oe){this.that=G,this.args=oe,this.active=0,this.sourceEvent=null,this.extent=t.apply(G,oe),this.taps=0}$.prototype={event:function(G){return G&&(this.sourceEvent=G),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(G,oe){return this.mouse&&G!=="mouse"&&(this.mouse[1]=oe.invert(this.mouse[0])),this.touch0&&G!=="touch"&&(this.touch0[1]=oe.invert(this.touch0[0])),this.touch1&&G!=="touch"&&(this.touch1[1]=oe.invert(this.touch1[0])),this.that.__zoom=oe,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(G){var oe=ss(this.that).datum();p.call(G,this.that,new RW(G,{sourceEvent:this.sourceEvent,target:I,transform:this.that.__zoom,dispatch:p}),oe)}};function W(G,...oe){if(!e.apply(this,arguments))return;var ie=U(this,oe).event(G),ce=this.__zoom,fe=Math.max(i[0],Math.min(i[1],ce.k*Math.pow(2,n.apply(this,arguments)))),de=Ts(G);if(ie.wheel)(ie.mouse[0][0]!==de[0]||ie.mouse[0][1]!==de[1])&&(ie.mouse[1]=ce.invert(ie.mouse[0]=de)),clearTimeout(ie.wheel);else{if(ce.k===fe)return;ie.mouse=[de,ce.invert(de)],Cy(this),ie.start()}vp(G),ie.wheel=setTimeout(be,P),ie.zoom("mouse",r(D(A(ce,fe),ie.mouse[0],ie.mouse[1]),ie.extent,u));function be(){ie.wheel=null,ie.end()}}function X(G,...oe){if(x||!e.apply(this,arguments))return;var ie=G.currentTarget,ce=U(this,oe,!0).event(G),fe=ss(G.view).on("mousemove.zoom",xe,!0).on("mouseup.zoom",Le,!0),de=Ts(G,ie),be=G.clientX,ge=G.clientY;hL(G.view),Uw(G),ce.mouse=[de,this.__zoom.invert(de)],Cy(this),ce.start();function xe(Oe){if(vp(Oe),!ce.moved){var Fe=Oe.clientX-be,et=Oe.clientY-ge;ce.moved=Fe*Fe+et*et>N}ce.event(Oe).zoom("mouse",r(D(ce.that.__zoom,ce.mouse[0]=Ts(Oe,ie),ce.mouse[1]),ce.extent,u))}function Le(Oe){fe.on("mousemove.zoom mouseup.zoom",null),fL(Oe.view,ce.moved),vp(Oe),ce.event(Oe).end()}}function J(G,...oe){if(e.apply(this,arguments)){var ie=this.__zoom,ce=Ts(G.changedTouches?G.changedTouches[0]:G,this),fe=ie.invert(ce),de=ie.k*(G.shiftKey?.5:2),be=r(D(A(ie,de),ce,fe),t.apply(this,oe),u);vp(G),s>0?ss(this).transition().duration(s).call(V,be,ce,G):ss(this).call(I.transform,be,ce,G)}}function Z(G,...oe){if(e.apply(this,arguments)){var ie=G.touches,ce=ie.length,fe=U(this,oe,G.changedTouches.length===ce).event(G),de,be,ge,xe;for(Uw(G),be=0;be<ce;++be)ge=ie[be],xe=Ts(ge,this),xe=[xe,this.__zoom.invert(xe),ge.identifier],fe.touch0?!fe.touch1&&fe.touch0[2]!==xe[2]&&(fe.touch1=xe,fe.taps=0):(fe.touch0=xe,de=!0,fe.taps=1+!!g);g&&(g=clearTimeout(g)),de&&(fe.taps<2&&(v=xe[0],g=setTimeout(function(){g=null},S)),Cy(this),fe.start())}}function K(G,...oe){if(this.__zooming){var ie=U(this,oe).event(G),ce=G.changedTouches,fe=ce.length,de,be,ge,xe;for(vp(G),de=0;de<fe;++de)be=ce[de],ge=Ts(be,this),ie.touch0&&ie.touch0[2]===be.identifier?ie.touch0[0]=ge:ie.touch1&&ie.touch1[2]===be.identifier&&(ie.touch1[0]=ge);if(be=ie.that.__zoom,ie.touch1){var Le=ie.touch0[0],Oe=ie.touch0[1],Fe=ie.touch1[0],et=ie.touch1[1],nt=(nt=Fe[0]-Le[0])*nt+(nt=Fe[1]-Le[1])*nt,mt=(mt=et[0]-Oe[0])*mt+(mt=et[1]-Oe[1])*mt;be=A(be,Math.sqrt(nt/mt)),ge=[(Le[0]+Fe[0])/2,(Le[1]+Fe[1])/2],xe=[(Oe[0]+et[0])/2,(Oe[1]+et[1])/2]}else if(ie.touch0)ge=ie.touch0[0],xe=ie.touch0[1];else return;ie.zoom("touch",r(D(be,ge,xe),ie.extent,u))}}function Y(G,...oe){if(this.__zooming){var ie=U(this,oe).event(G),ce=G.changedTouches,fe=ce.length,de,be;for(Uw(G),x&&clearTimeout(x),x=setTimeout(function(){x=null},S),de=0;de<fe;++de)be=ce[de],ie.touch0&&ie.touch0[2]===be.identifier?delete ie.touch0:ie.touch1&&ie.touch1[2]===be.identifier&&delete ie.touch1;if(ie.touch1&&!ie.touch0&&(ie.touch0=ie.touch1,delete ie.touch1),ie.touch0)ie.touch0[1]=this.__zoom.invert(ie.touch0[0]);else if(ie.end(),ie.taps===2&&(be=Ts(be,this),Math.hypot(v[0]-be[0],v[1]-be[1])<M)){var ge=ss(this).on("dblclick.zoom");ge&&ge.apply(this,arguments)}}}return I.wheelDelta=function(G){return arguments.length?(n=typeof G=="function"?G:Vv(+G),I):n},I.filter=function(G){return arguments.length?(e=typeof G=="function"?G:Vv(!!G),I):e},I.touchable=function(G){return arguments.length?(a=typeof G=="function"?G:Vv(!!G),I):a},I.extent=function(G){return arguments.length?(t=typeof G=="function"?G:Vv([[+G[0][0],+G[0][1]],[+G[1][0],+G[1][1]]]),I):t},I.scaleExtent=function(G){return arguments.length?(i[0]=+G[0],i[1]=+G[1],I):[i[0],i[1]]},I.translateExtent=function(G){return arguments.length?(u[0][0]=+G[0][0],u[1][0]=+G[1][0],u[0][1]=+G[0][1],u[1][1]=+G[1][1],I):[[u[0][0],u[0][1]],[u[1][0],u[1][1]]]},I.constrain=function(G){return arguments.length?(r=G,I):r},I.duration=function(G){return arguments.length?(s=+G,I):s},I.interpolate=function(G){return arguments.length?(h=G,I):h},I.on=function(){var G=p.on.apply(p,arguments);return G===p?I:G},I.clickDistance=function(G){return arguments.length?(N=(G=+G)*G,I):Math.sqrt(N)},I.tapDistance=function(G){return arguments.length?(M=+G,I):M},I}const dx=se.createContext(null),$W=dx.Provider,Go={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,t)=>`Couldn't create edge for ${e?"target":"source"} handle id: "${e?t.targetHandle:t.sourceHandle}", edge id: ${t.id}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`},PL=Go.error001();function mn(e,t){const r=se.useContext(dx);if(r===null)throw new Error(PL);return QR(r,e,t)}const na=()=>{const e=se.useContext(dx);if(e===null)throw new Error(PL);return se.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe,destroy:e.destroy}),[e])},VW=e=>e.userSelectionActive?"none":"all";function vE({position:e,children:t,className:r,style:n,...a}){const i=mn(VW),u=`${e}`.split("-");return Ke.createElement("div",{className:Aa(["react-flow__panel",r,...u]),style:{...n,pointerEvents:i},...a},t)}function UW({proOptions:e,position:t="bottom-right"}){return e!=null&&e.hideAttribution?null:Ke.createElement(vE,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://reactflow.dev/pro"},Ke.createElement("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution"},"React Flow"))}const qW=({x:e,y:t,label:r,labelStyle:n={},labelShowBg:a=!0,labelBgStyle:i={},labelBgPadding:u=[2,4],labelBgBorderRadius:s=2,children:h,className:p,...g})=>{const v=se.useRef(null),[x,S]=se.useState({x:0,y:0,width:0,height:0}),P=Aa(["react-flow__edge-textwrapper",p]);return se.useEffect(()=>{if(v.current){const N=v.current.getBBox();S({x:N.x,y:N.y,width:N.width,height:N.height})}},[r]),typeof r>"u"||!r?null:Ke.createElement("g",{transform:`translate(${e-x.width/2} ${t-x.height/2})`,className:P,visibility:x.width?"visible":"hidden",...g},a&&Ke.createElement("rect",{width:x.width+2*u[0],x:-u[0],y:-u[1],height:x.height+2*u[1],className:"react-flow__edge-textbg",style:i,rx:s,ry:s}),Ke.createElement("text",{className:"react-flow__edge-text",y:x.height/2,dy:"0.3em",ref:v,style:n},r),h)};var HW=se.memo(qW);const yE=e=>({width:e.offsetWidth,height:e.offsetHeight}),zh=(e,t=0,r=1)=>Math.min(Math.max(e,t),r),xE=(e={x:0,y:0},t)=>({x:zh(e.x,t[0][0],t[1][0]),y:zh(e.y,t[0][1],t[1][1])}),AA=(e,t,r)=>e<t?zh(Math.abs(e-t),1,50)/50:e>r?-zh(Math.abs(e-r),1,50)/50:0,IL=(e,t)=>{const r=AA(e.x,35,t.width-35)*20,n=AA(e.y,35,t.height-35)*20;return[r,n]},AL=e=>{var t;return((t=e.getRootNode)==null?void 0:t.call(e))||(window==null?void 0:window.document)},NL=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),Im=({x:e,y:t,width:r,height:n})=>({x:e,y:t,x2:e+r,y2:t+n}),ML=({x:e,y:t,x2:r,y2:n})=>({x:e,y:t,width:r-e,height:n-t}),NA=e=>({...e.positionAbsolute||{x:0,y:0},width:e.width||0,height:e.height||0}),GW=(e,t)=>ML(NL(Im(e),Im(t))),k2=(e,t)=>{const r=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),n=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(r*n)},WW=e=>cs(e.width)&&cs(e.height)&&cs(e.x)&&cs(e.y),cs=e=>!isNaN(e)&&isFinite(e),Rn=Symbol.for("internals"),DL=["Enter"," ","Escape"],ZW=(e,t)=>{},XW=e=>"nativeEvent"in e;function T2(e){var a,i;const t=XW(e)?e.nativeEvent:e,r=((i=(a=t.composedPath)==null?void 0:a.call(t))==null?void 0:i[0])||e.target;return["INPUT","SELECT","TEXTAREA"].includes(r==null?void 0:r.nodeName)||(r==null?void 0:r.hasAttribute("contenteditable"))||!!(r!=null&&r.closest(".nokey"))}const zL=e=>"clientX"in e,tu=(e,t)=>{var i,u;const r=zL(e),n=r?e.clientX:(i=e.touches)==null?void 0:i[0].clientX,a=r?e.clientY:(u=e.touches)==null?void 0:u[0].clientY;return{x:n-((t==null?void 0:t.left)??0),y:a-((t==null?void 0:t.top)??0)}},y0=()=>{var e;return typeof navigator<"u"&&((e=navigator==null?void 0:navigator.userAgent)==null?void 0:e.indexOf("Mac"))>=0},eg=({id:e,path:t,labelX:r,labelY:n,label:a,labelStyle:i,labelShowBg:u,labelBgStyle:s,labelBgPadding:h,labelBgBorderRadius:p,style:g,markerEnd:v,markerStart:x,interactionWidth:S=20})=>Ke.createElement(Ke.Fragment,null,Ke.createElement("path",{id:e,style:g,d:t,fill:"none",className:"react-flow__edge-path",markerEnd:v,markerStart:x}),S&&Ke.createElement("path",{d:t,fill:"none",strokeOpacity:0,strokeWidth:S,className:"react-flow__edge-interaction"}),a&&cs(r)&&cs(n)?Ke.createElement(HW,{x:r,y:n,label:a,labelStyle:i,labelShowBg:u,labelBgStyle:s,labelBgPadding:h,labelBgBorderRadius:p}):null);eg.displayName="BaseEdge";function yp(e,t,r){return r===void 0?r:n=>{const a=t().edges.find(i=>i.id===e);a&&r(n,{...a})}}function RL({sourceX:e,sourceY:t,targetX:r,targetY:n}){const a=Math.abs(r-e)/2,i=r<e?r+a:r-a,u=Math.abs(n-t)/2,s=n<t?n+u:n-u;return[i,s,a,u]}function LL({sourceX:e,sourceY:t,targetX:r,targetY:n,sourceControlX:a,sourceControlY:i,targetControlX:u,targetControlY:s}){const h=e*.125+a*.375+u*.375+r*.125,p=t*.125+i*.375+s*.375+n*.125,g=Math.abs(h-e),v=Math.abs(p-t);return[h,p,g,v]}var Tc;(function(e){e.Strict="strict",e.Loose="loose"})(Tc||(Tc={}));var uc;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(uc||(uc={}));var Am;(function(e){e.Partial="partial",e.Full="full"})(Am||(Am={}));var jl;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(jl||(jl={}));var x0;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(x0||(x0={}));var hr;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(hr||(hr={}));function MA({pos:e,x1:t,y1:r,x2:n,y2:a}){return e===hr.Left||e===hr.Right?[.5*(t+n),r]:[t,.5*(r+a)]}function BL({sourceX:e,sourceY:t,sourcePosition:r=hr.Bottom,targetX:n,targetY:a,targetPosition:i=hr.Top}){const[u,s]=MA({pos:r,x1:e,y1:t,x2:n,y2:a}),[h,p]=MA({pos:i,x1:n,y1:a,x2:e,y2:t}),[g,v,x,S]=LL({sourceX:e,sourceY:t,targetX:n,targetY:a,sourceControlX:u,sourceControlY:s,targetControlX:h,targetControlY:p});return[`M${e},${t} C${u},${s} ${h},${p} ${n},${a}`,g,v,x,S]}const bE=se.memo(({sourceX:e,sourceY:t,targetX:r,targetY:n,sourcePosition:a=hr.Bottom,targetPosition:i=hr.Top,label:u,labelStyle:s,labelShowBg:h,labelBgStyle:p,labelBgPadding:g,labelBgBorderRadius:v,style:x,markerEnd:S,markerStart:P,interactionWidth:N})=>{const[M,I,A]=BL({sourceX:e,sourceY:t,sourcePosition:a,targetX:r,targetY:n,targetPosition:i});return Ke.createElement(eg,{path:M,labelX:I,labelY:A,label:u,labelStyle:s,labelShowBg:h,labelBgStyle:p,labelBgPadding:g,labelBgBorderRadius:v,style:x,markerEnd:S,markerStart:P,interactionWidth:N})});bE.displayName="SimpleBezierEdge";const DA={[hr.Left]:{x:-1,y:0},[hr.Right]:{x:1,y:0},[hr.Top]:{x:0,y:-1},[hr.Bottom]:{x:0,y:1}},KW=({source:e,sourcePosition:t=hr.Bottom,target:r})=>t===hr.Left||t===hr.Right?e.x<r.x?{x:1,y:0}:{x:-1,y:0}:e.y<r.y?{x:0,y:1}:{x:0,y:-1},zA=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function YW({source:e,sourcePosition:t=hr.Bottom,target:r,targetPosition:n=hr.Top,center:a,offset:i}){const u=DA[t],s=DA[n],h={x:e.x+u.x*i,y:e.y+u.y*i},p={x:r.x+s.x*i,y:r.y+s.y*i},g=KW({source:h,sourcePosition:t,target:p}),v=g.x!==0?"x":"y",x=g[v];let S=[],P,N;const M={x:0,y:0},I={x:0,y:0},[A,D,j,V]=RL({sourceX:e.x,sourceY:e.y,targetX:r.x,targetY:r.y});if(u[v]*s[v]===-1){P=a.x??A,N=a.y??D;const $=[{x:P,y:h.y},{x:P,y:p.y}],W=[{x:h.x,y:N},{x:p.x,y:N}];u[v]===x?S=v==="x"?$:W:S=v==="x"?W:$}else{const $=[{x:h.x,y:p.y}],W=[{x:p.x,y:h.y}];if(v==="x"?S=u.x===x?W:$:S=u.y===x?$:W,t===n){const Y=Math.abs(e[v]-r[v]);if(Y<=i){const G=Math.min(i-1,i-Y);u[v]===x?M[v]=(h[v]>e[v]?-1:1)*G:I[v]=(p[v]>r[v]?-1:1)*G}}if(t!==n){const Y=v==="x"?"y":"x",G=u[v]===s[Y],oe=h[Y]>p[Y],ie=h[Y]<p[Y];(u[v]===1&&(!G&&oe||G&&ie)||u[v]!==1&&(!G&&ie||G&&oe))&&(S=v==="x"?$:W)}const X={x:h.x+M.x,y:h.y+M.y},J={x:p.x+I.x,y:p.y+I.y},Z=Math.max(Math.abs(X.x-S[0].x),Math.abs(J.x-S[0].x)),K=Math.max(Math.abs(X.y-S[0].y),Math.abs(J.y-S[0].y));Z>=K?(P=(X.x+J.x)/2,N=S[0].y):(P=S[0].x,N=(X.y+J.y)/2)}return[[e,{x:h.x+M.x,y:h.y+M.y},...S,{x:p.x+I.x,y:p.y+I.y},r],P,N,j,V]}function JW(e,t,r,n){const a=Math.min(zA(e,t)/2,zA(t,r)/2,n),{x:i,y:u}=t;if(e.x===i&&i===r.x||e.y===u&&u===r.y)return`L${i} ${u}`;if(e.y===u){const p=e.x<r.x?-1:1,g=e.y<r.y?1:-1;return`L ${i+a*p},${u}Q ${i},${u} ${i},${u+a*g}`}const s=e.x<r.x?1:-1,h=e.y<r.y?-1:1;return`L ${i},${u+a*h}Q ${i},${u} ${i+a*s},${u}`}function P2({sourceX:e,sourceY:t,sourcePosition:r=hr.Bottom,targetX:n,targetY:a,targetPosition:i=hr.Top,borderRadius:u=5,centerX:s,centerY:h,offset:p=20}){const[g,v,x,S,P]=YW({source:{x:e,y:t},sourcePosition:r,target:{x:n,y:a},targetPosition:i,center:{x:s,y:h},offset:p});return[g.reduce((M,I,A)=>{let D="";return A>0&&A<g.length-1?D=JW(g[A-1],I,g[A+1],u):D=`${A===0?"M":"L"}${I.x} ${I.y}`,M+=D,M},""),v,x,S,P]}const hx=se.memo(({sourceX:e,sourceY:t,targetX:r,targetY:n,label:a,labelStyle:i,labelShowBg:u,labelBgStyle:s,labelBgPadding:h,labelBgBorderRadius:p,style:g,sourcePosition:v=hr.Bottom,targetPosition:x=hr.Top,markerEnd:S,markerStart:P,pathOptions:N,interactionWidth:M})=>{const[I,A,D]=P2({sourceX:e,sourceY:t,sourcePosition:v,targetX:r,targetY:n,targetPosition:x,borderRadius:N==null?void 0:N.borderRadius,offset:N==null?void 0:N.offset});return Ke.createElement(eg,{path:I,labelX:A,labelY:D,label:a,labelStyle:i,labelShowBg:u,labelBgStyle:s,labelBgPadding:h,labelBgBorderRadius:p,style:g,markerEnd:S,markerStart:P,interactionWidth:M})});hx.displayName="SmoothStepEdge";const _E=se.memo(e=>{var t;return Ke.createElement(hx,{...e,pathOptions:se.useMemo(()=>{var r;return{borderRadius:0,offset:(r=e.pathOptions)==null?void 0:r.offset}},[(t=e.pathOptions)==null?void 0:t.offset])})});_E.displayName="StepEdge";function QW({sourceX:e,sourceY:t,targetX:r,targetY:n}){const[a,i,u,s]=RL({sourceX:e,sourceY:t,targetX:r,targetY:n});return[`M ${e},${t}L ${r},${n}`,a,i,u,s]}const wE=se.memo(({sourceX:e,sourceY:t,targetX:r,targetY:n,label:a,labelStyle:i,labelShowBg:u,labelBgStyle:s,labelBgPadding:h,labelBgBorderRadius:p,style:g,markerEnd:v,markerStart:x,interactionWidth:S})=>{const[P,N,M]=QW({sourceX:e,sourceY:t,targetX:r,targetY:n});return Ke.createElement(eg,{path:P,labelX:N,labelY:M,label:a,labelStyle:i,labelShowBg:u,labelBgStyle:s,labelBgPadding:h,labelBgBorderRadius:p,style:g,markerEnd:v,markerStart:x,interactionWidth:S})});wE.displayName="StraightEdge";function Uv(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function RA({pos:e,x1:t,y1:r,x2:n,y2:a,c:i}){switch(e){case hr.Left:return[t-Uv(t-n,i),r];case hr.Right:return[t+Uv(n-t,i),r];case hr.Top:return[t,r-Uv(r-a,i)];case hr.Bottom:return[t,r+Uv(a-r,i)]}}function jL({sourceX:e,sourceY:t,sourcePosition:r=hr.Bottom,targetX:n,targetY:a,targetPosition:i=hr.Top,curvature:u=.25}){const[s,h]=RA({pos:r,x1:e,y1:t,x2:n,y2:a,c:u}),[p,g]=RA({pos:i,x1:n,y1:a,x2:e,y2:t,c:u}),[v,x,S,P]=LL({sourceX:e,sourceY:t,targetX:n,targetY:a,sourceControlX:s,sourceControlY:h,targetControlX:p,targetControlY:g});return[`M${e},${t} C${s},${h} ${p},${g} ${n},${a}`,v,x,S,P]}const b0=se.memo(({sourceX:e,sourceY:t,targetX:r,targetY:n,sourcePosition:a=hr.Bottom,targetPosition:i=hr.Top,label:u,labelStyle:s,labelShowBg:h,labelBgStyle:p,labelBgPadding:g,labelBgBorderRadius:v,style:x,markerEnd:S,markerStart:P,pathOptions:N,interactionWidth:M})=>{const[I,A,D]=jL({sourceX:e,sourceY:t,sourcePosition:a,targetX:r,targetY:n,targetPosition:i,curvature:N==null?void 0:N.curvature});return Ke.createElement(eg,{path:I,labelX:A,labelY:D,label:u,labelStyle:s,labelShowBg:h,labelBgStyle:p,labelBgPadding:g,labelBgBorderRadius:v,style:x,markerEnd:S,markerStart:P,interactionWidth:M})});b0.displayName="BezierEdge";const SE=se.createContext(null),eZ=SE.Provider;SE.Consumer;const tZ=()=>se.useContext(SE),rZ=e=>"id"in e&&"source"in e&&"target"in e,nZ=({source:e,sourceHandle:t,target:r,targetHandle:n})=>`reactflow__edge-${e}${t||""}-${r}${n||""}`,I2=(e,t)=>typeof e>"u"?"":typeof e=="string"?e:`${t?`${t}__`:""}${Object.keys(e).sort().map(n=>`${n}=${e[n]}`).join("&")}`,aZ=(e,t)=>t.some(r=>r.source===e.source&&r.target===e.target&&(r.sourceHandle===e.sourceHandle||!r.sourceHandle&&!e.sourceHandle)&&(r.targetHandle===e.targetHandle||!r.targetHandle&&!e.targetHandle)),OL=(e,t)=>{if(!e.source||!e.target)return t;let r;return rZ(e)?r={...e}:r={...e,id:nZ(e)},aZ(r,t)?t:t.concat(r)},A2=({x:e,y:t},[r,n,a],i,[u,s])=>{const h={x:(e-r)/a,y:(t-n)/a};return i?{x:u*Math.round(h.x/u),y:s*Math.round(h.y/s)}:h},FL=({x:e,y:t},[r,n,a])=>({x:e*a+r,y:t*a+n}),pc=(e,t=[0,0])=>{if(!e)return{x:0,y:0,positionAbsolute:{x:0,y:0}};const r=(e.width??0)*t[0],n=(e.height??0)*t[1],a={x:e.position.x-r,y:e.position.y-n};return{...a,positionAbsolute:e.positionAbsolute?{x:e.positionAbsolute.x-r,y:e.positionAbsolute.y-n}:a}},fx=(e,t=[0,0])=>{if(e.length===0)return{x:0,y:0,width:0,height:0};const r=e.reduce((n,a)=>{const{x:i,y:u}=pc(a,t).positionAbsolute;return NL(n,Im({x:i,y:u,width:a.width||0,height:a.height||0}))},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return ML(r)},$L=(e,t,[r,n,a]=[0,0,1],i=!1,u=!1,s=[0,0])=>{const h={x:(t.x-r)/a,y:(t.y-n)/a,width:t.width/a,height:t.height/a},p=[];return e.forEach(g=>{const{width:v,height:x,selectable:S=!0,hidden:P=!1}=g;if(u&&!S||P)return!1;const{positionAbsolute:N}=pc(g,s),M={x:N.x,y:N.y,width:v||0,height:x||0},I=k2(h,M),A=typeof v>"u"||typeof x>"u"||v===null||x===null,D=i&&I>0,j=(v||0)*(x||0);(A||D||I>=j||g.dragging)&&p.push(g)}),p},VL=(e,t)=>{const r=e.map(n=>n.id);return t.filter(n=>r.includes(n.source)||r.includes(n.target))},UL=(e,t,r,n,a,i=.1)=>{const u=t/(e.width*(1+i)),s=r/(e.height*(1+i)),h=Math.min(u,s),p=zh(h,n,a),g=e.x+e.width/2,v=e.y+e.height/2,x=t/2-g*p,S=r/2-v*p;return{x,y:S,zoom:p}},Qu=(e,t=0)=>e.transition().duration(t);function LA(e,t,r,n){return(t[r]||[]).reduce((a,i)=>{var u,s;return`${e.id}-${i.id}-${r}`!==n&&a.push({id:i.id||null,type:r,nodeId:e.id,x:(((u=e.positionAbsolute)==null?void 0:u.x)??0)+i.x+i.width/2,y:(((s=e.positionAbsolute)==null?void 0:s.y)??0)+i.y+i.height/2}),a},[])}function iZ(e,t,r,n,a,i){const{x:u,y:s}=tu(e),p=t.elementsFromPoint(u,s).find(P=>P.classList.contains("react-flow__handle"));if(p){const P=p.getAttribute("data-nodeid");if(P){const N=EE(void 0,p),M=p.getAttribute("data-handleid"),I=i({nodeId:P,id:M,type:N});if(I){const A=a.find(D=>D.nodeId===P&&D.type===N&&D.id===M);return{handle:{id:M,type:N,nodeId:P,x:(A==null?void 0:A.x)||r.x,y:(A==null?void 0:A.y)||r.y},validHandleResult:I}}}}let g=[],v=1/0;if(a.forEach(P=>{const N=Math.sqrt((P.x-r.x)**2+(P.y-r.y)**2);if(N<=n){const M=i(P);N<=v&&(N<v?g=[{handle:P,validHandleResult:M}]:N===v&&g.push({handle:P,validHandleResult:M}),v=N)}}),!g.length)return{handle:null,validHandleResult:qL()};if(g.length===1)return g[0];const x=g.some(({validHandleResult:P})=>P.isValid),S=g.some(({handle:P})=>P.type==="target");return g.find(({handle:P,validHandleResult:N})=>S?P.type==="target":x?N.isValid:!0)||g[0]}const sZ={source:null,target:null,sourceHandle:null,targetHandle:null},qL=()=>({handleDomNode:null,isValid:!1,connection:sZ,endHandle:null});function HL(e,t,r,n,a,i,u){const s=a==="target",h=u.querySelector(`.react-flow__handle[data-id="${e==null?void 0:e.nodeId}-${e==null?void 0:e.id}-${e==null?void 0:e.type}"]`),p={...qL(),handleDomNode:h};if(h){const g=EE(void 0,h),v=h.getAttribute("data-nodeid"),x=h.getAttribute("data-handleid"),S=h.classList.contains("connectable"),P=h.classList.contains("connectableend"),N={source:s?v:r,sourceHandle:s?x:n,target:s?r:v,targetHandle:s?n:x};p.connection=N,S&&P&&(t===Tc.Strict?s&&g==="source"||!s&&g==="target":v!==r||x!==n)&&(p.endHandle={nodeId:v,handleId:x,type:g},p.isValid=i(N))}return p}function oZ({nodes:e,nodeId:t,handleId:r,handleType:n}){return e.reduce((a,i)=>{if(i[Rn]){const{handleBounds:u}=i[Rn];let s=[],h=[];u&&(s=LA(i,u,"source",`${t}-${r}-${n}`),h=LA(i,u,"target",`${t}-${r}-${n}`)),a.push(...s,...h)}return a},[])}function EE(e,t){return e||(t!=null&&t.classList.contains("target")?"target":t!=null&&t.classList.contains("source")?"source":null)}function qw(e){e==null||e.classList.remove("valid","connecting","react-flow__handle-valid","react-flow__handle-connecting")}function lZ(e,t){let r=null;return t?r="valid":e&&!t&&(r="invalid"),r}function GL({event:e,handleId:t,nodeId:r,onConnect:n,isTarget:a,getState:i,setState:u,isValidConnection:s,edgeUpdaterType:h,onReconnectEnd:p}){const g=AL(e.target),{connectionMode:v,domNode:x,autoPanOnConnect:S,connectionRadius:P,onConnectStart:N,panBy:M,getNodes:I,cancelConnection:A}=i();let D=0,j;const{x:V,y:U}=tu(e),$=g==null?void 0:g.elementFromPoint(V,U),W=EE(h,$),X=x==null?void 0:x.getBoundingClientRect();if(!X||!W)return;let J,Z=tu(e,X),K=!1,Y=null,G=!1,oe=null;const ie=oZ({nodes:I(),nodeId:r,handleId:t,handleType:W}),ce=()=>{if(!S)return;const[be,ge]=IL(Z,X);M({x:be,y:ge}),D=requestAnimationFrame(ce)};u({connectionPosition:Z,connectionStatus:null,connectionNodeId:r,connectionHandleId:t,connectionHandleType:W,connectionStartHandle:{nodeId:r,handleId:t,type:W},connectionEndHandle:null}),N==null||N(e,{nodeId:r,handleId:t,handleType:W});function fe(be){const{transform:ge}=i();Z=tu(be,X);const{handle:xe,validHandleResult:Le}=iZ(be,g,A2(Z,ge,!1,[1,1]),P,ie,Oe=>HL(Oe,v,r,t,a?"target":"source",s,g));if(j=xe,K||(ce(),K=!0),oe=Le.handleDomNode,Y=Le.connection,G=Le.isValid,u({connectionPosition:j&&G?FL({x:j.x,y:j.y},ge):Z,connectionStatus:lZ(!!j,G),connectionEndHandle:Le.endHandle}),!j&&!G&&!oe)return qw(J);Y.source!==Y.target&&oe&&(qw(J),J=oe,oe.classList.add("connecting","react-flow__handle-connecting"),oe.classList.toggle("valid",G),oe.classList.toggle("react-flow__handle-valid",G))}function de(be){var ge,xe;(j||oe)&&Y&&G&&(n==null||n(Y)),(xe=(ge=i()).onConnectEnd)==null||xe.call(ge,be),h&&(p==null||p(be)),qw(J),A(),cancelAnimationFrame(D),K=!1,G=!1,Y=null,oe=null,g.removeEventListener("mousemove",fe),g.removeEventListener("mouseup",de),g.removeEventListener("touchmove",fe),g.removeEventListener("touchend",de)}g.addEventListener("mousemove",fe),g.addEventListener("mouseup",de),g.addEventListener("touchmove",fe),g.addEventListener("touchend",de)}const BA=()=>!0,uZ=e=>({connectionStartHandle:e.connectionStartHandle,connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName}),cZ=(e,t,r)=>n=>{const{connectionStartHandle:a,connectionEndHandle:i,connectionClickStartHandle:u}=n;return{connecting:(a==null?void 0:a.nodeId)===e&&(a==null?void 0:a.handleId)===t&&(a==null?void 0:a.type)===r||(i==null?void 0:i.nodeId)===e&&(i==null?void 0:i.handleId)===t&&(i==null?void 0:i.type)===r,clickConnecting:(u==null?void 0:u.nodeId)===e&&(u==null?void 0:u.handleId)===t&&(u==null?void 0:u.type)===r}},WL=se.forwardRef(({type:e="source",position:t=hr.Top,isValidConnection:r,isConnectable:n=!0,isConnectableStart:a=!0,isConnectableEnd:i=!0,id:u,onConnect:s,children:h,className:p,onMouseDown:g,onTouchStart:v,...x},S)=>{var X,J;const P=u||null,N=e==="target",M=na(),I=tZ(),{connectOnClick:A,noPanClassName:D}=mn(uZ,va),{connecting:j,clickConnecting:V}=mn(cZ(I,P,e),va);I||(J=(X=M.getState()).onError)==null||J.call(X,"010",Go.error010());const U=Z=>{const{defaultEdgeOptions:K,onConnect:Y,hasDefaultEdges:G}=M.getState(),oe={...K,...Z};if(G){const{edges:ie,setEdges:ce}=M.getState();ce(OL(oe,ie))}Y==null||Y(oe),s==null||s(oe)},$=Z=>{if(!I)return;const K=zL(Z);a&&(K&&Z.button===0||!K)&&GL({event:Z,handleId:P,nodeId:I,onConnect:U,isTarget:N,getState:M.getState,setState:M.setState,isValidConnection:r||M.getState().isValidConnection||BA}),K?g==null||g(Z):v==null||v(Z)},W=Z=>{const{onClickConnectStart:K,onClickConnectEnd:Y,connectionClickStartHandle:G,connectionMode:oe,isValidConnection:ie}=M.getState();if(!I||!G&&!a)return;if(!G){K==null||K(Z,{nodeId:I,handleId:P,handleType:e}),M.setState({connectionClickStartHandle:{nodeId:I,type:e,handleId:P}});return}const ce=AL(Z.target),fe=r||ie||BA,{connection:de,isValid:be}=HL({nodeId:I,id:P,type:e},oe,G.nodeId,G.handleId||null,G.type,fe,ce);be&&U(de),Y==null||Y(Z),M.setState({connectionClickStartHandle:null})};return Ke.createElement("div",{"data-handleid":P,"data-nodeid":I,"data-handlepos":t,"data-id":`${I}-${P}-${e}`,className:Aa(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",D,p,{source:!N,target:N,connectable:n,connectablestart:a,connectableend:i,connecting:V,connectionindicator:n&&(a&&!j||i&&j)}]),onMouseDown:$,onTouchStart:$,onClick:A?W:void 0,ref:S,...x},h)});WL.displayName="Handle";var Rh=se.memo(WL);const ZL=({data:e,isConnectable:t,targetPosition:r=hr.Top,sourcePosition:n=hr.Bottom})=>Ke.createElement(Ke.Fragment,null,Ke.createElement(Rh,{type:"target",position:r,isConnectable:t}),e==null?void 0:e.label,Ke.createElement(Rh,{type:"source",position:n,isConnectable:t}));ZL.displayName="DefaultNode";var N2=se.memo(ZL);const XL=({data:e,isConnectable:t,sourcePosition:r=hr.Bottom})=>Ke.createElement(Ke.Fragment,null,e==null?void 0:e.label,Ke.createElement(Rh,{type:"source",position:r,isConnectable:t}));XL.displayName="InputNode";var KL=se.memo(XL);const YL=({data:e,isConnectable:t,targetPosition:r=hr.Top})=>Ke.createElement(Ke.Fragment,null,Ke.createElement(Rh,{type:"target",position:r,isConnectable:t}),e==null?void 0:e.label);YL.displayName="OutputNode";var JL=se.memo(YL);const CE=()=>null;CE.displayName="GroupNode";const dZ=e=>({selectedNodes:e.getNodes().filter(t=>t.selected),selectedEdges:e.edges.filter(t=>t.selected).map(t=>({...t}))}),qv=e=>e.id;function hZ(e,t){return va(e.selectedNodes.map(qv),t.selectedNodes.map(qv))&&va(e.selectedEdges.map(qv),t.selectedEdges.map(qv))}const QL=se.memo(({onSelectionChange:e})=>{const t=na(),{selectedNodes:r,selectedEdges:n}=mn(dZ,hZ);return se.useEffect(()=>{const a={nodes:r,edges:n};e==null||e(a),t.getState().onSelectionChange.forEach(i=>i(a))},[r,n,e]),null});QL.displayName="SelectionListener";const fZ=e=>!!e.onSelectionChange;function pZ({onSelectionChange:e}){const t=mn(fZ);return e||t?Ke.createElement(QL,{onSelectionChange:e}):null}const mZ=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset});function jd(e,t){se.useEffect(()=>{typeof e<"u"&&t(e)},[e])}function Dr(e,t,r){se.useEffect(()=>{typeof t<"u"&&r({[e]:t})},[t])}const gZ=({nodes:e,edges:t,defaultNodes:r,defaultEdges:n,onConnect:a,onConnectStart:i,onConnectEnd:u,onClickConnectStart:s,onClickConnectEnd:h,nodesDraggable:p,nodesConnectable:g,nodesFocusable:v,edgesFocusable:x,edgesUpdatable:S,elevateNodesOnSelect:P,minZoom:N,maxZoom:M,nodeExtent:I,onNodesChange:A,onEdgesChange:D,elementsSelectable:j,connectionMode:V,snapGrid:U,snapToGrid:$,translateExtent:W,connectOnClick:X,defaultEdgeOptions:J,fitView:Z,fitViewOptions:K,onNodesDelete:Y,onEdgesDelete:G,onNodeDrag:oe,onNodeDragStart:ie,onNodeDragStop:ce,onSelectionDrag:fe,onSelectionDragStart:de,onSelectionDragStop:be,noPanClassName:ge,nodeOrigin:xe,rfId:Le,autoPanOnConnect:Oe,autoPanOnNodeDrag:Fe,onError:et,connectionRadius:nt,isValidConnection:mt,nodeDragThreshold:it})=>{const{setNodes:ze,setEdges:He,setDefaultNodesAndEdges:We,setMinZoom:ot,setMaxZoom:xt,setTranslateExtent:Tt,setNodeExtent:$e,reset:Xe}=mn(mZ,va),Pe=na();return se.useEffect(()=>{const Ye=n==null?void 0:n.map(at=>({...at,...J}));return We(r,Ye),()=>{Xe()}},[]),Dr("defaultEdgeOptions",J,Pe.setState),Dr("connectionMode",V,Pe.setState),Dr("onConnect",a,Pe.setState),Dr("onConnectStart",i,Pe.setState),Dr("onConnectEnd",u,Pe.setState),Dr("onClickConnectStart",s,Pe.setState),Dr("onClickConnectEnd",h,Pe.setState),Dr("nodesDraggable",p,Pe.setState),Dr("nodesConnectable",g,Pe.setState),Dr("nodesFocusable",v,Pe.setState),Dr("edgesFocusable",x,Pe.setState),Dr("edgesUpdatable",S,Pe.setState),Dr("elementsSelectable",j,Pe.setState),Dr("elevateNodesOnSelect",P,Pe.setState),Dr("snapToGrid",$,Pe.setState),Dr("snapGrid",U,Pe.setState),Dr("onNodesChange",A,Pe.setState),Dr("onEdgesChange",D,Pe.setState),Dr("connectOnClick",X,Pe.setState),Dr("fitViewOnInit",Z,Pe.setState),Dr("fitViewOnInitOptions",K,Pe.setState),Dr("onNodesDelete",Y,Pe.setState),Dr("onEdgesDelete",G,Pe.setState),Dr("onNodeDrag",oe,Pe.setState),Dr("onNodeDragStart",ie,Pe.setState),Dr("onNodeDragStop",ce,Pe.setState),Dr("onSelectionDrag",fe,Pe.setState),Dr("onSelectionDragStart",de,Pe.setState),Dr("onSelectionDragStop",be,Pe.setState),Dr("noPanClassName",ge,Pe.setState),Dr("nodeOrigin",xe,Pe.setState),Dr("rfId",Le,Pe.setState),Dr("autoPanOnConnect",Oe,Pe.setState),Dr("autoPanOnNodeDrag",Fe,Pe.setState),Dr("onError",et,Pe.setState),Dr("connectionRadius",nt,Pe.setState),Dr("isValidConnection",mt,Pe.setState),Dr("nodeDragThreshold",it,Pe.setState),jd(e,ze),jd(t,He),jd(N,ot),jd(M,xt),jd(W,Tt),jd(I,$e),null},jA={display:"none"},vZ={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},eB="react-flow__node-desc",tB="react-flow__edge-desc",yZ="react-flow__aria-live",xZ=e=>e.ariaLiveMessage;function bZ({rfId:e}){const t=mn(xZ);return Ke.createElement("div",{id:`${yZ}-${e}`,"aria-live":"assertive","aria-atomic":"true",style:vZ},t)}function _Z({rfId:e,disableKeyboardA11y:t}){return Ke.createElement(Ke.Fragment,null,Ke.createElement("div",{id:`${eB}-${e}`,style:jA},"Press enter or space to select a node.",!t&&"You can then use the arrow keys to move the node around."," Press delete to remove it and escape to cancel."," "),Ke.createElement("div",{id:`${tB}-${e}`,style:jA},"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel."),!t&&Ke.createElement(bZ,{rfId:e}))}var Nm=(e=null,t={actInsideInputWithModifier:!0})=>{const[r,n]=se.useState(!1),a=se.useRef(!1),i=se.useRef(new Set([])),[u,s]=se.useMemo(()=>{if(e!==null){const p=(Array.isArray(e)?e:[e]).filter(v=>typeof v=="string").map(v=>v.split("+")),g=p.reduce((v,x)=>v.concat(...x),[]);return[p,g]}return[[],[]]},[e]);return se.useEffect(()=>{const h=typeof document<"u"?document:null,p=(t==null?void 0:t.target)||h;if(e!==null){const g=S=>{if(a.current=S.ctrlKey||S.metaKey||S.shiftKey,(!a.current||a.current&&!t.actInsideInputWithModifier)&&T2(S))return!1;const N=FA(S.code,s);i.current.add(S[N]),OA(u,i.current,!1)&&(S.preventDefault(),n(!0))},v=S=>{if((!a.current||a.current&&!t.actInsideInputWithModifier)&&T2(S))return!1;const N=FA(S.code,s);OA(u,i.current,!0)?(n(!1),i.current.clear()):i.current.delete(S[N]),S.key==="Meta"&&i.current.clear(),a.current=!1},x=()=>{i.current.clear(),n(!1)};return p==null||p.addEventListener("keydown",g),p==null||p.addEventListener("keyup",v),window.addEventListener("blur",x),()=>{p==null||p.removeEventListener("keydown",g),p==null||p.removeEventListener("keyup",v),window.removeEventListener("blur",x)}}},[e,n]),r};function OA(e,t,r){return e.filter(n=>r||n.length===t.size).some(n=>n.every(a=>t.has(a)))}function FA(e,t){return t.includes(e)?"code":"key"}function rB(e,t,r,n){var s,h;const a=e.parentNode||e.parentId;if(!a)return r;const i=t.get(a),u=pc(i,n);return rB(i,t,{x:(r.x??0)+u.x,y:(r.y??0)+u.y,z:(((s=i[Rn])==null?void 0:s.z)??0)>(r.z??0)?((h=i[Rn])==null?void 0:h.z)??0:r.z??0},n)}function nB(e,t,r){e.forEach(n=>{var i;const a=n.parentNode||n.parentId;if(a&&!e.has(a))throw new Error(`Parent node ${a} not found`);if(a||r!=null&&r[n.id]){const{x:u,y:s,z:h}=rB(n,e,{...n.position,z:((i=n[Rn])==null?void 0:i.z)??0},t);n.positionAbsolute={x:u,y:s},n[Rn].z=h,r!=null&&r[n.id]&&(n[Rn].isParent=!0)}})}function Hw(e,t,r,n){const a=new Map,i={},u=n?1e3:0;return e.forEach(s=>{var S;const h=(cs(s.zIndex)?s.zIndex:0)+(s.selected?u:0),p=t.get(s.id),g={...s,positionAbsolute:{x:s.position.x,y:s.position.y}},v=s.parentNode||s.parentId;v&&(i[v]=!0);const x=(p==null?void 0:p.type)&&(p==null?void 0:p.type)!==s.type;Object.defineProperty(g,Rn,{enumerable:!1,value:{handleBounds:x||(S=p==null?void 0:p[Rn])==null?void 0:S.handleBounds,z:h}}),a.set(s.id,g)}),nB(a,r,i),a}function aB(e,t={}){const{getNodes:r,width:n,height:a,minZoom:i,maxZoom:u,d3Zoom:s,d3Selection:h,fitViewOnInitDone:p,fitViewOnInit:g,nodeOrigin:v}=e(),x=t.initial&&!p&&g;if(s&&h&&(x||!t.initial)){const P=r().filter(M=>{var A;const I=t.includeHiddenNodes?M.width&&M.height:!M.hidden;return(A=t.nodes)!=null&&A.length?I&&t.nodes.some(D=>D.id===M.id):I}),N=P.every(M=>M.width&&M.height);if(P.length>0&&N){const M=fx(P,v),{x:I,y:A,zoom:D}=UL(M,n,a,t.minZoom??i,t.maxZoom??u,t.padding??.1),j=jo.translate(I,A).scale(D);return typeof t.duration=="number"&&t.duration>0?s.transform(Qu(h,t.duration),j):s.transform(h,j),!0}}return!1}function wZ(e,t){return e.forEach(r=>{const n=t.get(r.id);n&&t.set(n.id,{...n,[Rn]:n[Rn],selected:r.selected})}),new Map(t)}function SZ(e,t){return t.map(r=>{const n=e.find(a=>a.id===r.id);return n&&(r.selected=n.selected),r})}function Hv({changedNodes:e,changedEdges:t,get:r,set:n}){const{nodeInternals:a,edges:i,onNodesChange:u,onEdgesChange:s,hasDefaultNodes:h,hasDefaultEdges:p}=r();e!=null&&e.length&&(h&&n({nodeInternals:wZ(e,a)}),u==null||u(e)),t!=null&&t.length&&(p&&n({edges:SZ(t,i)}),s==null||s(t))}const Od=()=>{},EZ={zoomIn:Od,zoomOut:Od,zoomTo:Od,getZoom:()=>1,setViewport:Od,getViewport:()=>({x:0,y:0,zoom:1}),fitView:()=>!1,setCenter:Od,fitBounds:Od,project:e=>e,screenToFlowPosition:e=>e,flowToScreenPosition:e=>e,viewportInitialized:!1},CZ=e=>({d3Zoom:e.d3Zoom,d3Selection:e.d3Selection}),kZ=()=>{const e=na(),{d3Zoom:t,d3Selection:r}=mn(CZ,va);return se.useMemo(()=>r&&t?{zoomIn:a=>t.scaleBy(Qu(r,a==null?void 0:a.duration),1.2),zoomOut:a=>t.scaleBy(Qu(r,a==null?void 0:a.duration),1/1.2),zoomTo:(a,i)=>t.scaleTo(Qu(r,i==null?void 0:i.duration),a),getZoom:()=>e.getState().transform[2],setViewport:(a,i)=>{const[u,s,h]=e.getState().transform,p=jo.translate(a.x??u,a.y??s).scale(a.zoom??h);t.transform(Qu(r,i==null?void 0:i.duration),p)},getViewport:()=>{const[a,i,u]=e.getState().transform;return{x:a,y:i,zoom:u}},fitView:a=>aB(e.getState,a),setCenter:(a,i,u)=>{const{width:s,height:h,maxZoom:p}=e.getState(),g=typeof(u==null?void 0:u.zoom)<"u"?u.zoom:p,v=s/2-a*g,x=h/2-i*g,S=jo.translate(v,x).scale(g);t.transform(Qu(r,u==null?void 0:u.duration),S)},fitBounds:(a,i)=>{const{width:u,height:s,minZoom:h,maxZoom:p}=e.getState(),{x:g,y:v,zoom:x}=UL(a,u,s,h,p,(i==null?void 0:i.padding)??.1),S=jo.translate(g,v).scale(x);t.transform(Qu(r,i==null?void 0:i.duration),S)},project:a=>{const{transform:i,snapToGrid:u,snapGrid:s}=e.getState();return console.warn("[DEPRECATED] `project` is deprecated. Instead use `screenToFlowPosition`. There is no need to subtract the react flow bounds anymore! https://reactflow.dev/api-reference/types/react-flow-instance#screen-to-flow-position"),A2(a,i,u,s)},screenToFlowPosition:a=>{const{transform:i,snapToGrid:u,snapGrid:s,domNode:h}=e.getState();if(!h)return a;const{x:p,y:g}=h.getBoundingClientRect(),v={x:a.x-p,y:a.y-g};return A2(v,i,u,s)},flowToScreenPosition:a=>{const{transform:i,domNode:u}=e.getState();if(!u)return a;const{x:s,y:h}=u.getBoundingClientRect(),p=FL(a,i);return{x:p.x+s,y:p.y+h}},viewportInitialized:!0}:EZ,[t,r])};function kE(){const e=kZ(),t=na(),r=se.useCallback(()=>t.getState().getNodes().map(N=>({...N})),[]),n=se.useCallback(N=>t.getState().nodeInternals.get(N),[]),a=se.useCallback(()=>{const{edges:N=[]}=t.getState();return N.map(M=>({...M}))},[]),i=se.useCallback(N=>{const{edges:M=[]}=t.getState();return M.find(I=>I.id===N)},[]),u=se.useCallback(N=>{const{getNodes:M,setNodes:I,hasDefaultNodes:A,onNodesChange:D}=t.getState(),j=M(),V=typeof N=="function"?N(j):N;if(A)I(V);else if(D){const U=V.length===0?j.map($=>({type:"remove",id:$.id})):V.map($=>({item:$,type:"reset"}));D(U)}},[]),s=se.useCallback(N=>{const{edges:M=[],setEdges:I,hasDefaultEdges:A,onEdgesChange:D}=t.getState(),j=typeof N=="function"?N(M):N;if(A)I(j);else if(D){const V=j.length===0?M.map(U=>({type:"remove",id:U.id})):j.map(U=>({item:U,type:"reset"}));D(V)}},[]),h=se.useCallback(N=>{const M=Array.isArray(N)?N:[N],{getNodes:I,setNodes:A,hasDefaultNodes:D,onNodesChange:j}=t.getState();if(D){const U=[...I(),...M];A(U)}else if(j){const V=M.map(U=>({item:U,type:"add"}));j(V)}},[]),p=se.useCallback(N=>{const M=Array.isArray(N)?N:[N],{edges:I=[],setEdges:A,hasDefaultEdges:D,onEdgesChange:j}=t.getState();if(D)A([...I,...M]);else if(j){const V=M.map(U=>({item:U,type:"add"}));j(V)}},[]),g=se.useCallback(()=>{const{getNodes:N,edges:M=[],transform:I}=t.getState(),[A,D,j]=I;return{nodes:N().map(V=>({...V})),edges:M.map(V=>({...V})),viewport:{x:A,y:D,zoom:j}}},[]),v=se.useCallback(({nodes:N,edges:M})=>{const{nodeInternals:I,getNodes:A,edges:D,hasDefaultNodes:j,hasDefaultEdges:V,onNodesDelete:U,onEdgesDelete:$,onNodesChange:W,onEdgesChange:X}=t.getState(),J=(N||[]).map(oe=>oe.id),Z=(M||[]).map(oe=>oe.id),K=A().reduce((oe,ie)=>{const ce=ie.parentNode||ie.parentId,fe=!J.includes(ie.id)&&ce&&oe.find(be=>be.id===ce);return(typeof ie.deletable=="boolean"?ie.deletable:!0)&&(J.includes(ie.id)||fe)&&oe.push(ie),oe},[]),Y=D.filter(oe=>typeof oe.deletable=="boolean"?oe.deletable:!0),G=Y.filter(oe=>Z.includes(oe.id));if(K||G){const oe=VL(K,Y),ie=[...G,...oe],ce=ie.reduce((fe,de)=>(fe.includes(de.id)||fe.push(de.id),fe),[]);if((V||j)&&(V&&t.setState({edges:D.filter(fe=>!ce.includes(fe.id))}),j&&(K.forEach(fe=>{I.delete(fe.id)}),t.setState({nodeInternals:new Map(I)}))),ce.length>0&&($==null||$(ie),X&&X(ce.map(fe=>({id:fe,type:"remove"})))),K.length>0&&(U==null||U(K),W)){const fe=K.map(de=>({id:de.id,type:"remove"}));W(fe)}}},[]),x=se.useCallback(N=>{const M=WW(N),I=M?null:t.getState().nodeInternals.get(N.id);return!M&&!I?[null,null,M]:[M?N:NA(I),I,M]},[]),S=se.useCallback((N,M=!0,I)=>{const[A,D,j]=x(N);return A?(I||t.getState().getNodes()).filter(V=>{if(!j&&(V.id===D.id||!V.positionAbsolute))return!1;const U=NA(V),$=k2(U,A);return M&&$>0||$>=A.width*A.height}):[]},[]),P=se.useCallback((N,M,I=!0)=>{const[A]=x(N);if(!A)return!1;const D=k2(A,M);return I&&D>0||D>=A.width*A.height},[]);return se.useMemo(()=>({...e,getNodes:r,getNode:n,getEdges:a,getEdge:i,setNodes:u,setEdges:s,addNodes:h,addEdges:p,toObject:g,deleteElements:v,getIntersectingNodes:S,isNodeIntersecting:P}),[e,r,n,a,i,u,s,h,p,g,v,S,P])}const TZ={actInsideInputWithModifier:!1};var PZ=({deleteKeyCode:e,multiSelectionKeyCode:t})=>{const r=na(),{deleteElements:n}=kE(),a=Nm(e,TZ),i=Nm(t);se.useEffect(()=>{if(a){const{edges:u,getNodes:s}=r.getState(),h=s().filter(g=>g.selected),p=u.filter(g=>g.selected);n({nodes:h,edges:p}),r.setState({nodesSelectionActive:!1})}},[a]),se.useEffect(()=>{r.setState({multiSelectionActive:i})},[i])};function IZ(e){const t=na();se.useEffect(()=>{let r;const n=()=>{var i,u;if(!e.current)return;const a=yE(e.current);(a.height===0||a.width===0)&&((u=(i=t.getState()).onError)==null||u.call(i,"004",Go.error004())),t.setState({width:a.width||500,height:a.height||500})};return n(),window.addEventListener("resize",n),e.current&&(r=new ResizeObserver(()=>n()),r.observe(e.current)),()=>{window.removeEventListener("resize",n),r&&e.current&&r.unobserve(e.current)}},[])}const TE={position:"absolute",width:"100%",height:"100%",top:0,left:0},AZ=(e,t)=>e.x!==t.x||e.y!==t.y||e.zoom!==t.k,Gv=e=>({x:e.x,y:e.y,zoom:e.k}),Fd=(e,t)=>e.target.closest(`.${t}`),$A=(e,t)=>t===2&&Array.isArray(e)&&e.includes(2),VA=e=>{const t=e.ctrlKey&&y0()?10:1;return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*t},NZ=e=>({d3Zoom:e.d3Zoom,d3Selection:e.d3Selection,d3ZoomHandler:e.d3ZoomHandler,userSelectionActive:e.userSelectionActive}),MZ=({onMove:e,onMoveStart:t,onMoveEnd:r,onPaneContextMenu:n,zoomOnScroll:a=!0,zoomOnPinch:i=!0,panOnScroll:u=!1,panOnScrollSpeed:s=.5,panOnScrollMode:h=uc.Free,zoomOnDoubleClick:p=!0,elementsSelectable:g,panOnDrag:v=!0,defaultViewport:x,translateExtent:S,minZoom:P,maxZoom:N,zoomActivationKeyCode:M,preventScrolling:I=!0,children:A,noWheelClassName:D,noPanClassName:j})=>{const V=se.useRef(),U=na(),$=se.useRef(!1),W=se.useRef(!1),X=se.useRef(null),J=se.useRef({x:0,y:0,zoom:0}),{d3Zoom:Z,d3Selection:K,d3ZoomHandler:Y,userSelectionActive:G}=mn(NZ,va),oe=Nm(M),ie=se.useRef(0),ce=se.useRef(!1),fe=se.useRef();return IZ(X),se.useEffect(()=>{if(X.current){const de=X.current.getBoundingClientRect(),be=TL().scaleExtent([P,N]).translateExtent(S),ge=ss(X.current).call(be),xe=jo.translate(x.x,x.y).scale(zh(x.zoom,P,N)),Le=[[0,0],[de.width,de.height]],Oe=be.constrain()(xe,Le,S);be.transform(ge,Oe),be.wheelDelta(VA),U.setState({d3Zoom:be,d3Selection:ge,d3ZoomHandler:ge.on("wheel.zoom"),transform:[Oe.x,Oe.y,Oe.k],domNode:X.current.closest(".react-flow")})}},[]),se.useEffect(()=>{K&&Z&&(u&&!oe&&!G?K.on("wheel.zoom",de=>{if(Fd(de,D))return!1;de.preventDefault(),de.stopImmediatePropagation();const be=K.property("__zoom").k||1;if(de.ctrlKey&&i){const mt=Ts(de),it=VA(de),ze=be*Math.pow(2,it);Z.scaleTo(K,ze,mt,de);return}const ge=de.deltaMode===1?20:1;let xe=h===uc.Vertical?0:de.deltaX*ge,Le=h===uc.Horizontal?0:de.deltaY*ge;!y0()&&de.shiftKey&&h!==uc.Vertical&&(xe=de.deltaY*ge,Le=0),Z.translateBy(K,-(xe/be)*s,-(Le/be)*s,{internal:!0});const Oe=Gv(K.property("__zoom")),{onViewportChangeStart:Fe,onViewportChange:et,onViewportChangeEnd:nt}=U.getState();clearTimeout(fe.current),ce.current||(ce.current=!0,t==null||t(de,Oe),Fe==null||Fe(Oe)),ce.current&&(e==null||e(de,Oe),et==null||et(Oe),fe.current=setTimeout(()=>{r==null||r(de,Oe),nt==null||nt(Oe),ce.current=!1},150))},{passive:!1}):typeof Y<"u"&&K.on("wheel.zoom",function(de,be){if(!I&&de.type==="wheel"&&!de.ctrlKey||Fd(de,D))return null;de.preventDefault(),Y.call(this,de,be)},{passive:!1}))},[G,u,h,K,Z,Y,oe,i,I,D,t,e,r]),se.useEffect(()=>{Z&&Z.on("start",de=>{var xe,Le;if(!de.sourceEvent||de.sourceEvent.internal)return null;ie.current=(xe=de.sourceEvent)==null?void 0:xe.button;const{onViewportChangeStart:be}=U.getState(),ge=Gv(de.transform);$.current=!0,J.current=ge,((Le=de.sourceEvent)==null?void 0:Le.type)==="mousedown"&&U.setState({paneDragging:!0}),be==null||be(ge),t==null||t(de.sourceEvent,ge)})},[Z,t]),se.useEffect(()=>{Z&&(G&&!$.current?Z.on("zoom",null):G||Z.on("zoom",de=>{var ge;const{onViewportChange:be}=U.getState();if(U.setState({transform:[de.transform.x,de.transform.y,de.transform.k]}),W.current=!!(n&&$A(v,ie.current??0)),(e||be)&&!((ge=de.sourceEvent)!=null&&ge.internal)){const xe=Gv(de.transform);be==null||be(xe),e==null||e(de.sourceEvent,xe)}}))},[G,Z,e,v,n]),se.useEffect(()=>{Z&&Z.on("end",de=>{if(!de.sourceEvent||de.sourceEvent.internal)return null;const{onViewportChangeEnd:be}=U.getState();if($.current=!1,U.setState({paneDragging:!1}),n&&$A(v,ie.current??0)&&!W.current&&n(de.sourceEvent),W.current=!1,(r||be)&&AZ(J.current,de.transform)){const ge=Gv(de.transform);J.current=ge,clearTimeout(V.current),V.current=setTimeout(()=>{be==null||be(ge),r==null||r(de.sourceEvent,ge)},u?150:0)}})},[Z,u,v,r,n]),se.useEffect(()=>{Z&&Z.filter(de=>{const be=oe||a,ge=i&&de.ctrlKey;if((v===!0||Array.isArray(v)&&v.includes(1))&&de.button===1&&de.type==="mousedown"&&(Fd(de,"react-flow__node")||Fd(de,"react-flow__edge")))return!0;if(!v&&!be&&!u&&!p&&!i||G||!p&&de.type==="dblclick"||Fd(de,D)&&de.type==="wheel"||Fd(de,j)&&(de.type!=="wheel"||u&&de.type==="wheel"&&!oe)||!i&&de.ctrlKey&&de.type==="wheel"||!be&&!u&&!ge&&de.type==="wheel"||!v&&(de.type==="mousedown"||de.type==="touchstart")||Array.isArray(v)&&!v.includes(de.button)&&de.type==="mousedown")return!1;const xe=Array.isArray(v)&&v.includes(de.button)||!de.button||de.button<=1;return(!de.ctrlKey||de.type==="wheel")&&xe})},[G,Z,a,i,u,p,v,g,oe]),Ke.createElement("div",{className:"react-flow__renderer",ref:X,style:TE},A)},DZ=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function zZ(){const{userSelectionActive:e,userSelectionRect:t}=mn(DZ,va);return e&&t?Ke.createElement("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}function UA(e,t){const r=t.parentNode||t.parentId,n=e.find(a=>a.id===r);if(n){const a=t.position.x+t.width-n.width,i=t.position.y+t.height-n.height;if(a>0||i>0||t.position.x<0||t.position.y<0){if(n.style={...n.style},n.style.width=n.style.width??n.width,n.style.height=n.style.height??n.height,a>0&&(n.style.width+=a),i>0&&(n.style.height+=i),t.position.x<0){const u=Math.abs(t.position.x);n.position.x=n.position.x-u,n.style.width+=u,t.position.x=0}if(t.position.y<0){const u=Math.abs(t.position.y);n.position.y=n.position.y-u,n.style.height+=u,t.position.y=0}n.width=n.style.width,n.height=n.style.height}}}function iB(e,t){if(e.some(n=>n.type==="reset"))return e.filter(n=>n.type==="reset").map(n=>n.item);const r=e.filter(n=>n.type==="add").map(n=>n.item);return t.reduce((n,a)=>{const i=e.filter(s=>s.id===a.id);if(i.length===0)return n.push(a),n;const u={...a};for(const s of i)if(s)switch(s.type){case"select":{u.selected=s.selected;break}case"position":{typeof s.position<"u"&&(u.position=s.position),typeof s.positionAbsolute<"u"&&(u.positionAbsolute=s.positionAbsolute),typeof s.dragging<"u"&&(u.dragging=s.dragging),u.expandParent&&UA(n,u);break}case"dimensions":{typeof s.dimensions<"u"&&(u.width=s.dimensions.width,u.height=s.dimensions.height),typeof s.updateStyle<"u"&&(u.style={...u.style||{},...s.dimensions}),typeof s.resizing=="boolean"&&(u.resizing=s.resizing),u.expandParent&&UA(n,u);break}case"remove":return n}return n.push(u),n},r)}function sB(e,t){return iB(e,t)}function RZ(e,t){return iB(e,t)}const Rl=(e,t)=>({id:e,type:"select",selected:t});function ih(e,t){return e.reduce((r,n)=>{const a=t.includes(n.id);return!n.selected&&a?(n.selected=!0,r.push(Rl(n.id,!0))):n.selected&&!a&&(n.selected=!1,r.push(Rl(n.id,!1))),r},[])}const Gw=(e,t)=>r=>{r.target===t.current&&(e==null||e(r))},LZ=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,dragging:e.paneDragging}),oB=se.memo(({isSelecting:e,selectionMode:t=Am.Full,panOnDrag:r,onSelectionStart:n,onSelectionEnd:a,onPaneClick:i,onPaneContextMenu:u,onPaneScroll:s,onPaneMouseEnter:h,onPaneMouseMove:p,onPaneMouseLeave:g,children:v})=>{const x=se.useRef(null),S=na(),P=se.useRef(0),N=se.useRef(0),M=se.useRef(),{userSelectionActive:I,elementsSelectable:A,dragging:D}=mn(LZ,va),j=()=>{S.setState({userSelectionActive:!1,userSelectionRect:null}),P.current=0,N.current=0},V=Y=>{i==null||i(Y),S.getState().resetSelectedElements(),S.setState({nodesSelectionActive:!1})},U=Y=>{if(Array.isArray(r)&&(r!=null&&r.includes(2))){Y.preventDefault();return}u==null||u(Y)},$=s?Y=>s(Y):void 0,W=Y=>{const{resetSelectedElements:G,domNode:oe}=S.getState();if(M.current=oe==null?void 0:oe.getBoundingClientRect(),!A||!e||Y.button!==0||Y.target!==x.current||!M.current)return;const{x:ie,y:ce}=tu(Y,M.current);G(),S.setState({userSelectionRect:{width:0,height:0,startX:ie,startY:ce,x:ie,y:ce}}),n==null||n(Y)},X=Y=>{const{userSelectionRect:G,nodeInternals:oe,edges:ie,transform:ce,onNodesChange:fe,onEdgesChange:de,nodeOrigin:be,getNodes:ge}=S.getState();if(!e||!M.current||!G)return;S.setState({userSelectionActive:!0,nodesSelectionActive:!1});const xe=tu(Y,M.current),Le=G.startX??0,Oe=G.startY??0,Fe={...G,x:xe.x<Le?xe.x:Le,y:xe.y<Oe?xe.y:Oe,width:Math.abs(xe.x-Le),height:Math.abs(xe.y-Oe)},et=ge(),nt=$L(oe,Fe,ce,t===Am.Partial,!0,be),mt=VL(nt,ie).map(ze=>ze.id),it=nt.map(ze=>ze.id);if(P.current!==it.length){P.current=it.length;const ze=ih(et,it);ze.length&&(fe==null||fe(ze))}if(N.current!==mt.length){N.current=mt.length;const ze=ih(ie,mt);ze.length&&(de==null||de(ze))}S.setState({userSelectionRect:Fe})},J=Y=>{if(Y.button!==0)return;const{userSelectionRect:G}=S.getState();!I&&G&&Y.target===x.current&&(V==null||V(Y)),S.setState({nodesSelectionActive:P.current>0}),j(),a==null||a(Y)},Z=Y=>{I&&(S.setState({nodesSelectionActive:P.current>0}),a==null||a(Y)),j()},K=A&&(e||I);return Ke.createElement("div",{className:Aa(["react-flow__pane",{dragging:D,selection:e}]),onClick:K?void 0:Gw(V,x),onContextMenu:Gw(U,x),onWheel:Gw($,x),onMouseEnter:K?void 0:h,onMouseDown:K?W:void 0,onMouseMove:K?X:p,onMouseUp:K?J:void 0,onMouseLeave:K?Z:g,ref:x,style:TE},v,Ke.createElement(zZ,null))});oB.displayName="Pane";function lB(e,t){const r=e.parentNode||e.parentId;if(!r)return!1;const n=t.get(r);return n?n.selected?!0:lB(n,t):!1}function qA(e,t,r){let n=e;do{if(n!=null&&n.matches(t))return!0;if(n===r.current)return!1;n=n.parentElement}while(n);return!1}function BZ(e,t,r,n){return Array.from(e.values()).filter(a=>(a.selected||a.id===n)&&(!a.parentNode||a.parentId||!lB(a,e))&&(a.draggable||t&&typeof a.draggable>"u")).map(a=>{var i,u;return{id:a.id,position:a.position||{x:0,y:0},positionAbsolute:a.positionAbsolute||{x:0,y:0},distance:{x:r.x-(((i=a.positionAbsolute)==null?void 0:i.x)??0),y:r.y-(((u=a.positionAbsolute)==null?void 0:u.y)??0)},delta:{x:0,y:0},extent:a.extent,parentNode:a.parentNode||a.parentId,parentId:a.parentNode||a.parentId,width:a.width,height:a.height,expandParent:a.expandParent}})}function jZ(e,t){return!t||t==="parent"?t:[t[0],[t[1][0]-(e.width||0),t[1][1]-(e.height||0)]]}function uB(e,t,r,n,a=[0,0],i){const u=jZ(e,e.extent||n);let s=u;const h=e.parentNode||e.parentId;if(e.extent==="parent"&&!e.expandParent)if(h&&e.width&&e.height){const v=r.get(h),{x,y:S}=pc(v,a).positionAbsolute;s=v&&cs(x)&&cs(S)&&cs(v.width)&&cs(v.height)?[[x+e.width*a[0],S+e.height*a[1]],[x+v.width-e.width+e.width*a[0],S+v.height-e.height+e.height*a[1]]]:s}else i==null||i("005",Go.error005()),s=u;else if(e.extent&&h&&e.extent!=="parent"){const v=r.get(h),{x,y:S}=pc(v,a).positionAbsolute;s=[[e.extent[0][0]+x,e.extent[0][1]+S],[e.extent[1][0]+x,e.extent[1][1]+S]]}let p={x:0,y:0};if(h){const v=r.get(h);p=pc(v,a).positionAbsolute}const g=s&&s!=="parent"?xE(t,s):t;return{position:{x:g.x-p.x,y:g.y-p.y},positionAbsolute:g}}function Ww({nodeId:e,dragItems:t,nodeInternals:r}){const n=t.map(a=>({...r.get(a.id),position:a.position,positionAbsolute:a.positionAbsolute}));return[e?n.find(a=>a.id===e):n[0],n]}const HA=(e,t,r,n)=>{const a=t.querySelectorAll(e);if(!a||!a.length)return null;const i=Array.from(a),u=t.getBoundingClientRect(),s={x:u.width*n[0],y:u.height*n[1]};return i.map(h=>{const p=h.getBoundingClientRect();return{id:h.getAttribute("data-handleid"),position:h.getAttribute("data-handlepos"),x:(p.left-u.left-s.x)/r,y:(p.top-u.top-s.y)/r,...yE(h)}})};function xp(e,t,r){return r===void 0?r:n=>{const a=t().nodeInternals.get(e);a&&r(n,{...a})}}function M2({id:e,store:t,unselect:r=!1,nodeRef:n}){const{addSelectedNodes:a,unselectNodesAndEdges:i,multiSelectionActive:u,nodeInternals:s,onError:h}=t.getState(),p=s.get(e);if(!p){h==null||h("012",Go.error012(e));return}t.setState({nodesSelectionActive:!1}),p.selected?(r||p.selected&&u)&&(i({nodes:[p],edges:[]}),requestAnimationFrame(()=>{var g;return(g=n==null?void 0:n.current)==null?void 0:g.blur()})):a([e])}function OZ(){const e=na();return se.useCallback(({sourceEvent:r})=>{const{transform:n,snapGrid:a,snapToGrid:i}=e.getState(),u=r.touches?r.touches[0].clientX:r.clientX,s=r.touches?r.touches[0].clientY:r.clientY,h={x:(u-n[0])/n[2],y:(s-n[1])/n[2]};return{xSnapped:i?a[0]*Math.round(h.x/a[0]):h.x,ySnapped:i?a[1]*Math.round(h.y/a[1]):h.y,...h}},[])}function Zw(e){return(t,r,n)=>e==null?void 0:e(t,n)}function cB({nodeRef:e,disabled:t=!1,noDragClassName:r,handleSelector:n,nodeId:a,isSelectable:i,selectNodesOnDrag:u}){const s=na(),[h,p]=se.useState(!1),g=se.useRef([]),v=se.useRef({x:null,y:null}),x=se.useRef(0),S=se.useRef(null),P=se.useRef({x:0,y:0}),N=se.useRef(null),M=se.useRef(!1),I=se.useRef(!1),A=se.useRef(!1),D=OZ();return se.useEffect(()=>{if(e!=null&&e.current){const j=ss(e.current),V=({x:W,y:X})=>{const{nodeInternals:J,onNodeDrag:Z,onSelectionDrag:K,updateNodePositions:Y,nodeExtent:G,snapGrid:oe,snapToGrid:ie,nodeOrigin:ce,onError:fe}=s.getState();v.current={x:W,y:X};let de=!1,be={x:0,y:0,x2:0,y2:0};if(g.current.length>1&&G){const xe=fx(g.current,ce);be=Im(xe)}if(g.current=g.current.map(xe=>{const Le={x:W-xe.distance.x,y:X-xe.distance.y};ie&&(Le.x=oe[0]*Math.round(Le.x/oe[0]),Le.y=oe[1]*Math.round(Le.y/oe[1]));const Oe=[[G[0][0],G[0][1]],[G[1][0],G[1][1]]];g.current.length>1&&G&&!xe.extent&&(Oe[0][0]=xe.positionAbsolute.x-be.x+G[0][0],Oe[1][0]=xe.positionAbsolute.x+(xe.width??0)-be.x2+G[1][0],Oe[0][1]=xe.positionAbsolute.y-be.y+G[0][1],Oe[1][1]=xe.positionAbsolute.y+(xe.height??0)-be.y2+G[1][1]);const Fe=uB(xe,Le,J,Oe,ce,fe);return de=de||xe.position.x!==Fe.position.x||xe.position.y!==Fe.position.y,xe.position=Fe.position,xe.positionAbsolute=Fe.positionAbsolute,xe}),!de)return;Y(g.current,!0,!0),p(!0);const ge=a?Z:Zw(K);if(ge&&N.current){const[xe,Le]=Ww({nodeId:a,dragItems:g.current,nodeInternals:J});ge(N.current,xe,Le)}},U=()=>{if(!S.current)return;const[W,X]=IL(P.current,S.current);if(W!==0||X!==0){const{transform:J,panBy:Z}=s.getState();v.current.x=(v.current.x??0)-W/J[2],v.current.y=(v.current.y??0)-X/J[2],Z({x:W,y:X})&&V(v.current)}x.current=requestAnimationFrame(U)},$=W=>{var ce;const{nodeInternals:X,multiSelectionActive:J,nodesDraggable:Z,unselectNodesAndEdges:K,onNodeDragStart:Y,onSelectionDragStart:G}=s.getState();I.current=!0;const oe=a?Y:Zw(G);(!u||!i)&&!J&&a&&((ce=X.get(a))!=null&&ce.selected||K()),a&&i&&u&&M2({id:a,store:s,nodeRef:e});const ie=D(W);if(v.current=ie,g.current=BZ(X,Z,ie,a),oe&&g.current){const[fe,de]=Ww({nodeId:a,dragItems:g.current,nodeInternals:X});oe(W.sourceEvent,fe,de)}};if(t)j.on(".drag",null);else{const W=Y9().on("start",X=>{const{domNode:J,nodeDragThreshold:Z}=s.getState();Z===0&&$(X),A.current=!1;const K=D(X);v.current=K,S.current=(J==null?void 0:J.getBoundingClientRect())||null,P.current=tu(X.sourceEvent,S.current)}).on("drag",X=>{var Y,G;const J=D(X),{autoPanOnNodeDrag:Z,nodeDragThreshold:K}=s.getState();if(X.sourceEvent.type==="touchmove"&&X.sourceEvent.touches.length>1&&(A.current=!0),!A.current){if(!M.current&&I.current&&Z&&(M.current=!0,U()),!I.current){const oe=J.xSnapped-(((Y=v==null?void 0:v.current)==null?void 0:Y.x)??0),ie=J.ySnapped-(((G=v==null?void 0:v.current)==null?void 0:G.y)??0);Math.sqrt(oe*oe+ie*ie)>K&&$(X)}(v.current.x!==J.xSnapped||v.current.y!==J.ySnapped)&&g.current&&I.current&&(N.current=X.sourceEvent,P.current=tu(X.sourceEvent,S.current),V(J))}}).on("end",X=>{if(!(!I.current||A.current)&&(p(!1),M.current=!1,I.current=!1,cancelAnimationFrame(x.current),g.current)){const{updateNodePositions:J,nodeInternals:Z,onNodeDragStop:K,onSelectionDragStop:Y}=s.getState(),G=a?K:Zw(Y);if(J(g.current,!1,!1),G){const[oe,ie]=Ww({nodeId:a,dragItems:g.current,nodeInternals:Z});G(X.sourceEvent,oe,ie)}}}).filter(X=>{const J=X.target;return!X.button&&(!r||!qA(J,`.${r}`,e))&&(!n||qA(J,n,e))});return j.call(W),()=>{j.on(".drag",null)}}}},[e,t,r,n,i,s,a,u,D]),h}function dB(){const e=na();return se.useCallback(r=>{const{nodeInternals:n,nodeExtent:a,updateNodePositions:i,getNodes:u,snapToGrid:s,snapGrid:h,onError:p,nodesDraggable:g}=e.getState(),v=u().filter(A=>A.selected&&(A.draggable||g&&typeof A.draggable>"u")),x=s?h[0]:5,S=s?h[1]:5,P=r.isShiftPressed?4:1,N=r.x*x*P,M=r.y*S*P,I=v.map(A=>{if(A.positionAbsolute){const D={x:A.positionAbsolute.x+N,y:A.positionAbsolute.y+M};s&&(D.x=h[0]*Math.round(D.x/h[0]),D.y=h[1]*Math.round(D.y/h[1]));const{positionAbsolute:j,position:V}=uB(A,D,n,a,void 0,p);A.position=V,A.positionAbsolute=j}return A});i(I,!0,!1)},[])}const bh={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}};var bp=e=>{const t=({id:r,type:n,data:a,xPos:i,yPos:u,xPosOrigin:s,yPosOrigin:h,selected:p,onClick:g,onMouseEnter:v,onMouseMove:x,onMouseLeave:S,onContextMenu:P,onDoubleClick:N,style:M,className:I,isDraggable:A,isSelectable:D,isConnectable:j,isFocusable:V,selectNodesOnDrag:U,sourcePosition:$,targetPosition:W,hidden:X,resizeObserver:J,dragHandle:Z,zIndex:K,isParent:Y,noDragClassName:G,noPanClassName:oe,initialized:ie,disableKeyboardA11y:ce,ariaLabel:fe,rfId:de,hasHandleBounds:be})=>{const ge=na(),xe=se.useRef(null),Le=se.useRef(null),Oe=se.useRef($),Fe=se.useRef(W),et=se.useRef(n),nt=D||A||g||v||x||S,mt=dB(),it=xp(r,ge.getState,v),ze=xp(r,ge.getState,x),He=xp(r,ge.getState,S),We=xp(r,ge.getState,P),ot=xp(r,ge.getState,N),xt=Xe=>{const{nodeDragThreshold:Pe}=ge.getState();if(D&&(!U||!A||Pe>0)&&M2({id:r,store:ge,nodeRef:xe}),g){const Ye=ge.getState().nodeInternals.get(r);Ye&&g(Xe,{...Ye})}},Tt=Xe=>{if(!T2(Xe)&&!ce)if(DL.includes(Xe.key)&&D){const Pe=Xe.key==="Escape";M2({id:r,store:ge,unselect:Pe,nodeRef:xe})}else A&&p&&Object.prototype.hasOwnProperty.call(bh,Xe.key)&&(ge.setState({ariaLiveMessage:`Moved selected node ${Xe.key.replace("Arrow","").toLowerCase()}. New position, x: ${~~i}, y: ${~~u}`}),mt({x:bh[Xe.key].x,y:bh[Xe.key].y,isShiftPressed:Xe.shiftKey}))};se.useEffect(()=>()=>{Le.current&&(J==null||J.unobserve(Le.current),Le.current=null)},[]),se.useEffect(()=>{if(xe.current&&!X){const Xe=xe.current;(!ie||!be||Le.current!==Xe)&&(Le.current&&(J==null||J.unobserve(Le.current)),J==null||J.observe(Xe),Le.current=Xe)}},[X,ie,be]),se.useEffect(()=>{const Xe=et.current!==n,Pe=Oe.current!==$,Ye=Fe.current!==W;xe.current&&(Xe||Pe||Ye)&&(Xe&&(et.current=n),Pe&&(Oe.current=$),Ye&&(Fe.current=W),ge.getState().updateNodeDimensions([{id:r,nodeElement:xe.current,forceUpdate:!0}]))},[r,n,$,W]);const $e=cB({nodeRef:xe,disabled:X||!A,noDragClassName:G,handleSelector:Z,nodeId:r,isSelectable:D,selectNodesOnDrag:U});return X?null:Ke.createElement("div",{className:Aa(["react-flow__node",`react-flow__node-${n}`,{[oe]:A},I,{selected:p,selectable:D,parent:Y,dragging:$e}]),ref:xe,style:{zIndex:K,transform:`translate(${s}px,${h}px)`,pointerEvents:nt?"all":"none",visibility:ie?"visible":"hidden",...M},"data-id":r,"data-testid":`rf__node-${r}`,onMouseEnter:it,onMouseMove:ze,onMouseLeave:He,onContextMenu:We,onClick:xt,onDoubleClick:ot,onKeyDown:V?Tt:void 0,tabIndex:V?0:void 0,role:V?"button":void 0,"aria-describedby":ce?void 0:`${eB}-${de}`,"aria-label":fe},Ke.createElement(eZ,{value:r},Ke.createElement(e,{id:r,data:a,type:n,xPos:i,yPos:u,selected:p,isConnectable:j,sourcePosition:$,targetPosition:W,dragging:$e,dragHandle:Z,zIndex:K})))};return t.displayName="NodeWrapper",se.memo(t)};const FZ=e=>{const t=e.getNodes().filter(r=>r.selected);return{...fx(t,e.nodeOrigin),transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`,userSelectionActive:e.userSelectionActive}};function $Z({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:r}){const n=na(),{width:a,height:i,x:u,y:s,transformString:h,userSelectionActive:p}=mn(FZ,va),g=dB(),v=se.useRef(null);if(se.useEffect(()=>{var P;r||(P=v.current)==null||P.focus({preventScroll:!0})},[r]),cB({nodeRef:v}),p||!a||!i)return null;const x=e?P=>{const N=n.getState().getNodes().filter(M=>M.selected);e(P,N)}:void 0,S=P=>{Object.prototype.hasOwnProperty.call(bh,P.key)&&g({x:bh[P.key].x,y:bh[P.key].y,isShiftPressed:P.shiftKey})};return Ke.createElement("div",{className:Aa(["react-flow__nodesselection","react-flow__container",t]),style:{transform:h}},Ke.createElement("div",{ref:v,className:"react-flow__nodesselection-rect",onContextMenu:x,tabIndex:r?void 0:-1,onKeyDown:r?void 0:S,style:{width:a,height:i,top:s,left:u}}))}var VZ=se.memo($Z);const UZ=e=>e.nodesSelectionActive,hB=({children:e,onPaneClick:t,onPaneMouseEnter:r,onPaneMouseMove:n,onPaneMouseLeave:a,onPaneContextMenu:i,onPaneScroll:u,deleteKeyCode:s,onMove:h,onMoveStart:p,onMoveEnd:g,selectionKeyCode:v,selectionOnDrag:x,selectionMode:S,onSelectionStart:P,onSelectionEnd:N,multiSelectionKeyCode:M,panActivationKeyCode:I,zoomActivationKeyCode:A,elementsSelectable:D,zoomOnScroll:j,zoomOnPinch:V,panOnScroll:U,panOnScrollSpeed:$,panOnScrollMode:W,zoomOnDoubleClick:X,panOnDrag:J,defaultViewport:Z,translateExtent:K,minZoom:Y,maxZoom:G,preventScrolling:oe,onSelectionContextMenu:ie,noWheelClassName:ce,noPanClassName:fe,disableKeyboardA11y:de})=>{const be=mn(UZ),ge=Nm(v),xe=Nm(I),Le=xe||J,Oe=xe||U,Fe=ge||x&&Le!==!0;return PZ({deleteKeyCode:s,multiSelectionKeyCode:M}),Ke.createElement(MZ,{onMove:h,onMoveStart:p,onMoveEnd:g,onPaneContextMenu:i,elementsSelectable:D,zoomOnScroll:j,zoomOnPinch:V,panOnScroll:Oe,panOnScrollSpeed:$,panOnScrollMode:W,zoomOnDoubleClick:X,panOnDrag:!ge&&Le,defaultViewport:Z,translateExtent:K,minZoom:Y,maxZoom:G,zoomActivationKeyCode:A,preventScrolling:oe,noWheelClassName:ce,noPanClassName:fe},Ke.createElement(oB,{onSelectionStart:P,onSelectionEnd:N,onPaneClick:t,onPaneMouseEnter:r,onPaneMouseMove:n,onPaneMouseLeave:a,onPaneContextMenu:i,onPaneScroll:u,panOnDrag:Le,isSelecting:!!Fe,selectionMode:S},e,be&&Ke.createElement(VZ,{onSelectionContextMenu:ie,noPanClassName:fe,disableKeyboardA11y:de})))};hB.displayName="FlowRenderer";var qZ=se.memo(hB);function HZ(e){return mn(se.useCallback(r=>e?$L(r.nodeInternals,{x:0,y:0,width:r.width,height:r.height},r.transform,!0):r.getNodes(),[e]))}function GZ(e){const t={input:bp(e.input||KL),default:bp(e.default||N2),output:bp(e.output||JL),group:bp(e.group||CE)},r={},n=Object.keys(e).filter(a=>!["input","default","output","group"].includes(a)).reduce((a,i)=>(a[i]=bp(e[i]||N2),a),r);return{...t,...n}}const WZ=({x:e,y:t,width:r,height:n,origin:a})=>!r||!n?{x:e,y:t}:a[0]<0||a[1]<0||a[0]>1||a[1]>1?{x:e,y:t}:{x:e-r*a[0],y:t-n*a[1]},ZZ=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,updateNodeDimensions:e.updateNodeDimensions,onError:e.onError}),fB=e=>{const{nodesDraggable:t,nodesConnectable:r,nodesFocusable:n,elementsSelectable:a,updateNodeDimensions:i,onError:u}=mn(ZZ,va),s=HZ(e.onlyRenderVisibleElements),h=se.useRef(),p=se.useMemo(()=>{if(typeof ResizeObserver>"u")return null;const g=new ResizeObserver(v=>{const x=v.map(S=>({id:S.target.getAttribute("data-id"),nodeElement:S.target,forceUpdate:!0}));i(x)});return h.current=g,g},[]);return se.useEffect(()=>()=>{var g;(g=h==null?void 0:h.current)==null||g.disconnect()},[]),Ke.createElement("div",{className:"react-flow__nodes",style:TE},s.map(g=>{var V,U,$;let v=g.type||"default";e.nodeTypes[v]||(u==null||u("003",Go.error003(v)),v="default");const x=e.nodeTypes[v]||e.nodeTypes.default,S=!!(g.draggable||t&&typeof g.draggable>"u"),P=!!(g.selectable||a&&typeof g.selectable>"u"),N=!!(g.connectable||r&&typeof g.connectable>"u"),M=!!(g.focusable||n&&typeof g.focusable>"u"),I=e.nodeExtent?xE(g.positionAbsolute,e.nodeExtent):g.positionAbsolute,A=(I==null?void 0:I.x)??0,D=(I==null?void 0:I.y)??0,j=WZ({x:A,y:D,width:g.width??0,height:g.height??0,origin:e.nodeOrigin});return Ke.createElement(x,{key:g.id,id:g.id,className:g.className,style:g.style,type:v,data:g.data,sourcePosition:g.sourcePosition||hr.Bottom,targetPosition:g.targetPosition||hr.Top,hidden:g.hidden,xPos:A,yPos:D,xPosOrigin:j.x,yPosOrigin:j.y,selectNodesOnDrag:e.selectNodesOnDrag,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,selected:!!g.selected,isDraggable:S,isSelectable:P,isConnectable:N,isFocusable:M,resizeObserver:p,dragHandle:g.dragHandle,zIndex:((V=g[Rn])==null?void 0:V.z)??0,isParent:!!((U=g[Rn])!=null&&U.isParent),noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,initialized:!!g.width&&!!g.height,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,ariaLabel:g.ariaLabel,hasHandleBounds:!!(($=g[Rn])!=null&&$.handleBounds)})}))};fB.displayName="NodeRenderer";var XZ=se.memo(fB);const KZ=(e,t,r)=>r===hr.Left?e-t:r===hr.Right?e+t:e,YZ=(e,t,r)=>r===hr.Top?e-t:r===hr.Bottom?e+t:e,GA="react-flow__edgeupdater",WA=({position:e,centerX:t,centerY:r,radius:n=10,onMouseDown:a,onMouseEnter:i,onMouseOut:u,type:s})=>Ke.createElement("circle",{onMouseDown:a,onMouseEnter:i,onMouseOut:u,className:Aa([GA,`${GA}-${s}`]),cx:KZ(t,n,e),cy:YZ(r,n,e),r:n,stroke:"transparent",fill:"transparent"}),JZ=()=>!0;var $d=e=>{const t=({id:r,className:n,type:a,data:i,onClick:u,onEdgeDoubleClick:s,selected:h,animated:p,label:g,labelStyle:v,labelShowBg:x,labelBgStyle:S,labelBgPadding:P,labelBgBorderRadius:N,style:M,source:I,target:A,sourceX:D,sourceY:j,targetX:V,targetY:U,sourcePosition:$,targetPosition:W,elementsSelectable:X,hidden:J,sourceHandleId:Z,targetHandleId:K,onContextMenu:Y,onMouseEnter:G,onMouseMove:oe,onMouseLeave:ie,reconnectRadius:ce,onReconnect:fe,onReconnectStart:de,onReconnectEnd:be,markerEnd:ge,markerStart:xe,rfId:Le,ariaLabel:Oe,isFocusable:Fe,isReconnectable:et,pathOptions:nt,interactionWidth:mt,disableKeyboardA11y:it})=>{const ze=se.useRef(null),[He,We]=se.useState(!1),[ot,xt]=se.useState(!1),Tt=na(),$e=se.useMemo(()=>`url('#${I2(xe,Le)}')`,[xe,Le]),Xe=se.useMemo(()=>`url('#${I2(ge,Le)}')`,[ge,Le]);if(J)return null;const Pe=kt=>{var ut;const{edges:dt,addSelectedEdges:le,unselectNodesAndEdges:Be,multiSelectionActive:qe}=Tt.getState(),st=dt.find(vt=>vt.id===r);st&&(X&&(Tt.setState({nodesSelectionActive:!1}),st.selected&&qe?(Be({nodes:[],edges:[st]}),(ut=ze.current)==null||ut.blur()):le([r])),u&&u(kt,st))},Ye=yp(r,Tt.getState,s),at=yp(r,Tt.getState,Y),bt=yp(r,Tt.getState,G),Et=yp(r,Tt.getState,oe),Vt=yp(r,Tt.getState,ie),Bt=(kt,dt)=>{if(kt.button!==0)return;const{edges:le,isValidConnection:Be}=Tt.getState(),qe=dt?A:I,st=(dt?K:Z)||null,ut=dt?"target":"source",vt=Be||JZ,gt=dt,Ut=le.find(we=>we.id===r);xt(!0),de==null||de(kt,Ut,ut);const Ot=we=>{xt(!1),be==null||be(we,Ut,ut)};GL({event:kt,handleId:st,nodeId:qe,onConnect:we=>fe==null?void 0:fe(Ut,we),isTarget:gt,getState:Tt.getState,setState:Tt.setState,isValidConnection:vt,edgeUpdaterType:ut,onReconnectEnd:Ot})},Mt=kt=>Bt(kt,!0),cr=kt=>Bt(kt,!1),ar=()=>We(!0),ft=()=>We(!1),fr=!X&&!u,Xt=kt=>{var dt;if(!it&&DL.includes(kt.key)&&X){const{unselectNodesAndEdges:le,addSelectedEdges:Be,edges:qe}=Tt.getState();kt.key==="Escape"?((dt=ze.current)==null||dt.blur(),le({edges:[qe.find(ut=>ut.id===r)]})):Be([r])}};return Ke.createElement("g",{className:Aa(["react-flow__edge",`react-flow__edge-${a}`,n,{selected:h,animated:p,inactive:fr,updating:He}]),onClick:Pe,onDoubleClick:Ye,onContextMenu:at,onMouseEnter:bt,onMouseMove:Et,onMouseLeave:Vt,onKeyDown:Fe?Xt:void 0,tabIndex:Fe?0:void 0,role:Fe?"button":"img","data-testid":`rf__edge-${r}`,"aria-label":Oe===null?void 0:Oe||`Edge from ${I} to ${A}`,"aria-describedby":Fe?`${tB}-${Le}`:void 0,ref:ze},!ot&&Ke.createElement(e,{id:r,source:I,target:A,selected:h,animated:p,label:g,labelStyle:v,labelShowBg:x,labelBgStyle:S,labelBgPadding:P,labelBgBorderRadius:N,data:i,style:M,sourceX:D,sourceY:j,targetX:V,targetY:U,sourcePosition:$,targetPosition:W,sourceHandleId:Z,targetHandleId:K,markerStart:$e,markerEnd:Xe,pathOptions:nt,interactionWidth:mt}),et&&Ke.createElement(Ke.Fragment,null,(et==="source"||et===!0)&&Ke.createElement(WA,{position:$,centerX:D,centerY:j,radius:ce,onMouseDown:Mt,onMouseEnter:ar,onMouseOut:ft,type:"source"}),(et==="target"||et===!0)&&Ke.createElement(WA,{position:W,centerX:V,centerY:U,radius:ce,onMouseDown:cr,onMouseEnter:ar,onMouseOut:ft,type:"target"})))};return t.displayName="EdgeWrapper",se.memo(t)};function QZ(e){const t={default:$d(e.default||b0),straight:$d(e.bezier||wE),step:$d(e.step||_E),smoothstep:$d(e.step||hx),simplebezier:$d(e.simplebezier||bE)},r={},n=Object.keys(e).filter(a=>!["default","bezier"].includes(a)).reduce((a,i)=>(a[i]=$d(e[i]||b0),a),r);return{...t,...n}}function ZA(e,t,r=null){const n=((r==null?void 0:r.x)||0)+t.x,a=((r==null?void 0:r.y)||0)+t.y,i=(r==null?void 0:r.width)||t.width,u=(r==null?void 0:r.height)||t.height;switch(e){case hr.Top:return{x:n+i/2,y:a};case hr.Right:return{x:n+i,y:a+u/2};case hr.Bottom:return{x:n+i/2,y:a+u};case hr.Left:return{x:n,y:a+u/2}}}function XA(e,t){return e?e.length===1||!t?e[0]:t&&e.find(r=>r.id===t)||null:null}const eX=(e,t,r,n,a,i)=>{const u=ZA(r,e,t),s=ZA(i,n,a);return{sourceX:u.x,sourceY:u.y,targetX:s.x,targetY:s.y}};function tX({sourcePos:e,targetPos:t,sourceWidth:r,sourceHeight:n,targetWidth:a,targetHeight:i,width:u,height:s,transform:h}){const p={x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x+r,t.x+a),y2:Math.max(e.y+n,t.y+i)};p.x===p.x2&&(p.x2+=1),p.y===p.y2&&(p.y2+=1);const g=Im({x:(0-h[0])/h[2],y:(0-h[1])/h[2],width:u/h[2],height:s/h[2]}),v=Math.max(0,Math.min(g.x2,p.x2)-Math.max(g.x,p.x)),x=Math.max(0,Math.min(g.y2,p.y2)-Math.max(g.y,p.y));return Math.ceil(v*x)>0}function KA(e){var n,a,i,u,s;const t=((n=e==null?void 0:e[Rn])==null?void 0:n.handleBounds)||null,r=t&&(e==null?void 0:e.width)&&(e==null?void 0:e.height)&&typeof((a=e==null?void 0:e.positionAbsolute)==null?void 0:a.x)<"u"&&typeof((i=e==null?void 0:e.positionAbsolute)==null?void 0:i.y)<"u";return[{x:((u=e==null?void 0:e.positionAbsolute)==null?void 0:u.x)||0,y:((s=e==null?void 0:e.positionAbsolute)==null?void 0:s.y)||0,width:(e==null?void 0:e.width)||0,height:(e==null?void 0:e.height)||0},t,!!r]}const rX=[{level:0,isMaxLevel:!0,edges:[]}];function nX(e,t,r=!1){let n=-1;const a=e.reduce((u,s)=>{var g,v;const h=cs(s.zIndex);let p=h?s.zIndex:0;if(r){const x=t.get(s.target),S=t.get(s.source),P=s.selected||(x==null?void 0:x.selected)||(S==null?void 0:S.selected),N=Math.max(((g=S==null?void 0:S[Rn])==null?void 0:g.z)||0,((v=x==null?void 0:x[Rn])==null?void 0:v.z)||0,1e3);p=(h?s.zIndex:0)+(P?N:0)}return u[p]?u[p].push(s):u[p]=[s],n=p>n?p:n,u},{}),i=Object.entries(a).map(([u,s])=>{const h=+u;return{edges:s,level:h,isMaxLevel:h===n}});return i.length===0?rX:i}function aX(e,t,r){const n=mn(se.useCallback(a=>e?a.edges.filter(i=>{const u=t.get(i.source),s=t.get(i.target);return(u==null?void 0:u.width)&&(u==null?void 0:u.height)&&(s==null?void 0:s.width)&&(s==null?void 0:s.height)&&tX({sourcePos:u.positionAbsolute||{x:0,y:0},targetPos:s.positionAbsolute||{x:0,y:0},sourceWidth:u.width,sourceHeight:u.height,targetWidth:s.width,targetHeight:s.height,width:a.width,height:a.height,transform:a.transform})}):a.edges,[e,t]));return nX(n,t,r)}const iX=({color:e="none",strokeWidth:t=1})=>Ke.createElement("polyline",{style:{stroke:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",fill:"none",points:"-5,-4 0,0 -5,4"}),sX=({color:e="none",strokeWidth:t=1})=>Ke.createElement("polyline",{style:{stroke:e,fill:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"}),YA={[x0.Arrow]:iX,[x0.ArrowClosed]:sX};function oX(e){const t=na();return se.useMemo(()=>{var a,i;return Object.prototype.hasOwnProperty.call(YA,e)?YA[e]:((i=(a=t.getState()).onError)==null||i.call(a,"009",Go.error009(e)),null)},[e])}const lX=({id:e,type:t,color:r,width:n=12.5,height:a=12.5,markerUnits:i="strokeWidth",strokeWidth:u,orient:s="auto-start-reverse"})=>{const h=oX(t);return h?Ke.createElement("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${n}`,markerHeight:`${a}`,viewBox:"-10 -10 20 20",markerUnits:i,orient:s,refX:"0",refY:"0"},Ke.createElement(h,{color:r,strokeWidth:u})):null},uX=({defaultColor:e,rfId:t})=>r=>{const n=[];return r.edges.reduce((a,i)=>([i.markerStart,i.markerEnd].forEach(u=>{if(u&&typeof u=="object"){const s=I2(u,t);n.includes(s)||(a.push({id:s,color:u.color||e,...u}),n.push(s))}}),a),[]).sort((a,i)=>a.id.localeCompare(i.id))},pB=({defaultColor:e,rfId:t})=>{const r=mn(se.useCallback(uX({defaultColor:e,rfId:t}),[e,t]),(n,a)=>!(n.length!==a.length||n.some((i,u)=>i.id!==a[u].id)));return Ke.createElement("defs",null,r.map(n=>Ke.createElement(lX,{id:n.id,key:n.id,type:n.type,color:n.color,width:n.width,height:n.height,markerUnits:n.markerUnits,strokeWidth:n.strokeWidth,orient:n.orient})))};pB.displayName="MarkerDefinitions";var cX=se.memo(pB);const dX=e=>({nodesConnectable:e.nodesConnectable,edgesFocusable:e.edgesFocusable,edgesUpdatable:e.edgesUpdatable,elementsSelectable:e.elementsSelectable,width:e.width,height:e.height,connectionMode:e.connectionMode,nodeInternals:e.nodeInternals,onError:e.onError}),mB=({defaultMarkerColor:e,onlyRenderVisibleElements:t,elevateEdgesOnSelect:r,rfId:n,edgeTypes:a,noPanClassName:i,onEdgeContextMenu:u,onEdgeMouseEnter:s,onEdgeMouseMove:h,onEdgeMouseLeave:p,onEdgeClick:g,onEdgeDoubleClick:v,onReconnect:x,onReconnectStart:S,onReconnectEnd:P,reconnectRadius:N,children:M,disableKeyboardA11y:I})=>{const{edgesFocusable:A,edgesUpdatable:D,elementsSelectable:j,width:V,height:U,connectionMode:$,nodeInternals:W,onError:X}=mn(dX,va),J=aX(t,W,r);return V?Ke.createElement(Ke.Fragment,null,J.map(({level:Z,edges:K,isMaxLevel:Y})=>Ke.createElement("svg",{key:Z,style:{zIndex:Z},width:V,height:U,className:"react-flow__edges react-flow__container"},Y&&Ke.createElement(cX,{defaultColor:e,rfId:n}),Ke.createElement("g",null,K.map(G=>{const[oe,ie,ce]=KA(W.get(G.source)),[fe,de,be]=KA(W.get(G.target));if(!ce||!be)return null;let ge=G.type||"default";a[ge]||(X==null||X("011",Go.error011(ge)),ge="default");const xe=a[ge]||a.default,Le=$===Tc.Strict?de.target:(de.target??[]).concat(de.source??[]),Oe=XA(ie.source,G.sourceHandle),Fe=XA(Le,G.targetHandle),et=(Oe==null?void 0:Oe.position)||hr.Bottom,nt=(Fe==null?void 0:Fe.position)||hr.Top,mt=!!(G.focusable||A&&typeof G.focusable>"u"),it=G.reconnectable||G.updatable,ze=typeof x<"u"&&(it||D&&typeof it>"u");if(!Oe||!Fe)return X==null||X("008",Go.error008(Oe,G)),null;const{sourceX:He,sourceY:We,targetX:ot,targetY:xt}=eX(oe,Oe,et,fe,Fe,nt);return Ke.createElement(xe,{key:G.id,id:G.id,className:Aa([G.className,i]),type:ge,data:G.data,selected:!!G.selected,animated:!!G.animated,hidden:!!G.hidden,label:G.label,labelStyle:G.labelStyle,labelShowBg:G.labelShowBg,labelBgStyle:G.labelBgStyle,labelBgPadding:G.labelBgPadding,labelBgBorderRadius:G.labelBgBorderRadius,style:G.style,source:G.source,target:G.target,sourceHandleId:G.sourceHandle,targetHandleId:G.targetHandle,markerEnd:G.markerEnd,markerStart:G.markerStart,sourceX:He,sourceY:We,targetX:ot,targetY:xt,sourcePosition:et,targetPosition:nt,elementsSelectable:j,onContextMenu:u,onMouseEnter:s,onMouseMove:h,onMouseLeave:p,onClick:g,onEdgeDoubleClick:v,onReconnect:x,onReconnectStart:S,onReconnectEnd:P,reconnectRadius:N,rfId:n,ariaLabel:G.ariaLabel,isFocusable:mt,isReconnectable:ze,pathOptions:"pathOptions"in G?G.pathOptions:void 0,interactionWidth:G.interactionWidth,disableKeyboardA11y:I})})))),M):null};mB.displayName="EdgeRenderer";var hX=se.memo(mB);const fX=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function pX({children:e}){const t=mn(fX);return Ke.createElement("div",{className:"react-flow__viewport react-flow__container",style:{transform:t}},e)}function mX(e){const t=kE(),r=se.useRef(!1);se.useEffect(()=>{!r.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),r.current=!0)},[e,t.viewportInitialized])}const gX={[hr.Left]:hr.Right,[hr.Right]:hr.Left,[hr.Top]:hr.Bottom,[hr.Bottom]:hr.Top},gB=({nodeId:e,handleType:t,style:r,type:n=jl.Bezier,CustomComponent:a,connectionStatus:i})=>{var U,$,W;const{fromNode:u,handleId:s,toX:h,toY:p,connectionMode:g}=mn(se.useCallback(X=>({fromNode:X.nodeInternals.get(e),handleId:X.connectionHandleId,toX:(X.connectionPosition.x-X.transform[0])/X.transform[2],toY:(X.connectionPosition.y-X.transform[1])/X.transform[2],connectionMode:X.connectionMode}),[e]),va),v=(U=u==null?void 0:u[Rn])==null?void 0:U.handleBounds;let x=v==null?void 0:v[t];if(g===Tc.Loose&&(x=x||(v==null?void 0:v[t==="source"?"target":"source"])),!u||!x)return null;const S=s?x.find(X=>X.id===s):x[0],P=S?S.x+S.width/2:(u.width??0)/2,N=S?S.y+S.height/2:u.height??0,M=((($=u.positionAbsolute)==null?void 0:$.x)??0)+P,I=(((W=u.positionAbsolute)==null?void 0:W.y)??0)+N,A=S==null?void 0:S.position,D=A?gX[A]:null;if(!A||!D)return null;if(a)return Ke.createElement(a,{connectionLineType:n,connectionLineStyle:r,fromNode:u,fromHandle:S,fromX:M,fromY:I,toX:h,toY:p,fromPosition:A,toPosition:D,connectionStatus:i});let j="";const V={sourceX:M,sourceY:I,sourcePosition:A,targetX:h,targetY:p,targetPosition:D};return n===jl.Bezier?[j]=jL(V):n===jl.Step?[j]=P2({...V,borderRadius:0}):n===jl.SmoothStep?[j]=P2(V):n===jl.SimpleBezier?[j]=BL(V):j=`M${M},${I} ${h},${p}`,Ke.createElement("path",{d:j,fill:"none",className:"react-flow__connection-path",style:r})};gB.displayName="ConnectionLine";const vX=e=>({nodeId:e.connectionNodeId,handleType:e.connectionHandleType,nodesConnectable:e.nodesConnectable,connectionStatus:e.connectionStatus,width:e.width,height:e.height});function yX({containerStyle:e,style:t,type:r,component:n}){const{nodeId:a,handleType:i,nodesConnectable:u,width:s,height:h,connectionStatus:p}=mn(vX,va);return!(a&&i&&s&&u)?null:Ke.createElement("svg",{style:e,width:s,height:h,className:"react-flow__edges react-flow__connectionline react-flow__container"},Ke.createElement("g",{className:Aa(["react-flow__connection",p])},Ke.createElement(gB,{nodeId:a,handleType:i,style:t,type:r,CustomComponent:n,connectionStatus:p})))}function JA(e,t){return se.useRef(null),na(),se.useMemo(()=>t(e),[e])}const vB=({nodeTypes:e,edgeTypes:t,onMove:r,onMoveStart:n,onMoveEnd:a,onInit:i,onNodeClick:u,onEdgeClick:s,onNodeDoubleClick:h,onEdgeDoubleClick:p,onNodeMouseEnter:g,onNodeMouseMove:v,onNodeMouseLeave:x,onNodeContextMenu:S,onSelectionContextMenu:P,onSelectionStart:N,onSelectionEnd:M,connectionLineType:I,connectionLineStyle:A,connectionLineComponent:D,connectionLineContainerStyle:j,selectionKeyCode:V,selectionOnDrag:U,selectionMode:$,multiSelectionKeyCode:W,panActivationKeyCode:X,zoomActivationKeyCode:J,deleteKeyCode:Z,onlyRenderVisibleElements:K,elementsSelectable:Y,selectNodesOnDrag:G,defaultViewport:oe,translateExtent:ie,minZoom:ce,maxZoom:fe,preventScrolling:de,defaultMarkerColor:be,zoomOnScroll:ge,zoomOnPinch:xe,panOnScroll:Le,panOnScrollSpeed:Oe,panOnScrollMode:Fe,zoomOnDoubleClick:et,panOnDrag:nt,onPaneClick:mt,onPaneMouseEnter:it,onPaneMouseMove:ze,onPaneMouseLeave:He,onPaneScroll:We,onPaneContextMenu:ot,onEdgeContextMenu:xt,onEdgeMouseEnter:Tt,onEdgeMouseMove:$e,onEdgeMouseLeave:Xe,onReconnect:Pe,onReconnectStart:Ye,onReconnectEnd:at,reconnectRadius:bt,noDragClassName:Et,noWheelClassName:Vt,noPanClassName:Bt,elevateEdgesOnSelect:Mt,disableKeyboardA11y:cr,nodeOrigin:ar,nodeExtent:ft,rfId:fr})=>{const Xt=JA(e,GZ),kt=JA(t,QZ);return mX(i),Ke.createElement(qZ,{onPaneClick:mt,onPaneMouseEnter:it,onPaneMouseMove:ze,onPaneMouseLeave:He,onPaneContextMenu:ot,onPaneScroll:We,deleteKeyCode:Z,selectionKeyCode:V,selectionOnDrag:U,selectionMode:$,onSelectionStart:N,onSelectionEnd:M,multiSelectionKeyCode:W,panActivationKeyCode:X,zoomActivationKeyCode:J,elementsSelectable:Y,onMove:r,onMoveStart:n,onMoveEnd:a,zoomOnScroll:ge,zoomOnPinch:xe,zoomOnDoubleClick:et,panOnScroll:Le,panOnScrollSpeed:Oe,panOnScrollMode:Fe,panOnDrag:nt,defaultViewport:oe,translateExtent:ie,minZoom:ce,maxZoom:fe,onSelectionContextMenu:P,preventScrolling:de,noDragClassName:Et,noWheelClassName:Vt,noPanClassName:Bt,disableKeyboardA11y:cr},Ke.createElement(pX,null,Ke.createElement(hX,{edgeTypes:kt,onEdgeClick:s,onEdgeDoubleClick:p,onlyRenderVisibleElements:K,onEdgeContextMenu:xt,onEdgeMouseEnter:Tt,onEdgeMouseMove:$e,onEdgeMouseLeave:Xe,onReconnect:Pe,onReconnectStart:Ye,onReconnectEnd:at,reconnectRadius:bt,defaultMarkerColor:be,noPanClassName:Bt,elevateEdgesOnSelect:!!Mt,disableKeyboardA11y:cr,rfId:fr},Ke.createElement(yX,{style:A,type:I,component:D,containerStyle:j})),Ke.createElement("div",{className:"react-flow__edgelabel-renderer"}),Ke.createElement(XZ,{nodeTypes:Xt,onNodeClick:u,onNodeDoubleClick:h,onNodeMouseEnter:g,onNodeMouseMove:v,onNodeMouseLeave:x,onNodeContextMenu:S,selectNodesOnDrag:G,onlyRenderVisibleElements:K,noPanClassName:Bt,noDragClassName:Et,disableKeyboardA11y:cr,nodeOrigin:ar,nodeExtent:ft,rfId:fr})))};vB.displayName="GraphView";var xX=se.memo(vB);const D2=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],Al={rfId:"1",width:0,height:0,transform:[0,0,1],nodeInternals:new Map,edges:[],onNodesChange:null,onEdgesChange:null,hasDefaultNodes:!1,hasDefaultEdges:!1,d3Zoom:null,d3Selection:null,d3ZoomHandler:void 0,minZoom:.5,maxZoom:2,translateExtent:D2,nodeExtent:D2,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionNodeId:null,connectionHandleId:null,connectionHandleType:"source",connectionPosition:{x:0,y:0},connectionStatus:null,connectionMode:Tc.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:[0,0],nodeDragThreshold:0,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesUpdatable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,fitViewOnInit:!1,fitViewOnInitDone:!1,fitViewOnInitOptions:void 0,onSelectionChange:[],multiSelectionActive:!1,connectionStartHandle:null,connectionEndHandle:null,connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,connectionRadius:20,onError:ZW,isValidConnection:void 0},bX=()=>u7((e,t)=>({...Al,setNodes:r=>{const{nodeInternals:n,nodeOrigin:a,elevateNodesOnSelect:i}=t();e({nodeInternals:Hw(r,n,a,i)})},getNodes:()=>Array.from(t().nodeInternals.values()),setEdges:r=>{const{defaultEdgeOptions:n={}}=t();e({edges:r.map(a=>({...n,...a}))})},setDefaultNodesAndEdges:(r,n)=>{const a=typeof r<"u",i=typeof n<"u",u=a?Hw(r,new Map,t().nodeOrigin,t().elevateNodesOnSelect):new Map;e({nodeInternals:u,edges:i?n:[],hasDefaultNodes:a,hasDefaultEdges:i})},updateNodeDimensions:r=>{const{onNodesChange:n,nodeInternals:a,fitViewOnInit:i,fitViewOnInitDone:u,fitViewOnInitOptions:s,domNode:h,nodeOrigin:p}=t(),g=h==null?void 0:h.querySelector(".react-flow__viewport");if(!g)return;const v=window.getComputedStyle(g),{m22:x}=new window.DOMMatrixReadOnly(v.transform),S=r.reduce((N,M)=>{const I=a.get(M.id);if(I!=null&&I.hidden)a.set(I.id,{...I,[Rn]:{...I[Rn],handleBounds:void 0}});else if(I){const A=yE(M.nodeElement);!!(A.width&&A.height&&(I.width!==A.width||I.height!==A.height||M.forceUpdate))&&(a.set(I.id,{...I,[Rn]:{...I[Rn],handleBounds:{source:HA(".source",M.nodeElement,x,p),target:HA(".target",M.nodeElement,x,p)}},...A}),N.push({id:I.id,type:"dimensions",dimensions:A}))}return N},[]);nB(a,p);const P=u||i&&!u&&aB(t,{initial:!0,...s});e({nodeInternals:new Map(a),fitViewOnInitDone:P}),(S==null?void 0:S.length)>0&&(n==null||n(S))},updateNodePositions:(r,n=!0,a=!1)=>{const{triggerNodeChanges:i}=t(),u=r.map(s=>{const h={id:s.id,type:"position",dragging:a};return n&&(h.positionAbsolute=s.positionAbsolute,h.position=s.position),h});i(u)},triggerNodeChanges:r=>{const{onNodesChange:n,nodeInternals:a,hasDefaultNodes:i,nodeOrigin:u,getNodes:s,elevateNodesOnSelect:h}=t();if(r!=null&&r.length){if(i){const p=sB(r,s()),g=Hw(p,a,u,h);e({nodeInternals:g})}n==null||n(r)}},addSelectedNodes:r=>{const{multiSelectionActive:n,edges:a,getNodes:i}=t();let u,s=null;n?u=r.map(h=>Rl(h,!0)):(u=ih(i(),r),s=ih(a,[])),Hv({changedNodes:u,changedEdges:s,get:t,set:e})},addSelectedEdges:r=>{const{multiSelectionActive:n,edges:a,getNodes:i}=t();let u,s=null;n?u=r.map(h=>Rl(h,!0)):(u=ih(a,r),s=ih(i(),[])),Hv({changedNodes:s,changedEdges:u,get:t,set:e})},unselectNodesAndEdges:({nodes:r,edges:n}={})=>{const{edges:a,getNodes:i}=t(),u=r||i(),s=n||a,h=u.map(g=>(g.selected=!1,Rl(g.id,!1))),p=s.map(g=>Rl(g.id,!1));Hv({changedNodes:h,changedEdges:p,get:t,set:e})},setMinZoom:r=>{const{d3Zoom:n,maxZoom:a}=t();n==null||n.scaleExtent([r,a]),e({minZoom:r})},setMaxZoom:r=>{const{d3Zoom:n,minZoom:a}=t();n==null||n.scaleExtent([a,r]),e({maxZoom:r})},setTranslateExtent:r=>{var n;(n=t().d3Zoom)==null||n.translateExtent(r),e({translateExtent:r})},resetSelectedElements:()=>{const{edges:r,getNodes:n}=t(),i=n().filter(s=>s.selected).map(s=>Rl(s.id,!1)),u=r.filter(s=>s.selected).map(s=>Rl(s.id,!1));Hv({changedNodes:i,changedEdges:u,get:t,set:e})},setNodeExtent:r=>{const{nodeInternals:n}=t();n.forEach(a=>{a.positionAbsolute=xE(a.position,r)}),e({nodeExtent:r,nodeInternals:new Map(n)})},panBy:r=>{const{transform:n,width:a,height:i,d3Zoom:u,d3Selection:s,translateExtent:h}=t();if(!u||!s||!r.x&&!r.y)return!1;const p=jo.translate(n[0]+r.x,n[1]+r.y).scale(n[2]),g=[[0,0],[a,i]],v=u==null?void 0:u.constrain()(p,g,h);return u.transform(s,v),n[0]!==v.x||n[1]!==v.y||n[2]!==v.k},cancelConnection:()=>e({connectionNodeId:Al.connectionNodeId,connectionHandleId:Al.connectionHandleId,connectionHandleType:Al.connectionHandleType,connectionStatus:Al.connectionStatus,connectionStartHandle:Al.connectionStartHandle,connectionEndHandle:Al.connectionEndHandle}),reset:()=>e({...Al})}),Object.is),yB=({children:e})=>{const t=se.useRef(null);return t.current||(t.current=bX()),Ke.createElement($W,{value:t.current},e)};yB.displayName="ReactFlowProvider";const xB=({children:e})=>se.useContext(dx)?Ke.createElement(Ke.Fragment,null,e):Ke.createElement(yB,null,e);xB.displayName="ReactFlowWrapper";const _X={input:KL,default:N2,output:JL,group:CE},wX={default:b0,straight:wE,step:_E,smoothstep:hx,simplebezier:bE},SX=[0,0],EX=[15,15],CX={x:0,y:0,zoom:1},kX={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0},bB=se.forwardRef(({nodes:e,edges:t,defaultNodes:r,defaultEdges:n,className:a,nodeTypes:i=_X,edgeTypes:u=wX,onNodeClick:s,onEdgeClick:h,onInit:p,onMove:g,onMoveStart:v,onMoveEnd:x,onConnect:S,onConnectStart:P,onConnectEnd:N,onClickConnectStart:M,onClickConnectEnd:I,onNodeMouseEnter:A,onNodeMouseMove:D,onNodeMouseLeave:j,onNodeContextMenu:V,onNodeDoubleClick:U,onNodeDragStart:$,onNodeDrag:W,onNodeDragStop:X,onNodesDelete:J,onEdgesDelete:Z,onSelectionChange:K,onSelectionDragStart:Y,onSelectionDrag:G,onSelectionDragStop:oe,onSelectionContextMenu:ie,onSelectionStart:ce,onSelectionEnd:fe,connectionMode:de=Tc.Strict,connectionLineType:be=jl.Bezier,connectionLineStyle:ge,connectionLineComponent:xe,connectionLineContainerStyle:Le,deleteKeyCode:Oe="Backspace",selectionKeyCode:Fe="Shift",selectionOnDrag:et=!1,selectionMode:nt=Am.Full,panActivationKeyCode:mt="Space",multiSelectionKeyCode:it=y0()?"Meta":"Control",zoomActivationKeyCode:ze=y0()?"Meta":"Control",snapToGrid:He=!1,snapGrid:We=EX,onlyRenderVisibleElements:ot=!1,selectNodesOnDrag:xt=!0,nodesDraggable:Tt,nodesConnectable:$e,nodesFocusable:Xe,nodeOrigin:Pe=SX,edgesFocusable:Ye,edgesUpdatable:at,elementsSelectable:bt,defaultViewport:Et=CX,minZoom:Vt=.5,maxZoom:Bt=2,translateExtent:Mt=D2,preventScrolling:cr=!0,nodeExtent:ar,defaultMarkerColor:ft="#b1b1b7",zoomOnScroll:fr=!0,zoomOnPinch:Xt=!0,panOnScroll:kt=!1,panOnScrollSpeed:dt=.5,panOnScrollMode:le=uc.Free,zoomOnDoubleClick:Be=!0,panOnDrag:qe=!0,onPaneClick:st,onPaneMouseEnter:ut,onPaneMouseMove:vt,onPaneMouseLeave:gt,onPaneScroll:Ut,onPaneContextMenu:Ot,children:Kt,onEdgeContextMenu:we,onEdgeDoubleClick:ne,onEdgeMouseEnter:re,onEdgeMouseMove:pe,onEdgeMouseLeave:_e,onEdgeUpdate:Ne,onEdgeUpdateStart:De,onEdgeUpdateEnd:Ue,onReconnect:Te,onReconnectStart:rt,onReconnectEnd:ht,reconnectRadius:Qe=10,edgeUpdaterRadius:wt=10,onNodesChange:At,onEdgesChange:Ft,noDragClassName:yr="nodrag",noWheelClassName:ir="nowheel",noPanClassName:_r="nopan",fitView:pr=!1,fitViewOptions:Tr,connectOnClick:wr=!0,attributionPosition:sr,proOptions:kr,defaultEdgeOptions:Er,elevateNodesOnSelect:cn=!0,elevateEdgesOnSelect:gn=!1,disableKeyboardA11y:wn=!1,autoPanOnConnect:oi=!0,autoPanOnNodeDrag:Mr=!0,connectionRadius:Gi=20,isValidConnection:Wi,onError:lt,style:or,id:Fr,nodeDragThreshold:Gr,...vn},Zn)=>{const Fn=Fr||"1";return Ke.createElement("div",{...vn,style:{...or,...kX},ref:Zn,className:Aa(["react-flow",a]),"data-testid":"rf__wrapper",id:Fr},Ke.createElement(xB,null,Ke.createElement(xX,{onInit:p,onMove:g,onMoveStart:v,onMoveEnd:x,onNodeClick:s,onEdgeClick:h,onNodeMouseEnter:A,onNodeMouseMove:D,onNodeMouseLeave:j,onNodeContextMenu:V,onNodeDoubleClick:U,nodeTypes:i,edgeTypes:u,connectionLineType:be,connectionLineStyle:ge,connectionLineComponent:xe,connectionLineContainerStyle:Le,selectionKeyCode:Fe,selectionOnDrag:et,selectionMode:nt,deleteKeyCode:Oe,multiSelectionKeyCode:it,panActivationKeyCode:mt,zoomActivationKeyCode:ze,onlyRenderVisibleElements:ot,selectNodesOnDrag:xt,defaultViewport:Et,translateExtent:Mt,minZoom:Vt,maxZoom:Bt,preventScrolling:cr,zoomOnScroll:fr,zoomOnPinch:Xt,zoomOnDoubleClick:Be,panOnScroll:kt,panOnScrollSpeed:dt,panOnScrollMode:le,panOnDrag:qe,onPaneClick:st,onPaneMouseEnter:ut,onPaneMouseMove:vt,onPaneMouseLeave:gt,onPaneScroll:Ut,onPaneContextMenu:Ot,onSelectionContextMenu:ie,onSelectionStart:ce,onSelectionEnd:fe,onEdgeContextMenu:we,onEdgeDoubleClick:ne,onEdgeMouseEnter:re,onEdgeMouseMove:pe,onEdgeMouseLeave:_e,onReconnect:Te??Ne,onReconnectStart:rt??De,onReconnectEnd:ht??Ue,reconnectRadius:Qe??wt,defaultMarkerColor:ft,noDragClassName:yr,noWheelClassName:ir,noPanClassName:_r,elevateEdgesOnSelect:gn,rfId:Fn,disableKeyboardA11y:wn,nodeOrigin:Pe,nodeExtent:ar}),Ke.createElement(gZ,{nodes:e,edges:t,defaultNodes:r,defaultEdges:n,onConnect:S,onConnectStart:P,onConnectEnd:N,onClickConnectStart:M,onClickConnectEnd:I,nodesDraggable:Tt,nodesConnectable:$e,nodesFocusable:Xe,edgesFocusable:Ye,edgesUpdatable:at,elementsSelectable:bt,elevateNodesOnSelect:cn,minZoom:Vt,maxZoom:Bt,nodeExtent:ar,onNodesChange:At,onEdgesChange:Ft,snapToGrid:He,snapGrid:We,connectionMode:de,translateExtent:Mt,connectOnClick:wr,defaultEdgeOptions:Er,fitView:pr,fitViewOptions:Tr,onNodesDelete:J,onEdgesDelete:Z,onNodeDragStart:$,onNodeDrag:W,onNodeDragStop:X,onSelectionDrag:G,onSelectionDragStart:Y,onSelectionDragStop:oe,noPanClassName:_r,nodeOrigin:Pe,rfId:Fn,autoPanOnConnect:oi,autoPanOnNodeDrag:Mr,onError:lt,connectionRadius:Gi,isValidConnection:Wi,nodeDragThreshold:Gr}),Ke.createElement(pZ,{onSelectionChange:K}),Kt,Ke.createElement(UW,{proOptions:kr,position:sr}),Ke.createElement(_Z,{rfId:Fn,disableKeyboardA11y:wn})))});bB.displayName="ReactFlow";function _B(e){return t=>{const[r,n]=se.useState(t),a=se.useCallback(i=>n(u=>e(i,u)),[]);return[r,n,a]}}const TX=_B(sB),PX=_B(RZ),wB=({id:e,x:t,y:r,width:n,height:a,style:i,color:u,strokeColor:s,strokeWidth:h,className:p,borderRadius:g,shapeRendering:v,onClick:x,selected:S})=>{const{background:P,backgroundColor:N}=i||{},M=u||P||N;return Ke.createElement("rect",{className:Aa(["react-flow__minimap-node",{selected:S},p]),x:t,y:r,rx:g,ry:g,width:n,height:a,fill:M,stroke:s,strokeWidth:h,shapeRendering:v,onClick:x?I=>x(I,e):void 0})};wB.displayName="MiniMapNode";var IX=se.memo(wB);const AX=e=>e.nodeOrigin,NX=e=>e.getNodes().filter(t=>!t.hidden&&t.width&&t.height),Xw=e=>e instanceof Function?e:()=>e;function MX({nodeStrokeColor:e="transparent",nodeColor:t="#e2e2e2",nodeClassName:r="",nodeBorderRadius:n=5,nodeStrokeWidth:a=2,nodeComponent:i=IX,onClick:u}){const s=mn(NX,va),h=mn(AX),p=Xw(t),g=Xw(e),v=Xw(r),x=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return Ke.createElement(Ke.Fragment,null,s.map(S=>{const{x:P,y:N}=pc(S,h).positionAbsolute;return Ke.createElement(i,{key:S.id,x:P,y:N,width:S.width,height:S.height,style:S.style,selected:S.selected,className:v(S),color:p(S),borderRadius:n,strokeColor:g(S),strokeWidth:a,shapeRendering:x,onClick:u,id:S.id})}))}var DX=se.memo(MX);const zX=200,RX=150,LX=e=>{const t=e.getNodes(),r={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:r,boundingRect:t.length>0?GW(fx(t,e.nodeOrigin),r):r,rfId:e.rfId}},BX="react-flow__minimap-desc";function SB({style:e,className:t,nodeStrokeColor:r="transparent",nodeColor:n="#e2e2e2",nodeClassName:a="",nodeBorderRadius:i=5,nodeStrokeWidth:u=2,nodeComponent:s,maskColor:h="rgb(240, 240, 240, 0.6)",maskStrokeColor:p="none",maskStrokeWidth:g=1,position:v="bottom-right",onClick:x,onNodeClick:S,pannable:P=!1,zoomable:N=!1,ariaLabel:M="React Flow mini map",inversePan:I=!1,zoomStep:A=10,offsetScale:D=5}){const j=na(),V=se.useRef(null),{boundingRect:U,viewBB:$,rfId:W}=mn(LX,va),X=(e==null?void 0:e.width)??zX,J=(e==null?void 0:e.height)??RX,Z=U.width/X,K=U.height/J,Y=Math.max(Z,K),G=Y*X,oe=Y*J,ie=D*Y,ce=U.x-(G-U.width)/2-ie,fe=U.y-(oe-U.height)/2-ie,de=G+ie*2,be=oe+ie*2,ge=`${BX}-${W}`,xe=se.useRef(0);xe.current=Y,se.useEffect(()=>{if(V.current){const Fe=ss(V.current),et=it=>{const{transform:ze,d3Selection:He,d3Zoom:We}=j.getState();if(it.sourceEvent.type!=="wheel"||!He||!We)return;const ot=-it.sourceEvent.deltaY*(it.sourceEvent.deltaMode===1?.05:it.sourceEvent.deltaMode?1:.002)*A,xt=ze[2]*Math.pow(2,ot);We.scaleTo(He,xt)},nt=it=>{const{transform:ze,d3Selection:He,d3Zoom:We,translateExtent:ot,width:xt,height:Tt}=j.getState();if(it.sourceEvent.type!=="mousemove"||!He||!We)return;const $e=xe.current*Math.max(1,ze[2])*(I?-1:1),Xe={x:ze[0]-it.sourceEvent.movementX*$e,y:ze[1]-it.sourceEvent.movementY*$e},Pe=[[0,0],[xt,Tt]],Ye=jo.translate(Xe.x,Xe.y).scale(ze[2]),at=We.constrain()(Ye,Pe,ot);We.transform(He,at)},mt=TL().on("zoom",P?nt:null).on("zoom.wheel",N?et:null);return Fe.call(mt),()=>{Fe.on("zoom",null)}}},[P,N,I,A]);const Le=x?Fe=>{const et=Ts(Fe);x(Fe,{x:et[0],y:et[1]})}:void 0,Oe=S?(Fe,et)=>{const nt=j.getState().nodeInternals.get(et);S(Fe,nt)}:void 0;return Ke.createElement(vE,{position:v,style:e,className:Aa(["react-flow__minimap",t]),"data-testid":"rf__minimap"},Ke.createElement("svg",{width:X,height:J,viewBox:`${ce} ${fe} ${de} ${be}`,role:"img","aria-labelledby":ge,ref:V,onClick:Le},M&&Ke.createElement("title",{id:ge},M),Ke.createElement(DX,{onClick:Oe,nodeColor:n,nodeStrokeColor:r,nodeBorderRadius:i,nodeClassName:a,nodeStrokeWidth:u,nodeComponent:s}),Ke.createElement("path",{className:"react-flow__minimap-mask",d:`M${ce-ie},${fe-ie}h${de+ie*2}v${be+ie*2}h${-de-ie*2}z
        M${$.x},${$.y}h${$.width}v${$.height}h${-$.width}z`,fill:h,fillRule:"evenodd",stroke:p,strokeWidth:g,pointerEvents:"none"})))}SB.displayName="MiniMap";var jX=se.memo(SB);function OX(){return Ke.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},Ke.createElement("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"}))}function FX(){return Ke.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},Ke.createElement("path",{d:"M0 0h32v4.2H0z"}))}function $X(){return Ke.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},Ke.createElement("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"}))}function VX(){return Ke.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},Ke.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"}))}function UX(){return Ke.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},Ke.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"}))}const Ap=({children:e,className:t,...r})=>Ke.createElement("button",{type:"button",className:Aa(["react-flow__controls-button",t]),...r},e);Ap.displayName="ControlButton";const qX=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom}),EB=({style:e,showZoom:t=!0,showFitView:r=!0,showInteractive:n=!0,fitViewOptions:a,onZoomIn:i,onZoomOut:u,onFitView:s,onInteractiveChange:h,className:p,children:g,position:v="bottom-left"})=>{const x=na(),[S,P]=se.useState(!1),{isInteractive:N,minZoomReached:M,maxZoomReached:I}=mn(qX,va),{zoomIn:A,zoomOut:D,fitView:j}=kE();if(se.useEffect(()=>{P(!0)},[]),!S)return null;const V=()=>{A(),i==null||i()},U=()=>{D(),u==null||u()},$=()=>{j(a),s==null||s()},W=()=>{x.setState({nodesDraggable:!N,nodesConnectable:!N,elementsSelectable:!N}),h==null||h(!N)};return Ke.createElement(vE,{className:Aa(["react-flow__controls",p]),position:v,style:e,"data-testid":"rf__controls"},t&&Ke.createElement(Ke.Fragment,null,Ke.createElement(Ap,{onClick:V,className:"react-flow__controls-zoomin",title:"zoom in","aria-label":"zoom in",disabled:I},Ke.createElement(OX,null)),Ke.createElement(Ap,{onClick:U,className:"react-flow__controls-zoomout",title:"zoom out","aria-label":"zoom out",disabled:M},Ke.createElement(FX,null))),r&&Ke.createElement(Ap,{className:"react-flow__controls-fitview",onClick:$,title:"fit view","aria-label":"fit view"},Ke.createElement($X,null)),n&&Ke.createElement(Ap,{className:"react-flow__controls-interactive",onClick:W,title:"toggle interactivity","aria-label":"toggle interactivity"},N?Ke.createElement(UX,null):Ke.createElement(VX,null)),g)};EB.displayName="Controls";var HX=se.memo(EB),Rs;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(Rs||(Rs={}));function GX({color:e,dimensions:t,lineWidth:r}){return Ke.createElement("path",{stroke:e,strokeWidth:r,d:`M${t[0]/2} 0 V${t[1]} M0 ${t[1]/2} H${t[0]}`})}function WX({color:e,radius:t}){return Ke.createElement("circle",{cx:t,cy:t,r:t,fill:e})}const ZX={[Rs.Dots]:"#91919a",[Rs.Lines]:"#eee",[Rs.Cross]:"#e2e2e2"},XX={[Rs.Dots]:1,[Rs.Lines]:1,[Rs.Cross]:6},KX=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function CB({id:e,variant:t=Rs.Dots,gap:r=20,size:n,lineWidth:a=1,offset:i=2,color:u,style:s,className:h}){const p=se.useRef(null),{transform:g,patternId:v}=mn(KX,va),x=u||ZX[t],S=n||XX[t],P=t===Rs.Dots,N=t===Rs.Cross,M=Array.isArray(r)?r:[r,r],I=[M[0]*g[2]||1,M[1]*g[2]||1],A=S*g[2],D=N?[A,A]:I,j=P?[A/i,A/i]:[D[0]/i,D[1]/i];return Ke.createElement("svg",{className:Aa(["react-flow__background",h]),style:{...s,position:"absolute",width:"100%",height:"100%",top:0,left:0},ref:p,"data-testid":"rf__background"},Ke.createElement("pattern",{id:v+e,x:g[0]%I[0],y:g[1]%I[1],width:I[0],height:I[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${j[0]},-${j[1]})`},P?Ke.createElement(WX,{color:x,radius:A/i}):Ke.createElement(GX,{dimensions:D,color:x,lineWidth:a})),Ke.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${v+e})`}))}CB.displayName="Background";var YX=se.memo(CB);const JX={default:({data:e})=>w.jsxs("div",{className:"px-4 py-2 bg-surface border border-white/20 rounded shadow-lg text-white min-w-[120px]",children:[w.jsx(Rh,{type:"target",position:hr.Top,className:"w-3 h-3"}),w.jsx("div",{className:"font-semibold text-sm",children:e.label}),e.type&&w.jsx("div",{className:"text-xs text-white/60 mt-1",children:e.type}),w.jsx(Rh,{type:"source",position:hr.Bottom,className:"w-3 h-3"})]})},QX=({onNodeClick:e})=>{var M;const{current:t,setCurrentJson:r,setSelection:n}=xu(),a=((M=t==null?void 0:t.jsonBody)==null?void 0:M.steps)||[],i=se.useMemo(()=>a.map((I,A)=>({id:I.id,type:"default",position:{x:200+A%3*200,y:100+Math.floor(A/3)*150},data:{label:I.name||I.type,type:I.type}})),[a]),u=se.useMemo(()=>{const I=[];return a.forEach(A=>{A.next&&A.next.forEach(D=>{I.push({id:`${A.id}-${D}`,source:A.id,target:D})})}),I},[a]),[s,h,p]=TX(i),[g,v,x]=PX(u);Ke.useEffect(()=>{h(i),v(u)},[i,u,h,v]);const S=se.useCallback(I=>{!I.source||!I.target||(r(A=>{const D=[...A.steps],j=D.find(V=>V.id===I.source);if(j){const V=j.next||[];V.includes(I.target)||(j.next=[...V,I.target])}return{...A,steps:D}}),v(A=>A.some(j=>j.source===I.source&&j.target===I.target)?A:OL(I,A)))},[r,v]),P=se.useCallback((I,A)=>{n([A.id]),e==null||e(A.id)},[e,n]),N=se.useCallback(I=>{r(A=>{const D=new Set(I.map(V=>V.id)),j=A.steps.filter(V=>!D.has(V.id)).map(V=>{var U;return{...V,next:(U=V.next)==null?void 0:U.filter($=>!D.has($))}});return{...A,steps:j}})},[r]);return w.jsx("div",{className:"w-full h-full",style:{width:"100%",height:"100%",minHeight:"400px"},children:w.jsxs(bB,{nodes:s,edges:g,onNodesChange:p,onEdgesChange:x,onConnect:S,onNodeClick:P,onNodesDelete:N,nodeTypes:JX,fitView:!0,className:"bg-surface",children:[w.jsx(YX,{}),w.jsx(HX,{}),w.jsx(jX,{})]})})},eK=[{type:"geoip",label:"GeoIP",color:"bg-blue-500"},{type:"whois",label:"WHOIS",color:"bg-green-500"},{type:"virustotal",label:"VirusTotal",color:"bg-red-500"},{type:"reverse_geocode",label:"Reverse Geocode",color:"bg-purple-500"},{type:"keyword_match",label:"Keyword Match",color:"bg-yellow-500"},{type:"http_get",label:"HTTP GET",color:"bg-teal-500"},{type:"http_post",label:"HTTP POST",color:"bg-orange-500"},{type:"branch",label:"Branch",color:"bg-pink-500"},{type:"wait",label:"Wait",color:"bg-gray-500"},{type:"output",label:"Output",color:"bg-indigo-500"}],tK=({onAddNode:e})=>w.jsxs("div",{className:"p-4 bg-surface-dark border-r border-white/10",children:[w.jsx("h3",{className:"text-sm font-semibold mb-3 text-white/80",children:"Node Palette"}),w.jsx("div",{className:"space-y-2",children:eK.map(t=>w.jsx("button",{onClick:()=>e(t.type),className:`w-full px-3 py-2 rounded text-sm text-white ${t.color} hover:opacity-80 transition-opacity text-left`,children:t.label},t.type))})]});function QA(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function rK(e){if(Array.isArray(e))return e}function nK(e,t,r){return(t=cK(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function aK(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,i,u,s=[],h=!0,p=!1;try{if(i=(r=r.call(e)).next,t!==0)for(;!(h=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);h=!0);}catch(g){p=!0,a=g}finally{try{if(!h&&r.return!=null&&(u=r.return(),Object(u)!==u))return}finally{if(p)throw a}}return s}}function iK(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function eN(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function tN(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?eN(Object(r),!0).forEach(function(n){nK(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):eN(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function sK(e,t){if(e==null)return{};var r,n,a=oK(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function oK(e,t){if(e==null)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(t.indexOf(n)!==-1)continue;r[n]=e[n]}return r}function lK(e,t){return rK(e)||aK(e,t)||dK(e,t)||iK()}function uK(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function cK(e){var t=uK(e,"string");return typeof t=="symbol"?t:t+""}function dK(e,t){if(e){if(typeof e=="string")return QA(e,t);var r={}.toString.call(e).slice(8,-1);return r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set"?Array.from(e):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?QA(e,t):void 0}}function hK(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function rN(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function nN(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?rN(Object(r),!0).forEach(function(n){hK(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rN(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function fK(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(n){return t.reduceRight(function(a,i){return i(a)},n)}}function Np(e){return function t(){for(var r=this,n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return a.length>=e.length?e.apply(this,a):function(){for(var u=arguments.length,s=new Array(u),h=0;h<u;h++)s[h]=arguments[h];return t.apply(r,[].concat(a,s))}}}function _0(e){return{}.toString.call(e).includes("Object")}function pK(e){return!Object.keys(e).length}function Mm(e){return typeof e=="function"}function mK(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function gK(e,t){return _0(t)||ru("changeType"),Object.keys(t).some(function(r){return!mK(e,r)})&&ru("changeField"),t}function vK(e){Mm(e)||ru("selectorType")}function yK(e){Mm(e)||_0(e)||ru("handlerType"),_0(e)&&Object.values(e).some(function(t){return!Mm(t)})&&ru("handlersType")}function xK(e){e||ru("initialIsRequired"),_0(e)||ru("initialType"),pK(e)&&ru("initialContent")}function bK(e,t){throw new Error(e[t]||e.default)}var _K={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},ru=Np(bK)(_K),Wv={changes:gK,selector:vK,handler:yK,initial:xK};function wK(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Wv.initial(e),Wv.handler(t);var r={current:e},n=Np(CK)(r,t),a=Np(EK)(r),i=Np(Wv.changes)(e),u=Np(SK)(r);function s(){var p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(g){return g};return Wv.selector(p),p(r.current)}function h(p){fK(n,a,i,u)(p)}return[s,h]}function SK(e,t){return Mm(t)?t(e.current):t}function EK(e,t){return e.current=nN(nN({},e.current),t),t}function CK(e,t,r){return Mm(t)?t(e.current):Object.keys(r).forEach(function(n){var a;return(a=t[n])===null||a===void 0?void 0:a.call(t,e.current[n])}),r}var kK={create:wK},TK={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.54.0/min/vs"}};function PK(e){return function t(){for(var r=this,n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return a.length>=e.length?e.apply(this,a):function(){for(var u=arguments.length,s=new Array(u),h=0;h<u;h++)s[h]=arguments[h];return t.apply(r,[].concat(a,s))}}}function IK(e){return{}.toString.call(e).includes("Object")}function AK(e){return e||aN("configIsRequired"),IK(e)||aN("configType"),e.urls?(NK(),{paths:{vs:e.urls.monacoBase}}):e}function NK(){console.warn(kB.deprecation)}function MK(e,t){throw new Error(e[t]||e.default)}var kB={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:`Deprecation warning!
    You are using deprecated way of configuration.

    Instead of using
      monaco.config({ urls: { monacoBase: '...' } })
    use
      monaco.config({ paths: { vs: '...' } })

    For more please check the link https://github.com/suren-atoyan/monaco-loader#config
  `},aN=PK(MK)(kB),DK={config:AK},zK=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return function(a){return r.reduceRight(function(i,u){return u(i)},a)}};function TB(e,t){return Object.keys(t).forEach(function(r){t[r]instanceof Object&&e[r]&&Object.assign(t[r],TB(e[r],t[r]))}),tN(tN({},e),t)}var RK={type:"cancelation",msg:"operation is manually canceled"};function Kw(e){var t=!1,r=new Promise(function(n,a){e.then(function(i){return t?a(RK):n(i)}),e.catch(a)});return r.cancel=function(){return t=!0},r}var LK=["monaco"],BK=kK.create({config:TK,isInitialized:!1,resolve:null,reject:null,monaco:null}),PB=lK(BK,2),tg=PB[0],px=PB[1];function jK(e){var t=DK.config(e),r=t.monaco,n=sK(t,LK);px(function(a){return{config:TB(a.config,n),monaco:r}})}function OK(){var e=tg(function(t){var r=t.monaco,n=t.isInitialized,a=t.resolve;return{monaco:r,isInitialized:n,resolve:a}});if(!e.isInitialized){if(px({isInitialized:!0}),e.monaco)return e.resolve(e.monaco),Kw(Yw);if(window.monaco&&window.monaco.editor)return IB(window.monaco),e.resolve(window.monaco),Kw(Yw);zK(FK,VK)(UK)}return Kw(Yw)}function FK(e){return document.body.appendChild(e)}function $K(e){var t=document.createElement("script");return e&&(t.src=e),t}function VK(e){var t=tg(function(n){var a=n.config,i=n.reject;return{config:a,reject:i}}),r=$K("".concat(t.config.paths.vs,"/loader.js"));return r.onload=function(){return e()},r.onerror=t.reject,r}function UK(){var e=tg(function(r){var n=r.config,a=r.resolve,i=r.reject;return{config:n,resolve:a,reject:i}}),t=window.require;t.config(e.config),t(["vs/editor/editor.main"],function(r){var n=r.m;IB(n),e.resolve(n)},function(r){e.reject(r)})}function IB(e){tg().monaco||px({monaco:e})}function qK(){return tg(function(e){var t=e.monaco;return t})}var Yw=new Promise(function(e,t){return px({resolve:e,reject:t})}),AB={config:jK,init:OK,__getMonacoInstance:qK},HK={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}},Jw=HK,GK={container:{display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"}},WK=GK;function ZK({children:e}){return Ke.createElement("div",{style:WK.container},e)}var XK=ZK,KK=XK;function YK({width:e,height:t,isEditorReady:r,loading:n,_ref:a,className:i,wrapperProps:u}){return Ke.createElement("section",{style:{...Jw.wrapper,width:e,height:t},...u},!r&&Ke.createElement(KK,null,n),Ke.createElement("div",{ref:a,style:{...Jw.fullWidth,...!r&&Jw.hide},className:i}))}var JK=YK,NB=se.memo(JK);function QK(e){se.useEffect(e,[])}var MB=QK;function eY(e,t,r=!0){let n=se.useRef(!0);se.useEffect(n.current||!r?()=>{n.current=!1}:e,t)}var ji=eY;function qp(){}function sh(e,t,r,n){return tY(e,n)||rY(e,t,r,n)}function tY(e,t){return e.editor.getModel(DB(e,t))}function rY(e,t,r,n){return e.editor.createModel(t,r,n?DB(e,n):void 0)}function DB(e,t){return e.Uri.parse(t)}function nY({original:e,modified:t,language:r,originalLanguage:n,modifiedLanguage:a,originalModelPath:i,modifiedModelPath:u,keepCurrentOriginalModel:s=!1,keepCurrentModifiedModel:h=!1,theme:p="light",loading:g="Loading...",options:v={},height:x="100%",width:S="100%",className:P,wrapperProps:N={},beforeMount:M=qp,onMount:I=qp}){let[A,D]=se.useState(!1),[j,V]=se.useState(!0),U=se.useRef(null),$=se.useRef(null),W=se.useRef(null),X=se.useRef(I),J=se.useRef(M),Z=se.useRef(!1);MB(()=>{let oe=AB.init();return oe.then(ie=>($.current=ie)&&V(!1)).catch(ie=>(ie==null?void 0:ie.type)!=="cancelation"&&console.error("Monaco initialization: error:",ie)),()=>U.current?G():oe.cancel()}),ji(()=>{if(U.current&&$.current){let oe=U.current.getOriginalEditor(),ie=sh($.current,e||"",n||r||"text",i||"");ie!==oe.getModel()&&oe.setModel(ie)}},[i],A),ji(()=>{if(U.current&&$.current){let oe=U.current.getModifiedEditor(),ie=sh($.current,t||"",a||r||"text",u||"");ie!==oe.getModel()&&oe.setModel(ie)}},[u],A),ji(()=>{let oe=U.current.getModifiedEditor();oe.getOption($.current.editor.EditorOption.readOnly)?oe.setValue(t||""):t!==oe.getValue()&&(oe.executeEdits("",[{range:oe.getModel().getFullModelRange(),text:t||"",forceMoveMarkers:!0}]),oe.pushUndoStop())},[t],A),ji(()=>{var oe,ie;(ie=(oe=U.current)==null?void 0:oe.getModel())==null||ie.original.setValue(e||"")},[e],A),ji(()=>{let{original:oe,modified:ie}=U.current.getModel();$.current.editor.setModelLanguage(oe,n||r||"text"),$.current.editor.setModelLanguage(ie,a||r||"text")},[r,n,a],A),ji(()=>{var oe;(oe=$.current)==null||oe.editor.setTheme(p)},[p],A),ji(()=>{var oe;(oe=U.current)==null||oe.updateOptions(v)},[v],A);let K=se.useCallback(()=>{var ce;if(!$.current)return;J.current($.current);let oe=sh($.current,e||"",n||r||"text",i||""),ie=sh($.current,t||"",a||r||"text",u||"");(ce=U.current)==null||ce.setModel({original:oe,modified:ie})},[r,t,a,e,n,i,u]),Y=se.useCallback(()=>{var oe;!Z.current&&W.current&&(U.current=$.current.editor.createDiffEditor(W.current,{automaticLayout:!0,...v}),K(),(oe=$.current)==null||oe.editor.setTheme(p),D(!0),Z.current=!0)},[v,p,K]);se.useEffect(()=>{A&&X.current(U.current,$.current)},[A]),se.useEffect(()=>{!j&&!A&&Y()},[j,A,Y]);function G(){var ie,ce,fe,de;let oe=(ie=U.current)==null?void 0:ie.getModel();s||((ce=oe==null?void 0:oe.original)==null||ce.dispose()),h||((fe=oe==null?void 0:oe.modified)==null||fe.dispose()),(de=U.current)==null||de.dispose()}return Ke.createElement(NB,{width:S,height:x,isEditorReady:A,loading:g,_ref:W,className:P,wrapperProps:N})}var aY=nY;se.memo(aY);function iY(e){let t=se.useRef();return se.useEffect(()=>{t.current=e},[e]),t.current}var sY=iY,Zv=new Map;function oY({defaultValue:e,defaultLanguage:t,defaultPath:r,value:n,language:a,path:i,theme:u="light",line:s,loading:h="Loading...",options:p={},overrideServices:g={},saveViewState:v=!0,keepCurrentModel:x=!1,width:S="100%",height:P="100%",className:N,wrapperProps:M={},beforeMount:I=qp,onMount:A=qp,onChange:D,onValidate:j=qp}){let[V,U]=se.useState(!1),[$,W]=se.useState(!0),X=se.useRef(null),J=se.useRef(null),Z=se.useRef(null),K=se.useRef(A),Y=se.useRef(I),G=se.useRef(),oe=se.useRef(n),ie=sY(i),ce=se.useRef(!1),fe=se.useRef(!1);MB(()=>{let ge=AB.init();return ge.then(xe=>(X.current=xe)&&W(!1)).catch(xe=>(xe==null?void 0:xe.type)!=="cancelation"&&console.error("Monaco initialization: error:",xe)),()=>J.current?be():ge.cancel()}),ji(()=>{var xe,Le,Oe,Fe;let ge=sh(X.current,e||n||"",t||a||"",i||r||"");ge!==((xe=J.current)==null?void 0:xe.getModel())&&(v&&Zv.set(ie,(Le=J.current)==null?void 0:Le.saveViewState()),(Oe=J.current)==null||Oe.setModel(ge),v&&((Fe=J.current)==null||Fe.restoreViewState(Zv.get(i))))},[i],V),ji(()=>{var ge;(ge=J.current)==null||ge.updateOptions(p)},[p],V),ji(()=>{!J.current||n===void 0||(J.current.getOption(X.current.editor.EditorOption.readOnly)?J.current.setValue(n):n!==J.current.getValue()&&(fe.current=!0,J.current.executeEdits("",[{range:J.current.getModel().getFullModelRange(),text:n,forceMoveMarkers:!0}]),J.current.pushUndoStop(),fe.current=!1))},[n],V),ji(()=>{var xe,Le;let ge=(xe=J.current)==null?void 0:xe.getModel();ge&&a&&((Le=X.current)==null||Le.editor.setModelLanguage(ge,a))},[a],V),ji(()=>{var ge;s!==void 0&&((ge=J.current)==null||ge.revealLine(s))},[s],V),ji(()=>{var ge;(ge=X.current)==null||ge.editor.setTheme(u)},[u],V);let de=se.useCallback(()=>{var ge;if(!(!Z.current||!X.current)&&!ce.current){Y.current(X.current);let xe=i||r,Le=sh(X.current,n||e||"",t||a||"",xe||"");J.current=(ge=X.current)==null?void 0:ge.editor.create(Z.current,{model:Le,automaticLayout:!0,...p},g),v&&J.current.restoreViewState(Zv.get(xe)),X.current.editor.setTheme(u),s!==void 0&&J.current.revealLine(s),U(!0),ce.current=!0}},[e,t,r,n,a,i,p,g,v,u,s]);se.useEffect(()=>{V&&K.current(J.current,X.current)},[V]),se.useEffect(()=>{!$&&!V&&de()},[$,V,de]),oe.current=n,se.useEffect(()=>{var ge,xe;V&&D&&((ge=G.current)==null||ge.dispose(),G.current=(xe=J.current)==null?void 0:xe.onDidChangeModelContent(Le=>{fe.current||D(J.current.getValue(),Le)}))},[V,D]),se.useEffect(()=>{if(V){let ge=X.current.editor.onDidChangeMarkers(xe=>{var Oe;let Le=(Oe=J.current.getModel())==null?void 0:Oe.uri;if(Le&&xe.find(Fe=>Fe.path===Le.path)){let Fe=X.current.editor.getModelMarkers({resource:Le});j==null||j(Fe)}});return()=>{ge==null||ge.dispose()}}return()=>{}},[V,j]);function be(){var ge,xe;(ge=G.current)==null||ge.dispose(),x?v&&Zv.set(i,J.current.saveViewState()):(xe=J.current.getModel())==null||xe.dispose(),J.current.dispose()}return Ke.createElement(NB,{width:S,height:P,isEditorReady:V,loading:h,_ref:Z,className:N,wrapperProps:M})}var lY=oY,uY=se.memo(lY),cY=uY;const dY=({onPublish:e,onRollback:t})=>{const{current:r,update:n,validate:a,isDirty:i}=xu(),[u,s]=se.useState(null),[h,p]=se.useState(!1),[g,v]=se.useState(!1),[x,S]=se.useState(""),[P,N]=se.useState(null),M=JSON.stringify((r==null?void 0:r.jsonBody)||{},null,2),I=()=>{if(!r)return;const W=j(r.jsonBody);N({hasEntry:!!r.jsonBody.entry&&r.jsonBody.steps.some(X=>X.id===r.jsonBody.entry),hasDanglingEdges:W.errors.some(X=>X.includes("references non-existent step")),hasUnconnectedSteps:W.warnings.some(X=>X.includes("not connected")),hasSteps:r.jsonBody.steps.length>0})};se.useEffect(()=>{I()},[r==null?void 0:r.jsonBody]);const A=async()=>{if(!r)return;const W=await a(r.jsonBody);s(W),I(),W.isValid?St("Playbook is valid"):St("Validation failed - check errors")},D=async()=>{if(r)try{await n(r.id,{jsonBody:r.jsonBody,status:"draft"}),St("Draft saved")}catch(W){St(`Failed to save: ${W.message}`)}},j=W=>{const X=[],J=[];W.entry?W.steps.some(Y=>Y.id===W.entry)||X.push(`Entry step "${W.entry}" not found in steps.`):X.push("No entry step defined. Set an entry point before publishing.");const Z=new Set(W.steps.map(K=>K.id));if(W.steps.forEach((K,Y)=>{K.next&&K.next.length>0&&K.next.forEach(G=>{Z.has(G)||X.push(`Step "${K.name||K.id||`Step ${Y+1}`}" references non-existent step "${G}"`)})}),W.steps.length>1){const K=new Set;W.entry&&K.add(W.entry),W.steps.forEach(Y=>{Y.next&&Y.next.forEach(G=>K.add(G))}),W.steps.forEach(Y=>{!K.has(Y.id)&&Y.id!==W.entry&&J.push(`Step "${Y.name||Y.id}" is not connected to the playbook flow`)})}return W.steps.length===0&&X.push("Playbook must have at least one step"),{canPublish:X.length===0,errors:X,warnings:J}},V=async()=>{if(!r)return;const W=j(r.jsonBody);if(!W.canPublish){s({isValid:!1,errors:W.errors,warnings:W.warnings}),St("Cannot publish - check errors");return}const X=await a(r.jsonBody);if(!X.isValid){s({isValid:!1,errors:[...W.errors,...X.errors||[]],warnings:[...W.warnings,...X.warnings||[]]}),St("Cannot publish - validation failed");return}W.warnings.length>0&&s({isValid:!0,warnings:W.warnings});try{await n(r.id,{jsonBody:r.jsonBody,status:"published",releaseNotes:x.trim()||void 0}),p(!1),S(""),St("Playbook published"),e==null||e()}catch(J){St(`Failed to publish: ${J.message}`)}},U=()=>{if(!r)return;const W={name:r.name,description:r.description,version:r.jsonBody.version||"1.0.0",...r.jsonBody},X=new Blob([JSON.stringify(W,null,2)],{type:"application/json"}),J=URL.createObjectURL(X),Z=document.createElement("a");Z.href=J,Z.download=`${r.name.replace(/[^a-z0-9]/gi,"_").toLowerCase()}.json`,document.body.appendChild(Z),Z.click(),document.body.removeChild(Z),URL.revokeObjectURL(J),St("Playbook exported")},$=()=>{if(!r){St("Please select a playbook first");return}const W=document.createElement("input");W.type="file",W.accept=".json",W.onchange=async X=>{var Z,K;const J=(Z=X.target.files)==null?void 0:Z[0];if(J)try{const Y=await J.text(),G=JSON.parse(Y),ce={steps:(G.steps||[]).map(de=>de.type?de:{id:de.stepId||de.id||`step-${Date.now()}-${Math.random()}`,type:de.actionId||de.kind||de.type,name:de.name||de.stepId,params:de.config||de.params||(de.kind==="attach_note"&&de.text?{text:de.text}:{}),onFail:de.onError==="fail"?"stop":"continue",next:de.next||[]}),version:G.version||"1.0.0",entry:G.entry},fe=await a(ce);if(!fe.isValid){s(fe),St(`Import failed: ${((K=fe.errors)==null?void 0:K.join(", "))||"Invalid playbook format"}`);return}await n(r.id,{name:G.name||r.name,description:G.description||r.description,jsonBody:ce}),St("Playbook imported successfully")}catch(Y){St(`Import failed: ${Y.message}`)}},W.click()};return w.jsxs("div",{className:"flex flex-col h-full",children:[w.jsxs("div",{className:"p-4 border-b border-white/10 flex items-center gap-2 flex-wrap",children:[w.jsx("button",{onClick:A,className:"px-3 py-1.5 bg-teal-600 hover:bg-teal-700 text-white text-sm rounded",children:"Validate"}),w.jsx("button",{onClick:D,disabled:!i,className:"px-3 py-1.5 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white text-sm rounded",children:"Save Draft"}),w.jsx("button",{onClick:()=>p(!0),className:"px-3 py-1.5 bg-green-600 hover:bg-green-700 text-white text-sm rounded",children:"Publish"}),w.jsx("button",{onClick:U,className:"px-3 py-1.5 bg-purple-600 hover:bg-purple-700 text-white text-sm rounded",children:"Export"}),w.jsx("button",{onClick:$,className:"px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 text-white text-sm rounded",children:"Import"}),w.jsx("button",{onClick:()=>v(!0),className:"px-3 py-1.5 bg-gray-600 hover:bg-gray-700 text-white text-sm rounded",children:"Rollback"})]}),P&&w.jsxs("div",{className:"p-3 border-b border-white/10 bg-surface-dark",children:[w.jsx("div",{className:"text-xs font-semibold text-white/80 mb-2",children:"Preflight Checklist"}),w.jsxs("div",{className:"space-y-1 text-xs",children:[w.jsxs("div",{className:`flex items-center ${P.hasSteps?"text-green-400":"text-red-400"}`,children:[P.hasSteps?"":""," At least one step"]}),w.jsxs("div",{className:`flex items-center ${P.hasEntry?"text-green-400":"text-red-400"}`,children:[P.hasEntry?"":""," Entry step defined"]}),w.jsxs("div",{className:`flex items-center ${P.hasDanglingEdges?"text-red-400":"text-green-400"}`,children:[P.hasDanglingEdges?"":""," No dangling edges"]}),w.jsxs("div",{className:`flex items-center ${P.hasUnconnectedSteps?"text-yellow-400":"text-green-400"}`,children:[P.hasUnconnectedSteps?"":""," All steps connected"]})]})]}),u&&w.jsxs("div",{className:`p-3 border-b ${u.isValid?"bg-green-900/20 border-green-500":"bg-red-900/20 border-red-500"}`,children:[w.jsx("div",{className:"text-sm font-semibold mb-1",children:u.isValid?" Valid":" Invalid"}),u.errors&&u.errors.length>0&&w.jsx("div",{className:"text-red-300 text-xs",children:u.errors.map((W,X)=>w.jsx("div",{children:W},X))}),u.warnings&&u.warnings.length>0&&w.jsx("div",{className:"text-yellow-300 text-xs mt-1",children:u.warnings.map((W,X)=>w.jsxs("div",{children:[" ",W]},X))})]}),w.jsx("div",{className:"flex-1 overflow-hidden",children:w.jsx(cY,{height:"100%",defaultLanguage:"json",value:M,theme:"vs-dark",options:{readOnly:!0,minimap:{enabled:!1},fontSize:12}})}),h&&w.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:w.jsxs("div",{className:"bg-panel rounded-xl border border-white/10 p-6 w-full max-w-md",children:[w.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Publish Playbook"}),w.jsx("p",{className:"text-white/80 mb-4",children:"Are you sure you want to publish this playbook? Published playbooks are available to all users."}),w.jsxs("div",{className:"mb-4",children:[w.jsx("label",{className:"block text-xs text-white/80 mb-2",children:"Release Notes (optional)"}),w.jsx("textarea",{value:x,onChange:W=>S(W.target.value),placeholder:"What's new in this version?",className:"w-full h-20 bg-panel border border-white/20 rounded px-3 py-2 text-white placeholder-gray-400 focus:outline-none focus:border-teal-500 text-sm"})]}),w.jsxs("div",{className:"flex justify-end gap-2",children:[w.jsx("button",{onClick:()=>{p(!1),S("")},className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded",children:"Cancel"}),w.jsx("button",{onClick:V,className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded",children:"Publish"})]})]})}),w.jsx(so,{isOpen:g,onClose:()=>v(!1),title:"Rollback Playbook",message:"Select a version to rollback to from the Versions tab.",variant:"info",buttonText:"OK"})]})},hY=JSON.stringify({id:"test-alert-1",message:"Suspicious IP 8.8.8.8 detected",attrs:{ip:"8.8.8.8",domain:"example.com",hash:"abc123def456"}},null,2),fY=()=>{const{current:e,testRun:t}=xu(),[r,n]=se.useState(hY),[a,i]=se.useState([]),[u,s]=se.useState(!1),[h,p]=se.useState(!1),[g,v]=se.useState(""),x=async()=>{if(!e){St("No playbook selected");return}s(!0),i([]);try{let S;try{S=JSON.parse(r)}catch{v("Invalid JSON in mock alert"),p(!0),s(!1);return}const P=await t(e.jsonBody);i(P.logs),P.success?St("Test run completed successfully"):St("Test run completed with errors")}catch(S){v(S.message||"Test run failed"),p(!0)}finally{s(!1)}};return w.jsxs("div",{className:"flex flex-col h-full",children:[w.jsxs("div",{className:"p-4 border-b border-white/10",children:[w.jsx("h3",{className:"text-sm font-semibold mb-2 text-white",children:"Test Run"}),w.jsx("p",{className:"text-xs text-white/60 mb-4",children:"Test this playbook with mock alert data. No external HTTP calls will be made."}),w.jsxs("div",{className:"mb-4",children:[w.jsx("label",{className:"block text-xs text-white/80 mb-2",children:"Mock Alert JSON"}),w.jsx("textarea",{value:r,onChange:S=>n(S.target.value),className:"w-full h-32 bg-panel border border-white/20 rounded p-2 text-white placeholder-gray-400 focus:outline-none focus:border-teal-500 text-xs font-mono",placeholder:"Enter mock alert JSON..."})]}),w.jsx("button",{onClick:x,disabled:u||!e,className:"px-4 py-2 bg-teal-600 hover:bg-teal-700 disabled:opacity-50 disabled:cursor-not-allowed text-white text-sm rounded",children:u?"Running...":"Run Test"})]}),w.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[a.length===0&&!u&&w.jsx("div",{className:"text-white/60 text-sm text-center py-8",children:'Click "Run Test" to execute the playbook'}),u&&w.jsx("div",{className:"text-white/60 text-sm text-center py-8",children:"Running test..."}),a.length>0&&w.jsx("div",{className:"space-y-2",children:a.map((S,P)=>w.jsxs("div",{className:`p-3 rounded border ${S.status==="success"?"bg-green-900/20 border-green-500/50":"bg-red-900/20 border-red-500/50"}`,children:[w.jsxs("div",{className:"flex items-center justify-between mb-1",children:[w.jsx("span",{className:"text-sm font-semibold text-white",children:S.stepId||`Step ${P+1}`}),w.jsx("span",{className:`text-xs px-2 py-1 rounded ${S.status==="success"?"bg-green-600 text-white":"bg-red-600 text-white"}`,children:S.status||"unknown"})]}),S.kind&&w.jsxs("div",{className:"text-xs text-white/60 mb-1",children:["Kind: ",S.kind]}),S.output&&w.jsx("pre",{className:"text-xs text-white/80 mt-2 bg-black/20 p-2 rounded overflow-x-auto",children:JSON.stringify(S.output,null,2)}),S.error&&w.jsx("div",{className:"text-xs text-red-300 mt-2",children:S.error})]},P))})]}),w.jsx(so,{isOpen:h,onClose:()=>p(!1),title:"Test Run Error",message:g,variant:"error",buttonText:"OK"})]})},pY=()=>{const{current:e,aiGenerate:t,setCurrentJson:r,markDirty:n}=xu(),[a,i]=se.useState(""),[u,s]=se.useState(!1),[h,p]=se.useState(!1),[g,v]=se.useState(null),x=async()=>{if(!a.trim()){St("Please enter a prompt");return}s(!0);try{const P=await t(a);v(P),p(!0)}catch(P){St(`AI generation failed: ${P.message}`)}finally{s(!1)}},S=()=>{!e||!g||(r(()=>g),n(!0),p(!1),i(""),v(null),St("Playbook replaced with AI-generated draft"))};return w.jsxs("div",{className:"flex flex-col h-full",children:[w.jsxs("div",{className:"p-4 border-b border-white/10",children:[w.jsx("h3",{className:"text-sm font-semibold mb-2 text-white",children:"AI Assist"}),w.jsx("p",{className:"text-xs text-white/60 mb-4",children:"Generate a playbook from natural language description"}),w.jsx("textarea",{value:a,onChange:P=>i(P.target.value),placeholder:"e.g., Create a playbook that looks up GeoIP, WHOIS, and sends Slack message",className:"w-full h-24 bg-panel border border-white/20 rounded p-2 text-white placeholder-gray-400 focus:outline-none focus:border-teal-500 text-sm"}),w.jsx("button",{onClick:x,disabled:u||!a.trim(),className:"mt-2 px-4 py-2 bg-teal-600 hover:bg-teal-700 disabled:opacity-50 disabled:cursor-not-allowed text-white text-sm rounded",children:u?"Generating...":"Generate Draft"})]}),w.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:w.jsxs("div",{className:"text-white/60 text-sm",children:[w.jsx("p",{className:"mb-2",children:"Examples:"}),w.jsxs("ul",{className:"list-disc list-inside space-y-1 text-xs",children:[w.jsx("li",{children:'"Create a playbook that looks up GeoIP and WHOIS"'}),w.jsx("li",{children:'"Enrich IP addresses with VirusTotal hash check"'}),w.jsx("li",{children:'"Get geolocation and reverse geocode coordinates"'})]})]})}),h&&g&&w.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:w.jsxs("div",{className:"bg-panel rounded-xl border border-white/10 p-6 w-full max-w-md",children:[w.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Replace Current Playbook?"}),w.jsx("p",{className:"text-white/80 mb-4",children:"This will replace your current playbook with the AI-generated version. Continue?"}),w.jsxs("div",{className:"flex justify-end gap-2",children:[w.jsx("button",{onClick:()=>{p(!1),v(null)},className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded",children:"Cancel"}),w.jsx("button",{onClick:S,className:"px-4 py-2 bg-teal-600 hover:bg-teal-700 text-white rounded",children:"Replace"})]})]})})]})},mY=({isOpen:e,onClose:t})=>{var N,M;const{current:r,versions:n,rollback:a}=xu(),{user:i}=Nc(),[u,s]=se.useState(null),[h,p]=se.useState(!1),g=((N=i==null?void 0:i.roles)==null?void 0:N.includes("admin"))||((M=i==null?void 0:i.roles)==null?void 0:M.includes("analyst")),v=async()=>{if(!(!r||!u))try{await a(r.id,u),t()}catch(I){St(`Rollback failed: ${I.message}`)}};if(!e)return null;const x=r!=null&&r.jsonBody?JSON.stringify(r.jsonBody,null,2):"",S=n.find(I=>I.version===u),P=S!=null&&S.jsonBody?JSON.stringify(S.jsonBody,null,2):"";return w.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:t,children:w.jsxs("div",{className:"bg-panel rounded-xl border border-white/10 p-6 w-full max-w-4xl max-h-[90vh] flex flex-col",onClick:I=>I.stopPropagation(),children:[w.jsxs("div",{className:"flex items-center justify-between mb-4",children:[w.jsx("h3",{className:"text-lg font-semibold text-white",children:"Version History"}),w.jsx("button",{onClick:t,className:"text-white/70 hover:text-white text-xl leading-none",children:""})]}),w.jsx("div",{className:"flex-1 overflow-y-auto",children:w.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[w.jsxs("div",{children:[w.jsx("h4",{className:"text-sm font-semibold text-white mb-2",children:"Versions"}),w.jsx("div",{className:"space-y-2",children:n.map(I=>w.jsxs("div",{onClick:()=>{s(I.version),p(!0)},className:`p-3 rounded border cursor-pointer ${u===I.version?"border-teal-500 bg-teal-900/20":"border-white/20 bg-surface-dark hover:bg-surface"}`,children:[w.jsxs("div",{className:"text-sm font-semibold text-white",children:["Version ",I.version]}),w.jsx("div",{className:"text-xs text-white/60 mt-1",children:new Date(I.createdAt).toLocaleString()}),I.createdBy&&w.jsxs("div",{className:"text-xs text-white/60 mt-1",children:["By: ",I.createdBy]}),I.releaseNotes&&w.jsxs("div",{className:"text-xs text-white/80 mt-2 italic border-l-2 border-teal-500 pl-2",children:['"',I.releaseNotes,'"']})]},I.version))})]}),h&&u&&w.jsxs("div",{children:[w.jsxs("h4",{className:"text-sm font-semibold text-white mb-2",children:["Version ",u," vs Current"]}),w.jsxs("div",{className:"grid grid-cols-2 gap-2 h-96",children:[w.jsxs("div",{className:"bg-surface-dark rounded p-2 overflow-auto",children:[w.jsxs("div",{className:"text-xs text-white/60 mb-2",children:["Version ",u]}),w.jsx("pre",{className:"text-xs text-white font-mono whitespace-pre-wrap",children:P})]}),w.jsxs("div",{className:"bg-surface-dark rounded p-2 overflow-auto",children:[w.jsx("div",{className:"text-xs text-white/60 mb-2",children:"Current"}),w.jsx("pre",{className:"text-xs text-white font-mono whitespace-pre-wrap",children:x})]})]})]})]})}),g&&u&&w.jsxs("div",{className:"flex justify-end gap-2 mt-4 pt-4 border-t border-white/10",children:[w.jsx("button",{onClick:t,className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded",children:"Cancel"}),w.jsxs("button",{onClick:v,className:"px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded",children:["Rollback to Version ",u]})]})]})})},gY=({nodeId:e})=>{var h;const{current:t,setCurrentJson:r,selection:n}=xu(),a=t==null?void 0:t.jsonBody.steps.find(p=>p.id===e);if(!a||!n.includes(e))return null;const i=p=>{r(g=>{const v=g.steps.map(x=>x.id===e?{...x,...p}:x);return{...g,steps:v}})},u=()=>{r(p=>({...p,entry:e}))},s=(t==null?void 0:t.jsonBody.entry)===e;return w.jsxs("div",{className:"p-4 bg-surface-dark border border-white/20 rounded",children:[w.jsxs("div",{className:"flex items-center justify-between mb-3",children:[w.jsxs("h4",{className:"text-sm font-semibold text-white",children:["Edit Step: ",a.name||a.type]}),!s&&w.jsx("button",{onClick:u,className:"px-2 py-1 text-xs bg-teal-600 hover:bg-teal-700 text-white rounded",children:"Set as Entry"}),s&&w.jsx("span",{className:"px-2 py-1 text-xs bg-green-600 text-white rounded",children:"Entry Point"})]}),w.jsxs("div",{className:"space-y-2",children:[w.jsxs("div",{children:[w.jsx("label",{className:"block text-xs text-white/80 mb-1",children:"Name"}),w.jsx("input",{type:"text",value:a.name||"",onChange:p=>i({name:p.target.value}),className:"w-full bg-panel border border-white/20 rounded px-2 py-1 text-white placeholder-gray-400 focus:outline-none focus:border-teal-500 text-sm",placeholder:a.type})]}),a.type==="output"&&w.jsxs("div",{children:[w.jsx("label",{className:"block text-xs text-white/80 mb-1",children:"Note Text"}),w.jsx("textarea",{value:((h=a.params)==null?void 0:h.text)||"",onChange:p=>i({params:{...a.params,text:p.target.value}}),className:"w-full bg-panel border border-white/20 rounded px-2 py-1 text-white placeholder-gray-400 focus:outline-none focus:border-teal-500 text-sm",placeholder:"Enter note text to attach...",rows:3})]}),w.jsxs("div",{children:[w.jsx("label",{className:"block text-xs text-white/80 mb-1",children:"On Fail"}),w.jsxs("select",{value:a.onFail||"continue",onChange:p=>i({onFail:p.target.value}),className:"w-full bg-panel border border-white/20 rounded px-2 py-1 text-white focus:outline-none focus:border-teal-500 text-sm",children:[w.jsx("option",{value:"continue",className:"bg-panel text-white",children:"Continue"}),w.jsx("option",{value:"stop",className:"bg-panel text-white",children:"Stop"})]})]})]})]})},iN=[{id:"ip-enrichment",name:"IP Enrichment",description:"Enrich IP addresses with GeoIP and WHOIS lookup",jsonBody:{version:"1.0.0",entry:"geoip-1",steps:[{id:"geoip-1",type:"geoip",name:"GeoIP Lookup",next:["whois-1"]},{id:"whois-1",type:"whois",name:"WHOIS Lookup",next:["output-1"]},{id:"output-1",type:"output",name:"Attach Results",params:{text:"IP enrichment completed: GeoIP and WHOIS data attached"},next:[]}]}},{id:"full-enrichment",name:"Full Enrichment",description:"Comprehensive enrichment: GeoIP, WHOIS, VirusTotal, and Reverse Geocode",jsonBody:{version:"1.0.0",entry:"geoip-1",steps:[{id:"geoip-1",type:"geoip",name:"GeoIP Lookup",next:["whois-1"]},{id:"whois-1",type:"whois",name:"WHOIS Lookup",next:["vt-1"]},{id:"vt-1",type:"virustotal",name:"VirusTotal Check",next:["reverse-geo-1"]},{id:"reverse-geo-1",type:"reverse_geocode",name:"Reverse Geocode",next:["output-1"]},{id:"output-1",type:"output",name:"Attach Results",params:{text:"Full enrichment completed: GeoIP, WHOIS, VirusTotal, and Reverse Geocode data attached"},next:[]}]}},{id:"webhook-notify",name:"Webhook Notify",description:"Enrich IP and send results to webhook",jsonBody:{version:"1.0.0",entry:"geoip-1",steps:[{id:"geoip-1",type:"geoip",name:"GeoIP Lookup",next:["webhook-1"]},{id:"webhook-1",type:"http_post",name:"Send to Webhook",params:{url:"https://webhook.example.com/api/endpoint",headers:{"Content-Type":"application/json"}},next:["output-1"]},{id:"output-1",type:"output",name:"Attach Note",params:{text:"Enrichment completed and webhook notified"},next:[]}]}}],vY=()=>{var J,Z,K;const{items:e,current:t,load:r,open:n,createDraft:a,setCurrentJson:i,setSelection:u,isDirty:s,selection:h}=xu(),{user:p}=Nc(),[g,v]=se.useState("json"),[x,S]=se.useState(!1),[P,N]=se.useState(!1),[M,I]=se.useState(!1),[A,D]=se.useState(""),V=!(((J=p==null?void 0:p.roles)==null?void 0:J.includes("viewer"))&&!((Z=p==null?void 0:p.roles)!=null&&Z.includes("analyst"))&&!((K=p==null?void 0:p.roles)!=null&&K.includes("admin")));se.useEffect(()=>{r()},[r]);const U=async Y=>{if(!A.trim()){St("Please enter a name");return}try{let G;if(Y){const ie=iN.find(ce=>ce.id===Y);ie?G=JSON.parse(JSON.stringify(ie.jsonBody)):G={steps:[],version:"1.0.0"}}else G={steps:[],version:"1.0.0"};const oe=await a({name:A,jsonBody:G});await n(oe.id),N(!1),I(!1),D("")}catch(G){St(`Failed to create draft: ${G.message}`)}},$=Y=>{if(!t||!V)return;const G=`step-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,oe={id:G,type:Y,name:Y,next:[]};Y==="output"&&(oe.params={text:"Enrichment summary attached by playbook"}),i(ie=>{const ce=[...ie.steps,oe],fe=ie.entry||(ce.length===1?G:ie.entry);return{...ie,steps:ce,entry:fe}})},W=Y=>{u([Y])},X=()=>{r()};return w.jsxs("div",{className:"flex flex-col h-full bg-surface",children:[w.jsx("div",{className:"px-4 py-3 border-b border-white/10 flex items-center justify-between",children:w.jsxs("div",{className:"flex items-center gap-4",children:[w.jsxs("select",{value:(t==null?void 0:t.id)||"",onChange:Y=>{Y.target.value&&n(Y.target.value)},className:"bg-panel border border-white/20 rounded px-3 py-2 text-white text-sm focus:outline-none focus:border-teal-500",children:[w.jsx("option",{value:"",className:"bg-panel text-white",children:"Select Playbook..."}),e.map(Y=>w.jsxs("option",{value:Y.id,className:"bg-panel text-white",children:[Y.name," (",Y.status,")"]},Y.id))]}),V&&w.jsxs(w.Fragment,{children:[w.jsx("button",{onClick:()=>N(!0),className:"px-3 py-1.5 bg-teal-600 hover:bg-teal-700 text-white text-sm rounded",children:"New Draft"}),w.jsx("button",{onClick:()=>I(!0),className:"px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded",children:"New from Template"})]}),t&&w.jsxs(w.Fragment,{children:[w.jsx("span",{className:`px-2 py-1 rounded text-xs ${t.status==="published"?"bg-green-600 text-white":"bg-gray-600 text-white"}`,children:t.status}),s&&w.jsx("span",{className:"px-2 py-1 rounded text-xs bg-yellow-600 text-white",children:"Unsaved"})]})]})}),w.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[w.jsxs("div",{className:"flex flex-col w-1/2 border-r border-white/10 min-h-0",children:[V&&w.jsx(tK,{onAddNode:$}),w.jsxs("div",{className:"flex-1 relative min-h-0",style:{minHeight:"400px"},children:[w.jsx(QX,{onNodeClick:W}),h.length>0&&V&&w.jsx("div",{className:"absolute top-4 right-4 w-64 z-10",children:w.jsx(gY,{nodeId:h[0]})})]})]}),w.jsxs("div",{className:"w-1/2 flex flex-col",children:[w.jsxs("div",{className:"flex border-b border-white/10",children:[w.jsx("button",{onClick:()=>v("json"),className:`px-4 py-2 text-sm font-medium ${g==="json"?"border-b-2 border-white text-white":"opacity-70 hover:opacity-100 text-white"}`,children:"JSON"}),V&&w.jsxs(w.Fragment,{children:[w.jsx("button",{onClick:()=>v("test"),className:`px-4 py-2 text-sm font-medium ${g==="test"?"border-b-2 border-white text-white":"opacity-70 hover:opacity-100 text-white"}`,children:"Test Run"}),w.jsx("button",{onClick:()=>v("ai"),className:`px-4 py-2 text-sm font-medium ${g==="ai"?"border-b-2 border-white text-white":"opacity-70 hover:opacity-100 text-white"}`,children:"AI Assist"})]}),w.jsx("button",{onClick:()=>{v("versions"),S(!0)},className:`px-4 py-2 text-sm font-medium ${g==="versions"?"border-b-2 border-white text-white":"opacity-70 hover:opacity-100 text-white"}`,children:"Versions"})]}),w.jsxs("div",{className:"flex-1 overflow-hidden",children:[g==="json"&&w.jsx(dY,{onPublish:X,onRollback:()=>S(!0)}),g==="test"&&V&&w.jsx(fY,{}),g==="ai"&&V&&w.jsx(pY,{}),g==="versions"&&w.jsx("div",{className:"p-4 text-white/60 text-sm",children:'Click "Versions" tab to view version history'})]})]})]}),P&&w.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:w.jsxs("div",{className:"bg-panel rounded-xl border border-white/10 p-6 w-full max-w-md",children:[w.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"New Draft"}),w.jsx("input",{type:"text",value:A,onChange:Y=>D(Y.target.value),placeholder:"Playbook name",className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white placeholder-gray-400 focus:outline-none focus:border-teal-500 mb-4",onKeyPress:Y=>{Y.key==="Enter"&&U()}}),w.jsxs("div",{className:"flex justify-end gap-2",children:[w.jsx("button",{onClick:()=>{N(!1),D("")},className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded",children:"Cancel"}),w.jsx("button",{onClick:U,className:"px-4 py-2 bg-teal-600 hover:bg-teal-700 text-white rounded",children:"Create"})]})]})}),M&&w.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:w.jsxs("div",{className:"bg-panel rounded-xl border border-white/10 p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[w.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"New from Template"}),w.jsx("input",{type:"text",value:A,onChange:Y=>D(Y.target.value),placeholder:"Playbook name",className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white placeholder-gray-400 focus:outline-none focus:border-teal-500 mb-4"}),w.jsx("div",{className:"space-y-3 mb-4",children:iN.map(Y=>w.jsxs("div",{className:"p-4 bg-surface-dark border border-white/10 rounded cursor-pointer hover:border-teal-500 transition-colors",onClick:()=>{A.trim()?U(Y.id):D(Y.name)},children:[w.jsx("div",{className:"font-semibold text-white mb-1",children:Y.name}),w.jsx("div",{className:"text-sm text-white/60",children:Y.description}),w.jsxs("div",{className:"text-xs text-white/40 mt-2",children:[Y.jsonBody.steps.length," steps"]})]},Y.id))}),w.jsx("div",{className:"flex justify-end gap-2",children:w.jsx("button",{onClick:()=>{I(!1),D("")},className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded",children:"Cancel"})})]})}),w.jsx(mY,{isOpen:x,onClose:()=>{S(!1),v("json")}})]})};function yY(){const e=Ns(t=>t.unread);return w.jsxs("div",{className:"relative cursor-pointer",children:[w.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-400",children:w.jsx("path",{d:"M12 2a7 7 0 0 0-7 7v3l-2 2v2h18v-2l-2-2V9a7 7 0 0 0-7-7zm0 20a3 3 0 0 0 3-3H9a3 3 0 0 0 3 3z"})}),e>0&&w.jsx("span",{className:"absolute -top-1 -right-1 text-[10px] bg-red-600 text-white rounded-full px-1.5 min-w-[18px] text-center",children:e>99?"99+":e})]})}function xY({cards:e}){return w.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:e.map(t=>w.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl px-4 py-3 flex flex-col gap-1",children:[w.jsx("span",{className:"text-xs uppercase tracking-wide text-white/50",children:t.title}),w.jsx("span",{className:`text-2xl font-semibold text-white ${t.accentClass}`,children:t.value}),t.hint&&w.jsx("span",{className:"text-[11px] text-white/50",children:t.hint})]},t.title))})}function bY(){const e=NS(),{defaultDashboardId:t,dashboards:r,panels:n,queries:a,loadDashboards:i,loadPanels:u,loadQueries:s,loading:h}=sc(),[p,g]=Ke.useState(!1);Ke.useEffect(()=>{p||(i(),s(),g(!0))},[p,i,s]),Ke.useEffect(()=>{t&&u(t)},[t,u]);const v=t?r.find(P=>P.id===t)??null:null,x=Ke.useMemo(()=>{if(!t)return[];const P=n[t];return P?[...P].sort((N,M)=>(N.position??0)-(M.position??0)):[]},[t,n]),S=Ke.useCallback(P=>P?a.find(N=>N.id===P)??null:null,[a]);return h&&!v?w.jsx("div",{className:"flex h-full items-center justify-center text-white/70",children:"Loading dashboard"}):!t||!v?w.jsxs("div",{className:"flex h-full flex-col items-center justify-center gap-3 rounded-xl border border-dashed border-white/15 bg-white/5 text-center text-white/70 p-8",children:[w.jsx("p",{className:"text-base font-medium text-white",children:"Set a default dashboard"}),w.jsx("p",{className:"text-sm text-white/60 max-w-lg",children:"Choose Use on console for one of your dashboards and the console will render it here."}),w.jsx("button",{onClick:()=>e("/dashboards"),className:"px-3 py-2 rounded bg-teal-600 hover:bg-teal-500 text-white text-sm",children:"Open Dashboard Studio"})]}):x.length?w.jsx("div",{className:"flex h-full flex-col gap-4",children:w.jsx("div",{className:"flex-1 min-h-0 overflow-auto",children:w.jsx("div",{className:"grid h-full min-h-0 gap-4 md:grid-cols-2 auto-rows-[minmax(280px,1fr)]",children:x.map(P=>{const N=S(P.queryId);return w.jsx(Is,{title:P.title,children:w.jsx("div",{className:"flex-1 min-h-0 overflow-hidden",children:w.jsx(UR,{type:P.type,query:N,refreshSec:P.refreshSec,config:P.config})})},P.id)})})})}):w.jsxs("div",{className:"flex h-full flex-col items-center justify-center gap-3 rounded-xl border border-dashed border-white/15 bg-white/5 text-center text-white/70 p-8",children:[w.jsxs("p",{className:"text-base font-medium text-white",children:[v.name," has no panels yet"]}),w.jsx("p",{className:"text-sm text-white/60 max-w-lg",children:"Add panels in the Dashboard Studio and they will appear here automatically."}),w.jsx("button",{onClick:()=>e("/dashboards"),className:"px-3 py-2 rounded bg-teal-600 hover:bg-teal-500 text-white text-sm",children:"Add panels"})]})}let Xv=!1;function Qw(e){const t=e.state,r=t?{workerStatus:t.workerStatus??t.worker_status,lastHeartbeatAt:t.lastHeartbeatAt??t.last_heartbeat_at,lastEventAt:t.lastEventAt??t.last_event_at,errorCode:t.errorCode??t.error_code,errorMessage:t.errorMessage??t.error_message,metrics:t.metrics??t.metrics_snapshot,metricsSnapshot:t.metricsSnapshot??t.metrics_snapshot,updatedAt:t.updatedAt??t.updated_at}:void 0;return{id:e.id,name:e.name,type:e.type,description:e.description,status:e.status,ownerId:e.ownerId??e.owner_id,orgId:e.orgId??e.org_id,projectId:e.projectId??e.project_id,tags:e.tags||[],createdAt:e.createdAt??e.created_at,createdBy:e.createdBy??e.created_by,updatedAt:e.updatedAt??e.updated_at,updatedBy:e.updatedBy??e.updated_by,archivedAt:e.archivedAt??e.archived_at,currentVersion:e.currentVersion??e.current_version,state:r}}const Kv=Ti()(OH((e,t)=>({items:[],loading:!1,versions:[],events:[],secrets:[],filters:{},load:async r=>{e({loading:!0,filters:r??t().filters});try{const n={...t().filters,...r},{data:a}=await br.get("/datasources",{params:n});e({items:a.map(Qw)})}catch(n){const a=(n==null?void 0:n.message)||"Request failed";a.includes("404")?(Xv||(St("Datasource API is not available yet. Deploy the Phase 11 backend to enable this view."),Xv=!0),console.warn("Datasource API not available (404).",n),e({items:[]})):(console.error("Failed to load datasources",n),St(`Failed to load datasources: ${a}`))}finally{e({loading:!1})}},select:async r=>{if(e({selectedId:r}),!r){e({detail:void 0,versions:[],events:[],secrets:[],testResult:void 0});return}try{const{data:n}=await br.get(`/datasources/${r}`);e({detail:Qw(n)}),await Promise.all([t().loadVersions(r),t().loadEvents(r),t().loadSecrets(r)])}catch(n){console.error("Failed to fetch datasource",n),St(`Failed to open datasource: ${n.message}`)}},create:async r=>{try{const{data:n}=await br.post("/datasources",{name:r.name,description:r.description,type:r.type,ownerId:r.ownerId,orgId:r.orgId,projectId:r.projectId,tags:r.tags??[]}),a=Qw(n);return St("Datasource draft created"),await t().load(),a}catch(n){const a=(n==null?void 0:n.message)||"Request failed";a.includes("404")&&!Xv?(St("Datasource API is not available yet. Deploy the Phase 11 backend to enable this view."),Xv=!0):(console.error("Failed to create datasource",n),St(`Failed to create datasource: ${a}`))}},update:async(r,n)=>{try{await br.put(`/datasources/${r}`,{name:n.name,description:n.description,ownerId:n.ownerId,orgId:n.orgId,projectId:n.projectId,tags:n.tags,status:n.status}),St("Datasource updated"),await t().load(),t().selectedId===r&&await t().select(r)}catch(a){console.error("Failed to update datasource",a),St(`Failed to update datasource: ${a.message}`)}},archive:async r=>{try{await br.delete(`/datasources/${r}`),St("Datasource archived"),await t().load(),t().selectedId===r&&e({selectedId:void 0,detail:void 0,versions:[],events:[],secrets:[],testResult:void 0})}catch(n){console.error("Failed to archive datasource",n),St(`Failed to archive datasource: ${n.message}`)}},lifecycle:async(r,n)=>{try{await br.post(`/datasources/${r}/${n}`),St(`Datasource ${n} request sent`),t().selectedId===r?await t().select(r):await t().load()}catch(a){console.error(`Failed to ${n} datasource`,a),St(`Failed to ${n} datasource: ${a.message}`)}},publish:async(r,n,a)=>{try{await br.post(`/datasources/${r}/publish`,{version:n,comment:a}),St("Version published"),await t().select(r)}catch(i){console.error("Failed to publish datasource version",i),St(`Failed to publish version: ${i.message}`)}},rollback:async(r,n,a)=>{try{await br.post(`/datasources/${r}/rollback`,{targetVersion:n,comment:a}),St("Rolled back to previous version"),await t().select(r)}catch(i){console.error("Failed to rollback datasource version",i),St(`Failed to rollback version: ${i.message}`)}},createVersion:async(r,n)=>{try{await br.post(`/datasources/${r}/versions`,n),St("Draft version created"),await t().loadVersions(r)}catch(a){console.error("Failed to create datasource version",a),St(`Failed to create version: ${a.message}`)}},loadVersions:async r=>{try{const{data:n}=await br.get(`/datasources/${r}/versions`);e({versions:n})}catch(n){console.error("Failed to load versions",n),St(`Failed to load versions: ${n.message}`)}},loadEvents:async r=>{try{const{data:n}=await br.get(`/datasources/${r}/events`,{params:{limit:100}});e({events:n})}catch(n){console.error("Failed to load datasource events",n),St(`Failed to load events: ${n.message}`)}},runTest:async(r,n,a)=>{try{const i={payload:n};(a==null?void 0:a.version)!==void 0&&(i.version=a.version),a!=null&&a.configOverride&&(i.configOverride=a.configOverride);const{data:u}=await br.post(`/datasources/${r}/test`,i);e({testResult:u}),St(u.success?"Test run succeeded":"Test run failed")}catch(i){console.error("Failed to run datasource test",i),St(`Failed to run test: ${i.message}`)}},loadSecrets:async r=>{try{const{data:n}=await br.get(`/datasources/${r}/secrets`);e({secrets:n})}catch(n){console.error("Failed to load secrets",n),St(`Failed to load secrets: ${n.message}`)}},upsertSecret:async(r,n,a)=>{try{await br.post(`/datasources/${r}/secrets`,{key:n,value:a}),St("Secret saved"),await t().loadSecrets(r)}catch(i){console.error("Failed to save secret",i),St(`Failed to save secret: ${i.message}`)}},deleteSecret:async(r,n)=>{try{await br.delete(`/datasources/${r}/secrets/${encodeURIComponent(n)}`),St("Secret removed"),await t().loadSecrets(r)}catch(a){console.error("Failed to delete secret",a),St(`Failed to delete secret: ${a.message}`)}},setFilters:r=>e({filters:r}),clearTest:()=>e({testResult:void 0})}))),_Y={active:"bg-emerald-500/20 text-emerald-200 border-emerald-400/40",draft:"bg-white/10 text-white border-white/20",disabled:"bg-white/5 text-white/70 border-white/10",error:"bg-rose-500/10 text-rose-200 border-rose-400/40"},wY=[{label:"All statuses",value:"all"},{label:"Active",value:"active"},{label:"Draft",value:"draft"},{label:"Disabled",value:"disabled"},{label:"Error",value:"error"}],e1=JSON.stringify({entity:{id:"event-123",attrs:{ip:"8.8.8.8",domain:"example.com",tags:["production"]}}},null,2),_s=()=>w.jsx("span",{className:"h-3 w-3 animate-spin rounded-full border-2 border-current border-t-transparent"});function z2({status:e}){if(!e)return null;const t=_Y[e]??"bg-white/10 text-white border-white/20";return w.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-xs font-medium ${t}`,children:[w.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-current"}),e.toUpperCase()]})}function SY({item:e,isActive:t,onClick:r}){var n;return w.jsxs("button",{type:"button",onClick:r,className:`w-full rounded-lg border px-4 py-3 text-left transition ${t?"border-emerald-400/60 bg-emerald-500/10":"border-white/5 bg-white/5 hover:border-white/20"}`,children:[w.jsxs("div",{className:"flex items-start justify-between gap-2",children:[w.jsxs("div",{children:[w.jsx("p",{className:"text-sm font-semibold text-white",children:e.name}),w.jsx("p",{className:"mt-1 text-xs uppercase tracking-wide text-white/40",children:e.type})]}),w.jsx(z2,{status:e.status})]}),e.description&&w.jsx("p",{className:"mt-2 line-clamp-2 text-xs text-white/60",children:e.description}),(n=e.tags)!=null&&n.length?w.jsx("div",{className:"mt-3 flex flex-wrap gap-1.5",children:e.tags.map(a=>w.jsxs("span",{className:"rounded-md bg-black/40 px-2 py-0.5 text-[11px] text-white/60",children:["#",a]},a))}):null]})}function EY(){var Gi,Wi;const{items:e,load:t,loading:r,select:n,selectedId:a,detail:i,events:u,versions:s,testResult:h,filters:p,setFilters:g,clearTest:v,lifecycle:x,publish:S,rollback:P,createVersion:N,runTest:M,secrets:I,upsertSecret:A,deleteSecret:D}=Kv(lt=>({items:lt.items,load:lt.load,loading:lt.loading,select:lt.select,selectedId:lt.selectedId,detail:lt.detail,events:lt.events,versions:lt.versions,testResult:lt.testResult,filters:lt.filters,setFilters:lt.setFilters,clearTest:lt.clearTest,lifecycle:lt.lifecycle,publish:lt.publish,rollback:lt.rollback,createVersion:lt.createVersion,runTest:lt.runTest,secrets:lt.secrets,upsertSecret:lt.upsertSecret,deleteSecret:lt.deleteSecret})),[j,V]=se.useState(p.search??""),[U,$]=se.useState(p.status??"all"),[W,X]=se.useState(p.type??""),[J,Z]=se.useState("overview"),[K,Y]=se.useState(null),[G,oe]=se.useState(!1),[ie,ce]=se.useState(!1),[fe,de]=se.useState(e1),[be,ge]=se.useState(""),[xe,Le]=se.useState(""),[Oe,Fe]=se.useState(""),[et,nt]=se.useState(null),[mt,it]=se.useState(null),[ze,He]=se.useState(null),[We,ot]=se.useState(null),[xt,Tt]=se.useState(null),[$e,Xe]=se.useState(!1),[Pe,Ye]=se.useState(""),[at,bt]=se.useState(""),[Et,Vt]=se.useState(""),[Bt,Mt]=se.useState(""),[cr,ar]=se.useState(""),[ft,fr]=se.useState(""),[Xt,kt]=se.useState(""),[dt,le]=se.useState(null),[Be,qe]=se.useState(!1),[st,ut]=se.useState(!1),[vt,gt]=se.useState("{ }"),[Ut,Ot]=se.useState(""),[Kt,we]=se.useState(null),[ne,re]=se.useState(!1);se.useEffect(()=>{t().catch(()=>{})},[t]);const pe=se.useMemo(()=>{const lt=j.toLowerCase();return e.filter(or=>{var Zn;const Fr=!lt||or.name.toLowerCase().includes(lt)||or.type.toLowerCase().includes(lt)||((Zn=or.tags)==null?void 0:Zn.some(Fn=>Fn.toLowerCase().includes(lt))),Gr=U==="all"||or.status===U,vn=!W||or.type.toLowerCase().includes(W.toLowerCase());return Fr&&Gr&&vn})},[e,j,U,W]);se.useEffect(()=>{const lt=window.setTimeout(()=>{const or=Kv.getState();or.setFilters({...or.filters,search:j||void 0}),or.load({search:j||void 0}).catch(()=>{})},250);return()=>window.clearTimeout(lt)},[j]),se.useEffect(()=>{const lt=Kv.getState(),or={...lt.filters,status:U==="all"?void 0:U,type:W||void 0};lt.setFilters(or),lt.load({status:or.status,type:or.type}).catch(()=>{})},[U,W]),se.useEffect(()=>{Z("overview"),de(e1),ge(""),Le(""),Fe(""),ut(!1),we(null),Ot(""),gt("{ }")},[i==null?void 0:i.id]);const _e=lt=>{n(lt).catch(()=>{}),v()},Ne=async lt=>{if(i)try{Y(lt),await x(i.id,lt)}finally{Y(null)}},De=lt=>nt(lt),Ue=lt=>it(lt),Te=async()=>{if(!(!i||et===null))try{He("publish"),await S(i.id,et),nt(null)}finally{He(null)}},rt=async()=>{if(!(!i||mt===null))try{He("rollback"),await P(i.id,mt),it(null)}finally{He(null)}},ht=async()=>{var lt;i&&await N(i.id,{config:((lt=i.state)==null?void 0:lt.metricsSnapshot)??{},summary:"Draft generated from runtime snapshot"})},Qe=async()=>{if(!i)return;let lt;try{lt=fe?JSON.parse(fe):{}}catch(or){St(`Test payload must be valid JSON: ${or.message}`);return}try{oe(!0);const or=be.trim();let Fr;if(or.length>0){const Gr=Number(or);if(!Number.isFinite(Gr)){St("Version must be a number");return}Fr=Gr}await M(i.id,lt,{version:Fr})}finally{oe(!1)}},wt=async()=>{if(i){if(!xe.trim()||!Oe.trim()){St("Secret key and value are required");return}try{ce(!0),await A(i.id,xe.trim(),Oe),Le(""),Fe("")}finally{ce(!1)}}},At=async()=>{if(!(!i||!We))try{Tt(We),await D(i.id,We),ot(null)}finally{Tt(null)}},Ft=lt=>{if(!lt)return"";const or=new Date(lt);return Number.isNaN(or.getTime())?"":or.toLocaleString()},yr=(Wi=(Gi=i==null?void 0:i.state)==null?void 0:Gi.workerStatus)==null?void 0:Wi.toLowerCase(),ir=i==null?void 0:i.status,_r=yr==="running",pr=yr==="starting",Tr=ir==="active"&&!_r&&!pr,wr=ir==="active"&&(_r||pr),sr=ir==="active"&&_r,kr=ir==="active",Er=()=>{var lt,or,Fr,Gr,vn,Zn;return i?w.jsxs("section",{className:"space-y-6",children:[w.jsxs("section",{className:"rounded-xl border border-white/10 bg-black/20 p-5 text-white/80",children:[w.jsxs("header",{className:"flex flex-wrap items-start justify-between gap-4",children:[w.jsxs("div",{children:[w.jsx("h2",{className:"text-lg font-semibold text-white",children:i.name}),w.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-3 text-sm text-white/60",children:[w.jsx("span",{className:"rounded-md border border-white/15 bg-white/5 px-2 py-0.5 font-medium uppercase tracking-wide text-[11px] text-white/70",children:i.type}),w.jsx(z2,{status:i.status}),i.currentVersion!==void 0&&w.jsxs("span",{className:"text-white/60",children:["Current version: v",i.currentVersion]}),((lt=i.state)==null?void 0:lt.workerStatus)&&w.jsxs("span",{className:"text-white/60",children:["Worker: ",i.state.workerStatus]})]})]}),w.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[w.jsxs("div",{className:"rounded-lg border border-white/10 bg-black/40 px-3 py-2",children:[w.jsx("p",{className:"text-white/50",children:"Last heartbeat"}),w.jsx("p",{className:"mt-0.5 font-medium text-white",children:Ft((or=i.state)==null?void 0:or.lastHeartbeatAt)})]}),w.jsxs("div",{className:"rounded-lg border border-white/10 bg-black/40 px-3 py-2",children:[w.jsx("p",{className:"text-white/50",children:"Last event"}),w.jsx("p",{className:"mt-0.5 font-medium text-white",children:Ft((Fr=i.state)==null?void 0:Fr.lastEventAt)})]}),w.jsxs("div",{className:"rounded-lg border border-white/10 bg-black/40 px-3 py-2",children:[w.jsx("p",{className:"text-white/50",children:"Updated"}),w.jsx("p",{className:"mt-0.5 font-medium text-white",children:Ft(i.updatedAt)})]})]})]}),i.description&&w.jsx("p",{className:"mt-4 text-sm text-white/70",children:i.description}),(Gr=i.tags)!=null&&Gr.length?w.jsx("div",{className:"mt-4 flex flex-wrap gap-2",children:i.tags.map(Fn=>w.jsxs("span",{className:"rounded-md bg-emerald-500/10 px-2 py-0.5 text-[11px] text-emerald-200",children:["#",Fn]},Fn))}):null,((vn=i.state)==null?void 0:vn.errorMessage)&&w.jsxs("div",{className:"mt-4 rounded-lg border border-rose-400/40 bg-rose-500/10 p-3 text-sm text-rose-200",children:[w.jsx("p",{className:"font-semibold",children:"Worker error"}),w.jsx("p",{className:"mt-1 text-rose-100/80",children:i.state.errorMessage})]})]}),w.jsxs("section",{className:"grid gap-4 md:grid-cols-2",children:[w.jsxs("article",{className:"rounded-xl border border-white/10 bg-black/20 p-4 text-white/70",children:[w.jsx("h3",{className:"text-base font-semibold text-white",children:"Owner / Scope"}),w.jsxs("dl",{className:"mt-3 space-y-2 text-sm",children:[w.jsxs("div",{className:"flex justify-between gap-4",children:[w.jsx("dt",{className:"text-white/50",children:"Owner"}),w.jsx("dd",{className:"text-white",children:i.ownerId??""})]}),w.jsxs("div",{className:"flex justify-between gap-4",children:[w.jsx("dt",{className:"text-white/50",children:"Org"}),w.jsx("dd",{className:"text-white",children:i.orgId??""})]}),w.jsxs("div",{className:"flex justify-between gap-4",children:[w.jsx("dt",{className:"text-white/50",children:"Project"}),w.jsx("dd",{className:"text-white",children:i.projectId??""})]})]})]}),w.jsxs("article",{className:"rounded-xl border border-white/10 bg-black/20 p-4 text-white/70",children:[w.jsx("h3",{className:"text-base font-semibold text-white",children:"Runtime Metrics"}),w.jsx("p",{className:"mt-2 text-sm text-white/60",children:"Metric snapshots will appear here once datasource telemetry is hooked up to Grafana."}),(Zn=i.state)!=null&&Zn.metricsSnapshot&&Object.keys(i.state.metricsSnapshot).length?w.jsx("pre",{className:"mt-3 max-h-48 overflow-auto rounded bg-black/60 p-3 text-[11px] text-white/60",children:JSON.stringify(i.state.metricsSnapshot,null,2)}):w.jsx("p",{className:"mt-3 text-xs text-white/40",children:"No metrics emitted yet."})]})]})]}):null},cn=()=>i?w.jsxs("section",{className:"space-y-4",children:[w.jsxs("div",{className:"flex flex-wrap justify-between gap-3",children:[w.jsxs("div",{children:[w.jsx("h3",{className:"text-base font-semibold text-white",children:"Version History"}),w.jsx("p",{className:"text-sm text-white/60",children:"Publish or rollback configurations with full audit coverage."})]}),w.jsx("div",{className:"flex flex-wrap gap-2",children:w.jsx("button",{type:"button",className:"rounded-md border border-white/20 bg-white/5 px-3 py-1.5 text-sm text-white hover:bg-white/10",onClick:ht,children:"Draft from runtime"})})]}),w.jsxs("div",{className:"space-y-3",children:[s.map(lt=>{const or=lt.state==="published",Fr=!!ze;return w.jsxs("div",{className:"rounded-xl border border-white/10 bg-black/20 px-4 py-3 text-sm text-white/70",children:[w.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsxs("span",{className:"text-white font-semibold",children:["v",lt.version]}),w.jsx(z2,{status:lt.state})]}),w.jsxs("div",{className:"flex flex-wrap gap-2",children:[!or&&w.jsx("button",{type:"button",className:"rounded-md border border-emerald-400/50 bg-emerald-500/10 px-3 py-1 text-xs text-emerald-200 hover:bg-emerald-500/20 disabled:cursor-not-allowed disabled:opacity-40",onClick:()=>De(lt.version),disabled:Fr,children:"Publish"}),i.currentVersion!==lt.version&&w.jsxs("button",{type:"button",className:"rounded-md border border-white/20 bg-white/5 px-3 py-1 text-xs text-white hover:bg-white/10 disabled:cursor-not-allowed disabled:opacity-40",onClick:()=>Ue(lt.version),disabled:Fr,children:["Rollback to v",lt.version]})]})]}),w.jsxs("dl",{className:"mt-2 grid gap-2 text-xs text-white/60 sm:grid-cols-2",children:[w.jsxs("div",{children:[w.jsx("dt",{className:"text-white/40",children:"Created"}),w.jsx("dd",{children:Ft(lt.createdAt)})]}),w.jsxs("div",{children:[w.jsx("dt",{className:"text-white/40",children:"Published"}),w.jsx("dd",{children:Ft(lt.approvedAt)})]})]}),lt.summary&&w.jsx("p",{className:"mt-2 text-xs text-white/50",children:lt.summary}),w.jsxs("details",{className:"mt-3",children:[w.jsx("summary",{className:"cursor-pointer text-xs text-white/60",children:"View config JSON"}),w.jsx("pre",{className:"mt-2 max-h-60 overflow-auto rounded bg-black/60 p-3 text-[11px]",children:JSON.stringify(lt.config,null,2)})]})]},lt.version)}),!s.length&&w.jsx("div",{className:"rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-white/60",children:"No versions yet. Draft a config or import one to get started."})]})]}):null,gn=()=>w.jsxs("section",{className:"space-y-4",children:[w.jsxs("div",{children:[w.jsx("h3",{className:"text-base font-semibold text-white",children:"Audit Trail"}),w.jsx("p",{className:"text-sm text-white/60",children:"Every lifecycle action and secret update is captured for compliance."})]}),w.jsxs("div",{className:"space-y-2",children:[u.map(lt=>w.jsxs("div",{className:"rounded-xl border border-white/10 bg-black/20 px-4 py-3 text-xs text-white/70",children:[w.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 text-white/50",children:[w.jsx("span",{className:"font-semibold text-white",children:lt.eventType}),w.jsx("span",{children:Ft(lt.createdAt)})]}),lt.actor&&w.jsxs("p",{className:"mt-1 text-white/60",children:["Actor: ",lt.actor]}),lt.payload&&Object.keys(lt.payload).length>0?w.jsx("pre",{className:"mt-2 max-h-48 overflow-auto rounded bg-black/60 p-3 text-[11px]",children:JSON.stringify(lt.payload,null,2)}):w.jsx("p",{className:"mt-2 text-white/40",children:"No payload"})]},lt.id)),!u.length&&w.jsx("div",{className:"rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-white/60",children:"No events yet. Run lifecycle actions or publish versions to build history."})]})]}),wn=()=>{var lt,or;return w.jsxs("section",{className:"space-y-4",children:[w.jsxs("div",{className:"flex flex-wrap justify-between gap-3",children:[w.jsxs("div",{children:[w.jsx("h3",{className:"text-base font-semibold text-white",children:"Sandbox Test Run"}),w.jsx("p",{className:"text-sm text-white/60",children:"Validate mappings against sample payloads before promoting changes."})]}),w.jsxs("div",{className:"flex gap-2",children:[w.jsx("input",{type:"number",min:"0",step:"1",value:be,onChange:Fr=>ge(Fr.target.value),className:"w-28 rounded-md border border-white/10 bg-black/40 px-2 py-1.5 text-xs text-white placeholder-white/40 focus:border-emerald-400 focus:outline-none",placeholder:"Version"}),w.jsx("button",{type:"button",className:"rounded-md border border-white/20 bg-white/5 px-3 py-1.5 text-xs text-white hover:bg-white/10",onClick:()=>{de(e1),ge(""),v()},children:"Reset"})]})]}),w.jsx("textarea",{value:fe,onChange:Fr=>de(Fr.target.value),className:"h-64 w-full rounded-lg border border-white/10 bg-black/40 p-3 text-sm text-white placeholder-white/40 focus:border-emerald-400 focus:outline-none",spellCheck:!1}),w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsxs("button",{type:"button",className:"inline-flex items-center gap-2 rounded-md border border-emerald-400/50 bg-emerald-500/10 px-4 py-2 text-sm text-emerald-200 hover:bg-emerald-500/20 disabled:cursor-not-allowed disabled:opacity-40",onClick:Qe,disabled:G,children:[G&&w.jsx(_s,{}),"Run Test"]}),h&&w.jsx("span",{className:`rounded-full px-3 py-1 text-xs font-semibold ${h.success?"bg-emerald-500/20 text-emerald-200":"bg-rose-500/20 text-rose-200"}`,children:h.success?"Success":"Failed"})]}),h&&w.jsxs("div",{className:`rounded-xl border px-4 py-3 text-sm ${h.success?"border-emerald-400/40 bg-emerald-500/10 text-emerald-100":"border-rose-400/40 bg-rose-500/10 text-rose-100"}`,children:[(lt=h.warnings)!=null&&lt.length?w.jsxs("div",{className:"mb-3",children:[w.jsx("p",{className:"font-semibold",children:"Warnings"}),w.jsx("ul",{className:"mt-1 list-inside list-disc text-xs",children:h.warnings.map((Fr,Gr)=>w.jsx("li",{children:Fr},Gr))})]}):null,h.output!==void 0&&w.jsxs("div",{children:[w.jsx("p",{className:"font-semibold",children:"Output"}),w.jsx("pre",{className:"mt-1 max-h-60 overflow-auto rounded bg-black/40 p-2 text-[11px]",children:JSON.stringify(h.output,null,2)})]}),(or=h.logs)!=null&&or.length?w.jsxs("div",{className:"mt-3",children:[w.jsx("p",{className:"font-semibold",children:"Logs"}),w.jsx("pre",{className:"mt-1 max-h-60 overflow-auto rounded bg-black/40 p-2 text-[11px]",children:h.logs.join(`
`)})]}):null]})]})},oi=()=>w.jsxs("section",{className:"space-y-4",children:[w.jsxs("div",{className:"flex flex-wrap justify-between gap-4",children:[w.jsxs("div",{children:[w.jsx("h3",{className:"text-base font-semibold text-white",children:"Secrets"}),w.jsx("p",{className:"text-sm text-white/60",children:"Credentials are encrypted with AES-256-GCM; values are never displayed after creation."})]}),w.jsxs("div",{className:"flex flex-wrap gap-2",children:[w.jsx("input",{type:"text",placeholder:"Secret key (e.g. api_token)",value:xe,onChange:lt=>Le(lt.target.value),className:"w-48 rounded-md border border-white/10 bg-black/40 px-3 py-2 text-xs text-white placeholder-white/40 focus:border-emerald-400 focus:outline-none"}),w.jsx("input",{type:"password",placeholder:"Secret value",value:Oe,onChange:lt=>Fe(lt.target.value),className:"w-64 rounded-md border border-white/10 bg-black/40 px-3 py-2 text-xs text-white placeholder-white/40 focus:border-emerald-400 focus:outline-none"}),i&&w.jsxs("button",{type:"button",className:"inline-flex items-center gap-2 rounded-md border border-emerald-400/40 bg-emerald-500/10 px-3 py-1.5 text-xs text-emerald-200 hover:bg-emerald-500/20 disabled:cursor-not-allowed disabled:opacity-40",onClick:wt,disabled:ie,children:[ie&&w.jsx(_s,{}),"Save Secret"]})]})]}),w.jsx("div",{className:"overflow-hidden rounded-xl border border-white/10",children:w.jsxs("table",{className:"min-w-full divide-y divide-white/10 text-sm",children:[w.jsx("thead",{className:"bg-black/40 text-xs uppercase tracking-wide text-white/40",children:w.jsxs("tr",{children:[w.jsx("th",{className:"px-4 py-2 text-left",children:"Key"}),w.jsx("th",{className:"px-4 py-2 text-left",children:"Version"}),w.jsx("th",{className:"px-4 py-2 text-left",children:"Created"}),w.jsx("th",{className:"px-4 py-2 text-left",children:"Rotated"}),w.jsx("th",{className:"px-4 py-2 text-right",children:"Actions"})]})}),w.jsxs("tbody",{className:"divide-y divide-white/10 bg-black/20 text-white/70",children:[I.map(lt=>w.jsxs("tr",{children:[w.jsx("td",{className:"px-4 py-2 font-mono text-xs text-white",children:lt.key}),w.jsxs("td",{className:"px-4 py-2 text-xs text-white/70",children:["v",lt.version]}),w.jsxs("td",{className:"px-4 py-2 text-xs text-white/60",children:[Ft(lt.createdAt),lt.createdBy&&w.jsxs("span",{className:"block text-white/40",children:["by ",lt.createdBy]})]}),w.jsxs("td",{className:"px-4 py-2 text-xs text-white/60",children:[Ft(lt.rotatedAt),lt.rotatedBy&&w.jsxs("span",{className:"block text-white/40",children:["by ",lt.rotatedBy]})]}),w.jsx("td",{className:"px-4 py-2 text-right",children:w.jsx("button",{type:"button",className:"rounded-md border border-white/20 bg-white/5 px-3 py-1 text-xs text-white/70 hover:bg-white/10 disabled:cursor-not-allowed disabled:opacity-40",onClick:()=>ot(lt.key),disabled:xt!==null,children:"Delete"})})]},lt.key)),!I.length&&w.jsx("tr",{children:w.jsx("td",{className:"px-4 py-4 text-center text-sm text-white/50",colSpan:5,children:"No secrets defined yet. Add one above to get started."})})]})]})}),w.jsx("p",{className:"text-xs text-white/40",children:"Secret values are write-only. Rotate credentials regularly and monitor usage through the audit trail."})]}),Mr=[{id:"overview",label:"Overview"},{id:"versions",label:"Versions"},{id:"events",label:"Events"},{id:"test",label:"Test Sandbox"},{id:"secrets",label:"Secrets"}];return w.jsxs(w.Fragment,{children:[w.jsxs("div",{className:"flex h-full min-h-0 bg-surface",children:[w.jsxs("aside",{className:"flex w-80 min-w-[18rem] flex-col border-r border-white/10 bg-black/20",children:[w.jsxs("div",{className:"px-4 py-4 border-b border-white/10",children:[w.jsx("h2",{className:"text-lg font-semibold",children:"Datasources"}),w.jsx("p",{className:"mt-1 text-sm text-white/60",children:"Manage connectors, versions, and secrets."})]}),w.jsx("div",{className:"border-b border-white/10 p-4",children:w.jsx("input",{type:"search",placeholder:"Search datasources",value:j,onChange:lt=>V(lt.target.value),className:"w-full rounded-md border border-white/10 bg-black/40 px-3 py-2 text-sm text-white placeholder-white/40 focus:border-emerald-400 focus:outline-none"})}),w.jsxs("div",{className:"border-b border-white/10 p-4 space-y-3 text-xs text-white/60",children:[w.jsxs("label",{className:"block",children:[w.jsx("span",{className:"mb-1 block text-white/40",children:"Status"}),w.jsx("select",{value:U,onChange:lt=>$(lt.target.value),className:"w-full rounded-md border border-white/10 bg-black/40 px-3 py-2 text-sm text-white focus:border-emerald-400 focus:outline-none",children:wY.map(lt=>w.jsx("option",{value:lt.value,children:lt.label},lt.value))})]}),w.jsxs("label",{className:"block",children:[w.jsx("span",{className:"mb-1 block text-white/40",children:"Type"}),w.jsx("input",{type:"text",placeholder:"kafka, http, webhook",value:W,onChange:lt=>X(lt.target.value),className:"w-full rounded-md border border-white/10 bg-black/40 px-3 py-2 text-sm text-white placeholder-white/40 focus:border-emerald-400 focus:outline-none"})]})]}),w.jsx("div",{className:"flex-1 min-h-0 overflow-auto p-4 space-y-3 text-white/60",children:r&&!e.length?w.jsx("div",{className:"rounded-lg border border-white/10 bg-black/30 p-4 text-sm",children:"Loading datasources"}):pe.length?pe.map(lt=>w.jsx(SY,{item:lt,isActive:lt.id===a,onClick:()=>_e(lt.id)},lt.id)):w.jsxs("div",{className:"rounded-lg border border-white/10 bg-black/30 p-4 text-sm",children:[w.jsx("p",{className:"font-medium text-white",children:"No datasources yet"}),w.jsx("p",{className:"mt-1",children:"Use the actions on the right to create or import a datasource."})]})})]}),w.jsxs("main",{className:"flex-1 min-w-0 flex flex-col",children:[w.jsx("header",{className:"border-b border-white/10 px-6 py-4",children:w.jsxs("div",{className:"flex items-center justify-between gap-4",children:[w.jsxs("div",{children:[w.jsx("h1",{className:"text-xl font-semibold text-white",children:"Datasource Studio"}),w.jsx("p",{className:"mt-1 text-sm text-white/60",children:"Visualize runtime status, publish new versions, run sandbox tests, and manage secrets."})]}),w.jsxs("div",{className:"flex flex-wrap gap-2",children:[w.jsx("button",{type:"button",className:"rounded-md border border-emerald-400/40 bg-emerald-500/10 px-3 py-1.5 text-sm text-emerald-100 hover:bg-emerald-500/20",onClick:()=>{le(null),Xe(!0)},children:"New Datasource"}),i&&w.jsxs(w.Fragment,{children:[w.jsxs("button",{type:"button",className:"inline-flex items-center gap-2 rounded-md border border-emerald-400/50 bg-emerald-500/10 px-3 py-1.5 text-sm text-emerald-200 hover:bg-emerald-500/20 disabled:cursor-not-allowed disabled:opacity-40",onClick:()=>Ne("start"),disabled:!Tr||K!==null,children:[K==="start"&&w.jsx(_s,{}),"Start"]}),w.jsxs("button",{type:"button",className:"inline-flex items-center gap-2 rounded-md border border-white/20 bg-white/5 px-3 py-1.5 text-sm text-white hover:bg-white/10 disabled:cursor-not-allowed disabled:opacity-40",onClick:()=>Ne("restart"),disabled:!sr||K!==null,children:[K==="restart"&&w.jsx(_s,{}),"Restart"]}),w.jsxs("button",{type:"button",className:"inline-flex items-center gap-2 rounded-md border border-white/20 bg-white/5 px-3 py-1.5 text-sm text-white hover:bg-white/10 disabled:cursor-not-allowed disabled:opacity-40",onClick:()=>Ne("stop"),disabled:!wr||K!==null,children:[K==="stop"&&w.jsx(_s,{}),"Stop"]}),w.jsxs("button",{type:"button",className:"inline-flex items-center gap-2 rounded-md border border-white/20 bg-white/5 px-3 py-1.5 text-sm text-white hover:bg-white/10 disabled:cursor-not-allowed disabled:opacity-40",onClick:()=>Ne("backfill"),disabled:!kr||K!==null,children:[K==="backfill"&&w.jsx(_s,{}),"Queue Backfill"]})]}),w.jsx("button",{type:"button",className:"rounded-md border border-white/20 bg-white/5 px-3 py-1.5 text-sm text-white hover:bg-white/10 disabled:cursor-not-allowed disabled:opacity-40",onClick:()=>{we(null),gt("{ }"),ut(!0)},disabled:!i,children:"Import Config"})]})]})}),w.jsx("section",{className:"flex-1 min-h-0 overflow-auto p-6",children:i?w.jsxs("div",{className:"space-y-6",children:[w.jsx("nav",{className:"flex flex-wrap gap-2",children:Mr.map(({id:lt,label:or})=>w.jsx("button",{type:"button",className:`rounded-md px-3 py-1.5 text-sm font-medium ${J===lt?"bg-emerald-500/20 text-emerald-100 border border-emerald-400/40":"border border-white/10 bg-white/5 text-white/70 hover:bg-white/10"}`,onClick:()=>Z(lt),children:or},lt))}),J==="overview"&&Er(),J==="versions"&&cn(),J==="events"&&gn(),J==="test"&&wn(),J==="secrets"&&oi()]}):w.jsxs("div",{className:"flex h-full flex-col items-center justify-center rounded-xl border border-dashed border-white/20 bg-white/5 p-10 text-center text-white/60",children:[w.jsx("h3",{className:"text-lg font-semibold text-white",children:"Select a datasource to begin"}),w.jsx("p",{className:"mt-2 max-w-md text-sm",children:"Choose a datasource from the left to inspect runtime health, manage versions, run sandbox tests, and configure secrets. You can also create a new datasource to connect an external system."})]})})]})]}),w.jsxs(eo,{isOpen:et!==null,onClose:()=>{ze||nt(null)},title:"Publish version?",children:[w.jsxs("p",{className:"text-sm text-white/70",children:["Version v",et??""," will become the active configuration. Running workers will restart with the published config."]}),w.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[w.jsx("button",{type:"button",className:"rounded-md border border-white/20 bg-white/5 px-3 py-1.5 text-sm text-white hover:bg-white/10 disabled:cursor-not-allowed disabled:opacity-40",onClick:()=>nt(null),disabled:ze!==null,children:"Cancel"}),w.jsxs("button",{type:"button",className:"inline-flex items-center gap-2 rounded-md border border-emerald-400/50 bg-emerald-500/20 px-3 py-1.5 text-sm text-emerald-100 hover:bg-emerald-500/30 disabled:cursor-not-allowed disabled:opacity-40",onClick:Te,disabled:ze!==null,children:[ze==="publish"&&w.jsx(_s,{}),"Publish"]})]})]}),w.jsxs(eo,{isOpen:mt!==null,onClose:()=>{ze||it(null)},title:"Rollback datasource?",children:[w.jsxs("p",{className:"text-sm text-white/70",children:["Roll back to version v",mt??"","? Worker processes will reload the selected configuration after rollback completes."]}),w.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[w.jsx("button",{type:"button",className:"rounded-md border border-white/20 bg-white/5 px-3 py-1.5 text-sm text-white hover:bg-white/10 disabled:cursor-not-allowed disabled:opacity-40",onClick:()=>it(null),disabled:ze!==null,children:"Cancel"}),w.jsxs("button",{type:"button",className:"inline-flex items-center gap-2 rounded-md border border-white/20 bg-white/10 px-3 py-1.5 text-sm text-white hover:bg-white/15 disabled:cursor-not-allowed disabled:opacity-40",onClick:rt,disabled:ze!==null,children:[ze==="rollback"&&w.jsx(_s,{}),"Rollback"]})]})]}),w.jsxs(eo,{isOpen:We!==null,onClose:()=>{xt||ot(null)},title:"Delete secret?",children:[w.jsxs("p",{className:"text-sm text-white/70",children:["Remove secret ",w.jsx("span",{className:"font-mono text-white",children:We}),"? Connectors relying on this credential may fail until a replacement is provided."]}),w.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[w.jsx("button",{type:"button",className:"rounded-md border border-white/20 bg-white/5 px-3 py-1.5 text-sm text-white hover:bg-white/10 disabled:cursor-not-allowed disabled:opacity-40",onClick:()=>ot(null),disabled:!!xt,children:"Cancel"}),w.jsxs("button",{type:"button",className:"inline-flex items-center gap-2 rounded-md border border-rose-400/40 bg-rose-500/20 px-3 py-1.5 text-sm text-rose-100 hover:bg-rose-500/30 disabled:cursor-not-allowed disabled:opacity-40",onClick:At,disabled:!!xt,children:[xt&&w.jsx(_s,{}),"Delete secret"]})]})]}),w.jsx(eo,{isOpen:$e,onClose:()=>{Be||Xe(!1)},title:"Create datasource",children:w.jsxs("form",{className:"space-y-4",onSubmit:async lt=>{if(lt.preventDefault(),!Be){if(le(null),!Pe.trim()){le("Name is required");return}if(!at.trim()){le("Type is required");return}try{qe(!0);const or=await Kv.getState().create({name:Pe.trim(),description:Et.trim()||void 0,type:at.trim(),ownerId:cr.trim()||void 0,orgId:ft.trim()||void 0,projectId:Xt.trim()||void 0,tags:Bt.split(",").map(Fr=>Fr.trim()).filter(Boolean)});or?(Xe(!1),Ye(""),bt(""),Vt(""),Mt(""),ar(""),fr(""),kt(""),n(or.id).catch(()=>{})):le("Unable to create datasource")}catch(or){le(or.message||"Failed to create datasource")}finally{qe(!1)}}},children:[w.jsxs("div",{className:"space-y-3",children:[w.jsxs("label",{className:"block text-sm text-white/70",children:["Name",w.jsx("span",{className:"text-rose-300",children:"*"}),w.jsx("input",{type:"text",value:Pe,onChange:lt=>Ye(lt.target.value),className:"mt-1 w-full rounded-md border border-white/15 bg-black/40 px-3 py-2 text-sm text-white focus:border-emerald-400 focus:outline-none"})]}),w.jsxs("label",{className:"block text-sm text-white/70",children:["Type",w.jsx("span",{className:"text-rose-300",children:"*"}),w.jsx("input",{type:"text",value:at,placeholder:"kafka, http_poller, webhook",onChange:lt=>bt(lt.target.value),className:"mt-1 w-full rounded-md border border-white/15 bg-black/40 px-3 py-2 text-sm text-white focus:border-emerald-400 focus:outline-none"})]}),w.jsxs("label",{className:"block text-sm text-white/70",children:["Description",w.jsx("textarea",{value:Et,onChange:lt=>Vt(lt.target.value),className:"mt-1 h-20 w-full rounded-md border border-white/15 bg-black/40 px-3 py-2 text-sm text-white focus:border-emerald-400 focus:outline-none"})]}),w.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[w.jsxs("label",{className:"block text-sm text-white/70",children:["Owner",w.jsx("input",{type:"text",value:cr,onChange:lt=>ar(lt.target.value),className:"mt-1 w-full rounded-md border border-white/15 bg-black/40 px-3 py-2 text-sm text-white focus:border-emerald-400 focus:outline-none"})]}),w.jsxs("label",{className:"block text-sm text-white/70",children:["Org ID",w.jsx("input",{type:"text",value:ft,onChange:lt=>fr(lt.target.value),className:"mt-1 w-full rounded-md border border-white/15 bg-black/40 px-3 py-2 text-sm text-white focus:border-emerald-400 focus:outline-none"})]}),w.jsxs("label",{className:"block text-sm text-white/70",children:["Project ID",w.jsx("input",{type:"text",value:Xt,onChange:lt=>kt(lt.target.value),className:"mt-1 w-full rounded-md border border-white/15 bg-black/40 px-3 py-2 text-sm text-white focus:border-emerald-400 focus:outline-none"})]})]}),w.jsxs("label",{className:"block text-sm text-white/70",children:["Tags (comma separated)",w.jsx("input",{type:"text",value:Bt,onChange:lt=>Mt(lt.target.value),placeholder:"production, kafka, eu-west",className:"mt-1 w-full rounded-md border border-white/15 bg-black/40 px-3 py-2 text-sm text-white focus:border-emerald-400 focus:outline-none"})]})]}),dt&&w.jsx("p",{className:"text-sm text-rose-300",children:dt}),w.jsxs("div",{className:"mt-6 flex justify-end gap-2",children:[w.jsx("button",{type:"button",className:"rounded-md border border-white/20 bg-white/5 px-3 py-1.5 text-sm text-white hover:bg-white/10 disabled:cursor-not-allowed disabled:opacity-40",onClick:()=>Xe(!1),disabled:Be,children:"Cancel"}),w.jsxs("button",{type:"submit",className:"inline-flex items-center gap-2 rounded-md border border-emerald-400/40 bg-emerald-500/20 px-3 py-1.5 text-sm text-emerald-100 hover:bg-emerald-500/30 disabled:cursor-not-allowed disabled:opacity-40",disabled:Be,children:[Be&&w.jsx(_s,{}),"Create datasource"]})]})]})}),w.jsx(eo,{isOpen:st,onClose:()=>{ne||ut(!1)},title:i?`Import config into ${i.name}`:"Import config",children:i?w.jsxs("form",{className:"space-y-4",onSubmit:async lt=>{if(lt.preventDefault(),ne)return;we(null);let or;try{or=vt?JSON.parse(vt):{}}catch(Fr){we(`Invalid JSON: ${Fr.message}`);return}try{re(!0),await N(i.id,{config:or,summary:Ut||void 0}),ut(!1),Z("versions"),gt("{ }"),Ot("")}catch(Fr){we(Fr.message||"Failed to import config")}finally{re(!1)}},children:[w.jsx("p",{className:"text-sm text-white/60",children:"Paste a datasource configuration JSON to draft a new version. It will remain a draft until you publish it."}),w.jsxs("label",{className:"block text-sm text-white/70",children:["Summary / release notes",w.jsx("input",{type:"text",value:Ut,onChange:lt=>Ot(lt.target.value),placeholder:"Imported mapping from staging",className:"mt-1 w-full rounded-md border border-white/15 bg-black/40 px-3 py-2 text-sm text-white focus:border-emerald-400 focus:outline-none"})]}),w.jsxs("label",{className:"block text-sm text-white/70",children:["Config JSON",w.jsx("span",{className:"text-rose-300",children:"*"}),w.jsx("textarea",{value:vt,onChange:lt=>gt(lt.target.value),className:"mt-1 h-48 w-full rounded-md border border-white/15 bg-black/40 px-3 py-2 font-mono text-sm text-white focus:border-emerald-400 focus:outline-none",spellCheck:!1})]}),Kt&&w.jsx("p",{className:"text-sm text-rose-300",children:Kt}),w.jsxs("div",{className:"mt-6 flex justify-end gap-2",children:[w.jsx("button",{type:"button",className:"rounded-md border border-white/20 bg-white/5 px-3 py-1.5 text-sm text-white hover:bg-white/10 disabled:cursor-not-allowed disabled:opacity-40",onClick:()=>ut(!1),disabled:ne,children:"Cancel"}),w.jsxs("button",{type:"submit",className:"inline-flex items-center gap-2 rounded-md border border-emerald-400/40 bg-emerald-500/20 px-3 py-1.5 text-sm text-emerald-100 hover:bg-emerald-500/30 disabled:cursor-not-allowed disabled:opacity-40",disabled:ne,children:[ne&&w.jsx(_s,{}),"Import config"]})]})]}):w.jsx("p",{className:"text-sm text-white/60",children:"Select a datasource first to import a configuration into it."})})]})}function CY(){const{user:e}=Nc(),t=us(U=>U.setSelected),r=us(U=>U.get),n=us(U=>U.list),a=us(U=>U.items),i=Ns(U=>U.alerts),u=Ns(U=>U.load),s=sc(U=>U.queries),h=sc(U=>U.dashboards),p=sc(U=>U.loadQueries),g=sc(U=>U.loadDashboards),v=NS(),x=O0(),[S,P]=se.useState(null),N=U=>e?e.roles.includes(U):!1,I=(()=>{const U=x.pathname;return U==="/saved"?"saved":U==="/dashboards"?"dashboards":U==="/alerts"?"alerts":U==="/cases"?"cases":U==="/playbooks"?"playbooks":U==="/datasources"?"datasources":"console"})();se.useEffect(()=>TF($=>{P($),setTimeout(()=>P(null),3e3)}),[]),se.useEffect(()=>{u().catch(()=>{}),n({limit:100}).catch(()=>{}),p().catch(()=>{}),g().catch(()=>{})},[]),se.useEffect(()=>{const U=async W=>{var J;const X=W;if(v("/cases"),(J=X.detail)!=null&&J.caseId)try{const Z=await r(X.detail.caseId);t(Z)}catch{}},$=W=>{v("/alerts")};return window.addEventListener("navigate-to-cases",U),window.addEventListener("navigate-to-alerts",$),()=>{window.removeEventListener("navigate-to-cases",U),window.removeEventListener("navigate-to-alerts",$)}},[r,t,v]);const A=i.filter(U=>U.status==="open"),D=A.filter(U=>U.severity==="high").length,j=a.filter(U=>U.status==="open"||U.status==="in_progress"),V=[{title:"Open Alerts",value:A.length.toString(),hint:`${D} high severity`,accentClass:"text-emerald-300"},{title:"Active Cases",value:j.length.toString(),hint:`${a.length} total`,accentClass:"text-sky-300"},{title:"Dashboards / Queries",value:`${h.length} / ${s.length}`,hint:"curated views & saved queries",accentClass:"text-purple-300"}];return w.jsxs("div",{className:"min-h-screen bg-surface text-white",children:[w.jsxs("header",{className:"px-4 py-3 border-b border-white/10 flex items-center justify-between",children:[w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsx("img",{src:"/logo.png",alt:"HALCYON Logo",className:"h-8 w-8 object-contain"}),w.jsx("h1",{className:"text-xl font-semibold",children:"HALCYON Console"})]}),w.jsxs("div",{className:"flex items-center gap-4",children:[w.jsx("div",{className:"relative cursor-pointer",onClick:()=>{v("/alerts")},title:"Open Alerts",children:w.jsx(yY,{})}),w.jsx(CF,{})]})]}),w.jsxs("div",{className:"border-b border-white/10 flex gap-2 px-4",children:[w.jsx("button",{className:`px-3 py-2 text-sm font-medium ${I==="console"?"border-b-2 border-white text-white":"opacity-70 hover:opacity-100 text-white"}`,onClick:()=>v("/"),children:"Console"}),w.jsx("button",{className:`px-3 py-2 text-sm font-medium ${I==="saved"?"border-b-2 border-white text-white":"opacity-70 hover:opacity-100 text-white"}`,onClick:()=>v("/saved"),children:"Saved Queries"}),w.jsx("button",{className:`px-3 py-2 text-sm font-medium ${I==="dashboards"?"border-b-2 border-white text-white":"opacity-70 hover:opacity-100 text-white"}`,onClick:()=>v("/dashboards"),children:"Dashboards"}),(N("analyst")||N("admin"))&&w.jsx("button",{className:`px-3 py-2 text-sm font-medium ${I==="alerts"?"border-b-2 border-white text-white":"opacity-70 hover:opacity-100 text-white"}`,onClick:()=>v("/alerts"),children:"Alerts"}),(N("analyst")||N("admin")||N("viewer"))&&w.jsx("button",{className:`px-3 py-2 text-sm font-medium ${I==="cases"?"border-b-2 border-white text-white":"opacity-70 hover:opacity-100 text-white"}`,onClick:()=>v("/cases"),children:"Cases"}),(N("analyst")||N("admin")||N("viewer"))&&w.jsx("button",{className:`px-3 py-2 text-sm font-medium ${I==="playbooks"?"border-b-2 border-white text-white":"opacity-70 hover:opacity-100 text-white"}`,onClick:()=>v("/playbooks"),children:"Playbooks"}),(N("analyst")||N("admin")||N("viewer"))&&w.jsx("button",{className:`px-3 py-2 text-sm font-medium ${I==="datasources"?"border-b-2 border-white text-white":"opacity-70 hover:opacity-100 text-white"}`,onClick:()=>v("/datasources"),children:"Datasources"})]}),w.jsxs(GO,{children:[w.jsx(Io,{path:"/",element:w.jsxs(w.Fragment,{children:[w.jsxs("div",{className:"h-[calc(100vh-8rem)] flex flex-col overflow-hidden",children:[w.jsx("div",{className:"p-4 pb-2",children:w.jsx(xY,{cards:V})}),w.jsx("div",{className:"flex-1 min-h-0 overflow-auto px-4 pb-4",children:w.jsx("div",{className:"min-h-full",children:w.jsx(bY,{})})})]}),w.jsx(SF,{})]})}),w.jsx(Io,{path:"/saved",element:w.jsx("div",{className:"h-[calc(100vh-8rem)] overflow-auto",children:w.jsx(PF,{})})}),w.jsx(Io,{path:"/dashboards",element:w.jsx("div",{className:"h-[calc(100vh-8rem)] overflow-auto",children:w.jsx(AH,{})})}),w.jsx(Io,{path:"/alerts",element:N("analyst")||N("admin")?w.jsx("div",{className:"h-[calc(100vh-8rem)] overflow-auto",children:w.jsx(XH,{})}):w.jsx(sp,{to:"/",replace:!0})}),w.jsx(Io,{path:"/cases",element:N("analyst")||N("admin")||N("viewer")?w.jsx("div",{className:"h-[calc(100vh-8rem)] overflow-auto",children:w.jsx(i7,{})}):w.jsx(sp,{to:"/",replace:!0})}),w.jsx(Io,{path:"/playbooks",element:N("analyst")||N("admin")||N("viewer")?w.jsx("div",{className:"h-[calc(100vh-8rem)] overflow-hidden",children:w.jsx(vY,{})}):w.jsx(sp,{to:"/",replace:!0})}),w.jsx(Io,{path:"/datasources",element:N("analyst")||N("admin")||N("viewer")?w.jsx("div",{className:"h-[calc(100vh-8rem)] overflow-hidden",children:w.jsx(EY,{})}):w.jsx(sp,{to:"/",replace:!0})}),w.jsx(Io,{path:"*",element:w.jsx(sp,{to:"/",replace:!0})})]}),S&&w.jsx(kF,{message:S,onClose:()=>P(null)})]})}function kY(){const{user:e,initialize:t,loading:r}=Nc(),[n,a]=se.useState(!1);se.useEffect(()=>{t(),a(!0)},[t]);const i=n&&(e||VD());return!n||r?w.jsx("div",{className:"min-h-screen bg-surface text-white flex items-center justify-center",children:w.jsx("div",{className:"text-lg",children:"Loading..."})}):i?w.jsx(CY,{}):w.jsx(EF,{})}yD(document.getElementById("root")).render(w.jsx(XO,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:w.jsx(kY,{})}));
