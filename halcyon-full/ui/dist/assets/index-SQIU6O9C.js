function c5(e,t){for(var r=0;r<t.length;r++){const n=t[r];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in e)){const s=Object.getOwnPropertyDescriptor(n,i);s&&Object.defineProperty(e,i,s.get?s:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const u of s.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function r(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=r(i);fetch(i.href,s)}})();var h5=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function w2(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var VA={exports:{}},p0={},UA={exports:{}},Ar={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Im=Symbol.for("react.element"),d5=Symbol.for("react.portal"),f5=Symbol.for("react.fragment"),p5=Symbol.for("react.strict_mode"),m5=Symbol.for("react.profiler"),g5=Symbol.for("react.provider"),v5=Symbol.for("react.context"),y5=Symbol.for("react.forward_ref"),x5=Symbol.for("react.suspense"),_5=Symbol.for("react.memo"),w5=Symbol.for("react.lazy"),ZT=Symbol.iterator;function b5(e){return e===null||typeof e!="object"?null:(e=ZT&&e[ZT]||e["@@iterator"],typeof e=="function"?e:null)}var qA={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},HA=Object.assign,GA={};function Dd(e,t,r){this.props=e,this.context=t,this.refs=GA,this.updater=r||qA}Dd.prototype.isReactComponent={};Dd.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Dd.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function WA(){}WA.prototype=Dd.prototype;function b2(e,t,r){this.props=e,this.context=t,this.refs=GA,this.updater=r||qA}var S2=b2.prototype=new WA;S2.constructor=b2;HA(S2,Dd.prototype);S2.isPureReactComponent=!0;var XT=Array.isArray,ZA=Object.prototype.hasOwnProperty,E2={current:null},XA={key:!0,ref:!0,__self:!0,__source:!0};function KA(e,t,r){var n,i={},s=null,u=null;if(t!=null)for(n in t.ref!==void 0&&(u=t.ref),t.key!==void 0&&(s=""+t.key),t)ZA.call(t,n)&&!XA.hasOwnProperty(n)&&(i[n]=t[n]);var a=arguments.length-2;if(a===1)i.children=r;else if(1<a){for(var d=Array(a),p=0;p<a;p++)d[p]=arguments[p+2];i.children=d}if(e&&e.defaultProps)for(n in a=e.defaultProps,a)i[n]===void 0&&(i[n]=a[n]);return{$$typeof:Im,type:e,key:s,ref:u,props:i,_owner:E2.current}}function S5(e,t){return{$$typeof:Im,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function T2(e){return typeof e=="object"&&e!==null&&e.$$typeof===Im}function E5(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var KT=/\/+/g;function T_(e,t){return typeof e=="object"&&e!==null&&e.key!=null?E5(""+e.key):t.toString(36)}function qv(e,t,r,n,i){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var u=!1;if(e===null)u=!0;else switch(s){case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case Im:case d5:u=!0}}if(u)return u=e,i=i(u),e=n===""?"."+T_(u,0):n,XT(i)?(r="",e!=null&&(r=e.replace(KT,"$&/")+"/"),qv(i,t,r,"",function(p){return p})):i!=null&&(T2(i)&&(i=S5(i,r+(!i.key||u&&u.key===i.key?"":(""+i.key).replace(KT,"$&/")+"/")+e)),t.push(i)),1;if(u=0,n=n===""?".":n+":",XT(e))for(var a=0;a<e.length;a++){s=e[a];var d=n+T_(s,a);u+=qv(s,t,r,d,i)}else if(d=b5(e),typeof d=="function")for(e=d.call(e),a=0;!(s=e.next()).done;)s=s.value,d=n+T_(s,a++),u+=qv(s,t,r,d,i);else if(s==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return u}function ev(e,t,r){if(e==null)return e;var n=[],i=0;return qv(e,n,"","",function(s){return t.call(r,s,i++)}),n}function T5(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var ra={current:null},Hv={transition:null},C5={ReactCurrentDispatcher:ra,ReactCurrentBatchConfig:Hv,ReactCurrentOwner:E2};function YA(){throw Error("act(...) is not supported in production builds of React.")}Ar.Children={map:ev,forEach:function(e,t,r){ev(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return ev(e,function(){t++}),t},toArray:function(e){return ev(e,function(t){return t})||[]},only:function(e){if(!T2(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Ar.Component=Dd;Ar.Fragment=f5;Ar.Profiler=m5;Ar.PureComponent=b2;Ar.StrictMode=p5;Ar.Suspense=x5;Ar.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=C5;Ar.act=YA;Ar.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=HA({},e.props),i=e.key,s=e.ref,u=e._owner;if(t!=null){if(t.ref!==void 0&&(s=t.ref,u=E2.current),t.key!==void 0&&(i=""+t.key),e.type&&e.type.defaultProps)var a=e.type.defaultProps;for(d in t)ZA.call(t,d)&&!XA.hasOwnProperty(d)&&(n[d]=t[d]===void 0&&a!==void 0?a[d]:t[d])}var d=arguments.length-2;if(d===1)n.children=r;else if(1<d){a=Array(d);for(var p=0;p<d;p++)a[p]=arguments[p+2];n.children=a}return{$$typeof:Im,type:e.type,key:i,ref:s,props:n,_owner:u}};Ar.createContext=function(e){return e={$$typeof:v5,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:g5,_context:e},e.Consumer=e};Ar.createElement=KA;Ar.createFactory=function(e){var t=KA.bind(null,e);return t.type=e,t};Ar.createRef=function(){return{current:null}};Ar.forwardRef=function(e){return{$$typeof:y5,render:e}};Ar.isValidElement=T2;Ar.lazy=function(e){return{$$typeof:w5,_payload:{_status:-1,_result:e},_init:T5}};Ar.memo=function(e,t){return{$$typeof:_5,type:e,compare:t===void 0?null:t}};Ar.startTransition=function(e){var t=Hv.transition;Hv.transition={};try{e()}finally{Hv.transition=t}};Ar.unstable_act=YA;Ar.useCallback=function(e,t){return ra.current.useCallback(e,t)};Ar.useContext=function(e){return ra.current.useContext(e)};Ar.useDebugValue=function(){};Ar.useDeferredValue=function(e){return ra.current.useDeferredValue(e)};Ar.useEffect=function(e,t){return ra.current.useEffect(e,t)};Ar.useId=function(){return ra.current.useId()};Ar.useImperativeHandle=function(e,t,r){return ra.current.useImperativeHandle(e,t,r)};Ar.useInsertionEffect=function(e,t){return ra.current.useInsertionEffect(e,t)};Ar.useLayoutEffect=function(e,t){return ra.current.useLayoutEffect(e,t)};Ar.useMemo=function(e,t){return ra.current.useMemo(e,t)};Ar.useReducer=function(e,t,r){return ra.current.useReducer(e,t,r)};Ar.useRef=function(e){return ra.current.useRef(e)};Ar.useState=function(e){return ra.current.useState(e)};Ar.useSyncExternalStore=function(e,t,r){return ra.current.useSyncExternalStore(e,t,r)};Ar.useTransition=function(){return ra.current.useTransition()};Ar.version="18.3.1";UA.exports=Ar;var ce=UA.exports;const Qe=w2(ce),k5=c5({__proto__:null,default:Qe},[ce]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var P5=ce,I5=Symbol.for("react.element"),A5=Symbol.for("react.fragment"),M5=Object.prototype.hasOwnProperty,D5=P5.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,N5={key:!0,ref:!0,__self:!0,__source:!0};function JA(e,t,r){var n,i={},s=null,u=null;r!==void 0&&(s=""+r),t.key!==void 0&&(s=""+t.key),t.ref!==void 0&&(u=t.ref);for(n in t)M5.call(t,n)&&!N5.hasOwnProperty(n)&&(i[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)i[n]===void 0&&(i[n]=t[n]);return{$$typeof:I5,type:e,key:s,ref:u,props:i,_owner:D5.current}}p0.Fragment=A5;p0.jsx=JA;p0.jsxs=JA;VA.exports=p0;var D=VA.exports,QA={exports:{}},Fa={},eM={exports:{}},tM={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(me,ae){var ve=me.length;me.push(ae);e:for(;0<ve;){var pe=ve-1>>>1,_e=me[pe];if(0<i(_e,ae))me[pe]=ae,me[ve]=_e,ve=pe;else break e}}function r(me){return me.length===0?null:me[0]}function n(me){if(me.length===0)return null;var ae=me[0],ve=me.pop();if(ve!==ae){me[0]=ve;e:for(var pe=0,_e=me.length,De=_e>>>1;pe<De;){var Le=2*(pe+1)-1,je=me[Le],Je=Le+1,et=me[Je];if(0>i(je,ve))Je<_e&&0>i(et,je)?(me[pe]=et,me[Je]=ve,pe=Je):(me[pe]=je,me[Le]=ve,pe=Le);else if(Je<_e&&0>i(et,ve))me[pe]=et,me[Je]=ve,pe=Je;else break e}}return ae}function i(me,ae){var ve=me.sortIndex-ae.sortIndex;return ve!==0?ve:me.id-ae.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var u=Date,a=u.now();e.unstable_now=function(){return u.now()-a}}var d=[],p=[],g=1,v=null,_=3,b=!1,k=!1,A=!1,M=typeof setTimeout=="function"?setTimeout:null,P=typeof clearTimeout=="function"?clearTimeout:null,I=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function z(me){for(var ae=r(p);ae!==null;){if(ae.callback===null)n(p);else if(ae.startTime<=me)n(p),ae.sortIndex=ae.expirationTime,t(d,ae);else break;ae=r(p)}}function O(me){if(A=!1,z(me),!k)if(r(d)!==null)k=!0,se(V);else{var ae=r(p);ae!==null&&de(O,ae.startTime-me)}}function V(me,ae){k=!1,A&&(A=!1,P(G),G=-1),b=!0;var ve=_;try{for(z(ae),v=r(d);v!==null&&(!(v.expirationTime>ae)||me&&!X());){var pe=v.callback;if(typeof pe=="function"){v.callback=null,_=v.priorityLevel;var _e=pe(v.expirationTime<=ae);ae=e.unstable_now(),typeof _e=="function"?v.callback=_e:v===r(d)&&n(d),z(ae)}else n(d);v=r(d)}if(v!==null)var De=!0;else{var Le=r(p);Le!==null&&de(O,Le.startTime-ae),De=!1}return De}finally{v=null,_=ve,b=!1}}var U=!1,$=null,G=-1,Z=5,Q=-1;function X(){return!(e.unstable_now()-Q<Z)}function ie(){if($!==null){var me=e.unstable_now();Q=me;var ae=!0;try{ae=$(!0,me)}finally{ae?te():(U=!1,$=null)}}else U=!1}var te;if(typeof I=="function")te=function(){I(ie)};else if(typeof MessageChannel<"u"){var W=new MessageChannel,oe=W.port2;W.port1.onmessage=ie,te=function(){oe.postMessage(null)}}else te=function(){M(ie,0)};function se(me){$=me,U||(U=!0,te())}function de(me,ae){G=M(function(){me(e.unstable_now())},ae)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(me){me.callback=null},e.unstable_continueExecution=function(){k||b||(k=!0,se(V))},e.unstable_forceFrameRate=function(me){0>me||125<me?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Z=0<me?Math.floor(1e3/me):5},e.unstable_getCurrentPriorityLevel=function(){return _},e.unstable_getFirstCallbackNode=function(){return r(d)},e.unstable_next=function(me){switch(_){case 1:case 2:case 3:var ae=3;break;default:ae=_}var ve=_;_=ae;try{return me()}finally{_=ve}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(me,ae){switch(me){case 1:case 2:case 3:case 4:case 5:break;default:me=3}var ve=_;_=me;try{return ae()}finally{_=ve}},e.unstable_scheduleCallback=function(me,ae,ve){var pe=e.unstable_now();switch(typeof ve=="object"&&ve!==null?(ve=ve.delay,ve=typeof ve=="number"&&0<ve?pe+ve:pe):ve=pe,me){case 1:var _e=-1;break;case 2:_e=250;break;case 5:_e=1073741823;break;case 4:_e=1e4;break;default:_e=5e3}return _e=ve+_e,me={id:g++,callback:ae,priorityLevel:me,startTime:ve,expirationTime:_e,sortIndex:-1},ve>pe?(me.sortIndex=ve,t(p,me),r(d)===null&&me===r(p)&&(A?(P(G),G=-1):A=!0,de(O,ve-pe))):(me.sortIndex=_e,t(d,me),k||b||(k=!0,se(V))),me},e.unstable_shouldYield=X,e.unstable_wrapCallback=function(me){var ae=_;return function(){var ve=_;_=ae;try{return me.apply(this,arguments)}finally{_=ve}}}})(tM);eM.exports=tM;var z5=eM.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var R5=ce,Ba=z5;function bt(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var rM=new Set,$p={};function Ec(e,t){vd(e,t),vd(e+"Capture",t)}function vd(e,t){for($p[e]=t,e=0;e<t.length;e++)rM.add(t[e])}var No=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),qb=Object.prototype.hasOwnProperty,L5=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,YT={},JT={};function B5(e){return qb.call(JT,e)?!0:qb.call(YT,e)?!1:L5.test(e)?JT[e]=!0:(YT[e]=!0,!1)}function O5(e,t,r,n){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function F5(e,t,r,n){if(t===null||typeof t>"u"||O5(e,t,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function na(e,t,r,n,i,s,u){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=i,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=u}var Ei={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Ei[e]=new na(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Ei[t]=new na(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Ei[e]=new na(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Ei[e]=new na(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Ei[e]=new na(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Ei[e]=new na(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Ei[e]=new na(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Ei[e]=new na(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Ei[e]=new na(e,5,!1,e.toLowerCase(),null,!1,!1)});var C2=/[\-:]([a-z])/g;function k2(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(C2,k2);Ei[t]=new na(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(C2,k2);Ei[t]=new na(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(C2,k2);Ei[t]=new na(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Ei[e]=new na(e,1,!1,e.toLowerCase(),null,!1,!1)});Ei.xlinkHref=new na("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Ei[e]=new na(e,1,!1,e.toLowerCase(),null,!0,!0)});function P2(e,t,r,n){var i=Ei.hasOwnProperty(t)?Ei[t]:null;(i!==null?i.type!==0:n||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(F5(t,r,i,n)&&(r=null),n||i===null?B5(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):i.mustUseProperty?e[i.propertyName]=r===null?i.type===3?!1:"":r:(t=i.attributeName,n=i.attributeNamespace,r===null?e.removeAttribute(t):(i=i.type,r=i===3||i===4&&r===!0?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}var $o=R5.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,tv=Symbol.for("react.element"),jh=Symbol.for("react.portal"),$h=Symbol.for("react.fragment"),I2=Symbol.for("react.strict_mode"),Hb=Symbol.for("react.profiler"),nM=Symbol.for("react.provider"),iM=Symbol.for("react.context"),A2=Symbol.for("react.forward_ref"),Gb=Symbol.for("react.suspense"),Wb=Symbol.for("react.suspense_list"),M2=Symbol.for("react.memo"),kl=Symbol.for("react.lazy"),aM=Symbol.for("react.offscreen"),QT=Symbol.iterator;function Zf(e){return e===null||typeof e!="object"?null:(e=QT&&e[QT]||e["@@iterator"],typeof e=="function"?e:null)}var kn=Object.assign,C_;function vp(e){if(C_===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);C_=t&&t[1]||""}return`
`+C_+e}var k_=!1;function P_(e,t){if(!e||k_)return"";k_=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(p){var n=p}Reflect.construct(e,[],t)}else{try{t.call()}catch(p){n=p}e.call(t.prototype)}else{try{throw Error()}catch(p){n=p}e()}}catch(p){if(p&&n&&typeof p.stack=="string"){for(var i=p.stack.split(`
`),s=n.stack.split(`
`),u=i.length-1,a=s.length-1;1<=u&&0<=a&&i[u]!==s[a];)a--;for(;1<=u&&0<=a;u--,a--)if(i[u]!==s[a]){if(u!==1||a!==1)do if(u--,a--,0>a||i[u]!==s[a]){var d=`
`+i[u].replace(" at new "," at ");return e.displayName&&d.includes("<anonymous>")&&(d=d.replace("<anonymous>",e.displayName)),d}while(1<=u&&0<=a);break}}}finally{k_=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?vp(e):""}function j5(e){switch(e.tag){case 5:return vp(e.type);case 16:return vp("Lazy");case 13:return vp("Suspense");case 19:return vp("SuspenseList");case 0:case 2:case 15:return e=P_(e.type,!1),e;case 11:return e=P_(e.type.render,!1),e;case 1:return e=P_(e.type,!0),e;default:return""}}function Zb(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case $h:return"Fragment";case jh:return"Portal";case Hb:return"Profiler";case I2:return"StrictMode";case Gb:return"Suspense";case Wb:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case iM:return(e.displayName||"Context")+".Consumer";case nM:return(e._context.displayName||"Context")+".Provider";case A2:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case M2:return t=e.displayName||null,t!==null?t:Zb(e.type)||"Memo";case kl:t=e._payload,e=e._init;try{return Zb(e(t))}catch{}}return null}function $5(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Zb(t);case 8:return t===I2?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function eu(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function sM(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function V5(e){var t=sM(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var i=r.get,s=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(u){n=""+u,s.call(this,u)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(u){n=""+u},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function rv(e){e._valueTracker||(e._valueTracker=V5(e))}function oM(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=sM(e)?e.checked?"true":"false":e.value),e=n,e!==r?(t.setValue(e),!0):!1}function yy(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Xb(e,t){var r=t.checked;return kn({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function eC(e,t){var r=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;r=eu(t.value!=null?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function lM(e,t){t=t.checked,t!=null&&P2(e,"checked",t,!1)}function Kb(e,t){lM(e,t);var r=eu(t.value),n=t.type;if(r!=null)n==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Yb(e,t.type,r):t.hasOwnProperty("defaultValue")&&Yb(e,t.type,eu(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function tC(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function Yb(e,t,r){(t!=="number"||yy(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var yp=Array.isArray;function nd(e,t,r,n){if(e=e.options,t){t={};for(var i=0;i<r.length;i++)t["$"+r[i]]=!0;for(r=0;r<e.length;r++)i=t.hasOwnProperty("$"+e[r].value),e[r].selected!==i&&(e[r].selected=i),i&&n&&(e[r].defaultSelected=!0)}else{for(r=""+eu(r),t=null,i=0;i<e.length;i++){if(e[i].value===r){e[i].selected=!0,n&&(e[i].defaultSelected=!0);return}t!==null||e[i].disabled||(t=e[i])}t!==null&&(t.selected=!0)}}function Jb(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(bt(91));return kn({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function rC(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(bt(92));if(yp(r)){if(1<r.length)throw Error(bt(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:eu(r)}}function uM(e,t){var r=eu(t.value),n=eu(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),n!=null&&(e.defaultValue=""+n)}function nC(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function cM(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Qb(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?cM(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var nv,hM=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,n,i){MSApp.execUnsafeLocalFunction(function(){return e(t,r,n,i)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(nv=nv||document.createElement("div"),nv.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=nv.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Vp(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var Pp={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},U5=["Webkit","ms","Moz","O"];Object.keys(Pp).forEach(function(e){U5.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Pp[t]=Pp[e]})});function dM(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||Pp.hasOwnProperty(e)&&Pp[e]?(""+t).trim():t+"px"}function fM(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var n=r.indexOf("--")===0,i=dM(r,t[r],n);r==="float"&&(r="cssFloat"),n?e.setProperty(r,i):e[r]=i}}var q5=kn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function e1(e,t){if(t){if(q5[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(bt(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(bt(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(bt(61))}if(t.style!=null&&typeof t.style!="object")throw Error(bt(62))}}function t1(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var r1=null;function D2(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var n1=null,id=null,ad=null;function iC(e){if(e=Dm(e)){if(typeof n1!="function")throw Error(bt(280));var t=e.stateNode;t&&(t=x0(t),n1(e.stateNode,e.type,t))}}function pM(e){id?ad?ad.push(e):ad=[e]:id=e}function mM(){if(id){var e=id,t=ad;if(ad=id=null,iC(e),t)for(e=0;e<t.length;e++)iC(t[e])}}function gM(e,t){return e(t)}function vM(){}var I_=!1;function yM(e,t,r){if(I_)return e(t,r);I_=!0;try{return gM(e,t,r)}finally{I_=!1,(id!==null||ad!==null)&&(vM(),mM())}}function Up(e,t){var r=e.stateNode;if(r===null)return null;var n=x0(r);if(n===null)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(bt(231,t,typeof r));return r}var i1=!1;if(No)try{var Xf={};Object.defineProperty(Xf,"passive",{get:function(){i1=!0}}),window.addEventListener("test",Xf,Xf),window.removeEventListener("test",Xf,Xf)}catch{i1=!1}function H5(e,t,r,n,i,s,u,a,d){var p=Array.prototype.slice.call(arguments,3);try{t.apply(r,p)}catch(g){this.onError(g)}}var Ip=!1,xy=null,_y=!1,a1=null,G5={onError:function(e){Ip=!0,xy=e}};function W5(e,t,r,n,i,s,u,a,d){Ip=!1,xy=null,H5.apply(G5,arguments)}function Z5(e,t,r,n,i,s,u,a,d){if(W5.apply(this,arguments),Ip){if(Ip){var p=xy;Ip=!1,xy=null}else throw Error(bt(198));_y||(_y=!0,a1=p)}}function Tc(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function xM(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function aC(e){if(Tc(e)!==e)throw Error(bt(188))}function X5(e){var t=e.alternate;if(!t){if(t=Tc(e),t===null)throw Error(bt(188));return t!==e?null:e}for(var r=e,n=t;;){var i=r.return;if(i===null)break;var s=i.alternate;if(s===null){if(n=i.return,n!==null){r=n;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===r)return aC(i),e;if(s===n)return aC(i),t;s=s.sibling}throw Error(bt(188))}if(r.return!==n.return)r=i,n=s;else{for(var u=!1,a=i.child;a;){if(a===r){u=!0,r=i,n=s;break}if(a===n){u=!0,n=i,r=s;break}a=a.sibling}if(!u){for(a=s.child;a;){if(a===r){u=!0,r=s,n=i;break}if(a===n){u=!0,n=s,r=i;break}a=a.sibling}if(!u)throw Error(bt(189))}}if(r.alternate!==n)throw Error(bt(190))}if(r.tag!==3)throw Error(bt(188));return r.stateNode.current===r?e:t}function _M(e){return e=X5(e),e!==null?wM(e):null}function wM(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=wM(e);if(t!==null)return t;e=e.sibling}return null}var bM=Ba.unstable_scheduleCallback,sC=Ba.unstable_cancelCallback,K5=Ba.unstable_shouldYield,Y5=Ba.unstable_requestPaint,Rn=Ba.unstable_now,J5=Ba.unstable_getCurrentPriorityLevel,N2=Ba.unstable_ImmediatePriority,SM=Ba.unstable_UserBlockingPriority,wy=Ba.unstable_NormalPriority,Q5=Ba.unstable_LowPriority,EM=Ba.unstable_IdlePriority,m0=null,Ws=null;function e4(e){if(Ws&&typeof Ws.onCommitFiberRoot=="function")try{Ws.onCommitFiberRoot(m0,e,void 0,(e.current.flags&128)===128)}catch{}}var Es=Math.clz32?Math.clz32:n4,t4=Math.log,r4=Math.LN2;function n4(e){return e>>>=0,e===0?32:31-(t4(e)/r4|0)|0}var iv=64,av=4194304;function xp(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function by(e,t){var r=e.pendingLanes;if(r===0)return 0;var n=0,i=e.suspendedLanes,s=e.pingedLanes,u=r&268435455;if(u!==0){var a=u&~i;a!==0?n=xp(a):(s&=u,s!==0&&(n=xp(s)))}else u=r&~i,u!==0?n=xp(u):s!==0&&(n=xp(s));if(n===0)return 0;if(t!==0&&t!==n&&!(t&i)&&(i=n&-n,s=t&-t,i>=s||i===16&&(s&4194240)!==0))return t;if(n&4&&(n|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)r=31-Es(t),i=1<<r,n|=e[r],t&=~i;return n}function i4(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function a4(e,t){for(var r=e.suspendedLanes,n=e.pingedLanes,i=e.expirationTimes,s=e.pendingLanes;0<s;){var u=31-Es(s),a=1<<u,d=i[u];d===-1?(!(a&r)||a&n)&&(i[u]=i4(a,t)):d<=t&&(e.expiredLanes|=a),s&=~a}}function s1(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function TM(){var e=iv;return iv<<=1,!(iv&4194240)&&(iv=64),e}function A_(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function Am(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Es(t),e[t]=r}function s4(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<r;){var i=31-Es(r),s=1<<i;t[i]=0,n[i]=-1,e[i]=-1,r&=~s}}function z2(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var n=31-Es(r),i=1<<n;i&t|e[n]&t&&(e[n]|=t),r&=~i}}var Kr=0;function CM(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var kM,R2,PM,IM,AM,o1=!1,sv=[],Vl=null,Ul=null,ql=null,qp=new Map,Hp=new Map,Nl=[],o4="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function oC(e,t){switch(e){case"focusin":case"focusout":Vl=null;break;case"dragenter":case"dragleave":Ul=null;break;case"mouseover":case"mouseout":ql=null;break;case"pointerover":case"pointerout":qp.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Hp.delete(t.pointerId)}}function Kf(e,t,r,n,i,s){return e===null||e.nativeEvent!==s?(e={blockedOn:t,domEventName:r,eventSystemFlags:n,nativeEvent:s,targetContainers:[i]},t!==null&&(t=Dm(t),t!==null&&R2(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,i!==null&&t.indexOf(i)===-1&&t.push(i),e)}function l4(e,t,r,n,i){switch(t){case"focusin":return Vl=Kf(Vl,e,t,r,n,i),!0;case"dragenter":return Ul=Kf(Ul,e,t,r,n,i),!0;case"mouseover":return ql=Kf(ql,e,t,r,n,i),!0;case"pointerover":var s=i.pointerId;return qp.set(s,Kf(qp.get(s)||null,e,t,r,n,i)),!0;case"gotpointercapture":return s=i.pointerId,Hp.set(s,Kf(Hp.get(s)||null,e,t,r,n,i)),!0}return!1}function MM(e){var t=Qu(e.target);if(t!==null){var r=Tc(t);if(r!==null){if(t=r.tag,t===13){if(t=xM(r),t!==null){e.blockedOn=t,AM(e.priority,function(){PM(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Gv(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=l1(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var n=new r.constructor(r.type,r);r1=n,r.target.dispatchEvent(n),r1=null}else return t=Dm(r),t!==null&&R2(t),e.blockedOn=r,!1;t.shift()}return!0}function lC(e,t,r){Gv(e)&&r.delete(t)}function u4(){o1=!1,Vl!==null&&Gv(Vl)&&(Vl=null),Ul!==null&&Gv(Ul)&&(Ul=null),ql!==null&&Gv(ql)&&(ql=null),qp.forEach(lC),Hp.forEach(lC)}function Yf(e,t){e.blockedOn===t&&(e.blockedOn=null,o1||(o1=!0,Ba.unstable_scheduleCallback(Ba.unstable_NormalPriority,u4)))}function Gp(e){function t(i){return Yf(i,e)}if(0<sv.length){Yf(sv[0],e);for(var r=1;r<sv.length;r++){var n=sv[r];n.blockedOn===e&&(n.blockedOn=null)}}for(Vl!==null&&Yf(Vl,e),Ul!==null&&Yf(Ul,e),ql!==null&&Yf(ql,e),qp.forEach(t),Hp.forEach(t),r=0;r<Nl.length;r++)n=Nl[r],n.blockedOn===e&&(n.blockedOn=null);for(;0<Nl.length&&(r=Nl[0],r.blockedOn===null);)MM(r),r.blockedOn===null&&Nl.shift()}var sd=$o.ReactCurrentBatchConfig,Sy=!0;function c4(e,t,r,n){var i=Kr,s=sd.transition;sd.transition=null;try{Kr=1,L2(e,t,r,n)}finally{Kr=i,sd.transition=s}}function h4(e,t,r,n){var i=Kr,s=sd.transition;sd.transition=null;try{Kr=4,L2(e,t,r,n)}finally{Kr=i,sd.transition=s}}function L2(e,t,r,n){if(Sy){var i=l1(e,t,r,n);if(i===null)j_(e,t,n,Ey,r),oC(e,n);else if(l4(i,e,t,r,n))n.stopPropagation();else if(oC(e,n),t&4&&-1<o4.indexOf(e)){for(;i!==null;){var s=Dm(i);if(s!==null&&kM(s),s=l1(e,t,r,n),s===null&&j_(e,t,n,Ey,r),s===i)break;i=s}i!==null&&n.stopPropagation()}else j_(e,t,n,null,r)}}var Ey=null;function l1(e,t,r,n){if(Ey=null,e=D2(n),e=Qu(e),e!==null)if(t=Tc(e),t===null)e=null;else if(r=t.tag,r===13){if(e=xM(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Ey=e,null}function DM(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(J5()){case N2:return 1;case SM:return 4;case wy:case Q5:return 16;case EM:return 536870912;default:return 16}default:return 16}}var Ll=null,B2=null,Wv=null;function NM(){if(Wv)return Wv;var e,t=B2,r=t.length,n,i="value"in Ll?Ll.value:Ll.textContent,s=i.length;for(e=0;e<r&&t[e]===i[e];e++);var u=r-e;for(n=1;n<=u&&t[r-n]===i[s-n];n++);return Wv=i.slice(e,1<n?1-n:void 0)}function Zv(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function ov(){return!0}function uC(){return!1}function ja(e){function t(r,n,i,s,u){this._reactName=r,this._targetInst=i,this.type=n,this.nativeEvent=s,this.target=u,this.currentTarget=null;for(var a in e)e.hasOwnProperty(a)&&(r=e[a],this[a]=r?r(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?ov:uC,this.isPropagationStopped=uC,this}return kn(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=ov)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=ov)},persist:function(){},isPersistent:ov}),t}var Nd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},O2=ja(Nd),Mm=kn({},Nd,{view:0,detail:0}),d4=ja(Mm),M_,D_,Jf,g0=kn({},Mm,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:F2,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Jf&&(Jf&&e.type==="mousemove"?(M_=e.screenX-Jf.screenX,D_=e.screenY-Jf.screenY):D_=M_=0,Jf=e),M_)},movementY:function(e){return"movementY"in e?e.movementY:D_}}),cC=ja(g0),f4=kn({},g0,{dataTransfer:0}),p4=ja(f4),m4=kn({},Mm,{relatedTarget:0}),N_=ja(m4),g4=kn({},Nd,{animationName:0,elapsedTime:0,pseudoElement:0}),v4=ja(g4),y4=kn({},Nd,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),x4=ja(y4),_4=kn({},Nd,{data:0}),hC=ja(_4),w4={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},b4={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},S4={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function E4(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=S4[e])?!!t[e]:!1}function F2(){return E4}var T4=kn({},Mm,{key:function(e){if(e.key){var t=w4[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Zv(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?b4[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:F2,charCode:function(e){return e.type==="keypress"?Zv(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Zv(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),C4=ja(T4),k4=kn({},g0,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),dC=ja(k4),P4=kn({},Mm,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:F2}),I4=ja(P4),A4=kn({},Nd,{propertyName:0,elapsedTime:0,pseudoElement:0}),M4=ja(A4),D4=kn({},g0,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),N4=ja(D4),z4=[9,13,27,32],j2=No&&"CompositionEvent"in window,Ap=null;No&&"documentMode"in document&&(Ap=document.documentMode);var R4=No&&"TextEvent"in window&&!Ap,zM=No&&(!j2||Ap&&8<Ap&&11>=Ap),fC=" ",pC=!1;function RM(e,t){switch(e){case"keyup":return z4.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function LM(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Vh=!1;function L4(e,t){switch(e){case"compositionend":return LM(t);case"keypress":return t.which!==32?null:(pC=!0,fC);case"textInput":return e=t.data,e===fC&&pC?null:e;default:return null}}function B4(e,t){if(Vh)return e==="compositionend"||!j2&&RM(e,t)?(e=NM(),Wv=B2=Ll=null,Vh=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return zM&&t.locale!=="ko"?null:t.data;default:return null}}var O4={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function mC(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!O4[e.type]:t==="textarea"}function BM(e,t,r,n){pM(n),t=Ty(t,"onChange"),0<t.length&&(r=new O2("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var Mp=null,Wp=null;function F4(e){ZM(e,0)}function v0(e){var t=Hh(e);if(oM(t))return e}function j4(e,t){if(e==="change")return t}var OM=!1;if(No){var z_;if(No){var R_="oninput"in document;if(!R_){var gC=document.createElement("div");gC.setAttribute("oninput","return;"),R_=typeof gC.oninput=="function"}z_=R_}else z_=!1;OM=z_&&(!document.documentMode||9<document.documentMode)}function vC(){Mp&&(Mp.detachEvent("onpropertychange",FM),Wp=Mp=null)}function FM(e){if(e.propertyName==="value"&&v0(Wp)){var t=[];BM(t,Wp,e,D2(e)),yM(F4,t)}}function $4(e,t,r){e==="focusin"?(vC(),Mp=t,Wp=r,Mp.attachEvent("onpropertychange",FM)):e==="focusout"&&vC()}function V4(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return v0(Wp)}function U4(e,t){if(e==="click")return v0(t)}function q4(e,t){if(e==="input"||e==="change")return v0(t)}function H4(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Ps=typeof Object.is=="function"?Object.is:H4;function Zp(e,t){if(Ps(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var i=r[n];if(!qb.call(t,i)||!Ps(e[i],t[i]))return!1}return!0}function yC(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function xC(e,t){var r=yC(e);e=0;for(var n;r;){if(r.nodeType===3){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=yC(r)}}function jM(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?jM(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function $M(){for(var e=window,t=yy();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=yy(e.document)}return t}function $2(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function G4(e){var t=$M(),r=e.focusedElem,n=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&jM(r.ownerDocument.documentElement,r)){if(n!==null&&$2(r)){if(t=n.start,e=n.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var i=r.textContent.length,s=Math.min(n.start,i);n=n.end===void 0?s:Math.min(n.end,i),!e.extend&&s>n&&(i=n,n=s,s=i),i=xC(r,s);var u=xC(r,n);i&&u&&(e.rangeCount!==1||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==u.node||e.focusOffset!==u.offset)&&(t=t.createRange(),t.setStart(i.node,i.offset),e.removeAllRanges(),s>n?(e.addRange(t),e.extend(u.node,u.offset)):(t.setEnd(u.node,u.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var W4=No&&"documentMode"in document&&11>=document.documentMode,Uh=null,u1=null,Dp=null,c1=!1;function _C(e,t,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;c1||Uh==null||Uh!==yy(n)||(n=Uh,"selectionStart"in n&&$2(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Dp&&Zp(Dp,n)||(Dp=n,n=Ty(u1,"onSelect"),0<n.length&&(t=new O2("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=Uh)))}function lv(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var qh={animationend:lv("Animation","AnimationEnd"),animationiteration:lv("Animation","AnimationIteration"),animationstart:lv("Animation","AnimationStart"),transitionend:lv("Transition","TransitionEnd")},L_={},VM={};No&&(VM=document.createElement("div").style,"AnimationEvent"in window||(delete qh.animationend.animation,delete qh.animationiteration.animation,delete qh.animationstart.animation),"TransitionEvent"in window||delete qh.transitionend.transition);function y0(e){if(L_[e])return L_[e];if(!qh[e])return e;var t=qh[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in VM)return L_[e]=t[r];return e}var UM=y0("animationend"),qM=y0("animationiteration"),HM=y0("animationstart"),GM=y0("transitionend"),WM=new Map,wC="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function lu(e,t){WM.set(e,t),Ec(t,[e])}for(var B_=0;B_<wC.length;B_++){var O_=wC[B_],Z4=O_.toLowerCase(),X4=O_[0].toUpperCase()+O_.slice(1);lu(Z4,"on"+X4)}lu(UM,"onAnimationEnd");lu(qM,"onAnimationIteration");lu(HM,"onAnimationStart");lu("dblclick","onDoubleClick");lu("focusin","onFocus");lu("focusout","onBlur");lu(GM,"onTransitionEnd");vd("onMouseEnter",["mouseout","mouseover"]);vd("onMouseLeave",["mouseout","mouseover"]);vd("onPointerEnter",["pointerout","pointerover"]);vd("onPointerLeave",["pointerout","pointerover"]);Ec("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ec("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ec("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ec("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ec("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ec("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var _p="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),K4=new Set("cancel close invalid load scroll toggle".split(" ").concat(_p));function bC(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,Z5(n,t,void 0,e),e.currentTarget=null}function ZM(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var n=e[r],i=n.event;n=n.listeners;e:{var s=void 0;if(t)for(var u=n.length-1;0<=u;u--){var a=n[u],d=a.instance,p=a.currentTarget;if(a=a.listener,d!==s&&i.isPropagationStopped())break e;bC(i,a,p),s=d}else for(u=0;u<n.length;u++){if(a=n[u],d=a.instance,p=a.currentTarget,a=a.listener,d!==s&&i.isPropagationStopped())break e;bC(i,a,p),s=d}}}if(_y)throw e=a1,_y=!1,a1=null,e}function dn(e,t){var r=t[m1];r===void 0&&(r=t[m1]=new Set);var n=e+"__bubble";r.has(n)||(XM(t,e,2,!1),r.add(n))}function F_(e,t,r){var n=0;t&&(n|=4),XM(r,e,n,t)}var uv="_reactListening"+Math.random().toString(36).slice(2);function Xp(e){if(!e[uv]){e[uv]=!0,rM.forEach(function(r){r!=="selectionchange"&&(K4.has(r)||F_(r,!1,e),F_(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[uv]||(t[uv]=!0,F_("selectionchange",!1,t))}}function XM(e,t,r,n){switch(DM(t)){case 1:var i=c4;break;case 4:i=h4;break;default:i=L2}r=i.bind(null,t,r,e),i=void 0,!i1||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(i=!0),n?i!==void 0?e.addEventListener(t,r,{capture:!0,passive:i}):e.addEventListener(t,r,!0):i!==void 0?e.addEventListener(t,r,{passive:i}):e.addEventListener(t,r,!1)}function j_(e,t,r,n,i){var s=n;if(!(t&1)&&!(t&2)&&n!==null)e:for(;;){if(n===null)return;var u=n.tag;if(u===3||u===4){var a=n.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(u===4)for(u=n.return;u!==null;){var d=u.tag;if((d===3||d===4)&&(d=u.stateNode.containerInfo,d===i||d.nodeType===8&&d.parentNode===i))return;u=u.return}for(;a!==null;){if(u=Qu(a),u===null)return;if(d=u.tag,d===5||d===6){n=s=u;continue e}a=a.parentNode}}n=n.return}yM(function(){var p=s,g=D2(r),v=[];e:{var _=WM.get(e);if(_!==void 0){var b=O2,k=e;switch(e){case"keypress":if(Zv(r)===0)break e;case"keydown":case"keyup":b=C4;break;case"focusin":k="focus",b=N_;break;case"focusout":k="blur",b=N_;break;case"beforeblur":case"afterblur":b=N_;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":b=cC;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":b=p4;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":b=I4;break;case UM:case qM:case HM:b=v4;break;case GM:b=M4;break;case"scroll":b=d4;break;case"wheel":b=N4;break;case"copy":case"cut":case"paste":b=x4;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":b=dC}var A=(t&4)!==0,M=!A&&e==="scroll",P=A?_!==null?_+"Capture":null:_;A=[];for(var I=p,z;I!==null;){z=I;var O=z.stateNode;if(z.tag===5&&O!==null&&(z=O,P!==null&&(O=Up(I,P),O!=null&&A.push(Kp(I,O,z)))),M)break;I=I.return}0<A.length&&(_=new b(_,k,null,r,g),v.push({event:_,listeners:A}))}}if(!(t&7)){e:{if(_=e==="mouseover"||e==="pointerover",b=e==="mouseout"||e==="pointerout",_&&r!==r1&&(k=r.relatedTarget||r.fromElement)&&(Qu(k)||k[zo]))break e;if((b||_)&&(_=g.window===g?g:(_=g.ownerDocument)?_.defaultView||_.parentWindow:window,b?(k=r.relatedTarget||r.toElement,b=p,k=k?Qu(k):null,k!==null&&(M=Tc(k),k!==M||k.tag!==5&&k.tag!==6)&&(k=null)):(b=null,k=p),b!==k)){if(A=cC,O="onMouseLeave",P="onMouseEnter",I="mouse",(e==="pointerout"||e==="pointerover")&&(A=dC,O="onPointerLeave",P="onPointerEnter",I="pointer"),M=b==null?_:Hh(b),z=k==null?_:Hh(k),_=new A(O,I+"leave",b,r,g),_.target=M,_.relatedTarget=z,O=null,Qu(g)===p&&(A=new A(P,I+"enter",k,r,g),A.target=z,A.relatedTarget=M,O=A),M=O,b&&k)t:{for(A=b,P=k,I=0,z=A;z;z=Th(z))I++;for(z=0,O=P;O;O=Th(O))z++;for(;0<I-z;)A=Th(A),I--;for(;0<z-I;)P=Th(P),z--;for(;I--;){if(A===P||P!==null&&A===P.alternate)break t;A=Th(A),P=Th(P)}A=null}else A=null;b!==null&&SC(v,_,b,A,!1),k!==null&&M!==null&&SC(v,M,k,A,!0)}}e:{if(_=p?Hh(p):window,b=_.nodeName&&_.nodeName.toLowerCase(),b==="select"||b==="input"&&_.type==="file")var V=j4;else if(mC(_))if(OM)V=q4;else{V=V4;var U=$4}else(b=_.nodeName)&&b.toLowerCase()==="input"&&(_.type==="checkbox"||_.type==="radio")&&(V=U4);if(V&&(V=V(e,p))){BM(v,V,r,g);break e}U&&U(e,_,p),e==="focusout"&&(U=_._wrapperState)&&U.controlled&&_.type==="number"&&Yb(_,"number",_.value)}switch(U=p?Hh(p):window,e){case"focusin":(mC(U)||U.contentEditable==="true")&&(Uh=U,u1=p,Dp=null);break;case"focusout":Dp=u1=Uh=null;break;case"mousedown":c1=!0;break;case"contextmenu":case"mouseup":case"dragend":c1=!1,_C(v,r,g);break;case"selectionchange":if(W4)break;case"keydown":case"keyup":_C(v,r,g)}var $;if(j2)e:{switch(e){case"compositionstart":var G="onCompositionStart";break e;case"compositionend":G="onCompositionEnd";break e;case"compositionupdate":G="onCompositionUpdate";break e}G=void 0}else Vh?RM(e,r)&&(G="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(G="onCompositionStart");G&&(zM&&r.locale!=="ko"&&(Vh||G!=="onCompositionStart"?G==="onCompositionEnd"&&Vh&&($=NM()):(Ll=g,B2="value"in Ll?Ll.value:Ll.textContent,Vh=!0)),U=Ty(p,G),0<U.length&&(G=new hC(G,e,null,r,g),v.push({event:G,listeners:U}),$?G.data=$:($=LM(r),$!==null&&(G.data=$)))),($=R4?L4(e,r):B4(e,r))&&(p=Ty(p,"onBeforeInput"),0<p.length&&(g=new hC("onBeforeInput","beforeinput",null,r,g),v.push({event:g,listeners:p}),g.data=$))}ZM(v,t)})}function Kp(e,t,r){return{instance:e,listener:t,currentTarget:r}}function Ty(e,t){for(var r=t+"Capture",n=[];e!==null;){var i=e,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=Up(e,r),s!=null&&n.unshift(Kp(e,s,i)),s=Up(e,t),s!=null&&n.push(Kp(e,s,i))),e=e.return}return n}function Th(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function SC(e,t,r,n,i){for(var s=t._reactName,u=[];r!==null&&r!==n;){var a=r,d=a.alternate,p=a.stateNode;if(d!==null&&d===n)break;a.tag===5&&p!==null&&(a=p,i?(d=Up(r,s),d!=null&&u.unshift(Kp(r,d,a))):i||(d=Up(r,s),d!=null&&u.push(Kp(r,d,a)))),r=r.return}u.length!==0&&e.push({event:t,listeners:u})}var Y4=/\r\n?/g,J4=/\u0000|\uFFFD/g;function EC(e){return(typeof e=="string"?e:""+e).replace(Y4,`
`).replace(J4,"")}function cv(e,t,r){if(t=EC(t),EC(e)!==t&&r)throw Error(bt(425))}function Cy(){}var h1=null,d1=null;function f1(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var p1=typeof setTimeout=="function"?setTimeout:void 0,Q4=typeof clearTimeout=="function"?clearTimeout:void 0,TC=typeof Promise=="function"?Promise:void 0,eO=typeof queueMicrotask=="function"?queueMicrotask:typeof TC<"u"?function(e){return TC.resolve(null).then(e).catch(tO)}:p1;function tO(e){setTimeout(function(){throw e})}function $_(e,t){var r=t,n=0;do{var i=r.nextSibling;if(e.removeChild(r),i&&i.nodeType===8)if(r=i.data,r==="/$"){if(n===0){e.removeChild(i),Gp(t);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=i}while(r);Gp(t)}function Hl(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function CC(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var zd=Math.random().toString(36).slice(2),Hs="__reactFiber$"+zd,Yp="__reactProps$"+zd,zo="__reactContainer$"+zd,m1="__reactEvents$"+zd,rO="__reactListeners$"+zd,nO="__reactHandles$"+zd;function Qu(e){var t=e[Hs];if(t)return t;for(var r=e.parentNode;r;){if(t=r[zo]||r[Hs]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=CC(e);e!==null;){if(r=e[Hs])return r;e=CC(e)}return t}e=r,r=e.parentNode}return null}function Dm(e){return e=e[Hs]||e[zo],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Hh(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(bt(33))}function x0(e){return e[Yp]||null}var g1=[],Gh=-1;function uu(e){return{current:e}}function pn(e){0>Gh||(e.current=g1[Gh],g1[Gh]=null,Gh--)}function on(e,t){Gh++,g1[Gh]=e.current,e.current=t}var tu={},ji=uu(tu),xa=uu(!1),hc=tu;function yd(e,t){var r=e.type.contextTypes;if(!r)return tu;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in r)i[s]=t[s];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function _a(e){return e=e.childContextTypes,e!=null}function ky(){pn(xa),pn(ji)}function kC(e,t,r){if(ji.current!==tu)throw Error(bt(168));on(ji,t),on(xa,r)}function KM(e,t,r){var n=e.stateNode;if(t=t.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var i in n)if(!(i in t))throw Error(bt(108,$5(e)||"Unknown",i));return kn({},r,n)}function Py(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||tu,hc=ji.current,on(ji,e),on(xa,xa.current),!0}function PC(e,t,r){var n=e.stateNode;if(!n)throw Error(bt(169));r?(e=KM(e,t,hc),n.__reactInternalMemoizedMergedChildContext=e,pn(xa),pn(ji),on(ji,e)):pn(xa),on(xa,r)}var Eo=null,_0=!1,V_=!1;function YM(e){Eo===null?Eo=[e]:Eo.push(e)}function iO(e){_0=!0,YM(e)}function cu(){if(!V_&&Eo!==null){V_=!0;var e=0,t=Kr;try{var r=Eo;for(Kr=1;e<r.length;e++){var n=r[e];do n=n(!0);while(n!==null)}Eo=null,_0=!1}catch(i){throw Eo!==null&&(Eo=Eo.slice(e+1)),bM(N2,cu),i}finally{Kr=t,V_=!1}}return null}var Wh=[],Zh=0,Iy=null,Ay=0,Ja=[],Qa=0,dc=null,Co=1,ko="";function Hu(e,t){Wh[Zh++]=Ay,Wh[Zh++]=Iy,Iy=e,Ay=t}function JM(e,t,r){Ja[Qa++]=Co,Ja[Qa++]=ko,Ja[Qa++]=dc,dc=e;var n=Co;e=ko;var i=32-Es(n)-1;n&=~(1<<i),r+=1;var s=32-Es(t)+i;if(30<s){var u=i-i%5;s=(n&(1<<u)-1).toString(32),n>>=u,i-=u,Co=1<<32-Es(t)+i|r<<i|n,ko=s+e}else Co=1<<s|r<<i|n,ko=e}function V2(e){e.return!==null&&(Hu(e,1),JM(e,1,0))}function U2(e){for(;e===Iy;)Iy=Wh[--Zh],Wh[Zh]=null,Ay=Wh[--Zh],Wh[Zh]=null;for(;e===dc;)dc=Ja[--Qa],Ja[Qa]=null,ko=Ja[--Qa],Ja[Qa]=null,Co=Ja[--Qa],Ja[Qa]=null}var Ra=null,za=null,xn=!1,bs=null;function QM(e,t){var r=rs(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function IC(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Ra=e,za=Hl(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Ra=e,za=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=dc!==null?{id:Co,overflow:ko}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=rs(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,Ra=e,za=null,!0):!1;default:return!1}}function v1(e){return(e.mode&1)!==0&&(e.flags&128)===0}function y1(e){if(xn){var t=za;if(t){var r=t;if(!IC(e,t)){if(v1(e))throw Error(bt(418));t=Hl(r.nextSibling);var n=Ra;t&&IC(e,t)?QM(n,r):(e.flags=e.flags&-4097|2,xn=!1,Ra=e)}}else{if(v1(e))throw Error(bt(418));e.flags=e.flags&-4097|2,xn=!1,Ra=e}}}function AC(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Ra=e}function hv(e){if(e!==Ra)return!1;if(!xn)return AC(e),xn=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!f1(e.type,e.memoizedProps)),t&&(t=za)){if(v1(e))throw eD(),Error(bt(418));for(;t;)QM(e,t),t=Hl(t.nextSibling)}if(AC(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(bt(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){za=Hl(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}za=null}}else za=Ra?Hl(e.stateNode.nextSibling):null;return!0}function eD(){for(var e=za;e;)e=Hl(e.nextSibling)}function xd(){za=Ra=null,xn=!1}function q2(e){bs===null?bs=[e]:bs.push(e)}var aO=$o.ReactCurrentBatchConfig;function Qf(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(bt(309));var n=r.stateNode}if(!n)throw Error(bt(147,e));var i=n,s=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===s?t.ref:(t=function(u){var a=i.refs;u===null?delete a[s]:a[s]=u},t._stringRef=s,t)}if(typeof e!="string")throw Error(bt(284));if(!r._owner)throw Error(bt(290,e))}return e}function dv(e,t){throw e=Object.prototype.toString.call(t),Error(bt(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function MC(e){var t=e._init;return t(e._payload)}function tD(e){function t(P,I){if(e){var z=P.deletions;z===null?(P.deletions=[I],P.flags|=16):z.push(I)}}function r(P,I){if(!e)return null;for(;I!==null;)t(P,I),I=I.sibling;return null}function n(P,I){for(P=new Map;I!==null;)I.key!==null?P.set(I.key,I):P.set(I.index,I),I=I.sibling;return P}function i(P,I){return P=Xl(P,I),P.index=0,P.sibling=null,P}function s(P,I,z){return P.index=z,e?(z=P.alternate,z!==null?(z=z.index,z<I?(P.flags|=2,I):z):(P.flags|=2,I)):(P.flags|=1048576,I)}function u(P){return e&&P.alternate===null&&(P.flags|=2),P}function a(P,I,z,O){return I===null||I.tag!==6?(I=X_(z,P.mode,O),I.return=P,I):(I=i(I,z),I.return=P,I)}function d(P,I,z,O){var V=z.type;return V===$h?g(P,I,z.props.children,O,z.key):I!==null&&(I.elementType===V||typeof V=="object"&&V!==null&&V.$$typeof===kl&&MC(V)===I.type)?(O=i(I,z.props),O.ref=Qf(P,I,z),O.return=P,O):(O=ty(z.type,z.key,z.props,null,P.mode,O),O.ref=Qf(P,I,z),O.return=P,O)}function p(P,I,z,O){return I===null||I.tag!==4||I.stateNode.containerInfo!==z.containerInfo||I.stateNode.implementation!==z.implementation?(I=K_(z,P.mode,O),I.return=P,I):(I=i(I,z.children||[]),I.return=P,I)}function g(P,I,z,O,V){return I===null||I.tag!==7?(I=sc(z,P.mode,O,V),I.return=P,I):(I=i(I,z),I.return=P,I)}function v(P,I,z){if(typeof I=="string"&&I!==""||typeof I=="number")return I=X_(""+I,P.mode,z),I.return=P,I;if(typeof I=="object"&&I!==null){switch(I.$$typeof){case tv:return z=ty(I.type,I.key,I.props,null,P.mode,z),z.ref=Qf(P,null,I),z.return=P,z;case jh:return I=K_(I,P.mode,z),I.return=P,I;case kl:var O=I._init;return v(P,O(I._payload),z)}if(yp(I)||Zf(I))return I=sc(I,P.mode,z,null),I.return=P,I;dv(P,I)}return null}function _(P,I,z,O){var V=I!==null?I.key:null;if(typeof z=="string"&&z!==""||typeof z=="number")return V!==null?null:a(P,I,""+z,O);if(typeof z=="object"&&z!==null){switch(z.$$typeof){case tv:return z.key===V?d(P,I,z,O):null;case jh:return z.key===V?p(P,I,z,O):null;case kl:return V=z._init,_(P,I,V(z._payload),O)}if(yp(z)||Zf(z))return V!==null?null:g(P,I,z,O,null);dv(P,z)}return null}function b(P,I,z,O,V){if(typeof O=="string"&&O!==""||typeof O=="number")return P=P.get(z)||null,a(I,P,""+O,V);if(typeof O=="object"&&O!==null){switch(O.$$typeof){case tv:return P=P.get(O.key===null?z:O.key)||null,d(I,P,O,V);case jh:return P=P.get(O.key===null?z:O.key)||null,p(I,P,O,V);case kl:var U=O._init;return b(P,I,z,U(O._payload),V)}if(yp(O)||Zf(O))return P=P.get(z)||null,g(I,P,O,V,null);dv(I,O)}return null}function k(P,I,z,O){for(var V=null,U=null,$=I,G=I=0,Z=null;$!==null&&G<z.length;G++){$.index>G?(Z=$,$=null):Z=$.sibling;var Q=_(P,$,z[G],O);if(Q===null){$===null&&($=Z);break}e&&$&&Q.alternate===null&&t(P,$),I=s(Q,I,G),U===null?V=Q:U.sibling=Q,U=Q,$=Z}if(G===z.length)return r(P,$),xn&&Hu(P,G),V;if($===null){for(;G<z.length;G++)$=v(P,z[G],O),$!==null&&(I=s($,I,G),U===null?V=$:U.sibling=$,U=$);return xn&&Hu(P,G),V}for($=n(P,$);G<z.length;G++)Z=b($,P,G,z[G],O),Z!==null&&(e&&Z.alternate!==null&&$.delete(Z.key===null?G:Z.key),I=s(Z,I,G),U===null?V=Z:U.sibling=Z,U=Z);return e&&$.forEach(function(X){return t(P,X)}),xn&&Hu(P,G),V}function A(P,I,z,O){var V=Zf(z);if(typeof V!="function")throw Error(bt(150));if(z=V.call(z),z==null)throw Error(bt(151));for(var U=V=null,$=I,G=I=0,Z=null,Q=z.next();$!==null&&!Q.done;G++,Q=z.next()){$.index>G?(Z=$,$=null):Z=$.sibling;var X=_(P,$,Q.value,O);if(X===null){$===null&&($=Z);break}e&&$&&X.alternate===null&&t(P,$),I=s(X,I,G),U===null?V=X:U.sibling=X,U=X,$=Z}if(Q.done)return r(P,$),xn&&Hu(P,G),V;if($===null){for(;!Q.done;G++,Q=z.next())Q=v(P,Q.value,O),Q!==null&&(I=s(Q,I,G),U===null?V=Q:U.sibling=Q,U=Q);return xn&&Hu(P,G),V}for($=n(P,$);!Q.done;G++,Q=z.next())Q=b($,P,G,Q.value,O),Q!==null&&(e&&Q.alternate!==null&&$.delete(Q.key===null?G:Q.key),I=s(Q,I,G),U===null?V=Q:U.sibling=Q,U=Q);return e&&$.forEach(function(ie){return t(P,ie)}),xn&&Hu(P,G),V}function M(P,I,z,O){if(typeof z=="object"&&z!==null&&z.type===$h&&z.key===null&&(z=z.props.children),typeof z=="object"&&z!==null){switch(z.$$typeof){case tv:e:{for(var V=z.key,U=I;U!==null;){if(U.key===V){if(V=z.type,V===$h){if(U.tag===7){r(P,U.sibling),I=i(U,z.props.children),I.return=P,P=I;break e}}else if(U.elementType===V||typeof V=="object"&&V!==null&&V.$$typeof===kl&&MC(V)===U.type){r(P,U.sibling),I=i(U,z.props),I.ref=Qf(P,U,z),I.return=P,P=I;break e}r(P,U);break}else t(P,U);U=U.sibling}z.type===$h?(I=sc(z.props.children,P.mode,O,z.key),I.return=P,P=I):(O=ty(z.type,z.key,z.props,null,P.mode,O),O.ref=Qf(P,I,z),O.return=P,P=O)}return u(P);case jh:e:{for(U=z.key;I!==null;){if(I.key===U)if(I.tag===4&&I.stateNode.containerInfo===z.containerInfo&&I.stateNode.implementation===z.implementation){r(P,I.sibling),I=i(I,z.children||[]),I.return=P,P=I;break e}else{r(P,I);break}else t(P,I);I=I.sibling}I=K_(z,P.mode,O),I.return=P,P=I}return u(P);case kl:return U=z._init,M(P,I,U(z._payload),O)}if(yp(z))return k(P,I,z,O);if(Zf(z))return A(P,I,z,O);dv(P,z)}return typeof z=="string"&&z!==""||typeof z=="number"?(z=""+z,I!==null&&I.tag===6?(r(P,I.sibling),I=i(I,z),I.return=P,P=I):(r(P,I),I=X_(z,P.mode,O),I.return=P,P=I),u(P)):r(P,I)}return M}var _d=tD(!0),rD=tD(!1),My=uu(null),Dy=null,Xh=null,H2=null;function G2(){H2=Xh=Dy=null}function W2(e){var t=My.current;pn(My),e._currentValue=t}function x1(e,t,r){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===r)break;e=e.return}}function od(e,t){Dy=e,H2=Xh=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(ga=!0),e.firstContext=null)}function ss(e){var t=e._currentValue;if(H2!==e)if(e={context:e,memoizedValue:t,next:null},Xh===null){if(Dy===null)throw Error(bt(308));Xh=e,Dy.dependencies={lanes:0,firstContext:e}}else Xh=Xh.next=e;return t}var ec=null;function Z2(e){ec===null?ec=[e]:ec.push(e)}function nD(e,t,r,n){var i=t.interleaved;return i===null?(r.next=r,Z2(t)):(r.next=i.next,i.next=r),t.interleaved=r,Ro(e,n)}function Ro(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var Pl=!1;function X2(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function iD(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Mo(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Gl(e,t,r){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,Or&2){var i=n.pending;return i===null?t.next=t:(t.next=i.next,i.next=t),n.pending=t,Ro(e,r)}return i=n.interleaved,i===null?(t.next=t,Z2(n)):(t.next=i.next,i.next=t),n.interleaved=t,Ro(e,r)}function Xv(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,z2(e,r)}}function DC(e,t){var r=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var i=null,s=null;if(r=r.firstBaseUpdate,r!==null){do{var u={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};s===null?i=s=u:s=s.next=u,r=r.next}while(r!==null);s===null?i=s=t:s=s.next=t}else i=s=t;r={baseState:n.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:n.shared,effects:n.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function Ny(e,t,r,n){var i=e.updateQueue;Pl=!1;var s=i.firstBaseUpdate,u=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var d=a,p=d.next;d.next=null,u===null?s=p:u.next=p,u=d;var g=e.alternate;g!==null&&(g=g.updateQueue,a=g.lastBaseUpdate,a!==u&&(a===null?g.firstBaseUpdate=p:a.next=p,g.lastBaseUpdate=d))}if(s!==null){var v=i.baseState;u=0,g=p=d=null,a=s;do{var _=a.lane,b=a.eventTime;if((n&_)===_){g!==null&&(g=g.next={eventTime:b,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var k=e,A=a;switch(_=t,b=r,A.tag){case 1:if(k=A.payload,typeof k=="function"){v=k.call(b,v,_);break e}v=k;break e;case 3:k.flags=k.flags&-65537|128;case 0:if(k=A.payload,_=typeof k=="function"?k.call(b,v,_):k,_==null)break e;v=kn({},v,_);break e;case 2:Pl=!0}}a.callback!==null&&a.lane!==0&&(e.flags|=64,_=i.effects,_===null?i.effects=[a]:_.push(a))}else b={eventTime:b,lane:_,tag:a.tag,payload:a.payload,callback:a.callback,next:null},g===null?(p=g=b,d=v):g=g.next=b,u|=_;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;_=a,a=_.next,_.next=null,i.lastBaseUpdate=_,i.shared.pending=null}}while(!0);if(g===null&&(d=v),i.baseState=d,i.firstBaseUpdate=p,i.lastBaseUpdate=g,t=i.shared.interleaved,t!==null){i=t;do u|=i.lane,i=i.next;while(i!==t)}else s===null&&(i.shared.lanes=0);pc|=u,e.lanes=u,e.memoizedState=v}}function NC(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],i=n.callback;if(i!==null){if(n.callback=null,n=r,typeof i!="function")throw Error(bt(191,i));i.call(n)}}}var Nm={},Zs=uu(Nm),Jp=uu(Nm),Qp=uu(Nm);function tc(e){if(e===Nm)throw Error(bt(174));return e}function K2(e,t){switch(on(Qp,t),on(Jp,e),on(Zs,Nm),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Qb(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Qb(t,e)}pn(Zs),on(Zs,t)}function wd(){pn(Zs),pn(Jp),pn(Qp)}function aD(e){tc(Qp.current);var t=tc(Zs.current),r=Qb(t,e.type);t!==r&&(on(Jp,e),on(Zs,r))}function Y2(e){Jp.current===e&&(pn(Zs),pn(Jp))}var En=uu(0);function zy(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var U_=[];function J2(){for(var e=0;e<U_.length;e++)U_[e]._workInProgressVersionPrimary=null;U_.length=0}var Kv=$o.ReactCurrentDispatcher,q_=$o.ReactCurrentBatchConfig,fc=0,Tn=null,Xn=null,hi=null,Ry=!1,Np=!1,em=0,sO=0;function Bi(){throw Error(bt(321))}function Q2(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!Ps(e[r],t[r]))return!1;return!0}function eS(e,t,r,n,i,s){if(fc=s,Tn=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Kv.current=e===null||e.memoizedState===null?cO:hO,e=r(n,i),Np){s=0;do{if(Np=!1,em=0,25<=s)throw Error(bt(301));s+=1,hi=Xn=null,t.updateQueue=null,Kv.current=dO,e=r(n,i)}while(Np)}if(Kv.current=Ly,t=Xn!==null&&Xn.next!==null,fc=0,hi=Xn=Tn=null,Ry=!1,t)throw Error(bt(300));return e}function tS(){var e=em!==0;return em=0,e}function qs(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return hi===null?Tn.memoizedState=hi=e:hi=hi.next=e,hi}function os(){if(Xn===null){var e=Tn.alternate;e=e!==null?e.memoizedState:null}else e=Xn.next;var t=hi===null?Tn.memoizedState:hi.next;if(t!==null)hi=t,Xn=e;else{if(e===null)throw Error(bt(310));Xn=e,e={memoizedState:Xn.memoizedState,baseState:Xn.baseState,baseQueue:Xn.baseQueue,queue:Xn.queue,next:null},hi===null?Tn.memoizedState=hi=e:hi=hi.next=e}return hi}function tm(e,t){return typeof t=="function"?t(e):t}function H_(e){var t=os(),r=t.queue;if(r===null)throw Error(bt(311));r.lastRenderedReducer=e;var n=Xn,i=n.baseQueue,s=r.pending;if(s!==null){if(i!==null){var u=i.next;i.next=s.next,s.next=u}n.baseQueue=i=s,r.pending=null}if(i!==null){s=i.next,n=n.baseState;var a=u=null,d=null,p=s;do{var g=p.lane;if((fc&g)===g)d!==null&&(d=d.next={lane:0,action:p.action,hasEagerState:p.hasEagerState,eagerState:p.eagerState,next:null}),n=p.hasEagerState?p.eagerState:e(n,p.action);else{var v={lane:g,action:p.action,hasEagerState:p.hasEagerState,eagerState:p.eagerState,next:null};d===null?(a=d=v,u=n):d=d.next=v,Tn.lanes|=g,pc|=g}p=p.next}while(p!==null&&p!==s);d===null?u=n:d.next=a,Ps(n,t.memoizedState)||(ga=!0),t.memoizedState=n,t.baseState=u,t.baseQueue=d,r.lastRenderedState=n}if(e=r.interleaved,e!==null){i=e;do s=i.lane,Tn.lanes|=s,pc|=s,i=i.next;while(i!==e)}else i===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function G_(e){var t=os(),r=t.queue;if(r===null)throw Error(bt(311));r.lastRenderedReducer=e;var n=r.dispatch,i=r.pending,s=t.memoizedState;if(i!==null){r.pending=null;var u=i=i.next;do s=e(s,u.action),u=u.next;while(u!==i);Ps(s,t.memoizedState)||(ga=!0),t.memoizedState=s,t.baseQueue===null&&(t.baseState=s),r.lastRenderedState=s}return[s,n]}function sD(){}function oD(e,t){var r=Tn,n=os(),i=t(),s=!Ps(n.memoizedState,i);if(s&&(n.memoizedState=i,ga=!0),n=n.queue,rS(cD.bind(null,r,n,e),[e]),n.getSnapshot!==t||s||hi!==null&&hi.memoizedState.tag&1){if(r.flags|=2048,rm(9,uD.bind(null,r,n,i,t),void 0,null),di===null)throw Error(bt(349));fc&30||lD(r,t,i)}return i}function lD(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=Tn.updateQueue,t===null?(t={lastEffect:null,stores:null},Tn.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function uD(e,t,r,n){t.value=r,t.getSnapshot=n,hD(t)&&dD(e)}function cD(e,t,r){return r(function(){hD(t)&&dD(e)})}function hD(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!Ps(e,r)}catch{return!0}}function dD(e){var t=Ro(e,1);t!==null&&Ts(t,e,1,-1)}function zC(e){var t=qs();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:tm,lastRenderedState:e},t.queue=e,e=e.dispatch=uO.bind(null,Tn,e),[t.memoizedState,e]}function rm(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},t=Tn.updateQueue,t===null?(t={lastEffect:null,stores:null},Tn.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e)),e}function fD(){return os().memoizedState}function Yv(e,t,r,n){var i=qs();Tn.flags|=e,i.memoizedState=rm(1|t,r,void 0,n===void 0?null:n)}function w0(e,t,r,n){var i=os();n=n===void 0?null:n;var s=void 0;if(Xn!==null){var u=Xn.memoizedState;if(s=u.destroy,n!==null&&Q2(n,u.deps)){i.memoizedState=rm(t,r,s,n);return}}Tn.flags|=e,i.memoizedState=rm(1|t,r,s,n)}function RC(e,t){return Yv(8390656,8,e,t)}function rS(e,t){return w0(2048,8,e,t)}function pD(e,t){return w0(4,2,e,t)}function mD(e,t){return w0(4,4,e,t)}function gD(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function vD(e,t,r){return r=r!=null?r.concat([e]):null,w0(4,4,gD.bind(null,t,e),r)}function nS(){}function yD(e,t){var r=os();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&Q2(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function xD(e,t){var r=os();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&Q2(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function _D(e,t,r){return fc&21?(Ps(r,t)||(r=TM(),Tn.lanes|=r,pc|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,ga=!0),e.memoizedState=r)}function oO(e,t){var r=Kr;Kr=r!==0&&4>r?r:4,e(!0);var n=q_.transition;q_.transition={};try{e(!1),t()}finally{Kr=r,q_.transition=n}}function wD(){return os().memoizedState}function lO(e,t,r){var n=Zl(e);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},bD(e))SD(t,r);else if(r=nD(e,t,r,n),r!==null){var i=ea();Ts(r,e,n,i),ED(r,t,n)}}function uO(e,t,r){var n=Zl(e),i={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(bD(e))SD(t,i);else{var s=e.alternate;if(e.lanes===0&&(s===null||s.lanes===0)&&(s=t.lastRenderedReducer,s!==null))try{var u=t.lastRenderedState,a=s(u,r);if(i.hasEagerState=!0,i.eagerState=a,Ps(a,u)){var d=t.interleaved;d===null?(i.next=i,Z2(t)):(i.next=d.next,d.next=i),t.interleaved=i;return}}catch{}finally{}r=nD(e,t,i,n),r!==null&&(i=ea(),Ts(r,e,n,i),ED(r,t,n))}}function bD(e){var t=e.alternate;return e===Tn||t!==null&&t===Tn}function SD(e,t){Np=Ry=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function ED(e,t,r){if(r&4194240){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,z2(e,r)}}var Ly={readContext:ss,useCallback:Bi,useContext:Bi,useEffect:Bi,useImperativeHandle:Bi,useInsertionEffect:Bi,useLayoutEffect:Bi,useMemo:Bi,useReducer:Bi,useRef:Bi,useState:Bi,useDebugValue:Bi,useDeferredValue:Bi,useTransition:Bi,useMutableSource:Bi,useSyncExternalStore:Bi,useId:Bi,unstable_isNewReconciler:!1},cO={readContext:ss,useCallback:function(e,t){return qs().memoizedState=[e,t===void 0?null:t],e},useContext:ss,useEffect:RC,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,Yv(4194308,4,gD.bind(null,t,e),r)},useLayoutEffect:function(e,t){return Yv(4194308,4,e,t)},useInsertionEffect:function(e,t){return Yv(4,2,e,t)},useMemo:function(e,t){var r=qs();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=qs();return t=r!==void 0?r(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=lO.bind(null,Tn,e),[n.memoizedState,e]},useRef:function(e){var t=qs();return e={current:e},t.memoizedState=e},useState:zC,useDebugValue:nS,useDeferredValue:function(e){return qs().memoizedState=e},useTransition:function(){var e=zC(!1),t=e[0];return e=oO.bind(null,e[1]),qs().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var n=Tn,i=qs();if(xn){if(r===void 0)throw Error(bt(407));r=r()}else{if(r=t(),di===null)throw Error(bt(349));fc&30||lD(n,t,r)}i.memoizedState=r;var s={value:r,getSnapshot:t};return i.queue=s,RC(cD.bind(null,n,s,e),[e]),n.flags|=2048,rm(9,uD.bind(null,n,s,r,t),void 0,null),r},useId:function(){var e=qs(),t=di.identifierPrefix;if(xn){var r=ko,n=Co;r=(n&~(1<<32-Es(n)-1)).toString(32)+r,t=":"+t+"R"+r,r=em++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=sO++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},hO={readContext:ss,useCallback:yD,useContext:ss,useEffect:rS,useImperativeHandle:vD,useInsertionEffect:pD,useLayoutEffect:mD,useMemo:xD,useReducer:H_,useRef:fD,useState:function(){return H_(tm)},useDebugValue:nS,useDeferredValue:function(e){var t=os();return _D(t,Xn.memoizedState,e)},useTransition:function(){var e=H_(tm)[0],t=os().memoizedState;return[e,t]},useMutableSource:sD,useSyncExternalStore:oD,useId:wD,unstable_isNewReconciler:!1},dO={readContext:ss,useCallback:yD,useContext:ss,useEffect:rS,useImperativeHandle:vD,useInsertionEffect:pD,useLayoutEffect:mD,useMemo:xD,useReducer:G_,useRef:fD,useState:function(){return G_(tm)},useDebugValue:nS,useDeferredValue:function(e){var t=os();return Xn===null?t.memoizedState=e:_D(t,Xn.memoizedState,e)},useTransition:function(){var e=G_(tm)[0],t=os().memoizedState;return[e,t]},useMutableSource:sD,useSyncExternalStore:oD,useId:wD,unstable_isNewReconciler:!1};function ys(e,t){if(e&&e.defaultProps){t=kn({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function _1(e,t,r,n){t=e.memoizedState,r=r(n,t),r=r==null?t:kn({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var b0={isMounted:function(e){return(e=e._reactInternals)?Tc(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=ea(),i=Zl(e),s=Mo(n,i);s.payload=t,r!=null&&(s.callback=r),t=Gl(e,s,i),t!==null&&(Ts(t,e,i,n),Xv(t,e,i))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=ea(),i=Zl(e),s=Mo(n,i);s.tag=1,s.payload=t,r!=null&&(s.callback=r),t=Gl(e,s,i),t!==null&&(Ts(t,e,i,n),Xv(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=ea(),n=Zl(e),i=Mo(r,n);i.tag=2,t!=null&&(i.callback=t),t=Gl(e,i,n),t!==null&&(Ts(t,e,n,r),Xv(t,e,n))}};function LC(e,t,r,n,i,s,u){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,s,u):t.prototype&&t.prototype.isPureReactComponent?!Zp(r,n)||!Zp(i,s):!0}function TD(e,t,r){var n=!1,i=tu,s=t.contextType;return typeof s=="object"&&s!==null?s=ss(s):(i=_a(t)?hc:ji.current,n=t.contextTypes,s=(n=n!=null)?yd(e,i):tu),t=new t(r,s),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=b0,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=s),t}function BC(e,t,r,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&b0.enqueueReplaceState(t,t.state,null)}function w1(e,t,r,n){var i=e.stateNode;i.props=r,i.state=e.memoizedState,i.refs={},X2(e);var s=t.contextType;typeof s=="object"&&s!==null?i.context=ss(s):(s=_a(t)?hc:ji.current,i.context=yd(e,s)),i.state=e.memoizedState,s=t.getDerivedStateFromProps,typeof s=="function"&&(_1(e,t,s,r),i.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(t=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),t!==i.state&&b0.enqueueReplaceState(i,i.state,null),Ny(e,r,i,n),i.state=e.memoizedState),typeof i.componentDidMount=="function"&&(e.flags|=4194308)}function bd(e,t){try{var r="",n=t;do r+=j5(n),n=n.return;while(n);var i=r}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:e,source:t,stack:i,digest:null}}function W_(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function b1(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var fO=typeof WeakMap=="function"?WeakMap:Map;function CD(e,t,r){r=Mo(-1,r),r.tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){Oy||(Oy=!0,D1=n),b1(e,t)},r}function kD(e,t,r){r=Mo(-1,r),r.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var i=t.value;r.payload=function(){return n(i)},r.callback=function(){b1(e,t)}}var s=e.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(r.callback=function(){b1(e,t),typeof n!="function"&&(Wl===null?Wl=new Set([this]):Wl.add(this));var u=t.stack;this.componentDidCatch(t.value,{componentStack:u!==null?u:""})}),r}function OC(e,t,r){var n=e.pingCache;if(n===null){n=e.pingCache=new fO;var i=new Set;n.set(t,i)}else i=n.get(t),i===void 0&&(i=new Set,n.set(t,i));i.has(r)||(i.add(r),e=kO.bind(null,e,t,r),t.then(e,e))}function FC(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function jC(e,t,r,n,i){return e.mode&1?(e.flags|=65536,e.lanes=i,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=Mo(-1,1),t.tag=2,Gl(r,t,1))),r.lanes|=1),e)}var pO=$o.ReactCurrentOwner,ga=!1;function Qi(e,t,r,n){t.child=e===null?rD(t,null,r,n):_d(t,e.child,r,n)}function $C(e,t,r,n,i){r=r.render;var s=t.ref;return od(t,i),n=eS(e,t,r,n,s,i),r=tS(),e!==null&&!ga?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Lo(e,t,i)):(xn&&r&&V2(t),t.flags|=1,Qi(e,t,n,i),t.child)}function VC(e,t,r,n,i){if(e===null){var s=r.type;return typeof s=="function"&&!hS(s)&&s.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=s,PD(e,t,s,n,i)):(e=ty(r.type,null,n,t,t.mode,i),e.ref=t.ref,e.return=t,t.child=e)}if(s=e.child,!(e.lanes&i)){var u=s.memoizedProps;if(r=r.compare,r=r!==null?r:Zp,r(u,n)&&e.ref===t.ref)return Lo(e,t,i)}return t.flags|=1,e=Xl(s,n),e.ref=t.ref,e.return=t,t.child=e}function PD(e,t,r,n,i){if(e!==null){var s=e.memoizedProps;if(Zp(s,n)&&e.ref===t.ref)if(ga=!1,t.pendingProps=n=s,(e.lanes&i)!==0)e.flags&131072&&(ga=!0);else return t.lanes=e.lanes,Lo(e,t,i)}return S1(e,t,r,n,i)}function ID(e,t,r){var n=t.pendingProps,i=n.children,s=e!==null?e.memoizedState:null;if(n.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},on(Yh,Da),Da|=r;else{if(!(r&1073741824))return e=s!==null?s.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,on(Yh,Da),Da|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=s!==null?s.baseLanes:r,on(Yh,Da),Da|=n}else s!==null?(n=s.baseLanes|r,t.memoizedState=null):n=r,on(Yh,Da),Da|=n;return Qi(e,t,i,r),t.child}function AD(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function S1(e,t,r,n,i){var s=_a(r)?hc:ji.current;return s=yd(t,s),od(t,i),r=eS(e,t,r,n,s,i),n=tS(),e!==null&&!ga?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Lo(e,t,i)):(xn&&n&&V2(t),t.flags|=1,Qi(e,t,r,i),t.child)}function UC(e,t,r,n,i){if(_a(r)){var s=!0;Py(t)}else s=!1;if(od(t,i),t.stateNode===null)Jv(e,t),TD(t,r,n),w1(t,r,n,i),n=!0;else if(e===null){var u=t.stateNode,a=t.memoizedProps;u.props=a;var d=u.context,p=r.contextType;typeof p=="object"&&p!==null?p=ss(p):(p=_a(r)?hc:ji.current,p=yd(t,p));var g=r.getDerivedStateFromProps,v=typeof g=="function"||typeof u.getSnapshotBeforeUpdate=="function";v||typeof u.UNSAFE_componentWillReceiveProps!="function"&&typeof u.componentWillReceiveProps!="function"||(a!==n||d!==p)&&BC(t,u,n,p),Pl=!1;var _=t.memoizedState;u.state=_,Ny(t,n,u,i),d=t.memoizedState,a!==n||_!==d||xa.current||Pl?(typeof g=="function"&&(_1(t,r,g,n),d=t.memoizedState),(a=Pl||LC(t,r,a,n,_,d,p))?(v||typeof u.UNSAFE_componentWillMount!="function"&&typeof u.componentWillMount!="function"||(typeof u.componentWillMount=="function"&&u.componentWillMount(),typeof u.UNSAFE_componentWillMount=="function"&&u.UNSAFE_componentWillMount()),typeof u.componentDidMount=="function"&&(t.flags|=4194308)):(typeof u.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=d),u.props=n,u.state=d,u.context=p,n=a):(typeof u.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{u=t.stateNode,iD(e,t),a=t.memoizedProps,p=t.type===t.elementType?a:ys(t.type,a),u.props=p,v=t.pendingProps,_=u.context,d=r.contextType,typeof d=="object"&&d!==null?d=ss(d):(d=_a(r)?hc:ji.current,d=yd(t,d));var b=r.getDerivedStateFromProps;(g=typeof b=="function"||typeof u.getSnapshotBeforeUpdate=="function")||typeof u.UNSAFE_componentWillReceiveProps!="function"&&typeof u.componentWillReceiveProps!="function"||(a!==v||_!==d)&&BC(t,u,n,d),Pl=!1,_=t.memoizedState,u.state=_,Ny(t,n,u,i);var k=t.memoizedState;a!==v||_!==k||xa.current||Pl?(typeof b=="function"&&(_1(t,r,b,n),k=t.memoizedState),(p=Pl||LC(t,r,p,n,_,k,d)||!1)?(g||typeof u.UNSAFE_componentWillUpdate!="function"&&typeof u.componentWillUpdate!="function"||(typeof u.componentWillUpdate=="function"&&u.componentWillUpdate(n,k,d),typeof u.UNSAFE_componentWillUpdate=="function"&&u.UNSAFE_componentWillUpdate(n,k,d)),typeof u.componentDidUpdate=="function"&&(t.flags|=4),typeof u.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof u.componentDidUpdate!="function"||a===e.memoizedProps&&_===e.memoizedState||(t.flags|=4),typeof u.getSnapshotBeforeUpdate!="function"||a===e.memoizedProps&&_===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=k),u.props=n,u.state=k,u.context=d,n=p):(typeof u.componentDidUpdate!="function"||a===e.memoizedProps&&_===e.memoizedState||(t.flags|=4),typeof u.getSnapshotBeforeUpdate!="function"||a===e.memoizedProps&&_===e.memoizedState||(t.flags|=1024),n=!1)}return E1(e,t,r,n,s,i)}function E1(e,t,r,n,i,s){AD(e,t);var u=(t.flags&128)!==0;if(!n&&!u)return i&&PC(t,r,!1),Lo(e,t,s);n=t.stateNode,pO.current=t;var a=u&&typeof r.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&u?(t.child=_d(t,e.child,null,s),t.child=_d(t,null,a,s)):Qi(e,t,a,s),t.memoizedState=n.state,i&&PC(t,r,!0),t.child}function MD(e){var t=e.stateNode;t.pendingContext?kC(e,t.pendingContext,t.pendingContext!==t.context):t.context&&kC(e,t.context,!1),K2(e,t.containerInfo)}function qC(e,t,r,n,i){return xd(),q2(i),t.flags|=256,Qi(e,t,r,n),t.child}var T1={dehydrated:null,treeContext:null,retryLane:0};function C1(e){return{baseLanes:e,cachePool:null,transitions:null}}function DD(e,t,r){var n=t.pendingProps,i=En.current,s=!1,u=(t.flags&128)!==0,a;if((a=u)||(a=e!==null&&e.memoizedState===null?!1:(i&2)!==0),a?(s=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(i|=1),on(En,i&1),e===null)return y1(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(u=n.children,e=n.fallback,s?(n=t.mode,s=t.child,u={mode:"hidden",children:u},!(n&1)&&s!==null?(s.childLanes=0,s.pendingProps=u):s=T0(u,n,0,null),e=sc(e,n,r,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=C1(r),t.memoizedState=T1,e):iS(t,u));if(i=e.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return mO(e,t,u,n,a,i,r);if(s){s=n.fallback,u=t.mode,i=e.child,a=i.sibling;var d={mode:"hidden",children:n.children};return!(u&1)&&t.child!==i?(n=t.child,n.childLanes=0,n.pendingProps=d,t.deletions=null):(n=Xl(i,d),n.subtreeFlags=i.subtreeFlags&14680064),a!==null?s=Xl(a,s):(s=sc(s,u,r,null),s.flags|=2),s.return=t,n.return=t,n.sibling=s,t.child=n,n=s,s=t.child,u=e.child.memoizedState,u=u===null?C1(r):{baseLanes:u.baseLanes|r,cachePool:null,transitions:u.transitions},s.memoizedState=u,s.childLanes=e.childLanes&~r,t.memoizedState=T1,n}return s=e.child,e=s.sibling,n=Xl(s,{mode:"visible",children:n.children}),!(t.mode&1)&&(n.lanes=r),n.return=t,n.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n}function iS(e,t){return t=T0({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function fv(e,t,r,n){return n!==null&&q2(n),_d(t,e.child,null,r),e=iS(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function mO(e,t,r,n,i,s,u){if(r)return t.flags&256?(t.flags&=-257,n=W_(Error(bt(422))),fv(e,t,u,n)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(s=n.fallback,i=t.mode,n=T0({mode:"visible",children:n.children},i,0,null),s=sc(s,i,u,null),s.flags|=2,n.return=t,s.return=t,n.sibling=s,t.child=n,t.mode&1&&_d(t,e.child,null,u),t.child.memoizedState=C1(u),t.memoizedState=T1,s);if(!(t.mode&1))return fv(e,t,u,null);if(i.data==="$!"){if(n=i.nextSibling&&i.nextSibling.dataset,n)var a=n.dgst;return n=a,s=Error(bt(419)),n=W_(s,n,void 0),fv(e,t,u,n)}if(a=(u&e.childLanes)!==0,ga||a){if(n=di,n!==null){switch(u&-u){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(n.suspendedLanes|u)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,Ro(e,i),Ts(n,e,i,-1))}return cS(),n=W_(Error(bt(421))),fv(e,t,u,n)}return i.data==="$?"?(t.flags|=128,t.child=e.child,t=PO.bind(null,e),i._reactRetry=t,null):(e=s.treeContext,za=Hl(i.nextSibling),Ra=t,xn=!0,bs=null,e!==null&&(Ja[Qa++]=Co,Ja[Qa++]=ko,Ja[Qa++]=dc,Co=e.id,ko=e.overflow,dc=t),t=iS(t,n.children),t.flags|=4096,t)}function HC(e,t,r){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),x1(e.return,t,r)}function Z_(e,t,r,n,i){var s=e.memoizedState;s===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:i}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=n,s.tail=r,s.tailMode=i)}function ND(e,t,r){var n=t.pendingProps,i=n.revealOrder,s=n.tail;if(Qi(e,t,n.children,r),n=En.current,n&2)n=n&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&HC(e,r,t);else if(e.tag===19)HC(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(on(En,n),!(t.mode&1))t.memoizedState=null;else switch(i){case"forwards":for(r=t.child,i=null;r!==null;)e=r.alternate,e!==null&&zy(e)===null&&(i=r),r=r.sibling;r=i,r===null?(i=t.child,t.child=null):(i=r.sibling,r.sibling=null),Z_(t,!1,i,r,s);break;case"backwards":for(r=null,i=t.child,t.child=null;i!==null;){if(e=i.alternate,e!==null&&zy(e)===null){t.child=i;break}e=i.sibling,i.sibling=r,r=i,i=e}Z_(t,!0,r,null,s);break;case"together":Z_(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Jv(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Lo(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),pc|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(bt(153));if(t.child!==null){for(e=t.child,r=Xl(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=Xl(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function gO(e,t,r){switch(t.tag){case 3:MD(t),xd();break;case 5:aD(t);break;case 1:_a(t.type)&&Py(t);break;case 4:K2(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,i=t.memoizedProps.value;on(My,n._currentValue),n._currentValue=i;break;case 13:if(n=t.memoizedState,n!==null)return n.dehydrated!==null?(on(En,En.current&1),t.flags|=128,null):r&t.child.childLanes?DD(e,t,r):(on(En,En.current&1),e=Lo(e,t,r),e!==null?e.sibling:null);on(En,En.current&1);break;case 19:if(n=(r&t.childLanes)!==0,e.flags&128){if(n)return ND(e,t,r);t.flags|=128}if(i=t.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),on(En,En.current),n)break;return null;case 22:case 23:return t.lanes=0,ID(e,t,r)}return Lo(e,t,r)}var zD,k1,RD,LD;zD=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};k1=function(){};RD=function(e,t,r,n){var i=e.memoizedProps;if(i!==n){e=t.stateNode,tc(Zs.current);var s=null;switch(r){case"input":i=Xb(e,i),n=Xb(e,n),s=[];break;case"select":i=kn({},i,{value:void 0}),n=kn({},n,{value:void 0}),s=[];break;case"textarea":i=Jb(e,i),n=Jb(e,n),s=[];break;default:typeof i.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=Cy)}e1(r,n);var u;r=null;for(p in i)if(!n.hasOwnProperty(p)&&i.hasOwnProperty(p)&&i[p]!=null)if(p==="style"){var a=i[p];for(u in a)a.hasOwnProperty(u)&&(r||(r={}),r[u]="")}else p!=="dangerouslySetInnerHTML"&&p!=="children"&&p!=="suppressContentEditableWarning"&&p!=="suppressHydrationWarning"&&p!=="autoFocus"&&($p.hasOwnProperty(p)?s||(s=[]):(s=s||[]).push(p,null));for(p in n){var d=n[p];if(a=i!=null?i[p]:void 0,n.hasOwnProperty(p)&&d!==a&&(d!=null||a!=null))if(p==="style")if(a){for(u in a)!a.hasOwnProperty(u)||d&&d.hasOwnProperty(u)||(r||(r={}),r[u]="");for(u in d)d.hasOwnProperty(u)&&a[u]!==d[u]&&(r||(r={}),r[u]=d[u])}else r||(s||(s=[]),s.push(p,r)),r=d;else p==="dangerouslySetInnerHTML"?(d=d?d.__html:void 0,a=a?a.__html:void 0,d!=null&&a!==d&&(s=s||[]).push(p,d)):p==="children"?typeof d!="string"&&typeof d!="number"||(s=s||[]).push(p,""+d):p!=="suppressContentEditableWarning"&&p!=="suppressHydrationWarning"&&($p.hasOwnProperty(p)?(d!=null&&p==="onScroll"&&dn("scroll",e),s||a===d||(s=[])):(s=s||[]).push(p,d))}r&&(s=s||[]).push("style",r);var p=s;(t.updateQueue=p)&&(t.flags|=4)}};LD=function(e,t,r,n){r!==n&&(t.flags|=4)};function ep(e,t){if(!xn)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function Oi(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,n=0;if(t)for(var i=e.child;i!==null;)r|=i.lanes|i.childLanes,n|=i.subtreeFlags&14680064,n|=i.flags&14680064,i.return=e,i=i.sibling;else for(i=e.child;i!==null;)r|=i.lanes|i.childLanes,n|=i.subtreeFlags,n|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=n,e.childLanes=r,t}function vO(e,t,r){var n=t.pendingProps;switch(U2(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Oi(t),null;case 1:return _a(t.type)&&ky(),Oi(t),null;case 3:return n=t.stateNode,wd(),pn(xa),pn(ji),J2(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(hv(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,bs!==null&&(R1(bs),bs=null))),k1(e,t),Oi(t),null;case 5:Y2(t);var i=tc(Qp.current);if(r=t.type,e!==null&&t.stateNode!=null)RD(e,t,r,n,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(t.stateNode===null)throw Error(bt(166));return Oi(t),null}if(e=tc(Zs.current),hv(t)){n=t.stateNode,r=t.type;var s=t.memoizedProps;switch(n[Hs]=t,n[Yp]=s,e=(t.mode&1)!==0,r){case"dialog":dn("cancel",n),dn("close",n);break;case"iframe":case"object":case"embed":dn("load",n);break;case"video":case"audio":for(i=0;i<_p.length;i++)dn(_p[i],n);break;case"source":dn("error",n);break;case"img":case"image":case"link":dn("error",n),dn("load",n);break;case"details":dn("toggle",n);break;case"input":eC(n,s),dn("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!s.multiple},dn("invalid",n);break;case"textarea":rC(n,s),dn("invalid",n)}e1(r,s),i=null;for(var u in s)if(s.hasOwnProperty(u)){var a=s[u];u==="children"?typeof a=="string"?n.textContent!==a&&(s.suppressHydrationWarning!==!0&&cv(n.textContent,a,e),i=["children",a]):typeof a=="number"&&n.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&cv(n.textContent,a,e),i=["children",""+a]):$p.hasOwnProperty(u)&&a!=null&&u==="onScroll"&&dn("scroll",n)}switch(r){case"input":rv(n),tC(n,s,!0);break;case"textarea":rv(n),nC(n);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(n.onclick=Cy)}n=i,t.updateQueue=n,n!==null&&(t.flags|=4)}else{u=i.nodeType===9?i:i.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=cM(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=u.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=u.createElement(r,{is:n.is}):(e=u.createElement(r),r==="select"&&(u=e,n.multiple?u.multiple=!0:n.size&&(u.size=n.size))):e=u.createElementNS(e,r),e[Hs]=t,e[Yp]=n,zD(e,t,!1,!1),t.stateNode=e;e:{switch(u=t1(r,n),r){case"dialog":dn("cancel",e),dn("close",e),i=n;break;case"iframe":case"object":case"embed":dn("load",e),i=n;break;case"video":case"audio":for(i=0;i<_p.length;i++)dn(_p[i],e);i=n;break;case"source":dn("error",e),i=n;break;case"img":case"image":case"link":dn("error",e),dn("load",e),i=n;break;case"details":dn("toggle",e),i=n;break;case"input":eC(e,n),i=Xb(e,n),dn("invalid",e);break;case"option":i=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},i=kn({},n,{value:void 0}),dn("invalid",e);break;case"textarea":rC(e,n),i=Jb(e,n),dn("invalid",e);break;default:i=n}e1(r,i),a=i;for(s in a)if(a.hasOwnProperty(s)){var d=a[s];s==="style"?fM(e,d):s==="dangerouslySetInnerHTML"?(d=d?d.__html:void 0,d!=null&&hM(e,d)):s==="children"?typeof d=="string"?(r!=="textarea"||d!=="")&&Vp(e,d):typeof d=="number"&&Vp(e,""+d):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&($p.hasOwnProperty(s)?d!=null&&s==="onScroll"&&dn("scroll",e):d!=null&&P2(e,s,d,u))}switch(r){case"input":rv(e),tC(e,n,!1);break;case"textarea":rv(e),nC(e);break;case"option":n.value!=null&&e.setAttribute("value",""+eu(n.value));break;case"select":e.multiple=!!n.multiple,s=n.value,s!=null?nd(e,!!n.multiple,s,!1):n.defaultValue!=null&&nd(e,!!n.multiple,n.defaultValue,!0);break;default:typeof i.onClick=="function"&&(e.onclick=Cy)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Oi(t),null;case 6:if(e&&t.stateNode!=null)LD(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(bt(166));if(r=tc(Qp.current),tc(Zs.current),hv(t)){if(n=t.stateNode,r=t.memoizedProps,n[Hs]=t,(s=n.nodeValue!==r)&&(e=Ra,e!==null))switch(e.tag){case 3:cv(n.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&cv(n.nodeValue,r,(e.mode&1)!==0)}s&&(t.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[Hs]=t,t.stateNode=n}return Oi(t),null;case 13:if(pn(En),n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(xn&&za!==null&&t.mode&1&&!(t.flags&128))eD(),xd(),t.flags|=98560,s=!1;else if(s=hv(t),n!==null&&n.dehydrated!==null){if(e===null){if(!s)throw Error(bt(318));if(s=t.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(bt(317));s[Hs]=t}else xd(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Oi(t),s=!1}else bs!==null&&(R1(bs),bs=null),s=!0;if(!s)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(n=n!==null,n!==(e!==null&&e.memoizedState!==null)&&n&&(t.child.flags|=8192,t.mode&1&&(e===null||En.current&1?Kn===0&&(Kn=3):cS())),t.updateQueue!==null&&(t.flags|=4),Oi(t),null);case 4:return wd(),k1(e,t),e===null&&Xp(t.stateNode.containerInfo),Oi(t),null;case 10:return W2(t.type._context),Oi(t),null;case 17:return _a(t.type)&&ky(),Oi(t),null;case 19:if(pn(En),s=t.memoizedState,s===null)return Oi(t),null;if(n=(t.flags&128)!==0,u=s.rendering,u===null)if(n)ep(s,!1);else{if(Kn!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(u=zy(e),u!==null){for(t.flags|=128,ep(s,!1),n=u.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=r,r=t.child;r!==null;)s=r,e=n,s.flags&=14680066,u=s.alternate,u===null?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=u.childLanes,s.lanes=u.lanes,s.child=u.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=u.memoizedProps,s.memoizedState=u.memoizedState,s.updateQueue=u.updateQueue,s.type=u.type,e=u.dependencies,s.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return on(En,En.current&1|2),t.child}e=e.sibling}s.tail!==null&&Rn()>Sd&&(t.flags|=128,n=!0,ep(s,!1),t.lanes=4194304)}else{if(!n)if(e=zy(u),e!==null){if(t.flags|=128,n=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),ep(s,!0),s.tail===null&&s.tailMode==="hidden"&&!u.alternate&&!xn)return Oi(t),null}else 2*Rn()-s.renderingStartTime>Sd&&r!==1073741824&&(t.flags|=128,n=!0,ep(s,!1),t.lanes=4194304);s.isBackwards?(u.sibling=t.child,t.child=u):(r=s.last,r!==null?r.sibling=u:t.child=u,s.last=u)}return s.tail!==null?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=Rn(),t.sibling=null,r=En.current,on(En,n?r&1|2:r&1),t):(Oi(t),null);case 22:case 23:return uS(),n=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==n&&(t.flags|=8192),n&&t.mode&1?Da&1073741824&&(Oi(t),t.subtreeFlags&6&&(t.flags|=8192)):Oi(t),null;case 24:return null;case 25:return null}throw Error(bt(156,t.tag))}function yO(e,t){switch(U2(t),t.tag){case 1:return _a(t.type)&&ky(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return wd(),pn(xa),pn(ji),J2(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return Y2(t),null;case 13:if(pn(En),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(bt(340));xd()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return pn(En),null;case 4:return wd(),null;case 10:return W2(t.type._context),null;case 22:case 23:return uS(),null;case 24:return null;default:return null}}var pv=!1,Fi=!1,xO=typeof WeakSet=="function"?WeakSet:Set,Jt=null;function Kh(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){An(e,t,n)}else r.current=null}function P1(e,t,r){try{r()}catch(n){An(e,t,n)}}var GC=!1;function _O(e,t){if(h1=Sy,e=$M(),$2(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var i=n.anchorOffset,s=n.focusNode;n=n.focusOffset;try{r.nodeType,s.nodeType}catch{r=null;break e}var u=0,a=-1,d=-1,p=0,g=0,v=e,_=null;t:for(;;){for(var b;v!==r||i!==0&&v.nodeType!==3||(a=u+i),v!==s||n!==0&&v.nodeType!==3||(d=u+n),v.nodeType===3&&(u+=v.nodeValue.length),(b=v.firstChild)!==null;)_=v,v=b;for(;;){if(v===e)break t;if(_===r&&++p===i&&(a=u),_===s&&++g===n&&(d=u),(b=v.nextSibling)!==null)break;v=_,_=v.parentNode}v=b}r=a===-1||d===-1?null:{start:a,end:d}}else r=null}r=r||{start:0,end:0}}else r=null;for(d1={focusedElem:e,selectionRange:r},Sy=!1,Jt=t;Jt!==null;)if(t=Jt,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Jt=e;else for(;Jt!==null;){t=Jt;try{var k=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(k!==null){var A=k.memoizedProps,M=k.memoizedState,P=t.stateNode,I=P.getSnapshotBeforeUpdate(t.elementType===t.type?A:ys(t.type,A),M);P.__reactInternalSnapshotBeforeUpdate=I}break;case 3:var z=t.stateNode.containerInfo;z.nodeType===1?z.textContent="":z.nodeType===9&&z.documentElement&&z.removeChild(z.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(bt(163))}}catch(O){An(t,t.return,O)}if(e=t.sibling,e!==null){e.return=t.return,Jt=e;break}Jt=t.return}return k=GC,GC=!1,k}function zp(e,t,r){var n=t.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var i=n=n.next;do{if((i.tag&e)===e){var s=i.destroy;i.destroy=void 0,s!==void 0&&P1(t,r,s)}i=i.next}while(i!==n)}}function S0(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function I1(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function BD(e){var t=e.alternate;t!==null&&(e.alternate=null,BD(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Hs],delete t[Yp],delete t[m1],delete t[rO],delete t[nO])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function OD(e){return e.tag===5||e.tag===3||e.tag===4}function WC(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||OD(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function A1(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=Cy));else if(n!==4&&(e=e.child,e!==null))for(A1(e,t,r),e=e.sibling;e!==null;)A1(e,t,r),e=e.sibling}function M1(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(M1(e,t,r),e=e.sibling;e!==null;)M1(e,t,r),e=e.sibling}var _i=null,xs=!1;function bl(e,t,r){for(r=r.child;r!==null;)FD(e,t,r),r=r.sibling}function FD(e,t,r){if(Ws&&typeof Ws.onCommitFiberUnmount=="function")try{Ws.onCommitFiberUnmount(m0,r)}catch{}switch(r.tag){case 5:Fi||Kh(r,t);case 6:var n=_i,i=xs;_i=null,bl(e,t,r),_i=n,xs=i,_i!==null&&(xs?(e=_i,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):_i.removeChild(r.stateNode));break;case 18:_i!==null&&(xs?(e=_i,r=r.stateNode,e.nodeType===8?$_(e.parentNode,r):e.nodeType===1&&$_(e,r),Gp(e)):$_(_i,r.stateNode));break;case 4:n=_i,i=xs,_i=r.stateNode.containerInfo,xs=!0,bl(e,t,r),_i=n,xs=i;break;case 0:case 11:case 14:case 15:if(!Fi&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){i=n=n.next;do{var s=i,u=s.destroy;s=s.tag,u!==void 0&&(s&2||s&4)&&P1(r,t,u),i=i.next}while(i!==n)}bl(e,t,r);break;case 1:if(!Fi&&(Kh(r,t),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(a){An(r,t,a)}bl(e,t,r);break;case 21:bl(e,t,r);break;case 22:r.mode&1?(Fi=(n=Fi)||r.memoizedState!==null,bl(e,t,r),Fi=n):bl(e,t,r);break;default:bl(e,t,r)}}function ZC(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new xO),t.forEach(function(n){var i=IO.bind(null,e,n);r.has(n)||(r.add(n),n.then(i,i))})}}function ms(e,t){var r=t.deletions;if(r!==null)for(var n=0;n<r.length;n++){var i=r[n];try{var s=e,u=t,a=u;e:for(;a!==null;){switch(a.tag){case 5:_i=a.stateNode,xs=!1;break e;case 3:_i=a.stateNode.containerInfo,xs=!0;break e;case 4:_i=a.stateNode.containerInfo,xs=!0;break e}a=a.return}if(_i===null)throw Error(bt(160));FD(s,u,i),_i=null,xs=!1;var d=i.alternate;d!==null&&(d.return=null),i.return=null}catch(p){An(i,t,p)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)jD(t,e),t=t.sibling}function jD(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ms(t,e),js(e),n&4){try{zp(3,e,e.return),S0(3,e)}catch(A){An(e,e.return,A)}try{zp(5,e,e.return)}catch(A){An(e,e.return,A)}}break;case 1:ms(t,e),js(e),n&512&&r!==null&&Kh(r,r.return);break;case 5:if(ms(t,e),js(e),n&512&&r!==null&&Kh(r,r.return),e.flags&32){var i=e.stateNode;try{Vp(i,"")}catch(A){An(e,e.return,A)}}if(n&4&&(i=e.stateNode,i!=null)){var s=e.memoizedProps,u=r!==null?r.memoizedProps:s,a=e.type,d=e.updateQueue;if(e.updateQueue=null,d!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&lM(i,s),t1(a,u);var p=t1(a,s);for(u=0;u<d.length;u+=2){var g=d[u],v=d[u+1];g==="style"?fM(i,v):g==="dangerouslySetInnerHTML"?hM(i,v):g==="children"?Vp(i,v):P2(i,g,v,p)}switch(a){case"input":Kb(i,s);break;case"textarea":uM(i,s);break;case"select":var _=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var b=s.value;b!=null?nd(i,!!s.multiple,b,!1):_!==!!s.multiple&&(s.defaultValue!=null?nd(i,!!s.multiple,s.defaultValue,!0):nd(i,!!s.multiple,s.multiple?[]:"",!1))}i[Yp]=s}catch(A){An(e,e.return,A)}}break;case 6:if(ms(t,e),js(e),n&4){if(e.stateNode===null)throw Error(bt(162));i=e.stateNode,s=e.memoizedProps;try{i.nodeValue=s}catch(A){An(e,e.return,A)}}break;case 3:if(ms(t,e),js(e),n&4&&r!==null&&r.memoizedState.isDehydrated)try{Gp(t.containerInfo)}catch(A){An(e,e.return,A)}break;case 4:ms(t,e),js(e);break;case 13:ms(t,e),js(e),i=e.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(oS=Rn())),n&4&&ZC(e);break;case 22:if(g=r!==null&&r.memoizedState!==null,e.mode&1?(Fi=(p=Fi)||g,ms(t,e),Fi=p):ms(t,e),js(e),n&8192){if(p=e.memoizedState!==null,(e.stateNode.isHidden=p)&&!g&&e.mode&1)for(Jt=e,g=e.child;g!==null;){for(v=Jt=g;Jt!==null;){switch(_=Jt,b=_.child,_.tag){case 0:case 11:case 14:case 15:zp(4,_,_.return);break;case 1:Kh(_,_.return);var k=_.stateNode;if(typeof k.componentWillUnmount=="function"){n=_,r=_.return;try{t=n,k.props=t.memoizedProps,k.state=t.memoizedState,k.componentWillUnmount()}catch(A){An(n,r,A)}}break;case 5:Kh(_,_.return);break;case 22:if(_.memoizedState!==null){KC(v);continue}}b!==null?(b.return=_,Jt=b):KC(v)}g=g.sibling}e:for(g=null,v=e;;){if(v.tag===5){if(g===null){g=v;try{i=v.stateNode,p?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=v.stateNode,d=v.memoizedProps.style,u=d!=null&&d.hasOwnProperty("display")?d.display:null,a.style.display=dM("display",u))}catch(A){An(e,e.return,A)}}}else if(v.tag===6){if(g===null)try{v.stateNode.nodeValue=p?"":v.memoizedProps}catch(A){An(e,e.return,A)}}else if((v.tag!==22&&v.tag!==23||v.memoizedState===null||v===e)&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===e)break e;for(;v.sibling===null;){if(v.return===null||v.return===e)break e;g===v&&(g=null),v=v.return}g===v&&(g=null),v.sibling.return=v.return,v=v.sibling}}break;case 19:ms(t,e),js(e),n&4&&ZC(e);break;case 21:break;default:ms(t,e),js(e)}}function js(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(OD(r)){var n=r;break e}r=r.return}throw Error(bt(160))}switch(n.tag){case 5:var i=n.stateNode;n.flags&32&&(Vp(i,""),n.flags&=-33);var s=WC(e);M1(e,s,i);break;case 3:case 4:var u=n.stateNode.containerInfo,a=WC(e);A1(e,a,u);break;default:throw Error(bt(161))}}catch(d){An(e,e.return,d)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function wO(e,t,r){Jt=e,$D(e)}function $D(e,t,r){for(var n=(e.mode&1)!==0;Jt!==null;){var i=Jt,s=i.child;if(i.tag===22&&n){var u=i.memoizedState!==null||pv;if(!u){var a=i.alternate,d=a!==null&&a.memoizedState!==null||Fi;a=pv;var p=Fi;if(pv=u,(Fi=d)&&!p)for(Jt=i;Jt!==null;)u=Jt,d=u.child,u.tag===22&&u.memoizedState!==null?YC(i):d!==null?(d.return=u,Jt=d):YC(i);for(;s!==null;)Jt=s,$D(s),s=s.sibling;Jt=i,pv=a,Fi=p}XC(e)}else i.subtreeFlags&8772&&s!==null?(s.return=i,Jt=s):XC(e)}}function XC(e){for(;Jt!==null;){var t=Jt;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Fi||S0(5,t);break;case 1:var n=t.stateNode;if(t.flags&4&&!Fi)if(r===null)n.componentDidMount();else{var i=t.elementType===t.type?r.memoizedProps:ys(t.type,r.memoizedProps);n.componentDidUpdate(i,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;s!==null&&NC(t,s,n);break;case 3:var u=t.updateQueue;if(u!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}NC(t,u,r)}break;case 5:var a=t.stateNode;if(r===null&&t.flags&4){r=a;var d=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":d.autoFocus&&r.focus();break;case"img":d.src&&(r.src=d.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var p=t.alternate;if(p!==null){var g=p.memoizedState;if(g!==null){var v=g.dehydrated;v!==null&&Gp(v)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(bt(163))}Fi||t.flags&512&&I1(t)}catch(_){An(t,t.return,_)}}if(t===e){Jt=null;break}if(r=t.sibling,r!==null){r.return=t.return,Jt=r;break}Jt=t.return}}function KC(e){for(;Jt!==null;){var t=Jt;if(t===e){Jt=null;break}var r=t.sibling;if(r!==null){r.return=t.return,Jt=r;break}Jt=t.return}}function YC(e){for(;Jt!==null;){var t=Jt;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{S0(4,t)}catch(d){An(t,r,d)}break;case 1:var n=t.stateNode;if(typeof n.componentDidMount=="function"){var i=t.return;try{n.componentDidMount()}catch(d){An(t,i,d)}}var s=t.return;try{I1(t)}catch(d){An(t,s,d)}break;case 5:var u=t.return;try{I1(t)}catch(d){An(t,u,d)}}}catch(d){An(t,t.return,d)}if(t===e){Jt=null;break}var a=t.sibling;if(a!==null){a.return=t.return,Jt=a;break}Jt=t.return}}var bO=Math.ceil,By=$o.ReactCurrentDispatcher,aS=$o.ReactCurrentOwner,as=$o.ReactCurrentBatchConfig,Or=0,di=null,Un=null,wi=0,Da=0,Yh=uu(0),Kn=0,nm=null,pc=0,E0=0,sS=0,Rp=null,da=null,oS=0,Sd=1/0,So=null,Oy=!1,D1=null,Wl=null,mv=!1,Bl=null,Fy=0,Lp=0,N1=null,Qv=-1,ey=0;function ea(){return Or&6?Rn():Qv!==-1?Qv:Qv=Rn()}function Zl(e){return e.mode&1?Or&2&&wi!==0?wi&-wi:aO.transition!==null?(ey===0&&(ey=TM()),ey):(e=Kr,e!==0||(e=window.event,e=e===void 0?16:DM(e.type)),e):1}function Ts(e,t,r,n){if(50<Lp)throw Lp=0,N1=null,Error(bt(185));Am(e,r,n),(!(Or&2)||e!==di)&&(e===di&&(!(Or&2)&&(E0|=r),Kn===4&&zl(e,wi)),wa(e,n),r===1&&Or===0&&!(t.mode&1)&&(Sd=Rn()+500,_0&&cu()))}function wa(e,t){var r=e.callbackNode;a4(e,t);var n=by(e,e===di?wi:0);if(n===0)r!==null&&sC(r),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(r!=null&&sC(r),t===1)e.tag===0?iO(JC.bind(null,e)):YM(JC.bind(null,e)),eO(function(){!(Or&6)&&cu()}),r=null;else{switch(CM(n)){case 1:r=N2;break;case 4:r=SM;break;case 16:r=wy;break;case 536870912:r=EM;break;default:r=wy}r=XD(r,VD.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function VD(e,t){if(Qv=-1,ey=0,Or&6)throw Error(bt(327));var r=e.callbackNode;if(ld()&&e.callbackNode!==r)return null;var n=by(e,e===di?wi:0);if(n===0)return null;if(n&30||n&e.expiredLanes||t)t=jy(e,n);else{t=n;var i=Or;Or|=2;var s=qD();(di!==e||wi!==t)&&(So=null,Sd=Rn()+500,ac(e,t));do try{TO();break}catch(a){UD(e,a)}while(!0);G2(),By.current=s,Or=i,Un!==null?t=0:(di=null,wi=0,t=Kn)}if(t!==0){if(t===2&&(i=s1(e),i!==0&&(n=i,t=z1(e,i))),t===1)throw r=nm,ac(e,0),zl(e,n),wa(e,Rn()),r;if(t===6)zl(e,n);else{if(i=e.current.alternate,!(n&30)&&!SO(i)&&(t=jy(e,n),t===2&&(s=s1(e),s!==0&&(n=s,t=z1(e,s))),t===1))throw r=nm,ac(e,0),zl(e,n),wa(e,Rn()),r;switch(e.finishedWork=i,e.finishedLanes=n,t){case 0:case 1:throw Error(bt(345));case 2:Gu(e,da,So);break;case 3:if(zl(e,n),(n&130023424)===n&&(t=oS+500-Rn(),10<t)){if(by(e,0)!==0)break;if(i=e.suspendedLanes,(i&n)!==n){ea(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=p1(Gu.bind(null,e,da,So),t);break}Gu(e,da,So);break;case 4:if(zl(e,n),(n&4194240)===n)break;for(t=e.eventTimes,i=-1;0<n;){var u=31-Es(n);s=1<<u,u=t[u],u>i&&(i=u),n&=~s}if(n=i,n=Rn()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*bO(n/1960))-n,10<n){e.timeoutHandle=p1(Gu.bind(null,e,da,So),n);break}Gu(e,da,So);break;case 5:Gu(e,da,So);break;default:throw Error(bt(329))}}}return wa(e,Rn()),e.callbackNode===r?VD.bind(null,e):null}function z1(e,t){var r=Rp;return e.current.memoizedState.isDehydrated&&(ac(e,t).flags|=256),e=jy(e,t),e!==2&&(t=da,da=r,t!==null&&R1(t)),e}function R1(e){da===null?da=e:da.push.apply(da,e)}function SO(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var i=r[n],s=i.getSnapshot;i=i.value;try{if(!Ps(s(),i))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function zl(e,t){for(t&=~sS,t&=~E0,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-Es(t),n=1<<r;e[r]=-1,t&=~n}}function JC(e){if(Or&6)throw Error(bt(327));ld();var t=by(e,0);if(!(t&1))return wa(e,Rn()),null;var r=jy(e,t);if(e.tag!==0&&r===2){var n=s1(e);n!==0&&(t=n,r=z1(e,n))}if(r===1)throw r=nm,ac(e,0),zl(e,t),wa(e,Rn()),r;if(r===6)throw Error(bt(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Gu(e,da,So),wa(e,Rn()),null}function lS(e,t){var r=Or;Or|=1;try{return e(t)}finally{Or=r,Or===0&&(Sd=Rn()+500,_0&&cu())}}function mc(e){Bl!==null&&Bl.tag===0&&!(Or&6)&&ld();var t=Or;Or|=1;var r=as.transition,n=Kr;try{if(as.transition=null,Kr=1,e)return e()}finally{Kr=n,as.transition=r,Or=t,!(Or&6)&&cu()}}function uS(){Da=Yh.current,pn(Yh)}function ac(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,Q4(r)),Un!==null)for(r=Un.return;r!==null;){var n=r;switch(U2(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&ky();break;case 3:wd(),pn(xa),pn(ji),J2();break;case 5:Y2(n);break;case 4:wd();break;case 13:pn(En);break;case 19:pn(En);break;case 10:W2(n.type._context);break;case 22:case 23:uS()}r=r.return}if(di=e,Un=e=Xl(e.current,null),wi=Da=t,Kn=0,nm=null,sS=E0=pc=0,da=Rp=null,ec!==null){for(t=0;t<ec.length;t++)if(r=ec[t],n=r.interleaved,n!==null){r.interleaved=null;var i=n.next,s=r.pending;if(s!==null){var u=s.next;s.next=i,n.next=u}r.pending=n}ec=null}return e}function UD(e,t){do{var r=Un;try{if(G2(),Kv.current=Ly,Ry){for(var n=Tn.memoizedState;n!==null;){var i=n.queue;i!==null&&(i.pending=null),n=n.next}Ry=!1}if(fc=0,hi=Xn=Tn=null,Np=!1,em=0,aS.current=null,r===null||r.return===null){Kn=1,nm=t,Un=null;break}e:{var s=e,u=r.return,a=r,d=t;if(t=wi,a.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){var p=d,g=a,v=g.tag;if(!(g.mode&1)&&(v===0||v===11||v===15)){var _=g.alternate;_?(g.updateQueue=_.updateQueue,g.memoizedState=_.memoizedState,g.lanes=_.lanes):(g.updateQueue=null,g.memoizedState=null)}var b=FC(u);if(b!==null){b.flags&=-257,jC(b,u,a,s,t),b.mode&1&&OC(s,p,t),t=b,d=p;var k=t.updateQueue;if(k===null){var A=new Set;A.add(d),t.updateQueue=A}else k.add(d);break e}else{if(!(t&1)){OC(s,p,t),cS();break e}d=Error(bt(426))}}else if(xn&&a.mode&1){var M=FC(u);if(M!==null){!(M.flags&65536)&&(M.flags|=256),jC(M,u,a,s,t),q2(bd(d,a));break e}}s=d=bd(d,a),Kn!==4&&(Kn=2),Rp===null?Rp=[s]:Rp.push(s),s=u;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t;var P=CD(s,d,t);DC(s,P);break e;case 1:a=d;var I=s.type,z=s.stateNode;if(!(s.flags&128)&&(typeof I.getDerivedStateFromError=="function"||z!==null&&typeof z.componentDidCatch=="function"&&(Wl===null||!Wl.has(z)))){s.flags|=65536,t&=-t,s.lanes|=t;var O=kD(s,a,t);DC(s,O);break e}}s=s.return}while(s!==null)}GD(r)}catch(V){t=V,Un===r&&r!==null&&(Un=r=r.return);continue}break}while(!0)}function qD(){var e=By.current;return By.current=Ly,e===null?Ly:e}function cS(){(Kn===0||Kn===3||Kn===2)&&(Kn=4),di===null||!(pc&268435455)&&!(E0&268435455)||zl(di,wi)}function jy(e,t){var r=Or;Or|=2;var n=qD();(di!==e||wi!==t)&&(So=null,ac(e,t));do try{EO();break}catch(i){UD(e,i)}while(!0);if(G2(),Or=r,By.current=n,Un!==null)throw Error(bt(261));return di=null,wi=0,Kn}function EO(){for(;Un!==null;)HD(Un)}function TO(){for(;Un!==null&&!K5();)HD(Un)}function HD(e){var t=ZD(e.alternate,e,Da);e.memoizedProps=e.pendingProps,t===null?GD(e):Un=t,aS.current=null}function GD(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=yO(r,t),r!==null){r.flags&=32767,Un=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Kn=6,Un=null;return}}else if(r=vO(r,t,Da),r!==null){Un=r;return}if(t=t.sibling,t!==null){Un=t;return}Un=t=e}while(t!==null);Kn===0&&(Kn=5)}function Gu(e,t,r){var n=Kr,i=as.transition;try{as.transition=null,Kr=1,CO(e,t,r,n)}finally{as.transition=i,Kr=n}return null}function CO(e,t,r,n){do ld();while(Bl!==null);if(Or&6)throw Error(bt(327));r=e.finishedWork;var i=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(bt(177));e.callbackNode=null,e.callbackPriority=0;var s=r.lanes|r.childLanes;if(s4(e,s),e===di&&(Un=di=null,wi=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||mv||(mv=!0,XD(wy,function(){return ld(),null})),s=(r.flags&15990)!==0,r.subtreeFlags&15990||s){s=as.transition,as.transition=null;var u=Kr;Kr=1;var a=Or;Or|=4,aS.current=null,_O(e,r),jD(r,e),G4(d1),Sy=!!h1,d1=h1=null,e.current=r,wO(r),Y5(),Or=a,Kr=u,as.transition=s}else e.current=r;if(mv&&(mv=!1,Bl=e,Fy=i),s=e.pendingLanes,s===0&&(Wl=null),e4(r.stateNode),wa(e,Rn()),t!==null)for(n=e.onRecoverableError,r=0;r<t.length;r++)i=t[r],n(i.value,{componentStack:i.stack,digest:i.digest});if(Oy)throw Oy=!1,e=D1,D1=null,e;return Fy&1&&e.tag!==0&&ld(),s=e.pendingLanes,s&1?e===N1?Lp++:(Lp=0,N1=e):Lp=0,cu(),null}function ld(){if(Bl!==null){var e=CM(Fy),t=as.transition,r=Kr;try{if(as.transition=null,Kr=16>e?16:e,Bl===null)var n=!1;else{if(e=Bl,Bl=null,Fy=0,Or&6)throw Error(bt(331));var i=Or;for(Or|=4,Jt=e.current;Jt!==null;){var s=Jt,u=s.child;if(Jt.flags&16){var a=s.deletions;if(a!==null){for(var d=0;d<a.length;d++){var p=a[d];for(Jt=p;Jt!==null;){var g=Jt;switch(g.tag){case 0:case 11:case 15:zp(8,g,s)}var v=g.child;if(v!==null)v.return=g,Jt=v;else for(;Jt!==null;){g=Jt;var _=g.sibling,b=g.return;if(BD(g),g===p){Jt=null;break}if(_!==null){_.return=b,Jt=_;break}Jt=b}}}var k=s.alternate;if(k!==null){var A=k.child;if(A!==null){k.child=null;do{var M=A.sibling;A.sibling=null,A=M}while(A!==null)}}Jt=s}}if(s.subtreeFlags&2064&&u!==null)u.return=s,Jt=u;else e:for(;Jt!==null;){if(s=Jt,s.flags&2048)switch(s.tag){case 0:case 11:case 15:zp(9,s,s.return)}var P=s.sibling;if(P!==null){P.return=s.return,Jt=P;break e}Jt=s.return}}var I=e.current;for(Jt=I;Jt!==null;){u=Jt;var z=u.child;if(u.subtreeFlags&2064&&z!==null)z.return=u,Jt=z;else e:for(u=I;Jt!==null;){if(a=Jt,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:S0(9,a)}}catch(V){An(a,a.return,V)}if(a===u){Jt=null;break e}var O=a.sibling;if(O!==null){O.return=a.return,Jt=O;break e}Jt=a.return}}if(Or=i,cu(),Ws&&typeof Ws.onPostCommitFiberRoot=="function")try{Ws.onPostCommitFiberRoot(m0,e)}catch{}n=!0}return n}finally{Kr=r,as.transition=t}}return!1}function QC(e,t,r){t=bd(r,t),t=CD(e,t,1),e=Gl(e,t,1),t=ea(),e!==null&&(Am(e,1,t),wa(e,t))}function An(e,t,r){if(e.tag===3)QC(e,e,r);else for(;t!==null;){if(t.tag===3){QC(t,e,r);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Wl===null||!Wl.has(n))){e=bd(r,e),e=kD(t,e,1),t=Gl(t,e,1),e=ea(),t!==null&&(Am(t,1,e),wa(t,e));break}}t=t.return}}function kO(e,t,r){var n=e.pingCache;n!==null&&n.delete(t),t=ea(),e.pingedLanes|=e.suspendedLanes&r,di===e&&(wi&r)===r&&(Kn===4||Kn===3&&(wi&130023424)===wi&&500>Rn()-oS?ac(e,0):sS|=r),wa(e,t)}function WD(e,t){t===0&&(e.mode&1?(t=av,av<<=1,!(av&130023424)&&(av=4194304)):t=1);var r=ea();e=Ro(e,t),e!==null&&(Am(e,t,r),wa(e,r))}function PO(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),WD(e,r)}function IO(e,t){var r=0;switch(e.tag){case 13:var n=e.stateNode,i=e.memoizedState;i!==null&&(r=i.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(bt(314))}n!==null&&n.delete(t),WD(e,r)}var ZD;ZD=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||xa.current)ga=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return ga=!1,gO(e,t,r);ga=!!(e.flags&131072)}else ga=!1,xn&&t.flags&1048576&&JM(t,Ay,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;Jv(e,t),e=t.pendingProps;var i=yd(t,ji.current);od(t,r),i=eS(null,t,n,e,i,r);var s=tS();return t.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,_a(n)?(s=!0,Py(t)):s=!1,t.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,X2(t),i.updater=b0,t.stateNode=i,i._reactInternals=t,w1(t,n,e,r),t=E1(null,t,n,!0,s,r)):(t.tag=0,xn&&s&&V2(t),Qi(null,t,i,r),t=t.child),t;case 16:n=t.elementType;e:{switch(Jv(e,t),e=t.pendingProps,i=n._init,n=i(n._payload),t.type=n,i=t.tag=MO(n),e=ys(n,e),i){case 0:t=S1(null,t,n,e,r);break e;case 1:t=UC(null,t,n,e,r);break e;case 11:t=$C(null,t,n,e,r);break e;case 14:t=VC(null,t,n,ys(n.type,e),r);break e}throw Error(bt(306,n,""))}return t;case 0:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:ys(n,i),S1(e,t,n,i,r);case 1:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:ys(n,i),UC(e,t,n,i,r);case 3:e:{if(MD(t),e===null)throw Error(bt(387));n=t.pendingProps,s=t.memoizedState,i=s.element,iD(e,t),Ny(t,n,null,r);var u=t.memoizedState;if(n=u.element,s.isDehydrated)if(s={element:n,isDehydrated:!1,cache:u.cache,pendingSuspenseBoundaries:u.pendingSuspenseBoundaries,transitions:u.transitions},t.updateQueue.baseState=s,t.memoizedState=s,t.flags&256){i=bd(Error(bt(423)),t),t=qC(e,t,n,r,i);break e}else if(n!==i){i=bd(Error(bt(424)),t),t=qC(e,t,n,r,i);break e}else for(za=Hl(t.stateNode.containerInfo.firstChild),Ra=t,xn=!0,bs=null,r=rD(t,null,n,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(xd(),n===i){t=Lo(e,t,r);break e}Qi(e,t,n,r)}t=t.child}return t;case 5:return aD(t),e===null&&y1(t),n=t.type,i=t.pendingProps,s=e!==null?e.memoizedProps:null,u=i.children,f1(n,i)?u=null:s!==null&&f1(n,s)&&(t.flags|=32),AD(e,t),Qi(e,t,u,r),t.child;case 6:return e===null&&y1(t),null;case 13:return DD(e,t,r);case 4:return K2(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=_d(t,null,n,r):Qi(e,t,n,r),t.child;case 11:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:ys(n,i),$C(e,t,n,i,r);case 7:return Qi(e,t,t.pendingProps,r),t.child;case 8:return Qi(e,t,t.pendingProps.children,r),t.child;case 12:return Qi(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(n=t.type._context,i=t.pendingProps,s=t.memoizedProps,u=i.value,on(My,n._currentValue),n._currentValue=u,s!==null)if(Ps(s.value,u)){if(s.children===i.children&&!xa.current){t=Lo(e,t,r);break e}}else for(s=t.child,s!==null&&(s.return=t);s!==null;){var a=s.dependencies;if(a!==null){u=s.child;for(var d=a.firstContext;d!==null;){if(d.context===n){if(s.tag===1){d=Mo(-1,r&-r),d.tag=2;var p=s.updateQueue;if(p!==null){p=p.shared;var g=p.pending;g===null?d.next=d:(d.next=g.next,g.next=d),p.pending=d}}s.lanes|=r,d=s.alternate,d!==null&&(d.lanes|=r),x1(s.return,r,t),a.lanes|=r;break}d=d.next}}else if(s.tag===10)u=s.type===t.type?null:s.child;else if(s.tag===18){if(u=s.return,u===null)throw Error(bt(341));u.lanes|=r,a=u.alternate,a!==null&&(a.lanes|=r),x1(u,r,t),u=s.sibling}else u=s.child;if(u!==null)u.return=s;else for(u=s;u!==null;){if(u===t){u=null;break}if(s=u.sibling,s!==null){s.return=u.return,u=s;break}u=u.return}s=u}Qi(e,t,i.children,r),t=t.child}return t;case 9:return i=t.type,n=t.pendingProps.children,od(t,r),i=ss(i),n=n(i),t.flags|=1,Qi(e,t,n,r),t.child;case 14:return n=t.type,i=ys(n,t.pendingProps),i=ys(n.type,i),VC(e,t,n,i,r);case 15:return PD(e,t,t.type,t.pendingProps,r);case 17:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:ys(n,i),Jv(e,t),t.tag=1,_a(n)?(e=!0,Py(t)):e=!1,od(t,r),TD(t,n,i),w1(t,n,i,r),E1(null,t,n,!0,e,r);case 19:return ND(e,t,r);case 22:return ID(e,t,r)}throw Error(bt(156,t.tag))};function XD(e,t){return bM(e,t)}function AO(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function rs(e,t,r,n){return new AO(e,t,r,n)}function hS(e){return e=e.prototype,!(!e||!e.isReactComponent)}function MO(e){if(typeof e=="function")return hS(e)?1:0;if(e!=null){if(e=e.$$typeof,e===A2)return 11;if(e===M2)return 14}return 2}function Xl(e,t){var r=e.alternate;return r===null?(r=rs(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function ty(e,t,r,n,i,s){var u=2;if(n=e,typeof e=="function")hS(e)&&(u=1);else if(typeof e=="string")u=5;else e:switch(e){case $h:return sc(r.children,i,s,t);case I2:u=8,i|=8;break;case Hb:return e=rs(12,r,t,i|2),e.elementType=Hb,e.lanes=s,e;case Gb:return e=rs(13,r,t,i),e.elementType=Gb,e.lanes=s,e;case Wb:return e=rs(19,r,t,i),e.elementType=Wb,e.lanes=s,e;case aM:return T0(r,i,s,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case nM:u=10;break e;case iM:u=9;break e;case A2:u=11;break e;case M2:u=14;break e;case kl:u=16,n=null;break e}throw Error(bt(130,e==null?e:typeof e,""))}return t=rs(u,r,t,i),t.elementType=e,t.type=n,t.lanes=s,t}function sc(e,t,r,n){return e=rs(7,e,n,t),e.lanes=r,e}function T0(e,t,r,n){return e=rs(22,e,n,t),e.elementType=aM,e.lanes=r,e.stateNode={isHidden:!1},e}function X_(e,t,r){return e=rs(6,e,null,t),e.lanes=r,e}function K_(e,t,r){return t=rs(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function DO(e,t,r,n,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=A_(0),this.expirationTimes=A_(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=A_(0),this.identifierPrefix=n,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function dS(e,t,r,n,i,s,u,a,d){return e=new DO(e,t,r,a,d),t===1?(t=1,s===!0&&(t|=8)):t=0,s=rs(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},X2(s),e}function NO(e,t,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:jh,key:n==null?null:""+n,children:e,containerInfo:t,implementation:r}}function KD(e){if(!e)return tu;e=e._reactInternals;e:{if(Tc(e)!==e||e.tag!==1)throw Error(bt(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(_a(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(bt(171))}if(e.tag===1){var r=e.type;if(_a(r))return KM(e,r,t)}return t}function YD(e,t,r,n,i,s,u,a,d){return e=dS(r,n,!0,e,i,s,u,a,d),e.context=KD(null),r=e.current,n=ea(),i=Zl(r),s=Mo(n,i),s.callback=t??null,Gl(r,s,i),e.current.lanes=i,Am(e,i,n),wa(e,n),e}function C0(e,t,r,n){var i=t.current,s=ea(),u=Zl(i);return r=KD(r),t.context===null?t.context=r:t.pendingContext=r,t=Mo(s,u),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),e=Gl(i,t,u),e!==null&&(Ts(e,i,u,s),Xv(e,i,u)),u}function $y(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function ek(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function fS(e,t){ek(e,t),(e=e.alternate)&&ek(e,t)}function zO(){return null}var JD=typeof reportError=="function"?reportError:function(e){console.error(e)};function pS(e){this._internalRoot=e}k0.prototype.render=pS.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(bt(409));C0(e,t,null,null)};k0.prototype.unmount=pS.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;mc(function(){C0(null,e,null,null)}),t[zo]=null}};function k0(e){this._internalRoot=e}k0.prototype.unstable_scheduleHydration=function(e){if(e){var t=IM();e={blockedOn:null,target:e,priority:t};for(var r=0;r<Nl.length&&t!==0&&t<Nl[r].priority;r++);Nl.splice(r,0,e),r===0&&MM(e)}};function mS(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function P0(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function tk(){}function RO(e,t,r,n,i){if(i){if(typeof n=="function"){var s=n;n=function(){var p=$y(u);s.call(p)}}var u=YD(t,n,e,0,null,!1,!1,"",tk);return e._reactRootContainer=u,e[zo]=u.current,Xp(e.nodeType===8?e.parentNode:e),mc(),u}for(;i=e.lastChild;)e.removeChild(i);if(typeof n=="function"){var a=n;n=function(){var p=$y(d);a.call(p)}}var d=dS(e,0,!1,null,null,!1,!1,"",tk);return e._reactRootContainer=d,e[zo]=d.current,Xp(e.nodeType===8?e.parentNode:e),mc(function(){C0(t,d,r,n)}),d}function I0(e,t,r,n,i){var s=r._reactRootContainer;if(s){var u=s;if(typeof i=="function"){var a=i;i=function(){var d=$y(u);a.call(d)}}C0(t,u,e,i)}else u=RO(r,t,e,i,n);return $y(u)}kM=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=xp(t.pendingLanes);r!==0&&(z2(t,r|1),wa(t,Rn()),!(Or&6)&&(Sd=Rn()+500,cu()))}break;case 13:mc(function(){var n=Ro(e,1);if(n!==null){var i=ea();Ts(n,e,1,i)}}),fS(e,1)}};R2=function(e){if(e.tag===13){var t=Ro(e,134217728);if(t!==null){var r=ea();Ts(t,e,134217728,r)}fS(e,134217728)}};PM=function(e){if(e.tag===13){var t=Zl(e),r=Ro(e,t);if(r!==null){var n=ea();Ts(r,e,t,n)}fS(e,t)}};IM=function(){return Kr};AM=function(e,t){var r=Kr;try{return Kr=e,t()}finally{Kr=r}};n1=function(e,t,r){switch(t){case"input":if(Kb(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var i=x0(n);if(!i)throw Error(bt(90));oM(n),Kb(n,i)}}}break;case"textarea":uM(e,r);break;case"select":t=r.value,t!=null&&nd(e,!!r.multiple,t,!1)}};gM=lS;vM=mc;var LO={usingClientEntryPoint:!1,Events:[Dm,Hh,x0,pM,mM,lS]},tp={findFiberByHostInstance:Qu,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},BO={bundleType:tp.bundleType,version:tp.version,rendererPackageName:tp.rendererPackageName,rendererConfig:tp.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:$o.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=_M(e),e===null?null:e.stateNode},findFiberByHostInstance:tp.findFiberByHostInstance||zO,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var gv=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!gv.isDisabled&&gv.supportsFiber)try{m0=gv.inject(BO),Ws=gv}catch{}}Fa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=LO;Fa.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!mS(t))throw Error(bt(200));return NO(e,t,null,r)};Fa.createRoot=function(e,t){if(!mS(e))throw Error(bt(299));var r=!1,n="",i=JD;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(i=t.onRecoverableError)),t=dS(e,1,!1,null,null,r,!1,n,i),e[zo]=t.current,Xp(e.nodeType===8?e.parentNode:e),new pS(t)};Fa.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(bt(188)):(e=Object.keys(e).join(","),Error(bt(268,e)));return e=_M(t),e=e===null?null:e.stateNode,e};Fa.flushSync=function(e){return mc(e)};Fa.hydrate=function(e,t,r){if(!P0(t))throw Error(bt(200));return I0(null,e,t,!0,r)};Fa.hydrateRoot=function(e,t,r){if(!mS(e))throw Error(bt(405));var n=r!=null&&r.hydratedSources||null,i=!1,s="",u=JD;if(r!=null&&(r.unstable_strictMode===!0&&(i=!0),r.identifierPrefix!==void 0&&(s=r.identifierPrefix),r.onRecoverableError!==void 0&&(u=r.onRecoverableError)),t=YD(t,null,e,1,r??null,i,!1,s,u),e[zo]=t.current,Xp(e),n)for(e=0;e<n.length;e++)r=n[e],i=r._getVersion,i=i(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,i]:t.mutableSourceEagerHydrationData.push(r,i);return new k0(t)};Fa.render=function(e,t,r){if(!P0(t))throw Error(bt(200));return I0(null,e,t,!1,r)};Fa.unmountComponentAtNode=function(e){if(!P0(e))throw Error(bt(40));return e._reactRootContainer?(mc(function(){I0(null,null,e,!1,function(){e._reactRootContainer=null,e[zo]=null})}),!0):!1};Fa.unstable_batchedUpdates=lS;Fa.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!P0(r))throw Error(bt(200));if(e==null||e._reactInternals===void 0)throw Error(bt(38));return I0(e,t,r,!1,n)};Fa.version="18.3.1-next-f1338f8080-20240426";function QD(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(QD)}catch(e){console.error(e)}}QD(),QA.exports=Fa;var OO=QA.exports,eN,rk=OO;eN=rk.createRoot,rk.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function im(){return im=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},im.apply(this,arguments)}var Ol;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Ol||(Ol={}));const nk="popstate";function FO(e){e===void 0&&(e={});function t(n,i){let{pathname:s,search:u,hash:a}=n.location;return L1("",{pathname:s,search:u,hash:a},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function r(n,i){return typeof i=="string"?i:rN(i)}return $O(t,r,null,e)}function qn(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function tN(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function jO(){return Math.random().toString(36).substr(2,8)}function ik(e,t){return{usr:e.state,key:e.key,idx:t}}function L1(e,t,r,n){return r===void 0&&(r=null),im({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?Rd(t):t,{state:r,key:t&&t.key||n||jO()})}function rN(e){let{pathname:t="/",search:r="",hash:n=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function Rd(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function $O(e,t,r,n){n===void 0&&(n={});let{window:i=document.defaultView,v5Compat:s=!1}=n,u=i.history,a=Ol.Pop,d=null,p=g();p==null&&(p=0,u.replaceState(im({},u.state,{idx:p}),""));function g(){return(u.state||{idx:null}).idx}function v(){a=Ol.Pop;let M=g(),P=M==null?null:M-p;p=M,d&&d({action:a,location:A.location,delta:P})}function _(M,P){a=Ol.Push;let I=L1(A.location,M,P);p=g()+1;let z=ik(I,p),O=A.createHref(I);try{u.pushState(z,"",O)}catch(V){if(V instanceof DOMException&&V.name==="DataCloneError")throw V;i.location.assign(O)}s&&d&&d({action:a,location:A.location,delta:1})}function b(M,P){a=Ol.Replace;let I=L1(A.location,M,P);p=g();let z=ik(I,p),O=A.createHref(I);u.replaceState(z,"",O),s&&d&&d({action:a,location:A.location,delta:0})}function k(M){let P=i.location.origin!=="null"?i.location.origin:i.location.href,I=typeof M=="string"?M:rN(M);return I=I.replace(/ $/,"%20"),qn(P,"No window.location.(origin|href) available to create URL for href: "+I),new URL(I,P)}let A={get action(){return a},get location(){return e(i,u)},listen(M){if(d)throw new Error("A history only accepts one active listener");return i.addEventListener(nk,v),d=M,()=>{i.removeEventListener(nk,v),d=null}},createHref(M){return t(i,M)},createURL:k,encodeLocation(M){let P=k(M);return{pathname:P.pathname,search:P.search,hash:P.hash}},push:_,replace:b,go(M){return u.go(M)}};return A}var ak;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(ak||(ak={}));function VO(e,t,r){return r===void 0&&(r="/"),UO(e,t,r)}function UO(e,t,r,n){let i=typeof t=="string"?Rd(t):t,s=aN(i.pathname||"/",r);if(s==null)return null;let u=nN(e);qO(u);let a=null;for(let d=0;a==null&&d<u.length;++d){let p=rF(s);a=QO(u[d],p)}return a}function nN(e,t,r,n){t===void 0&&(t=[]),r===void 0&&(r=[]),n===void 0&&(n="");let i=(s,u,a)=>{let d={relativePath:a===void 0?s.path||"":a,caseSensitive:s.caseSensitive===!0,childrenIndex:u,route:s};d.relativePath.startsWith("/")&&(qn(d.relativePath.startsWith(n),'Absolute route path "'+d.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),d.relativePath=d.relativePath.slice(n.length));let p=oc([n,d.relativePath]),g=r.concat(d);s.children&&s.children.length>0&&(qn(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+p+'".')),nN(s.children,t,g,p)),!(s.path==null&&!s.index)&&t.push({path:p,score:YO(p,s.index),routesMeta:g})};return e.forEach((s,u)=>{var a;if(s.path===""||!((a=s.path)!=null&&a.includes("?")))i(s,u);else for(let d of iN(s.path))i(s,u,d)}),t}function iN(e){let t=e.split("/");if(t.length===0)return[];let[r,...n]=t,i=r.endsWith("?"),s=r.replace(/\?$/,"");if(n.length===0)return i?[s,""]:[s];let u=iN(n.join("/")),a=[];return a.push(...u.map(d=>d===""?s:[s,d].join("/"))),i&&a.push(...u),a.map(d=>e.startsWith("/")&&d===""?"/":d)}function qO(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:JO(t.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const HO=/^:[\w-]+$/,GO=3,WO=2,ZO=1,XO=10,KO=-2,sk=e=>e==="*";function YO(e,t){let r=e.split("/"),n=r.length;return r.some(sk)&&(n+=KO),t&&(n+=WO),r.filter(i=>!sk(i)).reduce((i,s)=>i+(HO.test(s)?GO:s===""?ZO:XO),n)}function JO(e,t){return e.length===t.length&&e.slice(0,-1).every((n,i)=>n===t[i])?e[e.length-1]-t[t.length-1]:0}function QO(e,t,r){let{routesMeta:n}=e,i={},s="/",u=[];for(let a=0;a<n.length;++a){let d=n[a],p=a===n.length-1,g=s==="/"?t:t.slice(s.length)||"/",v=eF({path:d.relativePath,caseSensitive:d.caseSensitive,end:p},g),_=d.route;if(!v)return null;Object.assign(i,v.params),u.push({params:i,pathname:oc([s,v.pathname]),pathnameBase:sF(oc([s,v.pathnameBase])),route:_}),v.pathnameBase!=="/"&&(s=oc([s,v.pathnameBase]))}return u}function eF(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,n]=tF(e.path,e.caseSensitive,e.end),i=t.match(r);if(!i)return null;let s=i[0],u=s.replace(/(.)\/+$/,"$1"),a=i.slice(1);return{params:n.reduce((p,g,v)=>{let{paramName:_,isOptional:b}=g;if(_==="*"){let A=a[v]||"";u=s.slice(0,s.length-A.length).replace(/(.)\/+$/,"$1")}const k=a[v];return b&&!k?p[_]=void 0:p[_]=(k||"").replace(/%2F/g,"/"),p},{}),pathname:s,pathnameBase:u,pattern:e}}function tF(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),tN(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let n=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(u,a,d)=>(n.push({paramName:a,isOptional:d!=null}),d?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(n.push({paramName:"*"}),i+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?i+="\\/*$":e!==""&&e!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,t?void 0:"i"),n]}function rF(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return tN(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function aN(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,n=e.charAt(r);return n&&n!=="/"?null:e.slice(r)||"/"}function nF(e,t){t===void 0&&(t="/");let{pathname:r,search:n="",hash:i=""}=typeof e=="string"?Rd(e):e;return{pathname:r?r.startsWith("/")?r:iF(r,t):t,search:oF(n),hash:lF(i)}}function iF(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(i=>{i===".."?r.length>1&&r.pop():i!=="."&&r.push(i)}),r.length>1?r.join("/"):"/"}function Y_(e,t,r,n){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function aF(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function sN(e,t){let r=aF(e);return t?r.map((n,i)=>i===r.length-1?n.pathname:n.pathnameBase):r.map(n=>n.pathnameBase)}function oN(e,t,r,n){n===void 0&&(n=!1);let i;typeof e=="string"?i=Rd(e):(i=im({},e),qn(!i.pathname||!i.pathname.includes("?"),Y_("?","pathname","search",i)),qn(!i.pathname||!i.pathname.includes("#"),Y_("#","pathname","hash",i)),qn(!i.search||!i.search.includes("#"),Y_("#","search","hash",i)));let s=e===""||i.pathname==="",u=s?"/":i.pathname,a;if(u==null)a=r;else{let v=t.length-1;if(!n&&u.startsWith("..")){let _=u.split("/");for(;_[0]==="..";)_.shift(),v-=1;i.pathname=_.join("/")}a=v>=0?t[v]:"/"}let d=nF(i,a),p=u&&u!=="/"&&u.endsWith("/"),g=(s||u===".")&&r.endsWith("/");return!d.pathname.endsWith("/")&&(p||g)&&(d.pathname+="/"),d}const oc=e=>e.join("/").replace(/\/\/+/g,"/"),sF=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),oF=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,lF=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function uF(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const lN=["post","put","patch","delete"];new Set(lN);const cF=["get",...lN];new Set(cF);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function am(){return am=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},am.apply(this,arguments)}const gS=ce.createContext(null),hF=ce.createContext(null),zm=ce.createContext(null),A0=ce.createContext(null),Cc=ce.createContext({outlet:null,matches:[],isDataRoute:!1}),uN=ce.createContext(null);function Rm(){return ce.useContext(A0)!=null}function M0(){return Rm()||qn(!1),ce.useContext(A0).location}function cN(e){ce.useContext(zm).static||ce.useLayoutEffect(e)}function hN(){let{isDataRoute:e}=ce.useContext(Cc);return e?EF():dF()}function dF(){Rm()||qn(!1);let e=ce.useContext(gS),{basename:t,future:r,navigator:n}=ce.useContext(zm),{matches:i}=ce.useContext(Cc),{pathname:s}=M0(),u=JSON.stringify(sN(i,r.v7_relativeSplatPath)),a=ce.useRef(!1);return cN(()=>{a.current=!0}),ce.useCallback(function(p,g){if(g===void 0&&(g={}),!a.current)return;if(typeof p=="number"){n.go(p);return}let v=oN(p,JSON.parse(u),s,g.relative==="path");e==null&&t!=="/"&&(v.pathname=v.pathname==="/"?t:oc([t,v.pathname])),(g.replace?n.replace:n.push)(v,g.state,g)},[t,n,u,s,e])}function fF(e,t){return pF(e,t)}function pF(e,t,r,n){Rm()||qn(!1);let{navigator:i}=ce.useContext(zm),{matches:s}=ce.useContext(Cc),u=s[s.length-1],a=u?u.params:{};u&&u.pathname;let d=u?u.pathnameBase:"/";u&&u.route;let p=M0(),g;if(t){var v;let M=typeof t=="string"?Rd(t):t;d==="/"||(v=M.pathname)!=null&&v.startsWith(d)||qn(!1),g=M}else g=p;let _=g.pathname||"/",b=_;if(d!=="/"){let M=d.replace(/^\//,"").split("/");b="/"+_.replace(/^\//,"").split("/").slice(M.length).join("/")}let k=VO(e,{pathname:b}),A=xF(k&&k.map(M=>Object.assign({},M,{params:Object.assign({},a,M.params),pathname:oc([d,i.encodeLocation?i.encodeLocation(M.pathname).pathname:M.pathname]),pathnameBase:M.pathnameBase==="/"?d:oc([d,i.encodeLocation?i.encodeLocation(M.pathnameBase).pathname:M.pathnameBase])})),s,r,n);return t&&A?ce.createElement(A0.Provider,{value:{location:am({pathname:"/",search:"",hash:"",state:null,key:"default"},g),navigationType:Ol.Pop}},A):A}function mF(){let e=SF(),t=uF(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return ce.createElement(ce.Fragment,null,ce.createElement("h2",null,"Unexpected Application Error!"),ce.createElement("h3",{style:{fontStyle:"italic"}},t),r?ce.createElement("pre",{style:i},r):null,null)}const gF=ce.createElement(mF,null);class vF extends ce.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error!==void 0?ce.createElement(Cc.Provider,{value:this.props.routeContext},ce.createElement(uN.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function yF(e){let{routeContext:t,match:r,children:n}=e,i=ce.useContext(gS);return i&&i.static&&i.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=r.route.id),ce.createElement(Cc.Provider,{value:t},n)}function xF(e,t,r,n){var i;if(t===void 0&&(t=[]),r===void 0&&(r=null),n===void 0&&(n=null),e==null){var s;if(!r)return null;if(r.errors)e=r.matches;else if((s=n)!=null&&s.v7_partialHydration&&t.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let u=e,a=(i=r)==null?void 0:i.errors;if(a!=null){let g=u.findIndex(v=>v.route.id&&(a==null?void 0:a[v.route.id])!==void 0);g>=0||qn(!1),u=u.slice(0,Math.min(u.length,g+1))}let d=!1,p=-1;if(r&&n&&n.v7_partialHydration)for(let g=0;g<u.length;g++){let v=u[g];if((v.route.HydrateFallback||v.route.hydrateFallbackElement)&&(p=g),v.route.id){let{loaderData:_,errors:b}=r,k=v.route.loader&&_[v.route.id]===void 0&&(!b||b[v.route.id]===void 0);if(v.route.lazy||k){d=!0,p>=0?u=u.slice(0,p+1):u=[u[0]];break}}}return u.reduceRight((g,v,_)=>{let b,k=!1,A=null,M=null;r&&(b=a&&v.route.id?a[v.route.id]:void 0,A=v.route.errorElement||gF,d&&(p<0&&_===0?(TF("route-fallback"),k=!0,M=null):p===_&&(k=!0,M=v.route.hydrateFallbackElement||null)));let P=t.concat(u.slice(0,_+1)),I=()=>{let z;return b?z=A:k?z=M:v.route.Component?z=ce.createElement(v.route.Component,null):v.route.element?z=v.route.element:z=g,ce.createElement(yF,{match:v,routeContext:{outlet:g,matches:P,isDataRoute:r!=null},children:z})};return r&&(v.route.ErrorBoundary||v.route.errorElement||_===0)?ce.createElement(vF,{location:r.location,revalidation:r.revalidation,component:A,error:b,children:I(),routeContext:{outlet:null,matches:P,isDataRoute:!0}}):I()},null)}var dN=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(dN||{}),fN=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(fN||{});function _F(e){let t=ce.useContext(gS);return t||qn(!1),t}function wF(e){let t=ce.useContext(hF);return t||qn(!1),t}function bF(e){let t=ce.useContext(Cc);return t||qn(!1),t}function pN(e){let t=bF(),r=t.matches[t.matches.length-1];return r.route.id||qn(!1),r.route.id}function SF(){var e;let t=ce.useContext(uN),r=wF(),n=pN();return t!==void 0?t:(e=r.errors)==null?void 0:e[n]}function EF(){let{router:e}=_F(dN.UseNavigateStable),t=pN(fN.UseNavigateStable),r=ce.useRef(!1);return cN(()=>{r.current=!0}),ce.useCallback(function(i,s){s===void 0&&(s={}),r.current&&(typeof i=="number"?e.navigate(i):e.navigate(i,am({fromRouteId:t},s)))},[e,t])}const ok={};function TF(e,t,r){ok[e]||(ok[e]=!0)}function CF(e,t){e==null||e.v7_startTransition,e==null||e.v7_relativeSplatPath}function vv(e){let{to:t,replace:r,state:n,relative:i}=e;Rm()||qn(!1);let{future:s,static:u}=ce.useContext(zm),{matches:a}=ce.useContext(Cc),{pathname:d}=M0(),p=hN(),g=oN(t,sN(a,s.v7_relativeSplatPath),d,i==="path"),v=JSON.stringify(g);return ce.useEffect(()=>p(JSON.parse(v),{replace:r,state:n,relative:i}),[p,v,i,r,n]),null}function Cl(e){qn(!1)}function kF(e){let{basename:t="/",children:r=null,location:n,navigationType:i=Ol.Pop,navigator:s,static:u=!1,future:a}=e;Rm()&&qn(!1);let d=t.replace(/^\/*/,"/"),p=ce.useMemo(()=>({basename:d,navigator:s,static:u,future:am({v7_relativeSplatPath:!1},a)}),[d,a,s,u]);typeof n=="string"&&(n=Rd(n));let{pathname:g="/",search:v="",hash:_="",state:b=null,key:k="default"}=n,A=ce.useMemo(()=>{let M=aN(g,d);return M==null?null:{location:{pathname:M,search:v,hash:_,state:b,key:k},navigationType:i}},[d,g,v,_,b,k,i]);return A==null?null:ce.createElement(zm.Provider,{value:p},ce.createElement(A0.Provider,{children:r,value:A}))}function PF(e){let{children:t,location:r}=e;return fF(B1(t),r)}new Promise(()=>{});function B1(e,t){t===void 0&&(t=[]);let r=[];return ce.Children.forEach(e,(n,i)=>{if(!ce.isValidElement(n))return;let s=[...t,i];if(n.type===ce.Fragment){r.push.apply(r,B1(n.props.children,s));return}n.type!==Cl&&qn(!1),!n.props.index||!n.props.children||qn(!1);let u={id:n.props.id||s.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(u.children=B1(n.props.children,s)),r.push(u)}),r}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const IF="6";try{window.__reactRouterVersion=IF}catch{}const AF="startTransition",lk=k5[AF];function MF(e){let{basename:t,children:r,future:n,window:i}=e,s=ce.useRef();s.current==null&&(s.current=FO({window:i,v5Compat:!0}));let u=s.current,[a,d]=ce.useState({action:u.action,location:u.location}),{v7_startTransition:p}=n||{},g=ce.useCallback(v=>{p&&lk?lk(()=>d(v)):d(v)},[d,p]);return ce.useLayoutEffect(()=>u.listen(g),[u,g]),ce.useEffect(()=>CF(n),[n]),ce.createElement(kF,{basename:t,children:r,location:a.location,navigationType:a.action,navigator:u,future:n})}var uk;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(uk||(uk={}));var ck;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(ck||(ck={}));const lc=({title:e,children:t,className:r=""})=>D.jsxs("div",{className:`bg-panel rounded-xl border border-white/10 flex flex-col h-full min-h-0 ${r}`,children:[D.jsx("div",{className:"px-3 py-2 border-b border-white/10 text-sm opacity-80 flex-shrink-0",children:e}),D.jsx("div",{className:"flex-1 min-h-0 flex flex-col relative",children:t})]});var mN={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */(function(e,t){(function(r,n){e.exports=n()})(h5,function(){var r={},n={};function i(u,a,d){if(n[u]=d,u==="index"){var p="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",g={};return n.shared(g),n.index(r,g),typeof window<"u"&&r.setWorkerUrl(window.URL.createObjectURL(new Blob([p],{type:"text/javascript"}))),r}}i("shared",["exports"],function(u){function a(c,l,h,m){return new(h||(h=Promise))(function(w,T){function C(j){try{L(m.next(j))}catch(q){T(q)}}function N(j){try{L(m.throw(j))}catch(q){T(q)}}function L(j){var q;j.done?w(j.value):(q=j.value,q instanceof h?q:new h(function(K){K(q)})).then(C,N)}L((m=m.apply(c,l||[])).next())})}function d(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}typeof SuppressedError=="function"&&SuppressedError;var p=g;function g(c,l){this.x=c,this.y=l}g.prototype={clone:function(){return new g(this.x,this.y)},add:function(c){return this.clone()._add(c)},sub:function(c){return this.clone()._sub(c)},multByPoint:function(c){return this.clone()._multByPoint(c)},divByPoint:function(c){return this.clone()._divByPoint(c)},mult:function(c){return this.clone()._mult(c)},div:function(c){return this.clone()._div(c)},rotate:function(c){return this.clone()._rotate(c)},rotateAround:function(c,l){return this.clone()._rotateAround(c,l)},matMult:function(c){return this.clone()._matMult(c)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(c){return this.x===c.x&&this.y===c.y},dist:function(c){return Math.sqrt(this.distSqr(c))},distSqr:function(c){var l=c.x-this.x,h=c.y-this.y;return l*l+h*h},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith:function(c){return this.angleWithSep(c.x,c.y)},angleWithSep:function(c,l){return Math.atan2(this.x*l-this.y*c,this.x*c+this.y*l)},_matMult:function(c){var l=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=l,this},_add:function(c){return this.x+=c.x,this.y+=c.y,this},_sub:function(c){return this.x-=c.x,this.y-=c.y,this},_mult:function(c){return this.x*=c,this.y*=c,this},_div:function(c){return this.x/=c,this.y/=c,this},_multByPoint:function(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint:function(c){return this.x/=c.x,this.y/=c.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var c=this.y;return this.y=this.x,this.x=-c,this},_rotate:function(c){var l=Math.cos(c),h=Math.sin(c),m=h*this.x+l*this.y;return this.x=l*this.x-h*this.y,this.y=m,this},_rotateAround:function(c,l){var h=Math.cos(c),m=Math.sin(c),w=l.y+m*(this.x-l.x)+h*(this.y-l.y);return this.x=l.x+h*(this.x-l.x)-m*(this.y-l.y),this.y=w,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},g.convert=function(c){return c instanceof g?c:Array.isArray(c)?new g(c[0],c[1]):c};var v=d(p),_=b;function b(c,l,h,m){this.cx=3*c,this.bx=3*(h-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(m-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=l,this.p2x=h,this.p2y=m}b.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,l){if(l===void 0&&(l=1e-6),c<0)return 0;if(c>1)return 1;for(var h=c,m=0;m<8;m++){var w=this.sampleCurveX(h)-c;if(Math.abs(w)<l)return h;var T=this.sampleCurveDerivativeX(h);if(Math.abs(T)<1e-6)break;h-=w/T}var C=0,N=1;for(h=c,m=0;m<20&&(w=this.sampleCurveX(h),!(Math.abs(w-c)<l));m++)c>w?C=h:N=h,h=.5*(N-C)+C;return h},solve:function(c,l){return this.sampleCurveY(this.solveCurveX(c,l))}};var k=d(_);let A,M;function P(){return A==null&&(A=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),A}function I(){if(M==null&&(M=!1,P())){const l=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(l){for(let m=0;m<5*5;m++){const w=4*m;l.fillStyle=`rgb(${w},${w+1},${w+2})`,l.fillRect(m%5,Math.floor(m/5),1,1)}const h=l.getImageData(0,0,5,5).data;for(let m=0;m<5*5*4;m++)if(m%4!=3&&h[m]!==m){M=!0;break}}}return M||!1}function z(c,l,h,m){const w=new k(c,l,h,m);return T=>w.solve(T)}const O=z(.25,.1,.25,1);function V(c,l,h){return Math.min(h,Math.max(l,c))}function U(c,l,h){const m=h-l,w=((c-l)%m+m)%m+l;return w===l?h:w}function $(c,...l){for(const h of l)for(const m in h)c[m]=h[m];return c}let G=1;function Z(c,l,h){const m={};for(const w in c)m[w]=l.call(this,c[w],w,c);return m}function Q(c,l,h){const m={};for(const w in c)l.call(this,c[w],w,c)&&(m[w]=c[w]);return m}function X(c){return Array.isArray(c)?c.map(X):typeof c=="object"&&c?Z(c,X):c}const ie={};function te(c){ie[c]||(typeof console<"u"&&console.warn(c),ie[c]=!0)}function W(c,l,h){return(h.y-c.y)*(l.x-c.x)>(l.y-c.y)*(h.x-c.x)}function oe(c){return typeof WorkerGlobalScope<"u"&&c!==void 0&&c instanceof WorkerGlobalScope}let se=null;function de(c){return typeof ImageBitmap<"u"&&c instanceof ImageBitmap}const me="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ae(c,l,h,m,w){return a(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const T=new VideoFrame(c,{timestamp:0});try{const C=T==null?void 0:T.format;if(!C||!C.startsWith("BGR")&&!C.startsWith("RGB"))throw new Error(`Unrecognized format ${C}`);const N=C.startsWith("BGR"),L=new Uint8ClampedArray(m*w*4);if(yield T.copyTo(L,function(j,q,K,ne,ue){const ge=4*Math.max(-q,0),ye=(Math.max(0,K)-K)*ne*4+ge,Te=4*ne,Pe=Math.max(0,q),We=Math.max(0,K);return{rect:{x:Pe,y:We,width:Math.min(j.width,q+ne)-Pe,height:Math.min(j.height,K+ue)-We},layout:[{offset:ye,stride:Te}]}}(c,l,h,m,w)),N)for(let j=0;j<L.length;j+=4){const q=L[j];L[j]=L[j+2],L[j+2]=q}return L}finally{T.close()}})}let ve,pe;const _e="AbortError";function De(){return new Error(_e)}const Le={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function je(c){return Le.REGISTERED_PROTOCOLS[c.substring(0,c.indexOf("://"))]}const Je="global-dispatcher";class et extends Error{constructor(l,h,m,w){super(`AJAXError: ${h} (${l}): ${m}`),this.status=l,this.statusText=h,this.url=m,this.body=w}}const ft=()=>oe(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,rt=function(c,l){if(/:\/\//.test(c.url)&&!/^https?:|^file:/.test(c.url)){const m=je(c.url);if(m)return m(c,l);if(oe(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,targetMapId:Je},l)}if(!(/^file:/.test(h=c.url)||/^file:/.test(ft())&&!/^\w+:/.test(h))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(m,w){return a(this,void 0,void 0,function*(){const T=new Request(m.url,{method:m.method||"GET",body:m.body,credentials:m.credentials,headers:m.headers,cache:m.cache,referrer:ft(),signal:w.signal});m.type!=="json"||T.headers.has("Accept")||T.headers.set("Accept","application/json");const C=yield fetch(T);if(!C.ok){const j=yield C.blob();throw new et(C.status,C.statusText,m.url,j)}let N;N=m.type==="arrayBuffer"||m.type==="image"?C.arrayBuffer():m.type==="json"?C.json():C.text();const L=yield N;if(w.signal.aborted)throw De();return{data:L,cacheControl:C.headers.get("Cache-Control"),expires:C.headers.get("Expires")}})}(c,l);if(oe(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,mustQueue:!0,targetMapId:Je},l)}var h;return function(m,w){return new Promise((T,C)=>{var N;const L=new XMLHttpRequest;L.open(m.method||"GET",m.url,!0),m.type!=="arrayBuffer"&&m.type!=="image"||(L.responseType="arraybuffer");for(const j in m.headers)L.setRequestHeader(j,m.headers[j]);m.type==="json"&&(L.responseType="text",!((N=m.headers)===null||N===void 0)&&N.Accept||L.setRequestHeader("Accept","application/json")),L.withCredentials=m.credentials==="include",L.onerror=()=>{C(new Error(L.statusText))},L.onload=()=>{if(!w.signal.aborted)if((L.status>=200&&L.status<300||L.status===0)&&L.response!==null){let j=L.response;if(m.type==="json")try{j=JSON.parse(L.response)}catch(q){return void C(q)}T({data:j,cacheControl:L.getResponseHeader("Cache-Control"),expires:L.getResponseHeader("Expires")})}else{const j=new Blob([L.response],{type:L.getResponseHeader("Content-Type")});C(new et(L.status,L.statusText,m.url,j))}},w.signal.addEventListener("abort",()=>{L.abort(),C(De())}),L.send(m.body)})}(c,l)};function Oe(c){if(!c||c.indexOf("://")<=0||c.indexOf("data:image/")===0||c.indexOf("blob:")===0)return!0;const l=new URL(c),h=window.location;return l.protocol===h.protocol&&l.host===h.host}function Ge(c,l,h){h[c]&&h[c].indexOf(l)!==-1||(h[c]=h[c]||[],h[c].push(l))}function Ze(c,l,h){if(h&&h[c]){const m=h[c].indexOf(l);m!==-1&&h[c].splice(m,1)}}class it{constructor(l,h={}){$(this,h),this.type=l}}class mt extends it{constructor(l,h={}){super("error",$({error:l},h))}}class Tt{on(l,h){return this._listeners=this._listeners||{},Ge(l,h,this._listeners),this}off(l,h){return Ze(l,h,this._listeners),Ze(l,h,this._oneTimeListeners),this}once(l,h){return h?(this._oneTimeListeners=this._oneTimeListeners||{},Ge(l,h,this._oneTimeListeners),this):new Promise(m=>this.once(l,m))}fire(l,h){typeof l=="string"&&(l=new it(l,h||{}));const m=l.type;if(this.listens(m)){l.target=this;const w=this._listeners&&this._listeners[m]?this._listeners[m].slice():[];for(const N of w)N.call(this,l);const T=this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[];for(const N of T)Ze(m,N,this._oneTimeListeners),N.call(this,l);const C=this._eventedParent;C&&($(l,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),C.fire(l))}else l instanceof mt&&console.error(l.error);return this}listens(l){return this._listeners&&this._listeners[l]&&this._listeners[l].length>0||this._oneTimeListeners&&this._oneTimeListeners[l]&&this._oneTimeListeners[l].length>0||this._eventedParent&&this._eventedParent.listens(l)}setEventedParent(l,h){return this._eventedParent=l,this._eventedParentData=h,this}}var $e={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const At=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function pt(c,l){const h={};for(const m in c)m!=="ref"&&(h[m]=c[m]);return At.forEach(m=>{m in l&&(h[m]=l[m])}),h}function yt(c,l){if(Array.isArray(c)){if(!Array.isArray(l)||c.length!==l.length)return!1;for(let h=0;h<c.length;h++)if(!yt(c[h],l[h]))return!1;return!0}if(typeof c=="object"&&c!==null&&l!==null){if(typeof l!="object"||Object.keys(c).length!==Object.keys(l).length)return!1;for(const h in c)if(!yt(c[h],l[h]))return!1;return!0}return c===l}function gt(c,l){c.push(l)}function qt(c,l,h){gt(h,{command:"addSource",args:[c,l[c]]})}function $t(c,l,h){gt(l,{command:"removeSource",args:[c]}),h[c]=!0}function er(c,l,h,m){$t(c,h,m),qt(c,l,h)}function Vt(c,l,h){let m;for(m in c[h])if(Object.prototype.hasOwnProperty.call(c[h],m)&&m!=="data"&&!yt(c[h][m],l[h][m]))return!1;for(m in l[h])if(Object.prototype.hasOwnProperty.call(l[h],m)&&m!=="data"&&!yt(c[h][m],l[h][m]))return!1;return!0}function tr(c,l,h,m,w,T){c=c||{},l=l||{};for(const C in c)Object.prototype.hasOwnProperty.call(c,C)&&(yt(c[C],l[C])||h.push({command:T,args:[m,C,l[C],w]}));for(const C in l)Object.prototype.hasOwnProperty.call(l,C)&&!Object.prototype.hasOwnProperty.call(c,C)&&(yt(c[C],l[C])||h.push({command:T,args:[m,C,l[C],w]}))}function pr(c){return c.id}function vr(c,l){return c[l.id]=l,c}class lt{constructor(l,h,m,w){this.message=(l?`${l}: `:"")+m,w&&(this.identifier=w),h!=null&&h.__line__&&(this.line=h.__line__)}}function mr(c,...l){for(const h of l)for(const m in h)c[m]=h[m];return c}class Ht extends Error{constructor(l,h){super(h),this.message=h,this.key=l}}class wt{constructor(l,h=[]){this.parent=l,this.bindings={};for(const[m,w]of h)this.bindings[m]=w}concat(l){return new wt(this,l)}get(l){if(this.bindings[l])return this.bindings[l];if(this.parent)return this.parent.get(l);throw new Error(`${l} not found in scope.`)}has(l){return!!this.bindings[l]||!!this.parent&&this.parent.has(l)}}const at={kind:"null"},le={kind:"number"},Be={kind:"string"},Ue={kind:"boolean"},tt={kind:"color"},st={kind:"object"},dt={kind:"value"},ht={kind:"collator"},Ot={kind:"formatted"},Lt={kind:"padding"},Kt={kind:"resolvedImage"},Se={kind:"variableAnchorOffsetCollection"};function re(c,l){return{kind:"array",itemType:c,N:l}}function ee(c){if(c.kind==="array"){const l=ee(c.itemType);return typeof c.N=="number"?`array<${l}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${l}>`}return c.kind}const fe=[at,le,Be,Ue,tt,Ot,st,re(dt),Lt,Kt,Se];function we(c,l){if(l.kind==="error")return null;if(c.kind==="array"){if(l.kind==="array"&&(l.N===0&&l.itemType.kind==="value"||!we(c.itemType,l.itemType))&&(typeof c.N!="number"||c.N===l.N))return null}else{if(c.kind===l.kind)return null;if(c.kind==="value"){for(const h of fe)if(!we(h,l))return null}}return`Expected ${ee(c)} but found ${ee(l)} instead.`}function Me(c,l){return l.some(h=>h.kind===c.kind)}function Ne(c,l){return l.some(h=>h==="null"?c===null:h==="array"?Array.isArray(c):h==="object"?c&&!Array.isArray(c)&&typeof c=="object":h===typeof c)}function Ve(c,l){return c.kind==="array"&&l.kind==="array"?c.itemType.kind===l.itemType.kind&&typeof c.N=="number":c.kind===l.kind}const ke=.96422,Ye=.82521,ot=4/29,Xe=6/29,xt=3*Xe*Xe,Ct=Xe*Xe*Xe,Ut=Math.PI/180,gr=180/Math.PI;function ar(c){return(c%=360)<0&&(c+=360),c}function xr([c,l,h,m]){let w,T;const C=kr((.2225045*(c=fr(c))+.7168786*(l=fr(l))+.0606169*(h=fr(h)))/1);c===l&&l===h?w=T=C:(w=kr((.4360747*c+.3850649*l+.1430804*h)/ke),T=kr((.0139322*c+.0971045*l+.7141733*h)/Ye));const N=116*C-16;return[N<0?0:N,500*(w-C),200*(C-T),m]}function fr(c){return c<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function kr(c){return c>Ct?Math.pow(c,1/3):c/xt+ot}function _r([c,l,h,m]){let w=(c+16)/116,T=isNaN(l)?w:w+l/500,C=isNaN(h)?w:w-h/200;return w=1*Er(w),T=ke*Er(T),C=Ye*Er(C),[rr(3.1338561*T-1.6168667*w-.4906146*C),rr(-.9787684*T+1.9161415*w+.033454*C),rr(.0719453*T-.2289914*w+1.4052427*C),m]}function rr(c){return(c=c<=.00304?12.92*c:1.055*Math.pow(c,1/2.4)-.055)<0?0:c>1?1:c}function Er(c){return c>Xe?c*c*c:xt*(c-ot)}function br(c){return parseInt(c.padEnd(2,c),16)/255}function cn(c,l){return wn(l?c/100:c,0,1)}function wn(c,l,h){return Math.min(Math.max(l,c),h)}function Pn(c){return!c.some(Number.isNaN)}const $a={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Mr{constructor(l,h,m,w=1,T=!0){this.r=l,this.g=h,this.b=m,this.a=w,T||(this.r*=w,this.g*=w,this.b*=w,w||this.overwriteGetter("rgb",[l,h,m,w]))}static parse(l){if(l instanceof Mr)return l;if(typeof l!="string")return;const h=function(m){if((m=m.toLowerCase().trim())==="transparent")return[0,0,0,0];const w=$a[m];if(w){const[C,N,L]=w;return[C/255,N/255,L/255,1]}if(m.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(m)){const C=m.length<6?1:2;let N=1;return[br(m.slice(N,N+=C)),br(m.slice(N,N+=C)),br(m.slice(N,N+=C)),br(m.slice(N,N+C)||"ff")]}if(m.startsWith("rgb")){const C=m.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(C){const[N,L,j,q,K,ne,ue,ge,ye,Te,Pe,We]=C,Re=[q||" ",ue||" ",Te].join("");if(Re==="  "||Re==="  /"||Re===",,"||Re===",,,"){const He=[j,ne,ye].join(""),nt=He==="%%%"?100:He===""?255:0;if(nt){const vt=[wn(+L/nt,0,1),wn(+K/nt,0,1),wn(+ge/nt,0,1),Pe?cn(+Pe,We):1];if(Pn(vt))return vt}}return}}const T=m.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(T){const[C,N,L,j,q,K,ne,ue,ge]=T,ye=[L||" ",q||" ",ne].join("");if(ye==="  "||ye==="  /"||ye===",,"||ye===",,,"){const Te=[+N,wn(+j,0,100),wn(+K,0,100),ue?cn(+ue,ge):1];if(Pn(Te))return function([Pe,We,Re,He]){function nt(vt){const Nt=(vt+Pe/30)%12,nr=We*Math.min(Re,1-Re);return Re-nr*Math.max(-1,Math.min(Nt-3,9-Nt,1))}return Pe=ar(Pe),We/=100,Re/=100,[nt(0),nt(8),nt(4),He]}(Te)}}}(l);return h?new Mr(...h,!1):void 0}get rgb(){const{r:l,g:h,b:m,a:w}=this,T=w||1/0;return this.overwriteGetter("rgb",[l/T,h/T,m/T,w])}get hcl(){return this.overwriteGetter("hcl",function(l){const[h,m,w,T]=xr(l),C=Math.sqrt(m*m+w*w);return[Math.round(1e4*C)?ar(Math.atan2(w,m)*gr):NaN,C,h,T]}(this.rgb))}get lab(){return this.overwriteGetter("lab",xr(this.rgb))}overwriteGetter(l,h){return Object.defineProperty(this,l,{value:h}),h}toString(){const[l,h,m,w]=this.rgb;return`rgba(${[l,h,m].map(T=>Math.round(255*T)).join(",")},${w})`}}Mr.black=new Mr(0,0,0,1),Mr.white=new Mr(1,1,1,1),Mr.transparent=new Mr(0,0,0,0),Mr.red=new Mr(1,0,0,1);class to{constructor(l,h,m){this.sensitivity=l?h?"variant":"case":h?"accent":"base",this.locale=m,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(l,h){return this.collator.compare(l,h)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ro{constructor(l,h,m,w,T){this.text=l,this.image=h,this.scale=m,this.fontStack=w,this.textColor=T}}class Hn{constructor(l){this.sections=l}static fromString(l){return new Hn([new ro(l,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(l=>l.text.length!==0||l.image&&l.image.name.length!==0)}static factory(l){return l instanceof Hn?l:Hn.fromString(l)}toString(){return this.sections.length===0?"":this.sections.map(l=>l.text).join("")}}class bn{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof bn)return l;if(typeof l=="number")return new bn([l,l,l,l]);if(Array.isArray(l)&&!(l.length<1||l.length>4)){for(const h of l)if(typeof h!="number")return;switch(l.length){case 1:l=[l[0],l[0],l[0],l[0]];break;case 2:l=[l[0],l[1],l[0],l[1]];break;case 3:l=[l[0],l[1],l[2],l[1]]}return new bn(l)}}toString(){return JSON.stringify(this.values)}}const Ms=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Nn{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof Nn)return l;if(Array.isArray(l)&&!(l.length<1)&&l.length%2==0){for(let h=0;h<l.length;h+=2){const m=l[h],w=l[h+1];if(typeof m!="string"||!Ms.has(m)||!Array.isArray(w)||w.length!==2||typeof w[0]!="number"||typeof w[1]!="number")return}return new Nn(l)}}toString(){return JSON.stringify(this.values)}}class Bn{constructor(l){this.name=l.name,this.available=l.available}toString(){return this.name}static fromString(l){return l?new Bn({name:l,available:!1}):null}}function ba(c,l,h,m){return typeof c=="number"&&c>=0&&c<=255&&typeof l=="number"&&l>=0&&l<=255&&typeof h=="number"&&h>=0&&h<=255?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:`Invalid rgba value [${[c,l,h,m].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof m=="number"?[c,l,h,m]:[c,l,h]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function qi(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof Mr||c instanceof to||c instanceof Hn||c instanceof bn||c instanceof Nn||c instanceof Bn)return!0;if(Array.isArray(c)){for(const l of c)if(!qi(l))return!1;return!0}if(typeof c=="object"){for(const l in c)if(!qi(c[l]))return!1;return!0}return!1}function Rr(c){if(c===null)return at;if(typeof c=="string")return Be;if(typeof c=="boolean")return Ue;if(typeof c=="number")return le;if(c instanceof Mr)return tt;if(c instanceof to)return ht;if(c instanceof Hn)return Ot;if(c instanceof bn)return Lt;if(c instanceof Nn)return Se;if(c instanceof Bn)return Kt;if(Array.isArray(c)){const l=c.length;let h;for(const m of c){const w=Rr(m);if(h){if(h===w)continue;h=dt;break}h=w}return re(h||dt,l)}return st}function us(c){const l=typeof c;return c===null?"":l==="string"||l==="number"||l==="boolean"?String(c):c instanceof Mr||c instanceof Hn||c instanceof bn||c instanceof Nn||c instanceof Bn?c.toString():JSON.stringify(c)}class Pi{constructor(l,h){this.type=l,this.value=h}static parse(l,h){if(l.length!==2)return h.error(`'literal' expression requires exactly one argument, but found ${l.length-1} instead.`);if(!qi(l[1]))return h.error("invalid value");const m=l[1];let w=Rr(m);const T=h.expectedType;return w.kind!=="array"||w.N!==0||!T||T.kind!=="array"||typeof T.N=="number"&&T.N!==0||(w=T),new Pi(w,m)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Wr{constructor(l){this.name="ExpressionEvaluationError",this.message=l}toJSON(){return this.message}}const ti={string:Be,number:le,boolean:Ue,object:st};class Hi{constructor(l,h){this.type=l,this.args=h}static parse(l,h){if(l.length<2)return h.error("Expected at least one argument.");let m,w=1;const T=l[0];if(T==="array"){let N,L;if(l.length>2){const j=l[1];if(typeof j!="string"||!(j in ti)||j==="object")return h.error('The item type argument of "array" must be one of string, number, boolean',1);N=ti[j],w++}else N=dt;if(l.length>3){if(l[2]!==null&&(typeof l[2]!="number"||l[2]<0||l[2]!==Math.floor(l[2])))return h.error('The length argument to "array" must be a positive integer literal',2);L=l[2],w++}m=re(N,L)}else{if(!ti[T])throw new Error(`Types doesn't contain name = ${T}`);m=ti[T]}const C=[];for(;w<l.length;w++){const N=h.parse(l[w],w,dt);if(!N)return null;C.push(N)}return new Hi(m,C)}evaluate(l){for(let h=0;h<this.args.length;h++){const m=this.args[h].evaluate(l);if(!we(this.type,Rr(m)))return m;if(h===this.args.length-1)throw new Wr(`Expected value to be of type ${ee(this.type)}, but found ${ee(Rr(m))} instead.`)}throw new Error}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}const Mc={"to-boolean":Ue,"to-color":tt,"to-number":le,"to-string":Be};class Gi{constructor(l,h){this.type=l,this.args=h}static parse(l,h){if(l.length<2)return h.error("Expected at least one argument.");const m=l[0];if(!Mc[m])throw new Error(`Can't parse ${m} as it is not part of the known types`);if((m==="to-boolean"||m==="to-string")&&l.length!==2)return h.error("Expected one argument.");const w=Mc[m],T=[];for(let C=1;C<l.length;C++){const N=h.parse(l[C],C,dt);if(!N)return null;T.push(N)}return new Gi(w,T)}evaluate(l){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(l);case"color":{let h,m;for(const w of this.args){if(h=w.evaluate(l),m=null,h instanceof Mr)return h;if(typeof h=="string"){const T=l.parseColor(h);if(T)return T}else if(Array.isArray(h)&&(m=h.length<3||h.length>4?`Invalid rbga value ${JSON.stringify(h)}: expected an array containing either three or four numeric values.`:ba(h[0],h[1],h[2],h[3]),!m))return new Mr(h[0]/255,h[1]/255,h[2]/255,h[3])}throw new Wr(m||`Could not parse color from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"padding":{let h;for(const m of this.args){h=m.evaluate(l);const w=bn.parse(h);if(w)return w}throw new Wr(`Could not parse padding from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"variableAnchorOffsetCollection":{let h;for(const m of this.args){h=m.evaluate(l);const w=Nn.parse(h);if(w)return w}throw new Wr(`Could not parse variableAnchorOffsetCollection from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"number":{let h=null;for(const m of this.args){if(h=m.evaluate(l),h===null)return 0;const w=Number(h);if(!isNaN(w))return w}throw new Wr(`Could not convert ${JSON.stringify(h)} to number.`)}case"formatted":return Hn.fromString(us(this.args[0].evaluate(l)));case"resolvedImage":return Bn.fromString(us(this.args[0].evaluate(l)));default:return us(this.args[0].evaluate(l))}}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}const hx=["Unknown","Point","LineString","Polygon"];class Dc{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?hx[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(l){let h=this._parseColorCache[l];return h||(h=this._parseColorCache[l]=Mr.parse(l)),h}}class no{constructor(l,h,m=[],w,T=new wt,C=[]){this.registry=l,this.path=m,this.key=m.map(N=>`[${N}]`).join(""),this.scope=T,this.errors=C,this.expectedType=w,this._isConstant=h}parse(l,h,m,w,T={}){return h?this.concat(h,m,w)._parse(l,T):this._parse(l,T)}_parse(l,h){function m(w,T,C){return C==="assert"?new Hi(T,[w]):C==="coerce"?new Gi(T,[w]):w}if(l!==null&&typeof l!="string"&&typeof l!="boolean"&&typeof l!="number"||(l=["literal",l]),Array.isArray(l)){if(l.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const w=l[0];if(typeof w!="string")return this.error(`Expression name must be a string, but found ${typeof w} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const T=this.registry[w];if(T){let C=T.parse(l,this);if(!C)return null;if(this.expectedType){const N=this.expectedType,L=C.type;if(N.kind!=="string"&&N.kind!=="number"&&N.kind!=="boolean"&&N.kind!=="object"&&N.kind!=="array"||L.kind!=="value")if(N.kind!=="color"&&N.kind!=="formatted"&&N.kind!=="resolvedImage"||L.kind!=="value"&&L.kind!=="string")if(N.kind!=="padding"||L.kind!=="value"&&L.kind!=="number"&&L.kind!=="array")if(N.kind!=="variableAnchorOffsetCollection"||L.kind!=="value"&&L.kind!=="array"){if(this.checkSubtype(N,L))return null}else C=m(C,N,h.typeAnnotation||"coerce");else C=m(C,N,h.typeAnnotation||"coerce");else C=m(C,N,h.typeAnnotation||"coerce");else C=m(C,N,h.typeAnnotation||"assert")}if(!(C instanceof Pi)&&C.type.kind!=="resolvedImage"&&this._isConstant(C)){const N=new Dc;try{C=new Pi(C.type,C.evaluate(N))}catch(L){return this.error(L.message),null}}return C}return this.error(`Unknown expression "${w}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(l===void 0?"'undefined' value invalid. Use null instead.":typeof l=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof l} instead.`)}concat(l,h,m){const w=typeof l=="number"?this.path.concat(l):this.path,T=m?this.scope.concat(m):this.scope;return new no(this.registry,this._isConstant,w,h||null,T,this.errors)}error(l,...h){const m=`${this.key}${h.map(w=>`[${w}]`).join("")}`;this.errors.push(new Ht(m,l))}checkSubtype(l,h){const m=we(l,h);return m&&this.error(m),m}}class Ds{constructor(l,h){this.type=h.type,this.bindings=[].concat(l),this.result=h}evaluate(l){return this.result.evaluate(l)}eachChild(l){for(const h of this.bindings)l(h[1]);l(this.result)}static parse(l,h){if(l.length<4)return h.error(`Expected at least 3 arguments, but found ${l.length-1} instead.`);const m=[];for(let T=1;T<l.length-1;T+=2){const C=l[T];if(typeof C!="string")return h.error(`Expected string, but found ${typeof C} instead.`,T);if(/[^a-zA-Z0-9_]/.test(C))return h.error("Variable names must contain only alphanumeric characters or '_'.",T);const N=h.parse(l[T+1],T+1);if(!N)return null;m.push([C,N])}const w=h.parse(l[l.length-1],l.length-1,h.expectedType,m);return w?new Ds(m,w):null}outputDefined(){return this.result.outputDefined()}}class zr{constructor(l,h){this.type=h.type,this.name=l,this.boundExpression=h}static parse(l,h){if(l.length!==2||typeof l[1]!="string")return h.error("'var' expression requires exactly one string literal argument.");const m=l[1];return h.scope.has(m)?new zr(m,h.scope.get(m)):h.error(`Unknown variable "${m}". Make sure "${m}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(l){return this.boundExpression.evaluate(l)}eachChild(){}outputDefined(){return!1}}class Vd{constructor(l,h,m){this.type=l,this.index=h,this.input=m}static parse(l,h){if(l.length!==3)return h.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const m=h.parse(l[1],1,le),w=h.parse(l[2],2,re(h.expectedType||dt));return m&&w?new Vd(w.type.itemType,m,w):null}evaluate(l){const h=this.index.evaluate(l),m=this.input.evaluate(l);if(h<0)throw new Wr(`Array index out of bounds: ${h} < 0.`);if(h>=m.length)throw new Wr(`Array index out of bounds: ${h} > ${m.length-1}.`);if(h!==Math.floor(h))throw new Wr(`Array index must be an integer, but found ${h} instead.`);return m[h]}eachChild(l){l(this.index),l(this.input)}outputDefined(){return!1}}class Ud{constructor(l,h){this.type=Ue,this.needle=l,this.haystack=h}static parse(l,h){if(l.length!==3)return h.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const m=h.parse(l[1],1,dt),w=h.parse(l[2],2,dt);return m&&w?Me(m.type,[Ue,Be,le,at,dt])?new Ud(m,w):h.error(`Expected first argument to be of type boolean, string, number or null, but found ${ee(m.type)} instead`):null}evaluate(l){const h=this.needle.evaluate(l),m=this.haystack.evaluate(l);if(!m)return!1;if(!Ne(h,["boolean","string","number","null"]))throw new Wr(`Expected first argument to be of type boolean, string, number or null, but found ${ee(Rr(h))} instead.`);if(!Ne(m,["string","array"]))throw new Wr(`Expected second argument to be of type array or string, but found ${ee(Rr(m))} instead.`);return m.indexOf(h)>=0}eachChild(l){l(this.needle),l(this.haystack)}outputDefined(){return!0}}class Ho{constructor(l,h,m){this.type=le,this.needle=l,this.haystack=h,this.fromIndex=m}static parse(l,h){if(l.length<=2||l.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);const m=h.parse(l[1],1,dt),w=h.parse(l[2],2,dt);if(!m||!w)return null;if(!Me(m.type,[Ue,Be,le,at,dt]))return h.error(`Expected first argument to be of type boolean, string, number or null, but found ${ee(m.type)} instead`);if(l.length===4){const T=h.parse(l[3],3,le);return T?new Ho(m,w,T):null}return new Ho(m,w)}evaluate(l){const h=this.needle.evaluate(l),m=this.haystack.evaluate(l);if(!Ne(h,["boolean","string","number","null"]))throw new Wr(`Expected first argument to be of type boolean, string, number or null, but found ${ee(Rr(h))} instead.`);let w;if(this.fromIndex&&(w=this.fromIndex.evaluate(l)),Ne(m,["string"])){const T=m.indexOf(h,w);return T===-1?-1:[...m.slice(0,T)].length}if(Ne(m,["array"]))return m.indexOf(h,w);throw new Wr(`Expected second argument to be of type array or string, but found ${ee(Rr(m))} instead.`)}eachChild(l){l(this.needle),l(this.haystack),this.fromIndex&&l(this.fromIndex)}outputDefined(){return!1}}class qd{constructor(l,h,m,w,T,C){this.inputType=l,this.type=h,this.input=m,this.cases=w,this.outputs=T,this.otherwise=C}static parse(l,h){if(l.length<5)return h.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if(l.length%2!=1)return h.error("Expected an even number of arguments.");let m,w;h.expectedType&&h.expectedType.kind!=="value"&&(w=h.expectedType);const T={},C=[];for(let j=2;j<l.length-1;j+=2){let q=l[j];const K=l[j+1];Array.isArray(q)||(q=[q]);const ne=h.concat(j);if(q.length===0)return ne.error("Expected at least one branch label.");for(const ge of q){if(typeof ge!="number"&&typeof ge!="string")return ne.error("Branch labels must be numbers or strings.");if(typeof ge=="number"&&Math.abs(ge)>Number.MAX_SAFE_INTEGER)return ne.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ge=="number"&&Math.floor(ge)!==ge)return ne.error("Numeric branch labels must be integer values.");if(m){if(ne.checkSubtype(m,Rr(ge)))return null}else m=Rr(ge);if(T[String(ge)]!==void 0)return ne.error("Branch labels must be unique.");T[String(ge)]=C.length}const ue=h.parse(K,j,w);if(!ue)return null;w=w||ue.type,C.push(ue)}const N=h.parse(l[1],1,dt);if(!N)return null;const L=h.parse(l[l.length-1],l.length-1,w);return L?N.type.kind!=="value"&&h.concat(1).checkSubtype(m,N.type)?null:new qd(m,w,N,T,C,L):null}evaluate(l){const h=this.input.evaluate(l);return(Rr(h)===this.inputType&&this.outputs[this.cases[h]]||this.otherwise).evaluate(l)}eachChild(l){l(this.input),this.outputs.forEach(l),l(this.otherwise)}outputDefined(){return this.outputs.every(l=>l.outputDefined())&&this.otherwise.outputDefined()}}class Nc{constructor(l,h,m){this.type=l,this.branches=h,this.otherwise=m}static parse(l,h){if(l.length<4)return h.error(`Expected at least 3 arguments, but found only ${l.length-1}.`);if(l.length%2!=0)return h.error("Expected an odd number of arguments.");let m;h.expectedType&&h.expectedType.kind!=="value"&&(m=h.expectedType);const w=[];for(let C=1;C<l.length-1;C+=2){const N=h.parse(l[C],C,Ue);if(!N)return null;const L=h.parse(l[C+1],C+1,m);if(!L)return null;w.push([N,L]),m=m||L.type}const T=h.parse(l[l.length-1],l.length-1,m);if(!T)return null;if(!m)throw new Error("Can't infer output type");return new Nc(m,w,T)}evaluate(l){for(const[h,m]of this.branches)if(h.evaluate(l))return m.evaluate(l);return this.otherwise.evaluate(l)}eachChild(l){for(const[h,m]of this.branches)l(h),l(m);l(this.otherwise)}outputDefined(){return this.branches.every(([l,h])=>h.outputDefined())&&this.otherwise.outputDefined()}}class gu{constructor(l,h,m,w){this.type=l,this.input=h,this.beginIndex=m,this.endIndex=w}static parse(l,h){if(l.length<=2||l.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);const m=h.parse(l[1],1,dt),w=h.parse(l[2],2,le);if(!m||!w)return null;if(!Me(m.type,[re(dt),Be,dt]))return h.error(`Expected first argument to be of type array or string, but found ${ee(m.type)} instead`);if(l.length===4){const T=h.parse(l[3],3,le);return T?new gu(m.type,m,w,T):null}return new gu(m.type,m,w)}evaluate(l){const h=this.input.evaluate(l),m=this.beginIndex.evaluate(l);let w;if(this.endIndex&&(w=this.endIndex.evaluate(l)),Ne(h,["string"]))return[...h].slice(m,w).join("");if(Ne(h,["array"]))return h.slice(m,w);throw new Wr(`Expected first argument to be of type array or string, but found ${ee(Rr(h))} instead.`)}eachChild(l){l(this.input),l(this.beginIndex),this.endIndex&&l(this.endIndex)}outputDefined(){return!1}}function zc(c,l){const h=c.length-1;let m,w,T=0,C=h,N=0;for(;T<=C;)if(N=Math.floor((T+C)/2),m=c[N],w=c[N+1],m<=l){if(N===h||l<w)return N;T=N+1}else{if(!(m>l))throw new Wr("Input is not a number.");C=N-1}return 0}class Go{constructor(l,h,m){this.type=l,this.input=h,this.labels=[],this.outputs=[];for(const[w,T]of m)this.labels.push(w),this.outputs.push(T)}static parse(l,h){if(l.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return h.error("Expected an even number of arguments.");const m=h.parse(l[1],1,le);if(!m)return null;const w=[];let T=null;h.expectedType&&h.expectedType.kind!=="value"&&(T=h.expectedType);for(let C=1;C<l.length;C+=2){const N=C===1?-1/0:l[C],L=l[C+1],j=C,q=C+1;if(typeof N!="number")return h.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',j);if(w.length&&w[w.length-1][0]>=N)return h.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',j);const K=h.parse(L,q,T);if(!K)return null;T=T||K.type,w.push([N,K])}return new Go(T,m,w)}evaluate(l){const h=this.labels,m=this.outputs;if(h.length===1)return m[0].evaluate(l);const w=this.input.evaluate(l);if(w<=h[0])return m[0].evaluate(l);const T=h.length;return w>=h[T-1]?m[T-1].evaluate(l):m[zc(h,w)].evaluate(l)}eachChild(l){l(this.input);for(const h of this.outputs)l(h)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}}function Jm(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var dx=Qm;function Qm(c,l,h,m){this.cx=3*c,this.bx=3*(h-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(m-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=l,this.p2x=h,this.p2y=m}Qm.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,l){if(l===void 0&&(l=1e-6),c<0)return 0;if(c>1)return 1;for(var h=c,m=0;m<8;m++){var w=this.sampleCurveX(h)-c;if(Math.abs(w)<l)return h;var T=this.sampleCurveDerivativeX(h);if(Math.abs(T)<1e-6)break;h-=w/T}var C=0,N=1;for(h=c,m=0;m<20&&(w=this.sampleCurveX(h),!(Math.abs(w-c)<l));m++)c>w?C=h:N=h,h=.5*(N-C)+C;return h},solve:function(c,l){return this.sampleCurveY(this.solveCurveX(c,l))}};var fx=Jm(dx);function io(c,l,h){return c+h*(l-c)}function vu(c,l,h){return c.map((m,w)=>io(m,l[w],h))}const Ii={number:io,color:function(c,l,h,m="rgb"){switch(m){case"rgb":{const[w,T,C,N]=vu(c.rgb,l.rgb,h);return new Mr(w,T,C,N,!1)}case"hcl":{const[w,T,C,N]=c.hcl,[L,j,q,K]=l.hcl;let ne,ue;if(isNaN(w)||isNaN(L))isNaN(w)?isNaN(L)?ne=NaN:(ne=L,C!==1&&C!==0||(ue=j)):(ne=w,q!==1&&q!==0||(ue=T));else{let We=L-w;L>w&&We>180?We-=360:L<w&&w-L>180&&(We+=360),ne=w+h*We}const[ge,ye,Te,Pe]=function([We,Re,He,nt]){return We=isNaN(We)?0:We*Ut,_r([He,Math.cos(We)*Re,Math.sin(We)*Re,nt])}([ne,ue??io(T,j,h),io(C,q,h),io(N,K,h)]);return new Mr(ge,ye,Te,Pe,!1)}case"lab":{const[w,T,C,N]=_r(vu(c.lab,l.lab,h));return new Mr(w,T,C,N,!1)}}},array:vu,padding:function(c,l,h){return new bn(vu(c.values,l.values,h))},variableAnchorOffsetCollection:function(c,l,h){const m=c.values,w=l.values;if(m.length!==w.length)throw new Wr(`Cannot interpolate values of different length. from: ${c.toString()}, to: ${l.toString()}`);const T=[];for(let C=0;C<m.length;C+=2){if(m[C]!==w[C])throw new Wr(`Cannot interpolate values containing mismatched anchors. from[${C}]: ${m[C]}, to[${C}]: ${w[C]}`);T.push(m[C]);const[N,L]=m[C+1],[j,q]=w[C+1];T.push([io(N,j,h),io(L,q,h)])}return new Nn(T)}};class Ai{constructor(l,h,m,w,T){this.type=l,this.operator=h,this.interpolation=m,this.input=w,this.labels=[],this.outputs=[];for(const[C,N]of T)this.labels.push(C),this.outputs.push(N)}static interpolationFactor(l,h,m,w){let T=0;if(l.name==="exponential")T=Rc(h,l.base,m,w);else if(l.name==="linear")T=Rc(h,1,m,w);else if(l.name==="cubic-bezier"){const C=l.controlPoints;T=new fx(C[0],C[1],C[2],C[3]).solve(Rc(h,1,m,w))}return T}static parse(l,h){let[m,w,T,...C]=l;if(!Array.isArray(w)||w.length===0)return h.error("Expected an interpolation type expression.",1);if(w[0]==="linear")w={name:"linear"};else if(w[0]==="exponential"){const j=w[1];if(typeof j!="number")return h.error("Exponential interpolation requires a numeric base.",1,1);w={name:"exponential",base:j}}else{if(w[0]!=="cubic-bezier")return h.error(`Unknown interpolation type ${String(w[0])}`,1,0);{const j=w.slice(1);if(j.length!==4||j.some(q=>typeof q!="number"||q<0||q>1))return h.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);w={name:"cubic-bezier",controlPoints:j}}}if(l.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return h.error("Expected an even number of arguments.");if(T=h.parse(T,2,le),!T)return null;const N=[];let L=null;m==="interpolate-hcl"||m==="interpolate-lab"?L=tt:h.expectedType&&h.expectedType.kind!=="value"&&(L=h.expectedType);for(let j=0;j<C.length;j+=2){const q=C[j],K=C[j+1],ne=j+3,ue=j+4;if(typeof q!="number")return h.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ne);if(N.length&&N[N.length-1][0]>=q)return h.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ne);const ge=h.parse(K,ue,L);if(!ge)return null;L=L||ge.type,N.push([q,ge])}return Ve(L,le)||Ve(L,tt)||Ve(L,Lt)||Ve(L,Se)||Ve(L,re(le))?new Ai(L,m,w,T,N):h.error(`Type ${ee(L)} is not interpolatable.`)}evaluate(l){const h=this.labels,m=this.outputs;if(h.length===1)return m[0].evaluate(l);const w=this.input.evaluate(l);if(w<=h[0])return m[0].evaluate(l);const T=h.length;if(w>=h[T-1])return m[T-1].evaluate(l);const C=zc(h,w),N=Ai.interpolationFactor(this.interpolation,w,h[C],h[C+1]),L=m[C].evaluate(l),j=m[C+1].evaluate(l);switch(this.operator){case"interpolate":return Ii[this.type.kind](L,j,N);case"interpolate-hcl":return Ii.color(L,j,N,"hcl");case"interpolate-lab":return Ii.color(L,j,N,"lab")}}eachChild(l){l(this.input);for(const h of this.outputs)l(h)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}}function Rc(c,l,h,m){const w=m-h,T=c-h;return w===0?0:l===1?T/w:(Math.pow(l,T)-1)/(Math.pow(l,w)-1)}class Lc{constructor(l,h){this.type=l,this.args=h}static parse(l,h){if(l.length<2)return h.error("Expectected at least one argument.");let m=null;const w=h.expectedType;w&&w.kind!=="value"&&(m=w);const T=[];for(const N of l.slice(1)){const L=h.parse(N,1+T.length,m,void 0,{typeAnnotation:"omit"});if(!L)return null;m=m||L.type,T.push(L)}if(!m)throw new Error("No output type");const C=w&&T.some(N=>we(w,N.type));return new Lc(C?dt:m,T)}evaluate(l){let h,m=null,w=0;for(const T of this.args)if(w++,m=T.evaluate(l),m&&m instanceof Bn&&!m.available&&(h||(h=m.name),m=null,w===this.args.length&&(m=h)),m!==null)break;return m}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}function Bc(c,l){return c==="=="||c==="!="?l.kind==="boolean"||l.kind==="string"||l.kind==="number"||l.kind==="null"||l.kind==="value":l.kind==="string"||l.kind==="number"||l.kind==="value"}function eg(c,l,h,m){return m.compare(l,h)===0}function Wo(c,l,h){const m=c!=="=="&&c!=="!=";return class gN{constructor(T,C,N){this.type=Ue,this.lhs=T,this.rhs=C,this.collator=N,this.hasUntypedArgument=T.type.kind==="value"||C.type.kind==="value"}static parse(T,C){if(T.length!==3&&T.length!==4)return C.error("Expected two or three arguments.");const N=T[0];let L=C.parse(T[1],1,dt);if(!L)return null;if(!Bc(N,L.type))return C.concat(1).error(`"${N}" comparisons are not supported for type '${ee(L.type)}'.`);let j=C.parse(T[2],2,dt);if(!j)return null;if(!Bc(N,j.type))return C.concat(2).error(`"${N}" comparisons are not supported for type '${ee(j.type)}'.`);if(L.type.kind!==j.type.kind&&L.type.kind!=="value"&&j.type.kind!=="value")return C.error(`Cannot compare types '${ee(L.type)}' and '${ee(j.type)}'.`);m&&(L.type.kind==="value"&&j.type.kind!=="value"?L=new Hi(j.type,[L]):L.type.kind!=="value"&&j.type.kind==="value"&&(j=new Hi(L.type,[j])));let q=null;if(T.length===4){if(L.type.kind!=="string"&&j.type.kind!=="string"&&L.type.kind!=="value"&&j.type.kind!=="value")return C.error("Cannot use collator to compare non-string types.");if(q=C.parse(T[3],3,ht),!q)return null}return new gN(L,j,q)}evaluate(T){const C=this.lhs.evaluate(T),N=this.rhs.evaluate(T);if(m&&this.hasUntypedArgument){const L=Rr(C),j=Rr(N);if(L.kind!==j.kind||L.kind!=="string"&&L.kind!=="number")throw new Wr(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${L.kind}, ${j.kind}) instead.`)}if(this.collator&&!m&&this.hasUntypedArgument){const L=Rr(C),j=Rr(N);if(L.kind!=="string"||j.kind!=="string")return l(T,C,N)}return this.collator?h(T,C,N,this.collator.evaluate(T)):l(T,C,N)}eachChild(T){T(this.lhs),T(this.rhs),this.collator&&T(this.collator)}outputDefined(){return!0}}}const px=Wo("==",function(c,l,h){return l===h},eg),tg=Wo("!=",function(c,l,h){return l!==h},function(c,l,h,m){return!eg(0,l,h,m)}),rg=Wo("<",function(c,l,h){return l<h},function(c,l,h,m){return m.compare(l,h)<0}),mx=Wo(">",function(c,l,h){return l>h},function(c,l,h,m){return m.compare(l,h)>0}),gx=Wo("<=",function(c,l,h){return l<=h},function(c,l,h,m){return m.compare(l,h)<=0}),ng=Wo(">=",function(c,l,h){return l>=h},function(c,l,h,m){return m.compare(l,h)>=0});class yu{constructor(l,h,m){this.type=ht,this.locale=m,this.caseSensitive=l,this.diacriticSensitive=h}static parse(l,h){if(l.length!==2)return h.error("Expected one argument.");const m=l[1];if(typeof m!="object"||Array.isArray(m))return h.error("Collator options argument must be an object.");const w=h.parse(m["case-sensitive"]!==void 0&&m["case-sensitive"],1,Ue);if(!w)return null;const T=h.parse(m["diacritic-sensitive"]!==void 0&&m["diacritic-sensitive"],1,Ue);if(!T)return null;let C=null;return m.locale&&(C=h.parse(m.locale,1,Be),!C)?null:new yu(w,T,C)}evaluate(l){return new to(this.caseSensitive.evaluate(l),this.diacriticSensitive.evaluate(l),this.locale?this.locale.evaluate(l):null)}eachChild(l){l(this.caseSensitive),l(this.diacriticSensitive),this.locale&&l(this.locale)}outputDefined(){return!1}}class Hd{constructor(l,h,m,w,T){this.type=Be,this.number=l,this.locale=h,this.currency=m,this.minFractionDigits=w,this.maxFractionDigits=T}static parse(l,h){if(l.length!==3)return h.error("Expected two arguments.");const m=h.parse(l[1],1,le);if(!m)return null;const w=l[2];if(typeof w!="object"||Array.isArray(w))return h.error("NumberFormat options argument must be an object.");let T=null;if(w.locale&&(T=h.parse(w.locale,1,Be),!T))return null;let C=null;if(w.currency&&(C=h.parse(w.currency,1,Be),!C))return null;let N=null;if(w["min-fraction-digits"]&&(N=h.parse(w["min-fraction-digits"],1,le),!N))return null;let L=null;return w["max-fraction-digits"]&&(L=h.parse(w["max-fraction-digits"],1,le),!L)?null:new Hd(m,T,C,N,L)}evaluate(l){return new Intl.NumberFormat(this.locale?this.locale.evaluate(l):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(l):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(l):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(l):void 0}).format(this.number.evaluate(l))}eachChild(l){l(this.number),this.locale&&l(this.locale),this.currency&&l(this.currency),this.minFractionDigits&&l(this.minFractionDigits),this.maxFractionDigits&&l(this.maxFractionDigits)}outputDefined(){return!1}}class Oc{constructor(l){this.type=Ot,this.sections=l}static parse(l,h){if(l.length<2)return h.error("Expected at least one argument.");const m=l[1];if(!Array.isArray(m)&&typeof m=="object")return h.error("First argument must be an image or text section.");const w=[];let T=!1;for(let C=1;C<=l.length-1;++C){const N=l[C];if(T&&typeof N=="object"&&!Array.isArray(N)){T=!1;let L=null;if(N["font-scale"]&&(L=h.parse(N["font-scale"],1,le),!L))return null;let j=null;if(N["text-font"]&&(j=h.parse(N["text-font"],1,re(Be)),!j))return null;let q=null;if(N["text-color"]&&(q=h.parse(N["text-color"],1,tt),!q))return null;const K=w[w.length-1];K.scale=L,K.font=j,K.textColor=q}else{const L=h.parse(l[C],1,dt);if(!L)return null;const j=L.type.kind;if(j!=="string"&&j!=="value"&&j!=="null"&&j!=="resolvedImage")return h.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");T=!0,w.push({content:L,scale:null,font:null,textColor:null})}}return new Oc(w)}evaluate(l){return new Hn(this.sections.map(h=>{const m=h.content.evaluate(l);return Rr(m)===Kt?new ro("",m,null,null,null):new ro(us(m),null,h.scale?h.scale.evaluate(l):null,h.font?h.font.evaluate(l).join(","):null,h.textColor?h.textColor.evaluate(l):null)}))}eachChild(l){for(const h of this.sections)l(h.content),h.scale&&l(h.scale),h.font&&l(h.font),h.textColor&&l(h.textColor)}outputDefined(){return!1}}class Gd{constructor(l){this.type=Kt,this.input=l}static parse(l,h){if(l.length!==2)return h.error("Expected two arguments.");const m=h.parse(l[1],1,Be);return m?new Gd(m):h.error("No image name provided.")}evaluate(l){const h=this.input.evaluate(l),m=Bn.fromString(h);return m&&l.availableImages&&(m.available=l.availableImages.indexOf(h)>-1),m}eachChild(l){l(this.input)}outputDefined(){return!1}}class Wd{constructor(l){this.type=le,this.input=l}static parse(l,h){if(l.length!==2)return h.error(`Expected 1 argument, but found ${l.length-1} instead.`);const m=h.parse(l[1],1);return m?m.type.kind!=="array"&&m.type.kind!=="string"&&m.type.kind!=="value"?h.error(`Expected argument of type string or array, but found ${ee(m.type)} instead.`):new Wd(m):null}evaluate(l){const h=this.input.evaluate(l);if(typeof h=="string")return[...h].length;if(Array.isArray(h))return h.length;throw new Wr(`Expected value to be of type string or array, but found ${ee(Rr(h))} instead.`)}eachChild(l){l(this.input)}outputDefined(){return!1}}const Va=8192;function vx(c,l){const h=(180+c[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,w=Math.pow(2,l.z);return[Math.round(h*w*Va),Math.round(m*w*Va)]}function Zd(c,l){const h=Math.pow(2,l.z);return[(w=(c[0]/Va+l.x)/h,360*w-180),(m=(c[1]/Va+l.y)/h,360/Math.PI*Math.atan(Math.exp((180-360*m)*Math.PI/180))-90)];var m,w}function ao(c,l){c[0]=Math.min(c[0],l[0]),c[1]=Math.min(c[1],l[1]),c[2]=Math.max(c[2],l[0]),c[3]=Math.max(c[3],l[1])}function Ns(c,l){return!(c[0]<=l[0]||c[2]>=l[2]||c[1]<=l[1]||c[3]>=l[3])}function Lr(c,l,h){const m=c[0]-l[0],w=c[1]-l[1],T=c[0]-h[0],C=c[1]-h[1];return m*C-T*w==0&&m*T<=0&&w*C<=0}function Fc(c,l,h,m){return(w=[m[0]-h[0],m[1]-h[1]])[0]*(T=[l[0]-c[0],l[1]-c[1]])[1]-w[1]*T[0]!=0&&!(!ag(c,l,h,m)||!ag(h,m,c,l));var w,T}function yx(c,l,h){for(const m of h)for(let w=0;w<m.length-1;++w)if(Fc(c,l,m[w],m[w+1]))return!0;return!1}function Zo(c,l,h=!1){let m=!1;for(const N of l)for(let L=0;L<N.length-1;L++){if(Lr(c,N[L],N[L+1]))return h;(T=N[L])[1]>(w=c)[1]!=(C=N[L+1])[1]>w[1]&&w[0]<(C[0]-T[0])*(w[1]-T[1])/(C[1]-T[1])+T[0]&&(m=!m)}var w,T,C;return m}function xx(c,l){for(const h of l)if(Zo(c,h))return!0;return!1}function ig(c,l){for(const h of c)if(!Zo(h,l))return!1;for(let h=0;h<c.length-1;++h)if(yx(c[h],c[h+1],l))return!1;return!0}function _x(c,l){for(const h of l)if(ig(c,h))return!0;return!1}function ag(c,l,h,m){const w=m[0]-h[0],T=m[1]-h[1],C=(c[0]-h[0])*T-w*(c[1]-h[1]),N=(l[0]-h[0])*T-w*(l[1]-h[1]);return C>0&&N<0||C<0&&N>0}function Xd(c,l,h){const m=[];for(let w=0;w<c.length;w++){const T=[];for(let C=0;C<c[w].length;C++){const N=vx(c[w][C],h);ao(l,N),T.push(N)}m.push(T)}return m}function sg(c,l,h){const m=[];for(let w=0;w<c.length;w++){const T=Xd(c[w],l,h);m.push(T)}return m}function og(c,l,h,m){if(c[0]<h[0]||c[0]>h[2]){const w=.5*m;let T=c[0]-h[0]>w?-m:h[0]-c[0]>w?m:0;T===0&&(T=c[0]-h[2]>w?-m:h[2]-c[0]>w?m:0),c[0]+=T}ao(l,c)}function lg(c,l,h,m){const w=Math.pow(2,m.z)*Va,T=[m.x*Va,m.y*Va],C=[];for(const N of c)for(const L of N){const j=[L.x+T[0],L.y+T[1]];og(j,l,h,w),C.push(j)}return C}function ug(c,l,h,m){const w=Math.pow(2,m.z)*Va,T=[m.x*Va,m.y*Va],C=[];for(const L of c){const j=[];for(const q of L){const K=[q.x+T[0],q.y+T[1]];ao(l,K),j.push(K)}C.push(j)}if(l[2]-l[0]<=w/2){(N=l)[0]=N[1]=1/0,N[2]=N[3]=-1/0;for(const L of C)for(const j of L)og(j,l,h,w)}var N;return C}class so{constructor(l,h){this.type=Ue,this.geojson=l,this.geometries=h}static parse(l,h){if(l.length!==2)return h.error(`'within' expression requires exactly one argument, but found ${l.length-1} instead.`);if(qi(l[1])){const m=l[1];if(m.type==="FeatureCollection"){const w=[];for(const T of m.features){const{type:C,coordinates:N}=T.geometry;C==="Polygon"&&w.push(N),C==="MultiPolygon"&&w.push(...N)}if(w.length)return new so(m,{type:"MultiPolygon",coordinates:w})}else if(m.type==="Feature"){const w=m.geometry.type;if(w==="Polygon"||w==="MultiPolygon")return new so(m,m.geometry)}else if(m.type==="Polygon"||m.type==="MultiPolygon")return new so(m,m)}return h.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return function(h,m){const w=[1/0,1/0,-1/0,-1/0],T=[1/0,1/0,-1/0,-1/0],C=h.canonicalID();if(m.type==="Polygon"){const N=Xd(m.coordinates,T,C),L=lg(h.geometry(),w,T,C);if(!Ns(w,T))return!1;for(const j of L)if(!Zo(j,N))return!1}if(m.type==="MultiPolygon"){const N=sg(m.coordinates,T,C),L=lg(h.geometry(),w,T,C);if(!Ns(w,T))return!1;for(const j of L)if(!xx(j,N))return!1}return!0}(l,this.geometries);if(l.geometryType()==="LineString")return function(h,m){const w=[1/0,1/0,-1/0,-1/0],T=[1/0,1/0,-1/0,-1/0],C=h.canonicalID();if(m.type==="Polygon"){const N=Xd(m.coordinates,T,C),L=ug(h.geometry(),w,T,C);if(!Ns(w,T))return!1;for(const j of L)if(!ig(j,N))return!1}if(m.type==="MultiPolygon"){const N=sg(m.coordinates,T,C),L=ug(h.geometry(),w,T,C);if(!Ns(w,T))return!1;for(const j of L)if(!_x(j,N))return!1}return!0}(l,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let cg=class{constructor(c=[],l=(h,m)=>h<m?-1:h>m?1:0){if(this.data=c,this.length=this.data.length,this.compare=l,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(c){this.data.push(c),this._up(this.length++)}pop(){if(this.length===0)return;const c=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),c}peek(){return this.data[0]}_up(c){const{data:l,compare:h}=this,m=l[c];for(;c>0;){const w=c-1>>1,T=l[w];if(h(m,T)>=0)break;l[c]=T,c=w}l[c]=m}_down(c){const{data:l,compare:h}=this,m=this.length>>1,w=l[c];for(;c<m;){let T=1+(c<<1);const C=T+1;if(C<this.length&&h(l[C],l[T])<0&&(T=C),h(l[T],w)>=0)break;l[c]=l[T],c=T}l[c]=w}};function wx(c,l,h,m,w){hg(c,l,h,m||c.length-1,w||bx)}function hg(c,l,h,m,w){for(;m>h;){if(m-h>600){var T=m-h+1,C=l-h+1,N=Math.log(T),L=.5*Math.exp(2*N/3),j=.5*Math.sqrt(N*L*(T-L)/T)*(C-T/2<0?-1:1);hg(c,l,Math.max(h,Math.floor(l-C*L/T+j)),Math.min(m,Math.floor(l+(T-C)*L/T+j)),w)}var q=c[l],K=h,ne=m;for(xu(c,h,l),w(c[m],q)>0&&xu(c,h,m);K<ne;){for(xu(c,K,ne),K++,ne--;w(c[K],q)<0;)K++;for(;w(c[ne],q)>0;)ne--}w(c[h],q)===0?xu(c,h,ne):xu(c,++ne,m),ne<=l&&(h=ne+1),l<=ne&&(m=ne-1)}}function xu(c,l,h){var m=c[l];c[l]=c[h],c[h]=m}function bx(c,l){return c<l?-1:c>l?1:0}function jc(c,l){if(c.length<=1)return[c];const h=[];let m,w;for(const T of c){const C=Ex(T);C!==0&&(T.area=Math.abs(C),w===void 0&&(w=C<0),w===C<0?(m&&h.push(m),m=[T]):m.push(T))}if(m&&h.push(m),l>1)for(let T=0;T<h.length;T++)h[T].length<=l||(wx(h[T],l,1,h[T].length-1,Sx),h[T]=h[T].slice(0,l));return h}function Sx(c,l){return l.area-c.area}function Ex(c){let l=0;for(let h,m,w=0,T=c.length,C=T-1;w<T;C=w++)h=c[w],m=c[C],l+=(m.x-h.x)*(h.y+m.y);return l}const dg=1/298.257223563,fg=dg*(2-dg),pg=Math.PI/180;class Kd{constructor(l){const h=6378.137*pg*1e3,m=Math.cos(l*pg),w=1/(1-fg*(1-m*m)),T=Math.sqrt(w);this.kx=h*T*m,this.ky=h*T*w*(1-fg)}distance(l,h){const m=this.wrap(l[0]-h[0])*this.kx,w=(l[1]-h[1])*this.ky;return Math.sqrt(m*m+w*w)}pointOnLine(l,h){let m,w,T,C,N=1/0;for(let L=0;L<l.length-1;L++){let j=l[L][0],q=l[L][1],K=this.wrap(l[L+1][0]-j)*this.kx,ne=(l[L+1][1]-q)*this.ky,ue=0;K===0&&ne===0||(ue=(this.wrap(h[0]-j)*this.kx*K+(h[1]-q)*this.ky*ne)/(K*K+ne*ne),ue>1?(j=l[L+1][0],q=l[L+1][1]):ue>0&&(j+=K/this.kx*ue,q+=ne/this.ky*ue)),K=this.wrap(h[0]-j)*this.kx,ne=(h[1]-q)*this.ky;const ge=K*K+ne*ne;ge<N&&(N=ge,m=j,w=q,T=L,C=ue)}return{point:[m,w],index:T,t:Math.max(0,Math.min(1,C))}}wrap(l){for(;l<-180;)l+=360;for(;l>180;)l-=360;return l}}function mg(c,l){return l[0]-c[0]}function $c(c){return c[1]-c[0]+1}function cs(c,l){return c[1]>=c[0]&&c[1]<l}function Yd(c,l){if(c[0]>c[1])return[null,null];const h=$c(c);if(l){if(h===2)return[c,null];const w=Math.floor(h/2);return[[c[0],c[0]+w],[c[0]+w,c[1]]]}if(h===1)return[c,null];const m=Math.floor(h/2)-1;return[[c[0],c[0]+m],[c[0]+m+1,c[1]]]}function Jd(c,l){if(!cs(l,c.length))return[1/0,1/0,-1/0,-1/0];const h=[1/0,1/0,-1/0,-1/0];for(let m=l[0];m<=l[1];++m)ao(h,c[m]);return h}function Qd(c){const l=[1/0,1/0,-1/0,-1/0];for(const h of c)for(const m of h)ao(l,m);return l}function Vc(c){return c[0]!==-1/0&&c[1]!==-1/0&&c[2]!==1/0&&c[3]!==1/0}function ef(c,l,h){if(!Vc(c)||!Vc(l))return NaN;let m=0,w=0;return c[2]<l[0]&&(m=l[0]-c[2]),c[0]>l[2]&&(m=c[0]-l[2]),c[1]>l[3]&&(w=c[1]-l[3]),c[3]<l[1]&&(w=l[1]-c[3]),h.distance([0,0],[m,w])}function oo(c,l,h){const m=h.pointOnLine(l,c);return h.distance(c,m.point)}function tf(c,l,h,m,w){const T=Math.min(oo(c,[h,m],w),oo(l,[h,m],w)),C=Math.min(oo(h,[c,l],w),oo(m,[c,l],w));return Math.min(T,C)}function Tx(c,l,h,m,w){if(!cs(l,c.length)||!cs(m,h.length))return 1/0;let T=1/0;for(let C=l[0];C<l[1];++C){const N=c[C],L=c[C+1];for(let j=m[0];j<m[1];++j){const q=h[j],K=h[j+1];if(Fc(N,L,q,K))return 0;T=Math.min(T,tf(N,L,q,K,w))}}return T}function gn(c,l,h,m,w){if(!cs(l,c.length)||!cs(m,h.length))return NaN;let T=1/0;for(let C=l[0];C<=l[1];++C)for(let N=m[0];N<=m[1];++N)if(T=Math.min(T,w.distance(c[C],h[N])),T===0)return T;return T}function Cx(c,l,h){if(Zo(c,l,!0))return 0;let m=1/0;for(const w of l){const T=w[0],C=w[w.length-1];if(T!==C&&(m=Math.min(m,oo(c,[C,T],h)),m===0))return m;const N=h.pointOnLine(w,c);if(m=Math.min(m,h.distance(c,N.point)),m===0)return m}return m}function wr(c,l,h,m){if(!cs(l,c.length))return NaN;for(let T=l[0];T<=l[1];++T)if(Zo(c[T],h,!0))return 0;let w=1/0;for(let T=l[0];T<l[1];++T){const C=c[T],N=c[T+1];for(const L of h)for(let j=0,q=L.length,K=q-1;j<q;K=j++){const ne=L[K],ue=L[j];if(Fc(C,N,ne,ue))return 0;w=Math.min(w,tf(C,N,ne,ue,m))}}return w}function Uc(c,l){for(const h of c)for(const m of h)if(Zo(m,l,!0))return!0;return!1}function Zr(c,l,h,m=1/0){const w=Qd(c),T=Qd(l);if(m!==1/0&&ef(w,T,h)>=m)return m;if(Ns(w,T)){if(Uc(c,l))return 0}else if(Uc(l,c))return 0;let C=1/0;for(const N of c)for(let L=0,j=N.length,q=j-1;L<j;q=L++){const K=N[q],ne=N[L];for(const ue of l)for(let ge=0,ye=ue.length,Te=ye-1;ge<ye;Te=ge++){const Pe=ue[Te],We=ue[ge];if(Fc(K,ne,Pe,We))return 0;C=Math.min(C,tf(K,ne,Pe,We,h))}}return C}function $r(c,l,h,m,w,T){if(!T)return;const C=ef(Jd(m,T),w,h);C<l&&c.push([C,T,[0,0]])}function lo(c,l,h,m,w,T,C){if(!T||!C)return;const N=ef(Jd(m,T),Jd(w,C),h);N<l&&c.push([N,T,C])}function _u(c,l,h,m,w=1/0){let T=Math.min(m.distance(c[0],h[0][0]),w);if(T===0)return T;const C=new cg([[0,[0,c.length-1],[0,0]]],mg),N=Qd(h);for(;C.length>0;){const L=C.pop();if(L[0]>=T)continue;const j=L[1],q=l?50:100;if($c(j)<=q){if(!cs(j,c.length))return NaN;if(l){const K=wr(c,j,h,m);if(isNaN(K)||K===0)return K;T=Math.min(T,K)}else for(let K=j[0];K<=j[1];++K){const ne=Cx(c[K],h,m);if(T=Math.min(T,ne),T===0)return 0}}else{const K=Yd(j,l);$r(C,T,m,c,N,K[0]),$r(C,T,m,c,N,K[1])}}return T}function wu(c,l,h,m,w,T=1/0){let C=Math.min(T,w.distance(c[0],h[0]));if(C===0)return C;const N=new cg([[0,[0,c.length-1],[0,h.length-1]]],mg);for(;N.length>0;){const L=N.pop();if(L[0]>=C)continue;const j=L[1],q=L[2],K=l?50:100,ne=m?50:100;if($c(j)<=K&&$c(q)<=ne){if(!cs(j,c.length)&&cs(q,h.length))return NaN;let ue;if(l&&m)ue=Tx(c,j,h,q,w),C=Math.min(C,ue);else if(l&&!m){const ge=c.slice(j[0],j[1]+1);for(let ye=q[0];ye<=q[1];++ye)if(ue=oo(h[ye],ge,w),C=Math.min(C,ue),C===0)return C}else if(!l&&m){const ge=h.slice(q[0],q[1]+1);for(let ye=j[0];ye<=j[1];++ye)if(ue=oo(c[ye],ge,w),C=Math.min(C,ue),C===0)return C}else ue=gn(c,j,h,q,w),C=Math.min(C,ue)}else{const ue=Yd(j,l),ge=Yd(q,m);lo(N,C,w,c,h,ue[0],ge[0]),lo(N,C,w,c,h,ue[0],ge[1]),lo(N,C,w,c,h,ue[1],ge[0]),lo(N,C,w,c,h,ue[1],ge[1])}}return C}function rf(c){return c.type==="MultiPolygon"?c.coordinates.map(l=>({type:"Polygon",coordinates:l})):c.type==="MultiLineString"?c.coordinates.map(l=>({type:"LineString",coordinates:l})):c.type==="MultiPoint"?c.coordinates.map(l=>({type:"Point",coordinates:l})):[c]}class uo{constructor(l,h){this.type=le,this.geojson=l,this.geometries=h}static parse(l,h){if(l.length!==2)return h.error(`'distance' expression requires exactly one argument, but found ${l.length-1} instead.`);if(qi(l[1])){const m=l[1];if(m.type==="FeatureCollection")return new uo(m,m.features.map(w=>rf(w.geometry)).flat());if(m.type==="Feature")return new uo(m,rf(m.geometry));if("type"in m&&"coordinates"in m)return new uo(m,rf(m))}return h.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return function(h,m){const w=h.geometry(),T=w.flat().map(L=>Zd([L.x,L.y],h.canonical));if(w.length===0)return NaN;const C=new Kd(T[0][1]);let N=1/0;for(const L of m){switch(L.type){case"Point":N=Math.min(N,wu(T,!1,[L.coordinates],!1,C,N));break;case"LineString":N=Math.min(N,wu(T,!1,L.coordinates,!0,C,N));break;case"Polygon":N=Math.min(N,_u(T,!1,L.coordinates,C,N))}if(N===0)return N}return N}(l,this.geometries);if(l.geometryType()==="LineString")return function(h,m){const w=h.geometry(),T=w.flat().map(L=>Zd([L.x,L.y],h.canonical));if(w.length===0)return NaN;const C=new Kd(T[0][1]);let N=1/0;for(const L of m){switch(L.type){case"Point":N=Math.min(N,wu(T,!0,[L.coordinates],!1,C,N));break;case"LineString":N=Math.min(N,wu(T,!0,L.coordinates,!0,C,N));break;case"Polygon":N=Math.min(N,_u(T,!0,L.coordinates,C,N))}if(N===0)return N}return N}(l,this.geometries);if(l.geometryType()==="Polygon")return function(h,m){const w=h.geometry();if(w.length===0||w[0].length===0)return NaN;const T=jc(w,0).map(L=>L.map(j=>j.map(q=>Zd([q.x,q.y],h.canonical)))),C=new Kd(T[0][0][0][1]);let N=1/0;for(const L of m)for(const j of T){switch(L.type){case"Point":N=Math.min(N,_u([L.coordinates],!1,j,C,N));break;case"LineString":N=Math.min(N,_u(L.coordinates,!0,j,C,N));break;case"Polygon":N=Math.min(N,Zr(j,L.coordinates,C,N))}if(N===0)return N}return N}(l,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Xo={"==":px,"!=":tg,">":mx,"<":rg,">=":ng,"<=":gx,array:Hi,at:Vd,boolean:Hi,case:Nc,coalesce:Lc,collator:yu,format:Oc,image:Gd,in:Ud,"index-of":Ho,interpolate:Ai,"interpolate-hcl":Ai,"interpolate-lab":Ai,length:Wd,let:Ds,literal:Pi,match:qd,number:Hi,"number-format":Hd,object:Hi,slice:gu,step:Go,string:Hi,"to-boolean":Gi,"to-color":Gi,"to-number":Gi,"to-string":Gi,var:zr,within:so,distance:uo};class aa{constructor(l,h,m,w){this.name=l,this.type=h,this._evaluate=m,this.args=w}evaluate(l){return this._evaluate(l,this.args)}eachChild(l){this.args.forEach(l)}outputDefined(){return!1}static parse(l,h){const m=l[0],w=aa.definitions[m];if(!w)return h.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0);const T=Array.isArray(w)?w[0]:w.type,C=Array.isArray(w)?[[w[1],w[2]]]:w.overloads,N=C.filter(([j])=>!Array.isArray(j)||j.length===l.length-1);let L=null;for(const[j,q]of N){L=new no(h.registry,bu,h.path,null,h.scope);const K=[];let ne=!1;for(let ue=1;ue<l.length;ue++){const ge=l[ue],ye=Array.isArray(j)?j[ue-1]:j.type,Te=L.parse(ge,1+K.length,ye);if(!Te){ne=!0;break}K.push(Te)}if(!ne)if(Array.isArray(j)&&j.length!==K.length)L.error(`Expected ${j.length} arguments, but found ${K.length} instead.`);else{for(let ue=0;ue<K.length;ue++){const ge=Array.isArray(j)?j[ue]:j.type,ye=K[ue];L.concat(ue+1).checkSubtype(ge,ye.type)}if(L.errors.length===0)return new aa(m,T,q,K)}}if(N.length===1)h.errors.push(...L.errors);else{const j=(N.length?N:C).map(([K])=>{return ne=K,Array.isArray(ne)?`(${ne.map(ee).join(", ")})`:`(${ee(ne.type)}...)`;var ne}).join(" | "),q=[];for(let K=1;K<l.length;K++){const ne=h.parse(l[K],1+q.length);if(!ne)return null;q.push(ee(ne.type))}h.error(`Expected arguments of type ${j}, but found (${q.join(", ")}) instead.`)}return null}static register(l,h){aa.definitions=h;for(const m in h)l[m]=aa}}function nf(c,[l,h,m,w]){l=l.evaluate(c),h=h.evaluate(c),m=m.evaluate(c);const T=w?w.evaluate(c):1,C=ba(l,h,m,T);if(C)throw new Wr(C);return new Mr(l/255,h/255,m/255,T,!1)}function af(c,l){return c in l}function sf(c,l){const h=l[c];return h===void 0?null:h}function co(c){return{type:c}}function bu(c){if(c instanceof zr)return bu(c.boundExpression);if(c instanceof aa&&c.name==="error"||c instanceof yu||c instanceof so||c instanceof uo)return!1;const l=c instanceof Gi||c instanceof Hi;let h=!0;return c.eachChild(m=>{h=l?h&&bu(m):h&&m instanceof Pi}),!!h&&Su(c)&&Eu(c,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Su(c){if(c instanceof aa&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof so||c instanceof uo)return!1;let l=!0;return c.eachChild(h=>{l&&!Su(h)&&(l=!1)}),l}function Ko(c){if(c instanceof aa&&c.name==="feature-state")return!1;let l=!0;return c.eachChild(h=>{l&&!Ko(h)&&(l=!1)}),l}function Eu(c,l){if(c instanceof aa&&l.indexOf(c.name)>=0)return!1;let h=!0;return c.eachChild(m=>{h&&!Eu(m,l)&&(h=!1)}),h}function qc(c){return{result:"success",value:c}}function Yo(c){return{result:"error",value:c}}function Jo(c){return c["property-type"]==="data-driven"||c["property-type"]==="cross-faded-data-driven"}function gg(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function of(c){return!!c.expression&&c.expression.interpolated}function Dr(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}function Hc(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function kx(c){return c}function vg(c,l){const h=l.type==="color",m=c.stops&&typeof c.stops[0][0]=="object",w=m||!(m||c.property!==void 0),T=c.type||(of(l)?"exponential":"interval");if(h||l.type==="padding"){const q=h?Mr.parse:bn.parse;(c=mr({},c)).stops&&(c.stops=c.stops.map(K=>[K[0],q(K[1])])),c.default=q(c.default?c.default:l.default)}if(c.colorSpace&&(C=c.colorSpace)!=="rgb"&&C!=="hcl"&&C!=="lab")throw new Error(`Unknown color space: "${c.colorSpace}"`);var C;let N,L,j;if(T==="exponential")N=xg;else if(T==="interval")N=Gc;else if(T==="categorical"){N=yg,L=Object.create(null);for(const q of c.stops)L[q[0]]=q[1];j=typeof c.stops[0][0]}else{if(T!=="identity")throw new Error(`Unknown function type "${T}"`);N=_g}if(m){const q={},K=[];for(let ge=0;ge<c.stops.length;ge++){const ye=c.stops[ge],Te=ye[0].zoom;q[Te]===void 0&&(q[Te]={zoom:Te,type:c.type,property:c.property,default:c.default,stops:[]},K.push(Te)),q[Te].stops.push([ye[0].value,ye[1]])}const ne=[];for(const ge of K)ne.push([q[ge].zoom,vg(q[ge],l)]);const ue={name:"linear"};return{kind:"composite",interpolationType:ue,interpolationFactor:Ai.interpolationFactor.bind(void 0,ue),zoomStops:ne.map(ge=>ge[0]),evaluate:({zoom:ge},ye)=>xg({stops:ne,base:c.base},l,ge).evaluate(ge,ye)}}if(w){const q=T==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:q,interpolationFactor:Ai.interpolationFactor.bind(void 0,q),zoomStops:c.stops.map(K=>K[0]),evaluate:({zoom:K})=>N(c,l,K,L,j)}}return{kind:"source",evaluate(q,K){const ne=K&&K.properties?K.properties[c.property]:void 0;return ne===void 0?Qo(c.default,l.default):N(c,l,ne,L,j)}}}function Qo(c,l,h){return c!==void 0?c:l!==void 0?l:h!==void 0?h:void 0}function yg(c,l,h,m,w){return Qo(typeof h===w?m[h]:void 0,c.default,l.default)}function Gc(c,l,h){if(Dr(h)!=="number")return Qo(c.default,l.default);const m=c.stops.length;if(m===1||h<=c.stops[0][0])return c.stops[0][1];if(h>=c.stops[m-1][0])return c.stops[m-1][1];const w=zc(c.stops.map(T=>T[0]),h);return c.stops[w][1]}function xg(c,l,h){const m=c.base!==void 0?c.base:1;if(Dr(h)!=="number")return Qo(c.default,l.default);const w=c.stops.length;if(w===1||h<=c.stops[0][0])return c.stops[0][1];if(h>=c.stops[w-1][0])return c.stops[w-1][1];const T=zc(c.stops.map(q=>q[0]),h),C=function(q,K,ne,ue){const ge=ue-ne,ye=q-ne;return ge===0?0:K===1?ye/ge:(Math.pow(K,ye)-1)/(Math.pow(K,ge)-1)}(h,m,c.stops[T][0],c.stops[T+1][0]),N=c.stops[T][1],L=c.stops[T+1][1],j=Ii[l.type]||kx;return typeof N.evaluate=="function"?{evaluate(...q){const K=N.evaluate.apply(void 0,q),ne=L.evaluate.apply(void 0,q);if(K!==void 0&&ne!==void 0)return j(K,ne,C,c.colorSpace)}}:j(N,L,C,c.colorSpace)}function _g(c,l,h){switch(l.type){case"color":h=Mr.parse(h);break;case"formatted":h=Hn.fromString(h.toString());break;case"resolvedImage":h=Bn.fromString(h.toString());break;case"padding":h=bn.parse(h);break;default:Dr(h)===l.type||l.type==="enum"&&l.values[h]||(h=void 0)}return Qo(h,c.default,l.default)}aa.register(Xo,{error:[{kind:"error"},[Be],(c,[l])=>{throw new Wr(l.evaluate(c))}],typeof:[Be,[dt],(c,[l])=>ee(Rr(l.evaluate(c)))],"to-rgba":[re(le,4),[tt],(c,[l])=>{const[h,m,w,T]=l.evaluate(c).rgb;return[255*h,255*m,255*w,T]}],rgb:[tt,[le,le,le],nf],rgba:[tt,[le,le,le,le],nf],has:{type:Ue,overloads:[[[Be],(c,[l])=>af(l.evaluate(c),c.properties())],[[Be,st],(c,[l,h])=>af(l.evaluate(c),h.evaluate(c))]]},get:{type:dt,overloads:[[[Be],(c,[l])=>sf(l.evaluate(c),c.properties())],[[Be,st],(c,[l,h])=>sf(l.evaluate(c),h.evaluate(c))]]},"feature-state":[dt,[Be],(c,[l])=>sf(l.evaluate(c),c.featureState||{})],properties:[st,[],c=>c.properties()],"geometry-type":[Be,[],c=>c.geometryType()],id:[dt,[],c=>c.id()],zoom:[le,[],c=>c.globals.zoom],"heatmap-density":[le,[],c=>c.globals.heatmapDensity||0],"line-progress":[le,[],c=>c.globals.lineProgress||0],accumulated:[dt,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[le,co(le),(c,l)=>{let h=0;for(const m of l)h+=m.evaluate(c);return h}],"*":[le,co(le),(c,l)=>{let h=1;for(const m of l)h*=m.evaluate(c);return h}],"-":{type:le,overloads:[[[le,le],(c,[l,h])=>l.evaluate(c)-h.evaluate(c)],[[le],(c,[l])=>-l.evaluate(c)]]},"/":[le,[le,le],(c,[l,h])=>l.evaluate(c)/h.evaluate(c)],"%":[le,[le,le],(c,[l,h])=>l.evaluate(c)%h.evaluate(c)],ln2:[le,[],()=>Math.LN2],pi:[le,[],()=>Math.PI],e:[le,[],()=>Math.E],"^":[le,[le,le],(c,[l,h])=>Math.pow(l.evaluate(c),h.evaluate(c))],sqrt:[le,[le],(c,[l])=>Math.sqrt(l.evaluate(c))],log10:[le,[le],(c,[l])=>Math.log(l.evaluate(c))/Math.LN10],ln:[le,[le],(c,[l])=>Math.log(l.evaluate(c))],log2:[le,[le],(c,[l])=>Math.log(l.evaluate(c))/Math.LN2],sin:[le,[le],(c,[l])=>Math.sin(l.evaluate(c))],cos:[le,[le],(c,[l])=>Math.cos(l.evaluate(c))],tan:[le,[le],(c,[l])=>Math.tan(l.evaluate(c))],asin:[le,[le],(c,[l])=>Math.asin(l.evaluate(c))],acos:[le,[le],(c,[l])=>Math.acos(l.evaluate(c))],atan:[le,[le],(c,[l])=>Math.atan(l.evaluate(c))],min:[le,co(le),(c,l)=>Math.min(...l.map(h=>h.evaluate(c)))],max:[le,co(le),(c,l)=>Math.max(...l.map(h=>h.evaluate(c)))],abs:[le,[le],(c,[l])=>Math.abs(l.evaluate(c))],round:[le,[le],(c,[l])=>{const h=l.evaluate(c);return h<0?-Math.round(-h):Math.round(h)}],floor:[le,[le],(c,[l])=>Math.floor(l.evaluate(c))],ceil:[le,[le],(c,[l])=>Math.ceil(l.evaluate(c))],"filter-==":[Ue,[Be,dt],(c,[l,h])=>c.properties()[l.value]===h.value],"filter-id-==":[Ue,[dt],(c,[l])=>c.id()===l.value],"filter-type-==":[Ue,[Be],(c,[l])=>c.geometryType()===l.value],"filter-<":[Ue,[Be,dt],(c,[l,h])=>{const m=c.properties()[l.value],w=h.value;return typeof m==typeof w&&m<w}],"filter-id-<":[Ue,[dt],(c,[l])=>{const h=c.id(),m=l.value;return typeof h==typeof m&&h<m}],"filter->":[Ue,[Be,dt],(c,[l,h])=>{const m=c.properties()[l.value],w=h.value;return typeof m==typeof w&&m>w}],"filter-id->":[Ue,[dt],(c,[l])=>{const h=c.id(),m=l.value;return typeof h==typeof m&&h>m}],"filter-<=":[Ue,[Be,dt],(c,[l,h])=>{const m=c.properties()[l.value],w=h.value;return typeof m==typeof w&&m<=w}],"filter-id-<=":[Ue,[dt],(c,[l])=>{const h=c.id(),m=l.value;return typeof h==typeof m&&h<=m}],"filter->=":[Ue,[Be,dt],(c,[l,h])=>{const m=c.properties()[l.value],w=h.value;return typeof m==typeof w&&m>=w}],"filter-id->=":[Ue,[dt],(c,[l])=>{const h=c.id(),m=l.value;return typeof h==typeof m&&h>=m}],"filter-has":[Ue,[dt],(c,[l])=>l.value in c.properties()],"filter-has-id":[Ue,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[Ue,[re(Be)],(c,[l])=>l.value.indexOf(c.geometryType())>=0],"filter-id-in":[Ue,[re(dt)],(c,[l])=>l.value.indexOf(c.id())>=0],"filter-in-small":[Ue,[Be,re(dt)],(c,[l,h])=>h.value.indexOf(c.properties()[l.value])>=0],"filter-in-large":[Ue,[Be,re(dt)],(c,[l,h])=>function(m,w,T,C){for(;T<=C;){const N=T+C>>1;if(w[N]===m)return!0;w[N]>m?C=N-1:T=N+1}return!1}(c.properties()[l.value],h.value,0,h.value.length-1)],all:{type:Ue,overloads:[[[Ue,Ue],(c,[l,h])=>l.evaluate(c)&&h.evaluate(c)],[co(Ue),(c,l)=>{for(const h of l)if(!h.evaluate(c))return!1;return!0}]]},any:{type:Ue,overloads:[[[Ue,Ue],(c,[l,h])=>l.evaluate(c)||h.evaluate(c)],[co(Ue),(c,l)=>{for(const h of l)if(h.evaluate(c))return!0;return!1}]]},"!":[Ue,[Ue],(c,[l])=>!l.evaluate(c)],"is-supported-script":[Ue,[Be],(c,[l])=>{const h=c.globals&&c.globals.isSupportedScript;return!h||h(l.evaluate(c))}],upcase:[Be,[Be],(c,[l])=>l.evaluate(c).toUpperCase()],downcase:[Be,[Be],(c,[l])=>l.evaluate(c).toLowerCase()],concat:[Be,co(dt),(c,l)=>l.map(h=>us(h.evaluate(c))).join("")],"resolved-locale":[Be,[ht],(c,[l])=>l.evaluate(c).resolvedLocale()]});class Wc{constructor(l,h){var m;this.expression=l,this._warningHistory={},this._evaluator=new Dc,this._defaultValue=h?(m=h).type==="color"&&Hc(m.default)?new Mr(0,0,0,0):m.type==="color"?Mr.parse(m.default)||null:m.type==="padding"?bn.parse(m.default)||null:m.type==="variableAnchorOffsetCollection"?Nn.parse(m.default)||null:m.default===void 0?null:m.default:null,this._enumValues=h&&h.type==="enum"?h.values:null}evaluateWithoutErrorHandling(l,h,m,w,T,C){return this._evaluator.globals=l,this._evaluator.feature=h,this._evaluator.featureState=m,this._evaluator.canonical=w,this._evaluator.availableImages=T||null,this._evaluator.formattedSection=C,this.expression.evaluate(this._evaluator)}evaluate(l,h,m,w,T,C){this._evaluator.globals=l,this._evaluator.feature=h||null,this._evaluator.featureState=m||null,this._evaluator.canonical=w,this._evaluator.availableImages=T||null,this._evaluator.formattedSection=C||null;try{const N=this.expression.evaluate(this._evaluator);if(N==null||typeof N=="number"&&N!=N)return this._defaultValue;if(this._enumValues&&!(N in this._enumValues))throw new Wr(`Expected value to be one of ${Object.keys(this._enumValues).map(L=>JSON.stringify(L)).join(", ")}, but found ${JSON.stringify(N)} instead.`);return N}catch(N){return this._warningHistory[N.message]||(this._warningHistory[N.message]=!0,typeof console<"u"&&console.warn(N.message)),this._defaultValue}}}function Zc(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in Xo}function el(c,l){const h=new no(Xo,bu,[],l?function(w){const T={color:tt,string:Be,number:le,enum:Be,boolean:Ue,formatted:Ot,padding:Lt,resolvedImage:Kt,variableAnchorOffsetCollection:Se};return w.type==="array"?re(T[w.value]||dt,w.length):T[w.type]}(l):void 0),m=h.parse(c,void 0,void 0,void 0,l&&l.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?qc(new Wc(m,l)):Yo(h.errors)}class tl{constructor(l,h){this.kind=l,this._styleExpression=h,this.isStateDependent=l!=="constant"&&!Ko(h.expression)}evaluateWithoutErrorHandling(l,h,m,w,T,C){return this._styleExpression.evaluateWithoutErrorHandling(l,h,m,w,T,C)}evaluate(l,h,m,w,T,C){return this._styleExpression.evaluate(l,h,m,w,T,C)}}class rl{constructor(l,h,m,w){this.kind=l,this.zoomStops=m,this._styleExpression=h,this.isStateDependent=l!=="camera"&&!Ko(h.expression),this.interpolationType=w}evaluateWithoutErrorHandling(l,h,m,w,T,C){return this._styleExpression.evaluateWithoutErrorHandling(l,h,m,w,T,C)}evaluate(l,h,m,w,T,C){return this._styleExpression.evaluate(l,h,m,w,T,C)}interpolationFactor(l,h,m){return this.interpolationType?Ai.interpolationFactor(this.interpolationType,l,h,m):0}}function lf(c,l){const h=el(c,l);if(h.result==="error")return h;const m=h.value.expression,w=Su(m);if(!w&&!Jo(l))return Yo([new Ht("","data expressions not supported")]);const T=Eu(m,["zoom"]);if(!T&&!gg(l))return Yo([new Ht("","zoom expressions not supported")]);const C=Tu(m);return C||T?C instanceof Ht?Yo([C]):C instanceof Ai&&!of(l)?Yo([new Ht("",'"interpolate" expressions cannot be used with this property')]):qc(C?new rl(w?"camera":"composite",h.value,C.labels,C instanceof Ai?C.interpolation:void 0):new tl(w?"constant":"source",h.value)):Yo([new Ht("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class nl{constructor(l,h){this._parameters=l,this._specification=h,mr(this,vg(this._parameters,this._specification))}static deserialize(l){return new nl(l._parameters,l._specification)}static serialize(l){return{_parameters:l._parameters,_specification:l._specification}}}function Tu(c){let l=null;if(c instanceof Ds)l=Tu(c.result);else if(c instanceof Lc){for(const h of c.args)if(l=Tu(h),l)break}else(c instanceof Go||c instanceof Ai)&&c.input instanceof aa&&c.input.name==="zoom"&&(l=c);return l instanceof Ht||c.eachChild(h=>{const m=Tu(h);m instanceof Ht?l=m:!l&&m?l=new Ht("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):l&&m&&l!==m&&(l=new Ht("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),l}function Xc(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const l of c.slice(1))if(!Xc(l)&&typeof l!="boolean")return!1;return!0;default:return!0}}const Kc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function uf(c){if(c==null)return{filter:()=>!0,needGeometry:!1};Xc(c)||(c=Yc(c));const l=el(c,Kc);if(l.result==="error")throw new Error(l.value.map(h=>`${h.key}: ${h.message}`).join(", "));return{filter:(h,m,w)=>l.value.evaluate(h,m,{},w),needGeometry:wg(c)}}function Px(c,l){return c<l?-1:c>l?1:0}function wg(c){if(!Array.isArray(c))return!1;if(c[0]==="within"||c[0]==="distance")return!0;for(let l=1;l<c.length;l++)if(wg(c[l]))return!0;return!1}function Yc(c){if(!c)return!0;const l=c[0];return c.length<=1?l!=="any":l==="=="?cf(c[1],c[2],"=="):l==="!="?ri(cf(c[1],c[2],"==")):l==="<"||l===">"||l==="<="||l===">="?cf(c[1],c[2],l):l==="any"?(h=c.slice(1),["any"].concat(h.map(Yc))):l==="all"?["all"].concat(c.slice(1).map(Yc)):l==="none"?["all"].concat(c.slice(1).map(Yc).map(ri)):l==="in"?Cu(c[1],c.slice(2)):l==="!in"?ri(Cu(c[1],c.slice(2))):l==="has"?ku(c[1]):l!=="!has"||ri(ku(c[1]));var h}function cf(c,l,h){switch(c){case"$type":return[`filter-type-${h}`,l];case"$id":return[`filter-id-${h}`,l];default:return[`filter-${h}`,c,l]}}function Cu(c,l){if(l.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",l]];case"$id":return["filter-id-in",["literal",l]];default:return l.length>200&&!l.some(h=>typeof h!=typeof l[0])?["filter-in-large",c,["literal",l.sort(Px)]]:["filter-in-small",c,["literal",l]]}}function ku(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function ri(c){return["!",c]}function ho(c){const l=typeof c;if(l==="number"||l==="boolean"||l==="string"||c==null)return JSON.stringify(c);if(Array.isArray(c)){let w="[";for(const T of c)w+=`${ho(T)},`;return`${w}]`}const h=Object.keys(c).sort();let m="{";for(let w=0;w<h.length;w++)m+=`${JSON.stringify(h[w])}:${ho(c[h[w]])},`;return`${m}}`}function bg(c){let l="";for(const h of At)l+=`/${ho(c[h])}`;return l}function Sg(c){const l=c.value;return l?[new lt(c.key,l,"constants have been deprecated as of v8")]:[]}function vn(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function Sa(c){if(Array.isArray(c))return c.map(Sa);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const l={};for(const h in c)l[h]=Sa(c[h]);return l}return vn(c)}function Wi(c){const l=c.key,h=c.value,m=c.valueSpec||{},w=c.objectElementValidators||{},T=c.style,C=c.styleSpec,N=c.validateSpec;let L=[];const j=Dr(h);if(j!=="object")return[new lt(l,h,`object expected, ${j} found`)];for(const q in h){const K=q.split(".")[0],ne=m[K]||m["*"];let ue;if(w[K])ue=w[K];else if(m[K])ue=N;else if(w["*"])ue=w["*"];else{if(!m["*"]){L.push(new lt(l,h[q],`unknown property "${q}"`));continue}ue=N}L=L.concat(ue({key:(l&&`${l}.`)+q,value:h[q],valueSpec:ne,style:T,styleSpec:C,object:h,objectKey:q,validateSpec:N},h))}for(const q in m)w[q]||m[q].required&&m[q].default===void 0&&h[q]===void 0&&L.push(new lt(l,h,`missing required property "${q}"`));return L}function Pu(c){const l=c.value,h=c.valueSpec,m=c.style,w=c.styleSpec,T=c.key,C=c.arrayElementValidator||c.validateSpec;if(Dr(l)!=="array")return[new lt(T,l,`array expected, ${Dr(l)} found`)];if(h.length&&l.length!==h.length)return[new lt(T,l,`array length ${h.length} expected, length ${l.length} found`)];if(h["min-length"]&&l.length<h["min-length"])return[new lt(T,l,`array length at least ${h["min-length"]} expected, length ${l.length} found`)];let N={type:h.value,values:h.values};w.$version<7&&(N.function=h.function),Dr(h.value)==="object"&&(N=h.value);let L=[];for(let j=0;j<l.length;j++)L=L.concat(C({array:l,arrayIndex:j,value:l[j],valueSpec:N,validateSpec:c.validateSpec,style:m,styleSpec:w,key:`${T}[${j}]`}));return L}function hf(c){const l=c.key,h=c.value,m=c.valueSpec;let w=Dr(h);return w==="number"&&h!=h&&(w="NaN"),w!=="number"?[new lt(l,h,`number expected, ${w} found`)]:"minimum"in m&&h<m.minimum?[new lt(l,h,`${h} is less than the minimum value ${m.minimum}`)]:"maximum"in m&&h>m.maximum?[new lt(l,h,`${h} is greater than the maximum value ${m.maximum}`)]:[]}function Jc(c){const l=c.valueSpec,h=vn(c.value.type);let m,w,T,C={};const N=h!=="categorical"&&c.value.property===void 0,L=!N,j=Dr(c.value.stops)==="array"&&Dr(c.value.stops[0])==="array"&&Dr(c.value.stops[0][0])==="object",q=Wi({key:c.key,value:c.value,valueSpec:c.styleSpec.function,validateSpec:c.validateSpec,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(ue){if(h==="identity")return[new lt(ue.key,ue.value,'identity function may not have a "stops" property')];let ge=[];const ye=ue.value;return ge=ge.concat(Pu({key:ue.key,value:ye,valueSpec:ue.valueSpec,validateSpec:ue.validateSpec,style:ue.style,styleSpec:ue.styleSpec,arrayElementValidator:K})),Dr(ye)==="array"&&ye.length===0&&ge.push(new lt(ue.key,ye,"array must have at least one stop")),ge},default:function(ue){return ue.validateSpec({key:ue.key,value:ue.value,valueSpec:l,validateSpec:ue.validateSpec,style:ue.style,styleSpec:ue.styleSpec})}}});return h==="identity"&&N&&q.push(new lt(c.key,c.value,'missing required property "property"')),h==="identity"||c.value.stops||q.push(new lt(c.key,c.value,'missing required property "stops"')),h==="exponential"&&c.valueSpec.expression&&!of(c.valueSpec)&&q.push(new lt(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(L&&!Jo(c.valueSpec)?q.push(new lt(c.key,c.value,"property functions not supported")):N&&!gg(c.valueSpec)&&q.push(new lt(c.key,c.value,"zoom functions not supported"))),h!=="categorical"&&!j||c.value.property!==void 0||q.push(new lt(c.key,c.value,'"property" property is required')),q;function K(ue){let ge=[];const ye=ue.value,Te=ue.key;if(Dr(ye)!=="array")return[new lt(Te,ye,`array expected, ${Dr(ye)} found`)];if(ye.length!==2)return[new lt(Te,ye,`array length 2 expected, length ${ye.length} found`)];if(j){if(Dr(ye[0])!=="object")return[new lt(Te,ye,`object expected, ${Dr(ye[0])} found`)];if(ye[0].zoom===void 0)return[new lt(Te,ye,"object stop key must have zoom")];if(ye[0].value===void 0)return[new lt(Te,ye,"object stop key must have value")];if(T&&T>vn(ye[0].zoom))return[new lt(Te,ye[0].zoom,"stop zoom values must appear in ascending order")];vn(ye[0].zoom)!==T&&(T=vn(ye[0].zoom),w=void 0,C={}),ge=ge.concat(Wi({key:`${Te}[0]`,value:ye[0],valueSpec:{zoom:{}},validateSpec:ue.validateSpec,style:ue.style,styleSpec:ue.styleSpec,objectElementValidators:{zoom:hf,value:ne}}))}else ge=ge.concat(ne({key:`${Te}[0]`,value:ye[0],validateSpec:ue.validateSpec,style:ue.style,styleSpec:ue.styleSpec},ye));return Zc(Sa(ye[1]))?ge.concat([new lt(`${Te}[1]`,ye[1],"expressions are not allowed in function stops.")]):ge.concat(ue.validateSpec({key:`${Te}[1]`,value:ye[1],valueSpec:l,validateSpec:ue.validateSpec,style:ue.style,styleSpec:ue.styleSpec}))}function ne(ue,ge){const ye=Dr(ue.value),Te=vn(ue.value),Pe=ue.value!==null?ue.value:ge;if(m){if(ye!==m)return[new lt(ue.key,Pe,`${ye} stop domain type must match previous stop domain type ${m}`)]}else m=ye;if(ye!=="number"&&ye!=="string"&&ye!=="boolean")return[new lt(ue.key,Pe,"stop domain value must be a number, string, or boolean")];if(ye!=="number"&&h!=="categorical"){let We=`number expected, ${ye} found`;return Jo(l)&&h===void 0&&(We+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new lt(ue.key,Pe,We)]}return h!=="categorical"||ye!=="number"||isFinite(Te)&&Math.floor(Te)===Te?h!=="categorical"&&ye==="number"&&w!==void 0&&Te<w?[new lt(ue.key,Pe,"stop domain values must appear in ascending order")]:(w=Te,h==="categorical"&&Te in C?[new lt(ue.key,Pe,"stop domain values must be unique")]:(C[Te]=!0,[])):[new lt(ue.key,Pe,`integer expected, found ${Te}`)]}}function il(c){const l=(c.expressionContext==="property"?lf:el)(Sa(c.value),c.valueSpec);if(l.result==="error")return l.value.map(m=>new lt(`${c.key}${m.key}`,c.value,m.message));const h=l.value.expression||l.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!h.outputDefined())return[new lt(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!Ko(h))return[new lt(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter"&&!Ko(h))return[new lt(c.key,c.value,'"feature-state" data expressions are not supported with filters.')];if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!Eu(h,["zoom","feature-state"]))return[new lt(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!Su(h))return[new lt(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function hs(c){const l=c.key,h=c.value,m=c.valueSpec,w=[];return Array.isArray(m.values)?m.values.indexOf(vn(h))===-1&&w.push(new lt(l,h,`expected one of [${m.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(m.values).indexOf(vn(h))===-1&&w.push(new lt(l,h,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(h)} found`)),w}function df(c){return Xc(Sa(c.value))?il(mr({},c,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Qc(c)}function Qc(c){const l=c.value,h=c.key;if(Dr(l)!=="array")return[new lt(h,l,`array expected, ${Dr(l)} found`)];const m=c.styleSpec;let w,T=[];if(l.length<1)return[new lt(h,l,"filter array must have at least 1 element")];switch(T=T.concat(hs({key:`${h}[0]`,value:l[0],valueSpec:m.filter_operator,style:c.style,styleSpec:c.styleSpec})),vn(l[0])){case"<":case"<=":case">":case">=":l.length>=2&&vn(l[1])==="$type"&&T.push(new lt(h,l,`"$type" cannot be use with operator "${l[0]}"`));case"==":case"!=":l.length!==3&&T.push(new lt(h,l,`filter array for operator "${l[0]}" must have 3 elements`));case"in":case"!in":l.length>=2&&(w=Dr(l[1]),w!=="string"&&T.push(new lt(`${h}[1]`,l[1],`string expected, ${w} found`)));for(let C=2;C<l.length;C++)w=Dr(l[C]),vn(l[1])==="$type"?T=T.concat(hs({key:`${h}[${C}]`,value:l[C],valueSpec:m.geometry_type,style:c.style,styleSpec:c.styleSpec})):w!=="string"&&w!=="number"&&w!=="boolean"&&T.push(new lt(`${h}[${C}]`,l[C],`string, number, or boolean expected, ${w} found`));break;case"any":case"all":case"none":for(let C=1;C<l.length;C++)T=T.concat(Qc({key:`${h}[${C}]`,value:l[C],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":w=Dr(l[1]),l.length!==2?T.push(new lt(h,l,`filter array for "${l[0]}" operator must have 2 elements`)):w!=="string"&&T.push(new lt(`${h}[1]`,l[1],`string expected, ${w} found`))}return T}function ff(c,l){const h=c.key,m=c.validateSpec,w=c.style,T=c.styleSpec,C=c.value,N=c.objectKey,L=T[`${l}_${c.layerType}`];if(!L)return[];const j=N.match(/^(.*)-transition$/);if(l==="paint"&&j&&L[j[1]]&&L[j[1]].transition)return m({key:h,value:C,valueSpec:T.transition,style:w,styleSpec:T});const q=c.valueSpec||L[N];if(!q)return[new lt(h,C,`unknown property "${N}"`)];let K;if(Dr(C)==="string"&&Jo(q)&&!q.tokens&&(K=/^{([^}]+)}$/.exec(C)))return[new lt(h,C,`"${N}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(K[1])} }\`.`)];const ne=[];return c.layerType==="symbol"&&(N==="text-field"&&w&&!w.glyphs&&ne.push(new lt(h,C,'use of "text-field" requires a style "glyphs" property')),N==="text-font"&&Hc(Sa(C))&&vn(C.type)==="identity"&&ne.push(new lt(h,C,'"text-font" does not support identity functions'))),ne.concat(m({key:c.key,value:C,valueSpec:q,style:w,styleSpec:T,expressionContext:"property",propertyType:l,propertyKey:N}))}function eh(c){return ff(c,"paint")}function pf(c){return ff(c,"layout")}function mf(c){let l=[];const h=c.value,m=c.key,w=c.style,T=c.styleSpec;h.type||h.ref||l.push(new lt(m,h,'either "type" or "ref" is required'));let C=vn(h.type);const N=vn(h.ref);if(h.id){const L=vn(h.id);for(let j=0;j<c.arrayIndex;j++){const q=w.layers[j];vn(q.id)===L&&l.push(new lt(m,h.id,`duplicate layer id "${h.id}", previously used at line ${q.id.__line__}`))}}if("ref"in h){let L;["type","source","source-layer","filter","layout"].forEach(j=>{j in h&&l.push(new lt(m,h[j],`"${j}" is prohibited for ref layers`))}),w.layers.forEach(j=>{vn(j.id)===N&&(L=j)}),L?L.ref?l.push(new lt(m,h.ref,"ref cannot reference another ref layer")):C=vn(L.type):l.push(new lt(m,h.ref,`ref layer "${N}" not found`))}else if(C!=="background")if(h.source){const L=w.sources&&w.sources[h.source],j=L&&vn(L.type);L?j==="vector"&&C==="raster"?l.push(new lt(m,h.source,`layer "${h.id}" requires a raster source`)):j!=="raster-dem"&&C==="hillshade"?l.push(new lt(m,h.source,`layer "${h.id}" requires a raster-dem source`)):j==="raster"&&C!=="raster"?l.push(new lt(m,h.source,`layer "${h.id}" requires a vector source`)):j!=="vector"||h["source-layer"]?j==="raster-dem"&&C!=="hillshade"?l.push(new lt(m,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):C!=="line"||!h.paint||!h.paint["line-gradient"]||j==="geojson"&&L.lineMetrics||l.push(new lt(m,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):l.push(new lt(m,h,`layer "${h.id}" must specify a "source-layer"`)):l.push(new lt(m,h.source,`source "${h.source}" not found`))}else l.push(new lt(m,h,'missing required property "source"'));return l=l.concat(Wi({key:m,value:h,valueSpec:T.layer,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,objectElementValidators:{"*":()=>[],type:()=>c.validateSpec({key:`${m}.type`,value:h.type,valueSpec:T.layer.type,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,object:h,objectKey:"type"}),filter:df,layout:L=>Wi({layer:h,key:L.key,value:L.value,style:L.style,styleSpec:L.styleSpec,validateSpec:L.validateSpec,objectElementValidators:{"*":j=>pf(mr({layerType:C},j))}}),paint:L=>Wi({layer:h,key:L.key,value:L.value,style:L.style,styleSpec:L.styleSpec,validateSpec:L.validateSpec,objectElementValidators:{"*":j=>eh(mr({layerType:C},j))}})}})),l}function fo(c){const l=c.value,h=c.key,m=Dr(l);return m!=="string"?[new lt(h,l,`string expected, ${m} found`)]:[]}const th={promoteId:function({key:c,value:l}){if(Dr(l)==="string")return fo({key:c,value:l});{const h=[];for(const m in l)h.push(...fo({key:`${c}.${m}`,value:l[m]}));return h}}};function Iu(c){const l=c.value,h=c.key,m=c.styleSpec,w=c.style,T=c.validateSpec;if(!l.type)return[new lt(h,l,'"type" is required')];const C=vn(l.type);let N;switch(C){case"vector":case"raster":return N=Wi({key:h,value:l,valueSpec:m[`source_${C.replace("-","_")}`],style:c.style,styleSpec:m,objectElementValidators:th,validateSpec:T}),N;case"raster-dem":return N=function(L){var j;const q=(j=L.sourceName)!==null&&j!==void 0?j:"",K=L.value,ne=L.styleSpec,ue=ne.source_raster_dem,ge=L.style;let ye=[];const Te=Dr(K);if(K===void 0)return ye;if(Te!=="object")return ye.push(new lt("source_raster_dem",K,`object expected, ${Te} found`)),ye;const Pe=vn(K.encoding)==="custom",We=["redFactor","greenFactor","blueFactor","baseShift"],Re=L.value.encoding?`"${L.value.encoding}"`:"Default";for(const He in K)!Pe&&We.includes(He)?ye.push(new lt(He,K[He],`In "${q}": "${He}" is only valid when "encoding" is set to "custom". ${Re} encoding found`)):ue[He]?ye=ye.concat(L.validateSpec({key:He,value:K[He],valueSpec:ue[He],validateSpec:L.validateSpec,style:ge,styleSpec:ne})):ye.push(new lt(He,K[He],`unknown property "${He}"`));return ye}({sourceName:h,value:l,style:c.style,styleSpec:m,validateSpec:T}),N;case"geojson":if(N=Wi({key:h,value:l,valueSpec:m.source_geojson,style:w,styleSpec:m,validateSpec:T,objectElementValidators:th}),l.cluster)for(const L in l.clusterProperties){const[j,q]=l.clusterProperties[L],K=typeof j=="string"?[j,["accumulated"],["get",L]]:j;N.push(...il({key:`${h}.${L}.map`,value:q,expressionContext:"cluster-map"})),N.push(...il({key:`${h}.${L}.reduce`,value:K,expressionContext:"cluster-reduce"}))}return N;case"video":return Wi({key:h,value:l,valueSpec:m.source_video,style:w,validateSpec:T,styleSpec:m});case"image":return Wi({key:h,value:l,valueSpec:m.source_image,style:w,validateSpec:T,styleSpec:m});case"canvas":return[new lt(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return hs({key:`${h}.type`,value:l.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function gf(c){const l=c.value,h=c.styleSpec,m=h.light,w=c.style;let T=[];const C=Dr(l);if(l===void 0)return T;if(C!=="object")return T=T.concat([new lt("light",l,`object expected, ${C} found`)]),T;for(const N in l){const L=N.match(/^(.*)-transition$/);T=T.concat(L&&m[L[1]]&&m[L[1]].transition?c.validateSpec({key:N,value:l[N],valueSpec:h.transition,validateSpec:c.validateSpec,style:w,styleSpec:h}):m[N]?c.validateSpec({key:N,value:l[N],valueSpec:m[N],validateSpec:c.validateSpec,style:w,styleSpec:h}):[new lt(N,l[N],`unknown property "${N}"`)])}return T}function vf(c){const l=c.value,h=c.styleSpec,m=h.sky,w=c.style,T=Dr(l);if(l===void 0)return[];if(T!=="object")return[new lt("sky",l,`object expected, ${T} found`)];let C=[];for(const N in l)C=C.concat(m[N]?c.validateSpec({key:N,value:l[N],valueSpec:m[N],style:w,styleSpec:h}):[new lt(N,l[N],`unknown property "${N}"`)]);return C}function yf(c){const l=c.value,h=c.styleSpec,m=h.terrain,w=c.style;let T=[];const C=Dr(l);if(l===void 0)return T;if(C!=="object")return T=T.concat([new lt("terrain",l,`object expected, ${C} found`)]),T;for(const N in l)T=T.concat(m[N]?c.validateSpec({key:N,value:l[N],valueSpec:m[N],validateSpec:c.validateSpec,style:w,styleSpec:h}):[new lt(N,l[N],`unknown property "${N}"`)]);return T}function xf(c){let l=[];const h=c.value,m=c.key;if(Array.isArray(h)){const w=[],T=[];for(const C in h)h[C].id&&w.includes(h[C].id)&&l.push(new lt(m,h,`all the sprites' ids must be unique, but ${h[C].id} is duplicated`)),w.push(h[C].id),h[C].url&&T.includes(h[C].url)&&l.push(new lt(m,h,`all the sprites' URLs must be unique, but ${h[C].url} is duplicated`)),T.push(h[C].url),l=l.concat(Wi({key:`${m}[${C}]`,value:h[C],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:c.validateSpec}));return l}return fo({key:m,value:h})}const rh={"*":()=>[],array:Pu,boolean:function(c){const l=c.value,h=c.key,m=Dr(l);return m!=="boolean"?[new lt(h,l,`boolean expected, ${m} found`)]:[]},number:hf,color:function(c){const l=c.key,h=c.value,m=Dr(h);return m!=="string"?[new lt(l,h,`color expected, ${m} found`)]:Mr.parse(String(h))?[]:[new lt(l,h,`color expected, "${h}" found`)]},constants:Sg,enum:hs,filter:df,function:Jc,layer:mf,object:Wi,source:Iu,light:gf,sky:vf,terrain:yf,projection:function(c){const l=c.value,h=c.styleSpec,m=h.projection,w=c.style,T=Dr(l);if(l===void 0)return[];if(T!=="object")return[new lt("projection",l,`object expected, ${T} found`)];let C=[];for(const N in l)C=C.concat(m[N]?c.validateSpec({key:N,value:l[N],valueSpec:m[N],style:w,styleSpec:h}):[new lt(N,l[N],`unknown property "${N}"`)]);return C},string:fo,formatted:function(c){return fo(c).length===0?[]:il(c)},resolvedImage:function(c){return fo(c).length===0?[]:il(c)},padding:function(c){const l=c.key,h=c.value;if(Dr(h)==="array"){if(h.length<1||h.length>4)return[new lt(l,h,`padding requires 1 to 4 values; ${h.length} values found`)];const m={type:"number"};let w=[];for(let T=0;T<h.length;T++)w=w.concat(c.validateSpec({key:`${l}[${T}]`,value:h[T],validateSpec:c.validateSpec,valueSpec:m}));return w}return hf({key:l,value:h,valueSpec:{}})},variableAnchorOffsetCollection:function(c){const l=c.key,h=c.value,m=Dr(h),w=c.styleSpec;if(m!=="array"||h.length<1||h.length%2!=0)return[new lt(l,h,"variableAnchorOffsetCollection requires a non-empty array of even length")];let T=[];for(let C=0;C<h.length;C+=2)T=T.concat(hs({key:`${l}[${C}]`,value:h[C],valueSpec:w.layout_symbol["text-anchor"]})),T=T.concat(Pu({key:`${l}[${C+1}]`,value:h[C+1],valueSpec:{length:2,value:"number"},validateSpec:c.validateSpec,style:c.style,styleSpec:w}));return T},sprite:xf};function Au(c){const l=c.value,h=c.valueSpec,m=c.styleSpec;return c.validateSpec=Au,h.expression&&Hc(vn(l))?Jc(c):h.expression&&Zc(Sa(l))?il(c):h.type&&rh[h.type]?rh[h.type](c):Wi(mr({},c,{valueSpec:h.type?m[h.type]:h}))}function Eg(c){const l=c.value,h=c.key,m=fo(c);return m.length||(l.indexOf("{fontstack}")===-1&&m.push(new lt(h,l,'"glyphs" url must include a "{fontstack}" token')),l.indexOf("{range}")===-1&&m.push(new lt(h,l,'"glyphs" url must include a "{range}" token'))),m}function sa(c,l=$e){let h=[];return h=h.concat(Au({key:"",value:c,valueSpec:l.$root,styleSpec:l,style:c,validateSpec:Au,objectElementValidators:{glyphs:Eg,"*":()=>[]}})),c.constants&&(h=h.concat(Sg({key:"constants",value:c.constants}))),_f(h)}function Ua(c){return function(l){return c({...l,validateSpec:Au})}}function _f(c){return[].concat(c).sort((l,h)=>l.line-h.line)}function Ea(c){return function(...l){return _f(c.apply(this,l))}}sa.source=Ea(Ua(Iu)),sa.sprite=Ea(Ua(xf)),sa.glyphs=Ea(Ua(Eg)),sa.light=Ea(Ua(gf)),sa.sky=Ea(Ua(vf)),sa.terrain=Ea(Ua(yf)),sa.layer=Ea(Ua(mf)),sa.filter=Ea(Ua(df)),sa.paintProperty=Ea(Ua(eh)),sa.layoutProperty=Ea(Ua(pf));const po=sa,Ix=po.light,Ax=po.sky,Tg=po.paintProperty,Cg=po.layoutProperty;function wf(c,l){let h=!1;if(l&&l.length)for(const m of l)c.fire(new mt(new Error(m.message))),h=!0;return h}class al{constructor(l,h,m){const w=this.cells=[];if(l instanceof ArrayBuffer){this.arrayBuffer=l;const C=new Int32Array(this.arrayBuffer);l=C[0],this.d=(h=C[1])+2*(m=C[2]);for(let L=0;L<this.d*this.d;L++){const j=C[3+L],q=C[3+L+1];w.push(j===q?null:C.subarray(j,q))}const N=C[3+w.length+1];this.keys=C.subarray(C[3+w.length],N),this.bboxes=C.subarray(N),this.insert=this._insertReadonly}else{this.d=h+2*m;for(let C=0;C<this.d*this.d;C++)w.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=l,this.padding=m,this.scale=h/l,this.uid=0;const T=m/h*l;this.min=-T,this.max=l+T}insert(l,h,m,w,T){this._forEachCell(h,m,w,T,this._insertCell,this.uid++,void 0,void 0),this.keys.push(l),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(w),this.bboxes.push(T)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(l,h,m,w,T,C){this.cells[T].push(C)}query(l,h,m,w,T){const C=this.min,N=this.max;if(l<=C&&h<=C&&N<=m&&N<=w&&!T)return Array.prototype.slice.call(this.keys);{const L=[];return this._forEachCell(l,h,m,w,this._queryCell,L,{},T),L}}_queryCell(l,h,m,w,T,C,N,L){const j=this.cells[T];if(j!==null){const q=this.keys,K=this.bboxes;for(let ne=0;ne<j.length;ne++){const ue=j[ne];if(N[ue]===void 0){const ge=4*ue;(L?L(K[ge+0],K[ge+1],K[ge+2],K[ge+3]):l<=K[ge+2]&&h<=K[ge+3]&&m>=K[ge+0]&&w>=K[ge+1])?(N[ue]=!0,C.push(q[ue])):N[ue]=!1}}}}_forEachCell(l,h,m,w,T,C,N,L){const j=this._convertToCellCoord(l),q=this._convertToCellCoord(h),K=this._convertToCellCoord(m),ne=this._convertToCellCoord(w);for(let ue=j;ue<=K;ue++)for(let ge=q;ge<=ne;ge++){const ye=this.d*ge+ue;if((!L||L(this._convertFromCellCoord(ue),this._convertFromCellCoord(ge),this._convertFromCellCoord(ue+1),this._convertFromCellCoord(ge+1)))&&T.call(this,l,h,m,w,ye,C,N,L))return}}_convertFromCellCoord(l){return(l-this.padding)/this.scale}_convertToCellCoord(l){return Math.max(0,Math.min(this.d-1,Math.floor(l*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const l=this.cells,h=3+this.cells.length+1+1;let m=0;for(let C=0;C<this.cells.length;C++)m+=this.cells[C].length;const w=new Int32Array(h+m+this.keys.length+this.bboxes.length);w[0]=this.extent,w[1]=this.n,w[2]=this.padding;let T=h;for(let C=0;C<l.length;C++){const N=l[C];w[3+C]=T,w.set(N,T),T+=N.length}return w[3+l.length]=T,w.set(this.keys,T),T+=this.keys.length,w[3+l.length+1]=T,w.set(this.bboxes,T),T+=this.bboxes.length,w.buffer}static serialize(l,h){const m=l.toArrayBuffer();return h&&h.push(m),{buffer:m}}static deserialize(l){return new al(l.buffer)}}const oa={};function Ft(c,l,h={}){if(oa[c])throw new Error(`${c} is already registered.`);Object.defineProperty(l,"_classRegistryKey",{value:c,writeable:!1}),oa[c]={klass:l,omit:h.omit||[],shallow:h.shallow||[]}}Ft("Object",Object),Ft("TransferableGridIndex",al),Ft("Color",Mr),Ft("Error",Error),Ft("AJAXError",et),Ft("ResolvedImage",Bn),Ft("StylePropertyFunction",nl),Ft("StyleExpression",Wc,{omit:["_evaluator"]}),Ft("ZoomDependentExpression",rl),Ft("ZoomConstantExpression",tl),Ft("CompoundExpression",aa,{omit:["_evaluate"]});for(const c in Xo)Xo[c]._classRegistryKey||Ft(`Expression_${c}`,Xo[c]);function nh(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function bf(c){return c.$name||c.constructor._classRegistryKey}function kg(c){return!function(l){if(l===null||typeof l!="object")return!1;const h=bf(l);return!(!h||h==="Object")}(c)&&(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||c instanceof Error||nh(c)||de(c)||ArrayBuffer.isView(c)||c instanceof ImageData)}function sl(c,l){if(kg(c))return(nh(c)||de(c))&&l&&l.push(c),ArrayBuffer.isView(c)&&l&&l.push(c.buffer),c instanceof ImageData&&l&&l.push(c.data.buffer),c;if(Array.isArray(c)){const T=[];for(const C of c)T.push(sl(C,l));return T}if(typeof c!="object")throw new Error("can't serialize object of type "+typeof c);const h=bf(c);if(!h)throw new Error(`can't serialize object of unregistered class ${c.constructor.name}`);if(!oa[h])throw new Error(`${h} is not registered.`);const{klass:m}=oa[h],w=m.serialize?m.serialize(c,l):{};if(m.serialize){if(l&&w===l[l.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const T in c){if(!c.hasOwnProperty(T)||oa[h].omit.indexOf(T)>=0)continue;const C=c[T];w[T]=oa[h].shallow.indexOf(T)>=0?C:sl(C,l)}c instanceof Error&&(w.message=c.message)}if(w.$name)throw new Error("$name property is reserved for worker serialization logic.");return h!=="Object"&&(w.$name=h),w}function ol(c){if(kg(c))return c;if(Array.isArray(c))return c.map(ol);if(typeof c!="object")throw new Error("can't deserialize object of type "+typeof c);const l=bf(c)||"Object";if(!oa[l])throw new Error(`can't deserialize unregistered class ${l}`);const{klass:h}=oa[l];if(!h)throw new Error(`can't deserialize unregistered class ${l}`);if(h.deserialize)return h.deserialize(c);const m=Object.create(h.prototype);for(const w of Object.keys(c)){if(w==="$name")continue;const T=c[w];m[w]=oa[l].shallow.indexOf(w)>=0?T:ol(T)}return m}class Sf{constructor(){this.first=!0}update(l,h){const m=Math.floor(l);return this.first?(this.first=!1,this.lastIntegerZoom=m,this.lastIntegerZoomTime=0,this.lastZoom=l,this.lastFloorZoom=m,!0):(this.lastFloorZoom>m?(this.lastIntegerZoom=m+1,this.lastIntegerZoomTime=h):this.lastFloorZoom<m&&(this.lastIntegerZoom=m,this.lastIntegerZoomTime=h),l!==this.lastZoom&&(this.lastZoom=l,this.lastFloorZoom=m,!0))}}const Tr={"Latin-1 Supplement":c=>c>=128&&c<=255,"Hangul Jamo":c=>c>=4352&&c<=4607,Khmer:c=>c>=6016&&c<=6143,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Katakana:c=>c>=12448&&c<=12543,Kanbun:c=>c>=12688&&c<=12703,"CJK Strokes":c=>c>=12736&&c<=12783,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"Private Use Area":c=>c>=57344&&c<=63743,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519};function Ef(c){for(const l of c)if(Cf(l.charCodeAt(0)))return!0;return!1}function Mx(c){for(const l of c)if(!ll(l.charCodeAt(0)))return!1;return!0}function Tf(c){const l=c.map(h=>{try{return new RegExp(`\\p{sc=${h}}`,"u").source}catch{return null}}).filter(h=>h);return new RegExp(l.join("|"),"u")}const Dx=Tf(["Arab","Dupl","Mong","Ougr","Syrc"]);function ll(c){return!Dx.test(String.fromCodePoint(c))}const Pg=Tf(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Cf(c){return!(c!==746&&c!==747&&(c<4352||!(Tr["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||Tr["CJK Compatibility"](c)||Tr["CJK Strokes"](c)||!(!Tr["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||Tr["Enclosed CJK Letters and Months"](c)||Tr["Ideographic Description Characters"](c)||Tr.Kanbun(c)||Tr.Katakana(c)&&c!==12540||!(!Tr["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!Tr["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||Tr["Vertical Forms"](c)||Tr["Yijing Hexagram Symbols"](c)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(c))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(c))||Pg.test(String.fromCodePoint(c)))))}function Ig(c){return!(Cf(c)||function(l){return!!(Tr["Latin-1 Supplement"](l)&&(l===167||l===169||l===174||l===177||l===188||l===189||l===190||l===215||l===247)||Tr["General Punctuation"](l)&&(l===8214||l===8224||l===8225||l===8240||l===8241||l===8251||l===8252||l===8258||l===8263||l===8264||l===8265||l===8273)||Tr["Letterlike Symbols"](l)||Tr["Number Forms"](l)||Tr["Miscellaneous Technical"](l)&&(l>=8960&&l<=8967||l>=8972&&l<=8991||l>=8996&&l<=9e3||l===9003||l>=9085&&l<=9114||l>=9150&&l<=9165||l===9167||l>=9169&&l<=9179||l>=9186&&l<=9215)||Tr["Control Pictures"](l)&&l!==9251||Tr["Optical Character Recognition"](l)||Tr["Enclosed Alphanumerics"](l)||Tr["Geometric Shapes"](l)||Tr["Miscellaneous Symbols"](l)&&!(l>=9754&&l<=9759)||Tr["Miscellaneous Symbols and Arrows"](l)&&(l>=11026&&l<=11055||l>=11088&&l<=11097||l>=11192&&l<=11243)||Tr["CJK Symbols and Punctuation"](l)||Tr.Katakana(l)||Tr["Private Use Area"](l)||Tr["CJK Compatibility Forms"](l)||Tr["Small Form Variants"](l)||Tr["Halfwidth and Fullwidth Forms"](l)||l===8734||l===8756||l===8757||l>=9984&&l<=10087||l>=10102&&l<=10131||l===65532||l===65533)}(c))}const Nx=Tf(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function kf(c){return Nx.test(String.fromCodePoint(c))}function zx(c,l){return!(!l&&kf(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||Tr.Khmer(c))}function Rx(c){for(const l of c)if(kf(l.charCodeAt(0)))return!0;return!1}const Zi=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(c){this.pluginStatus=c.pluginStatus,this.pluginURL=c.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(c){this.applyArabicShaping=c.applyArabicShaping,this.processBidirectionalText=c.processBidirectionalText,this.processStyledBidirectionalText=c.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Yr{constructor(l,h){this.zoom=l,h?(this.now=h.now,this.fadeDuration=h.fadeDuration,this.zoomHistory=h.zoomHistory,this.transition=h.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Sf,this.transition={})}isSupportedScript(l){return function(h,m){for(const w of h)if(!zx(w.charCodeAt(0),m))return!1;return!0}(l,Zi.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const l=this.zoom,h=l-Math.floor(l),m=this.crossFadingFactor();return l>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:h+(1-h)*m}:{fromScale:.5,toScale:1,t:1-(1-m)*h}}}class ul{constructor(l,h){this.property=l,this.value=h,this.expression=function(m,w){if(Hc(m))return new nl(m,w);if(Zc(m)){const T=lf(m,w);if(T.result==="error")throw new Error(T.value.map(C=>`${C.key}: ${C.message}`).join(", "));return T.value}{let T=m;return w.type==="color"&&typeof m=="string"?T=Mr.parse(m):w.type!=="padding"||typeof m!="number"&&!Array.isArray(m)?w.type==="variableAnchorOffsetCollection"&&Array.isArray(m)&&(T=Nn.parse(m)):T=bn.parse(m),{kind:"constant",evaluate:()=>T}}}(h===void 0?l.specification.default:h,l.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(l,h,m){return this.property.possiblyEvaluate(this,l,h,m)}}class ih{constructor(l){this.property=l,this.value=new ul(l,void 0)}transitioned(l,h){return new Ag(this.property,this.value,h,$({},l.transition,this.transition),l.now)}untransitioned(){return new Ag(this.property,this.value,null,{},0)}}class ah{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitionablePropertyValues)}getValue(l){return X(this._values[l].value.value)}setValue(l,h){Object.prototype.hasOwnProperty.call(this._values,l)||(this._values[l]=new ih(this._values[l].property)),this._values[l].value=new ul(this._values[l].property,h===null?void 0:X(h))}getTransition(l){return X(this._values[l].transition)}setTransition(l,h){Object.prototype.hasOwnProperty.call(this._values,l)||(this._values[l]=new ih(this._values[l].property)),this._values[l].transition=X(h)||void 0}serialize(){const l={};for(const h of Object.keys(this._values)){const m=this.getValue(h);m!==void 0&&(l[h]=m);const w=this.getTransition(h);w!==void 0&&(l[`${h}-transition`]=w)}return l}transitioned(l,h){const m=new Mu(this._properties);for(const w of Object.keys(this._values))m._values[w]=this._values[w].transitioned(l,h._values[w]);return m}untransitioned(){const l=new Mu(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].untransitioned();return l}}class Ag{constructor(l,h,m,w,T){this.property=l,this.value=h,this.begin=T+w.delay||0,this.end=this.begin+w.duration||0,l.specification.transition&&(w.delay||w.duration)&&(this.prior=m)}possiblyEvaluate(l,h,m){const w=l.now||0,T=this.value.possiblyEvaluate(l,h,m),C=this.prior;if(C){if(w>this.end)return this.prior=null,T;if(this.value.isDataDriven())return this.prior=null,T;if(w<this.begin)return C.possiblyEvaluate(l,h,m);{const N=(w-this.begin)/(this.end-this.begin);return this.property.interpolate(C.possiblyEvaluate(l,h,m),T,function(L){if(L<=0)return 0;if(L>=1)return 1;const j=L*L,q=j*L;return 4*(L<.5?q:3*(L-j)+q-.75)}(N))}}return T}}class Mu{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitioningPropertyValues)}possiblyEvaluate(l,h,m){const w=new Nu(this._properties);for(const T of Object.keys(this._values))w._values[T]=this._values[T].possiblyEvaluate(l,h,m);return w}hasTransition(){for(const l of Object.keys(this._values))if(this._values[l].prior)return!0;return!1}}class Du{constructor(l){this._properties=l,this._values=Object.create(l.defaultPropertyValues)}hasValue(l){return this._values[l].value!==void 0}getValue(l){return X(this._values[l].value)}setValue(l,h){this._values[l]=new ul(this._values[l].property,h===null?void 0:X(h))}serialize(){const l={};for(const h of Object.keys(this._values)){const m=this.getValue(h);m!==void 0&&(l[h]=m)}return l}possiblyEvaluate(l,h,m){const w=new Nu(this._properties);for(const T of Object.keys(this._values))w._values[T]=this._values[T].possiblyEvaluate(l,h,m);return w}}class qa{constructor(l,h,m){this.property=l,this.value=h,this.parameters=m}isConstant(){return this.value.kind==="constant"}constantOr(l){return this.value.kind==="constant"?this.value.value:l}evaluate(l,h,m,w){return this.property.evaluate(this.value,this.parameters,l,h,m,w)}}class Nu{constructor(l){this._properties=l,this._values=Object.create(l.defaultPossiblyEvaluatedValues)}get(l){return this._values[l]}}class Gt{constructor(l){this.specification=l}possiblyEvaluate(l,h){if(l.isDataDriven())throw new Error("Value should not be data driven");return l.expression.evaluate(h)}interpolate(l,h,m){const w=Ii[this.specification.type];return w?w(l,h,m):l}}class ir{constructor(l,h){this.specification=l,this.overrides=h}possiblyEvaluate(l,h,m,w){return new qa(this,l.expression.kind==="constant"||l.expression.kind==="camera"?{kind:"constant",value:l.expression.evaluate(h,null,{},m,w)}:l.expression,h)}interpolate(l,h,m){if(l.value.kind!=="constant"||h.value.kind!=="constant")return l;if(l.value.value===void 0||h.value.value===void 0)return new qa(this,{kind:"constant",value:void 0},l.parameters);const w=Ii[this.specification.type];if(w){const T=w(l.value.value,h.value.value,m);return new qa(this,{kind:"constant",value:T},l.parameters)}return l}evaluate(l,h,m,w,T,C){return l.kind==="constant"?l.value:l.evaluate(h,m,w,T,C)}}class sh extends ir{possiblyEvaluate(l,h,m,w){if(l.value===void 0)return new qa(this,{kind:"constant",value:void 0},h);if(l.expression.kind==="constant"){const T=l.expression.evaluate(h,null,{},m,w),C=l.property.specification.type==="resolvedImage"&&typeof T!="string"?T.name:T,N=this._calculate(C,C,C,h);return new qa(this,{kind:"constant",value:N},h)}if(l.expression.kind==="camera"){const T=this._calculate(l.expression.evaluate({zoom:h.zoom-1}),l.expression.evaluate({zoom:h.zoom}),l.expression.evaluate({zoom:h.zoom+1}),h);return new qa(this,{kind:"constant",value:T},h)}return new qa(this,l.expression,h)}evaluate(l,h,m,w,T,C){if(l.kind==="source"){const N=l.evaluate(h,m,w,T,C);return this._calculate(N,N,N,h)}return l.kind==="composite"?this._calculate(l.evaluate({zoom:Math.floor(h.zoom)-1},m,w),l.evaluate({zoom:Math.floor(h.zoom)},m,w),l.evaluate({zoom:Math.floor(h.zoom)+1},m,w),h):l.value}_calculate(l,h,m,w){return w.zoom>w.zoomHistory.lastIntegerZoom?{from:l,to:h}:{from:m,to:h}}interpolate(l){return l}}class oh{constructor(l){this.specification=l}possiblyEvaluate(l,h,m,w){if(l.value!==void 0){if(l.expression.kind==="constant"){const T=l.expression.evaluate(h,null,{},m,w);return this._calculate(T,T,T,h)}return this._calculate(l.expression.evaluate(new Yr(Math.floor(h.zoom-1),h)),l.expression.evaluate(new Yr(Math.floor(h.zoom),h)),l.expression.evaluate(new Yr(Math.floor(h.zoom+1),h)),h)}}_calculate(l,h,m,w){return w.zoom>w.zoomHistory.lastIntegerZoom?{from:l,to:h}:{from:m,to:h}}interpolate(l){return l}}class Pf{constructor(l){this.specification=l}possiblyEvaluate(l,h,m,w){return!!l.expression.evaluate(h,null,{},m,w)}interpolate(){return!1}}class E{constructor(l){this.properties=l,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const h in l){const m=l[h];m.specification.overridable&&this.overridableProperties.push(h);const w=this.defaultPropertyValues[h]=new ul(m,void 0),T=this.defaultTransitionablePropertyValues[h]=new ih(m);this.defaultTransitioningPropertyValues[h]=T.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=w.possiblyEvaluate({})}}}Ft("DataDrivenProperty",ir),Ft("DataConstantProperty",Gt),Ft("CrossFadedDataDrivenProperty",sh),Ft("CrossFadedProperty",oh),Ft("ColorRampProperty",Pf);const o="-transition";class f extends Tt{constructor(l,h){if(super(),this.id=l.id,this.type=l.type,this._featureFilter={filter:()=>!0,needGeometry:!1},l.type!=="custom"&&(this.metadata=l.metadata,this.minzoom=l.minzoom,this.maxzoom=l.maxzoom,l.type!=="background"&&(this.source=l.source,this.sourceLayer=l["source-layer"],this.filter=l.filter),h.layout&&(this._unevaluatedLayout=new Du(h.layout)),h.paint)){this._transitionablePaint=new ah(h.paint);for(const m in l.paint)this.setPaintProperty(m,l.paint[m],{validate:!1});for(const m in l.layout)this.setLayoutProperty(m,l.layout[m],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Nu(h.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(l){return l==="visibility"?this.visibility:this._unevaluatedLayout.getValue(l)}setLayoutProperty(l,h,m={}){h!=null&&this._validate(Cg,`layers.${this.id}.layout.${l}`,l,h,m)||(l!=="visibility"?this._unevaluatedLayout.setValue(l,h):this.visibility=h)}getPaintProperty(l){return l.endsWith(o)?this._transitionablePaint.getTransition(l.slice(0,-11)):this._transitionablePaint.getValue(l)}setPaintProperty(l,h,m={}){if(h!=null&&this._validate(Tg,`layers.${this.id}.paint.${l}`,l,h,m))return!1;if(l.endsWith(o))return this._transitionablePaint.setTransition(l.slice(0,-11),h||void 0),!1;{const w=this._transitionablePaint._values[l],T=w.property.specification["property-type"]==="cross-faded-data-driven",C=w.value.isDataDriven(),N=w.value;this._transitionablePaint.setValue(l,h),this._handleSpecialPaintPropertyUpdate(l);const L=this._transitionablePaint._values[l].value;return L.isDataDriven()||C||T||this._handleOverridablePaintPropertyUpdate(l,N,L)}}_handleSpecialPaintPropertyUpdate(l){}_handleOverridablePaintPropertyUpdate(l,h,m){return!1}isHidden(l){return!!(this.minzoom&&l<this.minzoom)||!!(this.maxzoom&&l>=this.maxzoom)||this.visibility==="none"}updateTransitions(l){this._transitioningPaint=this._transitionablePaint.transitioned(l,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(l,h){l.getCrossfadeParameters&&(this._crossfadeParameters=l.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(l,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(l,void 0,h)}serialize(){const l={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(l.layout=l.layout||{},l.layout.visibility=this.visibility),Q(l,(h,m)=>!(h===void 0||m==="layout"&&!Object.keys(h).length||m==="paint"&&!Object.keys(h).length))}_validate(l,h,m,w,T={}){return(!T||T.validate!==!1)&&wf(this,l.call(po,{key:h,layerType:this.type,objectKey:m,value:w,styleSpec:$e,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const l in this.paint._values){const h=this.paint.get(l);if(h instanceof qa&&Jo(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1}}const y={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class x{constructor(l,h){this._structArray=l,this._pos1=h*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class S{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(l,h){return l._trim(),h&&(l.isTransferred=!0,h.push(l.arrayBuffer)),{length:l.length,arrayBuffer:l.arrayBuffer}}static deserialize(l){const h=Object.create(this.prototype);return h.arrayBuffer=l.arrayBuffer,h.length=l.length,h.capacity=l.arrayBuffer.byteLength/h.bytesPerElement,h._refreshViews(),h}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(l){this.reserve(l),this.length=l}reserve(l){if(l>this.capacity){this.capacity=Math.max(l,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const h=this.uint8;this._refreshViews(),h&&this.uint8.set(h)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function R(c,l=1){let h=0,m=0;return{members:c.map(w=>{const T=y[w.type].BYTES_PER_ELEMENT,C=h=B(h,Math.max(l,T)),N=w.components||1;return m=Math.max(m,T),h+=T*N,{name:w.name,type:w.type,components:N,offset:C}}),size:B(h,Math.max(m,l)),alignment:l}}function B(c,l){return Math.ceil(c/l)*l}class F extends S{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h){const m=this.length;return this.resize(m+1),this.emplace(m,l,h)}emplace(l,h,m){const w=2*l;return this.int16[w+0]=h,this.int16[w+1]=m,l}}F.prototype.bytesPerElement=4,Ft("StructArrayLayout2i4",F);class H extends S{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,m){const w=this.length;return this.resize(w+1),this.emplace(w,l,h,m)}emplace(l,h,m,w){const T=3*l;return this.int16[T+0]=h,this.int16[T+1]=m,this.int16[T+2]=w,l}}H.prototype.bytesPerElement=6,Ft("StructArrayLayout3i6",H);class Y extends S{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,m,w){const T=this.length;return this.resize(T+1),this.emplace(T,l,h,m,w)}emplace(l,h,m,w,T){const C=4*l;return this.int16[C+0]=h,this.int16[C+1]=m,this.int16[C+2]=w,this.int16[C+3]=T,l}}Y.prototype.bytesPerElement=8,Ft("StructArrayLayout4i8",Y);class J extends S{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,m,w,T,C){const N=this.length;return this.resize(N+1),this.emplace(N,l,h,m,w,T,C)}emplace(l,h,m,w,T,C,N){const L=6*l;return this.int16[L+0]=h,this.int16[L+1]=m,this.int16[L+2]=w,this.int16[L+3]=T,this.int16[L+4]=C,this.int16[L+5]=N,l}}J.prototype.bytesPerElement=12,Ft("StructArrayLayout2i4i12",J);class he extends S{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,m,w,T,C){const N=this.length;return this.resize(N+1),this.emplace(N,l,h,m,w,T,C)}emplace(l,h,m,w,T,C,N){const L=4*l,j=8*l;return this.int16[L+0]=h,this.int16[L+1]=m,this.uint8[j+4]=w,this.uint8[j+5]=T,this.uint8[j+6]=C,this.uint8[j+7]=N,l}}he.prototype.bytesPerElement=8,Ft("StructArrayLayout2i4ub8",he);class xe extends S{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h){const m=this.length;return this.resize(m+1),this.emplace(m,l,h)}emplace(l,h,m){const w=2*l;return this.float32[w+0]=h,this.float32[w+1]=m,l}}xe.prototype.bytesPerElement=8,Ft("StructArrayLayout2f8",xe);class be extends S{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h,m,w,T,C,N,L,j,q){const K=this.length;return this.resize(K+1),this.emplace(K,l,h,m,w,T,C,N,L,j,q)}emplace(l,h,m,w,T,C,N,L,j,q,K){const ne=10*l;return this.uint16[ne+0]=h,this.uint16[ne+1]=m,this.uint16[ne+2]=w,this.uint16[ne+3]=T,this.uint16[ne+4]=C,this.uint16[ne+5]=N,this.uint16[ne+6]=L,this.uint16[ne+7]=j,this.uint16[ne+8]=q,this.uint16[ne+9]=K,l}}be.prototype.bytesPerElement=20,Ft("StructArrayLayout10ui20",be);class Ce extends S{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h,m,w,T,C,N,L,j,q,K,ne){const ue=this.length;return this.resize(ue+1),this.emplace(ue,l,h,m,w,T,C,N,L,j,q,K,ne)}emplace(l,h,m,w,T,C,N,L,j,q,K,ne,ue){const ge=12*l;return this.int16[ge+0]=h,this.int16[ge+1]=m,this.int16[ge+2]=w,this.int16[ge+3]=T,this.uint16[ge+4]=C,this.uint16[ge+5]=N,this.uint16[ge+6]=L,this.uint16[ge+7]=j,this.int16[ge+8]=q,this.int16[ge+9]=K,this.int16[ge+10]=ne,this.int16[ge+11]=ue,l}}Ce.prototype.bytesPerElement=24,Ft("StructArrayLayout4i4ui4i24",Ce);class Ie extends S{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m){const w=this.length;return this.resize(w+1),this.emplace(w,l,h,m)}emplace(l,h,m,w){const T=3*l;return this.float32[T+0]=h,this.float32[T+1]=m,this.float32[T+2]=w,l}}Ie.prototype.bytesPerElement=12,Ft("StructArrayLayout3f12",Ie);class Ae extends S{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(l){const h=this.length;return this.resize(h+1),this.emplace(h,l)}emplace(l,h){return this.uint32[1*l+0]=h,l}}Ae.prototype.bytesPerElement=4,Ft("StructArrayLayout1ul4",Ae);class ze extends S{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h,m,w,T,C,N,L,j){const q=this.length;return this.resize(q+1),this.emplace(q,l,h,m,w,T,C,N,L,j)}emplace(l,h,m,w,T,C,N,L,j,q){const K=10*l,ne=5*l;return this.int16[K+0]=h,this.int16[K+1]=m,this.int16[K+2]=w,this.int16[K+3]=T,this.int16[K+4]=C,this.int16[K+5]=N,this.uint32[ne+3]=L,this.uint16[K+8]=j,this.uint16[K+9]=q,l}}ze.prototype.bytesPerElement=20,Ft("StructArrayLayout6i1ul2ui20",ze);class Ee extends S{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,m,w,T,C){const N=this.length;return this.resize(N+1),this.emplace(N,l,h,m,w,T,C)}emplace(l,h,m,w,T,C,N){const L=6*l;return this.int16[L+0]=h,this.int16[L+1]=m,this.int16[L+2]=w,this.int16[L+3]=T,this.int16[L+4]=C,this.int16[L+5]=N,l}}Ee.prototype.bytesPerElement=12,Ft("StructArrayLayout2i2i2i12",Ee);class Fe extends S{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,m,w,T){const C=this.length;return this.resize(C+1),this.emplace(C,l,h,m,w,T)}emplace(l,h,m,w,T,C){const N=4*l,L=8*l;return this.float32[N+0]=h,this.float32[N+1]=m,this.float32[N+2]=w,this.int16[L+6]=T,this.int16[L+7]=C,l}}Fe.prototype.bytesPerElement=16,Ft("StructArrayLayout2f1f2i16",Fe);class qe extends S{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,m,w,T,C){const N=this.length;return this.resize(N+1),this.emplace(N,l,h,m,w,T,C)}emplace(l,h,m,w,T,C,N){const L=16*l,j=4*l,q=8*l;return this.uint8[L+0]=h,this.uint8[L+1]=m,this.float32[j+1]=w,this.float32[j+2]=T,this.int16[q+6]=C,this.int16[q+7]=N,l}}qe.prototype.bytesPerElement=16,Ft("StructArrayLayout2ub2f2i16",qe);class Ke extends S{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h,m){const w=this.length;return this.resize(w+1),this.emplace(w,l,h,m)}emplace(l,h,m,w){const T=3*l;return this.uint16[T+0]=h,this.uint16[T+1]=m,this.uint16[T+2]=w,l}}Ke.prototype.bytesPerElement=6,Ft("StructArrayLayout3ui6",Ke);class ct extends S{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m,w,T,C,N,L,j,q,K,ne,ue,ge,ye,Te,Pe){const We=this.length;return this.resize(We+1),this.emplace(We,l,h,m,w,T,C,N,L,j,q,K,ne,ue,ge,ye,Te,Pe)}emplace(l,h,m,w,T,C,N,L,j,q,K,ne,ue,ge,ye,Te,Pe,We){const Re=24*l,He=12*l,nt=48*l;return this.int16[Re+0]=h,this.int16[Re+1]=m,this.uint16[Re+2]=w,this.uint16[Re+3]=T,this.uint32[He+2]=C,this.uint32[He+3]=N,this.uint32[He+4]=L,this.uint16[Re+10]=j,this.uint16[Re+11]=q,this.uint16[Re+12]=K,this.float32[He+7]=ne,this.float32[He+8]=ue,this.uint8[nt+36]=ge,this.uint8[nt+37]=ye,this.uint8[nt+38]=Te,this.uint32[He+10]=Pe,this.int16[Re+22]=We,l}}ct.prototype.bytesPerElement=48,Ft("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ct);class _t extends S{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m,w,T,C,N,L,j,q,K,ne,ue,ge,ye,Te,Pe,We,Re,He,nt,vt,Nt,nr,Mt,Pt,Xt,jt){const Bt=this.length;return this.resize(Bt+1),this.emplace(Bt,l,h,m,w,T,C,N,L,j,q,K,ne,ue,ge,ye,Te,Pe,We,Re,He,nt,vt,Nt,nr,Mt,Pt,Xt,jt)}emplace(l,h,m,w,T,C,N,L,j,q,K,ne,ue,ge,ye,Te,Pe,We,Re,He,nt,vt,Nt,nr,Mt,Pt,Xt,jt,Bt){const ut=32*l,Yt=16*l;return this.int16[ut+0]=h,this.int16[ut+1]=m,this.int16[ut+2]=w,this.int16[ut+3]=T,this.int16[ut+4]=C,this.int16[ut+5]=N,this.int16[ut+6]=L,this.int16[ut+7]=j,this.uint16[ut+8]=q,this.uint16[ut+9]=K,this.uint16[ut+10]=ne,this.uint16[ut+11]=ue,this.uint16[ut+12]=ge,this.uint16[ut+13]=ye,this.uint16[ut+14]=Te,this.uint16[ut+15]=Pe,this.uint16[ut+16]=We,this.uint16[ut+17]=Re,this.uint16[ut+18]=He,this.uint16[ut+19]=nt,this.uint16[ut+20]=vt,this.uint16[ut+21]=Nt,this.uint16[ut+22]=nr,this.uint32[Yt+12]=Mt,this.float32[Yt+13]=Pt,this.float32[Yt+14]=Xt,this.uint16[ut+30]=jt,this.uint16[ut+31]=Bt,l}}_t.prototype.bytesPerElement=64,Ft("StructArrayLayout8i15ui1ul2f2ui64",_t);class It extends S{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l){const h=this.length;return this.resize(h+1),this.emplace(h,l)}emplace(l,h){return this.float32[1*l+0]=h,l}}It.prototype.bytesPerElement=4,Ft("StructArrayLayout1f4",It);class zt extends S{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m){const w=this.length;return this.resize(w+1),this.emplace(w,l,h,m)}emplace(l,h,m,w){const T=3*l;return this.uint16[6*l+0]=h,this.float32[T+1]=m,this.float32[T+2]=w,l}}zt.prototype.bytesPerElement=12,Ft("StructArrayLayout1ui2f12",zt);class Et extends S{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h,m){const w=this.length;return this.resize(w+1),this.emplace(w,l,h,m)}emplace(l,h,m,w){const T=4*l;return this.uint32[2*l+0]=h,this.uint16[T+2]=m,this.uint16[T+3]=w,l}}Et.prototype.bytesPerElement=8,Ft("StructArrayLayout1ul2ui8",Et);class St extends S{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h){const m=this.length;return this.resize(m+1),this.emplace(m,l,h)}emplace(l,h,m){const w=2*l;return this.uint16[w+0]=h,this.uint16[w+1]=m,l}}St.prototype.bytesPerElement=4,Ft("StructArrayLayout2ui4",St);class Wt extends S{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l){const h=this.length;return this.resize(h+1),this.emplace(h,l)}emplace(l,h){return this.uint16[1*l+0]=h,l}}Wt.prototype.bytesPerElement=2,Ft("StructArrayLayout1ui2",Wt);class hr extends S{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m,w){const T=this.length;return this.resize(T+1),this.emplace(T,l,h,m,w)}emplace(l,h,m,w,T){const C=4*l;return this.float32[C+0]=h,this.float32[C+1]=m,this.float32[C+2]=w,this.float32[C+3]=T,l}}hr.prototype.bytesPerElement=16,Ft("StructArrayLayout4f16",hr);class kt extends x{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new v(this.anchorPointX,this.anchorPointY)}}kt.prototype.size=20;class Dt extends ze{get(l){return new kt(this,l)}}Ft("CollisionBoxArray",Dt);class ur extends x{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(l){this._structArray.uint8[this._pos1+37]=l}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(l){this._structArray.uint8[this._pos1+38]=l}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(l){this._structArray.uint32[this._pos4+10]=l}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ur.prototype.size=48;class Jr extends ct{get(l){return new ur(this,l)}}Ft("PlacedSymbolArray",Jr);class yr extends x{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(l){this._structArray.uint32[this._pos4+12]=l}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}yr.prototype.size=64;class Sr extends _t{get(l){return new yr(this,l)}}Ft("SymbolInstanceArray",Sr);class Qr extends It{getoffsetX(l){return this.float32[1*l+0]}}Ft("GlyphOffsetArray",Qr);class ni extends H{getx(l){return this.int16[3*l+0]}gety(l){return this.int16[3*l+1]}gettileUnitDistanceFromAnchor(l){return this.int16[3*l+2]}}Ft("SymbolLineVertexArray",ni);class Ta extends x{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Ta.prototype.size=12;class en extends zt{get(l){return new Ta(this,l)}}Ft("TextAnchorOffsetArray",en);class Mi extends x{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Mi.prototype.size=8;class gi extends Et{get(l){return new Mi(this,l)}}Ft("FeatureIndexArray",gi);class ii extends F{}class vi extends F{}class Ha extends F{}class cl extends J{}class lh extends he{}class hl extends xe{}class la extends be{}class uh extends Ce{}class If extends Ie{}class ua extends Ae{}class ca extends Ee{}class zs extends qe{}class Ca extends Ke{}class Gn extends St{}const ai=R([{name:"a_pos",components:2,type:"Int16"}],4),{members:Xi}=ai;class Cr{constructor(l=[]){this.segments=l}prepareSegment(l,h,m,w){let T=this.segments[this.segments.length-1];return l>Cr.MAX_VERTEX_ARRAY_LENGTH&&te(`Max vertices per segment is ${Cr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${l}`),(!T||T.vertexLength+l>Cr.MAX_VERTEX_ARRAY_LENGTH||T.sortKey!==w)&&(T={vertexOffset:h.length,primitiveOffset:m.length,vertexLength:0,primitiveLength:0},w!==void 0&&(T.sortKey=w),this.segments.push(T)),T}get(){return this.segments}destroy(){for(const l of this.segments)for(const h in l.vaos)l.vaos[h].destroy()}static simpleSegment(l,h,m,w){return new Cr([{vertexOffset:l,primitiveOffset:h,vertexLength:m,primitiveLength:w,vaos:{},sortKey:0}])}}function mo(c,l){return 256*(c=V(Math.floor(c),0,255))+V(Math.floor(l),0,255)}Cr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ft("SegmentVector",Cr);const dl=R([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var fl={exports:{}},Mg={exports:{}};Mg.exports=function(c,l){var h,m,w,T,C,N,L,j;for(m=c.length-(h=3&c.length),w=l,C=3432918353,N=461845907,j=0;j<m;)L=255&c.charCodeAt(j)|(255&c.charCodeAt(++j))<<8|(255&c.charCodeAt(++j))<<16|(255&c.charCodeAt(++j))<<24,++j,w=27492+(65535&(T=5*(65535&(w=(w^=L=(65535&(L=(L=(65535&L)*C+(((L>>>16)*C&65535)<<16)&4294967295)<<15|L>>>17))*N+(((L>>>16)*N&65535)<<16)&4294967295)<<13|w>>>19))+((5*(w>>>16)&65535)<<16)&4294967295))+((58964+(T>>>16)&65535)<<16);switch(L=0,h){case 3:L^=(255&c.charCodeAt(j+2))<<16;case 2:L^=(255&c.charCodeAt(j+1))<<8;case 1:w^=L=(65535&(L=(L=(65535&(L^=255&c.charCodeAt(j)))*C+(((L>>>16)*C&65535)<<16)&4294967295)<<15|L>>>17))*N+(((L>>>16)*N&65535)<<16)&4294967295}return w^=c.length,w=2246822507*(65535&(w^=w>>>16))+((2246822507*(w>>>16)&65535)<<16)&4294967295,w=3266489909*(65535&(w^=w>>>13))+((3266489909*(w>>>16)&65535)<<16)&4294967295,(w^=w>>>16)>>>0};var Lx=Mg.exports,Dg={exports:{}};Dg.exports=function(c,l){for(var h,m=c.length,w=l^m,T=0;m>=4;)h=1540483477*(65535&(h=255&c.charCodeAt(T)|(255&c.charCodeAt(++T))<<8|(255&c.charCodeAt(++T))<<16|(255&c.charCodeAt(++T))<<24))+((1540483477*(h>>>16)&65535)<<16),w=1540483477*(65535&w)+((1540483477*(w>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),m-=4,++T;switch(m){case 3:w^=(255&c.charCodeAt(T+2))<<16;case 2:w^=(255&c.charCodeAt(T+1))<<8;case 1:w=1540483477*(65535&(w^=255&c.charCodeAt(T)))+((1540483477*(w>>>16)&65535)<<16)}return w=1540483477*(65535&(w^=w>>>13))+((1540483477*(w>>>16)&65535)<<16),(w^=w>>>15)>>>0};var Rs=Lx,Ng=Dg.exports;fl.exports=Rs,fl.exports.murmur3=Rs,fl.exports.murmur2=Ng;var ch=d(fl.exports);class zu{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(l,h,m,w){this.ids.push(hh(l)),this.positions.push(h,m,w)}getPositions(l){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const h=hh(l);let m=0,w=this.ids.length-1;for(;m<w;){const C=m+w>>1;this.ids[C]>=h?w=C:m=C+1}const T=[];for(;this.ids[m]===h;)T.push({index:this.positions[3*m],start:this.positions[3*m+1],end:this.positions[3*m+2]}),m++;return T}static serialize(l,h){const m=new Float64Array(l.ids),w=new Uint32Array(l.positions);return dh(m,w,0,m.length-1),h&&h.push(m.buffer,w.buffer),{ids:m,positions:w}}static deserialize(l){const h=new zu;return h.ids=l.ids,h.positions=l.positions,h.indexed=!0,h}}function hh(c){const l=+c;return!isNaN(l)&&l<=Number.MAX_SAFE_INTEGER?l:ch(String(c))}function dh(c,l,h,m){for(;h<m;){const w=c[h+m>>1];let T=h-1,C=m+1;for(;;){do T++;while(c[T]<w);do C--;while(c[C]>w);if(T>=C)break;pl(c,T,C),pl(l,3*T,3*C),pl(l,3*T+1,3*C+1),pl(l,3*T+2,3*C+2)}C-h<m-C?(dh(c,l,h,C),h=C+1):(dh(c,l,C+1,m),m=C)}}function pl(c,l,h){const m=c[l];c[l]=c[h],c[h]=m}Ft("FeaturePositionMap",zu);class Ru{constructor(l,h){this.gl=l.gl,this.location=h}}class zg extends Ru{constructor(l,h){super(l,h),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class hE extends Ru{constructor(l,h){super(l,h),this.current=[0,0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3]))}}class dE extends Ru{constructor(l,h){super(l,h),this.current=Mr.transparent}set(l){l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a))}}const yB=new Float32Array(16);function Bx(c){return[mo(255*c.r,255*c.g),mo(255*c.b,255*c.a)]}class Af{constructor(l,h,m){this.value=l,this.uniformNames=h.map(w=>`u_${w}`),this.type=m}setUniform(l,h,m){l.set(m.constantOr(this.value))}getBinding(l,h,m){return this.type==="color"?new dE(l,h):new zg(l,h)}}class fh{constructor(l,h){this.uniformNames=h.map(m=>`u_${m}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(l,h){this.pixelRatioFrom=h.pixelRatio,this.pixelRatioTo=l.pixelRatio,this.patternFrom=h.tlbr,this.patternTo=l.tlbr}setUniform(l,h,m,w){const T=w==="u_pattern_to"?this.patternTo:w==="u_pattern_from"?this.patternFrom:w==="u_pixel_ratio_to"?this.pixelRatioTo:w==="u_pixel_ratio_from"?this.pixelRatioFrom:null;T&&l.set(T)}getBinding(l,h,m){return m.substr(0,9)==="u_pattern"?new hE(l,h):new zg(l,h)}}class go{constructor(l,h,m,w){this.expression=l,this.type=m,this.maxValue=0,this.paintVertexAttributes=h.map(T=>({name:`a_${T}`,type:"Float32",components:m==="color"?2:1,offset:0})),this.paintVertexArray=new w}populatePaintArray(l,h,m,w,T){const C=this.paintVertexArray.length,N=this.expression.evaluate(new Yr(0),h,{},w,[],T);this.paintVertexArray.resize(l),this._setPaintValue(C,l,N)}updatePaintArray(l,h,m,w){const T=this.expression.evaluate({zoom:0},m,w);this._setPaintValue(l,h,T)}_setPaintValue(l,h,m){if(this.type==="color"){const w=Bx(m);for(let T=l;T<h;T++)this.paintVertexArray.emplace(T,w[0],w[1])}else{for(let w=l;w<h;w++)this.paintVertexArray.emplace(w,m);this.maxValue=Math.max(this.maxValue,Math.abs(m))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ds{constructor(l,h,m,w,T,C){this.expression=l,this.uniformNames=h.map(N=>`u_${N}_t`),this.type=m,this.useIntegerZoom=w,this.zoom=T,this.maxValue=0,this.paintVertexAttributes=h.map(N=>({name:`a_${N}`,type:"Float32",components:m==="color"?4:2,offset:0})),this.paintVertexArray=new C}populatePaintArray(l,h,m,w,T){const C=this.expression.evaluate(new Yr(this.zoom),h,{},w,[],T),N=this.expression.evaluate(new Yr(this.zoom+1),h,{},w,[],T),L=this.paintVertexArray.length;this.paintVertexArray.resize(l),this._setPaintValue(L,l,C,N)}updatePaintArray(l,h,m,w){const T=this.expression.evaluate({zoom:this.zoom},m,w),C=this.expression.evaluate({zoom:this.zoom+1},m,w);this._setPaintValue(l,h,T,C)}_setPaintValue(l,h,m,w){if(this.type==="color"){const T=Bx(m),C=Bx(w);for(let N=l;N<h;N++)this.paintVertexArray.emplace(N,T[0],T[1],C[0],C[1])}else{for(let T=l;T<h;T++)this.paintVertexArray.emplace(T,m,w);this.maxValue=Math.max(this.maxValue,Math.abs(m),Math.abs(w))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(l,h){const m=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,w=V(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);l.set(w)}getBinding(l,h,m){return new zg(l,h)}}class ml{constructor(l,h,m,w,T,C){this.expression=l,this.type=h,this.useIntegerZoom=m,this.zoom=w,this.layerId=C,this.zoomInPaintVertexArray=new T,this.zoomOutPaintVertexArray=new T}populatePaintArray(l,h,m){const w=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(l),this.zoomOutPaintVertexArray.resize(l),this._setPaintValues(w,l,h.patterns&&h.patterns[this.layerId],m)}updatePaintArray(l,h,m,w,T){this._setPaintValues(l,h,m.patterns&&m.patterns[this.layerId],T)}_setPaintValues(l,h,m,w){if(!w||!m)return;const{min:T,mid:C,max:N}=m,L=w[T],j=w[C],q=w[N];if(L&&j&&q)for(let K=l;K<h;K++)this.zoomInPaintVertexArray.emplace(K,j.tl[0],j.tl[1],j.br[0],j.br[1],L.tl[0],L.tl[1],L.br[0],L.br[1],j.pixelRatio,L.pixelRatio),this.zoomOutPaintVertexArray.emplace(K,j.tl[0],j.tl[1],j.br[0],j.br[1],q.tl[0],q.tl[1],q.br[0],q.br[1],j.pixelRatio,q.pixelRatio)}upload(l){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=l.createVertexBuffer(this.zoomInPaintVertexArray,dl.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=l.createVertexBuffer(this.zoomOutPaintVertexArray,dl.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class fE{constructor(l,h,m){this.binders={},this._buffers=[];const w=[];for(const T in l.paint._values){if(!m(T))continue;const C=l.paint.get(T);if(!(C instanceof qa&&Jo(C.property.specification)))continue;const N=xB(T,l.type),L=C.value,j=C.property.specification.type,q=C.property.useIntegerZoom,K=C.property.specification["property-type"],ne=K==="cross-faded"||K==="cross-faded-data-driven";if(L.kind==="constant")this.binders[T]=ne?new fh(L.value,N):new Af(L.value,N,j),w.push(`/u_${T}`);else if(L.kind==="source"||ne){const ue=pE(T,j,"source");this.binders[T]=ne?new ml(L,j,q,h,ue,l.id):new go(L,N,j,ue),w.push(`/a_${T}`)}else{const ue=pE(T,j,"composite");this.binders[T]=new ds(L,N,j,q,h,ue),w.push(`/z_${T}`)}}this.cacheKey=w.sort().join("")}getMaxValue(l){const h=this.binders[l];return h instanceof go||h instanceof ds?h.maxValue:0}populatePaintArrays(l,h,m,w,T){for(const C in this.binders){const N=this.binders[C];(N instanceof go||N instanceof ds||N instanceof ml)&&N.populatePaintArray(l,h,m,w,T)}}setConstantPatternPositions(l,h){for(const m in this.binders){const w=this.binders[m];w instanceof fh&&w.setConstantPatternPositions(l,h)}}updatePaintArrays(l,h,m,w,T){let C=!1;for(const N in l){const L=h.getPositions(N);for(const j of L){const q=m.feature(j.index);for(const K in this.binders){const ne=this.binders[K];if((ne instanceof go||ne instanceof ds||ne instanceof ml)&&ne.expression.isStateDependent===!0){const ue=w.paint.get(K);ne.expression=ue.value,ne.updatePaintArray(j.start,j.end,q,l[N],T),C=!0}}}}return C}defines(){const l=[];for(const h in this.binders){const m=this.binders[h];(m instanceof Af||m instanceof fh)&&l.push(...m.uniformNames.map(w=>`#define HAS_UNIFORM_${w}`))}return l}getBinderAttributes(){const l=[];for(const h in this.binders){const m=this.binders[h];if(m instanceof go||m instanceof ds)for(let w=0;w<m.paintVertexAttributes.length;w++)l.push(m.paintVertexAttributes[w].name);else if(m instanceof ml)for(let w=0;w<dl.members.length;w++)l.push(dl.members[w].name)}return l}getBinderUniforms(){const l=[];for(const h in this.binders){const m=this.binders[h];if(m instanceof Af||m instanceof fh||m instanceof ds)for(const w of m.uniformNames)l.push(w)}return l}getPaintVertexBuffers(){return this._buffers}getUniforms(l,h){const m=[];for(const w in this.binders){const T=this.binders[w];if(T instanceof Af||T instanceof fh||T instanceof ds){for(const C of T.uniformNames)if(h[C]){const N=T.getBinding(l,h[C],C);m.push({name:C,property:w,binding:N})}}}return m}setUniforms(l,h,m,w){for(const{name:T,property:C,binding:N}of h)this.binders[C].setUniform(N,w,m.get(C),T)}updatePaintBuffers(l){this._buffers=[];for(const h in this.binders){const m=this.binders[h];if(l&&m instanceof ml){const w=l.fromScale===2?m.zoomInPaintVertexBuffer:m.zoomOutPaintVertexBuffer;w&&this._buffers.push(w)}else(m instanceof go||m instanceof ds)&&m.paintVertexBuffer&&this._buffers.push(m.paintVertexBuffer)}}upload(l){for(const h in this.binders){const m=this.binders[h];(m instanceof go||m instanceof ds||m instanceof ml)&&m.upload(l)}this.updatePaintBuffers()}destroy(){for(const l in this.binders){const h=this.binders[l];(h instanceof go||h instanceof ds||h instanceof ml)&&h.destroy()}}}class Lu{constructor(l,h,m=()=>!0){this.programConfigurations={};for(const w of l)this.programConfigurations[w.id]=new fE(w,h,m);this.needsUpload=!1,this._featureMap=new zu,this._bufferOffset=0}populatePaintArrays(l,h,m,w,T,C){for(const N in this.programConfigurations)this.programConfigurations[N].populatePaintArrays(l,h,w,T,C);h.id!==void 0&&this._featureMap.add(h.id,m,this._bufferOffset,l),this._bufferOffset=l,this.needsUpload=!0}updatePaintArrays(l,h,m,w){for(const T of m)this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(l,this._featureMap,h,T,w)||this.needsUpload}get(l){return this.programConfigurations[l]}upload(l){if(this.needsUpload){for(const h in this.programConfigurations)this.programConfigurations[h].upload(l);this.needsUpload=!1}}destroy(){for(const l in this.programConfigurations)this.programConfigurations[l].destroy()}}function xB(c,l){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[c]||[c.replace(`${l}-`,"").replace(/-/g,"_")]}function pE(c,l,h){const m={color:{source:xe,composite:hr},number:{source:It,composite:xe}},w=function(T){return{"line-pattern":{source:la,composite:la},"fill-pattern":{source:la,composite:la},"fill-extrusion-pattern":{source:la,composite:la}}[T]}(c);return w&&w[h]||m[l][h]}Ft("ConstantBinder",Af),Ft("CrossFadedConstantBinder",fh),Ft("SourceExpressionBinder",go),Ft("CrossFadedCompositeBinder",ml),Ft("CompositeExpressionBinder",ds),Ft("ProgramConfiguration",fE,{omit:["_buffers"]}),Ft("ProgramConfigurationSet",Lu);const In=8192,Ox=Math.pow(2,14)-1,mE=-Ox-1;function Bu(c){const l=In/c.extent,h=c.loadGeometry();for(let m=0;m<h.length;m++){const w=h[m];for(let T=0;T<w.length;T++){const C=w[T],N=Math.round(C.x*l),L=Math.round(C.y*l);C.x=V(N,mE,Ox),C.y=V(L,mE,Ox),(N<C.x||N>C.x+1||L<C.y||L>C.y+1)&&te("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return h}function Ou(c,l){return{type:c.type,id:c.id,properties:c.properties,geometry:l?Bu(c):[]}}function Rg(c,l,h,m,w){c.emplaceBack(2*l+(m+1)/2,2*h+(w+1)/2)}class Fx{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(h=>h.id),this.index=l.index,this.hasPattern=!1,this.layoutVertexArray=new vi,this.indexArray=new Ca,this.segments=new Cr,this.programConfigurations=new Lu(l.layers,l.zoom),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(l,h,m){const w=this.layers[0],T=[];let C=null,N=!1;w.type==="circle"&&(C=w.layout.get("circle-sort-key"),N=!C.isConstant());for(const{feature:L,id:j,index:q,sourceLayerIndex:K}of l){const ne=this.layers[0]._featureFilter.needGeometry,ue=Ou(L,ne);if(!this.layers[0]._featureFilter.filter(new Yr(this.zoom),ue,m))continue;const ge=N?C.evaluate(ue,{},m):void 0,ye={id:j,properties:L.properties,type:L.type,sourceLayerIndex:K,index:q,geometry:ne?ue.geometry:Bu(L),patterns:{},sortKey:ge};T.push(ye)}N&&T.sort((L,j)=>L.sortKey-j.sortKey);for(const L of T){const{geometry:j,index:q,sourceLayerIndex:K}=L,ne=l[q].feature;this.addFeature(L,j,q,m),h.featureIndex.insert(ne,j,q,K,this.index)}}update(l,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,h,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,Xi),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(l,h,m,w){for(const T of h)for(const C of T){const N=C.x,L=C.y;if(N<0||N>=In||L<0||L>=In)continue;const j=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,l.sortKey),q=j.vertexLength;Rg(this.layoutVertexArray,N,L,-1,-1),Rg(this.layoutVertexArray,N,L,1,-1),Rg(this.layoutVertexArray,N,L,1,1),Rg(this.layoutVertexArray,N,L,-1,1),this.indexArray.emplaceBack(q,q+1,q+2),this.indexArray.emplaceBack(q,q+3,q+2),j.vertexLength+=4,j.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,m,{},w)}}function gE(c,l){for(let h=0;h<c.length;h++)if(ph(l,c[h]))return!0;for(let h=0;h<l.length;h++)if(ph(c,l[h]))return!0;return!!jx(c,l)}function _B(c,l,h){return!!ph(c,l)||!!$x(l,c,h)}function vE(c,l){if(c.length===1)return xE(l,c[0]);for(let h=0;h<l.length;h++){const m=l[h];for(let w=0;w<m.length;w++)if(ph(c,m[w]))return!0}for(let h=0;h<c.length;h++)if(xE(l,c[h]))return!0;for(let h=0;h<l.length;h++)if(jx(c,l[h]))return!0;return!1}function wB(c,l,h){if(c.length>1){if(jx(c,l))return!0;for(let m=0;m<l.length;m++)if($x(l[m],c,h))return!0}for(let m=0;m<c.length;m++)if($x(c[m],l,h))return!0;return!1}function jx(c,l){if(c.length===0||l.length===0)return!1;for(let h=0;h<c.length-1;h++){const m=c[h],w=c[h+1];for(let T=0;T<l.length-1;T++)if(bB(m,w,l[T],l[T+1]))return!0}return!1}function bB(c,l,h,m){return W(c,h,m)!==W(l,h,m)&&W(c,l,h)!==W(c,l,m)}function $x(c,l,h){const m=h*h;if(l.length===1)return c.distSqr(l[0])<m;for(let w=1;w<l.length;w++)if(yE(c,l[w-1],l[w])<m)return!0;return!1}function yE(c,l,h){const m=l.distSqr(h);if(m===0)return c.distSqr(l);const w=((c.x-l.x)*(h.x-l.x)+(c.y-l.y)*(h.y-l.y))/m;return c.distSqr(w<0?l:w>1?h:h.sub(l)._mult(w)._add(l))}function xE(c,l){let h,m,w,T=!1;for(let C=0;C<c.length;C++){h=c[C];for(let N=0,L=h.length-1;N<h.length;L=N++)m=h[N],w=h[L],m.y>l.y!=w.y>l.y&&l.x<(w.x-m.x)*(l.y-m.y)/(w.y-m.y)+m.x&&(T=!T)}return T}function ph(c,l){let h=!1;for(let m=0,w=c.length-1;m<c.length;w=m++){const T=c[m],C=c[w];T.y>l.y!=C.y>l.y&&l.x<(C.x-T.x)*(l.y-T.y)/(C.y-T.y)+T.x&&(h=!h)}return h}function SB(c,l,h){const m=h[0],w=h[2];if(c.x<m.x&&l.x<m.x||c.x>w.x&&l.x>w.x||c.y<m.y&&l.y<m.y||c.y>w.y&&l.y>w.y)return!1;const T=W(c,l,h[0]);return T!==W(c,l,h[1])||T!==W(c,l,h[2])||T!==W(c,l,h[3])}function Mf(c,l,h){const m=l.paint.get(c).value;return m.kind==="constant"?m.value:h.programConfigurations.get(l.id).getMaxValue(c)}function Lg(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function Bg(c,l,h,m,w){if(!l[0]&&!l[1])return c;const T=v.convert(l)._mult(w);h==="viewport"&&T._rotate(-m);const C=[];for(let N=0;N<c.length;N++)C.push(c[N].sub(T));return C}let _E,wE;Ft("CircleBucket",Fx,{omit:["layers"]});var EB={get paint(){return wE=wE||new E({"circle-radius":new ir($e.paint_circle["circle-radius"]),"circle-color":new ir($e.paint_circle["circle-color"]),"circle-blur":new ir($e.paint_circle["circle-blur"]),"circle-opacity":new ir($e.paint_circle["circle-opacity"]),"circle-translate":new Gt($e.paint_circle["circle-translate"]),"circle-translate-anchor":new Gt($e.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Gt($e.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Gt($e.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ir($e.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ir($e.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ir($e.paint_circle["circle-stroke-opacity"])})},get layout(){return _E=_E||new E({"circle-sort-key":new ir($e.layout_circle["circle-sort-key"])})}},Di=1e-6,mh=typeof Float32Array<"u"?Float32Array:Array;function Vx(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function bE(c,l,h){var m=l[0],w=l[1],T=l[2],C=l[3],N=l[4],L=l[5],j=l[6],q=l[7],K=l[8],ne=l[9],ue=l[10],ge=l[11],ye=l[12],Te=l[13],Pe=l[14],We=l[15],Re=h[0],He=h[1],nt=h[2],vt=h[3];return c[0]=Re*m+He*N+nt*K+vt*ye,c[1]=Re*w+He*L+nt*ne+vt*Te,c[2]=Re*T+He*j+nt*ue+vt*Pe,c[3]=Re*C+He*q+nt*ge+vt*We,c[4]=(Re=h[4])*m+(He=h[5])*N+(nt=h[6])*K+(vt=h[7])*ye,c[5]=Re*w+He*L+nt*ne+vt*Te,c[6]=Re*T+He*j+nt*ue+vt*Pe,c[7]=Re*C+He*q+nt*ge+vt*We,c[8]=(Re=h[8])*m+(He=h[9])*N+(nt=h[10])*K+(vt=h[11])*ye,c[9]=Re*w+He*L+nt*ne+vt*Te,c[10]=Re*T+He*j+nt*ue+vt*Pe,c[11]=Re*C+He*q+nt*ge+vt*We,c[12]=(Re=h[12])*m+(He=h[13])*N+(nt=h[14])*K+(vt=h[15])*ye,c[13]=Re*w+He*L+nt*ne+vt*Te,c[14]=Re*T+He*j+nt*ue+vt*Pe,c[15]=Re*C+He*q+nt*ge+vt*We,c}Math.hypot||(Math.hypot=function(){for(var c=0,l=arguments.length;l--;)c+=arguments[l]*arguments[l];return Math.sqrt(c)});var Df,TB=bE;function Og(c,l,h){var m=l[0],w=l[1],T=l[2],C=l[3];return c[0]=h[0]*m+h[4]*w+h[8]*T+h[12]*C,c[1]=h[1]*m+h[5]*w+h[9]*T+h[13]*C,c[2]=h[2]*m+h[6]*w+h[10]*T+h[14]*C,c[3]=h[3]*m+h[7]*w+h[11]*T+h[15]*C,c}Df=new mh(4),mh!=Float32Array&&(Df[0]=0,Df[1]=0,Df[2]=0,Df[3]=0);class CB extends f{constructor(l){super(l,EB)}createBucket(l){return new Fx(l)}queryRadius(l){const h=l;return Mf("circle-radius",this,h)+Mf("circle-stroke-width",this,h)+Lg(this.paint.get("circle-translate"))}queryIntersectsFeature(l,h,m,w,T,C,N,L){const j=Bg(l,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),C.angle,N),q=this.paint.get("circle-radius").evaluate(h,m)+this.paint.get("circle-stroke-width").evaluate(h,m),K=this.paint.get("circle-pitch-alignment")==="map",ne=K?j:function(ge,ye){return ge.map(Te=>SE(Te,ye))}(j,L),ue=K?q*N:q;for(const ge of w)for(const ye of ge){const Te=K?ye:SE(ye,L);let Pe=ue;const We=Og([],[ye.x,ye.y,0,1],L);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Pe*=We[3]/C.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Pe*=C.cameraToCenterDistance/We[3]),_B(ne,Te,Pe))return!0}return!1}}function SE(c,l){const h=Og([],[c.x,c.y,0,1],l);return new v(h[0]/h[3],h[1]/h[3])}class EE extends Fx{}let TE;Ft("HeatmapBucket",EE,{omit:["layers"]});var kB={get paint(){return TE=TE||new E({"heatmap-radius":new ir($e.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ir($e.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Gt($e.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Pf($e.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Gt($e.paint_heatmap["heatmap-opacity"])})}};function Ux(c,{width:l,height:h},m,w){if(w){if(w instanceof Uint8ClampedArray)w=new Uint8Array(w.buffer);else if(w.length!==l*h*m)throw new RangeError(`mismatched image size. expected: ${w.length} but got: ${l*h*m}`)}else w=new Uint8Array(l*h*m);return c.width=l,c.height=h,c.data=w,c}function CE(c,{width:l,height:h},m){if(l===c.width&&h===c.height)return;const w=Ux({},{width:l,height:h},m);qx(c,w,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,l),height:Math.min(c.height,h)},m),c.width=l,c.height=h,c.data=w.data}function qx(c,l,h,m,w,T){if(w.width===0||w.height===0)return l;if(w.width>c.width||w.height>c.height||h.x>c.width-w.width||h.y>c.height-w.height)throw new RangeError("out of range source coordinates for image copy");if(w.width>l.width||w.height>l.height||m.x>l.width-w.width||m.y>l.height-w.height)throw new RangeError("out of range destination coordinates for image copy");const C=c.data,N=l.data;if(C===N)throw new Error("srcData equals dstData, so image is already copied");for(let L=0;L<w.height;L++){const j=((h.y+L)*c.width+h.x)*T,q=((m.y+L)*l.width+m.x)*T;for(let K=0;K<w.width*T;K++)N[q+K]=C[j+K]}return l}class Nf{constructor(l,h){Ux(this,l,1,h)}resize(l){CE(this,l,1)}clone(){return new Nf({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,h,m,w,T){qx(l,h,m,w,T,1)}}class ka{constructor(l,h){Ux(this,l,4,h)}resize(l){CE(this,l,4)}replace(l,h){h?this.data.set(l):this.data=l instanceof Uint8ClampedArray?new Uint8Array(l.buffer):l}clone(){return new ka({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,h,m,w,T){qx(l,h,m,w,T,4)}}function kE(c){const l={},h=c.resolution||256,m=c.clips?c.clips.length:1,w=c.image||new ka({width:h,height:m});if(Math.log(h)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${h}`);const T=(C,N,L)=>{l[c.evaluationKey]=L;const j=c.expression.evaluate(l);w.data[C+N+0]=Math.floor(255*j.r/j.a),w.data[C+N+1]=Math.floor(255*j.g/j.a),w.data[C+N+2]=Math.floor(255*j.b/j.a),w.data[C+N+3]=Math.floor(255*j.a)};if(c.clips)for(let C=0,N=0;C<m;++C,N+=4*h)for(let L=0,j=0;L<h;L++,j+=4){const q=L/(h-1),{start:K,end:ne}=c.clips[C];T(N,j,K*(1-q)+ne*q)}else for(let C=0,N=0;C<h;C++,N+=4)T(0,N,C/(h-1));return w}Ft("AlphaImage",Nf),Ft("RGBAImage",ka);const Hx="big-fb";class PB extends f{createBucket(l){return new EE(l)}constructor(l){super(l,kB),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=kE({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Hx)&&this.heatmapFbos.delete(Hx)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let PE;var IB={get paint(){return PE=PE||new E({"hillshade-illumination-direction":new Gt($e.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Gt($e.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Gt($e.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Gt($e.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Gt($e.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Gt($e.paint_hillshade["hillshade-accent-color"])})}};class AB extends f{constructor(l){super(l,IB)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const MB=R([{name:"a_pos",components:2,type:"Int16"}],4),{members:DB}=MB;function IE(c,l,h=2){const m=l&&l.length,w=m?l[0]*h:c.length;let T=AE(c,0,w,h,!0);const C=[];if(!T||T.next===T.prev)return C;let N,L,j;if(m&&(T=function(q,K,ne,ue){const ge=[];for(let ye=0,Te=K.length;ye<Te;ye++){const Pe=AE(q,K[ye]*ue,ye<Te-1?K[ye+1]*ue:q.length,ue,!1);Pe===Pe.next&&(Pe.steiner=!0),ge.push(jB(Pe))}ge.sort(BB);for(let ye=0;ye<ge.length;ye++)ne=OB(ge[ye],ne);return ne}(c,l,T,h)),c.length>80*h){N=1/0,L=1/0;let q=-1/0,K=-1/0;for(let ne=h;ne<w;ne+=h){const ue=c[ne],ge=c[ne+1];ue<N&&(N=ue),ge<L&&(L=ge),ue>q&&(q=ue),ge>K&&(K=ge)}j=Math.max(q-N,K-L),j=j!==0?32767/j:0}return zf(T,C,h,N,L,j,0),C}function AE(c,l,h,m,w){let T;if(w===function(C,N,L,j){let q=0;for(let K=N,ne=L-j;K<L;K+=j)q+=(C[ne]-C[K])*(C[K+1]+C[ne+1]),ne=K;return q}(c,l,h,m)>0)for(let C=l;C<h;C+=m)T=NE(C/m|0,c[C],c[C+1],T);else for(let C=h-m;C>=l;C-=m)T=NE(C/m|0,c[C],c[C+1],T);return T&&Fg(T,T.next)&&(Lf(T),T=T.next),T}function Fu(c,l){if(!c)return c;l||(l=c);let h,m=c;do if(h=!1,m.steiner||!Fg(m,m.next)&&Sn(m.prev,m,m.next)!==0)m=m.next;else{if(Lf(m),m=l=m.prev,m===m.next)break;h=!0}while(h||m!==l);return l}function zf(c,l,h,m,w,T,C){if(!c)return;!C&&T&&function(L,j,q,K){let ne=L;do ne.z===0&&(ne.z=Gx(ne.x,ne.y,j,q,K)),ne.prevZ=ne.prev,ne.nextZ=ne.next,ne=ne.next;while(ne!==L);ne.prevZ.nextZ=null,ne.prevZ=null,function(ue){let ge,ye=1;do{let Te,Pe=ue;ue=null;let We=null;for(ge=0;Pe;){ge++;let Re=Pe,He=0;for(let vt=0;vt<ye&&(He++,Re=Re.nextZ,Re);vt++);let nt=ye;for(;He>0||nt>0&&Re;)He!==0&&(nt===0||!Re||Pe.z<=Re.z)?(Te=Pe,Pe=Pe.nextZ,He--):(Te=Re,Re=Re.nextZ,nt--),We?We.nextZ=Te:ue=Te,Te.prevZ=We,We=Te;Pe=Re}We.nextZ=null,ye*=2}while(ge>1)}(ne)}(c,m,w,T);let N=c;for(;c.prev!==c.next;){const L=c.prev,j=c.next;if(T?zB(c,m,w,T):NB(c))l.push(L.i,c.i,j.i),Lf(c),c=j.next,N=j.next;else if((c=j)===N){C?C===1?zf(c=RB(Fu(c),l),l,h,m,w,T,2):C===2&&LB(c,l,h,m,w,T):zf(Fu(c),l,h,m,w,T,1);break}}}function NB(c){const l=c.prev,h=c,m=c.next;if(Sn(l,h,m)>=0)return!1;const w=l.x,T=h.x,C=m.x,N=l.y,L=h.y,j=m.y,q=w<T?w<C?w:C:T<C?T:C,K=N<L?N<j?N:j:L<j?L:j,ne=w>T?w>C?w:C:T>C?T:C,ue=N>L?N>j?N:j:L>j?L:j;let ge=m.next;for(;ge!==l;){if(ge.x>=q&&ge.x<=ne&&ge.y>=K&&ge.y<=ue&&gh(w,N,T,L,C,j,ge.x,ge.y)&&Sn(ge.prev,ge,ge.next)>=0)return!1;ge=ge.next}return!0}function zB(c,l,h,m){const w=c.prev,T=c,C=c.next;if(Sn(w,T,C)>=0)return!1;const N=w.x,L=T.x,j=C.x,q=w.y,K=T.y,ne=C.y,ue=N<L?N<j?N:j:L<j?L:j,ge=q<K?q<ne?q:ne:K<ne?K:ne,ye=N>L?N>j?N:j:L>j?L:j,Te=q>K?q>ne?q:ne:K>ne?K:ne,Pe=Gx(ue,ge,l,h,m),We=Gx(ye,Te,l,h,m);let Re=c.prevZ,He=c.nextZ;for(;Re&&Re.z>=Pe&&He&&He.z<=We;){if(Re.x>=ue&&Re.x<=ye&&Re.y>=ge&&Re.y<=Te&&Re!==w&&Re!==C&&gh(N,q,L,K,j,ne,Re.x,Re.y)&&Sn(Re.prev,Re,Re.next)>=0||(Re=Re.prevZ,He.x>=ue&&He.x<=ye&&He.y>=ge&&He.y<=Te&&He!==w&&He!==C&&gh(N,q,L,K,j,ne,He.x,He.y)&&Sn(He.prev,He,He.next)>=0))return!1;He=He.nextZ}for(;Re&&Re.z>=Pe;){if(Re.x>=ue&&Re.x<=ye&&Re.y>=ge&&Re.y<=Te&&Re!==w&&Re!==C&&gh(N,q,L,K,j,ne,Re.x,Re.y)&&Sn(Re.prev,Re,Re.next)>=0)return!1;Re=Re.prevZ}for(;He&&He.z<=We;){if(He.x>=ue&&He.x<=ye&&He.y>=ge&&He.y<=Te&&He!==w&&He!==C&&gh(N,q,L,K,j,ne,He.x,He.y)&&Sn(He.prev,He,He.next)>=0)return!1;He=He.nextZ}return!0}function RB(c,l){let h=c;do{const m=h.prev,w=h.next.next;!Fg(m,w)&&ME(m,h,h.next,w)&&Rf(m,w)&&Rf(w,m)&&(l.push(m.i,h.i,w.i),Lf(h),Lf(h.next),h=c=w),h=h.next}while(h!==c);return Fu(h)}function LB(c,l,h,m,w,T){let C=c;do{let N=C.next.next;for(;N!==C.prev;){if(C.i!==N.i&&$B(C,N)){let L=DE(C,N);return C=Fu(C,C.next),L=Fu(L,L.next),zf(C,l,h,m,w,T,0),void zf(L,l,h,m,w,T,0)}N=N.next}C=C.next}while(C!==c)}function BB(c,l){return c.x-l.x}function OB(c,l){const h=function(w,T){let C=T;const N=w.x,L=w.y;let j,q=-1/0;do{if(L<=C.y&&L>=C.next.y&&C.next.y!==C.y){const ye=C.x+(L-C.y)*(C.next.x-C.x)/(C.next.y-C.y);if(ye<=N&&ye>q&&(q=ye,j=C.x<C.next.x?C:C.next,ye===N))return j}C=C.next}while(C!==T);if(!j)return null;const K=j,ne=j.x,ue=j.y;let ge=1/0;C=j;do{if(N>=C.x&&C.x>=ne&&N!==C.x&&gh(L<ue?N:q,L,ne,ue,L<ue?q:N,L,C.x,C.y)){const ye=Math.abs(L-C.y)/(N-C.x);Rf(C,w)&&(ye<ge||ye===ge&&(C.x>j.x||C.x===j.x&&FB(j,C)))&&(j=C,ge=ye)}C=C.next}while(C!==K);return j}(c,l);if(!h)return l;const m=DE(h,c);return Fu(m,m.next),Fu(h,h.next)}function FB(c,l){return Sn(c.prev,c,l.prev)<0&&Sn(l.next,c,c.next)<0}function Gx(c,l,h,m,w){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-h)*w|0)|c<<8))|c<<4))|c<<2))|c<<1))|(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-m)*w|0)|l<<8))|l<<4))|l<<2))|l<<1))<<1}function jB(c){let l=c,h=c;do(l.x<h.x||l.x===h.x&&l.y<h.y)&&(h=l),l=l.next;while(l!==c);return h}function gh(c,l,h,m,w,T,C,N){return(w-C)*(l-N)>=(c-C)*(T-N)&&(c-C)*(m-N)>=(h-C)*(l-N)&&(h-C)*(T-N)>=(w-C)*(m-N)}function $B(c,l){return c.next.i!==l.i&&c.prev.i!==l.i&&!function(h,m){let w=h;do{if(w.i!==h.i&&w.next.i!==h.i&&w.i!==m.i&&w.next.i!==m.i&&ME(w,w.next,h,m))return!0;w=w.next}while(w!==h);return!1}(c,l)&&(Rf(c,l)&&Rf(l,c)&&function(h,m){let w=h,T=!1;const C=(h.x+m.x)/2,N=(h.y+m.y)/2;do w.y>N!=w.next.y>N&&w.next.y!==w.y&&C<(w.next.x-w.x)*(N-w.y)/(w.next.y-w.y)+w.x&&(T=!T),w=w.next;while(w!==h);return T}(c,l)&&(Sn(c.prev,c,l.prev)||Sn(c,l.prev,l))||Fg(c,l)&&Sn(c.prev,c,c.next)>0&&Sn(l.prev,l,l.next)>0)}function Sn(c,l,h){return(l.y-c.y)*(h.x-l.x)-(l.x-c.x)*(h.y-l.y)}function Fg(c,l){return c.x===l.x&&c.y===l.y}function ME(c,l,h,m){const w=$g(Sn(c,l,h)),T=$g(Sn(c,l,m)),C=$g(Sn(h,m,c)),N=$g(Sn(h,m,l));return w!==T&&C!==N||!(w!==0||!jg(c,h,l))||!(T!==0||!jg(c,m,l))||!(C!==0||!jg(h,c,m))||!(N!==0||!jg(h,l,m))}function jg(c,l,h){return l.x<=Math.max(c.x,h.x)&&l.x>=Math.min(c.x,h.x)&&l.y<=Math.max(c.y,h.y)&&l.y>=Math.min(c.y,h.y)}function $g(c){return c>0?1:c<0?-1:0}function Rf(c,l){return Sn(c.prev,c,c.next)<0?Sn(c,l,c.next)>=0&&Sn(c,c.prev,l)>=0:Sn(c,l,c.prev)<0||Sn(c,c.next,l)<0}function DE(c,l){const h=Wx(c.i,c.x,c.y),m=Wx(l.i,l.x,l.y),w=c.next,T=l.prev;return c.next=l,l.prev=c,h.next=w,w.prev=h,m.next=h,h.prev=m,T.next=m,m.prev=T,m}function NE(c,l,h,m){const w=Wx(c,l,h);return m?(w.next=m.next,w.prev=m,m.next.prev=w,m.next=w):(w.prev=w,w.next=w),w}function Lf(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function Wx(c,l,h){return{i:c,x:l,y:h,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Zx(c,l,h){const m=h.patternDependencies;let w=!1;for(const T of l){const C=T.paint.get(`${c}-pattern`);C.isConstant()||(w=!0);const N=C.constantOr(null);N&&(w=!0,m[N.to]=!0,m[N.from]=!0)}return w}function Xx(c,l,h,m,w){const T=w.patternDependencies;for(const C of l){const N=C.paint.get(`${c}-pattern`).value;if(N.kind!=="constant"){let L=N.evaluate({zoom:m-1},h,{},w.availableImages),j=N.evaluate({zoom:m},h,{},w.availableImages),q=N.evaluate({zoom:m+1},h,{},w.availableImages);L=L&&L.name?L.name:L,j=j&&j.name?j.name:j,q=q&&q.name?q.name:q,T[L]=!0,T[j]=!0,T[q]=!0,h.patterns[C.id]={min:L,mid:j,max:q}}}return h}class Kx{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(h=>h.id),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ha,this.indexArray=new Ca,this.indexArray2=new Gn,this.programConfigurations=new Lu(l.layers,l.zoom),this.segments=new Cr,this.segments2=new Cr,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(l,h,m){this.hasPattern=Zx("fill",this.layers,h);const w=this.layers[0].layout.get("fill-sort-key"),T=!w.isConstant(),C=[];for(const{feature:N,id:L,index:j,sourceLayerIndex:q}of l){const K=this.layers[0]._featureFilter.needGeometry,ne=Ou(N,K);if(!this.layers[0]._featureFilter.filter(new Yr(this.zoom),ne,m))continue;const ue=T?w.evaluate(ne,{},m,h.availableImages):void 0,ge={id:L,properties:N.properties,type:N.type,sourceLayerIndex:q,index:j,geometry:K?ne.geometry:Bu(N),patterns:{},sortKey:ue};C.push(ge)}T&&C.sort((N,L)=>N.sortKey-L.sortKey);for(const N of C){const{geometry:L,index:j,sourceLayerIndex:q}=N;if(this.hasPattern){const K=Xx("fill",this.layers,N,this.zoom,h);this.patternFeatures.push(K)}else this.addFeature(N,L,j,m,{});h.featureIndex.insert(l[j].feature,L,j,q,this.index)}}update(l,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,h,this.stateDependentLayers,m)}addFeatures(l,h,m){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,h,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,DB),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.indexBuffer2=l.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(l,h,m,w,T){for(const C of jc(h,500)){let N=0;for(const ue of C)N+=ue.length;const L=this.segments.prepareSegment(N,this.layoutVertexArray,this.indexArray),j=L.vertexLength,q=[],K=[];for(const ue of C){if(ue.length===0)continue;ue!==C[0]&&K.push(q.length/2);const ge=this.segments2.prepareSegment(ue.length,this.layoutVertexArray,this.indexArray2),ye=ge.vertexLength;this.layoutVertexArray.emplaceBack(ue[0].x,ue[0].y),this.indexArray2.emplaceBack(ye+ue.length-1,ye),q.push(ue[0].x),q.push(ue[0].y);for(let Te=1;Te<ue.length;Te++)this.layoutVertexArray.emplaceBack(ue[Te].x,ue[Te].y),this.indexArray2.emplaceBack(ye+Te-1,ye+Te),q.push(ue[Te].x),q.push(ue[Te].y);ge.vertexLength+=ue.length,ge.primitiveLength+=ue.length}const ne=IE(q,K);for(let ue=0;ue<ne.length;ue+=3)this.indexArray.emplaceBack(j+ne[ue],j+ne[ue+1],j+ne[ue+2]);L.vertexLength+=N,L.primitiveLength+=ne.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,m,T,w)}}let zE,RE;Ft("FillBucket",Kx,{omit:["layers","patternFeatures"]});var VB={get paint(){return RE=RE||new E({"fill-antialias":new Gt($e.paint_fill["fill-antialias"]),"fill-opacity":new ir($e.paint_fill["fill-opacity"]),"fill-color":new ir($e.paint_fill["fill-color"]),"fill-outline-color":new ir($e.paint_fill["fill-outline-color"]),"fill-translate":new Gt($e.paint_fill["fill-translate"]),"fill-translate-anchor":new Gt($e.paint_fill["fill-translate-anchor"]),"fill-pattern":new sh($e.paint_fill["fill-pattern"])})},get layout(){return zE=zE||new E({"fill-sort-key":new ir($e.layout_fill["fill-sort-key"])})}};class UB extends f{constructor(l){super(l,VB)}recalculate(l,h){super.recalculate(l,h);const m=this.paint._values["fill-outline-color"];m.value.kind==="constant"&&m.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new Kx(l)}queryRadius(){return Lg(this.paint.get("fill-translate"))}queryIntersectsFeature(l,h,m,w,T,C,N){return vE(Bg(l,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),C.angle,N),w)}isTileClipped(){return!0}}const qB=R([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),HB=R([{name:"a_centroid",components:2,type:"Int16"}],4),{members:GB}=qB;var gl={},WB=p,LE=vh;function vh(c,l,h,m,w){this.properties={},this.extent=h,this.type=0,this._pbf=c,this._geometry=-1,this._keys=m,this._values=w,c.readFields(ZB,this,l)}function ZB(c,l,h){c==1?l.id=h.readVarint():c==2?function(m,w){for(var T=m.readVarint()+m.pos;m.pos<T;){var C=w._keys[m.readVarint()],N=w._values[m.readVarint()];w.properties[C]=N}}(h,l):c==3?l.type=h.readVarint():c==4&&(l._geometry=h.pos)}function XB(c){for(var l,h,m=0,w=0,T=c.length,C=T-1;w<T;C=w++)m+=((h=c[C]).x-(l=c[w]).x)*(l.y+h.y);return m}vh.types=["Unknown","Point","LineString","Polygon"],vh.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var l,h=c.readVarint()+c.pos,m=1,w=0,T=0,C=0,N=[];c.pos<h;){if(w<=0){var L=c.readVarint();m=7&L,w=L>>3}if(w--,m===1||m===2)T+=c.readSVarint(),C+=c.readSVarint(),m===1&&(l&&N.push(l),l=[]),l.push(new WB(T,C));else{if(m!==7)throw new Error("unknown command "+m);l&&l.push(l[0].clone())}}return l&&N.push(l),N},vh.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var l=c.readVarint()+c.pos,h=1,m=0,w=0,T=0,C=1/0,N=-1/0,L=1/0,j=-1/0;c.pos<l;){if(m<=0){var q=c.readVarint();h=7&q,m=q>>3}if(m--,h===1||h===2)(w+=c.readSVarint())<C&&(C=w),w>N&&(N=w),(T+=c.readSVarint())<L&&(L=T),T>j&&(j=T);else if(h!==7)throw new Error("unknown command "+h)}return[C,L,N,j]},vh.prototype.toGeoJSON=function(c,l,h){var m,w,T=this.extent*Math.pow(2,h),C=this.extent*c,N=this.extent*l,L=this.loadGeometry(),j=vh.types[this.type];function q(ue){for(var ge=0;ge<ue.length;ge++){var ye=ue[ge];ue[ge]=[360*(ye.x+C)/T-180,360/Math.PI*Math.atan(Math.exp((180-360*(ye.y+N)/T)*Math.PI/180))-90]}}switch(this.type){case 1:var K=[];for(m=0;m<L.length;m++)K[m]=L[m][0];q(L=K);break;case 2:for(m=0;m<L.length;m++)q(L[m]);break;case 3:for(L=function(ue){var ge=ue.length;if(ge<=1)return[ue];for(var ye,Te,Pe=[],We=0;We<ge;We++){var Re=XB(ue[We]);Re!==0&&(Te===void 0&&(Te=Re<0),Te===Re<0?(ye&&Pe.push(ye),ye=[ue[We]]):ye.push(ue[We]))}return ye&&Pe.push(ye),Pe}(L),m=0;m<L.length;m++)for(w=0;w<L[m].length;w++)q(L[m][w])}L.length===1?L=L[0]:j="Multi"+j;var ne={type:"Feature",geometry:{type:j,coordinates:L},properties:this.properties};return"id"in this&&(ne.id=this.id),ne};var KB=LE,BE=OE;function OE(c,l){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(YB,this,l),this.length=this._features.length}function YB(c,l,h){c===15?l.version=h.readVarint():c===1?l.name=h.readString():c===5?l.extent=h.readVarint():c===2?l._features.push(h.pos):c===3?l._keys.push(h.readString()):c===4&&l._values.push(function(m){for(var w=null,T=m.readVarint()+m.pos;m.pos<T;){var C=m.readVarint()>>3;w=C===1?m.readString():C===2?m.readFloat():C===3?m.readDouble():C===4?m.readVarint64():C===5?m.readVarint():C===6?m.readSVarint():C===7?m.readBoolean():null}return w}(h))}OE.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var l=this._pbf.readVarint()+this._pbf.pos;return new KB(this._pbf,l,this.extent,this._keys,this._values)};var JB=BE;function QB(c,l,h){if(c===3){var m=new JB(h,h.readVarint()+h.pos);m.length&&(l[m.name]=m)}}gl.VectorTile=function(c,l){this.layers=c.readFields(QB,{},l)},gl.VectorTileFeature=LE,gl.VectorTileLayer=BE;const e3=gl.VectorTileFeature.types,Yx=Math.pow(2,13);function Bf(c,l,h,m,w,T,C,N){c.emplaceBack(l,h,2*Math.floor(m*Yx)+C,w*Yx*2,T*Yx*2,Math.round(N))}class Jx{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(h=>h.id),this.index=l.index,this.hasPattern=!1,this.layoutVertexArray=new cl,this.centroidVertexArray=new ii,this.indexArray=new Ca,this.programConfigurations=new Lu(l.layers,l.zoom),this.segments=new Cr,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(l,h,m){this.features=[],this.hasPattern=Zx("fill-extrusion",this.layers,h);for(const{feature:w,id:T,index:C,sourceLayerIndex:N}of l){const L=this.layers[0]._featureFilter.needGeometry,j=Ou(w,L);if(!this.layers[0]._featureFilter.filter(new Yr(this.zoom),j,m))continue;const q={id:T,sourceLayerIndex:N,index:C,geometry:L?j.geometry:Bu(w),properties:w.properties,type:w.type,patterns:{}};this.hasPattern?this.features.push(Xx("fill-extrusion",this.layers,q,this.zoom,h)):this.addFeature(q,q.geometry,C,m,{}),h.featureIndex.insert(w,q.geometry,C,N,this.index,!0)}}addFeatures(l,h,m){for(const w of this.features){const{geometry:T}=w;this.addFeature(w,T,w.index,h,m)}}update(l,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,h,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,GB),this.centroidVertexBuffer=l.createVertexBuffer(this.centroidVertexArray,HB.members,!0),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(l,h,m,w,T){for(const C of jc(h,500)){const N={x:0,y:0,vertexCount:0};let L=0;for(const ge of C)L+=ge.length;let j=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const ge of C){if(ge.length===0||r3(ge))continue;let ye=0;for(let Te=0;Te<ge.length;Te++){const Pe=ge[Te];if(Te>=1){const We=ge[Te-1];if(!t3(Pe,We)){j.vertexLength+4>Cr.MAX_VERTEX_ARRAY_LENGTH&&(j=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Re=Pe.sub(We)._perp()._unit(),He=We.dist(Pe);ye+He>32768&&(ye=0),Bf(this.layoutVertexArray,Pe.x,Pe.y,Re.x,Re.y,0,0,ye),Bf(this.layoutVertexArray,Pe.x,Pe.y,Re.x,Re.y,0,1,ye),N.x+=2*Pe.x,N.y+=2*Pe.y,N.vertexCount+=2,ye+=He,Bf(this.layoutVertexArray,We.x,We.y,Re.x,Re.y,0,0,ye),Bf(this.layoutVertexArray,We.x,We.y,Re.x,Re.y,0,1,ye),N.x+=2*We.x,N.y+=2*We.y,N.vertexCount+=2;const nt=j.vertexLength;this.indexArray.emplaceBack(nt,nt+2,nt+1),this.indexArray.emplaceBack(nt+1,nt+2,nt+3),j.vertexLength+=4,j.primitiveLength+=2}}}}if(j.vertexLength+L>Cr.MAX_VERTEX_ARRAY_LENGTH&&(j=this.segments.prepareSegment(L,this.layoutVertexArray,this.indexArray)),e3[l.type]!=="Polygon")continue;const q=[],K=[],ne=j.vertexLength;for(const ge of C)if(ge.length!==0){ge!==C[0]&&K.push(q.length/2);for(let ye=0;ye<ge.length;ye++){const Te=ge[ye];Bf(this.layoutVertexArray,Te.x,Te.y,0,0,1,1,0),N.x+=Te.x,N.y+=Te.y,N.vertexCount+=1,q.push(Te.x),q.push(Te.y)}}const ue=IE(q,K);for(let ge=0;ge<ue.length;ge+=3)this.indexArray.emplaceBack(ne+ue[ge],ne+ue[ge+2],ne+ue[ge+1]);j.primitiveLength+=ue.length/3,j.vertexLength+=L;for(let ge=0;ge<N.vertexCount;ge++){const ye=Math.floor(N.x/N.vertexCount),Te=Math.floor(N.y/N.vertexCount);this.centroidVertexArray.emplaceBack(ye,Te)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,m,T,w)}}function t3(c,l){return c.x===l.x&&(c.x<0||c.x>In)||c.y===l.y&&(c.y<0||c.y>In)}function r3(c){return c.every(l=>l.x<0)||c.every(l=>l.x>In)||c.every(l=>l.y<0)||c.every(l=>l.y>In)}let FE;Ft("FillExtrusionBucket",Jx,{omit:["layers","features"]});var n3={get paint(){return FE=FE||new E({"fill-extrusion-opacity":new Gt($e["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ir($e["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Gt($e["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Gt($e["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new sh($e["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ir($e["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ir($e["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Gt($e["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class i3 extends f{constructor(l){super(l,n3)}createBucket(l){return new Jx(l)}queryRadius(){return Lg(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(l,h,m,w,T,C,N,L){const j=Bg(l,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),C.angle,N),q=this.paint.get("fill-extrusion-height").evaluate(h,m),K=this.paint.get("fill-extrusion-base").evaluate(h,m),ne=function(ge,ye,Te,Pe){const We=[];for(const Re of ge){const He=[Re.x,Re.y,0,1];Og(He,He,ye),We.push(new v(He[0]/He[3],He[1]/He[3]))}return We}(j,L),ue=function(ge,ye,Te,Pe){const We=[],Re=[],He=Pe[8]*ye,nt=Pe[9]*ye,vt=Pe[10]*ye,Nt=Pe[11]*ye,nr=Pe[8]*Te,Mt=Pe[9]*Te,Pt=Pe[10]*Te,Xt=Pe[11]*Te;for(const jt of ge){const Bt=[],ut=[];for(const Yt of jt){const Zt=Yt.x,cr=Yt.y,qr=Pe[0]*Zt+Pe[4]*cr+Pe[12],Ur=Pe[1]*Zt+Pe[5]*cr+Pe[13],On=Pe[2]*Zt+Pe[6]*cr+Pe[14],Ga=Pe[3]*Zt+Pe[7]*cr+Pe[15],oi=On+vt,Fn=Ga+Nt,Ni=qr+nr,zi=Ur+Mt,Ri=On+Pt,yn=Ga+Xt,jn=new v((qr+He)/Fn,(Ur+nt)/Fn);jn.z=oi/Fn,Bt.push(jn);const yi=new v(Ni/yn,zi/yn);yi.z=Ri/yn,ut.push(yi)}We.push(Bt),Re.push(ut)}return[We,Re]}(w,K,q,L);return function(ge,ye,Te){let Pe=1/0;vE(Te,ye)&&(Pe=jE(Te,ye[0]));for(let We=0;We<ye.length;We++){const Re=ye[We],He=ge[We];for(let nt=0;nt<Re.length-1;nt++){const vt=Re[nt],Nt=[vt,Re[nt+1],He[nt+1],He[nt],vt];gE(Te,Nt)&&(Pe=Math.min(Pe,jE(Te,Nt)))}}return Pe!==1/0&&Pe}(ue[0],ue[1],ne)}}function Of(c,l){return c.x*l.x+c.y*l.y}function jE(c,l){if(c.length===1){let h=0;const m=l[h++];let w;for(;!w||m.equals(w);)if(w=l[h++],!w)return 1/0;for(;h<l.length;h++){const T=l[h],C=c[0],N=w.sub(m),L=T.sub(m),j=C.sub(m),q=Of(N,N),K=Of(N,L),ne=Of(L,L),ue=Of(j,N),ge=Of(j,L),ye=q*ne-K*K,Te=(ne*ue-K*ge)/ye,Pe=(q*ge-K*ue)/ye,We=m.z*(1-Te-Pe)+w.z*Te+T.z*Pe;if(isFinite(We))return We}return 1/0}{let h=1/0;for(const m of l)h=Math.min(h,m.z);return h}}const a3=R([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:s3}=a3,o3=R([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:l3}=o3,u3=gl.VectorTileFeature.types,c3=Math.cos(Math.PI/180*37.5),$E=Math.pow(2,14)/.5;class Qx{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(h=>h.id),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(h=>{this.gradients[h.id]={}}),this.layoutVertexArray=new lh,this.layoutVertexArray2=new hl,this.indexArray=new Ca,this.programConfigurations=new Lu(l.layers,l.zoom),this.segments=new Cr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(l,h,m){this.hasPattern=Zx("line",this.layers,h);const w=this.layers[0].layout.get("line-sort-key"),T=!w.isConstant(),C=[];for(const{feature:N,id:L,index:j,sourceLayerIndex:q}of l){const K=this.layers[0]._featureFilter.needGeometry,ne=Ou(N,K);if(!this.layers[0]._featureFilter.filter(new Yr(this.zoom),ne,m))continue;const ue=T?w.evaluate(ne,{},m):void 0,ge={id:L,properties:N.properties,type:N.type,sourceLayerIndex:q,index:j,geometry:K?ne.geometry:Bu(N),patterns:{},sortKey:ue};C.push(ge)}T&&C.sort((N,L)=>N.sortKey-L.sortKey);for(const N of C){const{geometry:L,index:j,sourceLayerIndex:q}=N;if(this.hasPattern){const K=Xx("line",this.layers,N,this.zoom,h);this.patternFeatures.push(K)}else this.addFeature(N,L,j,m,{});h.featureIndex.insert(l[j].feature,L,j,q,this.index)}}update(l,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,h,this.stateDependentLayers,m)}addFeatures(l,h,m){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,h,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=l.createVertexBuffer(this.layoutVertexArray2,l3)),this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,s3),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(l){if(l.properties&&Object.prototype.hasOwnProperty.call(l.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(l.properties,"mapbox_clip_end"))return{start:+l.properties.mapbox_clip_start,end:+l.properties.mapbox_clip_end}}addFeature(l,h,m,w,T){const C=this.layers[0].layout,N=C.get("line-join").evaluate(l,{}),L=C.get("line-cap"),j=C.get("line-miter-limit"),q=C.get("line-round-limit");this.lineClips=this.lineFeatureClips(l);for(const K of h)this.addLine(K,l,N,L,j,q);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,m,T,w)}addLine(l,h,m,w,T,C){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Pe=0;Pe<l.length-1;Pe++)this.totalDistance+=l[Pe].dist(l[Pe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const N=u3[h.type]==="Polygon";let L=l.length;for(;L>=2&&l[L-1].equals(l[L-2]);)L--;let j=0;for(;j<L-1&&l[j].equals(l[j+1]);)j++;if(L<(N?3:2))return;m==="bevel"&&(T=1.05);const q=this.overscaling<=16?15*In/(512*this.overscaling):0,K=this.segments.prepareSegment(10*L,this.layoutVertexArray,this.indexArray);let ne,ue,ge,ye,Te;this.e1=this.e2=-1,N&&(ne=l[L-2],Te=l[j].sub(ne)._unit()._perp());for(let Pe=j;Pe<L;Pe++){if(ge=Pe===L-1?N?l[j+1]:void 0:l[Pe+1],ge&&l[Pe].equals(ge))continue;Te&&(ye=Te),ne&&(ue=ne),ne=l[Pe],Te=ge?ge.sub(ne)._unit()._perp():ye,ye=ye||Te;let We=ye.add(Te);We.x===0&&We.y===0||We._unit();const Re=ye.x*Te.x+ye.y*Te.y,He=We.x*Te.x+We.y*Te.y,nt=He!==0?1/He:1/0,vt=2*Math.sqrt(2-2*He),Nt=He<c3&&ue&&ge,nr=ye.x*Te.y-ye.y*Te.x>0;if(Nt&&Pe>j){const Xt=ne.dist(ue);if(Xt>2*q){const jt=ne.sub(ne.sub(ue)._mult(q/Xt)._round());this.updateDistance(ue,jt),this.addCurrentVertex(jt,ye,0,0,K),ue=jt}}const Mt=ue&&ge;let Pt=Mt?m:N?"butt":w;if(Mt&&Pt==="round"&&(nt<C?Pt="miter":nt<=2&&(Pt="fakeround")),Pt==="miter"&&nt>T&&(Pt="bevel"),Pt==="bevel"&&(nt>2&&(Pt="flipbevel"),nt<T&&(Pt="miter")),ue&&this.updateDistance(ue,ne),Pt==="miter")We._mult(nt),this.addCurrentVertex(ne,We,0,0,K);else if(Pt==="flipbevel"){if(nt>100)We=Te.mult(-1);else{const Xt=nt*ye.add(Te).mag()/ye.sub(Te).mag();We._perp()._mult(Xt*(nr?-1:1))}this.addCurrentVertex(ne,We,0,0,K),this.addCurrentVertex(ne,We.mult(-1),0,0,K)}else if(Pt==="bevel"||Pt==="fakeround"){const Xt=-Math.sqrt(nt*nt-1),jt=nr?Xt:0,Bt=nr?0:Xt;if(ue&&this.addCurrentVertex(ne,ye,jt,Bt,K),Pt==="fakeround"){const ut=Math.round(180*vt/Math.PI/20);for(let Yt=1;Yt<ut;Yt++){let Zt=Yt/ut;if(Zt!==.5){const qr=Zt-.5;Zt+=Zt*qr*(Zt-1)*((1.0904+Re*(Re*(3.55645-1.43519*Re)-3.2452))*qr*qr+(.848013+Re*(.215638*Re-1.06021)))}const cr=Te.sub(ye)._mult(Zt)._add(ye)._unit()._mult(nr?-1:1);this.addHalfVertex(ne,cr.x,cr.y,!1,nr,0,K)}}ge&&this.addCurrentVertex(ne,Te,-jt,-Bt,K)}else if(Pt==="butt")this.addCurrentVertex(ne,We,0,0,K);else if(Pt==="square"){const Xt=ue?1:-1;this.addCurrentVertex(ne,We,Xt,Xt,K)}else Pt==="round"&&(ue&&(this.addCurrentVertex(ne,ye,0,0,K),this.addCurrentVertex(ne,ye,1,1,K,!0)),ge&&(this.addCurrentVertex(ne,Te,-1,-1,K,!0),this.addCurrentVertex(ne,Te,0,0,K)));if(Nt&&Pe<L-1){const Xt=ne.dist(ge);if(Xt>2*q){const jt=ne.add(ge.sub(ne)._mult(q/Xt)._round());this.updateDistance(ne,jt),this.addCurrentVertex(jt,Te,0,0,K),ne=jt}}}}addCurrentVertex(l,h,m,w,T,C=!1){const N=h.y*w-h.x,L=-h.y-h.x*w;this.addHalfVertex(l,h.x+h.y*m,h.y-h.x*m,C,!1,m,T),this.addHalfVertex(l,N,L,C,!0,-w,T),this.distance>$E/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(l,h,m,w,T,C))}addHalfVertex({x:l,y:h},m,w,T,C,N,L){const j=.5*(this.lineClips?this.scaledDistance*($E-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((l<<1)+(T?1:0),(h<<1)+(C?1:0),Math.round(63*m)+128,Math.round(63*w)+128,1+(N===0?0:N<0?-1:1)|(63&j)<<2,j>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const q=L.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,q),L.primitiveLength++),C?this.e2=q:this.e1=q}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(l,h){this.distance+=l.dist(h),this.updateScaledDistance()}}let VE,UE;Ft("LineBucket",Qx,{omit:["layers","patternFeatures"]});var qE={get paint(){return UE=UE||new E({"line-opacity":new ir($e.paint_line["line-opacity"]),"line-color":new ir($e.paint_line["line-color"]),"line-translate":new Gt($e.paint_line["line-translate"]),"line-translate-anchor":new Gt($e.paint_line["line-translate-anchor"]),"line-width":new ir($e.paint_line["line-width"]),"line-gap-width":new ir($e.paint_line["line-gap-width"]),"line-offset":new ir($e.paint_line["line-offset"]),"line-blur":new ir($e.paint_line["line-blur"]),"line-dasharray":new oh($e.paint_line["line-dasharray"]),"line-pattern":new sh($e.paint_line["line-pattern"]),"line-gradient":new Pf($e.paint_line["line-gradient"])})},get layout(){return VE=VE||new E({"line-cap":new Gt($e.layout_line["line-cap"]),"line-join":new ir($e.layout_line["line-join"]),"line-miter-limit":new Gt($e.layout_line["line-miter-limit"]),"line-round-limit":new Gt($e.layout_line["line-round-limit"]),"line-sort-key":new ir($e.layout_line["line-sort-key"])})}};class h3 extends ir{possiblyEvaluate(l,h){return h=new Yr(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),super.possiblyEvaluate(l,h)}evaluate(l,h,m,w){return h=$({},h,{zoom:Math.floor(h.zoom)}),super.evaluate(l,h,m,w)}}let Vg;class d3 extends f{constructor(l){super(l,qE),this.gradientVersion=0,Vg||(Vg=new h3(qE.paint.properties["line-width"].specification),Vg.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){const h=this.gradientExpression();this.stepInterpolant=!!function(m){return m._styleExpression!==void 0}(h)&&h._styleExpression.expression instanceof Go,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(l,h){super.recalculate(l,h),this.paint._values["line-floorwidth"]=Vg.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new Qx(l)}queryRadius(l){const h=l,m=HE(Mf("line-width",this,h),Mf("line-gap-width",this,h)),w=Mf("line-offset",this,h);return m/2+Math.abs(w)+Lg(this.paint.get("line-translate"))}queryIntersectsFeature(l,h,m,w,T,C,N){const L=Bg(l,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),C.angle,N),j=N/2*HE(this.paint.get("line-width").evaluate(h,m),this.paint.get("line-gap-width").evaluate(h,m)),q=this.paint.get("line-offset").evaluate(h,m);return q&&(w=function(K,ne){const ue=[];for(let ge=0;ge<K.length;ge++){const ye=K[ge],Te=[];for(let Pe=0;Pe<ye.length;Pe++){const We=ye[Pe-1],Re=ye[Pe],He=ye[Pe+1],nt=Pe===0?new v(0,0):Re.sub(We)._unit()._perp(),vt=Pe===ye.length-1?new v(0,0):He.sub(Re)._unit()._perp(),Nt=nt._add(vt)._unit(),nr=Nt.x*vt.x+Nt.y*vt.y;nr!==0&&Nt._mult(1/nr),Te.push(Nt._mult(ne)._add(Re))}ue.push(Te)}return ue}(w,q*N)),function(K,ne,ue){for(let ge=0;ge<ne.length;ge++){const ye=ne[ge];if(K.length>=3){for(let Te=0;Te<ye.length;Te++)if(ph(K,ye[Te]))return!0}if(wB(K,ye,ue))return!0}return!1}(L,w,j)}isTileClipped(){return!0}}function HE(c,l){return l>0?l+2*c:c}const f3=R([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),p3=R([{name:"a_projected_pos",components:3,type:"Float32"}],4);R([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const m3=R([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);R([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const GE=R([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),g3=R([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function v3(c,l,h){return c.sections.forEach(m=>{m.text=function(w,T,C){const N=T.layout.get("text-transform").evaluate(C,{});return N==="uppercase"?w=w.toLocaleUpperCase():N==="lowercase"&&(w=w.toLocaleLowerCase()),Zi.applyArabicShaping&&(w=Zi.applyArabicShaping(w)),w}(m.text,l,h)}),c}R([{name:"triangle",components:3,type:"Uint16"}]),R([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),R([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),R([{type:"Float32",name:"offsetX"}]),R([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),R([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Ff={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var zn=24,WE=Vr,ZE=function(c,l,h,m,w){var T,C,N=8*w-m-1,L=(1<<N)-1,j=L>>1,q=-7,K=w-1,ne=-1,ue=c[l+K];for(K+=ne,T=ue&(1<<-q)-1,ue>>=-q,q+=N;q>0;T=256*T+c[l+K],K+=ne,q-=8);for(C=T&(1<<-q)-1,T>>=-q,q+=m;q>0;C=256*C+c[l+K],K+=ne,q-=8);if(T===0)T=1-j;else{if(T===L)return C?NaN:1/0*(ue?-1:1);C+=Math.pow(2,m),T-=j}return(ue?-1:1)*C*Math.pow(2,T-m)},XE=function(c,l,h,m,w,T){var C,N,L,j=8*T-w-1,q=(1<<j)-1,K=q>>1,ne=w===23?Math.pow(2,-24)-Math.pow(2,-77):0,ue=0,ge=1,ye=l<0||l===0&&1/l<0?1:0;for(l=Math.abs(l),isNaN(l)||l===1/0?(N=isNaN(l)?1:0,C=q):(C=Math.floor(Math.log(l)/Math.LN2),l*(L=Math.pow(2,-C))<1&&(C--,L*=2),(l+=C+K>=1?ne/L:ne*Math.pow(2,1-K))*L>=2&&(C++,L/=2),C+K>=q?(N=0,C=q):C+K>=1?(N=(l*L-1)*Math.pow(2,w),C+=K):(N=l*Math.pow(2,K-1)*Math.pow(2,w),C=0));w>=8;c[h+ue]=255&N,ue+=ge,N/=256,w-=8);for(C=C<<w|N,j+=w;j>0;c[h+ue]=255&C,ue+=ge,C/=256,j-=8);c[h+ue-ge]|=128*ye};function Vr(c){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(c)?c:new Uint8Array(c||0),this.pos=0,this.type=0,this.length=this.buf.length}Vr.Varint=0,Vr.Fixed64=1,Vr.Bytes=2,Vr.Fixed32=5;var e_=4294967296,KE=1/e_,YE=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function vo(c){return c.type===Vr.Bytes?c.readVarint()+c.pos:c.pos+1}function yh(c,l,h){return h?4294967296*l+(c>>>0):4294967296*(l>>>0)+(c>>>0)}function JE(c,l,h){var m=l<=16383?1:l<=2097151?2:l<=268435455?3:Math.floor(Math.log(l)/(7*Math.LN2));h.realloc(m);for(var w=h.pos-1;w>=c;w--)h.buf[w+m]=h.buf[w]}function y3(c,l){for(var h=0;h<c.length;h++)l.writeVarint(c[h])}function x3(c,l){for(var h=0;h<c.length;h++)l.writeSVarint(c[h])}function _3(c,l){for(var h=0;h<c.length;h++)l.writeFloat(c[h])}function w3(c,l){for(var h=0;h<c.length;h++)l.writeDouble(c[h])}function b3(c,l){for(var h=0;h<c.length;h++)l.writeBoolean(c[h])}function S3(c,l){for(var h=0;h<c.length;h++)l.writeFixed32(c[h])}function E3(c,l){for(var h=0;h<c.length;h++)l.writeSFixed32(c[h])}function T3(c,l){for(var h=0;h<c.length;h++)l.writeFixed64(c[h])}function C3(c,l){for(var h=0;h<c.length;h++)l.writeSFixed64(c[h])}function Ug(c,l){return(c[l]|c[l+1]<<8|c[l+2]<<16)+16777216*c[l+3]}function xh(c,l,h){c[h]=l,c[h+1]=l>>>8,c[h+2]=l>>>16,c[h+3]=l>>>24}function QE(c,l){return(c[l]|c[l+1]<<8|c[l+2]<<16)+(c[l+3]<<24)}Vr.prototype={destroy:function(){this.buf=null},readFields:function(c,l,h){for(h=h||this.length;this.pos<h;){var m=this.readVarint(),w=m>>3,T=this.pos;this.type=7&m,c(w,l,this),this.pos===T&&this.skip(m)}return l},readMessage:function(c,l){return this.readFields(c,l,this.readVarint()+this.pos)},readFixed32:function(){var c=Ug(this.buf,this.pos);return this.pos+=4,c},readSFixed32:function(){var c=QE(this.buf,this.pos);return this.pos+=4,c},readFixed64:function(){var c=Ug(this.buf,this.pos)+Ug(this.buf,this.pos+4)*e_;return this.pos+=8,c},readSFixed64:function(){var c=Ug(this.buf,this.pos)+QE(this.buf,this.pos+4)*e_;return this.pos+=8,c},readFloat:function(){var c=ZE(this.buf,this.pos,!0,23,4);return this.pos+=4,c},readDouble:function(){var c=ZE(this.buf,this.pos,!0,52,8);return this.pos+=8,c},readVarint:function(c){var l,h,m=this.buf;return l=127&(h=m[this.pos++]),h<128?l:(l|=(127&(h=m[this.pos++]))<<7,h<128?l:(l|=(127&(h=m[this.pos++]))<<14,h<128?l:(l|=(127&(h=m[this.pos++]))<<21,h<128?l:function(w,T,C){var N,L,j=C.buf;if(N=(112&(L=j[C.pos++]))>>4,L<128||(N|=(127&(L=j[C.pos++]))<<3,L<128)||(N|=(127&(L=j[C.pos++]))<<10,L<128)||(N|=(127&(L=j[C.pos++]))<<17,L<128)||(N|=(127&(L=j[C.pos++]))<<24,L<128)||(N|=(1&(L=j[C.pos++]))<<31,L<128))return yh(w,N,T);throw new Error("Expected varint not more than 10 bytes")}(l|=(15&(h=m[this.pos]))<<28,c,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var c=this.readVarint();return c%2==1?(c+1)/-2:c/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var c=this.readVarint()+this.pos,l=this.pos;return this.pos=c,c-l>=12&&YE?function(h,m,w){return YE.decode(h.subarray(m,w))}(this.buf,l,c):function(h,m,w){for(var T="",C=m;C<w;){var N,L,j,q=h[C],K=null,ne=q>239?4:q>223?3:q>191?2:1;if(C+ne>w)break;ne===1?q<128&&(K=q):ne===2?(192&(N=h[C+1]))==128&&(K=(31&q)<<6|63&N)<=127&&(K=null):ne===3?(L=h[C+2],(192&(N=h[C+1]))==128&&(192&L)==128&&((K=(15&q)<<12|(63&N)<<6|63&L)<=2047||K>=55296&&K<=57343)&&(K=null)):ne===4&&(L=h[C+2],j=h[C+3],(192&(N=h[C+1]))==128&&(192&L)==128&&(192&j)==128&&((K=(15&q)<<18|(63&N)<<12|(63&L)<<6|63&j)<=65535||K>=1114112)&&(K=null)),K===null?(K=65533,ne=1):K>65535&&(K-=65536,T+=String.fromCharCode(K>>>10&1023|55296),K=56320|1023&K),T+=String.fromCharCode(K),C+=ne}return T}(this.buf,l,c)},readBytes:function(){var c=this.readVarint()+this.pos,l=this.buf.subarray(this.pos,c);return this.pos=c,l},readPackedVarint:function(c,l){if(this.type!==Vr.Bytes)return c.push(this.readVarint(l));var h=vo(this);for(c=c||[];this.pos<h;)c.push(this.readVarint(l));return c},readPackedSVarint:function(c){if(this.type!==Vr.Bytes)return c.push(this.readSVarint());var l=vo(this);for(c=c||[];this.pos<l;)c.push(this.readSVarint());return c},readPackedBoolean:function(c){if(this.type!==Vr.Bytes)return c.push(this.readBoolean());var l=vo(this);for(c=c||[];this.pos<l;)c.push(this.readBoolean());return c},readPackedFloat:function(c){if(this.type!==Vr.Bytes)return c.push(this.readFloat());var l=vo(this);for(c=c||[];this.pos<l;)c.push(this.readFloat());return c},readPackedDouble:function(c){if(this.type!==Vr.Bytes)return c.push(this.readDouble());var l=vo(this);for(c=c||[];this.pos<l;)c.push(this.readDouble());return c},readPackedFixed32:function(c){if(this.type!==Vr.Bytes)return c.push(this.readFixed32());var l=vo(this);for(c=c||[];this.pos<l;)c.push(this.readFixed32());return c},readPackedSFixed32:function(c){if(this.type!==Vr.Bytes)return c.push(this.readSFixed32());var l=vo(this);for(c=c||[];this.pos<l;)c.push(this.readSFixed32());return c},readPackedFixed64:function(c){if(this.type!==Vr.Bytes)return c.push(this.readFixed64());var l=vo(this);for(c=c||[];this.pos<l;)c.push(this.readFixed64());return c},readPackedSFixed64:function(c){if(this.type!==Vr.Bytes)return c.push(this.readSFixed64());var l=vo(this);for(c=c||[];this.pos<l;)c.push(this.readSFixed64());return c},skip:function(c){var l=7&c;if(l===Vr.Varint)for(;this.buf[this.pos++]>127;);else if(l===Vr.Bytes)this.pos=this.readVarint()+this.pos;else if(l===Vr.Fixed32)this.pos+=4;else{if(l!==Vr.Fixed64)throw new Error("Unimplemented type: "+l);this.pos+=8}},writeTag:function(c,l){this.writeVarint(c<<3|l)},realloc:function(c){for(var l=this.length||16;l<this.pos+c;)l*=2;if(l!==this.length){var h=new Uint8Array(l);h.set(this.buf),this.buf=h,this.length=l}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(c){this.realloc(4),xh(this.buf,c,this.pos),this.pos+=4},writeSFixed32:function(c){this.realloc(4),xh(this.buf,c,this.pos),this.pos+=4},writeFixed64:function(c){this.realloc(8),xh(this.buf,-1&c,this.pos),xh(this.buf,Math.floor(c*KE),this.pos+4),this.pos+=8},writeSFixed64:function(c){this.realloc(8),xh(this.buf,-1&c,this.pos),xh(this.buf,Math.floor(c*KE),this.pos+4),this.pos+=8},writeVarint:function(c){(c=+c||0)>268435455||c<0?function(l,h){var m,w;if(l>=0?(m=l%4294967296|0,w=l/4294967296|0):(w=~(-l/4294967296),4294967295^(m=~(-l%4294967296))?m=m+1|0:(m=0,w=w+1|0)),l>=18446744073709552e3||l<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");h.realloc(10),function(T,C,N){N.buf[N.pos++]=127&T|128,T>>>=7,N.buf[N.pos++]=127&T|128,T>>>=7,N.buf[N.pos++]=127&T|128,T>>>=7,N.buf[N.pos++]=127&T|128,N.buf[N.pos]=127&(T>>>=7)}(m,0,h),function(T,C){var N=(7&T)<<4;C.buf[C.pos++]|=N|((T>>>=3)?128:0),T&&(C.buf[C.pos++]=127&T|((T>>>=7)?128:0),T&&(C.buf[C.pos++]=127&T|((T>>>=7)?128:0),T&&(C.buf[C.pos++]=127&T|((T>>>=7)?128:0),T&&(C.buf[C.pos++]=127&T|((T>>>=7)?128:0),T&&(C.buf[C.pos++]=127&T)))))}(w,h)}(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))},writeSVarint:function(c){this.writeVarint(c<0?2*-c-1:2*c)},writeBoolean:function(c){this.writeVarint(!!c)},writeString:function(c){c=String(c),this.realloc(4*c.length),this.pos++;var l=this.pos;this.pos=function(m,w,T){for(var C,N,L=0;L<w.length;L++){if((C=w.charCodeAt(L))>55295&&C<57344){if(!N){C>56319||L+1===w.length?(m[T++]=239,m[T++]=191,m[T++]=189):N=C;continue}if(C<56320){m[T++]=239,m[T++]=191,m[T++]=189,N=C;continue}C=N-55296<<10|C-56320|65536,N=null}else N&&(m[T++]=239,m[T++]=191,m[T++]=189,N=null);C<128?m[T++]=C:(C<2048?m[T++]=C>>6|192:(C<65536?m[T++]=C>>12|224:(m[T++]=C>>18|240,m[T++]=C>>12&63|128),m[T++]=C>>6&63|128),m[T++]=63&C|128)}return T}(this.buf,c,this.pos);var h=this.pos-l;h>=128&&JE(l,h,this),this.pos=l-1,this.writeVarint(h),this.pos+=h},writeFloat:function(c){this.realloc(4),XE(this.buf,c,this.pos,!0,23,4),this.pos+=4},writeDouble:function(c){this.realloc(8),XE(this.buf,c,this.pos,!0,52,8),this.pos+=8},writeBytes:function(c){var l=c.length;this.writeVarint(l),this.realloc(l);for(var h=0;h<l;h++)this.buf[this.pos++]=c[h]},writeRawMessage:function(c,l){this.pos++;var h=this.pos;c(l,this);var m=this.pos-h;m>=128&&JE(h,m,this),this.pos=h-1,this.writeVarint(m),this.pos+=m},writeMessage:function(c,l,h){this.writeTag(c,Vr.Bytes),this.writeRawMessage(l,h)},writePackedVarint:function(c,l){l.length&&this.writeMessage(c,y3,l)},writePackedSVarint:function(c,l){l.length&&this.writeMessage(c,x3,l)},writePackedBoolean:function(c,l){l.length&&this.writeMessage(c,b3,l)},writePackedFloat:function(c,l){l.length&&this.writeMessage(c,_3,l)},writePackedDouble:function(c,l){l.length&&this.writeMessage(c,w3,l)},writePackedFixed32:function(c,l){l.length&&this.writeMessage(c,S3,l)},writePackedSFixed32:function(c,l){l.length&&this.writeMessage(c,E3,l)},writePackedFixed64:function(c,l){l.length&&this.writeMessage(c,T3,l)},writePackedSFixed64:function(c,l){l.length&&this.writeMessage(c,C3,l)},writeBytesField:function(c,l){this.writeTag(c,Vr.Bytes),this.writeBytes(l)},writeFixed32Field:function(c,l){this.writeTag(c,Vr.Fixed32),this.writeFixed32(l)},writeSFixed32Field:function(c,l){this.writeTag(c,Vr.Fixed32),this.writeSFixed32(l)},writeFixed64Field:function(c,l){this.writeTag(c,Vr.Fixed64),this.writeFixed64(l)},writeSFixed64Field:function(c,l){this.writeTag(c,Vr.Fixed64),this.writeSFixed64(l)},writeVarintField:function(c,l){this.writeTag(c,Vr.Varint),this.writeVarint(l)},writeSVarintField:function(c,l){this.writeTag(c,Vr.Varint),this.writeSVarint(l)},writeStringField:function(c,l){this.writeTag(c,Vr.Bytes),this.writeString(l)},writeFloatField:function(c,l){this.writeTag(c,Vr.Fixed32),this.writeFloat(l)},writeDoubleField:function(c,l){this.writeTag(c,Vr.Fixed64),this.writeDouble(l)},writeBooleanField:function(c,l){this.writeVarintField(c,!!l)}};var t_=d(WE);const r_=3;function k3(c,l,h){c===1&&h.readMessage(P3,l)}function P3(c,l,h){if(c===3){const{id:m,bitmap:w,width:T,height:C,left:N,top:L,advance:j}=h.readMessage(I3,{});l.push({id:m,bitmap:new Nf({width:T+2*r_,height:C+2*r_},w),metrics:{width:T,height:C,left:N,top:L,advance:j}})}}function I3(c,l,h){c===1?l.id=h.readVarint():c===2?l.bitmap=h.readBytes():c===3?l.width=h.readVarint():c===4?l.height=h.readVarint():c===5?l.left=h.readSVarint():c===6?l.top=h.readSVarint():c===7&&(l.advance=h.readVarint())}const eT=r_;function tT(c){let l=0,h=0;for(const C of c)l+=C.w*C.h,h=Math.max(h,C.w);c.sort((C,N)=>N.h-C.h);const m=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(l/.95)),h),h:1/0}];let w=0,T=0;for(const C of c)for(let N=m.length-1;N>=0;N--){const L=m[N];if(!(C.w>L.w||C.h>L.h)){if(C.x=L.x,C.y=L.y,T=Math.max(T,C.y+C.h),w=Math.max(w,C.x+C.w),C.w===L.w&&C.h===L.h){const j=m.pop();N<m.length&&(m[N]=j)}else C.h===L.h?(L.x+=C.w,L.w-=C.w):C.w===L.w?(L.y+=C.h,L.h-=C.h):(m.push({x:L.x+C.w,y:L.y,w:L.w-C.w,h:C.h}),L.y+=C.h,L.h-=C.h);break}}return{w,h:T,fill:l/(w*T)||0}}const Ki=1;class n_{constructor(l,{pixelRatio:h,version:m,stretchX:w,stretchY:T,content:C,textFitWidth:N,textFitHeight:L}){this.paddedRect=l,this.pixelRatio=h,this.stretchX=w,this.stretchY=T,this.content=C,this.version=m,this.textFitWidth=N,this.textFitHeight=L}get tl(){return[this.paddedRect.x+Ki,this.paddedRect.y+Ki]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ki,this.paddedRect.y+this.paddedRect.h-Ki]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Ki)/this.pixelRatio,(this.paddedRect.h-2*Ki)/this.pixelRatio]}}class rT{constructor(l,h){const m={},w={};this.haveRenderCallbacks=[];const T=[];this.addImages(l,m,T),this.addImages(h,w,T);const{w:C,h:N}=tT(T),L=new ka({width:C||1,height:N||1});for(const j in l){const q=l[j],K=m[j].paddedRect;ka.copy(q.data,L,{x:0,y:0},{x:K.x+Ki,y:K.y+Ki},q.data)}for(const j in h){const q=h[j],K=w[j].paddedRect,ne=K.x+Ki,ue=K.y+Ki,ge=q.data.width,ye=q.data.height;ka.copy(q.data,L,{x:0,y:0},{x:ne,y:ue},q.data),ka.copy(q.data,L,{x:0,y:ye-1},{x:ne,y:ue-1},{width:ge,height:1}),ka.copy(q.data,L,{x:0,y:0},{x:ne,y:ue+ye},{width:ge,height:1}),ka.copy(q.data,L,{x:ge-1,y:0},{x:ne-1,y:ue},{width:1,height:ye}),ka.copy(q.data,L,{x:0,y:0},{x:ne+ge,y:ue},{width:1,height:ye})}this.image=L,this.iconPositions=m,this.patternPositions=w}addImages(l,h,m){for(const w in l){const T=l[w],C={x:0,y:0,w:T.data.width+2*Ki,h:T.data.height+2*Ki};m.push(C),h[w]=new n_(C,T),T.hasRenderCallback&&this.haveRenderCallbacks.push(w)}}patchUpdatedImages(l,h){l.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const m in l.updatedImages)this.patchUpdatedImage(this.iconPositions[m],l.getImage(m),h),this.patchUpdatedImage(this.patternPositions[m],l.getImage(m),h)}patchUpdatedImage(l,h,m){if(!l||!h||l.version===h.version)return;l.version=h.version;const[w,T]=l.tl;m.update(h.data,void 0,{x:w,y:T})}}var vl;Ft("ImagePosition",n_),Ft("ImageAtlas",rT),u.ah=void 0,(vl=u.ah||(u.ah={}))[vl.none=0]="none",vl[vl.horizontal=1]="horizontal",vl[vl.vertical=2]="vertical",vl[vl.horizontalOnly=3]="horizontalOnly";const jf=-17;class $f{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(l,h){const m=new $f;return m.scale=l||1,m.fontStack=h,m}static forImage(l){const h=new $f;return h.imageName=l,h}}class _h{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(l,h){const m=new _h;for(let w=0;w<l.sections.length;w++){const T=l.sections[w];T.image?m.addImageSection(T):m.addTextSection(T,h)}return m}length(){return this.text.length}getSection(l){return this.sections[this.sectionIndex[l]]}getSectionIndex(l){return this.sectionIndex[l]}getCharCode(l){return this.text.charCodeAt(l)}verticalizePunctuation(){this.text=function(l){let h="";for(let m=0;m<l.length;m++){const w=l.charCodeAt(m+1)||null,T=l.charCodeAt(m-1)||null;h+=w&&Ig(w)&&!Ff[l[m+1]]||T&&Ig(T)&&!Ff[l[m-1]]||!Ff[l[m]]?l[m]:Ff[l[m]]}return h}(this.text)}trim(){let l=0;for(let m=0;m<this.text.length&&Hg[this.text.charCodeAt(m)];m++)l++;let h=this.text.length;for(let m=this.text.length-1;m>=0&&m>=l&&Hg[this.text.charCodeAt(m)];m--)h--;this.text=this.text.substring(l,h),this.sectionIndex=this.sectionIndex.slice(l,h)}substring(l,h){const m=new _h;return m.text=this.text.substring(l,h),m.sectionIndex=this.sectionIndex.slice(l,h),m.sections=this.sections,m}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((l,h)=>Math.max(l,this.sections[h].scale),0)}addTextSection(l,h){this.text+=l.text,this.sections.push($f.forText(l.scale,l.fontStack||h));const m=this.sections.length-1;for(let w=0;w<l.text.length;++w)this.sectionIndex.push(m)}addImageSection(l){const h=l.image?l.image.name:"";if(h.length===0)return void te("Can't add FormattedSection with an empty image.");const m=this.getNextImageSectionCharCode();m?(this.text+=String.fromCharCode(m),this.sections.push($f.forImage(h)),this.sectionIndex.push(this.sections.length-1)):te("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function qg(c,l,h,m,w,T,C,N,L,j,q,K,ne,ue,ge){const ye=_h.fromFeature(c,w);let Te;K===u.ah.vertical&&ye.verticalizePunctuation();const{processBidirectionalText:Pe,processStyledBidirectionalText:We}=Zi;if(Pe&&ye.sections.length===1){Te=[];const nt=Pe(ye.toString(),i_(ye,j,T,l,m,ue));for(const vt of nt){const Nt=new _h;Nt.text=vt,Nt.sections=ye.sections;for(let nr=0;nr<vt.length;nr++)Nt.sectionIndex.push(0);Te.push(Nt)}}else if(We){Te=[];const nt=We(ye.text,ye.sectionIndex,i_(ye,j,T,l,m,ue));for(const vt of nt){const Nt=new _h;Nt.text=vt[0],Nt.sectionIndex=vt[1],Nt.sections=ye.sections,Te.push(Nt)}}else Te=function(nt,vt){const Nt=[],nr=nt.text;let Mt=0;for(const Pt of vt)Nt.push(nt.substring(Mt,Pt)),Mt=Pt;return Mt<nr.length&&Nt.push(nt.substring(Mt,nr.length)),Nt}(ye,i_(ye,j,T,l,m,ue));const Re=[],He={positionedLines:Re,text:ye.toString(),top:q[1],bottom:q[1],left:q[0],right:q[0],writingMode:K,iconsInText:!1,verticalizable:!1};return function(nt,vt,Nt,nr,Mt,Pt,Xt,jt,Bt,ut,Yt,Zt){let cr=0,qr=jf,Ur=0,On=0;const Ga=jt==="right"?1:jt==="left"?0:.5;let oi=0;for(const yn of Mt){yn.trim();const jn=yn.getMaxScale(),yi=(jn-1)*zn,li={positionedGlyphs:[],lineOffset:0};nt.positionedLines[oi]=li;const Li=li.positionedGlyphs;let ui=0;if(!yn.length()){qr+=Pt,++oi;continue}for(let Yi=0;Yi<yn.length();Yi++){const Nr=yn.getSection(Yi),Xr=yn.getSectionIndex(Yi),tn=yn.getCharCode(Yi);let ha=0,hn=null,Eh=null,Bs=null,Os=zn;const Wa=!(Bt===u.ah.horizontal||!Yt&&!Cf(tn)||Yt&&(Hg[tn]||(Fn=tn,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(Fn)))));if(Nr.imageName){const Aa=nr[Nr.imageName];if(!Aa)continue;Bs=Nr.imageName,nt.iconsInText=nt.iconsInText||!0,Eh=Aa.paddedRect;const Wn=Aa.displaySize;Nr.scale=Nr.scale*zn/Zt,hn={width:Wn[0],height:Wn[1],left:Ki,top:-eT,advance:Wa?Wn[1]:Wn[0]},ha=yi+(zn-Wn[1]*Nr.scale),Os=hn.advance;const yo=Wa?Wn[0]*Nr.scale-zn*jn:Wn[1]*Nr.scale-zn*jn;yo>0&&yo>ui&&(ui=yo)}else{const Aa=Nt[Nr.fontStack],Wn=Aa&&Aa[tn];if(Wn&&Wn.rect)Eh=Wn.rect,hn=Wn.metrics;else{const yo=vt[Nr.fontStack],Wf=yo&&yo[tn];if(!Wf)continue;hn=Wf.metrics}ha=(jn-Nr.scale)*zn}Wa?(nt.verticalizable=!0,Li.push({glyph:tn,imageName:Bs,x:cr,y:qr+ha,vertical:Wa,scale:Nr.scale,fontStack:Nr.fontStack,sectionIndex:Xr,metrics:hn,rect:Eh}),cr+=Os*Nr.scale+ut):(Li.push({glyph:tn,imageName:Bs,x:cr,y:qr+ha,vertical:Wa,scale:Nr.scale,fontStack:Nr.fontStack,sectionIndex:Xr,metrics:hn,rect:Eh}),cr+=hn.advance*Nr.scale+ut)}Li.length!==0&&(Ur=Math.max(cr-ut,Ur),N3(Li,0,Li.length-1,Ga,ui)),cr=0;const Ia=Pt*jn+ui;li.lineOffset=Math.max(ui,yi),qr+=Ia,On=Math.max(Ia,On),++oi}var Fn;const Ni=qr-jf,{horizontalAlign:zi,verticalAlign:Ri}=a_(Xt);(function(yn,jn,yi,li,Li,ui,Ia,Yi,Nr){const Xr=(jn-yi)*Li;let tn=0;tn=ui!==Ia?-Yi*li-jf:(-li*Nr+.5)*Ia;for(const ha of yn)for(const hn of ha.positionedGlyphs)hn.x+=Xr,hn.y+=tn})(nt.positionedLines,Ga,zi,Ri,Ur,On,Pt,Ni,Mt.length),nt.top+=-Ri*Ni,nt.bottom=nt.top+Ni,nt.left+=-zi*Ur,nt.right=nt.left+Ur}(He,l,h,m,Te,C,N,L,K,j,ne,ge),!function(nt){for(const vt of nt)if(vt.positionedGlyphs.length!==0)return!1;return!0}(Re)&&He}const Hg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},A3={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},M3={40:!0};function nT(c,l,h,m,w,T){if(l.imageName){const C=m[l.imageName];return C?C.displaySize[0]*l.scale*zn/T+w:0}{const C=h[l.fontStack],N=C&&C[c];return N?N.metrics.advance*l.scale+w:0}}function iT(c,l,h,m){const w=Math.pow(c-l,2);return m?c<l?w/2:2*w:w+Math.abs(h)*h}function D3(c,l,h){let m=0;return c===10&&(m-=1e4),h&&(m+=150),c!==40&&c!==65288||(m+=50),l!==41&&l!==65289||(m+=50),m}function aT(c,l,h,m,w,T){let C=null,N=iT(l,h,w,T);for(const L of m){const j=iT(l-L.x,h,w,T)+L.badness;j<=N&&(C=L,N=j)}return{index:c,x:l,priorBreak:C,badness:N}}function sT(c){return c?sT(c.priorBreak).concat(c.index):[]}function i_(c,l,h,m,w,T){if(!c)return[];const C=[],N=function(K,ne,ue,ge,ye,Te){let Pe=0;for(let We=0;We<K.length();We++){const Re=K.getSection(We);Pe+=nT(K.getCharCode(We),Re,ge,ye,ne,Te)}return Pe/Math.max(1,Math.ceil(Pe/ue))}(c,l,h,m,w,T),L=c.text.indexOf("")>=0;let j=0;for(let K=0;K<c.length();K++){const ne=c.getSection(K),ue=c.getCharCode(K);if(Hg[ue]||(j+=nT(ue,ne,m,w,l,T)),K<c.length()-1){const ge=!((q=ue)<11904)&&(!!Tr["CJK Compatibility Forms"](q)||!!Tr["CJK Compatibility"](q)||!!Tr["CJK Strokes"](q)||!!Tr["CJK Symbols and Punctuation"](q)||!!Tr["Enclosed CJK Letters and Months"](q)||!!Tr["Halfwidth and Fullwidth Forms"](q)||!!Tr["Ideographic Description Characters"](q)||!!Tr["Vertical Forms"](q)||Pg.test(String.fromCodePoint(q)));(A3[ue]||ge||ne.imageName||K!==c.length()-2&&M3[c.getCharCode(K+1)])&&C.push(aT(K+1,j,N,C,D3(ue,c.getCharCode(K+1),ge&&L),!1))}}var q;return sT(aT(c.length(),j,N,C,0,!0))}function a_(c){let l=.5,h=.5;switch(c){case"right":case"top-right":case"bottom-right":l=1;break;case"left":case"top-left":case"bottom-left":l=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":h=1;break;case"top":case"top-right":case"top-left":h=0}return{horizontalAlign:l,verticalAlign:h}}function N3(c,l,h,m,w){if(!m&&!w)return;const T=c[h],C=(c[h].x+T.metrics.advance*T.scale)*m;for(let N=l;N<=h;N++)c[N].x-=C,c[N].y+=w}function z3(c,l,h){const{horizontalAlign:m,verticalAlign:w}=a_(h),T=l[0]-c.displaySize[0]*m,C=l[1]-c.displaySize[1]*w;return{image:c,top:C,bottom:C+c.displaySize[1],left:T,right:T+c.displaySize[0]}}function oT(c){var l,h;let m=c.left,w=c.top,T=c.right-m,C=c.bottom-w;const N=(l=c.image.textFitWidth)!==null&&l!==void 0?l:"stretchOrShrink",L=(h=c.image.textFitHeight)!==null&&h!==void 0?h:"stretchOrShrink",j=(c.image.content[2]-c.image.content[0])/(c.image.content[3]-c.image.content[1]);if(L==="proportional"){if(N==="stretchOnly"&&T/C<j||N==="proportional"){const q=Math.ceil(C*j);m*=q/T,T=q}}else if(N==="proportional"&&L==="stretchOnly"&&j!==0&&T/C>j){const q=Math.ceil(T/j);w*=q/C,C=q}return{x1:m,y1:w,x2:m+T,y2:w+C}}function lT(c,l,h,m,w,T){const C=c.image;let N;if(C.content){const Te=C.content,Pe=C.pixelRatio||1;N=[Te[0]/Pe,Te[1]/Pe,C.displaySize[0]-Te[2]/Pe,C.displaySize[1]-Te[3]/Pe]}const L=l.left*T,j=l.right*T;let q,K,ne,ue;h==="width"||h==="both"?(ue=w[0]+L-m[3],K=w[0]+j+m[1]):(ue=w[0]+(L+j-C.displaySize[0])/2,K=ue+C.displaySize[0]);const ge=l.top*T,ye=l.bottom*T;return h==="height"||h==="both"?(q=w[1]+ge-m[0],ne=w[1]+ye+m[2]):(q=w[1]+(ge+ye-C.displaySize[1])/2,ne=q+C.displaySize[1]),{image:C,top:q,right:K,bottom:ne,left:ue,collisionPadding:N}}const Vf=255,Ls=128,yl=Vf*Ls;function uT(c,l){const{expression:h}=l;if(h.kind==="constant")return{kind:"constant",layoutSize:h.evaluate(new Yr(c+1))};if(h.kind==="source")return{kind:"source"};{const{zoomStops:m,interpolationType:w}=h;let T=0;for(;T<m.length&&m[T]<=c;)T++;T=Math.max(0,T-1);let C=T;for(;C<m.length&&m[C]<c+1;)C++;C=Math.min(m.length-1,C);const N=m[T],L=m[C];return h.kind==="composite"?{kind:"composite",minZoom:N,maxZoom:L,interpolationType:w}:{kind:"camera",minZoom:N,maxZoom:L,minSize:h.evaluate(new Yr(N)),maxSize:h.evaluate(new Yr(L)),interpolationType:w}}}function s_(c,l,h){let m="never";const w=c.get(l);return w?m=w:c.get(h)&&(m="always"),m}const R3=gl.VectorTileFeature.types,L3=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Gg(c,l,h,m,w,T,C,N,L,j,q,K,ne){const ue=N?Math.min(yl,Math.round(N[0])):0,ge=N?Math.min(yl,Math.round(N[1])):0;c.emplaceBack(l,h,Math.round(32*m),Math.round(32*w),T,C,(ue<<1)+(L?1:0),ge,16*j,16*q,256*K,256*ne)}function o_(c,l,h){c.emplaceBack(l.x,l.y,h),c.emplaceBack(l.x,l.y,h),c.emplaceBack(l.x,l.y,h),c.emplaceBack(l.x,l.y,h)}function B3(c){for(const l of c.sections)if(Rx(l.text))return!0;return!1}class l_{constructor(l){this.layoutVertexArray=new uh,this.indexArray=new Ca,this.programConfigurations=l,this.segments=new Cr,this.dynamicLayoutVertexArray=new If,this.opacityVertexArray=new ua,this.hasVisibleVertices=!1,this.placedSymbolArray=new Jr}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(l,h,m,w){this.isEmpty()||(m&&(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,f3.members),this.indexBuffer=l.createIndexBuffer(this.indexArray,h),this.dynamicLayoutVertexBuffer=l.createVertexBuffer(this.dynamicLayoutVertexArray,p3.members,!0),this.opacityVertexBuffer=l.createVertexBuffer(this.opacityVertexArray,L3,!0),this.opacityVertexBuffer.itemSize=1),(m||w)&&this.programConfigurations.upload(l))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ft("SymbolBuffers",l_);class u_{constructor(l,h,m){this.layoutVertexArray=new l,this.layoutAttributes=h,this.indexArray=new m,this.segments=new Cr,this.collisionVertexArray=new zs}upload(l){this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=l.createVertexBuffer(this.collisionVertexArray,m3.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ft("CollisionBuffers",u_);class wh{constructor(l){this.collisionBoxArray=l.collisionBoxArray,this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(C=>C.id),this.index=l.index,this.pixelRatio=l.pixelRatio,this.sourceLayerIndex=l.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Vx([]),this.placementViewportMatrix=Vx([]);const h=this.layers[0]._unevaluatedLayout._values;this.textSizeData=uT(this.zoom,h["text-size"]),this.iconSizeData=uT(this.zoom,h["icon-size"]);const m=this.layers[0].layout,w=m.get("symbol-sort-key"),T=m.get("symbol-z-order");this.canOverlap=s_(m,"text-overlap","text-allow-overlap")!=="never"||s_(m,"icon-overlap","icon-allow-overlap")!=="never"||m.get("text-ignore-placement")||m.get("icon-ignore-placement"),this.sortFeaturesByKey=T!=="viewport-y"&&!w.isConstant(),this.sortFeaturesByY=(T==="viewport-y"||T==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,m.get("symbol-placement")==="point"&&(this.writingModes=m.get("text-writing-mode").map(C=>u.ah[C])),this.stateDependentLayerIds=this.layers.filter(C=>C.isStateDependent()).map(C=>C.id),this.sourceID=l.sourceID}createArrays(){this.text=new l_(new Lu(this.layers,this.zoom,l=>/^text/.test(l))),this.icon=new l_(new Lu(this.layers,this.zoom,l=>/^icon/.test(l))),this.glyphOffsetArray=new Qr,this.lineVertexArray=new ni,this.symbolInstances=new Sr,this.textAnchorOffsets=new en}calculateGlyphDependencies(l,h,m,w,T){for(let C=0;C<l.length;C++)if(h[l.charCodeAt(C)]=!0,(m||w)&&T){const N=Ff[l.charAt(C)];N&&(h[N.charCodeAt(0)]=!0)}}populate(l,h,m){const w=this.layers[0],T=w.layout,C=T.get("text-font"),N=T.get("text-field"),L=T.get("icon-image"),j=(N.value.kind!=="constant"||N.value.value instanceof Hn&&!N.value.value.isEmpty()||N.value.value.toString().length>0)&&(C.value.kind!=="constant"||C.value.value.length>0),q=L.value.kind!=="constant"||!!L.value.value||Object.keys(L.parameters).length>0,K=T.get("symbol-sort-key");if(this.features=[],!j&&!q)return;const ne=h.iconDependencies,ue=h.glyphDependencies,ge=h.availableImages,ye=new Yr(this.zoom);for(const{feature:Te,id:Pe,index:We,sourceLayerIndex:Re}of l){const He=w._featureFilter.needGeometry,nt=Ou(Te,He);if(!w._featureFilter.filter(ye,nt,m))continue;let vt,Nt;if(He||(nt.geometry=Bu(Te)),j){const Mt=w.getValueAndResolveTokens("text-field",nt,m,ge),Pt=Hn.factory(Mt),Xt=this.hasRTLText=this.hasRTLText||B3(Pt);(!Xt||Zi.getRTLTextPluginStatus()==="unavailable"||Xt&&Zi.isParsed())&&(vt=v3(Pt,w,nt))}if(q){const Mt=w.getValueAndResolveTokens("icon-image",nt,m,ge);Nt=Mt instanceof Bn?Mt:Bn.fromString(Mt)}if(!vt&&!Nt)continue;const nr=this.sortFeaturesByKey?K.evaluate(nt,{},m):void 0;if(this.features.push({id:Pe,text:vt,icon:Nt,index:We,sourceLayerIndex:Re,geometry:nt.geometry,properties:Te.properties,type:R3[Te.type],sortKey:nr}),Nt&&(ne[Nt.name]=!0),vt){const Mt=C.evaluate(nt,{},m).join(","),Pt=T.get("text-rotation-alignment")!=="viewport"&&T.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(u.ah.vertical)>=0;for(const Xt of vt.sections)if(Xt.image)ne[Xt.image.name]=!0;else{const jt=Ef(vt.toString()),Bt=Xt.fontStack||Mt,ut=ue[Bt]=ue[Bt]||{};this.calculateGlyphDependencies(Xt.text,ut,Pt,this.allowVerticalPlacement,jt)}}}T.get("symbol-placement")==="line"&&(this.features=function(Te){const Pe={},We={},Re=[];let He=0;function nt(Mt){Re.push(Te[Mt]),He++}function vt(Mt,Pt,Xt){const jt=We[Mt];return delete We[Mt],We[Pt]=jt,Re[jt].geometry[0].pop(),Re[jt].geometry[0]=Re[jt].geometry[0].concat(Xt[0]),jt}function Nt(Mt,Pt,Xt){const jt=Pe[Pt];return delete Pe[Pt],Pe[Mt]=jt,Re[jt].geometry[0].shift(),Re[jt].geometry[0]=Xt[0].concat(Re[jt].geometry[0]),jt}function nr(Mt,Pt,Xt){const jt=Xt?Pt[0][Pt[0].length-1]:Pt[0][0];return`${Mt}:${jt.x}:${jt.y}`}for(let Mt=0;Mt<Te.length;Mt++){const Pt=Te[Mt],Xt=Pt.geometry,jt=Pt.text?Pt.text.toString():null;if(!jt){nt(Mt);continue}const Bt=nr(jt,Xt),ut=nr(jt,Xt,!0);if(Bt in We&&ut in Pe&&We[Bt]!==Pe[ut]){const Yt=Nt(Bt,ut,Xt),Zt=vt(Bt,ut,Re[Yt].geometry);delete Pe[Bt],delete We[ut],We[nr(jt,Re[Zt].geometry,!0)]=Zt,Re[Yt].geometry=null}else Bt in We?vt(Bt,ut,Xt):ut in Pe?Nt(Bt,ut,Xt):(nt(Mt),Pe[Bt]=He-1,We[ut]=He-1)}return Re.filter(Mt=>Mt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Te,Pe)=>Te.sortKey-Pe.sortKey)}update(l,h,m){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(l,h,this.layers,m),this.icon.programConfigurations.updatePaintArrays(l,h,this.layers,m))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(l){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(l),this.iconCollisionBox.upload(l)),this.text.upload(l,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(l,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(l,h){const m=this.lineVertexArray.length;if(l.segment!==void 0){let w=l.dist(h[l.segment+1]),T=l.dist(h[l.segment]);const C={};for(let N=l.segment+1;N<h.length;N++)C[N]={x:h[N].x,y:h[N].y,tileUnitDistanceFromAnchor:w},N<h.length-1&&(w+=h[N+1].dist(h[N]));for(let N=l.segment||0;N>=0;N--)C[N]={x:h[N].x,y:h[N].y,tileUnitDistanceFromAnchor:T},N>0&&(T+=h[N-1].dist(h[N]));for(let N=0;N<h.length;N++){const L=C[N];this.lineVertexArray.emplaceBack(L.x,L.y,L.tileUnitDistanceFromAnchor)}}return{lineStartIndex:m,lineLength:this.lineVertexArray.length-m}}addSymbols(l,h,m,w,T,C,N,L,j,q,K,ne){const ue=l.indexArray,ge=l.layoutVertexArray,ye=l.segments.prepareSegment(4*h.length,ge,ue,this.canOverlap?C.sortKey:void 0),Te=this.glyphOffsetArray.length,Pe=ye.vertexLength,We=this.allowVerticalPlacement&&N===u.ah.vertical?Math.PI/2:0,Re=C.text&&C.text.sections;for(let He=0;He<h.length;He++){const{tl:nt,tr:vt,bl:Nt,br:nr,tex:Mt,pixelOffsetTL:Pt,pixelOffsetBR:Xt,minFontScaleX:jt,minFontScaleY:Bt,glyphOffset:ut,isSDF:Yt,sectionIndex:Zt}=h[He],cr=ye.vertexLength,qr=ut[1];Gg(ge,L.x,L.y,nt.x,qr+nt.y,Mt.x,Mt.y,m,Yt,Pt.x,Pt.y,jt,Bt),Gg(ge,L.x,L.y,vt.x,qr+vt.y,Mt.x+Mt.w,Mt.y,m,Yt,Xt.x,Pt.y,jt,Bt),Gg(ge,L.x,L.y,Nt.x,qr+Nt.y,Mt.x,Mt.y+Mt.h,m,Yt,Pt.x,Xt.y,jt,Bt),Gg(ge,L.x,L.y,nr.x,qr+nr.y,Mt.x+Mt.w,Mt.y+Mt.h,m,Yt,Xt.x,Xt.y,jt,Bt),o_(l.dynamicLayoutVertexArray,L,We),ue.emplaceBack(cr,cr+1,cr+2),ue.emplaceBack(cr+1,cr+2,cr+3),ye.vertexLength+=4,ye.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ut[0]),He!==h.length-1&&Zt===h[He+1].sectionIndex||l.programConfigurations.populatePaintArrays(ge.length,C,C.index,{},ne,Re&&Re[Zt])}l.placedSymbolArray.emplaceBack(L.x,L.y,Te,this.glyphOffsetArray.length-Te,Pe,j,q,L.segment,m?m[0]:0,m?m[1]:0,w[0],w[1],N,0,!1,0,K)}_addCollisionDebugVertex(l,h,m,w,T,C){return h.emplaceBack(0,0),l.emplaceBack(m.x,m.y,w,T,Math.round(C.x),Math.round(C.y))}addCollisionDebugVertices(l,h,m,w,T,C,N){const L=T.segments.prepareSegment(4,T.layoutVertexArray,T.indexArray),j=L.vertexLength,q=T.layoutVertexArray,K=T.collisionVertexArray,ne=N.anchorX,ue=N.anchorY;this._addCollisionDebugVertex(q,K,C,ne,ue,new v(l,h)),this._addCollisionDebugVertex(q,K,C,ne,ue,new v(m,h)),this._addCollisionDebugVertex(q,K,C,ne,ue,new v(m,w)),this._addCollisionDebugVertex(q,K,C,ne,ue,new v(l,w)),L.vertexLength+=4;const ge=T.indexArray;ge.emplaceBack(j,j+1),ge.emplaceBack(j+1,j+2),ge.emplaceBack(j+2,j+3),ge.emplaceBack(j+3,j),L.primitiveLength+=4}addDebugCollisionBoxes(l,h,m,w){for(let T=l;T<h;T++){const C=this.collisionBoxArray.get(T);this.addCollisionDebugVertices(C.x1,C.y1,C.x2,C.y2,w?this.textCollisionBox:this.iconCollisionBox,C.anchorPoint,m)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new u_(ca,GE.members,Gn),this.iconCollisionBox=new u_(ca,GE.members,Gn);for(let l=0;l<this.symbolInstances.length;l++){const h=this.symbolInstances.get(l);this.addDebugCollisionBoxes(h.textBoxStartIndex,h.textBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.iconBoxStartIndex,h.iconBoxEndIndex,h,!1),this.addDebugCollisionBoxes(h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h,!1)}}_deserializeCollisionBoxesForSymbol(l,h,m,w,T,C,N,L,j){const q={};for(let K=h;K<m;K++){const ne=l.get(K);q.textBox={x1:ne.x1,y1:ne.y1,x2:ne.x2,y2:ne.y2,anchorPointX:ne.anchorPointX,anchorPointY:ne.anchorPointY},q.textFeatureIndex=ne.featureIndex;break}for(let K=w;K<T;K++){const ne=l.get(K);q.verticalTextBox={x1:ne.x1,y1:ne.y1,x2:ne.x2,y2:ne.y2,anchorPointX:ne.anchorPointX,anchorPointY:ne.anchorPointY},q.verticalTextFeatureIndex=ne.featureIndex;break}for(let K=C;K<N;K++){const ne=l.get(K);q.iconBox={x1:ne.x1,y1:ne.y1,x2:ne.x2,y2:ne.y2,anchorPointX:ne.anchorPointX,anchorPointY:ne.anchorPointY},q.iconFeatureIndex=ne.featureIndex;break}for(let K=L;K<j;K++){const ne=l.get(K);q.verticalIconBox={x1:ne.x1,y1:ne.y1,x2:ne.x2,y2:ne.y2,anchorPointX:ne.anchorPointX,anchorPointY:ne.anchorPointY},q.verticalIconFeatureIndex=ne.featureIndex;break}return q}deserializeCollisionBoxes(l){this.collisionArrays=[];for(let h=0;h<this.symbolInstances.length;h++){const m=this.symbolInstances.get(h);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(l,m.textBoxStartIndex,m.textBoxEndIndex,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m.iconBoxStartIndex,m.iconBoxEndIndex,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(l,h){const m=l.placedSymbolArray.get(h),w=m.vertexStartIndex+4*m.numGlyphs;for(let T=m.vertexStartIndex;T<w;T+=4)l.indexArray.emplaceBack(T,T+1,T+2),l.indexArray.emplaceBack(T+1,T+2,T+3)}getSortedSymbolIndexes(l){if(this.sortedAngle===l&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const h=Math.sin(l),m=Math.cos(l),w=[],T=[],C=[];for(let N=0;N<this.symbolInstances.length;++N){C.push(N);const L=this.symbolInstances.get(N);w.push(0|Math.round(h*L.anchorX+m*L.anchorY)),T.push(L.featureIndex)}return C.sort((N,L)=>w[N]-w[L]||T[L]-T[N]),C}addToSortKeyRanges(l,h){const m=this.sortKeyRanges[this.sortKeyRanges.length-1];m&&m.sortKey===h?m.symbolInstanceEnd=l+1:this.sortKeyRanges.push({sortKey:h,symbolInstanceStart:l,symbolInstanceEnd:l+1})}sortFeatures(l){if(this.sortFeaturesByY&&this.sortedAngle!==l&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(l),this.sortedAngle=l,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const h of this.symbolInstanceIndexes){const m=this.symbolInstances.get(h);this.featureSortOrder.push(m.featureIndex),[m.rightJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.leftJustifiedTextSymbolIndex].forEach((w,T,C)=>{w>=0&&C.indexOf(w)===T&&this.addIndicesForPlacedSymbol(this.text,w)}),m.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,m.verticalPlacedTextSymbolIndex),m.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.placedIconSymbolIndex),m.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let cT,hT;Ft("SymbolBucket",wh,{omit:["layers","collisionBoxArray","features","compareText"]}),wh.MAX_GLYPHS=65535,wh.addDynamicAttributes=o_;var c_={get paint(){return hT=hT||new E({"icon-opacity":new ir($e.paint_symbol["icon-opacity"]),"icon-color":new ir($e.paint_symbol["icon-color"]),"icon-halo-color":new ir($e.paint_symbol["icon-halo-color"]),"icon-halo-width":new ir($e.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ir($e.paint_symbol["icon-halo-blur"]),"icon-translate":new Gt($e.paint_symbol["icon-translate"]),"icon-translate-anchor":new Gt($e.paint_symbol["icon-translate-anchor"]),"text-opacity":new ir($e.paint_symbol["text-opacity"]),"text-color":new ir($e.paint_symbol["text-color"],{runtimeType:tt,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new ir($e.paint_symbol["text-halo-color"]),"text-halo-width":new ir($e.paint_symbol["text-halo-width"]),"text-halo-blur":new ir($e.paint_symbol["text-halo-blur"]),"text-translate":new Gt($e.paint_symbol["text-translate"]),"text-translate-anchor":new Gt($e.paint_symbol["text-translate-anchor"])})},get layout(){return cT=cT||new E({"symbol-placement":new Gt($e.layout_symbol["symbol-placement"]),"symbol-spacing":new Gt($e.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Gt($e.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ir($e.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Gt($e.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Gt($e.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Gt($e.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Gt($e.layout_symbol["icon-ignore-placement"]),"icon-optional":new Gt($e.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Gt($e.layout_symbol["icon-rotation-alignment"]),"icon-size":new ir($e.layout_symbol["icon-size"]),"icon-text-fit":new Gt($e.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Gt($e.layout_symbol["icon-text-fit-padding"]),"icon-image":new ir($e.layout_symbol["icon-image"]),"icon-rotate":new ir($e.layout_symbol["icon-rotate"]),"icon-padding":new ir($e.layout_symbol["icon-padding"]),"icon-keep-upright":new Gt($e.layout_symbol["icon-keep-upright"]),"icon-offset":new ir($e.layout_symbol["icon-offset"]),"icon-anchor":new ir($e.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Gt($e.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Gt($e.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Gt($e.layout_symbol["text-rotation-alignment"]),"text-field":new ir($e.layout_symbol["text-field"]),"text-font":new ir($e.layout_symbol["text-font"]),"text-size":new ir($e.layout_symbol["text-size"]),"text-max-width":new ir($e.layout_symbol["text-max-width"]),"text-line-height":new Gt($e.layout_symbol["text-line-height"]),"text-letter-spacing":new ir($e.layout_symbol["text-letter-spacing"]),"text-justify":new ir($e.layout_symbol["text-justify"]),"text-radial-offset":new ir($e.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Gt($e.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new ir($e.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new ir($e.layout_symbol["text-anchor"]),"text-max-angle":new Gt($e.layout_symbol["text-max-angle"]),"text-writing-mode":new Gt($e.layout_symbol["text-writing-mode"]),"text-rotate":new ir($e.layout_symbol["text-rotate"]),"text-padding":new Gt($e.layout_symbol["text-padding"]),"text-keep-upright":new Gt($e.layout_symbol["text-keep-upright"]),"text-transform":new ir($e.layout_symbol["text-transform"]),"text-offset":new ir($e.layout_symbol["text-offset"]),"text-allow-overlap":new Gt($e.layout_symbol["text-allow-overlap"]),"text-overlap":new Gt($e.layout_symbol["text-overlap"]),"text-ignore-placement":new Gt($e.layout_symbol["text-ignore-placement"]),"text-optional":new Gt($e.layout_symbol["text-optional"])})}};class dT{constructor(l){if(l.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=l.property.overrides?l.property.overrides.runtimeType:at,this.defaultValue=l}evaluate(l){if(l.formattedSection){const h=this.defaultValue.property.overrides;if(h&&h.hasOverride(l.formattedSection))return h.getOverride(l.formattedSection)}return l.feature&&l.featureState?this.defaultValue.evaluate(l.feature,l.featureState):this.defaultValue.property.specification.default}eachChild(l){this.defaultValue.isConstant()||l(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ft("FormatSectionOverride",dT,{omit:["defaultValue"]});class Wg extends f{constructor(l){super(l,c_)}recalculate(l,h){if(super.recalculate(l,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const m=this.layout.get("text-writing-mode");if(m){const w=[];for(const T of m)w.indexOf(T)<0&&w.push(T);this.layout._values["text-writing-mode"]=w}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(l,h,m,w){const T=this.layout.get(l).evaluate(h,{},m,w),C=this._unevaluatedLayout._values[l];return C.isDataDriven()||Zc(C.value)||!T?T:function(N,L){return L.replace(/{([^{}]+)}/g,(j,q)=>N&&q in N?String(N[q]):"")}(h.properties,T)}createBucket(l){return new wh(l)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const l of c_.paint.overridableProperties){if(!Wg.hasPaintOverride(this.layout,l))continue;const h=this.paint.get(l),m=new dT(h),w=new Wc(m,h.property.specification);let T=null;T=h.value.kind==="constant"||h.value.kind==="source"?new tl("source",w):new rl("composite",w,h.value.zoomStops),this.paint._values[l]=new qa(h.property,T,h.parameters)}}_handleOverridablePaintPropertyUpdate(l,h,m){return!(!this.layout||h.isDataDriven()||m.isDataDriven())&&Wg.hasPaintOverride(this.layout,l)}static hasPaintOverride(l,h){const m=l.get("text-field"),w=c_.paint.properties[h];let T=!1;const C=N=>{for(const L of N)if(w.overrides&&w.overrides.hasOverride(L))return void(T=!0)};if(m.value.kind==="constant"&&m.value.value instanceof Hn)C(m.value.value.sections);else if(m.value.kind==="source"){const N=j=>{T||(j instanceof Pi&&Rr(j.value)===Ot?C(j.value.sections):j instanceof Oc?C(j.sections):j.eachChild(N))},L=m.value;L._styleExpression&&N(L._styleExpression.expression)}return T}}let fT;var O3={get paint(){return fT=fT||new E({"background-color":new Gt($e.paint_background["background-color"]),"background-pattern":new oh($e.paint_background["background-pattern"]),"background-opacity":new Gt($e.paint_background["background-opacity"])})}};class F3 extends f{constructor(l){super(l,O3)}}let pT;var j3={get paint(){return pT=pT||new E({"raster-opacity":new Gt($e.paint_raster["raster-opacity"]),"raster-hue-rotate":new Gt($e.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Gt($e.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Gt($e.paint_raster["raster-brightness-max"]),"raster-saturation":new Gt($e.paint_raster["raster-saturation"]),"raster-contrast":new Gt($e.paint_raster["raster-contrast"]),"raster-resampling":new Gt($e.paint_raster["raster-resampling"]),"raster-fade-duration":new Gt($e.paint_raster["raster-fade-duration"])})}};class $3 extends f{constructor(l){super(l,j3)}}class V3 extends f{constructor(l){super(l,{}),this.onAdd=h=>{this.implementation.onAdd&&this.implementation.onAdd(h,h.painter.context.gl)},this.onRemove=h=>{this.implementation.onRemove&&this.implementation.onRemove(h,h.painter.context.gl)},this.implementation=l}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class U3{constructor(l){this._methodToThrottle=l,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const h_=63710088e-1;class xl{constructor(l,h){if(isNaN(l)||isNaN(h))throw new Error(`Invalid LngLat object: (${l}, ${h})`);if(this.lng=+l,this.lat=+h,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new xl(U(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(l){const h=Math.PI/180,m=this.lat*h,w=l.lat*h,T=Math.sin(m)*Math.sin(w)+Math.cos(m)*Math.cos(w)*Math.cos((l.lng-this.lng)*h);return h_*Math.acos(Math.min(T,1))}static convert(l){if(l instanceof xl)return l;if(Array.isArray(l)&&(l.length===2||l.length===3))return new xl(Number(l[0]),Number(l[1]));if(!Array.isArray(l)&&typeof l=="object"&&l!==null)return new xl(Number("lng"in l?l.lng:l.lon),Number(l.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const mT=2*Math.PI*h_;function gT(c){return mT*Math.cos(c*Math.PI/180)}function vT(c){return(180+c)/360}function yT(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function xT(c,l){return c/gT(l)}function d_(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}class Uf{constructor(l,h,m=0){this.x=+l,this.y=+h,this.z=+m}static fromLngLat(l,h=0){const m=xl.convert(l);return new Uf(vT(m.lng),yT(m.lat),xT(h,m.lat))}toLngLat(){return new xl(360*this.x-180,d_(this.y))}toAltitude(){return this.z*gT(d_(this.y))}meterInMercatorCoordinateUnits(){return 1/mT*(l=d_(this.y),1/Math.cos(l*Math.PI/180));var l}}function _T(c,l,h){var m=2*Math.PI*6378137/256/Math.pow(2,h);return[c*m-2*Math.PI*6378137/2,l*m-2*Math.PI*6378137/2]}class f_{constructor(l,h,m){if(!function(w,T,C){return!(w<0||w>25||C<0||C>=Math.pow(2,w)||T<0||T>=Math.pow(2,w))}(l,h,m))throw new Error(`x=${h}, y=${m}, z=${l} outside of bounds. 0<=x<${Math.pow(2,l)}, 0<=y<${Math.pow(2,l)} 0<=z<=25 `);this.z=l,this.x=h,this.y=m,this.key=qf(0,l,l,h,m)}equals(l){return this.z===l.z&&this.x===l.x&&this.y===l.y}url(l,h,m){const w=(C=this.y,N=this.z,L=_T(256*(T=this.x),256*(C=Math.pow(2,N)-C-1),N),j=_T(256*(T+1),256*(C+1),N),L[0]+","+L[1]+","+j[0]+","+j[1]);var T,C,N,L,j;const q=function(K,ne,ue){let ge,ye="";for(let Te=K;Te>0;Te--)ge=1<<Te-1,ye+=(ne&ge?1:0)+(ue&ge?2:0);return ye}(this.z,this.x,this.y);return l[(this.x+this.y)%l.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(m==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,h>1?"@2x":"").replace(/{quadkey}/g,q).replace(/{bbox-epsg-3857}/g,w)}isChildOf(l){const h=this.z-l.z;return h>0&&l.x===this.x>>h&&l.y===this.y>>h}getTilePoint(l){const h=Math.pow(2,this.z);return new v((l.x*h-this.x)*In,(l.y*h-this.y)*In)}toString(){return`${this.z}/${this.x}/${this.y}`}}class wT{constructor(l,h){this.wrap=l,this.canonical=h,this.key=qf(l,h.z,h.z,h.x,h.y)}}class Pa{constructor(l,h,m,w,T){if(l<m)throw new Error(`overscaledZ should be >= z; overscaledZ = ${l}; z = ${m}`);this.overscaledZ=l,this.wrap=h,this.canonical=new f_(m,+w,+T),this.key=qf(h,l,m,w,T)}clone(){return new Pa(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(l){return this.overscaledZ===l.overscaledZ&&this.wrap===l.wrap&&this.canonical.equals(l.canonical)}scaledTo(l){if(l>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${l}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-l;return l>this.canonical.z?new Pa(l,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Pa(l,this.wrap,l,this.canonical.x>>h,this.canonical.y>>h)}calculateScaledKey(l,h){if(l>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${l}; overscaledZ = ${this.overscaledZ}`);const m=this.canonical.z-l;return l>this.canonical.z?qf(this.wrap*+h,l,this.canonical.z,this.canonical.x,this.canonical.y):qf(this.wrap*+h,l,l,this.canonical.x>>m,this.canonical.y>>m)}isChildOf(l){if(l.wrap!==this.wrap)return!1;const h=this.canonical.z-l.canonical.z;return l.overscaledZ===0||l.overscaledZ<this.overscaledZ&&l.canonical.x===this.canonical.x>>h&&l.canonical.y===this.canonical.y>>h}children(l){if(this.overscaledZ>=l)return[new Pa(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const h=this.canonical.z+1,m=2*this.canonical.x,w=2*this.canonical.y;return[new Pa(h,this.wrap,h,m,w),new Pa(h,this.wrap,h,m+1,w),new Pa(h,this.wrap,h,m,w+1),new Pa(h,this.wrap,h,m+1,w+1)]}isLessThan(l){return this.wrap<l.wrap||!(this.wrap>l.wrap)&&(this.overscaledZ<l.overscaledZ||!(this.overscaledZ>l.overscaledZ)&&(this.canonical.x<l.canonical.x||!(this.canonical.x>l.canonical.x)&&this.canonical.y<l.canonical.y))}wrapped(){return new Pa(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(l){return new Pa(this.overscaledZ,l,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new wT(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(l){return this.canonical.getTilePoint(new Uf(l.x-this.wrap,l.y))}}function qf(c,l,h,m,w){(c*=2)<0&&(c=-1*c-1);const T=1<<h;return(T*T*c+T*w+m).toString(36)+h.toString(36)+l.toString(36)}Ft("CanonicalTileID",f_),Ft("OverscaledTileID",Pa,{omit:["posMatrix"]});class bT{constructor(l,h,m,w=1,T=1,C=1,N=0){if(this.uid=l,h.height!==h.width)throw new RangeError("DEM tiles must be square");if(m&&!["mapbox","terrarium","custom"].includes(m))return void te(`"${m}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=h.height;const L=this.dim=h.height-2;switch(this.data=new Uint32Array(h.data.buffer),m){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=w,this.greenFactor=T,this.blueFactor=C,this.baseShift=N;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let j=0;j<L;j++)this.data[this._idx(-1,j)]=this.data[this._idx(0,j)],this.data[this._idx(L,j)]=this.data[this._idx(L-1,j)],this.data[this._idx(j,-1)]=this.data[this._idx(j,0)],this.data[this._idx(j,L)]=this.data[this._idx(j,L-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(L,-1)]=this.data[this._idx(L-1,0)],this.data[this._idx(-1,L)]=this.data[this._idx(0,L-1)],this.data[this._idx(L,L)]=this.data[this._idx(L-1,L-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let j=0;j<L;j++)for(let q=0;q<L;q++){const K=this.get(j,q);K>this.max&&(this.max=K),K<this.min&&(this.min=K)}}get(l,h){const m=new Uint8Array(this.data.buffer),w=4*this._idx(l,h);return this.unpack(m[w],m[w+1],m[w+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(l,h){if(l<-1||l>=this.dim+1||h<-1||h>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(h+1)*this.stride+(l+1)}unpack(l,h,m){return l*this.redFactor+h*this.greenFactor+m*this.blueFactor-this.baseShift}getPixels(){return new ka({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(l,h,m){if(this.dim!==l.dim)throw new Error("dem dimension mismatch");let w=h*this.dim,T=h*this.dim+this.dim,C=m*this.dim,N=m*this.dim+this.dim;switch(h){case-1:w=T-1;break;case 1:T=w+1}switch(m){case-1:C=N-1;break;case 1:N=C+1}const L=-h*this.dim,j=-m*this.dim;for(let q=C;q<N;q++)for(let K=w;K<T;K++)this.data[this._idx(K,q)]=l.data[this._idx(K+L,q+j)]}}Ft("DEMData",bT);class ST{constructor(l){this._stringToNumber={},this._numberToString=[];for(let h=0;h<l.length;h++){const m=l[h];this._stringToNumber[m]=h,this._numberToString[h]=m}}encode(l){return this._stringToNumber[l]}decode(l){if(l>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${l} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[l]}}class ET{constructor(l,h,m,w,T){this.type="Feature",this._vectorTileFeature=l,l._z=h,l._x=m,l._y=w,this.properties=l.properties,this.id=T}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(l){this._geometry=l}toJSON(){const l={geometry:this.geometry};for(const h in this)h!=="_geometry"&&h!=="_vectorTileFeature"&&(l[h]=this[h]);return l}}class TT{constructor(l,h){this.tileID=l,this.x=l.canonical.x,this.y=l.canonical.y,this.z=l.canonical.z,this.grid=new al(In,16,0),this.grid3D=new al(In,16,0),this.featureIndexArray=new gi,this.promoteId=h}insert(l,h,m,w,T,C){const N=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(m,w,T);const L=C?this.grid3D:this.grid;for(let j=0;j<h.length;j++){const q=h[j],K=[1/0,1/0,-1/0,-1/0];for(let ne=0;ne<q.length;ne++){const ue=q[ne];K[0]=Math.min(K[0],ue.x),K[1]=Math.min(K[1],ue.y),K[2]=Math.max(K[2],ue.x),K[3]=Math.max(K[3],ue.y)}K[0]<In&&K[1]<In&&K[2]>=0&&K[3]>=0&&L.insert(N,K[0],K[1],K[2],K[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new gl.VectorTile(new t_(this.rawTileData)).layers,this.sourceLayerCoder=new ST(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(l,h,m,w){this.loadVTLayers();const T=l.params||{},C=In/l.tileSize/l.scale,N=uf(T.filter),L=l.queryGeometry,j=l.queryPadding*C,q=kT(L),K=this.grid.query(q.minX-j,q.minY-j,q.maxX+j,q.maxY+j),ne=kT(l.cameraQueryGeometry),ue=this.grid3D.query(ne.minX-j,ne.minY-j,ne.maxX+j,ne.maxY+j,(Te,Pe,We,Re)=>function(He,nt,vt,Nt,nr){for(const Pt of He)if(nt<=Pt.x&&vt<=Pt.y&&Nt>=Pt.x&&nr>=Pt.y)return!0;const Mt=[new v(nt,vt),new v(nt,nr),new v(Nt,nr),new v(Nt,vt)];if(He.length>2){for(const Pt of Mt)if(ph(He,Pt))return!0}for(let Pt=0;Pt<He.length-1;Pt++)if(SB(He[Pt],He[Pt+1],Mt))return!0;return!1}(l.cameraQueryGeometry,Te-j,Pe-j,We+j,Re+j));for(const Te of ue)K.push(Te);K.sort(q3);const ge={};let ye;for(let Te=0;Te<K.length;Te++){const Pe=K[Te];if(Pe===ye)continue;ye=Pe;const We=this.featureIndexArray.get(Pe);let Re=null;this.loadMatchingFeature(ge,We.bucketIndex,We.sourceLayerIndex,We.featureIndex,N,T.layers,T.availableImages,h,m,w,(He,nt,vt)=>(Re||(Re=Bu(He)),nt.queryIntersectsFeature(L,He,vt,Re,this.z,l.transform,C,l.pixelPosMatrix)))}return ge}loadMatchingFeature(l,h,m,w,T,C,N,L,j,q,K){const ne=this.bucketLayerIDs[h];if(C&&!function(Te,Pe){for(let We=0;We<Te.length;We++)if(Pe.indexOf(Te[We])>=0)return!0;return!1}(C,ne))return;const ue=this.sourceLayerCoder.decode(m),ge=this.vtLayers[ue].feature(w);if(T.needGeometry){const Te=Ou(ge,!0);if(!T.filter(new Yr(this.tileID.overscaledZ),Te,this.tileID.canonical))return}else if(!T.filter(new Yr(this.tileID.overscaledZ),ge))return;const ye=this.getId(ge,ue);for(let Te=0;Te<ne.length;Te++){const Pe=ne[Te];if(C&&C.indexOf(Pe)<0)continue;const We=L[Pe];if(!We)continue;let Re={};ye&&q&&(Re=q.getState(We.sourceLayer||"_geojsonTileLayer",ye));const He=$({},j[Pe]);He.paint=CT(He.paint,We.paint,ge,Re,N),He.layout=CT(He.layout,We.layout,ge,Re,N);const nt=!K||K(ge,We,Re);if(!nt)continue;const vt=new ET(ge,this.z,this.x,this.y,ye);vt.layer=He;let Nt=l[Pe];Nt===void 0&&(Nt=l[Pe]=[]),Nt.push({featureIndex:w,feature:vt,intersectionZ:nt})}}lookupSymbolFeatures(l,h,m,w,T,C,N,L){const j={};this.loadVTLayers();const q=uf(T);for(const K of l)this.loadMatchingFeature(j,m,w,K,q,C,N,L,h);return j}hasLayer(l){for(const h of this.bucketLayerIDs)for(const m of h)if(l===m)return!0;return!1}getId(l,h){let m=l.id;return this.promoteId&&(m=l.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[h]],typeof m=="boolean"&&(m=Number(m))),m}}function CT(c,l,h,m,w){return Z(c,(T,C)=>{const N=l instanceof Nu?l.get(C):null;return N&&N.evaluate?N.evaluate(h,m,w):N})}function kT(c){let l=1/0,h=1/0,m=-1/0,w=-1/0;for(const T of c)l=Math.min(l,T.x),h=Math.min(h,T.y),m=Math.max(m,T.x),w=Math.max(w,T.y);return{minX:l,minY:h,maxX:m,maxY:w}}function q3(c,l){return l-c}function PT(c,l,h,m,w){const T=[];for(let C=0;C<c.length;C++){const N=c[C];let L;for(let j=0;j<N.length-1;j++){let q=N[j],K=N[j+1];q.x<l&&K.x<l||(q.x<l?q=new v(l,q.y+(l-q.x)/(K.x-q.x)*(K.y-q.y))._round():K.x<l&&(K=new v(l,q.y+(l-q.x)/(K.x-q.x)*(K.y-q.y))._round()),q.y<h&&K.y<h||(q.y<h?q=new v(q.x+(h-q.y)/(K.y-q.y)*(K.x-q.x),h)._round():K.y<h&&(K=new v(q.x+(h-q.y)/(K.y-q.y)*(K.x-q.x),h)._round()),q.x>=m&&K.x>=m||(q.x>=m?q=new v(m,q.y+(m-q.x)/(K.x-q.x)*(K.y-q.y))._round():K.x>=m&&(K=new v(m,q.y+(m-q.x)/(K.x-q.x)*(K.y-q.y))._round()),q.y>=w&&K.y>=w||(q.y>=w?q=new v(q.x+(w-q.y)/(K.y-q.y)*(K.x-q.x),w)._round():K.y>=w&&(K=new v(q.x+(w-q.y)/(K.y-q.y)*(K.x-q.x),w)._round()),L&&q.equals(L[L.length-1])||(L=[q],T.push(L)),L.push(K)))))}}return T}Ft("FeatureIndex",TT,{omit:["rawTileData","sourceLayerCoder"]});class _l extends v{constructor(l,h,m,w){super(l,h),this.angle=m,w!==void 0&&(this.segment=w)}clone(){return new _l(this.x,this.y,this.angle,this.segment)}}function IT(c,l,h,m,w){if(l.segment===void 0||h===0)return!0;let T=l,C=l.segment+1,N=0;for(;N>-h/2;){if(C--,C<0)return!1;N-=c[C].dist(T),T=c[C]}N+=c[C].dist(c[C+1]),C++;const L=[];let j=0;for(;N<h/2;){const q=c[C],K=c[C+1];if(!K)return!1;let ne=c[C-1].angleTo(q)-q.angleTo(K);for(ne=Math.abs((ne+3*Math.PI)%(2*Math.PI)-Math.PI),L.push({distance:N,angleDelta:ne}),j+=ne;N-L[0].distance>m;)j-=L.shift().angleDelta;if(j>w)return!1;C++,N+=q.dist(K)}return!0}function AT(c){let l=0;for(let h=0;h<c.length-1;h++)l+=c[h].dist(c[h+1]);return l}function MT(c,l,h){return c?.6*l*h:0}function DT(c,l){return Math.max(c?c.right-c.left:0,l?l.right-l.left:0)}function H3(c,l,h,m,w,T){const C=MT(h,w,T),N=DT(h,m)*T;let L=0;const j=AT(c)/2;for(let q=0;q<c.length-1;q++){const K=c[q],ne=c[q+1],ue=K.dist(ne);if(L+ue>j){const ge=(j-L)/ue,ye=Ii.number(K.x,ne.x,ge),Te=Ii.number(K.y,ne.y,ge),Pe=new _l(ye,Te,ne.angleTo(K),q);return Pe._round(),!C||IT(c,Pe,N,C,l)?Pe:void 0}L+=ue}}function G3(c,l,h,m,w,T,C,N,L){const j=MT(m,T,C),q=DT(m,w),K=q*C,ne=c[0].x===0||c[0].x===L||c[0].y===0||c[0].y===L;return l-K<l/4&&(l=K+l/4),NT(c,ne?l/2*N%l:(q/2+2*T)*C*N%l,l,j,h,K,ne,!1,L)}function NT(c,l,h,m,w,T,C,N,L){const j=T/2,q=AT(c);let K=0,ne=l-h,ue=[];for(let ge=0;ge<c.length-1;ge++){const ye=c[ge],Te=c[ge+1],Pe=ye.dist(Te),We=Te.angleTo(ye);for(;ne+h<K+Pe;){ne+=h;const Re=(ne-K)/Pe,He=Ii.number(ye.x,Te.x,Re),nt=Ii.number(ye.y,Te.y,Re);if(He>=0&&He<L&&nt>=0&&nt<L&&ne-j>=0&&ne+j<=q){const vt=new _l(He,nt,We,ge);vt._round(),m&&!IT(c,vt,T,m,w)||ue.push(vt)}}K+=Pe}return N||ue.length||C||(ue=NT(c,K/2,h,m,w,T,C,!0,L)),ue}Ft("Anchor",_l);const bh=Ki;function zT(c,l,h,m){const w=[],T=c.image,C=T.pixelRatio,N=T.paddedRect.w-2*bh,L=T.paddedRect.h-2*bh;let j={x1:c.left,y1:c.top,x2:c.right,y2:c.bottom};const q=T.stretchX||[[0,N]],K=T.stretchY||[[0,L]],ne=(ut,Yt)=>ut+Yt[1]-Yt[0],ue=q.reduce(ne,0),ge=K.reduce(ne,0),ye=N-ue,Te=L-ge;let Pe=0,We=ue,Re=0,He=ge,nt=0,vt=ye,Nt=0,nr=Te;if(T.content&&m){const ut=T.content,Yt=ut[2]-ut[0],Zt=ut[3]-ut[1];(T.textFitWidth||T.textFitHeight)&&(j=oT(c)),Pe=Zg(q,0,ut[0]),Re=Zg(K,0,ut[1]),We=Zg(q,ut[0],ut[2]),He=Zg(K,ut[1],ut[3]),nt=ut[0]-Pe,Nt=ut[1]-Re,vt=Yt-We,nr=Zt-He}const Mt=j.x1,Pt=j.y1,Xt=j.x2-Mt,jt=j.y2-Pt,Bt=(ut,Yt,Zt,cr)=>{const qr=Xg(ut.stretch-Pe,We,Xt,Mt),Ur=Kg(ut.fixed-nt,vt,ut.stretch,ue),On=Xg(Yt.stretch-Re,He,jt,Pt),Ga=Kg(Yt.fixed-Nt,nr,Yt.stretch,ge),oi=Xg(Zt.stretch-Pe,We,Xt,Mt),Fn=Kg(Zt.fixed-nt,vt,Zt.stretch,ue),Ni=Xg(cr.stretch-Re,He,jt,Pt),zi=Kg(cr.fixed-Nt,nr,cr.stretch,ge),Ri=new v(qr,On),yn=new v(oi,On),jn=new v(oi,Ni),yi=new v(qr,Ni),li=new v(Ur/C,Ga/C),Li=new v(Fn/C,zi/C),ui=l*Math.PI/180;if(ui){const Nr=Math.sin(ui),Xr=Math.cos(ui),tn=[Xr,-Nr,Nr,Xr];Ri._matMult(tn),yn._matMult(tn),yi._matMult(tn),jn._matMult(tn)}const Ia=ut.stretch+ut.fixed,Yi=Yt.stretch+Yt.fixed;return{tl:Ri,tr:yn,bl:yi,br:jn,tex:{x:T.paddedRect.x+bh+Ia,y:T.paddedRect.y+bh+Yi,w:Zt.stretch+Zt.fixed-Ia,h:cr.stretch+cr.fixed-Yi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:li,pixelOffsetBR:Li,minFontScaleX:vt/C/Xt,minFontScaleY:nr/C/jt,isSDF:h}};if(m&&(T.stretchX||T.stretchY)){const ut=RT(q,ye,ue),Yt=RT(K,Te,ge);for(let Zt=0;Zt<ut.length-1;Zt++){const cr=ut[Zt],qr=ut[Zt+1];for(let Ur=0;Ur<Yt.length-1;Ur++)w.push(Bt(cr,Yt[Ur],qr,Yt[Ur+1]))}}else w.push(Bt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:N+1},{fixed:0,stretch:L+1}));return w}function Zg(c,l,h){let m=0;for(const w of c)m+=Math.max(l,Math.min(h,w[1]))-Math.max(l,Math.min(h,w[0]));return m}function RT(c,l,h){const m=[{fixed:-bh,stretch:0}];for(const[w,T]of c){const C=m[m.length-1];m.push({fixed:w-C.stretch,stretch:C.stretch}),m.push({fixed:w-C.stretch,stretch:C.stretch+(T-w)})}return m.push({fixed:l+bh,stretch:h}),m}function Xg(c,l,h,m){return c/l*h+m}function Kg(c,l,h,m){return c-l*h/m}class Yg{constructor(l,h,m,w,T,C,N,L,j,q){var K;if(this.boxStartIndex=l.length,j){let ne=C.top,ue=C.bottom;const ge=C.collisionPadding;ge&&(ne-=ge[1],ue+=ge[3]);let ye=ue-ne;ye>0&&(ye=Math.max(10,ye),this.circleDiameter=ye)}else{const ne=!((K=C.image)===null||K===void 0)&&K.content&&(C.image.textFitWidth||C.image.textFitHeight)?oT(C):{x1:C.left,y1:C.top,x2:C.right,y2:C.bottom};ne.y1=ne.y1*N-L[0],ne.y2=ne.y2*N+L[2],ne.x1=ne.x1*N-L[3],ne.x2=ne.x2*N+L[1];const ue=C.collisionPadding;if(ue&&(ne.x1-=ue[0]*N,ne.y1-=ue[1]*N,ne.x2+=ue[2]*N,ne.y2+=ue[3]*N),q){const ge=new v(ne.x1,ne.y1),ye=new v(ne.x2,ne.y1),Te=new v(ne.x1,ne.y2),Pe=new v(ne.x2,ne.y2),We=q*Math.PI/180;ge._rotate(We),ye._rotate(We),Te._rotate(We),Pe._rotate(We),ne.x1=Math.min(ge.x,ye.x,Te.x,Pe.x),ne.x2=Math.max(ge.x,ye.x,Te.x,Pe.x),ne.y1=Math.min(ge.y,ye.y,Te.y,Pe.y),ne.y2=Math.max(ge.y,ye.y,Te.y,Pe.y)}l.emplaceBack(h.x,h.y,ne.x1,ne.y1,ne.x2,ne.y2,m,w,T)}this.boxEndIndex=l.length}}class W3{constructor(l=[],h=(m,w)=>m<w?-1:m>w?1:0){if(this.data=l,this.length=this.data.length,this.compare=h,this.length>0)for(let m=(this.length>>1)-1;m>=0;m--)this._down(m)}push(l){this.data.push(l),this._up(this.length++)}pop(){if(this.length===0)return;const l=this.data[0],h=this.data.pop();return--this.length>0&&(this.data[0]=h,this._down(0)),l}peek(){return this.data[0]}_up(l){const{data:h,compare:m}=this,w=h[l];for(;l>0;){const T=l-1>>1,C=h[T];if(m(w,C)>=0)break;h[l]=C,l=T}h[l]=w}_down(l){const{data:h,compare:m}=this,w=this.length>>1,T=h[l];for(;l<w;){let C=1+(l<<1);const N=C+1;if(N<this.length&&m(h[N],h[C])<0&&(C=N),m(h[C],T)>=0)break;h[l]=h[C],l=C}h[l]=T}}function Z3(c,l=1,h=!1){let m=1/0,w=1/0,T=-1/0,C=-1/0;const N=c[0];for(let ue=0;ue<N.length;ue++){const ge=N[ue];(!ue||ge.x<m)&&(m=ge.x),(!ue||ge.y<w)&&(w=ge.y),(!ue||ge.x>T)&&(T=ge.x),(!ue||ge.y>C)&&(C=ge.y)}const L=Math.min(T-m,C-w);let j=L/2;const q=new W3([],X3);if(L===0)return new v(m,w);for(let ue=m;ue<T;ue+=L)for(let ge=w;ge<C;ge+=L)q.push(new Sh(ue+j,ge+j,j,c));let K=function(ue){let ge=0,ye=0,Te=0;const Pe=ue[0];for(let We=0,Re=Pe.length,He=Re-1;We<Re;He=We++){const nt=Pe[We],vt=Pe[He],Nt=nt.x*vt.y-vt.x*nt.y;ye+=(nt.x+vt.x)*Nt,Te+=(nt.y+vt.y)*Nt,ge+=3*Nt}return new Sh(ye/ge,Te/ge,0,ue)}(c),ne=q.length;for(;q.length;){const ue=q.pop();(ue.d>K.d||!K.d)&&(K=ue,h&&console.log("found best %d after %d probes",Math.round(1e4*ue.d)/1e4,ne)),ue.max-K.d<=l||(j=ue.h/2,q.push(new Sh(ue.p.x-j,ue.p.y-j,j,c)),q.push(new Sh(ue.p.x+j,ue.p.y-j,j,c)),q.push(new Sh(ue.p.x-j,ue.p.y+j,j,c)),q.push(new Sh(ue.p.x+j,ue.p.y+j,j,c)),ne+=4)}return h&&(console.log(`num probes: ${ne}`),console.log(`best distance: ${K.d}`)),K.p}function X3(c,l){return l.max-c.max}function Sh(c,l,h,m){this.p=new v(c,l),this.h=h,this.d=function(w,T){let C=!1,N=1/0;for(let L=0;L<T.length;L++){const j=T[L];for(let q=0,K=j.length,ne=K-1;q<K;ne=q++){const ue=j[q],ge=j[ne];ue.y>w.y!=ge.y>w.y&&w.x<(ge.x-ue.x)*(w.y-ue.y)/(ge.y-ue.y)+ue.x&&(C=!C),N=Math.min(N,yE(w,ue,ge))}}return(C?1:-1)*Math.sqrt(N)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}var si;u.aq=void 0,(si=u.aq||(u.aq={}))[si.center=1]="center",si[si.left=2]="left",si[si.right=3]="right",si[si.top=4]="top",si[si.bottom=5]="bottom",si[si["top-left"]=6]="top-left",si[si["top-right"]=7]="top-right",si[si["bottom-left"]=8]="bottom-left",si[si["bottom-right"]=9]="bottom-right";const wl=7,p_=Number.POSITIVE_INFINITY;function LT(c,l){return l[1]!==p_?function(h,m,w){let T=0,C=0;switch(m=Math.abs(m),w=Math.abs(w),h){case"top-right":case"top-left":case"top":C=w-wl;break;case"bottom-right":case"bottom-left":case"bottom":C=-w+wl}switch(h){case"top-right":case"bottom-right":case"right":T=-m;break;case"top-left":case"bottom-left":case"left":T=m}return[T,C]}(c,l[0],l[1]):function(h,m){let w=0,T=0;m<0&&(m=0);const C=m/Math.SQRT2;switch(h){case"top-right":case"top-left":T=C-wl;break;case"bottom-right":case"bottom-left":T=-C+wl;break;case"bottom":T=-m+wl;break;case"top":T=m-wl}switch(h){case"top-right":case"bottom-right":w=-C;break;case"top-left":case"bottom-left":w=C;break;case"left":w=m;break;case"right":w=-m}return[w,T]}(c,l[0])}function BT(c,l,h){var m;const w=c.layout,T=(m=w.get("text-variable-anchor-offset"))===null||m===void 0?void 0:m.evaluate(l,{},h);if(T){const N=T.values,L=[];for(let j=0;j<N.length;j+=2){const q=L[j]=N[j],K=N[j+1].map(ne=>ne*zn);q.startsWith("top")?K[1]-=wl:q.startsWith("bottom")&&(K[1]+=wl),L[j+1]=K}return new Nn(L)}const C=w.get("text-variable-anchor");if(C){let N;N=c._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[w.get("text-radial-offset").evaluate(l,{},h)*zn,p_]:w.get("text-offset").evaluate(l,{},h).map(j=>j*zn);const L=[];for(const j of C)L.push(j,LT(j,N));return new Nn(L)}return null}function m_(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function K3(c,l,h,m,w,T,C,N,L,j,q){let K=T.textMaxSize.evaluate(l,{});K===void 0&&(K=C);const ne=c.layers[0].layout,ue=ne.get("icon-offset").evaluate(l,{},q),ge=FT(h.horizontal),ye=C/24,Te=c.tilePixelRatio*ye,Pe=c.tilePixelRatio*K/24,We=c.tilePixelRatio*N,Re=c.tilePixelRatio*ne.get("symbol-spacing"),He=ne.get("text-padding")*c.tilePixelRatio,nt=function(ut,Yt,Zt,cr=1){const qr=ut.get("icon-padding").evaluate(Yt,{},Zt),Ur=qr&&qr.values;return[Ur[0]*cr,Ur[1]*cr,Ur[2]*cr,Ur[3]*cr]}(ne,l,q,c.tilePixelRatio),vt=ne.get("text-max-angle")/180*Math.PI,Nt=ne.get("text-rotation-alignment")!=="viewport"&&ne.get("symbol-placement")!=="point",nr=ne.get("icon-rotation-alignment")==="map"&&ne.get("symbol-placement")!=="point",Mt=ne.get("symbol-placement"),Pt=Re/2,Xt=ne.get("icon-text-fit");let jt;m&&Xt!=="none"&&(c.allowVerticalPlacement&&h.vertical&&(jt=lT(m,h.vertical,Xt,ne.get("icon-text-fit-padding"),ue,ye)),ge&&(m=lT(m,ge,Xt,ne.get("icon-text-fit-padding"),ue,ye)));const Bt=(ut,Yt)=>{Yt.x<0||Yt.x>=In||Yt.y<0||Yt.y>=In||function(Zt,cr,qr,Ur,On,Ga,oi,Fn,Ni,zi,Ri,yn,jn,yi,li,Li,ui,Ia,Yi,Nr,Xr,tn,ha,hn,Eh){const Bs=Zt.addToLineVertexArray(cr,qr);let Os,Wa,Aa,Wn,yo=0,Wf=0,UT=0,qT=0,S_=-1,E_=-1;const xo={};let HT=ch("");if(Zt.allowVerticalPlacement&&Ur.vertical){const xi=Fn.layout.get("text-rotate").evaluate(Xr,{},hn)+90;Aa=new Yg(Ni,cr,zi,Ri,yn,Ur.vertical,jn,yi,li,xi),oi&&(Wn=new Yg(Ni,cr,zi,Ri,yn,oi,ui,Ia,li,xi))}if(On){const xi=Fn.layout.get("icon-rotate").evaluate(Xr,{}),Ma=Fn.layout.get("icon-text-fit")!=="none",ju=zT(On,xi,ha,Ma),ps=oi?zT(oi,xi,ha,Ma):void 0;Wa=new Yg(Ni,cr,zi,Ri,yn,On,ui,Ia,!1,xi),yo=4*ju.length;const $u=Zt.iconSizeData;let Fs=null;$u.kind==="source"?(Fs=[Ls*Fn.layout.get("icon-size").evaluate(Xr,{})],Fs[0]>yl&&te(`${Zt.layerIds[0]}: Value for "icon-size" is >= ${Vf}. Reduce your "icon-size".`)):$u.kind==="composite"&&(Fs=[Ls*tn.compositeIconSizes[0].evaluate(Xr,{},hn),Ls*tn.compositeIconSizes[1].evaluate(Xr,{},hn)],(Fs[0]>yl||Fs[1]>yl)&&te(`${Zt.layerIds[0]}: Value for "icon-size" is >= ${Vf}. Reduce your "icon-size".`)),Zt.addSymbols(Zt.icon,ju,Fs,Nr,Yi,Xr,u.ah.none,cr,Bs.lineStartIndex,Bs.lineLength,-1,hn),S_=Zt.icon.placedSymbolArray.length-1,ps&&(Wf=4*ps.length,Zt.addSymbols(Zt.icon,ps,Fs,Nr,Yi,Xr,u.ah.vertical,cr,Bs.lineStartIndex,Bs.lineLength,-1,hn),E_=Zt.icon.placedSymbolArray.length-1)}const GT=Object.keys(Ur.horizontal);for(const xi of GT){const Ma=Ur.horizontal[xi];if(!Os){HT=ch(Ma.text);const ps=Fn.layout.get("text-rotate").evaluate(Xr,{},hn);Os=new Yg(Ni,cr,zi,Ri,yn,Ma,jn,yi,li,ps)}const ju=Ma.positionedLines.length===1;if(UT+=OT(Zt,cr,Ma,Ga,Fn,li,Xr,Li,Bs,Ur.vertical?u.ah.horizontal:u.ah.horizontalOnly,ju?GT:[xi],xo,S_,tn,hn),ju)break}Ur.vertical&&(qT+=OT(Zt,cr,Ur.vertical,Ga,Fn,li,Xr,Li,Bs,u.ah.vertical,["vertical"],xo,E_,tn,hn));const Q3=Os?Os.boxStartIndex:Zt.collisionBoxArray.length,e5=Os?Os.boxEndIndex:Zt.collisionBoxArray.length,t5=Aa?Aa.boxStartIndex:Zt.collisionBoxArray.length,r5=Aa?Aa.boxEndIndex:Zt.collisionBoxArray.length,n5=Wa?Wa.boxStartIndex:Zt.collisionBoxArray.length,i5=Wa?Wa.boxEndIndex:Zt.collisionBoxArray.length,a5=Wn?Wn.boxStartIndex:Zt.collisionBoxArray.length,s5=Wn?Wn.boxEndIndex:Zt.collisionBoxArray.length;let fs=-1;const Qg=(xi,Ma)=>xi&&xi.circleDiameter?Math.max(xi.circleDiameter,Ma):Ma;fs=Qg(Os,fs),fs=Qg(Aa,fs),fs=Qg(Wa,fs),fs=Qg(Wn,fs);const WT=fs>-1?1:0;WT&&(fs*=Eh/zn),Zt.glyphOffsetArray.length>=wh.MAX_GLYPHS&&te("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Xr.sortKey!==void 0&&Zt.addToSortKeyRanges(Zt.symbolInstances.length,Xr.sortKey);const o5=BT(Fn,Xr,hn),[l5,u5]=function(xi,Ma){const ju=xi.length,ps=Ma==null?void 0:Ma.values;if((ps==null?void 0:ps.length)>0)for(let $u=0;$u<ps.length;$u+=2){const Fs=ps[$u+1];xi.emplaceBack(u.aq[ps[$u]],Fs[0],Fs[1])}return[ju,xi.length]}(Zt.textAnchorOffsets,o5);Zt.symbolInstances.emplaceBack(cr.x,cr.y,xo.right>=0?xo.right:-1,xo.center>=0?xo.center:-1,xo.left>=0?xo.left:-1,xo.vertical||-1,S_,E_,HT,Q3,e5,t5,r5,n5,i5,a5,s5,zi,UT,qT,yo,Wf,WT,0,jn,fs,l5,u5)}(c,Yt,ut,h,m,w,jt,c.layers[0],c.collisionBoxArray,l.index,l.sourceLayerIndex,c.index,Te,[He,He,He,He],Nt,L,We,nt,nr,ue,l,T,j,q,C)};if(Mt==="line")for(const ut of PT(l.geometry,0,0,In,In)){const Yt=G3(ut,Re,vt,h.vertical||ge,m,24,Pe,c.overscaling,In);for(const Zt of Yt)ge&&Y3(c,ge.text,Pt,Zt)||Bt(ut,Zt)}else if(Mt==="line-center"){for(const ut of l.geometry)if(ut.length>1){const Yt=H3(ut,vt,h.vertical||ge,m,24,Pe);Yt&&Bt(ut,Yt)}}else if(l.type==="Polygon")for(const ut of jc(l.geometry,0)){const Yt=Z3(ut,16);Bt(ut[0],new _l(Yt.x,Yt.y,0))}else if(l.type==="LineString")for(const ut of l.geometry)Bt(ut,new _l(ut[0].x,ut[0].y,0));else if(l.type==="Point")for(const ut of l.geometry)for(const Yt of ut)Bt([Yt],new _l(Yt.x,Yt.y,0))}function OT(c,l,h,m,w,T,C,N,L,j,q,K,ne,ue,ge){const ye=function(We,Re,He,nt,vt,Nt,nr,Mt){const Pt=nt.layout.get("text-rotate").evaluate(Nt,{})*Math.PI/180,Xt=[];for(const jt of Re.positionedLines)for(const Bt of jt.positionedGlyphs){if(!Bt.rect)continue;const ut=Bt.rect||{};let Yt=eT+1,Zt=!0,cr=1,qr=0;const Ur=(vt||Mt)&&Bt.vertical,On=Bt.metrics.advance*Bt.scale/2;if(Mt&&Re.verticalizable&&(qr=jt.lineOffset/2-(Bt.imageName?-(zn-Bt.metrics.width*Bt.scale)/2:(Bt.scale-1)*zn)),Bt.imageName){const Nr=nr[Bt.imageName];Zt=Nr.sdf,cr=Nr.pixelRatio,Yt=Ki/cr}const Ga=vt?[Bt.x+On,Bt.y]:[0,0];let oi=vt?[0,0]:[Bt.x+On+He[0],Bt.y+He[1]-qr],Fn=[0,0];Ur&&(Fn=oi,oi=[0,0]);const Ni=Bt.metrics.isDoubleResolution?2:1,zi=(Bt.metrics.left-Yt)*Bt.scale-On+oi[0],Ri=(-Bt.metrics.top-Yt)*Bt.scale+oi[1],yn=zi+ut.w/Ni*Bt.scale/cr,jn=Ri+ut.h/Ni*Bt.scale/cr,yi=new v(zi,Ri),li=new v(yn,Ri),Li=new v(zi,jn),ui=new v(yn,jn);if(Ur){const Nr=new v(-On,On-jf),Xr=-Math.PI/2,tn=zn/2-On,ha=new v(5-jf-tn,-(Bt.imageName?tn:0)),hn=new v(...Fn);yi._rotateAround(Xr,Nr)._add(ha)._add(hn),li._rotateAround(Xr,Nr)._add(ha)._add(hn),Li._rotateAround(Xr,Nr)._add(ha)._add(hn),ui._rotateAround(Xr,Nr)._add(ha)._add(hn)}if(Pt){const Nr=Math.sin(Pt),Xr=Math.cos(Pt),tn=[Xr,-Nr,Nr,Xr];yi._matMult(tn),li._matMult(tn),Li._matMult(tn),ui._matMult(tn)}const Ia=new v(0,0),Yi=new v(0,0);Xt.push({tl:yi,tr:li,bl:Li,br:ui,tex:ut,writingMode:Re.writingMode,glyphOffset:Ga,sectionIndex:Bt.sectionIndex,isSDF:Zt,pixelOffsetTL:Ia,pixelOffsetBR:Yi,minFontScaleX:0,minFontScaleY:0})}return Xt}(0,h,N,w,T,C,m,c.allowVerticalPlacement),Te=c.textSizeData;let Pe=null;Te.kind==="source"?(Pe=[Ls*w.layout.get("text-size").evaluate(C,{})],Pe[0]>yl&&te(`${c.layerIds[0]}: Value for "text-size" is >= ${Vf}. Reduce your "text-size".`)):Te.kind==="composite"&&(Pe=[Ls*ue.compositeTextSizes[0].evaluate(C,{},ge),Ls*ue.compositeTextSizes[1].evaluate(C,{},ge)],(Pe[0]>yl||Pe[1]>yl)&&te(`${c.layerIds[0]}: Value for "text-size" is >= ${Vf}. Reduce your "text-size".`)),c.addSymbols(c.text,ye,Pe,N,T,C,j,l,L.lineStartIndex,L.lineLength,ne,ge);for(const We of q)K[We]=c.text.placedSymbolArray.length-1;return 4*ye.length}function FT(c){for(const l in c)return c[l];return null}function Y3(c,l,h,m){const w=c.compareText;if(l in w){const T=w[l];for(let C=T.length-1;C>=0;C--)if(m.dist(T[C])<h)return!0}else w[l]=[];return w[l].push(m),!1}const jT=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class g_{static from(l){if(!(l instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[h,m]=new Uint8Array(l,0,2);if(h!==219)throw new Error("Data does not appear to be in a KDBush format.");const w=m>>4;if(w!==1)throw new Error(`Got v${w} data when expected v1.`);const T=jT[15&m];if(!T)throw new Error("Unrecognized array type.");const[C]=new Uint16Array(l,2,1),[N]=new Uint32Array(l,4,1);return new g_(N,C,T,l)}constructor(l,h=64,m=Float64Array,w){if(isNaN(l)||l<0)throw new Error(`Unpexpected numItems value: ${l}.`);this.numItems=+l,this.nodeSize=Math.min(Math.max(+h,2),65535),this.ArrayType=m,this.IndexArrayType=l<65536?Uint16Array:Uint32Array;const T=jT.indexOf(this.ArrayType),C=2*l*this.ArrayType.BYTES_PER_ELEMENT,N=l*this.IndexArrayType.BYTES_PER_ELEMENT,L=(8-N%8)%8;if(T<0)throw new Error(`Unexpected typed array class: ${m}.`);w&&w instanceof ArrayBuffer?(this.data=w,this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+N+L,2*l),this._pos=2*l,this._finished=!0):(this.data=new ArrayBuffer(8+C+N+L),this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+N+L,2*l),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+T]),new Uint16Array(this.data,2,1)[0]=h,new Uint32Array(this.data,4,1)[0]=l)}add(l,h){const m=this._pos>>1;return this.ids[m]=m,this.coords[this._pos++]=l,this.coords[this._pos++]=h,m}finish(){const l=this._pos>>1;if(l!==this.numItems)throw new Error(`Added ${l} items when expected ${this.numItems}.`);return v_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(l,h,m,w){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:T,coords:C,nodeSize:N}=this,L=[0,T.length-1,0],j=[];for(;L.length;){const q=L.pop()||0,K=L.pop()||0,ne=L.pop()||0;if(K-ne<=N){for(let Te=ne;Te<=K;Te++){const Pe=C[2*Te],We=C[2*Te+1];Pe>=l&&Pe<=m&&We>=h&&We<=w&&j.push(T[Te])}continue}const ue=ne+K>>1,ge=C[2*ue],ye=C[2*ue+1];ge>=l&&ge<=m&&ye>=h&&ye<=w&&j.push(T[ue]),(q===0?l<=ge:h<=ye)&&(L.push(ne),L.push(ue-1),L.push(1-q)),(q===0?m>=ge:w>=ye)&&(L.push(ue+1),L.push(K),L.push(1-q))}return j}within(l,h,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:w,coords:T,nodeSize:C}=this,N=[0,w.length-1,0],L=[],j=m*m;for(;N.length;){const q=N.pop()||0,K=N.pop()||0,ne=N.pop()||0;if(K-ne<=C){for(let Te=ne;Te<=K;Te++)VT(T[2*Te],T[2*Te+1],l,h)<=j&&L.push(w[Te]);continue}const ue=ne+K>>1,ge=T[2*ue],ye=T[2*ue+1];VT(ge,ye,l,h)<=j&&L.push(w[ue]),(q===0?l-m<=ge:h-m<=ye)&&(N.push(ne),N.push(ue-1),N.push(1-q)),(q===0?l+m>=ge:h+m>=ye)&&(N.push(ue+1),N.push(K),N.push(1-q))}return L}}function v_(c,l,h,m,w,T){if(w-m<=h)return;const C=m+w>>1;$T(c,l,C,m,w,T),v_(c,l,h,m,C-1,1-T),v_(c,l,h,C+1,w,1-T)}function $T(c,l,h,m,w,T){for(;w>m;){if(w-m>600){const j=w-m+1,q=h-m+1,K=Math.log(j),ne=.5*Math.exp(2*K/3),ue=.5*Math.sqrt(K*ne*(j-ne)/j)*(q-j/2<0?-1:1);$T(c,l,h,Math.max(m,Math.floor(h-q*ne/j+ue)),Math.min(w,Math.floor(h+(j-q)*ne/j+ue)),T)}const C=l[2*h+T];let N=m,L=w;for(Hf(c,l,m,h),l[2*w+T]>C&&Hf(c,l,m,w);N<L;){for(Hf(c,l,N,L),N++,L--;l[2*N+T]<C;)N++;for(;l[2*L+T]>C;)L--}l[2*m+T]===C?Hf(c,l,m,L):(L++,Hf(c,l,L,w)),L<=h&&(m=L+1),h<=L&&(w=L-1)}}function Hf(c,l,h,m){y_(c,h,m),y_(l,2*h,2*m),y_(l,2*h+1,2*m+1)}function y_(c,l,h){const m=c[l];c[l]=c[h],c[h]=m}function VT(c,l,h,m){const w=c-h,T=l-m;return w*w+T*T}var x_;u.bg=void 0,(x_=u.bg||(u.bg={})).create="create",x_.load="load",x_.fullLoad="fullLoad";let Jg=null,Gf=[];const __=1e3/60,w_="loadTime",b_="fullLoadTime",J3={mark(c){performance.mark(c)},frame(c){const l=c;Jg!=null&&Gf.push(l-Jg),Jg=l},clearMetrics(){Jg=null,Gf=[],performance.clearMeasures(w_),performance.clearMeasures(b_);for(const c in u.bg)performance.clearMarks(u.bg[c])},getPerformanceMetrics(){performance.measure(w_,u.bg.create,u.bg.load),performance.measure(b_,u.bg.create,u.bg.fullLoad);const c=performance.getEntriesByName(w_)[0].duration,l=performance.getEntriesByName(b_)[0].duration,h=Gf.length,m=1/(Gf.reduce((T,C)=>T+C,0)/h/1e3),w=Gf.filter(T=>T>__).reduce((T,C)=>T+(C-__)/__,0);return{loadTime:c,fullLoadTime:l,fps:m,percentDroppedFrames:w/(h+w)*100,totalFrames:h}}};u.$=class extends Y{},u.A=mh,u.B=Ax,u.C=function(c){if(se==null){const l=c.navigator?c.navigator.userAgent:null;se=!!c.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return se},u.D=Gt,u.E=Tt,u.F=class{constructor(c,l){this.target=c,this.mapId=l,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new U3(()=>this.process()),this.subscription=function(h,m,w,T){return h.addEventListener(m,w,!1),{unsubscribe:()=>{h.removeEventListener(m,w,!1)}}}(this.target,"message",h=>this.receive(h)),this.globalScope=oe(self)?c:window}registerMessageHandler(c,l){this.messageHandlers[c]=l}sendAsync(c,l){return new Promise((h,m)=>{const w=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[w]={resolve:h,reject:m},l&&l.signal.addEventListener("abort",()=>{delete this.resolveRejects[w];const N={id:w,type:"<cancel>",origin:location.origin,targetMapId:c.targetMapId,sourceMapId:this.mapId};this.target.postMessage(N)},{once:!0});const T=[],C=Object.assign(Object.assign({},c),{id:w,sourceMapId:this.mapId,origin:location.origin,data:sl(c.data,T)});this.target.postMessage(C,{transfer:T})})}receive(c){const l=c.data,h=l.id;if(!(l.origin!=="file://"&&location.origin!=="file://"&&l.origin!=="resource://android"&&location.origin!=="resource://android"&&l.origin!==location.origin||l.targetMapId&&this.mapId!==l.targetMapId)){if(l.type==="<cancel>"){delete this.tasks[h];const m=this.abortControllers[h];return delete this.abortControllers[h],void(m&&m.abort())}if(oe(self)||l.mustQueue)return this.tasks[h]=l,this.taskQueue.push(h),void this.invoker.trigger();this.processTask(h,l)}}process(){if(this.taskQueue.length===0)return;const c=this.taskQueue.shift(),l=this.tasks[c];delete this.tasks[c],this.taskQueue.length>0&&this.invoker.trigger(),l&&this.processTask(c,l)}processTask(c,l){return a(this,void 0,void 0,function*(){if(l.type==="<response>"){const w=this.resolveRejects[c];return delete this.resolveRejects[c],w?void(l.error?w.reject(ol(l.error)):w.resolve(ol(l.data))):void 0}if(!this.messageHandlers[l.type])return void this.completeTask(c,new Error(`Could not find a registered handler for ${l.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const h=ol(l.data),m=new AbortController;this.abortControllers[c]=m;try{const w=yield this.messageHandlers[l.type](l.sourceMapId,h,m);this.completeTask(c,null,w)}catch(w){this.completeTask(c,w)}})}completeTask(c,l,h){const m=[];delete this.abortControllers[c];const w={id:c,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:l?sl(l):null,data:sl(h,m)};this.target.postMessage(w,{transfer:m})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},u.G=Je,u.H=function(){var c=new mh(16);return mh!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},u.I=n_,u.J=function(c,l,h){var m,w,T,C,N,L,j,q,K,ne,ue,ge,ye=h[0],Te=h[1],Pe=h[2];return l===c?(c[12]=l[0]*ye+l[4]*Te+l[8]*Pe+l[12],c[13]=l[1]*ye+l[5]*Te+l[9]*Pe+l[13],c[14]=l[2]*ye+l[6]*Te+l[10]*Pe+l[14],c[15]=l[3]*ye+l[7]*Te+l[11]*Pe+l[15]):(w=l[1],T=l[2],C=l[3],N=l[4],L=l[5],j=l[6],q=l[7],K=l[8],ne=l[9],ue=l[10],ge=l[11],c[0]=m=l[0],c[1]=w,c[2]=T,c[3]=C,c[4]=N,c[5]=L,c[6]=j,c[7]=q,c[8]=K,c[9]=ne,c[10]=ue,c[11]=ge,c[12]=m*ye+N*Te+K*Pe+l[12],c[13]=w*ye+L*Te+ne*Pe+l[13],c[14]=T*ye+j*Te+ue*Pe+l[14],c[15]=C*ye+q*Te+ge*Pe+l[15]),c},u.K=function(c,l,h){var m=h[0],w=h[1],T=h[2];return c[0]=l[0]*m,c[1]=l[1]*m,c[2]=l[2]*m,c[3]=l[3]*m,c[4]=l[4]*w,c[5]=l[5]*w,c[6]=l[6]*w,c[7]=l[7]*w,c[8]=l[8]*T,c[9]=l[9]*T,c[10]=l[10]*T,c[11]=l[11]*T,c[12]=l[12],c[13]=l[13],c[14]=l[14],c[15]=l[15],c},u.L=bE,u.M=function(c,l){const h={};for(let m=0;m<l.length;m++){const w=l[m];w in c&&(h[w]=c[w])}return h},u.N=xl,u.O=vT,u.P=v,u.Q=yT,u.R=ka,u.S=Pa,u.T=ah,u.U=P,u.V=I,u.W=ae,u.X=In,u.Y=R,u.Z=Uf,u._=a,u.a=Le,u.a$=function(c,l){var h=c[0],m=c[1],w=c[2],T=c[3],C=c[4],N=c[5],L=c[6],j=c[7],q=c[8],K=c[9],ne=c[10],ue=c[11],ge=c[12],ye=c[13],Te=c[14],Pe=c[15],We=l[0],Re=l[1],He=l[2],nt=l[3],vt=l[4],Nt=l[5],nr=l[6],Mt=l[7],Pt=l[8],Xt=l[9],jt=l[10],Bt=l[11],ut=l[12],Yt=l[13],Zt=l[14],cr=l[15];return Math.abs(h-We)<=Di*Math.max(1,Math.abs(h),Math.abs(We))&&Math.abs(m-Re)<=Di*Math.max(1,Math.abs(m),Math.abs(Re))&&Math.abs(w-He)<=Di*Math.max(1,Math.abs(w),Math.abs(He))&&Math.abs(T-nt)<=Di*Math.max(1,Math.abs(T),Math.abs(nt))&&Math.abs(C-vt)<=Di*Math.max(1,Math.abs(C),Math.abs(vt))&&Math.abs(N-Nt)<=Di*Math.max(1,Math.abs(N),Math.abs(Nt))&&Math.abs(L-nr)<=Di*Math.max(1,Math.abs(L),Math.abs(nr))&&Math.abs(j-Mt)<=Di*Math.max(1,Math.abs(j),Math.abs(Mt))&&Math.abs(q-Pt)<=Di*Math.max(1,Math.abs(q),Math.abs(Pt))&&Math.abs(K-Xt)<=Di*Math.max(1,Math.abs(K),Math.abs(Xt))&&Math.abs(ne-jt)<=Di*Math.max(1,Math.abs(ne),Math.abs(jt))&&Math.abs(ue-Bt)<=Di*Math.max(1,Math.abs(ue),Math.abs(Bt))&&Math.abs(ge-ut)<=Di*Math.max(1,Math.abs(ge),Math.abs(ut))&&Math.abs(ye-Yt)<=Di*Math.max(1,Math.abs(ye),Math.abs(Yt))&&Math.abs(Te-Zt)<=Di*Math.max(1,Math.abs(Te),Math.abs(Zt))&&Math.abs(Pe-cr)<=Di*Math.max(1,Math.abs(Pe),Math.abs(cr))},u.a0=Cr,u.a1=f_,u.a2=lt,u.a3=c=>{const l=window.document.createElement("video");return l.muted=!0,new Promise(h=>{l.onloadstart=()=>{h(l)};for(const m of c){const w=window.document.createElement("source");Oe(m)||(l.crossOrigin="Anonymous"),w.src=m,l.appendChild(w)}})},u.a4=function(){return G++},u.a5=Dt,u.a6=wh,u.a7=uf,u.a8=Ou,u.a9=ET,u.aA=function(c){if(c.type==="custom")return new V3(c);switch(c.type){case"background":return new F3(c);case"circle":return new CB(c);case"fill":return new UB(c);case"fill-extrusion":return new i3(c);case"heatmap":return new PB(c);case"hillshade":return new AB(c);case"line":return new d3(c);case"raster":return new $3(c);case"symbol":return new Wg(c)}},u.aB=X,u.aC=function(c,l){if(!c)return[{command:"setStyle",args:[l]}];let h=[];try{if(!yt(c.version,l.version))return[{command:"setStyle",args:[l]}];yt(c.center,l.center)||h.push({command:"setCenter",args:[l.center]}),yt(c.zoom,l.zoom)||h.push({command:"setZoom",args:[l.zoom]}),yt(c.bearing,l.bearing)||h.push({command:"setBearing",args:[l.bearing]}),yt(c.pitch,l.pitch)||h.push({command:"setPitch",args:[l.pitch]}),yt(c.sprite,l.sprite)||h.push({command:"setSprite",args:[l.sprite]}),yt(c.glyphs,l.glyphs)||h.push({command:"setGlyphs",args:[l.glyphs]}),yt(c.transition,l.transition)||h.push({command:"setTransition",args:[l.transition]}),yt(c.light,l.light)||h.push({command:"setLight",args:[l.light]}),yt(c.terrain,l.terrain)||h.push({command:"setTerrain",args:[l.terrain]}),yt(c.sky,l.sky)||h.push({command:"setSky",args:[l.sky]}),yt(c.projection,l.projection)||h.push({command:"setProjection",args:[l.projection]});const m={},w=[];(function(C,N,L,j){let q;for(q in N=N||{},C=C||{})Object.prototype.hasOwnProperty.call(C,q)&&(Object.prototype.hasOwnProperty.call(N,q)||$t(q,L,j));for(q in N)Object.prototype.hasOwnProperty.call(N,q)&&(Object.prototype.hasOwnProperty.call(C,q)?yt(C[q],N[q])||(C[q].type==="geojson"&&N[q].type==="geojson"&&Vt(C,N,q)?gt(L,{command:"setGeoJSONSourceData",args:[q,N[q].data]}):er(q,N,L,j)):qt(q,N,L))})(c.sources,l.sources,w,m);const T=[];c.layers&&c.layers.forEach(C=>{"source"in C&&m[C.source]?h.push({command:"removeLayer",args:[C.id]}):T.push(C)}),h=h.concat(w),function(C,N,L){N=N||[];const j=(C=C||[]).map(pr),q=N.map(pr),K=C.reduce(vr,{}),ne=N.reduce(vr,{}),ue=j.slice(),ge=Object.create(null);let ye,Te,Pe,We,Re;for(let He=0,nt=0;He<j.length;He++)ye=j[He],Object.prototype.hasOwnProperty.call(ne,ye)?nt++:(gt(L,{command:"removeLayer",args:[ye]}),ue.splice(ue.indexOf(ye,nt),1));for(let He=0,nt=0;He<q.length;He++)ye=q[q.length-1-He],ue[ue.length-1-He]!==ye&&(Object.prototype.hasOwnProperty.call(K,ye)?(gt(L,{command:"removeLayer",args:[ye]}),ue.splice(ue.lastIndexOf(ye,ue.length-nt),1)):nt++,We=ue[ue.length-He],gt(L,{command:"addLayer",args:[ne[ye],We]}),ue.splice(ue.length-He,0,ye),ge[ye]=!0);for(let He=0;He<q.length;He++)if(ye=q[He],Te=K[ye],Pe=ne[ye],!ge[ye]&&!yt(Te,Pe))if(yt(Te.source,Pe.source)&&yt(Te["source-layer"],Pe["source-layer"])&&yt(Te.type,Pe.type)){for(Re in tr(Te.layout,Pe.layout,L,ye,null,"setLayoutProperty"),tr(Te.paint,Pe.paint,L,ye,null,"setPaintProperty"),yt(Te.filter,Pe.filter)||gt(L,{command:"setFilter",args:[ye,Pe.filter]}),yt(Te.minzoom,Pe.minzoom)&&yt(Te.maxzoom,Pe.maxzoom)||gt(L,{command:"setLayerZoomRange",args:[ye,Pe.minzoom,Pe.maxzoom]}),Te)Object.prototype.hasOwnProperty.call(Te,Re)&&Re!=="layout"&&Re!=="paint"&&Re!=="filter"&&Re!=="metadata"&&Re!=="minzoom"&&Re!=="maxzoom"&&(Re.indexOf("paint.")===0?tr(Te[Re],Pe[Re],L,ye,Re.slice(6),"setPaintProperty"):yt(Te[Re],Pe[Re])||gt(L,{command:"setLayerProperty",args:[ye,Re,Pe[Re]]}));for(Re in Pe)Object.prototype.hasOwnProperty.call(Pe,Re)&&!Object.prototype.hasOwnProperty.call(Te,Re)&&Re!=="layout"&&Re!=="paint"&&Re!=="filter"&&Re!=="metadata"&&Re!=="minzoom"&&Re!=="maxzoom"&&(Re.indexOf("paint.")===0?tr(Te[Re],Pe[Re],L,ye,Re.slice(6),"setPaintProperty"):yt(Te[Re],Pe[Re])||gt(L,{command:"setLayerProperty",args:[ye,Re,Pe[Re]]}))}else gt(L,{command:"removeLayer",args:[ye]}),We=ue[ue.lastIndexOf(ye)+1],gt(L,{command:"addLayer",args:[Pe,We]})}(T,l.layers,h)}catch(m){console.warn("Unable to compute style diff:",m),h=[{command:"setStyle",args:[l]}]}return h},u.aD=function(c){const l=[],h=c.id;return h===void 0&&l.push({message:`layers.${h}: missing required property "id"`}),c.render===void 0&&l.push({message:`layers.${h}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&l.push({message:`layers.${h}: property "renderingMode" must be either "2d" or "3d"`}),l},u.aE=function c(l,h){if(Array.isArray(l)){if(!Array.isArray(h)||l.length!==h.length)return!1;for(let m=0;m<l.length;m++)if(!c(l[m],h[m]))return!1;return!0}if(typeof l=="object"&&l!==null&&h!==null){if(typeof h!="object"||Object.keys(l).length!==Object.keys(h).length)return!1;for(const m in l)if(!c(l[m],h[m]))return!1;return!0}return l===h},u.aF=Z,u.aG=Q,u.aH=class extends Ru{constructor(c,l){super(c,l),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}},u.aI=zg,u.aJ=class extends Ru{constructor(c,l){super(c,l),this.current=yB}set(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let l=1;l<16;l++)if(c[l]!==this.current[l]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}},u.aK=hE,u.aL=dE,u.aM=Mr,u.aN=class extends Ru{constructor(c,l){super(c,l),this.current=[0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))}},u.aO=class extends Ru{constructor(c,l){super(c,l),this.current=[0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))}},u.aP=function(c,l,h,m,w,T,C){var N=1/(l-h),L=1/(m-w),j=1/(T-C);return c[0]=-2*N,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*L,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*j,c[11]=0,c[12]=(l+h)*N,c[13]=(w+m)*L,c[14]=(C+T)*j,c[15]=1,c},u.aQ=TB,u.aR=class extends Fe{},u.aS=g3,u.aT=class extends Ke{},u.aU=Hx,u.aV=function(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))},u.aW=kE,u.aX=ii,u.aY=Ca,u.aZ=class extends Wt{},u.a_=function(c,l){return c[0]===l[0]&&c[1]===l[1]&&c[2]===l[2]&&c[3]===l[3]&&c[4]===l[4]&&c[5]===l[5]&&c[6]===l[6]&&c[7]===l[7]&&c[8]===l[8]&&c[9]===l[9]&&c[10]===l[10]&&c[11]===l[11]&&c[12]===l[12]&&c[13]===l[13]&&c[14]===l[14]&&c[15]===l[15]},u.aa=function(c){const l={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(h,m,w,T)=>{const C=w||T;return l[m]=!C||C.toLowerCase(),""}),l["max-age"]){const h=parseInt(l["max-age"],10);isNaN(h)?delete l["max-age"]:l["max-age"]=h}return l},u.ab=function(c,l){const h=[];for(const m in c)m in l||h.push(m);return h},u.ac=V,u.ad=function(c,l,h){var m=Math.sin(h),w=Math.cos(h),T=l[0],C=l[1],N=l[2],L=l[3],j=l[4],q=l[5],K=l[6],ne=l[7];return l!==c&&(c[8]=l[8],c[9]=l[9],c[10]=l[10],c[11]=l[11],c[12]=l[12],c[13]=l[13],c[14]=l[14],c[15]=l[15]),c[0]=T*w+j*m,c[1]=C*w+q*m,c[2]=N*w+K*m,c[3]=L*w+ne*m,c[4]=j*w-T*m,c[5]=q*w-C*m,c[6]=K*w-N*m,c[7]=ne*w-L*m,c},u.ae=function(c){var l=new mh(16);return l[0]=c[0],l[1]=c[1],l[2]=c[2],l[3]=c[3],l[4]=c[4],l[5]=c[5],l[6]=c[6],l[7]=c[7],l[8]=c[8],l[9]=c[9],l[10]=c[10],l[11]=c[11],l[12]=c[12],l[13]=c[13],l[14]=c[14],l[15]=c[15],l},u.af=Og,u.ag=function(c,l){let h=0,m=0;if(c.kind==="constant")m=c.layoutSize;else if(c.kind!=="source"){const{interpolationType:w,minZoom:T,maxZoom:C}=c,N=w?V(Ai.interpolationFactor(w,l,T,C),0,1):0;c.kind==="camera"?m=Ii.number(c.minSize,c.maxSize,N):h=N}return{uSizeT:h,uSize:m}},u.ai=function(c,{uSize:l,uSizeT:h},{lowerSize:m,upperSize:w}){return c.kind==="source"?m/Ls:c.kind==="composite"?Ii.number(m/Ls,w/Ls,h):l},u.aj=o_,u.ak=function(c,l,h,m){const w=l.y-c.y,T=l.x-c.x,C=m.y-h.y,N=m.x-h.x,L=C*T-N*w;if(L===0)return null;const j=(N*(c.y-h.y)-C*(c.x-h.x))/L;return new v(c.x+j*T,c.y+j*w)},u.al=PT,u.am=gE,u.an=Vx,u.ao=function(c){let l=1/0,h=1/0,m=-1/0,w=-1/0;for(const T of c)l=Math.min(l,T.x),h=Math.min(h,T.y),m=Math.max(m,T.x),w=Math.max(w,T.y);return[l,h,m,w]},u.ap=zn,u.ar=s_,u.as=function(c,l){var h=l[0],m=l[1],w=l[2],T=l[3],C=l[4],N=l[5],L=l[6],j=l[7],q=l[8],K=l[9],ne=l[10],ue=l[11],ge=l[12],ye=l[13],Te=l[14],Pe=l[15],We=h*N-m*C,Re=h*L-w*C,He=h*j-T*C,nt=m*L-w*N,vt=m*j-T*N,Nt=w*j-T*L,nr=q*ye-K*ge,Mt=q*Te-ne*ge,Pt=q*Pe-ue*ge,Xt=K*Te-ne*ye,jt=K*Pe-ue*ye,Bt=ne*Pe-ue*Te,ut=We*Bt-Re*jt+He*Xt+nt*Pt-vt*Mt+Nt*nr;return ut?(c[0]=(N*Bt-L*jt+j*Xt)*(ut=1/ut),c[1]=(w*jt-m*Bt-T*Xt)*ut,c[2]=(ye*Nt-Te*vt+Pe*nt)*ut,c[3]=(ne*vt-K*Nt-ue*nt)*ut,c[4]=(L*Pt-C*Bt-j*Mt)*ut,c[5]=(h*Bt-w*Pt+T*Mt)*ut,c[6]=(Te*He-ge*Nt-Pe*Re)*ut,c[7]=(q*Nt-ne*He+ue*Re)*ut,c[8]=(C*jt-N*Pt+j*nr)*ut,c[9]=(m*Pt-h*jt-T*nr)*ut,c[10]=(ge*vt-ye*He+Pe*We)*ut,c[11]=(K*He-q*vt-ue*We)*ut,c[12]=(N*Mt-C*Xt-L*nr)*ut,c[13]=(h*Xt-m*Mt+w*nr)*ut,c[14]=(ye*Re-ge*nt-Te*We)*ut,c[15]=(q*nt-K*Re+ne*We)*ut,c):null},u.at=m_,u.au=a_,u.av=g_,u.aw=function(){const c={},l=$e.$version;for(const h in $e.$root){const m=$e.$root[h];if(m.required){let w=null;w=h==="version"?l:m.type==="array"?[]:{},w!=null&&(c[h]=w)}}return c},u.ax=Sf,u.ay=ft,u.az=function(c){c=c.slice();const l=Object.create(null);for(let h=0;h<c.length;h++)l[c[h].id]=c[h];for(let h=0;h<c.length;h++)"ref"in c[h]&&(c[h]=pt(c[h],l[c[h].ref]));return c},u.b=de,u.b0=function(c,l){return c[0]=l[0],c[1]=l[1],c[2]=l[2],c[3]=l[3],c[4]=l[4],c[5]=l[5],c[6]=l[6],c[7]=l[7],c[8]=l[8],c[9]=l[9],c[10]=l[10],c[11]=l[11],c[12]=l[12],c[13]=l[13],c[14]=l[14],c[15]=l[15],c},u.b1=function(c,l,h){return c[0]=l[0]*h[0],c[1]=l[1]*h[1],c[2]=l[2]*h[2],c[3]=l[3]*h[3],c},u.b2=function(c,l){return c[0]*l[0]+c[1]*l[1]+c[2]*l[2]+c[3]*l[3]},u.b3=U,u.b4=wT,u.b5=xT,u.b6=function(c,l,h,m,w){var T,C=1/Math.tan(l/2);return c[0]=C/h,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=C,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,w!=null&&w!==1/0?(c[10]=(w+m)*(T=1/(m-w)),c[14]=2*w*m*T):(c[10]=-1,c[14]=-2*m),c},u.b7=function(c,l,h){var m=Math.sin(h),w=Math.cos(h),T=l[4],C=l[5],N=l[6],L=l[7],j=l[8],q=l[9],K=l[10],ne=l[11];return l!==c&&(c[0]=l[0],c[1]=l[1],c[2]=l[2],c[3]=l[3],c[12]=l[12],c[13]=l[13],c[14]=l[14],c[15]=l[15]),c[4]=T*w+j*m,c[5]=C*w+q*m,c[6]=N*w+K*m,c[7]=L*w+ne*m,c[8]=j*w-T*m,c[9]=q*w-C*m,c[10]=K*w-N*m,c[11]=ne*w-L*m,c},u.b8=z,u.b9=O,u.bA=WE,u.bB=function(c){return c.message===_e},u.bC=el,u.bD=Zi,u.ba=function(c){return c*Math.PI/180},u.bb=function(c,l){const{x:h,y:m}=Uf.fromLngLat(l);return!(c<0||c>25||m<0||m>=1||h<0||h>=1)},u.bc=function(c,l){return c[0]=l[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=l[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=l[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},u.bd=class extends H{},u.be=h_,u.bf=J3,u.bh=et,u.bi=function(c,l){Le.REGISTERED_PROTOCOLS[c]=l},u.bj=function(c){delete Le.REGISTERED_PROTOCOLS[c]},u.bk=function(c,l){const h={};for(let w=0;w<c.length;w++){const T=l&&l[c[w].id]||bg(c[w]);l&&(l[c[w].id]=T);let C=h[T];C||(C=h[T]=[]),C.push(c[w])}const m=[];for(const w in h)m.push(h[w]);return m},u.bl=Ft,u.bm=ST,u.bn=TT,u.bo=rT,u.bp=function(c){c.bucket.createArrays(),c.bucket.tilePixelRatio=In/(512*c.bucket.overscaling),c.bucket.compareText={},c.bucket.iconsNeedLinear=!1;const l=c.bucket.layers[0],h=l.layout,m=l._unevaluatedLayout._values,w={layoutIconSize:m["icon-size"].possiblyEvaluate(new Yr(c.bucket.zoom+1),c.canonical),layoutTextSize:m["text-size"].possiblyEvaluate(new Yr(c.bucket.zoom+1),c.canonical),textMaxSize:m["text-size"].possiblyEvaluate(new Yr(18))};if(c.bucket.textSizeData.kind==="composite"){const{minZoom:j,maxZoom:q}=c.bucket.textSizeData;w.compositeTextSizes=[m["text-size"].possiblyEvaluate(new Yr(j),c.canonical),m["text-size"].possiblyEvaluate(new Yr(q),c.canonical)]}if(c.bucket.iconSizeData.kind==="composite"){const{minZoom:j,maxZoom:q}=c.bucket.iconSizeData;w.compositeIconSizes=[m["icon-size"].possiblyEvaluate(new Yr(j),c.canonical),m["icon-size"].possiblyEvaluate(new Yr(q),c.canonical)]}const T=h.get("text-line-height")*zn,C=h.get("text-rotation-alignment")!=="viewport"&&h.get("symbol-placement")!=="point",N=h.get("text-keep-upright"),L=h.get("text-size");for(const j of c.bucket.features){const q=h.get("text-font").evaluate(j,{},c.canonical).join(","),K=L.evaluate(j,{},c.canonical),ne=w.layoutTextSize.evaluate(j,{},c.canonical),ue=w.layoutIconSize.evaluate(j,{},c.canonical),ge={horizontal:{},vertical:void 0},ye=j.text;let Te,Pe=[0,0];if(ye){const He=ye.toString(),nt=h.get("text-letter-spacing").evaluate(j,{},c.canonical)*zn,vt=Mx(He)?nt:0,Nt=h.get("text-anchor").evaluate(j,{},c.canonical),nr=BT(l,j,c.canonical);if(!nr){const jt=h.get("text-radial-offset").evaluate(j,{},c.canonical);Pe=jt?LT(Nt,[jt*zn,p_]):h.get("text-offset").evaluate(j,{},c.canonical).map(Bt=>Bt*zn)}let Mt=C?"center":h.get("text-justify").evaluate(j,{},c.canonical);const Pt=h.get("symbol-placement")==="point"?h.get("text-max-width").evaluate(j,{},c.canonical)*zn:1/0,Xt=()=>{c.bucket.allowVerticalPlacement&&Ef(He)&&(ge.vertical=qg(ye,c.glyphMap,c.glyphPositions,c.imagePositions,q,Pt,T,Nt,"left",vt,Pe,u.ah.vertical,!0,ne,K))};if(!C&&nr){const jt=new Set;if(Mt==="auto")for(let ut=0;ut<nr.values.length;ut+=2)jt.add(m_(nr.values[ut]));else jt.add(Mt);let Bt=!1;for(const ut of jt)if(!ge.horizontal[ut])if(Bt)ge.horizontal[ut]=ge.horizontal[0];else{const Yt=qg(ye,c.glyphMap,c.glyphPositions,c.imagePositions,q,Pt,T,"center",ut,vt,Pe,u.ah.horizontal,!1,ne,K);Yt&&(ge.horizontal[ut]=Yt,Bt=Yt.positionedLines.length===1)}Xt()}else{Mt==="auto"&&(Mt=m_(Nt));const jt=qg(ye,c.glyphMap,c.glyphPositions,c.imagePositions,q,Pt,T,Nt,Mt,vt,Pe,u.ah.horizontal,!1,ne,K);jt&&(ge.horizontal[Mt]=jt),Xt(),Ef(He)&&C&&N&&(ge.vertical=qg(ye,c.glyphMap,c.glyphPositions,c.imagePositions,q,Pt,T,Nt,Mt,vt,Pe,u.ah.vertical,!1,ne,K))}}let We=!1;if(j.icon&&j.icon.name){const He=c.imageMap[j.icon.name];He&&(Te=z3(c.imagePositions[j.icon.name],h.get("icon-offset").evaluate(j,{},c.canonical),h.get("icon-anchor").evaluate(j,{},c.canonical)),We=!!He.sdf,c.bucket.sdfIcons===void 0?c.bucket.sdfIcons=We:c.bucket.sdfIcons!==We&&te("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(He.pixelRatio!==c.bucket.pixelRatio||h.get("icon-rotate").constantOr(1)!==0)&&(c.bucket.iconsNeedLinear=!0))}const Re=FT(ge.horizontal)||ge.vertical;c.bucket.iconsInText=!!Re&&Re.iconsInText,(Re||Te)&&K3(c.bucket,j,ge,Te,c.imageMap,w,ne,ue,Pe,We,c.canonical)}c.showCollisionBoxes&&c.bucket.generateCollisionDebugBuffers()},u.bq=Qx,u.br=Kx,u.bs=Jx,u.bt=gl,u.bu=t_,u.bv=class{constructor(c){this._marks={start:[c.url,"start"].join("#"),end:[c.url,"end"].join("#"),measure:c.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let c=performance.getEntriesByName(this._marks.measure);return c.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),c=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),c}},u.bw=function(c,l,h,m,w){return a(this,void 0,void 0,function*(){if(I())try{return yield ae(c,l,h,m,w)}catch{}return function(T,C,N,L,j){const q=T.width,K=T.height;ve&&pe||(ve=new OffscreenCanvas(q,K),pe=ve.getContext("2d",{willReadFrequently:!0})),ve.width=q,ve.height=K,pe.drawImage(T,0,0,q,K);const ne=pe.getImageData(C,N,L,j);return pe.clearRect(0,0,q,K),ne.data}(c,l,h,m,w)})},u.bx=bT,u.by=d,u.bz=p,u.c=De,u.d=c=>a(void 0,void 0,void 0,function*(){if(c.byteLength===0)return createImageBitmap(new ImageData(1,1));const l=new Blob([new Uint8Array(c)],{type:"image/png"});try{return createImageBitmap(l)}catch(h){throw new Error(`Could not load image because of ${h.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),u.e=$,u.f=c=>new Promise((l,h)=>{const m=new Image;m.onload=()=>{l(m),URL.revokeObjectURL(m.src),m.onload=null,window.requestAnimationFrame(()=>{m.src=me})},m.onerror=()=>h(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const w=new Blob([new Uint8Array(c)],{type:"image/png"});m.src=c.byteLength?URL.createObjectURL(w):me}),u.g=je,u.h=(c,l)=>rt($(c,{type:"json"}),l),u.i=oe,u.j=mt,u.k=it,u.l=(c,l)=>rt($(c,{type:"arrayBuffer"}),l),u.m=rt,u.n=function(c){return new t_(c).readFields(k3,[])},u.o=Nf,u.p=tT,u.q=E,u.r=Ix,u.s=Oe,u.t=wf,u.u=po,u.v=$e,u.w=te,u.x=function([c,l,h]){return l+=90,l*=Math.PI/180,h*=Math.PI/180,{x:c*Math.cos(l)*Math.sin(h),y:c*Math.sin(l)*Math.sin(h),z:c*Math.cos(h)}},u.y=Ii,u.z=Yr}),i("worker",["./shared"],function(u){class a{constructor(re){this.keyCache={},re&&this.replace(re)}replace(re){this._layerConfigs={},this._layers={},this.update(re,[])}update(re,ee){for(const we of re){this._layerConfigs[we.id]=we;const Me=this._layers[we.id]=u.aA(we);Me._featureFilter=u.a7(Me.filter),this.keyCache[we.id]&&delete this.keyCache[we.id]}for(const we of ee)delete this.keyCache[we],delete this._layerConfigs[we],delete this._layers[we];this.familiesBySource={};const fe=u.bk(Object.values(this._layerConfigs),this.keyCache);for(const we of fe){const Me=we.map(Xe=>this._layers[Xe.id]),Ne=Me[0];if(Ne.visibility==="none")continue;const Ve=Ne.source||"";let ke=this.familiesBySource[Ve];ke||(ke=this.familiesBySource[Ve]={});const Ye=Ne.sourceLayer||"_geojsonTileLayer";let ot=ke[Ye];ot||(ot=ke[Ye]=[]),ot.push(Me)}}}class d{constructor(re){const ee={},fe=[];for(const Ve in re){const ke=re[Ve],Ye=ee[Ve]={};for(const ot in ke){const Xe=ke[+ot];if(!Xe||Xe.bitmap.width===0||Xe.bitmap.height===0)continue;const xt={x:0,y:0,w:Xe.bitmap.width+2,h:Xe.bitmap.height+2};fe.push(xt),Ye[ot]={rect:xt,metrics:Xe.metrics}}}const{w:we,h:Me}=u.p(fe),Ne=new u.o({width:we||1,height:Me||1});for(const Ve in re){const ke=re[Ve];for(const Ye in ke){const ot=ke[+Ye];if(!ot||ot.bitmap.width===0||ot.bitmap.height===0)continue;const Xe=ee[Ve][Ye].rect;u.o.copy(ot.bitmap,Ne,{x:0,y:0},{x:Xe.x+1,y:Xe.y+1},ot.bitmap)}}this.image=Ne,this.positions=ee}}u.bl("GlyphAtlas",d);class p{constructor(re){this.tileID=new u.S(re.tileID.overscaledZ,re.tileID.wrap,re.tileID.canonical.z,re.tileID.canonical.x,re.tileID.canonical.y),this.uid=re.uid,this.zoom=re.zoom,this.pixelRatio=re.pixelRatio,this.tileSize=re.tileSize,this.source=re.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=re.showCollisionBoxes,this.collectResourceTiming=!!re.collectResourceTiming,this.returnDependencies=!!re.returnDependencies,this.promoteId=re.promoteId,this.inFlightDependencies=[]}parse(re,ee,fe,we){return u._(this,void 0,void 0,function*(){this.status="parsing",this.data=re,this.collisionBoxArray=new u.a5;const Me=new u.bm(Object.keys(re.layers).sort()),Ne=new u.bn(this.tileID,this.promoteId);Ne.bucketLayerIDs=[];const Ve={},ke={featureIndex:Ne,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:fe},Ye=ee.familiesBySource[this.source];for(const rr in Ye){const Er=re.layers[rr];if(!Er)continue;Er.version===1&&u.w(`Vector tile source "${this.source}" layer "${rr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const br=Me.encode(rr),cn=[];for(let wn=0;wn<Er.length;wn++){const Pn=Er.feature(wn),$a=Ne.getId(Pn,rr);cn.push({feature:Pn,id:$a,index:wn,sourceLayerIndex:br})}for(const wn of Ye[rr]){const Pn=wn[0];Pn.source!==this.source&&u.w(`layer.source = ${Pn.source} does not equal this.source = ${this.source}`),Pn.minzoom&&this.zoom<Math.floor(Pn.minzoom)||Pn.maxzoom&&this.zoom>=Pn.maxzoom||Pn.visibility!=="none"&&(g(wn,this.zoom,fe),(Ve[Pn.id]=Pn.createBucket({index:Ne.bucketLayerIDs.length,layers:wn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:br,sourceID:this.source})).populate(cn,ke,this.tileID.canonical),Ne.bucketLayerIDs.push(wn.map($a=>$a.id)))}}const ot=u.aF(ke.glyphDependencies,rr=>Object.keys(rr).map(Number));this.inFlightDependencies.forEach(rr=>rr==null?void 0:rr.abort()),this.inFlightDependencies=[];let Xe=Promise.resolve({});if(Object.keys(ot).length){const rr=new AbortController;this.inFlightDependencies.push(rr),Xe=we.sendAsync({type:"GG",data:{stacks:ot,source:this.source,tileID:this.tileID,type:"glyphs"}},rr)}const xt=Object.keys(ke.iconDependencies);let Ct=Promise.resolve({});if(xt.length){const rr=new AbortController;this.inFlightDependencies.push(rr),Ct=we.sendAsync({type:"GI",data:{icons:xt,source:this.source,tileID:this.tileID,type:"icons"}},rr)}const Ut=Object.keys(ke.patternDependencies);let gr=Promise.resolve({});if(Ut.length){const rr=new AbortController;this.inFlightDependencies.push(rr),gr=we.sendAsync({type:"GI",data:{icons:Ut,source:this.source,tileID:this.tileID,type:"patterns"}},rr)}const[ar,xr,fr]=yield Promise.all([Xe,Ct,gr]),kr=new d(ar),_r=new u.bo(xr,fr);for(const rr in Ve){const Er=Ve[rr];Er instanceof u.a6?(g(Er.layers,this.zoom,fe),u.bp({bucket:Er,glyphMap:ar,glyphPositions:kr.positions,imageMap:xr,imagePositions:_r.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Er.hasPattern&&(Er instanceof u.bq||Er instanceof u.br||Er instanceof u.bs)&&(g(Er.layers,this.zoom,fe),Er.addFeatures(ke,this.tileID.canonical,_r.patternPositions))}return this.status="done",{buckets:Object.values(Ve).filter(rr=>!rr.isEmpty()),featureIndex:Ne,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:kr.image,imageAtlas:_r,glyphMap:this.returnDependencies?ar:null,iconMap:this.returnDependencies?xr:null,glyphPositions:this.returnDependencies?kr.positions:null}})}}function g(Se,re,ee){const fe=new u.z(re);for(const we of Se)we.recalculate(fe,ee)}class v{constructor(re,ee,fe){this.actor=re,this.layerIndex=ee,this.availableImages=fe,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(re,ee){return u._(this,void 0,void 0,function*(){const fe=yield u.l(re.request,ee);try{return{vectorTile:new u.bt.VectorTile(new u.bu(fe.data)),rawData:fe.data,cacheControl:fe.cacheControl,expires:fe.expires}}catch(we){const Me=new Uint8Array(fe.data);let Ne=`Unable to parse the tile at ${re.request.url}, `;throw Ne+=Me[0]===31&&Me[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${we.message}`,new Error(Ne)}})}loadTile(re){return u._(this,void 0,void 0,function*(){const ee=re.uid,fe=!!(re&&re.request&&re.request.collectResourceTiming)&&new u.bv(re.request),we=new p(re);this.loading[ee]=we;const Me=new AbortController;we.abort=Me;try{const Ne=yield this.loadVectorTile(re,Me);if(delete this.loading[ee],!Ne)return null;const Ve=Ne.rawData,ke={};Ne.expires&&(ke.expires=Ne.expires),Ne.cacheControl&&(ke.cacheControl=Ne.cacheControl);const Ye={};if(fe){const Xe=fe.finish();Xe&&(Ye.resourceTiming=JSON.parse(JSON.stringify(Xe)))}we.vectorTile=Ne.vectorTile;const ot=we.parse(Ne.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[ee]=we,this.fetching[ee]={rawTileData:Ve,cacheControl:ke,resourceTiming:Ye};try{const Xe=yield ot;return u.e({rawTileData:Ve.slice(0)},Xe,ke,Ye)}finally{delete this.fetching[ee]}}catch(Ne){throw delete this.loading[ee],we.status="done",this.loaded[ee]=we,Ne}})}reloadTile(re){return u._(this,void 0,void 0,function*(){const ee=re.uid;if(!this.loaded||!this.loaded[ee])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const fe=this.loaded[ee];if(fe.showCollisionBoxes=re.showCollisionBoxes,fe.status==="parsing"){const we=yield fe.parse(fe.vectorTile,this.layerIndex,this.availableImages,this.actor);let Me;if(this.fetching[ee]){const{rawTileData:Ne,cacheControl:Ve,resourceTiming:ke}=this.fetching[ee];delete this.fetching[ee],Me=u.e({rawTileData:Ne.slice(0)},we,Ve,ke)}else Me=we;return Me}if(fe.status==="done"&&fe.vectorTile)return fe.parse(fe.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(re){return u._(this,void 0,void 0,function*(){const ee=this.loading,fe=re.uid;ee&&ee[fe]&&ee[fe].abort&&(ee[fe].abort.abort(),delete ee[fe])})}removeTile(re){return u._(this,void 0,void 0,function*(){this.loaded&&this.loaded[re.uid]&&delete this.loaded[re.uid]})}}class _{constructor(){this.loaded={}}loadTile(re){return u._(this,void 0,void 0,function*(){const{uid:ee,encoding:fe,rawImageData:we,redFactor:Me,greenFactor:Ne,blueFactor:Ve,baseShift:ke}=re,Ye=we.width+2,ot=we.height+2,Xe=u.b(we)?new u.R({width:Ye,height:ot},yield u.bw(we,-1,-1,Ye,ot)):we,xt=new u.bx(ee,Xe,fe,Me,Ne,Ve,ke);return this.loaded=this.loaded||{},this.loaded[ee]=xt,xt})}removeTile(re){const ee=this.loaded,fe=re.uid;ee&&ee[fe]&&delete ee[fe]}}function b(Se,re){if(Se.length!==0){k(Se[0],re);for(var ee=1;ee<Se.length;ee++)k(Se[ee],!re)}}function k(Se,re){for(var ee=0,fe=0,we=0,Me=Se.length,Ne=Me-1;we<Me;Ne=we++){var Ve=(Se[we][0]-Se[Ne][0])*(Se[Ne][1]+Se[we][1]),ke=ee+Ve;fe+=Math.abs(ee)>=Math.abs(Ve)?ee-ke+Ve:Ve-ke+ee,ee=ke}ee+fe>=0!=!!re&&Se.reverse()}var A=u.by(function Se(re,ee){var fe,we=re&&re.type;if(we==="FeatureCollection")for(fe=0;fe<re.features.length;fe++)Se(re.features[fe],ee);else if(we==="GeometryCollection")for(fe=0;fe<re.geometries.length;fe++)Se(re.geometries[fe],ee);else if(we==="Feature")Se(re.geometry,ee);else if(we==="Polygon")b(re.coordinates,ee);else if(we==="MultiPolygon")for(fe=0;fe<re.coordinates.length;fe++)b(re.coordinates[fe],ee);return re});const M=u.bt.VectorTileFeature.prototype.toGeoJSON;var P={exports:{}},I=u.bz,z=u.bt.VectorTileFeature,O=V;function V(Se,re){this.options=re||{},this.features=Se,this.length=Se.length}function U(Se,re){this.id=typeof Se.id=="number"?Se.id:void 0,this.type=Se.type,this.rawGeometry=Se.type===1?[Se.geometry]:Se.geometry,this.properties=Se.tags,this.extent=re||4096}V.prototype.feature=function(Se){return new U(this.features[Se],this.options.extent)},U.prototype.loadGeometry=function(){var Se=this.rawGeometry;this.geometry=[];for(var re=0;re<Se.length;re++){for(var ee=Se[re],fe=[],we=0;we<ee.length;we++)fe.push(new I(ee[we][0],ee[we][1]));this.geometry.push(fe)}return this.geometry},U.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Se=this.geometry,re=1/0,ee=-1/0,fe=1/0,we=-1/0,Me=0;Me<Se.length;Me++)for(var Ne=Se[Me],Ve=0;Ve<Ne.length;Ve++){var ke=Ne[Ve];re=Math.min(re,ke.x),ee=Math.max(ee,ke.x),fe=Math.min(fe,ke.y),we=Math.max(we,ke.y)}return[re,fe,ee,we]},U.prototype.toGeoJSON=z.prototype.toGeoJSON;var $=u.bA,G=O;function Z(Se){var re=new $;return function(ee,fe){for(var we in ee.layers)fe.writeMessage(3,Q,ee.layers[we])}(Se,re),re.finish()}function Q(Se,re){var ee;re.writeVarintField(15,Se.version||1),re.writeStringField(1,Se.name||""),re.writeVarintField(5,Se.extent||4096);var fe={keys:[],values:[],keycache:{},valuecache:{}};for(ee=0;ee<Se.length;ee++)fe.feature=Se.feature(ee),re.writeMessage(2,X,fe);var we=fe.keys;for(ee=0;ee<we.length;ee++)re.writeStringField(3,we[ee]);var Me=fe.values;for(ee=0;ee<Me.length;ee++)re.writeMessage(4,se,Me[ee])}function X(Se,re){var ee=Se.feature;ee.id!==void 0&&re.writeVarintField(1,ee.id),re.writeMessage(2,ie,Se),re.writeVarintField(3,ee.type),re.writeMessage(4,oe,ee)}function ie(Se,re){var ee=Se.feature,fe=Se.keys,we=Se.values,Me=Se.keycache,Ne=Se.valuecache;for(var Ve in ee.properties){var ke=ee.properties[Ve],Ye=Me[Ve];if(ke!==null){Ye===void 0&&(fe.push(Ve),Me[Ve]=Ye=fe.length-1),re.writeVarint(Ye);var ot=typeof ke;ot!=="string"&&ot!=="boolean"&&ot!=="number"&&(ke=JSON.stringify(ke));var Xe=ot+":"+ke,xt=Ne[Xe];xt===void 0&&(we.push(ke),Ne[Xe]=xt=we.length-1),re.writeVarint(xt)}}}function te(Se,re){return(re<<3)+(7&Se)}function W(Se){return Se<<1^Se>>31}function oe(Se,re){for(var ee=Se.loadGeometry(),fe=Se.type,we=0,Me=0,Ne=ee.length,Ve=0;Ve<Ne;Ve++){var ke=ee[Ve],Ye=1;fe===1&&(Ye=ke.length),re.writeVarint(te(1,Ye));for(var ot=fe===3?ke.length-1:ke.length,Xe=0;Xe<ot;Xe++){Xe===1&&fe!==1&&re.writeVarint(te(2,ot-1));var xt=ke[Xe].x-we,Ct=ke[Xe].y-Me;re.writeVarint(W(xt)),re.writeVarint(W(Ct)),we+=xt,Me+=Ct}fe===3&&re.writeVarint(te(7,1))}}function se(Se,re){var ee=typeof Se;ee==="string"?re.writeStringField(1,Se):ee==="boolean"?re.writeBooleanField(7,Se):ee==="number"&&(Se%1!=0?re.writeDoubleField(3,Se):Se<0?re.writeSVarintField(6,Se):re.writeVarintField(5,Se))}P.exports=Z,P.exports.fromVectorTileJs=Z,P.exports.fromGeojsonVt=function(Se,re){re=re||{};var ee={};for(var fe in Se)ee[fe]=new G(Se[fe].features,re),ee[fe].name=fe,ee[fe].version=re.version,ee[fe].extent=re.extent;return Z({layers:ee})},P.exports.GeoJSONWrapper=G;var de=u.by(P.exports);const me={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Se=>Se},ae=Math.fround||(ve=new Float32Array(1),Se=>(ve[0]=+Se,ve[0]));var ve;const pe=3,_e=5,De=6;class Le{constructor(re){this.options=Object.assign(Object.create(me),re),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(re){const{log:ee,minZoom:fe,maxZoom:we}=this.options;ee&&console.time("total time");const Me=`prepare ${re.length} points`;ee&&console.time(Me),this.points=re;const Ne=[];for(let ke=0;ke<re.length;ke++){const Ye=re[ke];if(!Ye.geometry)continue;const[ot,Xe]=Ye.geometry.coordinates,xt=ae(et(ot)),Ct=ae(ft(Xe));Ne.push(xt,Ct,1/0,ke,-1,1),this.options.reduce&&Ne.push(0)}let Ve=this.trees[we+1]=this._createTree(Ne);ee&&console.timeEnd(Me);for(let ke=we;ke>=fe;ke--){const Ye=+Date.now();Ve=this.trees[ke]=this._createTree(this._cluster(Ve,ke)),ee&&console.log("z%d: %d clusters in %dms",ke,Ve.numItems,+Date.now()-Ye)}return ee&&console.timeEnd("total time"),this}getClusters(re,ee){let fe=((re[0]+180)%360+360)%360-180;const we=Math.max(-90,Math.min(90,re[1]));let Me=re[2]===180?180:((re[2]+180)%360+360)%360-180;const Ne=Math.max(-90,Math.min(90,re[3]));if(re[2]-re[0]>=360)fe=-180,Me=180;else if(fe>Me){const Xe=this.getClusters([fe,we,180,Ne],ee),xt=this.getClusters([-180,we,Me,Ne],ee);return Xe.concat(xt)}const Ve=this.trees[this._limitZoom(ee)],ke=Ve.range(et(fe),ft(Ne),et(Me),ft(we)),Ye=Ve.data,ot=[];for(const Xe of ke){const xt=this.stride*Xe;ot.push(Ye[xt+_e]>1?je(Ye,xt,this.clusterProps):this.points[Ye[xt+pe]])}return ot}getChildren(re){const ee=this._getOriginId(re),fe=this._getOriginZoom(re),we="No cluster with the specified id.",Me=this.trees[fe];if(!Me)throw new Error(we);const Ne=Me.data;if(ee*this.stride>=Ne.length)throw new Error(we);const Ve=this.options.radius/(this.options.extent*Math.pow(2,fe-1)),ke=Me.within(Ne[ee*this.stride],Ne[ee*this.stride+1],Ve),Ye=[];for(const ot of ke){const Xe=ot*this.stride;Ne[Xe+4]===re&&Ye.push(Ne[Xe+_e]>1?je(Ne,Xe,this.clusterProps):this.points[Ne[Xe+pe]])}if(Ye.length===0)throw new Error(we);return Ye}getLeaves(re,ee,fe){const we=[];return this._appendLeaves(we,re,ee=ee||10,fe=fe||0,0),we}getTile(re,ee,fe){const we=this.trees[this._limitZoom(re)],Me=Math.pow(2,re),{extent:Ne,radius:Ve}=this.options,ke=Ve/Ne,Ye=(fe-ke)/Me,ot=(fe+1+ke)/Me,Xe={features:[]};return this._addTileFeatures(we.range((ee-ke)/Me,Ye,(ee+1+ke)/Me,ot),we.data,ee,fe,Me,Xe),ee===0&&this._addTileFeatures(we.range(1-ke/Me,Ye,1,ot),we.data,Me,fe,Me,Xe),ee===Me-1&&this._addTileFeatures(we.range(0,Ye,ke/Me,ot),we.data,-1,fe,Me,Xe),Xe.features.length?Xe:null}getClusterExpansionZoom(re){let ee=this._getOriginZoom(re)-1;for(;ee<=this.options.maxZoom;){const fe=this.getChildren(re);if(ee++,fe.length!==1)break;re=fe[0].properties.cluster_id}return ee}_appendLeaves(re,ee,fe,we,Me){const Ne=this.getChildren(ee);for(const Ve of Ne){const ke=Ve.properties;if(ke&&ke.cluster?Me+ke.point_count<=we?Me+=ke.point_count:Me=this._appendLeaves(re,ke.cluster_id,fe,we,Me):Me<we?Me++:re.push(Ve),re.length===fe)break}return Me}_createTree(re){const ee=new u.av(re.length/this.stride|0,this.options.nodeSize,Float32Array);for(let fe=0;fe<re.length;fe+=this.stride)ee.add(re[fe],re[fe+1]);return ee.finish(),ee.data=re,ee}_addTileFeatures(re,ee,fe,we,Me,Ne){for(const Ve of re){const ke=Ve*this.stride,Ye=ee[ke+_e]>1;let ot,Xe,xt;if(Ye)ot=Je(ee,ke,this.clusterProps),Xe=ee[ke],xt=ee[ke+1];else{const gr=this.points[ee[ke+pe]];ot=gr.properties;const[ar,xr]=gr.geometry.coordinates;Xe=et(ar),xt=ft(xr)}const Ct={type:1,geometry:[[Math.round(this.options.extent*(Xe*Me-fe)),Math.round(this.options.extent*(xt*Me-we))]],tags:ot};let Ut;Ut=Ye||this.options.generateId?ee[ke+pe]:this.points[ee[ke+pe]].id,Ut!==void 0&&(Ct.id=Ut),Ne.features.push(Ct)}}_limitZoom(re){return Math.max(this.options.minZoom,Math.min(Math.floor(+re),this.options.maxZoom+1))}_cluster(re,ee){const{radius:fe,extent:we,reduce:Me,minPoints:Ne}=this.options,Ve=fe/(we*Math.pow(2,ee)),ke=re.data,Ye=[],ot=this.stride;for(let Xe=0;Xe<ke.length;Xe+=ot){if(ke[Xe+2]<=ee)continue;ke[Xe+2]=ee;const xt=ke[Xe],Ct=ke[Xe+1],Ut=re.within(ke[Xe],ke[Xe+1],Ve),gr=ke[Xe+_e];let ar=gr;for(const xr of Ut){const fr=xr*ot;ke[fr+2]>ee&&(ar+=ke[fr+_e])}if(ar>gr&&ar>=Ne){let xr,fr=xt*gr,kr=Ct*gr,_r=-1;const rr=((Xe/ot|0)<<5)+(ee+1)+this.points.length;for(const Er of Ut){const br=Er*ot;if(ke[br+2]<=ee)continue;ke[br+2]=ee;const cn=ke[br+_e];fr+=ke[br]*cn,kr+=ke[br+1]*cn,ke[br+4]=rr,Me&&(xr||(xr=this._map(ke,Xe,!0),_r=this.clusterProps.length,this.clusterProps.push(xr)),Me(xr,this._map(ke,br)))}ke[Xe+4]=rr,Ye.push(fr/ar,kr/ar,1/0,rr,-1,ar),Me&&Ye.push(_r)}else{for(let xr=0;xr<ot;xr++)Ye.push(ke[Xe+xr]);if(ar>1)for(const xr of Ut){const fr=xr*ot;if(!(ke[fr+2]<=ee)){ke[fr+2]=ee;for(let kr=0;kr<ot;kr++)Ye.push(ke[fr+kr])}}}}return Ye}_getOriginId(re){return re-this.points.length>>5}_getOriginZoom(re){return(re-this.points.length)%32}_map(re,ee,fe){if(re[ee+_e]>1){const Ne=this.clusterProps[re[ee+De]];return fe?Object.assign({},Ne):Ne}const we=this.points[re[ee+pe]].properties,Me=this.options.map(we);return fe&&Me===we?Object.assign({},Me):Me}}function je(Se,re,ee){return{type:"Feature",id:Se[re+pe],properties:Je(Se,re,ee),geometry:{type:"Point",coordinates:[(fe=Se[re],360*(fe-.5)),rt(Se[re+1])]}};var fe}function Je(Se,re,ee){const fe=Se[re+_e],we=fe>=1e4?`${Math.round(fe/1e3)}k`:fe>=1e3?Math.round(fe/100)/10+"k":fe,Me=Se[re+De],Ne=Me===-1?{}:Object.assign({},ee[Me]);return Object.assign(Ne,{cluster:!0,cluster_id:Se[re+pe],point_count:fe,point_count_abbreviated:we})}function et(Se){return Se/360+.5}function ft(Se){const re=Math.sin(Se*Math.PI/180),ee=.5-.25*Math.log((1+re)/(1-re))/Math.PI;return ee<0?0:ee>1?1:ee}function rt(Se){const re=(180-360*Se)*Math.PI/180;return 360*Math.atan(Math.exp(re))/Math.PI-90}function Oe(Se,re,ee,fe){let we=fe;const Me=re+(ee-re>>1);let Ne,Ve=ee-re;const ke=Se[re],Ye=Se[re+1],ot=Se[ee],Xe=Se[ee+1];for(let xt=re+3;xt<ee;xt+=3){const Ct=Ge(Se[xt],Se[xt+1],ke,Ye,ot,Xe);if(Ct>we)Ne=xt,we=Ct;else if(Ct===we){const Ut=Math.abs(xt-Me);Ut<Ve&&(Ne=xt,Ve=Ut)}}we>fe&&(Ne-re>3&&Oe(Se,re,Ne,fe),Se[Ne+2]=we,ee-Ne>3&&Oe(Se,Ne,ee,fe))}function Ge(Se,re,ee,fe,we,Me){let Ne=we-ee,Ve=Me-fe;if(Ne!==0||Ve!==0){const ke=((Se-ee)*Ne+(re-fe)*Ve)/(Ne*Ne+Ve*Ve);ke>1?(ee=we,fe=Me):ke>0&&(ee+=Ne*ke,fe+=Ve*ke)}return Ne=Se-ee,Ve=re-fe,Ne*Ne+Ve*Ve}function Ze(Se,re,ee,fe){const we={id:Se??null,type:re,geometry:ee,tags:fe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(re==="Point"||re==="MultiPoint"||re==="LineString")it(we,ee);else if(re==="Polygon")it(we,ee[0]);else if(re==="MultiLineString")for(const Me of ee)it(we,Me);else if(re==="MultiPolygon")for(const Me of ee)it(we,Me[0]);return we}function it(Se,re){for(let ee=0;ee<re.length;ee+=3)Se.minX=Math.min(Se.minX,re[ee]),Se.minY=Math.min(Se.minY,re[ee+1]),Se.maxX=Math.max(Se.maxX,re[ee]),Se.maxY=Math.max(Se.maxY,re[ee+1])}function mt(Se,re,ee,fe){if(!re.geometry)return;const we=re.geometry.coordinates;if(we&&we.length===0)return;const Me=re.geometry.type,Ne=Math.pow(ee.tolerance/((1<<ee.maxZoom)*ee.extent),2);let Ve=[],ke=re.id;if(ee.promoteId?ke=re.properties[ee.promoteId]:ee.generateId&&(ke=fe||0),Me==="Point")Tt(we,Ve);else if(Me==="MultiPoint")for(const Ye of we)Tt(Ye,Ve);else if(Me==="LineString")$e(we,Ve,Ne,!1);else if(Me==="MultiLineString"){if(ee.lineMetrics){for(const Ye of we)Ve=[],$e(Ye,Ve,Ne,!1),Se.push(Ze(ke,"LineString",Ve,re.properties));return}At(we,Ve,Ne,!1)}else if(Me==="Polygon")At(we,Ve,Ne,!0);else{if(Me!=="MultiPolygon"){if(Me==="GeometryCollection"){for(const Ye of re.geometry.geometries)mt(Se,{id:ke,geometry:Ye,properties:re.properties},ee,fe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ye of we){const ot=[];At(Ye,ot,Ne,!0),Ve.push(ot)}}Se.push(Ze(ke,Me,Ve,re.properties))}function Tt(Se,re){re.push(pt(Se[0]),yt(Se[1]),0)}function $e(Se,re,ee,fe){let we,Me,Ne=0;for(let ke=0;ke<Se.length;ke++){const Ye=pt(Se[ke][0]),ot=yt(Se[ke][1]);re.push(Ye,ot,0),ke>0&&(Ne+=fe?(we*ot-Ye*Me)/2:Math.sqrt(Math.pow(Ye-we,2)+Math.pow(ot-Me,2))),we=Ye,Me=ot}const Ve=re.length-3;re[2]=1,Oe(re,0,Ve,ee),re[Ve+2]=1,re.size=Math.abs(Ne),re.start=0,re.end=re.size}function At(Se,re,ee,fe){for(let we=0;we<Se.length;we++){const Me=[];$e(Se[we],Me,ee,fe),re.push(Me)}}function pt(Se){return Se/360+.5}function yt(Se){const re=Math.sin(Se*Math.PI/180),ee=.5-.25*Math.log((1+re)/(1-re))/Math.PI;return ee<0?0:ee>1?1:ee}function gt(Se,re,ee,fe,we,Me,Ne,Ve){if(fe/=re,Me>=(ee/=re)&&Ne<fe)return Se;if(Ne<ee||Me>=fe)return null;const ke=[];for(const Ye of Se){const ot=Ye.geometry;let Xe=Ye.type;const xt=we===0?Ye.minX:Ye.minY,Ct=we===0?Ye.maxX:Ye.maxY;if(xt>=ee&&Ct<fe){ke.push(Ye);continue}if(Ct<ee||xt>=fe)continue;let Ut=[];if(Xe==="Point"||Xe==="MultiPoint")qt(ot,Ut,ee,fe,we);else if(Xe==="LineString")$t(ot,Ut,ee,fe,we,!1,Ve.lineMetrics);else if(Xe==="MultiLineString")Vt(ot,Ut,ee,fe,we,!1);else if(Xe==="Polygon")Vt(ot,Ut,ee,fe,we,!0);else if(Xe==="MultiPolygon")for(const gr of ot){const ar=[];Vt(gr,ar,ee,fe,we,!0),ar.length&&Ut.push(ar)}if(Ut.length){if(Ve.lineMetrics&&Xe==="LineString"){for(const gr of Ut)ke.push(Ze(Ye.id,Xe,gr,Ye.tags));continue}Xe!=="LineString"&&Xe!=="MultiLineString"||(Ut.length===1?(Xe="LineString",Ut=Ut[0]):Xe="MultiLineString"),Xe!=="Point"&&Xe!=="MultiPoint"||(Xe=Ut.length===3?"Point":"MultiPoint"),ke.push(Ze(Ye.id,Xe,Ut,Ye.tags))}}return ke.length?ke:null}function qt(Se,re,ee,fe,we){for(let Me=0;Me<Se.length;Me+=3){const Ne=Se[Me+we];Ne>=ee&&Ne<=fe&&tr(re,Se[Me],Se[Me+1],Se[Me+2])}}function $t(Se,re,ee,fe,we,Me,Ne){let Ve=er(Se);const ke=we===0?pr:vr;let Ye,ot,Xe=Se.start;for(let ar=0;ar<Se.length-3;ar+=3){const xr=Se[ar],fr=Se[ar+1],kr=Se[ar+2],_r=Se[ar+3],rr=Se[ar+4],Er=we===0?xr:fr,br=we===0?_r:rr;let cn=!1;Ne&&(Ye=Math.sqrt(Math.pow(xr-_r,2)+Math.pow(fr-rr,2))),Er<ee?br>ee&&(ot=ke(Ve,xr,fr,_r,rr,ee),Ne&&(Ve.start=Xe+Ye*ot)):Er>fe?br<fe&&(ot=ke(Ve,xr,fr,_r,rr,fe),Ne&&(Ve.start=Xe+Ye*ot)):tr(Ve,xr,fr,kr),br<ee&&Er>=ee&&(ot=ke(Ve,xr,fr,_r,rr,ee),cn=!0),br>fe&&Er<=fe&&(ot=ke(Ve,xr,fr,_r,rr,fe),cn=!0),!Me&&cn&&(Ne&&(Ve.end=Xe+Ye*ot),re.push(Ve),Ve=er(Se)),Ne&&(Xe+=Ye)}let xt=Se.length-3;const Ct=Se[xt],Ut=Se[xt+1],gr=we===0?Ct:Ut;gr>=ee&&gr<=fe&&tr(Ve,Ct,Ut,Se[xt+2]),xt=Ve.length-3,Me&&xt>=3&&(Ve[xt]!==Ve[0]||Ve[xt+1]!==Ve[1])&&tr(Ve,Ve[0],Ve[1],Ve[2]),Ve.length&&re.push(Ve)}function er(Se){const re=[];return re.size=Se.size,re.start=Se.start,re.end=Se.end,re}function Vt(Se,re,ee,fe,we,Me){for(const Ne of Se)$t(Ne,re,ee,fe,we,Me,!1)}function tr(Se,re,ee,fe){Se.push(re,ee,fe)}function pr(Se,re,ee,fe,we,Me){const Ne=(Me-re)/(fe-re);return tr(Se,Me,ee+(we-ee)*Ne,1),Ne}function vr(Se,re,ee,fe,we,Me){const Ne=(Me-ee)/(we-ee);return tr(Se,re+(fe-re)*Ne,Me,1),Ne}function lt(Se,re){const ee=[];for(let fe=0;fe<Se.length;fe++){const we=Se[fe],Me=we.type;let Ne;if(Me==="Point"||Me==="MultiPoint"||Me==="LineString")Ne=mr(we.geometry,re);else if(Me==="MultiLineString"||Me==="Polygon"){Ne=[];for(const Ve of we.geometry)Ne.push(mr(Ve,re))}else if(Me==="MultiPolygon"){Ne=[];for(const Ve of we.geometry){const ke=[];for(const Ye of Ve)ke.push(mr(Ye,re));Ne.push(ke)}}ee.push(Ze(we.id,Me,Ne,we.tags))}return ee}function mr(Se,re){const ee=[];ee.size=Se.size,Se.start!==void 0&&(ee.start=Se.start,ee.end=Se.end);for(let fe=0;fe<Se.length;fe+=3)ee.push(Se[fe]+re,Se[fe+1],Se[fe+2]);return ee}function Ht(Se,re){if(Se.transformed)return Se;const ee=1<<Se.z,fe=Se.x,we=Se.y;for(const Me of Se.features){const Ne=Me.geometry,Ve=Me.type;if(Me.geometry=[],Ve===1)for(let ke=0;ke<Ne.length;ke+=2)Me.geometry.push(wt(Ne[ke],Ne[ke+1],re,ee,fe,we));else for(let ke=0;ke<Ne.length;ke++){const Ye=[];for(let ot=0;ot<Ne[ke].length;ot+=2)Ye.push(wt(Ne[ke][ot],Ne[ke][ot+1],re,ee,fe,we));Me.geometry.push(Ye)}}return Se.transformed=!0,Se}function wt(Se,re,ee,fe,we,Me){return[Math.round(ee*(Se*fe-we)),Math.round(ee*(re*fe-Me))]}function at(Se,re,ee,fe,we){const Me=re===we.maxZoom?0:we.tolerance/((1<<re)*we.extent),Ne={features:[],numPoints:0,numSimplified:0,numFeatures:Se.length,source:null,x:ee,y:fe,z:re,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ve of Se)le(Ne,Ve,Me,we);return Ne}function le(Se,re,ee,fe){const we=re.geometry,Me=re.type,Ne=[];if(Se.minX=Math.min(Se.minX,re.minX),Se.minY=Math.min(Se.minY,re.minY),Se.maxX=Math.max(Se.maxX,re.maxX),Se.maxY=Math.max(Se.maxY,re.maxY),Me==="Point"||Me==="MultiPoint")for(let Ve=0;Ve<we.length;Ve+=3)Ne.push(we[Ve],we[Ve+1]),Se.numPoints++,Se.numSimplified++;else if(Me==="LineString")Be(Ne,we,Se,ee,!1,!1);else if(Me==="MultiLineString"||Me==="Polygon")for(let Ve=0;Ve<we.length;Ve++)Be(Ne,we[Ve],Se,ee,Me==="Polygon",Ve===0);else if(Me==="MultiPolygon")for(let Ve=0;Ve<we.length;Ve++){const ke=we[Ve];for(let Ye=0;Ye<ke.length;Ye++)Be(Ne,ke[Ye],Se,ee,!0,Ye===0)}if(Ne.length){let Ve=re.tags||null;if(Me==="LineString"&&fe.lineMetrics){Ve={};for(const Ye in re.tags)Ve[Ye]=re.tags[Ye];Ve.mapbox_clip_start=we.start/we.size,Ve.mapbox_clip_end=we.end/we.size}const ke={geometry:Ne,type:Me==="Polygon"||Me==="MultiPolygon"?3:Me==="LineString"||Me==="MultiLineString"?2:1,tags:Ve};re.id!==null&&(ke.id=re.id),Se.features.push(ke)}}function Be(Se,re,ee,fe,we,Me){const Ne=fe*fe;if(fe>0&&re.size<(we?Ne:fe))return void(ee.numPoints+=re.length/3);const Ve=[];for(let ke=0;ke<re.length;ke+=3)(fe===0||re[ke+2]>Ne)&&(ee.numSimplified++,Ve.push(re[ke],re[ke+1])),ee.numPoints++;we&&function(ke,Ye){let ot=0;for(let Xe=0,xt=ke.length,Ct=xt-2;Xe<xt;Ct=Xe,Xe+=2)ot+=(ke[Xe]-ke[Ct])*(ke[Xe+1]+ke[Ct+1]);if(ot>0===Ye)for(let Xe=0,xt=ke.length;Xe<xt/2;Xe+=2){const Ct=ke[Xe],Ut=ke[Xe+1];ke[Xe]=ke[xt-2-Xe],ke[Xe+1]=ke[xt-1-Xe],ke[xt-2-Xe]=Ct,ke[xt-1-Xe]=Ut}}(Ve,Me),Se.push(Ve)}const Ue={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class tt{constructor(re,ee){const fe=(ee=this.options=function(Me,Ne){for(const Ve in Ne)Me[Ve]=Ne[Ve];return Me}(Object.create(Ue),ee)).debug;if(fe&&console.time("preprocess data"),ee.maxZoom<0||ee.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ee.promoteId&&ee.generateId)throw new Error("promoteId and generateId cannot be used together.");let we=function(Me,Ne){const Ve=[];if(Me.type==="FeatureCollection")for(let ke=0;ke<Me.features.length;ke++)mt(Ve,Me.features[ke],Ne,ke);else mt(Ve,Me.type==="Feature"?Me:{geometry:Me},Ne);return Ve}(re,ee);this.tiles={},this.tileCoords=[],fe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ee.indexMaxZoom,ee.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),we=function(Me,Ne){const Ve=Ne.buffer/Ne.extent;let ke=Me;const Ye=gt(Me,1,-1-Ve,Ve,0,-1,2,Ne),ot=gt(Me,1,1-Ve,2+Ve,0,-1,2,Ne);return(Ye||ot)&&(ke=gt(Me,1,-Ve,1+Ve,0,-1,2,Ne)||[],Ye&&(ke=lt(Ye,1).concat(ke)),ot&&(ke=ke.concat(lt(ot,-1)))),ke}(we,ee),we.length&&this.splitTile(we,0,0,0),fe&&(we.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(re,ee,fe,we,Me,Ne,Ve){const ke=[re,ee,fe,we],Ye=this.options,ot=Ye.debug;for(;ke.length;){we=ke.pop(),fe=ke.pop(),ee=ke.pop(),re=ke.pop();const Xe=1<<ee,xt=st(ee,fe,we);let Ct=this.tiles[xt];if(!Ct&&(ot>1&&console.time("creation"),Ct=this.tiles[xt]=at(re,ee,fe,we,Ye),this.tileCoords.push({z:ee,x:fe,y:we}),ot)){ot>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ee,fe,we,Ct.numFeatures,Ct.numPoints,Ct.numSimplified),console.timeEnd("creation"));const cn=`z${ee}`;this.stats[cn]=(this.stats[cn]||0)+1,this.total++}if(Ct.source=re,Me==null){if(ee===Ye.indexMaxZoom||Ct.numPoints<=Ye.indexMaxPoints)continue}else{if(ee===Ye.maxZoom||ee===Me)continue;if(Me!=null){const cn=Me-ee;if(fe!==Ne>>cn||we!==Ve>>cn)continue}}if(Ct.source=null,re.length===0)continue;ot>1&&console.time("clipping");const Ut=.5*Ye.buffer/Ye.extent,gr=.5-Ut,ar=.5+Ut,xr=1+Ut;let fr=null,kr=null,_r=null,rr=null,Er=gt(re,Xe,fe-Ut,fe+ar,0,Ct.minX,Ct.maxX,Ye),br=gt(re,Xe,fe+gr,fe+xr,0,Ct.minX,Ct.maxX,Ye);re=null,Er&&(fr=gt(Er,Xe,we-Ut,we+ar,1,Ct.minY,Ct.maxY,Ye),kr=gt(Er,Xe,we+gr,we+xr,1,Ct.minY,Ct.maxY,Ye),Er=null),br&&(_r=gt(br,Xe,we-Ut,we+ar,1,Ct.minY,Ct.maxY,Ye),rr=gt(br,Xe,we+gr,we+xr,1,Ct.minY,Ct.maxY,Ye),br=null),ot>1&&console.timeEnd("clipping"),ke.push(fr||[],ee+1,2*fe,2*we),ke.push(kr||[],ee+1,2*fe,2*we+1),ke.push(_r||[],ee+1,2*fe+1,2*we),ke.push(rr||[],ee+1,2*fe+1,2*we+1)}}getTile(re,ee,fe){re=+re,ee=+ee,fe=+fe;const we=this.options,{extent:Me,debug:Ne}=we;if(re<0||re>24)return null;const Ve=1<<re,ke=st(re,ee=ee+Ve&Ve-1,fe);if(this.tiles[ke])return Ht(this.tiles[ke],Me);Ne>1&&console.log("drilling down to z%d-%d-%d",re,ee,fe);let Ye,ot=re,Xe=ee,xt=fe;for(;!Ye&&ot>0;)ot--,Xe>>=1,xt>>=1,Ye=this.tiles[st(ot,Xe,xt)];return Ye&&Ye.source?(Ne>1&&(console.log("found parent tile z%d-%d-%d",ot,Xe,xt),console.time("drilling down")),this.splitTile(Ye.source,ot,Xe,xt,re,ee,fe),Ne>1&&console.timeEnd("drilling down"),this.tiles[ke]?Ht(this.tiles[ke],Me):null):null}}function st(Se,re,ee){return 32*((1<<Se)*ee+re)+Se}function dt(Se,re){return re?Se.properties[re]:Se.id}function ht(Se,re){if(Se==null)return!0;if(Se.type==="Feature")return dt(Se,re)!=null;if(Se.type==="FeatureCollection"){const ee=new Set;for(const fe of Se.features){const we=dt(fe,re);if(we==null||ee.has(we))return!1;ee.add(we)}return!0}return!1}function Ot(Se,re){const ee=new Map;if(Se!=null)if(Se.type==="Feature")ee.set(dt(Se,re),Se);else for(const fe of Se.features)ee.set(dt(fe,re),fe);return ee}class Lt extends v{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(re,ee){return u._(this,void 0,void 0,function*(){const fe=re.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const we=this._geoJSONIndex.getTile(fe.z,fe.x,fe.y);if(!we)return null;const Me=new class{constructor(Ve){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=u.X,this.length=Ve.length,this._features=Ve}feature(Ve){return new class{constructor(ke){this._feature=ke,this.extent=u.X,this.type=ke.type,this.properties=ke.tags,"id"in ke&&!isNaN(ke.id)&&(this.id=parseInt(ke.id,10))}loadGeometry(){if(this._feature.type===1){const ke=[];for(const Ye of this._feature.geometry)ke.push([new u.P(Ye[0],Ye[1])]);return ke}{const ke=[];for(const Ye of this._feature.geometry){const ot=[];for(const Xe of Ye)ot.push(new u.P(Xe[0],Xe[1]));ke.push(ot)}return ke}}toGeoJSON(ke,Ye,ot){return M.call(this,ke,Ye,ot)}}(this._features[Ve])}}(we.features);let Ne=de(Me);return Ne.byteOffset===0&&Ne.byteLength===Ne.buffer.byteLength||(Ne=new Uint8Array(Ne)),{vectorTile:Me,rawData:Ne.buffer}})}loadData(re){return u._(this,void 0,void 0,function*(){var ee;(ee=this._pendingRequest)===null||ee===void 0||ee.abort();const fe=!!(re&&re.request&&re.request.collectResourceTiming)&&new u.bv(re.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(re,this._pendingRequest),this._geoJSONIndex=re.cluster?new Le(function({superclusterOptions:Ne,clusterProperties:Ve}){if(!Ve||!Ne)return Ne;const ke={},Ye={},ot={accumulated:null,zoom:0},Xe={properties:null},xt=Object.keys(Ve);for(const Ct of xt){const[Ut,gr]=Ve[Ct],ar=u.bC(gr),xr=u.bC(typeof Ut=="string"?[Ut,["accumulated"],["get",Ct]]:Ut);ke[Ct]=ar.value,Ye[Ct]=xr.value}return Ne.map=Ct=>{Xe.properties=Ct;const Ut={};for(const gr of xt)Ut[gr]=ke[gr].evaluate(ot,Xe);return Ut},Ne.reduce=(Ct,Ut)=>{Xe.properties=Ut;for(const gr of xt)ot.accumulated=Ct[gr],Ct[gr]=Ye[gr].evaluate(ot,Xe)},Ne}(re)).load((yield this._pendingData).features):(we=yield this._pendingData,new tt(we,re.geojsonVtOptions)),this.loaded={};const Me={};if(fe){const Ne=fe.finish();Ne&&(Me.resourceTiming={},Me.resourceTiming[re.source]=JSON.parse(JSON.stringify(Ne)))}return Me}catch(Me){if(delete this._pendingRequest,u.bB(Me))return{abandoned:!0};throw Me}var we})}getData(){return u._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(re){const ee=this.loaded;return ee&&ee[re.uid]?super.reloadTile(re):this.loadTile(re)}loadAndProcessGeoJSON(re,ee){return u._(this,void 0,void 0,function*(){let fe=yield this.loadGeoJSON(re,ee);if(delete this._pendingRequest,typeof fe!="object")throw new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`);if(A(fe,!0),re.filter){const we=u.bC(re.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(we.result==="error")throw new Error(we.value.map(Ne=>`${Ne.key}: ${Ne.message}`).join(", "));fe={type:"FeatureCollection",features:fe.features.filter(Ne=>we.value.evaluate({zoom:0},Ne))}}return fe})}loadGeoJSON(re,ee){return u._(this,void 0,void 0,function*(){const{promoteId:fe}=re;if(re.request){const we=yield u.h(re.request,ee);return this._dataUpdateable=ht(we.data,fe)?Ot(we.data,fe):void 0,we.data}if(typeof re.data=="string")try{const we=JSON.parse(re.data);return this._dataUpdateable=ht(we,fe)?Ot(we,fe):void 0,we}catch{throw new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`)}if(!re.dataDiff)throw new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${re.source}`);return function(we,Me,Ne){var Ve,ke,Ye,ot;if(Me.removeAll&&we.clear(),Me.remove)for(const Xe of Me.remove)we.delete(Xe);if(Me.add)for(const Xe of Me.add){const xt=dt(Xe,Ne);xt!=null&&we.set(xt,Xe)}if(Me.update)for(const Xe of Me.update){let xt=we.get(Xe.id);if(xt==null)continue;const Ct=!Xe.removeAllProperties&&(((Ve=Xe.removeProperties)===null||Ve===void 0?void 0:Ve.length)>0||((ke=Xe.addOrUpdateProperties)===null||ke===void 0?void 0:ke.length)>0);if((Xe.newGeometry||Xe.removeAllProperties||Ct)&&(xt=Object.assign({},xt),we.set(Xe.id,xt),Ct&&(xt.properties=Object.assign({},xt.properties))),Xe.newGeometry&&(xt.geometry=Xe.newGeometry),Xe.removeAllProperties)xt.properties={};else if(((Ye=Xe.removeProperties)===null||Ye===void 0?void 0:Ye.length)>0)for(const Ut of Xe.removeProperties)Object.prototype.hasOwnProperty.call(xt.properties,Ut)&&delete xt.properties[Ut];if(((ot=Xe.addOrUpdateProperties)===null||ot===void 0?void 0:ot.length)>0)for(const{key:Ut,value:gr}of Xe.addOrUpdateProperties)xt.properties[Ut]=gr}}(this._dataUpdateable,re.dataDiff,fe),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(re){return u._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(re){return this._geoJSONIndex.getClusterExpansionZoom(re.clusterId)}getClusterChildren(re){return this._geoJSONIndex.getChildren(re.clusterId)}getClusterLeaves(re){return this._geoJSONIndex.getLeaves(re.clusterId,re.limit,re.offset)}}class Kt{constructor(re){this.self=re,this.actor=new u.F(re),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(ee,fe)=>{if(this.externalWorkerSourceTypes[ee])throw new Error(`Worker source with name "${ee}" already registered.`);this.externalWorkerSourceTypes[ee]=fe},this.self.addProtocol=u.bi,this.self.removeProtocol=u.bj,this.self.registerRTLTextPlugin=ee=>{if(u.bD.isParsed())throw new Error("RTL text plugin already registered.");u.bD.setMethods(ee)},this.actor.registerMessageHandler("LDT",(ee,fe)=>this._getDEMWorkerSource(ee,fe.source).loadTile(fe)),this.actor.registerMessageHandler("RDT",(ee,fe)=>u._(this,void 0,void 0,function*(){this._getDEMWorkerSource(ee,fe.source).removeTile(fe)})),this.actor.registerMessageHandler("GCEZ",(ee,fe)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(ee,fe.type,fe.source).getClusterExpansionZoom(fe)})),this.actor.registerMessageHandler("GCC",(ee,fe)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(ee,fe.type,fe.source).getClusterChildren(fe)})),this.actor.registerMessageHandler("GCL",(ee,fe)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(ee,fe.type,fe.source).getClusterLeaves(fe)})),this.actor.registerMessageHandler("LD",(ee,fe)=>this._getWorkerSource(ee,fe.type,fe.source).loadData(fe)),this.actor.registerMessageHandler("GD",(ee,fe)=>this._getWorkerSource(ee,fe.type,fe.source).getData()),this.actor.registerMessageHandler("LT",(ee,fe)=>this._getWorkerSource(ee,fe.type,fe.source).loadTile(fe)),this.actor.registerMessageHandler("RT",(ee,fe)=>this._getWorkerSource(ee,fe.type,fe.source).reloadTile(fe)),this.actor.registerMessageHandler("AT",(ee,fe)=>this._getWorkerSource(ee,fe.type,fe.source).abortTile(fe)),this.actor.registerMessageHandler("RMT",(ee,fe)=>this._getWorkerSource(ee,fe.type,fe.source).removeTile(fe)),this.actor.registerMessageHandler("RS",(ee,fe)=>u._(this,void 0,void 0,function*(){if(!this.workerSources[ee]||!this.workerSources[ee][fe.type]||!this.workerSources[ee][fe.type][fe.source])return;const we=this.workerSources[ee][fe.type][fe.source];delete this.workerSources[ee][fe.type][fe.source],we.removeSource!==void 0&&we.removeSource(fe)})),this.actor.registerMessageHandler("RM",ee=>u._(this,void 0,void 0,function*(){delete this.layerIndexes[ee],delete this.availableImages[ee],delete this.workerSources[ee],delete this.demWorkerSources[ee]})),this.actor.registerMessageHandler("SR",(ee,fe)=>u._(this,void 0,void 0,function*(){this.referrer=fe})),this.actor.registerMessageHandler("SRPS",(ee,fe)=>this._syncRTLPluginState(ee,fe)),this.actor.registerMessageHandler("IS",(ee,fe)=>u._(this,void 0,void 0,function*(){this.self.importScripts(fe)})),this.actor.registerMessageHandler("SI",(ee,fe)=>this._setImages(ee,fe)),this.actor.registerMessageHandler("UL",(ee,fe)=>u._(this,void 0,void 0,function*(){this._getLayerIndex(ee).update(fe.layers,fe.removedIds)})),this.actor.registerMessageHandler("SL",(ee,fe)=>u._(this,void 0,void 0,function*(){this._getLayerIndex(ee).replace(fe)}))}_setImages(re,ee){return u._(this,void 0,void 0,function*(){this.availableImages[re]=ee;for(const fe in this.workerSources[re]){const we=this.workerSources[re][fe];for(const Me in we)we[Me].availableImages=ee}})}_syncRTLPluginState(re,ee){return u._(this,void 0,void 0,function*(){if(u.bD.isParsed())return u.bD.getState();if(ee.pluginStatus!=="loading")return u.bD.setState(ee),ee;const fe=ee.pluginURL;if(this.self.importScripts(fe),u.bD.isParsed()){const we={pluginStatus:"loaded",pluginURL:fe};return u.bD.setState(we),we}throw u.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${fe}`)})}_getAvailableImages(re){let ee=this.availableImages[re];return ee||(ee=[]),ee}_getLayerIndex(re){let ee=this.layerIndexes[re];return ee||(ee=this.layerIndexes[re]=new a),ee}_getWorkerSource(re,ee,fe){if(this.workerSources[re]||(this.workerSources[re]={}),this.workerSources[re][ee]||(this.workerSources[re][ee]={}),!this.workerSources[re][ee][fe]){const we={sendAsync:(Me,Ne)=>(Me.targetMapId=re,this.actor.sendAsync(Me,Ne))};switch(ee){case"vector":this.workerSources[re][ee][fe]=new v(we,this._getLayerIndex(re),this._getAvailableImages(re));break;case"geojson":this.workerSources[re][ee][fe]=new Lt(we,this._getLayerIndex(re),this._getAvailableImages(re));break;default:this.workerSources[re][ee][fe]=new this.externalWorkerSourceTypes[ee](we,this._getLayerIndex(re),this._getAvailableImages(re))}}return this.workerSources[re][ee][fe]}_getDEMWorkerSource(re,ee){return this.demWorkerSources[re]||(this.demWorkerSources[re]={}),this.demWorkerSources[re][ee]||(this.demWorkerSources[re][ee]=new _),this.demWorkerSources[re][ee]}}return u.i(self)&&(self.worker=new Kt(self)),Kt}),i("index",["exports","./shared"],function(u,a){var d="4.7.1";let p,g;const v={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:E=>new Promise((o,f)=>{const y=requestAnimationFrame(o);E.signal.addEventListener("abort",()=>{cancelAnimationFrame(y),f(a.c())})}),getImageData(E,o=0){return this.getImageCanvasContext(E).getImageData(-o,-o,E.width+2*o,E.height+2*o)},getImageCanvasContext(E){const o=window.document.createElement("canvas"),f=o.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return o.width=E.width,o.height=E.height,f.drawImage(E,0,0,E.width,E.height),f},resolveURL:E=>(p||(p=document.createElement("a")),p.href=E,p.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(g==null&&(g=matchMedia("(prefers-reduced-motion: reduce)")),g.matches)}};class _{static testProp(o){if(!_.docStyle)return o[0];for(let f=0;f<o.length;f++)if(o[f]in _.docStyle)return o[f];return o[0]}static create(o,f,y){const x=window.document.createElement(o);return f!==void 0&&(x.className=f),y&&y.appendChild(x),x}static createNS(o,f){return window.document.createElementNS(o,f)}static disableDrag(){_.docStyle&&_.selectProp&&(_.userSelect=_.docStyle[_.selectProp],_.docStyle[_.selectProp]="none")}static enableDrag(){_.docStyle&&_.selectProp&&(_.docStyle[_.selectProp]=_.userSelect)}static setTransform(o,f){o.style[_.transformProp]=f}static addEventListener(o,f,y,x={}){o.addEventListener(f,y,"passive"in x?x:x.capture)}static removeEventListener(o,f,y,x={}){o.removeEventListener(f,y,"passive"in x?x:x.capture)}static suppressClickInternal(o){o.preventDefault(),o.stopPropagation(),window.removeEventListener("click",_.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",_.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",_.suppressClickInternal,!0)},0)}static getScale(o){const f=o.getBoundingClientRect();return{x:f.width/o.offsetWidth||1,y:f.height/o.offsetHeight||1,boundingClientRect:f}}static getPoint(o,f,y){const x=f.boundingClientRect;return new a.P((y.clientX-x.left)/f.x-o.clientLeft,(y.clientY-x.top)/f.y-o.clientTop)}static mousePos(o,f){const y=_.getScale(o);return _.getPoint(o,y,f)}static touchPos(o,f){const y=[],x=_.getScale(o);for(let S=0;S<f.length;S++)y.push(_.getPoint(o,x,f[S]));return y}static mouseButton(o){return o.button}static remove(o){o.parentNode&&o.parentNode.removeChild(o)}}_.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,_.selectProp=_.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),_.transformProp=_.testProp(["transform","WebkitTransform"]);const b={supported:!1,testSupport:function(E){!M&&A&&(P?I(E):k=E)}};let k,A,M=!1,P=!1;function I(E){const o=E.createTexture();E.bindTexture(E.TEXTURE_2D,o);try{if(E.texImage2D(E.TEXTURE_2D,0,E.RGBA,E.RGBA,E.UNSIGNED_BYTE,A),E.isContextLost())return;b.supported=!0}catch{}E.deleteTexture(o),M=!0}var z;typeof document<"u"&&(A=document.createElement("img"),A.onload=()=>{k&&I(k),k=null,P=!0},A.onerror=()=>{M=!0,k=null},A.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(E){let o,f,y,x;E.resetRequestQueue=()=>{o=[],f=0,y=0,x={}},E.addThrottleControl=F=>{const H=y++;return x[H]=F,H},E.removeThrottleControl=F=>{delete x[F],R()},E.getImage=(F,H,Y=!0)=>new Promise((J,he)=>{b.supported&&(F.headers||(F.headers={}),F.headers.accept="image/webp,*/*"),a.e(F,{type:"image"}),o.push({abortController:H,requestParameters:F,supportImageRefresh:Y,state:"queued",onError:xe=>{he(xe)},onSuccess:xe=>{J(xe)}}),R()});const S=F=>a._(this,void 0,void 0,function*(){F.state="running";const{requestParameters:H,supportImageRefresh:Y,onError:J,onSuccess:he,abortController:xe}=F,be=Y===!1&&!a.i(self)&&!a.g(H.url)&&(!H.headers||Object.keys(H.headers).reduce((Ae,ze)=>Ae&&ze==="accept",!0));f++;const Ce=be?B(H,xe):a.m(H,xe);try{const Ae=yield Ce;delete F.abortController,F.state="completed",Ae.data instanceof HTMLImageElement||a.b(Ae.data)?he(Ae):Ae.data&&he({data:yield(Ie=Ae.data,typeof createImageBitmap=="function"?a.d(Ie):a.f(Ie)),cacheControl:Ae.cacheControl,expires:Ae.expires})}catch(Ae){delete F.abortController,J(Ae)}finally{f--,R()}var Ie}),R=()=>{const F=(()=>{for(const H of Object.keys(x))if(x[H]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let H=f;H<F&&o.length>0;H++){const Y=o.shift();Y.abortController.signal.aborted?H--:S(Y)}},B=(F,H)=>new Promise((Y,J)=>{const he=new Image,xe=F.url,be=F.credentials;be&&be==="include"?he.crossOrigin="use-credentials":(be&&be==="same-origin"||!a.s(xe))&&(he.crossOrigin="anonymous"),H.signal.addEventListener("abort",()=>{he.src="",J(a.c())}),he.fetchPriority="high",he.onload=()=>{he.onerror=he.onload=null,Y({data:he})},he.onerror=()=>{he.onerror=he.onload=null,H.signal.aborted||J(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},he.src=xe})}(z||(z={})),z.resetRequestQueue();class O{constructor(o){this._transformRequestFn=o}transformRequest(o,f){return this._transformRequestFn&&this._transformRequestFn(o,f)||{url:o}}setTransformRequest(o){this._transformRequestFn=o}}function V(E){var o=new a.A(3);return o[0]=E[0],o[1]=E[1],o[2]=E[2],o}var U,$=function(E,o,f){return E[0]=o[0]-f[0],E[1]=o[1]-f[1],E[2]=o[2]-f[2],E};U=new a.A(3),a.A!=Float32Array&&(U[0]=0,U[1]=0,U[2]=0);var G=function(E){var o=E[0],f=E[1];return o*o+f*f};function Z(E){const o=[];if(typeof E=="string")o.push({id:"default",url:E});else if(E&&E.length>0){const f=[];for(const{id:y,url:x}of E){const S=`${y}${x}`;f.indexOf(S)===-1&&(f.push(S),o.push({id:y,url:x}))}}return o}function Q(E,o,f){const y=E.split("?");return y[0]+=`${o}${f}`,y.join("?")}(function(){var E=new a.A(2);a.A!=Float32Array&&(E[0]=0,E[1]=0)})();class X{constructor(o,f,y,x){this.context=o,this.format=y,this.texture=o.gl.createTexture(),this.update(f,x)}update(o,f,y){const{width:x,height:S}=o,R=!(this.size&&this.size[0]===x&&this.size[1]===S||y),{context:B}=this,{gl:F}=B;if(this.useMipmap=!!(f&&f.useMipmap),F.bindTexture(F.TEXTURE_2D,this.texture),B.pixelStoreUnpackFlipY.set(!1),B.pixelStoreUnpack.set(1),B.pixelStoreUnpackPremultiplyAlpha.set(this.format===F.RGBA&&(!f||f.premultiply!==!1)),R)this.size=[x,S],o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||a.b(o)?F.texImage2D(F.TEXTURE_2D,0,this.format,this.format,F.UNSIGNED_BYTE,o):F.texImage2D(F.TEXTURE_2D,0,this.format,x,S,0,this.format,F.UNSIGNED_BYTE,o.data);else{const{x:H,y:Y}=y||{x:0,y:0};o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||a.b(o)?F.texSubImage2D(F.TEXTURE_2D,0,H,Y,F.RGBA,F.UNSIGNED_BYTE,o):F.texSubImage2D(F.TEXTURE_2D,0,H,Y,x,S,F.RGBA,F.UNSIGNED_BYTE,o.data)}this.useMipmap&&this.isSizePowerOfTwo()&&F.generateMipmap(F.TEXTURE_2D)}bind(o,f,y){const{context:x}=this,{gl:S}=x;S.bindTexture(S.TEXTURE_2D,this.texture),y!==S.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(y=S.LINEAR),o!==this.filter&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,o),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,y||o),this.filter=o),f!==this.wrap&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,f),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,f),this.wrap=f)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}function ie(E){const{userImage:o}=E;return!!(o&&o.render&&o.render())&&(E.data.replace(new Uint8Array(o.data.buffer)),!0)}class te extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:f,promiseResolve:y}of this.requestors)y(this._getImagesForIds(f));this.requestors=[]}}getImage(o){const f=this.images[o];if(f&&!f.data&&f.spriteData){const y=f.spriteData;f.data=new a.R({width:y.width,height:y.height},y.context.getImageData(y.x,y.y,y.width,y.height).data),f.spriteData=null}return f}addImage(o,f){if(this.images[o])throw new Error(`Image id ${o} already exist, use updateImage instead`);this._validate(o,f)&&(this.images[o]=f)}_validate(o,f){let y=!0;const x=f.data||f.spriteData;return this._validateStretch(f.stretchX,x&&x.width)||(this.fire(new a.j(new Error(`Image "${o}" has invalid "stretchX" value`))),y=!1),this._validateStretch(f.stretchY,x&&x.height)||(this.fire(new a.j(new Error(`Image "${o}" has invalid "stretchY" value`))),y=!1),this._validateContent(f.content,f)||(this.fire(new a.j(new Error(`Image "${o}" has invalid "content" value`))),y=!1),y}_validateStretch(o,f){if(!o)return!0;let y=0;for(const x of o){if(x[0]<y||x[1]<x[0]||f<x[1])return!1;y=x[1]}return!0}_validateContent(o,f){if(!o)return!0;if(o.length!==4)return!1;const y=f.spriteData,x=y&&y.width||f.data.width,S=y&&y.height||f.data.height;return!(o[0]<0||x<o[0]||o[1]<0||S<o[1]||o[2]<0||x<o[2]||o[3]<0||S<o[3]||o[2]<o[0]||o[3]<o[1])}updateImage(o,f,y=!0){const x=this.getImage(o);if(y&&(x.data.width!==f.data.width||x.data.height!==f.data.height))throw new Error(`size mismatch between old image (${x.data.width}x${x.data.height}) and new image (${f.data.width}x${f.data.height}).`);f.version=x.version+1,this.images[o]=f,this.updatedImages[o]=!0}removeImage(o){const f=this.images[o];delete this.images[o],delete this.patterns[o],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o){return new Promise((f,y)=>{let x=!0;if(!this.isLoaded())for(const S of o)this.images[S]||(x=!1);this.isLoaded()||x?f(this._getImagesForIds(o)):this.requestors.push({ids:o,promiseResolve:f})})}_getImagesForIds(o){const f={};for(const y of o){let x=this.getImage(y);x||(this.fire(new a.k("styleimagemissing",{id:y})),x=this.getImage(y)),x?f[y]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,textFitWidth:x.textFitWidth,textFitHeight:x.textFitHeight,hasRenderCallback:!!(x.userImage&&x.userImage.render)}:a.w(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return f}getPixelSize(){const{width:o,height:f}=this.atlasImage;return{width:o,height:f}}getPattern(o){const f=this.patterns[o],y=this.getImage(o);if(!y)return null;if(f&&f.position.version===y.version)return f.position;if(f)f.position.version=y.version;else{const x={w:y.data.width+2,h:y.data.height+2,x:0,y:0},S=new a.I(x,y);this.patterns[o]={bin:x,position:S}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const f=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new X(o,this.atlasImage,f.RGBA),this.atlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const S in this.patterns)o.push(this.patterns[S].bin);const{w:f,h:y}=a.p(o),x=this.atlasImage;x.resize({width:f||1,height:y||1});for(const S in this.patterns){const{bin:R}=this.patterns[S],B=R.x+1,F=R.y+1,H=this.getImage(S).data,Y=H.width,J=H.height;a.R.copy(H,x,{x:0,y:0},{x:B,y:F},{width:Y,height:J}),a.R.copy(H,x,{x:0,y:J-1},{x:B,y:F-1},{width:Y,height:1}),a.R.copy(H,x,{x:0,y:0},{x:B,y:F+J},{width:Y,height:1}),a.R.copy(H,x,{x:Y-1,y:0},{x:B-1,y:F},{width:1,height:J}),a.R.copy(H,x,{x:0,y:0},{x:B+Y,y:F},{width:1,height:J})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const f of o){if(this.callbackDispatchedThisFrame[f])continue;this.callbackDispatchedThisFrame[f]=!0;const y=this.getImage(f);y||a.w(`Image with ID: "${f}" was not found`),ie(y)&&this.updateImage(f,y)}}}const W=1e20;function oe(E,o,f,y,x,S,R,B,F){for(let H=o;H<o+y;H++)se(E,f*S+H,S,x,R,B,F);for(let H=f;H<f+x;H++)se(E,H*S+o,1,y,R,B,F)}function se(E,o,f,y,x,S,R){S[0]=0,R[0]=-W,R[1]=W,x[0]=E[o];for(let B=1,F=0,H=0;B<y;B++){x[B]=E[o+B*f];const Y=B*B;do{const J=S[F];H=(x[B]-x[J]+Y-J*J)/(B-J)/2}while(H<=R[F]&&--F>-1);F++,S[F]=B,R[F]=H,R[F+1]=W}for(let B=0,F=0;B<y;B++){for(;R[F+1]<B;)F++;const H=S[F],Y=B-H;E[o+B*f]=x[H]+Y*Y}}class de{constructor(o,f){this.requestManager=o,this.localIdeographFontFamily=f,this.entries={}}setURL(o){this.url=o}getGlyphs(o){return a._(this,void 0,void 0,function*(){const f=[];for(const S in o)for(const R of o[S])f.push(this._getAndCacheGlyphsPromise(S,R));const y=yield Promise.all(f),x={};for(const{stack:S,id:R,glyph:B}of y)x[S]||(x[S]={}),x[S][R]=B&&{id:B.id,bitmap:B.bitmap.clone(),metrics:B.metrics};return x})}_getAndCacheGlyphsPromise(o,f){return a._(this,void 0,void 0,function*(){let y=this.entries[o];y||(y=this.entries[o]={glyphs:{},requests:{},ranges:{}});let x=y.glyphs[f];if(x!==void 0)return{stack:o,id:f,glyph:x};if(x=this._tinySDF(y,o,f),x)return y.glyphs[f]=x,{stack:o,id:f,glyph:x};const S=Math.floor(f/256);if(256*S>65535)throw new Error("glyphs > 65535 not supported");if(y.ranges[S])return{stack:o,id:f,glyph:x};if(!this.url)throw new Error("glyphsUrl is not set");if(!y.requests[S]){const B=de.loadGlyphRange(o,S,this.url,this.requestManager);y.requests[S]=B}const R=yield y.requests[S];for(const B in R)this._doesCharSupportLocalGlyph(+B)||(y.glyphs[+B]=R[+B]);return y.ranges[S]=!0,{stack:o,id:f,glyph:R[f]||null}})}_doesCharSupportLocalGlyph(o){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(o))}_tinySDF(o,f,y){const x=this.localIdeographFontFamily;if(!x||!this._doesCharSupportLocalGlyph(y))return;let S=o.tinySDF;if(!S){let B="400";/bold/i.test(f)?B="900":/medium/i.test(f)?B="500":/light/i.test(f)&&(B="200"),S=o.tinySDF=new de.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:x,fontWeight:B})}const R=S.draw(String.fromCharCode(y));return{id:y,bitmap:new a.o({width:R.width||60,height:R.height||60},R.data),metrics:{width:R.glyphWidth/2||24,height:R.glyphHeight/2||24,left:R.glyphLeft/2+.5||0,top:R.glyphTop/2-27.5||-8,advance:R.glyphAdvance/2||24,isDoubleResolution:!0}}}}de.loadGlyphRange=function(E,o,f,y){return a._(this,void 0,void 0,function*(){const x=256*o,S=x+255,R=y.transformRequest(f.replace("{fontstack}",E).replace("{range}",`${x}-${S}`),"Glyphs"),B=yield a.l(R,new AbortController);if(!B||!B.data)throw new Error(`Could not load glyph range. range: ${o}, ${x}-${S}`);const F={};for(const H of a.n(B.data))F[H.id]=H;return F})},de.TinySDF=class{constructor({fontSize:E=24,buffer:o=3,radius:f=8,cutoff:y=.25,fontFamily:x="sans-serif",fontWeight:S="normal",fontStyle:R="normal"}={}){this.buffer=o,this.cutoff=y,this.radius=f;const B=this.size=E+4*o,F=this._createCanvas(B),H=this.ctx=F.getContext("2d",{willReadFrequently:!0});H.font=`${R} ${S} ${E}px ${x}`,H.textBaseline="alphabetic",H.textAlign="left",H.fillStyle="black",this.gridOuter=new Float64Array(B*B),this.gridInner=new Float64Array(B*B),this.f=new Float64Array(B),this.z=new Float64Array(B+1),this.v=new Uint16Array(B)}_createCanvas(E){const o=document.createElement("canvas");return o.width=o.height=E,o}draw(E){const{width:o,actualBoundingBoxAscent:f,actualBoundingBoxDescent:y,actualBoundingBoxLeft:x,actualBoundingBoxRight:S}=this.ctx.measureText(E),R=Math.ceil(f),B=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(S-x))),F=Math.min(this.size-this.buffer,R+Math.ceil(y)),H=B+2*this.buffer,Y=F+2*this.buffer,J=Math.max(H*Y,0),he=new Uint8ClampedArray(J),xe={data:he,width:H,height:Y,glyphWidth:B,glyphHeight:F,glyphTop:R,glyphLeft:0,glyphAdvance:o};if(B===0||F===0)return xe;const{ctx:be,buffer:Ce,gridInner:Ie,gridOuter:Ae}=this;be.clearRect(Ce,Ce,B,F),be.fillText(E,Ce,Ce+R);const ze=be.getImageData(Ce,Ce,B,F);Ae.fill(W,0,J),Ie.fill(0,0,J);for(let Ee=0;Ee<F;Ee++)for(let Fe=0;Fe<B;Fe++){const qe=ze.data[4*(Ee*B+Fe)+3]/255;if(qe===0)continue;const Ke=(Ee+Ce)*H+Fe+Ce;if(qe===1)Ae[Ke]=0,Ie[Ke]=W;else{const ct=.5-qe;Ae[Ke]=ct>0?ct*ct:0,Ie[Ke]=ct<0?ct*ct:0}}oe(Ae,0,0,H,Y,H,this.f,this.v,this.z),oe(Ie,Ce,Ce,B,F,H,this.f,this.v,this.z);for(let Ee=0;Ee<J;Ee++){const Fe=Math.sqrt(Ae[Ee])-Math.sqrt(Ie[Ee]);he[Ee]=Math.round(255-255*(Fe/this.radius+this.cutoff))}return xe}};class me{constructor(){this.specification=a.v.light.position}possiblyEvaluate(o,f){return a.x(o.expression.evaluate(f))}interpolate(o,f,y){return{x:a.y.number(o.x,f.x,y),y:a.y.number(o.y,f.y,y),z:a.y.number(o.z,f.z,y)}}}let ae;class ve extends a.E{constructor(o){super(),ae=ae||new a.q({anchor:new a.D(a.v.light.anchor),position:new me,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.T(ae),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,f={}){if(!this._validate(a.r,o,f))for(const y in o){const x=o[y];y.endsWith("-transition")?this._transitionable.setTransition(y.slice(0,-11),x):this._transitionable.setValue(y,x)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,f,y){return(!y||y.validate!==!1)&&a.t(this,o.call(a.u,{value:f,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}const pe=new a.q({"sky-color":new a.D(a.v.sky["sky-color"]),"horizon-color":new a.D(a.v.sky["horizon-color"]),"fog-color":new a.D(a.v.sky["fog-color"]),"fog-ground-blend":new a.D(a.v.sky["fog-ground-blend"]),"horizon-fog-blend":new a.D(a.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new a.D(a.v.sky["sky-horizon-blend"]),"atmosphere-blend":new a.D(a.v.sky["atmosphere-blend"])});class _e extends a.E{constructor(o){super(),this._transitionable=new a.T(pe),this.setSky(o),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.z(0))}setSky(o,f={}){if(!this._validate(a.B,o,f)){o||(o={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const y in o){const x=o[y];y.endsWith("-transition")?this._transitionable.setTransition(y.slice(0,-11),x):this._transitionable.setValue(y,x)}}}getSky(){return this._transitionable.serialize()}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,f,y={}){return(y==null?void 0:y.validate)!==!1&&a.t(this,o.call(a.u,a.e({value:f,style:{glyphs:!0,sprite:!0},styleSpec:a.v})))}calculateFogBlendOpacity(o){return o<60?0:o<70?(o-60)/10:1}}class De{constructor(o,f){this.width=o,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(o,f){const y=o.join(",")+String(f);return this.dashEntry[y]||(this.dashEntry[y]=this.addDash(o,f)),this.dashEntry[y]}getDashRanges(o,f,y){const x=[];let S=o.length%2==1?-o[o.length-1]*y:0,R=o[0]*y,B=!0;x.push({left:S,right:R,isDash:B,zeroLength:o[0]===0});let F=o[0];for(let H=1;H<o.length;H++){B=!B;const Y=o[H];S=F*y,F+=Y,R=F*y,x.push({left:S,right:R,isDash:B,zeroLength:Y===0})}return x}addRoundDash(o,f,y){const x=f/2;for(let S=-y;S<=y;S++){const R=this.width*(this.nextRow+y+S);let B=0,F=o[B];for(let H=0;H<this.width;H++){H/F.right>1&&(F=o[++B]);const Y=Math.abs(H-F.left),J=Math.abs(H-F.right),he=Math.min(Y,J);let xe;const be=S/y*(x+1);if(F.isDash){const Ce=x-Math.abs(be);xe=Math.sqrt(he*he+Ce*Ce)}else xe=x-Math.sqrt(he*he+be*be);this.data[R+H]=Math.max(0,Math.min(255,xe+128))}}}addRegularDash(o){for(let B=o.length-1;B>=0;--B){const F=o[B],H=o[B+1];F.zeroLength?o.splice(B,1):H&&H.isDash===F.isDash&&(H.left=F.left,o.splice(B,1))}const f=o[0],y=o[o.length-1];f.isDash===y.isDash&&(f.left=y.left-this.width,y.right=f.right+this.width);const x=this.width*this.nextRow;let S=0,R=o[S];for(let B=0;B<this.width;B++){B/R.right>1&&(R=o[++S]);const F=Math.abs(B-R.left),H=Math.abs(B-R.right),Y=Math.min(F,H);this.data[x+B]=Math.max(0,Math.min(255,(R.isDash?Y:-Y)+128))}}addDash(o,f){const y=f?7:0,x=2*y+1;if(this.nextRow+x>this.height)return a.w("LineAtlas out of space"),null;let S=0;for(let B=0;B<o.length;B++)S+=o[B];if(S!==0){const B=this.width/S,F=this.getDashRanges(o,this.width,B);f?this.addRoundDash(F,B,y):this.addRegularDash(F)}const R={y:(this.nextRow+y+.5)/this.height,height:2*y/this.height,width:S};return this.nextRow+=x,this.dirty=!0,R}bind(o){const f=o.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))}}const Le="maplibre_preloaded_worker_pool";class je{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<je.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.numActive()===0&&(this.workers.forEach(f=>{f.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Le]}numActive(){return Object.keys(this.active).length}}const Je=Math.floor(v.hardwareConcurrency/2);let et,ft;function rt(){return et||(et=new je),et}je.workerCount=a.C(globalThis)?Math.max(Math.min(Je,3),1):1;class Oe{constructor(o,f){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=f;const y=this.workerPool.acquire(f);for(let x=0;x<y.length;x++){const S=new a.F(y[x],f);S.name=`Worker ${x}`,this.actors.push(S)}if(!this.actors.length)throw new Error("No actors found")}broadcast(o,f){const y=[];for(const x of this.actors)y.push(x.sendAsync({type:o,data:f}));return Promise.all(y)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(o=!0){this.actors.forEach(f=>{f.remove()}),this.actors=[],o&&this.workerPool.release(this.id)}registerMessageHandler(o,f){for(const y of this.actors)y.registerMessageHandler(o,f)}}function Ge(){return ft||(ft=new Oe(rt(),a.G),ft.registerMessageHandler("GR",(E,o,f)=>a.m(o,f))),ft}function Ze(E,o){const f=a.H();return a.J(f,f,[1,1,0]),a.K(f,f,[.5*E.width,.5*E.height,1]),a.L(f,f,E.calculatePosMatrix(o.toUnwrapped()))}function it(E,o,f,y,x,S){const R=function(J,he,xe){if(J)for(const be of J){const Ce=he[be];if(Ce&&Ce.source===xe&&Ce.type==="fill-extrusion")return!0}else for(const be in he){const Ce=he[be];if(Ce.source===xe&&Ce.type==="fill-extrusion")return!0}return!1}(x&&x.layers,o,E.id),B=S.maxPitchScaleFactor(),F=E.tilesIn(y,B,R);F.sort(mt);const H=[];for(const J of F)H.push({wrappedTileID:J.tileID.wrapped().key,queryResults:J.tile.queryRenderedFeatures(o,f,E._state,J.queryGeometry,J.cameraQueryGeometry,J.scale,x,S,B,Ze(E.transform,J.tileID))});const Y=function(J){const he={},xe={};for(const be of J){const Ce=be.queryResults,Ie=be.wrappedTileID,Ae=xe[Ie]=xe[Ie]||{};for(const ze in Ce){const Ee=Ce[ze],Fe=Ae[ze]=Ae[ze]||{},qe=he[ze]=he[ze]||[];for(const Ke of Ee)Fe[Ke.featureIndex]||(Fe[Ke.featureIndex]=!0,qe.push(Ke))}}return he}(H);for(const J in Y)Y[J].forEach(he=>{const xe=he.feature,be=E.getFeatureState(xe.layer["source-layer"],xe.id);xe.source=xe.layer.source,xe.layer["source-layer"]&&(xe.sourceLayer=xe.layer["source-layer"]),xe.state=be});return Y}function mt(E,o){const f=E.tileID,y=o.tileID;return f.overscaledZ-y.overscaledZ||f.canonical.y-y.canonical.y||f.wrap-y.wrap||f.canonical.x-y.canonical.x}function Tt(E,o,f){return a._(this,void 0,void 0,function*(){let y=E;if(E.url?y=(yield a.h(o.transformRequest(E.url,"Source"),f)).data:yield v.frameAsync(f),!y)return null;const x=a.M(a.e(y,E),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in y&&y.vector_layers&&(x.vectorLayerIds=y.vector_layers.map(S=>S.id)),x})}class $e{constructor(o,f){o&&(f?this.setSouthWest(o).setNorthEast(f):Array.isArray(o)&&(o.length===4?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1])))}setNorthEast(o){return this._ne=o instanceof a.N?new a.N(o.lng,o.lat):a.N.convert(o),this}setSouthWest(o){return this._sw=o instanceof a.N?new a.N(o.lng,o.lat):a.N.convert(o),this}extend(o){const f=this._sw,y=this._ne;let x,S;if(o instanceof a.N)x=o,S=o;else{if(!(o instanceof $e))return Array.isArray(o)?o.length===4||o.every(Array.isArray)?this.extend($e.convert(o)):this.extend(a.N.convert(o)):o&&("lng"in o||"lon"in o)&&"lat"in o?this.extend(a.N.convert(o)):this;if(x=o._sw,S=o._ne,!x||!S)return this}return f||y?(f.lng=Math.min(x.lng,f.lng),f.lat=Math.min(x.lat,f.lat),y.lng=Math.max(S.lng,y.lng),y.lat=Math.max(S.lat,y.lat)):(this._sw=new a.N(x.lng,x.lat),this._ne=new a.N(S.lng,S.lat)),this}getCenter(){return new a.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.N(this.getWest(),this.getNorth())}getSouthEast(){return new a.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:f,lat:y}=a.N.convert(o);let x=this._sw.lng<=f&&f<=this._ne.lng;return this._sw.lng>this._ne.lng&&(x=this._sw.lng>=f&&f>=this._ne.lng),this._sw.lat<=y&&y<=this._ne.lat&&x}static convert(o){return o instanceof $e?o:o&&new $e(o)}static fromLngLat(o,f=0){const y=360*f/40075017,x=y/Math.cos(Math.PI/180*o.lat);return new $e(new a.N(o.lng-x,o.lat-y),new a.N(o.lng+x,o.lat+y))}adjustAntiMeridian(){const o=new a.N(this._sw.lng,this._sw.lat),f=new a.N(this._ne.lng,this._ne.lat);return new $e(o,o.lng>f.lng?new a.N(f.lng+360,f.lat):f)}}class At{constructor(o,f,y){this.bounds=$e.convert(this.validateBounds(o)),this.minzoom=f||0,this.maxzoom=y||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const f=Math.pow(2,o.z),y=Math.floor(a.O(this.bounds.getWest())*f),x=Math.floor(a.Q(this.bounds.getNorth())*f),S=Math.ceil(a.O(this.bounds.getEast())*f),R=Math.ceil(a.Q(this.bounds.getSouth())*f);return o.x>=y&&o.x<S&&o.y>=x&&o.y<R}}class pt extends a.E{constructor(o,f,y,x){if(super(),this.id=o,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.M(f,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},f),this._collectResourceTiming=f.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x)}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const o=yield Tt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),o&&(a.e(this,o),o.bounds&&(this.tileBounds=new At(o.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(o){this._tileJSONRequest=null,this.fire(new a.j(o))}})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}setSourceProperty(o){this._tileJSONRequest&&this._tileJSONRequest.abort(),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(o){return a._(this,void 0,void 0,function*(){const f=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),y={request:this.map._requestManager.transformRequest(f,"Tile"),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};y.request.collectResourceTiming=this._collectResourceTiming;let x="RT";if(o.actor&&o.state!=="expired"){if(o.state==="loading")return new Promise((S,R)=>{o.reloadPromise={resolve:S,reject:R}})}else o.actor=this.dispatcher.getActor(),x="LT";o.abortController=new AbortController;try{const S=yield o.actor.sendAsync({type:x,data:y},o.abortController);if(delete o.abortController,o.aborted)return;this._afterTileLoadWorkerResponse(o,S)}catch(S){if(delete o.abortController,o.aborted)return;if(S&&S.status!==404)throw S;this._afterTileLoadWorkerResponse(o,null)}})}_afterTileLoadWorkerResponse(o,f){if(f&&f.resourceTiming&&(o.resourceTiming=f.resourceTiming),f&&this.map._refreshExpiredTiles&&o.setExpiryData(f),o.loadVectorData(f,this.map.painter),o.reloadPromise){const y=o.reloadPromise;o.reloadPromise=null,this.loadTile(o).then(y.resolve).catch(y.reject)}}abortTile(o){return a._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.actor&&(yield o.actor.sendAsync({type:"AT",data:{uid:o.uid,type:this.type,source:this.id}}))})}unloadTile(o){return a._(this,void 0,void 0,function*(){o.unloadVectorData(),o.actor&&(yield o.actor.sendAsync({type:"RMT",data:{uid:o.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class yt extends a.E{constructor(o,f,y,x){super(),this.id=o,this.dispatcher=y,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},f),a.e(this,a.M(f,["url","scheme","tileSize"]))}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const o=yield Tt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,o&&(a.e(this,o),o.bounds&&(this.tileBounds=new At(o.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(o){this._tileJSONRequest=null,this.fire(new a.j(o))}})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(o){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}serialize(){return a.e({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o){return a._(this,void 0,void 0,function*(){const f=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);o.abortController=new AbortController;try{const y=yield z.getImage(this.map._requestManager.transformRequest(f,"Tile"),o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(y&&y.data){this.map._refreshExpiredTiles&&y.cacheControl&&y.expires&&o.setExpiryData({cacheControl:y.cacheControl,expires:y.expires});const x=this.map.painter.context,S=x.gl,R=y.data;o.texture=this.map.painter.getTileTexture(R.width),o.texture?o.texture.update(R,{useMipmap:!0}):(o.texture=new X(x,R,S.RGBA,{useMipmap:!0}),o.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST)),o.state="loaded"}}catch(y){if(delete o.abortController,o.aborted)o.state="unloaded";else if(y)throw o.state="errored",y}})}abortTile(o){return a._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController)})}unloadTile(o){return a._(this,void 0,void 0,function*(){o.texture&&this.map.painter.saveTileTexture(o.texture)})}hasTransition(){return!1}}class gt extends yt{constructor(o,f,y,x){super(o,f,y,x),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},f),this.encoding=f.encoding||"mapbox",this.redFactor=f.redFactor,this.greenFactor=f.greenFactor,this.blueFactor=f.blueFactor,this.baseShift=f.baseShift}loadTile(o){return a._(this,void 0,void 0,function*(){const f=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),y=this.map._requestManager.transformRequest(f,"Tile");o.neighboringTiles=this._getNeighboringTiles(o.tileID),o.abortController=new AbortController;try{const x=yield z.getImage(y,o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(x&&x.data){const S=x.data;this.map._refreshExpiredTiles&&x.cacheControl&&x.expires&&o.setExpiryData({cacheControl:x.cacheControl,expires:x.expires});const R=a.b(S)&&a.U()?S:yield this.readImageNow(S),B={type:this.type,uid:o.uid,source:this.id,rawImageData:R,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!o.actor||o.state==="expired"){o.actor=this.dispatcher.getActor();const F=yield o.actor.sendAsync({type:"LDT",data:B});o.dem=F,o.needsHillshadePrepare=!0,o.needsTerrainPrepare=!0,o.state="loaded"}}}catch(x){if(delete o.abortController,o.aborted)o.state="unloaded";else if(x)throw o.state="errored",x}})}readImageNow(o){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.V()){const f=o.width+2,y=o.height+2;try{return new a.R({width:f,height:y},yield a.W(o,-1,-1,f,y))}catch{}}return v.getImageData(o,1)})}_getNeighboringTiles(o){const f=o.canonical,y=Math.pow(2,f.z),x=(f.x-1+y)%y,S=f.x===0?o.wrap-1:o.wrap,R=(f.x+1+y)%y,B=f.x+1===y?o.wrap+1:o.wrap,F={};return F[new a.S(o.overscaledZ,S,f.z,x,f.y).key]={backfilled:!1},F[new a.S(o.overscaledZ,B,f.z,R,f.y).key]={backfilled:!1},f.y>0&&(F[new a.S(o.overscaledZ,S,f.z,x,f.y-1).key]={backfilled:!1},F[new a.S(o.overscaledZ,o.wrap,f.z,f.x,f.y-1).key]={backfilled:!1},F[new a.S(o.overscaledZ,B,f.z,R,f.y-1).key]={backfilled:!1}),f.y+1<y&&(F[new a.S(o.overscaledZ,S,f.z,x,f.y+1).key]={backfilled:!1},F[new a.S(o.overscaledZ,o.wrap,f.z,f.x,f.y+1).key]={backfilled:!1},F[new a.S(o.overscaledZ,B,f.z,R,f.y+1).key]={backfilled:!1}),F}unloadTile(o){return a._(this,void 0,void 0,function*(){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&(yield o.actor.sendAsync({type:"RDT",data:{type:this.type,uid:o.uid,source:this.id}}))})}}class qt extends a.E{constructor(o,f,y,x){super(),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=y.getActor(),this.setEventedParent(x),this._data=f.data,this._options=a.e({},f),this._collectResourceTiming=f.collectResourceTiming,f.maxzoom!==void 0&&(this.maxzoom=f.maxzoom),f.type&&(this.type=f.type),f.attribution&&(this.attribution=f.attribution),this.promoteId=f.promoteId;const S=a.X/this.tileSize;f.clusterMaxZoom!==void 0&&this.maxzoom<=f.clusterMaxZoom&&a.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${f.clusterMaxZoom}".`),this.workerOptions=a.e({source:this.id,cluster:f.cluster||!1,geojsonVtOptions:{buffer:(f.buffer!==void 0?f.buffer:128)*S,tolerance:(f.tolerance!==void 0?f.tolerance:.375)*S,extent:a.X,maxZoom:this.maxzoom,lineMetrics:f.lineMetrics||!1,generateId:f.generateId||!1},superclusterOptions:{maxZoom:f.clusterMaxZoom!==void 0?f.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,f.clusterMinPoints||2),extent:a.X,radius:(f.clusterRadius||50)*S,log:!1,generateId:f.generateId||!1},clusterProperties:f.clusterProperties,filter:f.filter},f.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return a._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(o){this.map=o,this.load()}setData(o){return this._data=o,this._updateWorkerData(),this}updateData(o){return this._updateWorkerData(o),this}getData(){return a._(this,void 0,void 0,function*(){const o=a.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:o})})}setClusterOptions(o){return this.workerOptions.cluster=o.cluster,o&&(o.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=o.clusterRadius),o.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=o.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(o){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:o,source:this.id}})}getClusterChildren(o){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:o,source:this.id}})}getClusterLeaves(o,f,y){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:o,limit:f,offset:y}})}_updateWorkerData(o){return a._(this,void 0,void 0,function*(){const f=a.e({type:this.type},this.workerOptions);o?f.dataDiff=o:typeof this._data=="string"?(f.request=this.map._requestManager.transformRequest(v.resolveURL(this._data),"Source"),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.k("dataloading",{dataType:"source"}));try{const y=yield this.actor.sendAsync({type:"LD",data:f});if(this._pendingLoads--,this._removed||y.abandoned)return void this.fire(new a.k("dataabort",{dataType:"source"}));let x=null;y.resourceTiming&&y.resourceTiming[this.id]&&(x=y.resourceTiming[this.id].slice(0));const S={dataType:"source"};this._collectResourceTiming&&x&&x.length>0&&a.e(S,{resourceTiming:x}),this.fire(new a.k("data",Object.assign(Object.assign({},S),{sourceDataType:"metadata"}))),this.fire(new a.k("data",Object.assign(Object.assign({},S),{sourceDataType:"content"})))}catch(y){if(this._pendingLoads--,this._removed)return void this.fire(new a.k("dataabort",{dataType:"source"}));this.fire(new a.j(y))}})}loaded(){return this._pendingLoads===0}loadTile(o){return a._(this,void 0,void 0,function*(){const f=o.actor?"RT":"LT";o.actor=this.actor;const y={type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};o.abortController=new AbortController;const x=yield this.actor.sendAsync({type:f,data:y},o.abortController);delete o.abortController,o.unloadVectorData(),o.aborted||o.loadVectorData(x,this.map.painter,f==="RT")})}abortTile(o){return a._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.aborted=!0})}unloadTile(o){return a._(this,void 0,void 0,function*(){o.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:o.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var $t=a.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class er extends a.E{constructor(o,f,y,x){super(),this.id=o,this.dispatcher=y,this.coordinates=f.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=f}load(o){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const f=yield z.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,f&&f.data&&(this.image=f.data,o&&(this.coordinates=o),this._finishLoading())}catch(f){this._request=null,this._loaded=!0,this.fire(new a.j(f))}})}loaded(){return this._loaded}updateImage(o){return o.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=o.url,this.load(o.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(o){this.coordinates=o;const f=o.map(a.Z.fromLngLat);this.tileID=function(x){let S=1/0,R=1/0,B=-1/0,F=-1/0;for(const he of x)S=Math.min(S,he.x),R=Math.min(R,he.y),B=Math.max(B,he.x),F=Math.max(F,he.y);const H=Math.max(B-S,F-R),Y=Math.max(0,Math.floor(-Math.log(H)/Math.LN2)),J=Math.pow(2,Y);return new a.a1(Y,Math.floor((S+B)/2*J),Math.floor((R+F)/2*J))}(f),this.minzoom=this.maxzoom=this.tileID.z;const y=f.map(x=>this.tileID.getTilePoint(x)._round());return this._boundsArray=new a.$,this._boundsArray.emplaceBack(y[0].x,y[0].y,0,0),this._boundsArray.emplaceBack(y[1].x,y[1].y,a.X,0),this._boundsArray.emplaceBack(y[3].x,y[3].y,0,a.X),this._boundsArray.emplaceBack(y[2].x,y[2].y,a.X,a.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const o=this.map.painter.context,f=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,$t.members)),this.boundsSegments||(this.boundsSegments=a.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new X(o,this.image,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let y=!1;for(const x in this.tiles){const S=this.tiles[x];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,y=!0)}y&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(o){return a._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={}):o.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Vt extends er{constructor(o,f,y,x){super(o,f,y,x),this.roundZoom=!0,this.type="video",this.options=f}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1;const o=this.options;this.urls=[];for(const f of o.urls)this.urls.push(this.map._requestManager.transformRequest(f,"Source").url);try{const f=yield a.a3(this.urls);if(this._loaded=!0,!f)return;this.video=f,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(f){this.fire(new a.j(f))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(o){if(this.video){const f=this.video.seekable;o<f.start(0)||o>f.end(0)?this.fire(new a.j(new a.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${f.start(0)} and ${f.end(0)}-second mark.`))):this.video.currentTime=o}}getVideo(){return this.video}onAdd(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const o=this.map.painter.context,f=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,$t.members)),this.boundsSegments||(this.boundsSegments=a.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE),f.texSubImage2D(f.TEXTURE_2D,0,0,0,f.RGBA,f.UNSIGNED_BYTE,this.video)):(this.texture=new X(o,this.video,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let y=!1;for(const x in this.tiles){const S=this.tiles[x];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,y=!0)}y&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class tr extends er{constructor(o,f,y,x){super(o,f,y,x),f.coordinates?Array.isArray(f.coordinates)&&f.coordinates.length===4&&!f.coordinates.some(S=>!Array.isArray(S)||S.length!==2||S.some(R=>typeof R!="number"))||this.fire(new a.j(new a.a2(`sources.${o}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.j(new a.a2(`sources.${o}`,null,'missing required property "coordinates"'))),f.animate&&typeof f.animate!="boolean"&&this.fire(new a.j(new a.a2(`sources.${o}`,null,'optional "animate" property must be a boolean value'))),f.canvas?typeof f.canvas=="string"||f.canvas instanceof HTMLCanvasElement||this.fire(new a.j(new a.a2(`sources.${o}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.j(new a.a2(`sources.${o}`,null,'missing required property "canvas"'))),this.options=f,this.animate=f.animate===void 0||f.animate}load(){return a._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let o=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,o=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,o=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const f=this.map.painter.context,y=f.gl;this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,$t.members)),this.boundsSegments||(this.boundsSegments=a.a0.simpleSegment(0,0,4,2)),this.texture?(o||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new X(f,this.canvas,y.RGBA,{premultiply:!0});let x=!1;for(const S in this.tiles){const R=this.tiles[S];R.state!=="loaded"&&(R.state="loaded",R.texture=this.texture,x=!0)}x&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const o of[this.canvas.width,this.canvas.height])if(isNaN(o)||o<=0)return!0;return!1}}const pr={},vr=E=>{switch(E){case"geojson":return qt;case"image":return er;case"raster":return yt;case"raster-dem":return gt;case"vector":return pt;case"video":return Vt;case"canvas":return tr}return pr[E]},lt="RTLPluginLoaded";class mr extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Ge()}_syncState(o){return this.status=o,this.dispatcher.broadcast("SRPS",{pluginStatus:o,pluginURL:this.url}).catch(f=>{throw this.status="error",f})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(o){return a._(this,arguments,void 0,function*(f,y=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=v.resolveURL(f),!this.url)throw new Error(`requested url ${f} is invalid`);if(this.status==="unavailable"){if(!y)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return a._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.k(lt))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Ht=null;function wt(){return Ht||(Ht=new mr),Ht}class at{constructor(o,f){this.timeAdded=0,this.fadeEndTime=0,this.tileID=o,this.uid=a.a4(),this.uses=0,this.tileSize=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(o){const f=o+this.timeAdded;f<this.fadeEndTime||(this.fadeEndTime=f)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(o){this.demTexture&&o.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(o,f,y){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(x,S){const R={};if(!S)return R;for(const B of x){const F=B.layerIds.map(H=>S.getLayer(H)).filter(Boolean);if(F.length!==0){B.layers=F,B.stateDependentLayerIds&&(B.stateDependentLayers=B.stateDependentLayerIds.map(H=>F.filter(Y=>Y.id===H)[0]));for(const H of F)R[H.id]=B}}return R}(o.buckets,f.style),this.hasSymbolBuckets=!1;for(const x in this.buckets){const S=this.buckets[x];if(S instanceof a.a6){if(this.hasSymbolBuckets=!0,!y)break;S.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const x in this.buckets){const S=this.buckets[x];if(S instanceof a.a6&&S.hasRTLText){this.hasRTLText=!0,wt().lazyLoad();break}}this.queryPadding=0;for(const x in this.buckets){const S=this.buckets[x];this.queryPadding=Math.max(this.queryPadding,f.style.getLayer(x).queryRadius(S))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage)}else this.collisionBoxArray=new a.a5}unloadVectorData(){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(o){return this.buckets[o.id]}upload(o){for(const y in this.buckets){const x=this.buckets[y];x.uploadPending()&&x.upload(o)}const f=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new X(o,this.imageAtlas.image,f.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new X(o,this.glyphAtlasImage,f.ALPHA),this.glyphAtlasImage=null)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,f,y,x,S,R,B,F,H,Y){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:x,cameraQueryGeometry:S,scale:R,tileSize:this.tileSize,pixelPosMatrix:Y,transform:F,params:B,queryPadding:this.queryPadding*H},o,f,y):{}}querySourceFeatures(o,f){const y=this.latestFeatureIndex;if(!y||!y.rawTileData)return;const x=y.loadVTLayers(),S=f&&f.sourceLayer?f.sourceLayer:"",R=x._geojsonTileLayer||x[S];if(!R)return;const B=a.a7(f&&f.filter),{z:F,x:H,y:Y}=this.tileID.canonical,J={z:F,x:H,y:Y};for(let he=0;he<R.length;he++){const xe=R.feature(he);if(B.needGeometry){const Ie=a.a8(xe,!0);if(!B.filter(new a.z(this.tileID.overscaledZ),Ie,this.tileID.canonical))continue}else if(!B.filter(new a.z(this.tileID.overscaledZ),xe))continue;const be=y.getId(xe,S),Ce=new a.a9(xe,F,H,Y,be);Ce.tile=J,o.push(Ce)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const f=this.expirationTime;if(o.cacheControl){const y=a.aa(o.cacheControl);y["max-age"]&&(this.expirationTime=Date.now()+1e3*y["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const y=Date.now();let x=!1;if(this.expirationTime>y)x=!1;else if(f)if(this.expirationTime<f)x=!0;else{const S=this.expirationTime-f;S?this.expirationTime=y+Math.max(S,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(o,f){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(o).length===0)return;const y=this.latestFeatureIndex.loadVTLayers();for(const x in this.buckets){if(!f.style.hasLayer(x))continue;const S=this.buckets[x],R=S.layers[0].sourceLayer||"_geojsonTileLayer",B=y[R],F=o[R];if(!B||!F||Object.keys(F).length===0)continue;S.update(F,B,this.imageAtlas&&this.imageAtlas.patternPositions||{});const H=f&&f.style&&f.style.getLayer(x);H&&(this.queryPadding=Math.max(this.queryPadding,H.queryRadius(S)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<v.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=v.now()+o}setDependencies(o,f){const y={};for(const x of f)y[x]=!0;this.dependencies[o]=y}hasDependency(o,f){for(const y of o){const x=this.dependencies[y];if(x){for(const S of f)if(x[S])return!0}}return!1}}class le{constructor(o,f){this.max=o,this.onRemove=f,this.reset()}reset(){for(const o in this.data)for(const f of this.data[o])f.timeout&&clearTimeout(f.timeout),this.onRemove(f.value);return this.data={},this.order=[],this}add(o,f,y){const x=o.wrapped().key;this.data[x]===void 0&&(this.data[x]=[]);const S={value:f,timeout:void 0};if(y!==void 0&&(S.timeout=setTimeout(()=>{this.remove(o,S)},y)),this.data[x].push(S),this.order.push(x),this.order.length>this.max){const R=this._getAndRemoveByKey(this.order[0]);R&&this.onRemove(R)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const f=this.data[o].shift();return f.timeout&&clearTimeout(f.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),f.value}getByKey(o){const f=this.data[o];return f?f[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,f){if(!this.has(o))return this;const y=o.wrapped().key,x=f===void 0?0:this.data[y].indexOf(f),S=this.data[y][x];return this.data[y].splice(x,1),S.timeout&&clearTimeout(S.timeout),this.data[y].length===0&&delete this.data[y],this.onRemove(S.value),this.order.splice(this.order.indexOf(y),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}filter(o){const f=[];for(const y in this.data)for(const x of this.data[y])o(x.value)||f.push(x);for(const y of f)this.remove(y.value.tileID,y)}}class Be{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,f,y){const x=String(f);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][x]=this.stateChanges[o][x]||{},a.e(this.stateChanges[o][x],y),this.deletedStates[o]===null){this.deletedStates[o]={};for(const S in this.state[o])S!==x&&(this.deletedStates[o][S]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][x]===null){this.deletedStates[o][x]={};for(const S in this.state[o][x])y[S]||(this.deletedStates[o][x][S]=null)}else for(const S in y)this.deletedStates[o]&&this.deletedStates[o][x]&&this.deletedStates[o][x][S]===null&&delete this.deletedStates[o][x][S]}removeFeatureState(o,f,y){if(this.deletedStates[o]===null)return;const x=String(f);if(this.deletedStates[o]=this.deletedStates[o]||{},y&&f!==void 0)this.deletedStates[o][x]!==null&&(this.deletedStates[o][x]=this.deletedStates[o][x]||{},this.deletedStates[o][x][y]=null);else if(f!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][x])for(y in this.deletedStates[o][x]={},this.stateChanges[o][x])this.deletedStates[o][x][y]=null;else this.deletedStates[o][x]=null;else this.deletedStates[o]=null}getState(o,f){const y=String(f),x=a.e({},(this.state[o]||{})[y],(this.stateChanges[o]||{})[y]);if(this.deletedStates[o]===null)return{};if(this.deletedStates[o]){const S=this.deletedStates[o][f];if(S===null)return{};for(const R in S)delete x[R]}return x}initializeTileState(o,f){o.setFeatureState(this.state,f)}coalesceChanges(o,f){const y={};for(const x in this.stateChanges){this.state[x]=this.state[x]||{};const S={};for(const R in this.stateChanges[x])this.state[x][R]||(this.state[x][R]={}),a.e(this.state[x][R],this.stateChanges[x][R]),S[R]=this.state[x][R];y[x]=S}for(const x in this.deletedStates){this.state[x]=this.state[x]||{};const S={};if(this.deletedStates[x]===null)for(const R in this.state[x])S[R]={},this.state[x][R]={};else for(const R in this.deletedStates[x]){if(this.deletedStates[x][R]===null)this.state[x][R]={};else for(const B of Object.keys(this.deletedStates[x][R]))delete this.state[x][R][B];S[R]=this.state[x][R]}y[x]=y[x]||{},a.e(y[x],S)}if(this.stateChanges={},this.deletedStates={},Object.keys(y).length!==0)for(const x in o)o[x].setFeatureState(y,f)}}class Ue extends a.E{constructor(o,f,y){super(),this.id=o,this.dispatcher=y,this.on("data",x=>this._dataHandler(x)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((x,S,R,B)=>{const F=new(vr(S.type))(x,S,R,B);if(F.id!==x)throw new Error(`Expected Source id to be ${x} instead of ${F.id}`);return F})(o,f,y,this),this._tiles={},this._cache=new le(0,x=>this._unloadTile(x)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Be,this._didEmitContent=!1,this._updated=!1}onAdd(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._maxTileCacheZoomLevels=o?o._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(o)}onRemove(o){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(o)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const o in this._tiles){const f=this._tiles[o];if(f.state!=="loaded"&&f.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(o,f,y){return a._(this,void 0,void 0,function*(){try{yield this._source.loadTile(o),this._tileLoaded(o,f,y)}catch(x){o.state="errored",x.status!==404?this._source.fire(new a.j(x,{tile:o})):this.update(this.transform,this.terrain)}})}_unloadTile(o){this._source.unloadTile&&this._source.unloadTile(o)}_abortTile(o){this._source.abortTile&&this._source.abortTile(o),this._source.fire(new a.k("dataabort",{tile:o,coord:o.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const f in this._tiles){const y=this._tiles[f];y.upload(o),y.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(tt).map(o=>o.key)}getRenderableIds(o){const f=[];for(const y in this._tiles)this._isIdRenderable(y,o)&&f.push(this._tiles[y]);return o?f.sort((y,x)=>{const S=y.tileID,R=x.tileID,B=new a.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle),F=new a.P(R.canonical.x,R.canonical.y)._rotate(this.transform.angle);return S.overscaledZ-R.overscaledZ||F.y-B.y||F.x-B.x}).map(y=>y.tileID.key):f.map(y=>y.tileID).sort(tt).map(y=>y.key)}hasRenderableParent(o){const f=this.findLoadedParent(o,0);return!!f&&this._isIdRenderable(f.tileID.key)}_isIdRenderable(o,f){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(f||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(o,"reloading")}}_reloadTile(o,f){return a._(this,void 0,void 0,function*(){const y=this._tiles[o];y&&(y.state!=="loading"&&(y.state=f),yield this._loadTile(y,o,f))})}_tileLoaded(o,f,y){o.timeAdded=v.now(),y==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(f,o),this.getSource().type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),o.aborted||this._source.fire(new a.k("data",{dataType:"source",tile:o,coord:o.tileID}))}_backfillDEM(o){const f=this.getRenderableIds();for(let x=0;x<f.length;x++){const S=f[x];if(o.neighboringTiles&&o.neighboringTiles[S]){const R=this.getTileByID(S);y(o,R),y(R,o)}}function y(x,S){x.needsHillshadePrepare=!0,x.needsTerrainPrepare=!0;let R=S.tileID.canonical.x-x.tileID.canonical.x;const B=S.tileID.canonical.y-x.tileID.canonical.y,F=Math.pow(2,x.tileID.canonical.z),H=S.tileID.key;R===0&&B===0||Math.abs(B)>1||(Math.abs(R)>1&&(Math.abs(R+F)===1?R+=F:Math.abs(R-F)===1&&(R-=F)),S.dem&&x.dem&&(x.dem.backfillBorder(S.dem,R,B),x.neighboringTiles&&x.neighboringTiles[H]&&(x.neighboringTiles[H].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,f,y,x){for(const S in this._tiles){let R=this._tiles[S];if(x[S]||!R.hasData()||R.tileID.overscaledZ<=f||R.tileID.overscaledZ>y)continue;let B=R.tileID;for(;R&&R.tileID.overscaledZ>f+1;){const H=R.tileID.scaledTo(R.tileID.overscaledZ-1);R=this._tiles[H.key],R&&R.hasData()&&(B=H)}let F=B;for(;F.overscaledZ>f;)if(F=F.scaledTo(F.overscaledZ-1),o[F.key]){x[B.key]=B;break}}}findLoadedParent(o,f){if(o.key in this._loadedParentTiles){const y=this._loadedParentTiles[o.key];return y&&y.tileID.overscaledZ>=f?y:null}for(let y=o.overscaledZ-1;y>=f;y--){const x=o.scaledTo(y),S=this._getLoadedTile(x);if(S)return S}}findLoadedSibling(o){return this._getLoadedTile(o)}_getLoadedTile(o){const f=this._tiles[o.key];return f&&f.hasData()?f:this._cache.getByKey(o.wrapped().key)}updateCacheSize(o){const f=Math.ceil(o.width/this._source.tileSize)+1,y=Math.ceil(o.height/this._source.tileSize)+1,x=Math.floor(f*y*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),S=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(S)}handleWrapJump(o){const f=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,f){const y={};for(const x in this._tiles){const S=this._tiles[x];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+f),y[S.tileID.key]=S}this._tiles=y;for(const x in this._timers)clearTimeout(this._timers[x]),delete this._timers[x];for(const x in this._tiles)this._setTileReloadTimer(x,this._tiles[x])}}_updateCoveredAndRetainedTiles(o,f,y,x,S,R){const B={},F={},H=Object.keys(o),Y=v.now();for(const J of H){const he=o[J],xe=this._tiles[J];if(!xe||xe.fadeEndTime!==0&&xe.fadeEndTime<=Y)continue;const be=this.findLoadedParent(he,f),Ce=this.findLoadedSibling(he),Ie=be||Ce||null;Ie&&(this._addTile(Ie.tileID),B[Ie.tileID.key]=Ie.tileID),F[J]=he}this._retainLoadedChildren(F,x,y,o);for(const J in B)o[J]||(this._coveredTiles[J]=!0,o[J]=B[J]);if(R){const J={},he={};for(const xe of S)this._tiles[xe.key].hasData()?J[xe.key]=xe:he[xe.key]=xe;for(const xe in he){const be=he[xe].children(this._source.maxzoom);this._tiles[be[0].key]&&this._tiles[be[1].key]&&this._tiles[be[2].key]&&this._tiles[be[3].key]&&(J[be[0].key]=o[be[0].key]=be[0],J[be[1].key]=o[be[1].key]=be[1],J[be[2].key]=o[be[2].key]=be[2],J[be[3].key]=o[be[3].key]=be[3],delete he[xe])}for(const xe in he){const be=he[xe],Ce=this.findLoadedParent(be,this._source.minzoom),Ie=this.findLoadedSibling(be),Ae=Ce||Ie||null;if(Ae){J[Ae.tileID.key]=o[Ae.tileID.key]=Ae.tileID;for(const ze in J)J[ze].isChildOf(Ae.tileID)&&delete J[ze]}}for(const xe in this._tiles)J[xe]||(this._coveredTiles[xe]=!0)}}update(o,f){if(!this._sourceLoaded||this._paused)return;let y;this.transform=o,this.terrain=f,this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?y=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(Y=>new a.S(Y.canonical.z,Y.wrap,Y.canonical.z,Y.canonical.x,Y.canonical.y)):(y=o.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:f}),this._source.hasTile&&(y=y.filter(Y=>this._source.hasTile(Y)))):y=[];const x=o.coveringZoomLevel(this._source),S=Math.max(x-Ue.maxOverzooming,this._source.minzoom),R=Math.max(x+Ue.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const Y={};for(const J of y)if(J.canonical.z>this._source.minzoom){const he=J.scaledTo(J.canonical.z-1);Y[he.key]=he;const xe=J.scaledTo(Math.max(this._source.minzoom,Math.min(J.canonical.z,5)));Y[xe.key]=xe}y=y.concat(Object.values(Y))}const B=y.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,B&&this.fire(new a.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const F=this._updateRetainedTiles(y,x);st(this._source.type)&&this._updateCoveredAndRetainedTiles(F,S,R,x,y,f);for(const Y in F)this._tiles[Y].clearFadeHold();const H=a.ab(this._tiles,F);for(const Y of H){const J=this._tiles[Y];J.hasSymbolBuckets&&!J.holdingForFade()?J.setHoldDuration(this.map._fadeDuration):J.hasSymbolBuckets&&!J.symbolFadeFinished()||this._removeTile(Y)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)}_updateRetainedTiles(o,f){var y;const x={},S={},R=Math.max(f-Ue.maxOverzooming,this._source.minzoom),B=Math.max(f+Ue.maxUnderzooming,this._source.minzoom),F={};for(const H of o){const Y=this._addTile(H);x[H.key]=H,Y.hasData()||f<this._source.maxzoom&&(F[H.key]=H)}this._retainLoadedChildren(F,f,B,x);for(const H of o){let Y=this._tiles[H.key];if(Y.hasData())continue;if(f+1>this._source.maxzoom){const he=H.children(this._source.maxzoom)[0],xe=this.getTile(he);if(xe&&xe.hasData()){x[he.key]=he;continue}}else{const he=H.children(this._source.maxzoom);if(x[he[0].key]&&x[he[1].key]&&x[he[2].key]&&x[he[3].key])continue}let J=Y.wasRequested();for(let he=H.overscaledZ-1;he>=R;--he){const xe=H.scaledTo(he);if(S[xe.key])break;if(S[xe.key]=!0,Y=this.getTile(xe),!Y&&J&&(Y=this._addTile(xe)),Y){const be=Y.hasData();if((be||!(!((y=this.map)===null||y===void 0)&&y.cancelPendingTileRequestsWhileZooming)||J)&&(x[xe.key]=xe),J=Y.wasRequested(),be)break}}}return x}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const f=[];let y,x=this._tiles[o].tileID;for(;x.overscaledZ>0;){if(x.key in this._loadedParentTiles){y=this._loadedParentTiles[x.key];break}f.push(x.key);const S=x.scaledTo(x.overscaledZ-1);if(y=this._getLoadedTile(S),y)break;x=S}for(const S of f)this._loadedParentTiles[S]=y}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const o in this._tiles){const f=this._tiles[o].tileID,y=this._getLoadedTile(f);this._loadedSiblingTiles[f.key]=y}}_addTile(o){let f=this._tiles[o.key];if(f)return f;f=this._cache.getAndRemove(o),f&&(this._setTileReloadTimer(o.key,f),f.tileID=o,this._state.initializeTileState(f,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,f)));const y=f;return f||(f=new at(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(f,o.key,f.state)),f.uses++,this._tiles[o.key]=f,y||this._source.fire(new a.k("dataloading",{tile:f,coord:f.tileID,dataType:"source"})),f}_setTileReloadTimer(o,f){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const y=f.getExpiryTimeout();y&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},y))}_removeTile(o){const f=this._tiles[o];f&&(f.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),f.uses>0||(f.hasData()&&f.state!=="reloading"?this._cache.add(f.tileID,f,f.getExpiryTimeout()):(f.aborted=!0,this._abortTile(f),this._unloadTile(f))))}_dataHandler(o){const f=o.sourceDataType;o.dataType==="source"&&f==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&o.dataType==="source"&&f==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(o);this._cache.reset()}tilesIn(o,f,y){const x=[],S=this.transform;if(!S)return x;const R=y?S.getCameraQueryGeometry(o):o,B=o.map(be=>S.pointCoordinate(be,this.terrain)),F=R.map(be=>S.pointCoordinate(be,this.terrain)),H=this.getIds();let Y=1/0,J=1/0,he=-1/0,xe=-1/0;for(const be of F)Y=Math.min(Y,be.x),J=Math.min(J,be.y),he=Math.max(he,be.x),xe=Math.max(xe,be.y);for(let be=0;be<H.length;be++){const Ce=this._tiles[H[be]];if(Ce.holdingForFade())continue;const Ie=Ce.tileID,Ae=Math.pow(2,S.zoom-Ce.tileID.overscaledZ),ze=f*Ce.queryPadding*a.X/Ce.tileSize/Ae,Ee=[Ie.getTilePoint(new a.Z(Y,J)),Ie.getTilePoint(new a.Z(he,xe))];if(Ee[0].x-ze<a.X&&Ee[0].y-ze<a.X&&Ee[1].x+ze>=0&&Ee[1].y+ze>=0){const Fe=B.map(Ke=>Ie.getTilePoint(Ke)),qe=F.map(Ke=>Ie.getTilePoint(Ke));x.push({tile:Ce,tileID:Ie,queryGeometry:Fe,cameraQueryGeometry:qe,scale:Ae})}}return x}getVisibleCoordinates(o){const f=this.getRenderableIds(o).map(y=>this._tiles[y].tileID);for(const y of f)y.posMatrix=this.transform.calculatePosMatrix(y.toUnwrapped());return f}hasTransition(){if(this._source.hasTransition())return!0;if(st(this._source.type)){const o=v.now();for(const f in this._tiles)if(this._tiles[f].fadeEndTime>=o)return!0}return!1}setFeatureState(o,f,y){this._state.updateState(o=o||"_geojsonTileLayer",f,y)}removeFeatureState(o,f,y){this._state.removeFeatureState(o=o||"_geojsonTileLayer",f,y)}getFeatureState(o,f){return this._state.getState(o=o||"_geojsonTileLayer",f)}setDependencies(o,f,y){const x=this._tiles[o];x&&x.setDependencies(f,y)}reloadTilesForDependencies(o,f){for(const y in this._tiles)this._tiles[y].hasDependency(o,f)&&this._reloadTile(y,"reloading");this._cache.filter(y=>!y.hasDependency(o,f))}}function tt(E,o){const f=Math.abs(2*E.wrap)-+(E.wrap<0),y=Math.abs(2*o.wrap)-+(o.wrap<0);return E.overscaledZ-o.overscaledZ||y-f||o.canonical.y-E.canonical.y||o.canonical.x-E.canonical.x}function st(E){return E==="raster"||E==="image"||E==="video"}Ue.maxOverzooming=10,Ue.maxUnderzooming=3;class dt{constructor(o,f){this.reset(o,f)}reset(o,f){this.points=o||[],this._distances=[0];for(let y=1;y<this.points.length;y++)this._distances[y]=this._distances[y-1]+this.points[y].dist(this.points[y-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=a.ac(o,0,1);let f=1,y=this._distances[f];const x=o*this.paddedLength+this.padding;for(;y<x&&f<this._distances.length;)y=this._distances[++f];const S=f-1,R=this._distances[S],B=y-R,F=B>0?(x-R)/B:0;return this.points[S].mult(1-F).add(this.points[f].mult(F))}}function ht(E,o){let f=!0;return E==="always"||E!=="never"&&o!=="never"||(f=!1),f}class Ot{constructor(o,f,y){const x=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(o/y),this.yCellCount=Math.ceil(f/y);for(let R=0;R<this.xCellCount*this.yCellCount;R++)x.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=f,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,f,y,x,S){this._forEachCell(f,y,x,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(f),this.bboxes.push(y),this.bboxes.push(x),this.bboxes.push(S)}insertCircle(o,f,y,x){this._forEachCell(f-x,y-x,f+x,y+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(f),this.circles.push(y),this.circles.push(x)}_insertBoxCell(o,f,y,x,S,R){this.boxCells[S].push(R)}_insertCircleCell(o,f,y,x,S,R){this.circleCells[S].push(R)}_query(o,f,y,x,S,R,B){if(y<0||o>this.width||x<0||f>this.height)return[];const F=[];if(o<=0&&f<=0&&this.width<=y&&this.height<=x){if(S)return[{key:null,x1:o,y1:f,x2:y,y2:x}];for(let H=0;H<this.boxKeys.length;H++)F.push({key:this.boxKeys[H],x1:this.bboxes[4*H],y1:this.bboxes[4*H+1],x2:this.bboxes[4*H+2],y2:this.bboxes[4*H+3]});for(let H=0;H<this.circleKeys.length;H++){const Y=this.circles[3*H],J=this.circles[3*H+1],he=this.circles[3*H+2];F.push({key:this.circleKeys[H],x1:Y-he,y1:J-he,x2:Y+he,y2:J+he})}}else this._forEachCell(o,f,y,x,this._queryCell,F,{hitTest:S,overlapMode:R,seenUids:{box:{},circle:{}}},B);return F}query(o,f,y,x){return this._query(o,f,y,x,!1,null)}hitTest(o,f,y,x,S,R){return this._query(o,f,y,x,!0,S,R).length>0}hitTestCircle(o,f,y,x,S){const R=o-y,B=o+y,F=f-y,H=f+y;if(B<0||R>this.width||H<0||F>this.height)return!1;const Y=[];return this._forEachCell(R,F,B,H,this._queryCellCircle,Y,{hitTest:!0,overlapMode:x,circle:{x:o,y:f,radius:y},seenUids:{box:{},circle:{}}},S),Y.length>0}_queryCell(o,f,y,x,S,R,B,F){const{seenUids:H,hitTest:Y,overlapMode:J}=B,he=this.boxCells[S];if(he!==null){const be=this.bboxes;for(const Ce of he)if(!H.box[Ce]){H.box[Ce]=!0;const Ie=4*Ce,Ae=this.boxKeys[Ce];if(o<=be[Ie+2]&&f<=be[Ie+3]&&y>=be[Ie+0]&&x>=be[Ie+1]&&(!F||F(Ae))&&(!Y||!ht(J,Ae.overlapMode))&&(R.push({key:Ae,x1:be[Ie],y1:be[Ie+1],x2:be[Ie+2],y2:be[Ie+3]}),Y))return!0}}const xe=this.circleCells[S];if(xe!==null){const be=this.circles;for(const Ce of xe)if(!H.circle[Ce]){H.circle[Ce]=!0;const Ie=3*Ce,Ae=this.circleKeys[Ce];if(this._circleAndRectCollide(be[Ie],be[Ie+1],be[Ie+2],o,f,y,x)&&(!F||F(Ae))&&(!Y||!ht(J,Ae.overlapMode))){const ze=be[Ie],Ee=be[Ie+1],Fe=be[Ie+2];if(R.push({key:Ae,x1:ze-Fe,y1:Ee-Fe,x2:ze+Fe,y2:Ee+Fe}),Y)return!0}}}return!1}_queryCellCircle(o,f,y,x,S,R,B,F){const{circle:H,seenUids:Y,overlapMode:J}=B,he=this.boxCells[S];if(he!==null){const be=this.bboxes;for(const Ce of he)if(!Y.box[Ce]){Y.box[Ce]=!0;const Ie=4*Ce,Ae=this.boxKeys[Ce];if(this._circleAndRectCollide(H.x,H.y,H.radius,be[Ie+0],be[Ie+1],be[Ie+2],be[Ie+3])&&(!F||F(Ae))&&!ht(J,Ae.overlapMode))return R.push(!0),!0}}const xe=this.circleCells[S];if(xe!==null){const be=this.circles;for(const Ce of xe)if(!Y.circle[Ce]){Y.circle[Ce]=!0;const Ie=3*Ce,Ae=this.circleKeys[Ce];if(this._circlesCollide(be[Ie],be[Ie+1],be[Ie+2],H.x,H.y,H.radius)&&(!F||F(Ae))&&!ht(J,Ae.overlapMode))return R.push(!0),!0}}}_forEachCell(o,f,y,x,S,R,B,F){const H=this._convertToXCellCoord(o),Y=this._convertToYCellCoord(f),J=this._convertToXCellCoord(y),he=this._convertToYCellCoord(x);for(let xe=H;xe<=J;xe++)for(let be=Y;be<=he;be++)if(S.call(this,o,f,y,x,this.xCellCount*be+xe,R,B,F))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,f,y,x,S,R){const B=x-o,F=S-f,H=y+R;return H*H>B*B+F*F}_circleAndRectCollide(o,f,y,x,S,R,B){const F=(R-x)/2,H=Math.abs(o-(x+F));if(H>F+y)return!1;const Y=(B-S)/2,J=Math.abs(f-(S+Y));if(J>Y+y)return!1;if(H<=F||J<=Y)return!0;const he=H-F,xe=J-Y;return he*he+xe*xe<=y*y}}function Lt(E,o,f,y,x){const S=a.H();return o?(a.K(S,S,[1/x,1/x,1]),f||a.ad(S,S,y.angle)):a.L(S,y.labelPlaneMatrix,E),S}function Kt(E,o,f,y,x){if(o){const S=a.ae(E);return a.K(S,S,[x,x,1]),f||a.ad(S,S,-y.angle),S}return y.glCoordMatrix}function Se(E,o,f,y){let x;y?(x=[E,o,y(E,o),1],a.af(x,x,f)):(x=[E,o,0,1],gr(x,x,f));const S=x[3];return{point:new a.P(x[0]/S,x[1]/S),signedDistanceFromCamera:S,isOccluded:!1}}function re(E,o){return .5+E/o*.5}function ee(E,o){return E.x>=-o[0]&&E.x<=o[0]&&E.y>=-o[1]&&E.y<=o[1]}function fe(E,o,f,y,x,S,R,B,F,H,Y,J,he,xe,be){const Ce=y?E.textSizeData:E.iconSizeData,Ie=a.ag(Ce,f.transform.zoom),Ae=[256/f.width*2+1,256/f.height*2+1],ze=y?E.text.dynamicLayoutVertexArray:E.icon.dynamicLayoutVertexArray;ze.clear();const Ee=E.lineVertexArray,Fe=y?E.text.placedSymbolArray:E.icon.placedSymbolArray,qe=f.transform.width/f.transform.height;let Ke=!1;for(let ct=0;ct<Fe.length;ct++){const _t=Fe.get(ct);if(_t.hidden||_t.writingMode===a.ah.vertical&&!Ke){Ut(_t.numGlyphs,ze);continue}Ke=!1;const It=Se(_t.anchorX,_t.anchorY,o,be);if(!ee(It.point,Ae)){Ut(_t.numGlyphs,ze);continue}const zt=re(f.transform.cameraToCenterDistance,It.signedDistanceFromCamera),Et=a.ai(Ce,Ie,_t),St=R?Et/zt:Et*zt,Wt={getElevation:be,labelPlaneMatrix:x,lineVertexArray:Ee,pitchWithMap:R,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:H,tileAnchorPoint:new a.P(_t.anchorX,_t.anchorY),unwrappedTileID:Y,width:J,height:he,translation:xe},hr=Ne(Wt,_t,St,!1,B,o,S,E.glyphOffsetArray,ze,qe,F);Ke=hr.useVertical,(hr.notEnoughRoom||Ke||hr.needsFlipping&&Ne(Wt,_t,St,!0,B,o,S,E.glyphOffsetArray,ze,qe,F).notEnoughRoom)&&Ut(_t.numGlyphs,ze)}y?E.text.dynamicLayoutVertexBuffer.updateData(ze):E.icon.dynamicLayoutVertexBuffer.updateData(ze)}function we(E,o,f,y,x,S,R,B){const F=S.glyphStartIndex+S.numGlyphs,H=S.lineStartIndex,Y=S.lineStartIndex+S.lineLength,J=o.getoffsetX(S.glyphStartIndex),he=o.getoffsetX(F-1),xe=xt(E*J,f,y,x,S.segment,H,Y,B,R);if(!xe)return null;const be=xt(E*he,f,y,x,S.segment,H,Y,B,R);return be?B.projectionCache.anyProjectionOccluded?null:{first:xe,last:be}:null}function Me(E,o,f,y){return E===a.ah.horizontal&&Math.abs(f.y-o.y)>Math.abs(f.x-o.x)*y?{useVertical:!0}:(E===a.ah.vertical?o.y<f.y:o.x>f.x)?{needsFlipping:!0}:null}function Ne(E,o,f,y,x,S,R,B,F,H,Y){const J=f/24,he=o.lineOffsetX*J,xe=o.lineOffsetY*J;let be;if(o.numGlyphs>1){const Ce=o.glyphStartIndex+o.numGlyphs,Ie=o.lineStartIndex,Ae=o.lineStartIndex+o.lineLength,ze=we(J,B,he,xe,y,o,Y,E);if(!ze)return{notEnoughRoom:!0};const Ee=Se(ze.first.point.x,ze.first.point.y,R,E.getElevation).point,Fe=Se(ze.last.point.x,ze.last.point.y,R,E.getElevation).point;if(x&&!y){const qe=Me(o.writingMode,Ee,Fe,H);if(qe)return qe}be=[ze.first];for(let qe=o.glyphStartIndex+1;qe<Ce-1;qe++)be.push(xt(J*B.getoffsetX(qe),he,xe,y,o.segment,Ie,Ae,E,Y));be.push(ze.last)}else{if(x&&!y){const Ie=Se(E.tileAnchorPoint.x,E.tileAnchorPoint.y,S,E.getElevation).point,Ae=o.lineStartIndex+o.segment+1,ze=new a.P(E.lineVertexArray.getx(Ae),E.lineVertexArray.gety(Ae)),Ee=Se(ze.x,ze.y,S,E.getElevation),Fe=Ee.signedDistanceFromCamera>0?Ee.point:function(Ke,ct,_t,It,zt,Et){return Ve(Ke,ct,_t,1,zt,Et)}(E.tileAnchorPoint,ze,Ie,0,S,E),qe=Me(o.writingMode,Ie,Fe,H);if(qe)return qe}const Ce=xt(J*B.getoffsetX(o.glyphStartIndex),he,xe,y,o.segment,o.lineStartIndex,o.lineStartIndex+o.lineLength,E,Y);if(!Ce||E.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};be=[Ce]}for(const Ce of be)a.aj(F,Ce.point,Ce.angle);return{}}function Ve(E,o,f,y,x,S){const R=E.add(E.sub(o)._unit()),B=x!==void 0?Se(R.x,R.y,x,S.getElevation).point:Ye(R.x,R.y,S).point,F=f.sub(B);return f.add(F._mult(y/F.mag()))}function ke(E,o,f){const y=o.projectionCache;if(y.projections[E])return y.projections[E];const x=new a.P(o.lineVertexArray.getx(E),o.lineVertexArray.gety(E)),S=Ye(x.x,x.y,o);if(S.signedDistanceFromCamera>0)return y.projections[E]=S.point,y.anyProjectionOccluded=y.anyProjectionOccluded||S.isOccluded,S.point;const R=E-f.direction;return function(B,F,H,Y,J){return Ve(B,F,H,Y,void 0,J)}(f.distanceFromAnchor===0?o.tileAnchorPoint:new a.P(o.lineVertexArray.getx(R),o.lineVertexArray.gety(R)),x,f.previousVertex,f.absOffsetX-f.distanceFromAnchor+1,o)}function Ye(E,o,f){const y=E+f.translation[0],x=o+f.translation[1];let S;return!f.pitchWithMap&&f.projection.useSpecialProjectionForSymbols?(S=f.projection.projectTileCoordinates(y,x,f.unwrappedTileID,f.getElevation),S.point.x=(.5*S.point.x+.5)*f.width,S.point.y=(.5*-S.point.y+.5)*f.height):(S=Se(y,x,f.labelPlaneMatrix,f.getElevation),S.isOccluded=!1),S}function ot(E,o,f){return E._unit()._perp()._mult(o*f)}function Xe(E,o,f,y,x,S,R,B,F){if(B.projectionCache.offsets[E])return B.projectionCache.offsets[E];const H=f.add(o);if(E+F.direction<y||E+F.direction>=x)return B.projectionCache.offsets[E]=H,H;const Y=ke(E+F.direction,B,F),J=ot(Y.sub(f),R,F.direction),he=f.add(J),xe=Y.add(J);return B.projectionCache.offsets[E]=a.ak(S,H,he,xe)||H,B.projectionCache.offsets[E]}function xt(E,o,f,y,x,S,R,B,F){const H=y?E-o:E+o;let Y=H>0?1:-1,J=0;y&&(Y*=-1,J=Math.PI),Y<0&&(J+=Math.PI);let he,xe=Y>0?S+x:S+x+1;B.projectionCache.cachedAnchorPoint?he=B.projectionCache.cachedAnchorPoint:(he=Ye(B.tileAnchorPoint.x,B.tileAnchorPoint.y,B).point,B.projectionCache.cachedAnchorPoint=he);let be,Ce,Ie=he,Ae=he,ze=0,Ee=0;const Fe=Math.abs(H),qe=[];let Ke;for(;ze+Ee<=Fe;){if(xe+=Y,xe<S||xe>=R)return null;ze+=Ee,Ae=Ie,Ce=be;const It={absOffsetX:Fe,direction:Y,distanceFromAnchor:ze,previousVertex:Ae};if(Ie=ke(xe,B,It),f===0)qe.push(Ae),Ke=Ie.sub(Ae);else{let zt;const Et=Ie.sub(Ae);zt=Et.mag()===0?ot(ke(xe+Y,B,It).sub(Ie),f,Y):ot(Et,f,Y),Ce||(Ce=Ae.add(zt)),be=Xe(xe,zt,Ie,S,R,Ce,f,B,It),qe.push(Ce),Ke=be.sub(Ce)}Ee=Ke.mag()}const ct=Ke._mult((Fe-ze)/Ee)._add(Ce||Ae),_t=J+Math.atan2(Ie.y-Ae.y,Ie.x-Ae.x);return qe.push(ct),{point:ct,angle:F?_t:0,path:qe}}const Ct=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ut(E,o){for(let f=0;f<E;f++){const y=o.length;o.resize(y+4),o.float32.set(Ct,3*y)}}function gr(E,o,f){const y=o[0],x=o[1];return E[0]=f[0]*y+f[4]*x+f[12],E[1]=f[1]*y+f[5]*x+f[13],E[3]=f[3]*y+f[7]*x+f[15],E}const ar=100;class xr{constructor(o,f,y=new Ot(o.width+200,o.height+200,25),x=new Ot(o.width+200,o.height+200,25)){this.transform=o,this.mapProjection=f,this.grid=y,this.ignoredGrid=x,this.pitchFactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+ar,this.screenBottomBoundary=o.height+ar,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(o,f,y,x,S,R,B,F,H,Y,J){const he=o.anchorPointX+F[0],xe=o.anchorPointY+F[1],be=this.projectAndGetPerspectiveRatio(x,he,xe,S,Y),Ce=y*be.perspectiveRatio;let Ie;if(R||B)Ie=this._projectCollisionBox(o,Ce,x,S,R,B,F,be,Y,J);else{const qe=be.point.x+(J?J.x*Ce:0),Ke=be.point.y+(J?J.y*Ce:0);Ie={allPointsOccluded:!1,box:[qe+o.x1*Ce,Ke+o.y1*Ce,qe+o.x2*Ce,Ke+o.y2*Ce]}}const[Ae,ze,Ee,Fe]=Ie.box;return this.mapProjection.useSpecialProjectionForSymbols&&(R?Ie.allPointsOccluded:this.mapProjection.isOccluded(he,xe,S))||be.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(Ae,ze,Ee,Fe)||f!=="always"&&this.grid.hitTest(Ae,ze,Ee,Fe,f,H)?{box:[Ae,ze,Ee,Fe],placeable:!1,offscreen:!1}:{box:[Ae,ze,Ee,Fe],placeable:!0,offscreen:this.isOffscreen(Ae,ze,Ee,Fe)}}placeCollisionCircles(o,f,y,x,S,R,B,F,H,Y,J,he,xe,be,Ce,Ie){const Ae=[],ze=new a.P(f.anchorX,f.anchorY),Ee=this.getPerspectiveRatio(R,ze.x,ze.y,B,Ie),Fe=(J?S/Ee:S*Ee)/a.ap,qe={getElevation:Ie,labelPlaneMatrix:F,lineVertexArray:y,pitchWithMap:J,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:ze,unwrappedTileID:B,width:this.transform.width,height:this.transform.height,translation:Ce},Ke=we(Fe,x,f.lineOffsetX*Fe,f.lineOffsetY*Fe,!1,f,!1,qe);let ct=!1,_t=!1,It=!0;if(Ke){const zt=.5*xe*Ee+be,Et=new a.P(-100,-100),St=new a.P(this.screenRightBoundary,this.screenBottomBoundary),Wt=new dt,hr=Ke.first,kt=Ke.last;let Dt=[];for(let yr=hr.path.length-1;yr>=1;yr--)Dt.push(hr.path[yr]);for(let yr=1;yr<kt.path.length;yr++)Dt.push(kt.path[yr]);const ur=2.5*zt;if(H){const yr=this.projectPathToScreenSpace(Dt,qe,H);Dt=yr.some(Sr=>Sr.signedDistanceFromCamera<=0)?[]:yr.map(Sr=>Sr.point)}let Jr=[];if(Dt.length>0){const yr=Dt[0].clone(),Sr=Dt[0].clone();for(let Qr=1;Qr<Dt.length;Qr++)yr.x=Math.min(yr.x,Dt[Qr].x),yr.y=Math.min(yr.y,Dt[Qr].y),Sr.x=Math.max(Sr.x,Dt[Qr].x),Sr.y=Math.max(Sr.y,Dt[Qr].y);Jr=yr.x>=Et.x&&Sr.x<=St.x&&yr.y>=Et.y&&Sr.y<=St.y?[Dt]:Sr.x<Et.x||yr.x>St.x||Sr.y<Et.y||yr.y>St.y?[]:a.al([Dt],Et.x,Et.y,St.x,St.y)}for(const yr of Jr){Wt.reset(yr,.25*zt);let Sr=0;Sr=Wt.length<=.5*zt?1:Math.ceil(Wt.paddedLength/ur)+1;for(let Qr=0;Qr<Sr;Qr++){const ni=Qr/Math.max(Sr-1,1),Ta=Wt.lerp(ni),en=Ta.x+ar,Mi=Ta.y+ar;Ae.push(en,Mi,zt,0);const gi=en-zt,ii=Mi-zt,vi=en+zt,Ha=Mi+zt;if(It=It&&this.isOffscreen(gi,ii,vi,Ha),_t=_t||this.isInsideGrid(gi,ii,vi,Ha),o!=="always"&&this.grid.hitTestCircle(en,Mi,zt,o,he)&&(ct=!0,!Y))return{circles:[],offscreen:!1,collisionDetected:ct}}}}return{circles:!Y&&ct||!_t||Ee<this.perspectiveRatioCutoff?[]:Ae,offscreen:It,collisionDetected:ct}}projectPathToScreenSpace(o,f,y){return o.map(x=>Se(x.x,x.y,y,f.getElevation))}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const f=[];let y=1/0,x=1/0,S=-1/0,R=-1/0;for(const Y of o){const J=new a.P(Y.x+ar,Y.y+ar);y=Math.min(y,J.x),x=Math.min(x,J.y),S=Math.max(S,J.x),R=Math.max(R,J.y),f.push(J)}const B=this.grid.query(y,x,S,R).concat(this.ignoredGrid.query(y,x,S,R)),F={},H={};for(const Y of B){const J=Y.key;if(F[J.bucketInstanceId]===void 0&&(F[J.bucketInstanceId]={}),F[J.bucketInstanceId][J.featureIndex])continue;const he=[new a.P(Y.x1,Y.y1),new a.P(Y.x2,Y.y1),new a.P(Y.x2,Y.y2),new a.P(Y.x1,Y.y2)];a.am(f,he)&&(F[J.bucketInstanceId][J.featureIndex]=!0,H[J.bucketInstanceId]===void 0&&(H[J.bucketInstanceId]=[]),H[J.bucketInstanceId].push(J.featureIndex))}return H}insertCollisionBox(o,f,y,x,S,R){(y?this.ignoredGrid:this.grid).insert({bucketInstanceId:x,featureIndex:S,collisionGroupID:R,overlapMode:f},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,f,y,x,S,R){const B=y?this.ignoredGrid:this.grid,F={bucketInstanceId:x,featureIndex:S,collisionGroupID:R,overlapMode:f};for(let H=0;H<o.length;H+=4)B.insertCircle(F,o[H],o[H+1],o[H+2])}projectAndGetPerspectiveRatio(o,f,y,x,S){let R;S?(R=[f,y,S(f,y),1],a.af(R,R,o)):(R=[f,y,0,1],gr(R,R,o));const B=R[3];return{point:new a.P((R[0]/B+1)/2*this.transform.width+ar,(-R[1]/B+1)/2*this.transform.height+ar),perspectiveRatio:.5+this.transform.cameraToCenterDistance/B*.5,isOccluded:!1,signedDistanceFromCamera:B}}getPerspectiveRatio(o,f,y,x,S){const R=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(f,y,x,S):Se(f,y,o,S);return .5+this.transform.cameraToCenterDistance/R.signedDistanceFromCamera*.5}isOffscreen(o,f,y,x){return y<ar||o>=this.screenRightBoundary||x<ar||f>this.screenBottomBoundary}isInsideGrid(o,f,y,x){return y>=0&&o<this.gridRightBoundary&&x>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const o=a.an([]);return a.J(o,o,[-100,-100,0]),o}_projectCollisionBox(o,f,y,x,S,R,B,F,H,Y){let J=new a.P(1,0),he=new a.P(0,1);const xe=new a.P(o.anchorPointX+B[0],o.anchorPointY+B[1]);if(R&&!S){const It=this.projectAndGetPerspectiveRatio(y,xe.x+1,xe.y,x,H).point.sub(F.point).unit(),zt=Math.atan(It.y/It.x)+(It.x<0?Math.PI:0),Et=Math.sin(zt),St=Math.cos(zt);J=new a.P(St,Et),he=new a.P(-Et,St)}else if(!R&&S){const It=-this.transform.angle,zt=Math.sin(It),Et=Math.cos(It);J=new a.P(Et,zt),he=new a.P(-zt,Et)}let be=F.point,Ce=f;if(S){be=xe;const It=this.transform.zoom-Math.floor(this.transform.zoom);Ce=Math.pow(2,-It),Ce*=this.mapProjection.getPitchedTextCorrection(this.transform,xe,x),Y||(Ce*=a.ac(.5+F.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}Y&&(be=be.add(J.mult(Y.x*Ce)).add(he.mult(Y.y*Ce)));const Ie=o.x1*Ce,Ae=o.x2*Ce,ze=(Ie+Ae)/2,Ee=o.y1*Ce,Fe=o.y2*Ce,qe=(Ee+Fe)/2,Ke=[{offsetX:Ie,offsetY:Ee},{offsetX:ze,offsetY:Ee},{offsetX:Ae,offsetY:Ee},{offsetX:Ae,offsetY:qe},{offsetX:Ae,offsetY:Fe},{offsetX:ze,offsetY:Fe},{offsetX:Ie,offsetY:Fe},{offsetX:Ie,offsetY:qe}];let ct=[];for(const{offsetX:It,offsetY:zt}of Ke)ct.push(new a.P(be.x+J.x*It+he.x*zt,be.y+J.y*It+he.y*zt));let _t=!1;if(S){const It=ct.map(zt=>this.projectAndGetPerspectiveRatio(y,zt.x,zt.y,x,H));_t=It.some(zt=>!zt.isOccluded),ct=It.map(zt=>zt.point)}else _t=!0;return{box:a.ao(ct),allPointsOccluded:!_t}}}function fr(E,o,f){return o*(a.X/(E.tileSize*Math.pow(2,f-E.tileID.overscaledZ)))}class kr{constructor(o,f,y,x){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?f:-f))):x&&y?1:0,this.placed=y}isHidden(){return this.opacity===0&&!this.placed}}class _r{constructor(o,f,y,x,S){this.text=new kr(o?o.text:null,f,y,S),this.icon=new kr(o?o.icon:null,f,x,S)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class rr{constructor(o,f,y){this.text=o,this.icon=f,this.skipFade=y}}class Er{constructor(){this.invProjMatrix=a.H(),this.viewportMatrix=a.H(),this.circles=[]}}class br{constructor(o,f,y,x,S){this.bucketInstanceId=o,this.featureIndex=f,this.sourceLayerIndex=y,this.bucketIndex=x,this.tileID=S}}class cn{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const f=++this.maxGroupID;this.collisionGroups[o]={ID:f,predicate:y=>y.collisionGroupID===f}}return this.collisionGroups[o]}}function wn(E,o,f,y,x){const{horizontalAlign:S,verticalAlign:R}=a.au(E);return new a.P(-(S-.5)*o+y[0]*x,-(R-.5)*f+y[1]*x)}class Pn{constructor(o,f,y,x,S,R){this.transform=o.clone(),this.terrain=y,this.collisionIndex=new xr(this.transform,f),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=x,this.retainedQueryData={},this.collisionGroups=new cn(S),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=R,R&&(R.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(o){const f=this.terrain;return f?(y,x)=>f.getElevation(o,y,x):null}getBucketParts(o,f,y,x){const S=y.getBucket(f),R=y.latestFeatureIndex;if(!S||!R||f.id!==S.layerIds[0])return;const B=y.collisionBoxArray,F=S.layers[0].layout,H=S.layers[0].paint,Y=Math.pow(2,this.transform.zoom-y.tileID.overscaledZ),J=y.tileSize/a.X,he=y.tileID.toUnwrapped(),xe=this.transform.calculatePosMatrix(he),be=F.get("text-pitch-alignment")==="map",Ce=F.get("text-rotation-alignment")==="map",Ie=fr(y,1,this.transform.zoom),Ae=this.collisionIndex.mapProjection.translatePosition(this.transform,y,H.get("text-translate"),H.get("text-translate-anchor")),ze=this.collisionIndex.mapProjection.translatePosition(this.transform,y,H.get("icon-translate"),H.get("icon-translate-anchor")),Ee=Lt(xe,be,Ce,this.transform,Ie);let Fe=null;if(be){const Ke=Kt(xe,be,Ce,this.transform,Ie);Fe=a.L([],this.transform.labelPlaneMatrix,Ke)}this.retainedQueryData[S.bucketInstanceId]=new br(S.bucketInstanceId,R,S.sourceLayerIndex,S.index,y.tileID);const qe={bucket:S,layout:F,translationText:Ae,translationIcon:ze,posMatrix:xe,unwrappedTileID:he,textLabelPlaneMatrix:Ee,labelToScreenMatrix:Fe,scale:Y,textPixelRatio:J,holdingForFade:y.holdingForFade(),collisionBoxArray:B,partiallyEvaluatedTextSize:a.ag(S.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(x)for(const Ke of S.sortKeyRanges){const{sortKey:ct,symbolInstanceStart:_t,symbolInstanceEnd:It}=Ke;o.push({sortKey:ct,symbolInstanceStart:_t,symbolInstanceEnd:It,parameters:qe})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:qe})}attemptAnchorPlacement(o,f,y,x,S,R,B,F,H,Y,J,he,xe,be,Ce,Ie,Ae,ze,Ee){const Fe=a.aq[o.textAnchor],qe=[o.textOffset0,o.textOffset1],Ke=wn(Fe,y,x,qe,S),ct=this.collisionIndex.placeCollisionBox(f,he,F,H,Y,B,R,Ie,J.predicate,Ee,Ke);if((!ze||this.collisionIndex.placeCollisionBox(ze,he,F,H,Y,B,R,Ae,J.predicate,Ee,Ke).placeable)&&ct.placeable){let _t;if(this.prevPlacement&&this.prevPlacement.variableOffsets[xe.crossTileID]&&this.prevPlacement.placements[xe.crossTileID]&&this.prevPlacement.placements[xe.crossTileID].text&&(_t=this.prevPlacement.variableOffsets[xe.crossTileID].anchor),xe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[xe.crossTileID]={textOffset:qe,width:y,height:x,anchor:Fe,textBoxScale:S,prevAnchor:_t},this.markUsedJustification(be,Fe,xe,Ce),be.allowVerticalPlacement&&(this.markUsedOrientation(be,Ce,xe),this.placedOrientations[xe.crossTileID]=Ce),{shift:Ke,placedGlyphBoxes:ct}}}placeLayerBucketPart(o,f,y){const{bucket:x,layout:S,translationText:R,translationIcon:B,posMatrix:F,unwrappedTileID:H,textLabelPlaneMatrix:Y,labelToScreenMatrix:J,textPixelRatio:he,holdingForFade:xe,collisionBoxArray:be,partiallyEvaluatedTextSize:Ce,collisionGroup:Ie}=o.parameters,Ae=S.get("text-optional"),ze=S.get("icon-optional"),Ee=a.ar(S,"text-overlap","text-allow-overlap"),Fe=Ee==="always",qe=a.ar(S,"icon-overlap","icon-allow-overlap"),Ke=qe==="always",ct=S.get("text-rotation-alignment")==="map",_t=S.get("text-pitch-alignment")==="map",It=S.get("icon-text-fit")!=="none",zt=S.get("symbol-z-order")==="viewport-y",Et=Fe&&(Ke||!x.hasIconData()||ze),St=Ke&&(Fe||!x.hasTextData()||Ae);!x.collisionArrays&&be&&x.deserializeCollisionBoxes(be);const Wt=this._getTerrainElevationFunc(this.retainedQueryData[x.bucketInstanceId].tileID),hr=(kt,Dt,ur)=>{var Jr,yr;if(f[kt.crossTileID])return;if(xe)return void(this.placements[kt.crossTileID]=new rr(!1,!1,!1));let Sr=!1,Qr=!1,ni=!0,Ta=null,en={box:null,placeable:!1,offscreen:null},Mi={placeable:!1},gi=null,ii=null,vi=null,Ha=0,cl=0,lh=0;Dt.textFeatureIndex?Ha=Dt.textFeatureIndex:kt.useRuntimeCollisionCircles&&(Ha=kt.featureIndex),Dt.verticalTextFeatureIndex&&(cl=Dt.verticalTextFeatureIndex);const hl=Dt.textBox;if(hl){const ua=Gn=>{let ai=a.ah.horizontal;if(x.allowVerticalPlacement&&!Gn&&this.prevPlacement){const Xi=this.prevPlacement.placedOrientations[kt.crossTileID];Xi&&(this.placedOrientations[kt.crossTileID]=Xi,ai=Xi,this.markUsedOrientation(x,ai,kt))}return ai},ca=(Gn,ai)=>{if(x.allowVerticalPlacement&&kt.numVerticalGlyphVertices>0&&Dt.verticalTextBox){for(const Xi of x.writingModes)if(Xi===a.ah.vertical?(en=ai(),Mi=en):en=Gn(),en&&en.placeable)break}else en=Gn()},zs=kt.textAnchorOffsetStartIndex,Ca=kt.textAnchorOffsetEndIndex;if(Ca===zs){const Gn=(ai,Xi)=>{const Cr=this.collisionIndex.placeCollisionBox(ai,Ee,he,F,H,_t,ct,R,Ie.predicate,Wt);return Cr&&Cr.placeable&&(this.markUsedOrientation(x,Xi,kt),this.placedOrientations[kt.crossTileID]=Xi),Cr};ca(()=>Gn(hl,a.ah.horizontal),()=>{const ai=Dt.verticalTextBox;return x.allowVerticalPlacement&&kt.numVerticalGlyphVertices>0&&ai?Gn(ai,a.ah.vertical):{box:null,offscreen:null}}),ua(en&&en.placeable)}else{let Gn=a.aq[(yr=(Jr=this.prevPlacement)===null||Jr===void 0?void 0:Jr.variableOffsets[kt.crossTileID])===null||yr===void 0?void 0:yr.anchor];const ai=(Cr,mo,dl)=>{const fl=Cr.x2-Cr.x1,Mg=Cr.y2-Cr.y1,Lx=kt.textBoxScale,Dg=It&&qe==="never"?mo:null;let Rs=null,Ng=Ee==="never"?1:2,ch="never";Gn&&Ng++;for(let zu=0;zu<Ng;zu++){for(let hh=zs;hh<Ca;hh++){const dh=x.textAnchorOffsets.get(hh);if(Gn&&dh.textAnchor!==Gn)continue;const pl=this.attemptAnchorPlacement(dh,Cr,fl,Mg,Lx,ct,_t,he,F,H,Ie,ch,kt,x,dl,R,B,Dg,Wt);if(pl&&(Rs=pl.placedGlyphBoxes,Rs&&Rs.placeable))return Sr=!0,Ta=pl.shift,Rs}Gn?Gn=null:ch=Ee}return y&&!Rs&&(Rs={box:this.collisionIndex.placeCollisionBox(hl,"always",he,F,H,_t,ct,R,Ie.predicate,Wt,new a.P(0,0)).box,offscreen:!1,placeable:!1}),Rs};ca(()=>ai(hl,Dt.iconBox,a.ah.horizontal),()=>{const Cr=Dt.verticalTextBox;return x.allowVerticalPlacement&&(!en||!en.placeable)&&kt.numVerticalGlyphVertices>0&&Cr?ai(Cr,Dt.verticalIconBox,a.ah.vertical):{box:null,occluded:!0,offscreen:null}}),en&&(Sr=en.placeable,ni=en.offscreen);const Xi=ua(en&&en.placeable);if(!Sr&&this.prevPlacement){const Cr=this.prevPlacement.variableOffsets[kt.crossTileID];Cr&&(this.variableOffsets[kt.crossTileID]=Cr,this.markUsedJustification(x,Cr.anchor,kt,Xi))}}}if(gi=en,Sr=gi&&gi.placeable,ni=gi&&gi.offscreen,kt.useRuntimeCollisionCircles){const ua=x.text.placedSymbolArray.get(kt.centerJustifiedTextSymbolIndex),ca=a.ai(x.textSizeData,Ce,ua),zs=S.get("text-padding");ii=this.collisionIndex.placeCollisionCircles(Ee,ua,x.lineVertexArray,x.glyphOffsetArray,ca,F,H,Y,J,y,_t,Ie.predicate,kt.collisionCircleDiameter,zs,R,Wt),ii.circles.length&&ii.collisionDetected&&!y&&a.w("Collisions detected, but collision boxes are not shown"),Sr=Fe||ii.circles.length>0&&!ii.collisionDetected,ni=ni&&ii.offscreen}if(Dt.iconFeatureIndex&&(lh=Dt.iconFeatureIndex),Dt.iconBox){const ua=ca=>this.collisionIndex.placeCollisionBox(ca,qe,he,F,H,_t,ct,B,Ie.predicate,Wt,It&&Ta?Ta:void 0);Mi&&Mi.placeable&&Dt.verticalIconBox?(vi=ua(Dt.verticalIconBox),Qr=vi.placeable):(vi=ua(Dt.iconBox),Qr=vi.placeable),ni=ni&&vi.offscreen}const la=Ae||kt.numHorizontalGlyphVertices===0&&kt.numVerticalGlyphVertices===0,uh=ze||kt.numIconVertices===0;la||uh?uh?la||(Qr=Qr&&Sr):Sr=Qr&&Sr:Qr=Sr=Qr&&Sr;const If=Qr&&vi.placeable;if(Sr&&gi.placeable&&this.collisionIndex.insertCollisionBox(gi.box,Ee,S.get("text-ignore-placement"),x.bucketInstanceId,Mi&&Mi.placeable&&cl?cl:Ha,Ie.ID),If&&this.collisionIndex.insertCollisionBox(vi.box,qe,S.get("icon-ignore-placement"),x.bucketInstanceId,lh,Ie.ID),ii&&Sr&&this.collisionIndex.insertCollisionCircles(ii.circles,Ee,S.get("text-ignore-placement"),x.bucketInstanceId,Ha,Ie.ID),y&&this.storeCollisionData(x.bucketInstanceId,ur,Dt,gi,vi,ii),kt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(x.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[kt.crossTileID]=new rr(Sr||Et,Qr||St,ni||x.justReloaded),f[kt.crossTileID]=!0};if(zt){if(o.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const kt=x.getSortedSymbolIndexes(this.transform.angle);for(let Dt=kt.length-1;Dt>=0;--Dt){const ur=kt[Dt];hr(x.symbolInstances.get(ur),x.collisionArrays[ur],ur)}}else for(let kt=o.symbolInstanceStart;kt<o.symbolInstanceEnd;kt++)hr(x.symbolInstances.get(kt),x.collisionArrays[kt],kt);if(y&&x.bucketInstanceId in this.collisionCircleArrays){const kt=this.collisionCircleArrays[x.bucketInstanceId];a.as(kt.invProjMatrix,F),kt.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}storeCollisionData(o,f,y,x,S,R){if(y.textBox||y.iconBox){let B,F;this.collisionBoxArrays.has(o)?B=this.collisionBoxArrays.get(o):(B=new Map,this.collisionBoxArrays.set(o,B)),B.has(f)?F=B.get(f):(F={text:null,icon:null},B.set(f,F)),y.textBox&&(F.text=x.box),y.iconBox&&(F.icon=S.box)}if(R){let B=this.collisionCircleArrays[o];B===void 0&&(B=this.collisionCircleArrays[o]=new Er);for(let F=0;F<R.circles.length;F+=4)B.circles.push(R.circles[F+0]),B.circles.push(R.circles[F+1]),B.circles.push(R.circles[F+2]),B.circles.push(R.collisionDetected?1:0)}}markUsedJustification(o,f,y,x){let S;S=x===a.ah.vertical?y.verticalPlacedTextSymbolIndex:{left:y.leftJustifiedTextSymbolIndex,center:y.centerJustifiedTextSymbolIndex,right:y.rightJustifiedTextSymbolIndex}[a.at(f)];const R=[y.leftJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.rightJustifiedTextSymbolIndex,y.verticalPlacedTextSymbolIndex];for(const B of R)B>=0&&(o.text.placedSymbolArray.get(B).crossTileID=S>=0&&B!==S?0:y.crossTileID)}markUsedOrientation(o,f,y){const x=f===a.ah.horizontal||f===a.ah.horizontalOnly?f:0,S=f===a.ah.vertical?f:0,R=[y.leftJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.rightJustifiedTextSymbolIndex];for(const B of R)o.text.placedSymbolArray.get(B).placedOrientation=x;y.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(y.verticalPlacedTextSymbolIndex).placedOrientation=S)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let y=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const x=f?f.symbolFadeChange(o):1,S=f?f.opacities:{},R=f?f.variableOffsets:{},B=f?f.placedOrientations:{};for(const F in this.placements){const H=this.placements[F],Y=S[F];Y?(this.opacities[F]=new _r(Y,x,H.text,H.icon),y=y||H.text!==Y.text.placed||H.icon!==Y.icon.placed):(this.opacities[F]=new _r(null,x,H.text,H.icon,H.skipFade),y=y||H.text||H.icon)}for(const F in S){const H=S[F];if(!this.opacities[F]){const Y=new _r(H,x,!1,!1);Y.isHidden()||(this.opacities[F]=Y,y=y||H.text.placed||H.icon.placed)}}for(const F in R)this.variableOffsets[F]||!this.opacities[F]||this.opacities[F].isHidden()||(this.variableOffsets[F]=R[F]);for(const F in B)this.placedOrientations[F]||!this.opacities[F]||this.opacities[F].isHidden()||(this.placedOrientations[F]=B[F]);if(f&&f.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");y?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:o)}updateLayerOpacities(o,f){const y={};for(const x of f){const S=x.getBucket(o);S&&x.latestFeatureIndex&&o.id===S.layerIds[0]&&this.updateBucketOpacities(S,x.tileID,y,x.collisionBoxArray)}}updateBucketOpacities(o,f,y,x){o.hasTextData()&&(o.text.opacityVertexArray.clear(),o.text.hasVisibleVertices=!1),o.hasIconData()&&(o.icon.opacityVertexArray.clear(),o.icon.hasVisibleVertices=!1),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const S=o.layers[0],R=S.layout,B=new _r(null,0,!1,!1,!0),F=R.get("text-allow-overlap"),H=R.get("icon-allow-overlap"),Y=S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"),J=R.get("text-rotation-alignment")==="map",he=R.get("text-pitch-alignment")==="map",xe=R.get("icon-text-fit")!=="none",be=new _r(null,0,F&&(H||!o.hasIconData()||R.get("icon-optional")),H&&(F||!o.hasTextData()||R.get("text-optional")),!0);!o.collisionArrays&&x&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(x);const Ce=(Ae,ze,Ee)=>{for(let Fe=0;Fe<ze/4;Fe++)Ae.opacityVertexArray.emplaceBack(Ee);Ae.hasVisibleVertices=Ae.hasVisibleVertices||Ee!==ba},Ie=this.collisionBoxArrays.get(o.bucketInstanceId);for(let Ae=0;Ae<o.symbolInstances.length;Ae++){const ze=o.symbolInstances.get(Ae),{numHorizontalGlyphVertices:Ee,numVerticalGlyphVertices:Fe,crossTileID:qe}=ze;let Ke=this.opacities[qe];y[qe]?Ke=B:Ke||(Ke=be,this.opacities[qe]=Ke),y[qe]=!0;const ct=ze.numIconVertices>0,_t=this.placedOrientations[ze.crossTileID],It=_t===a.ah.vertical,zt=_t===a.ah.horizontal||_t===a.ah.horizontalOnly;if(Ee>0||Fe>0){const St=Bn(Ke.text);Ce(o.text,Ee,It?ba:St),Ce(o.text,Fe,zt?ba:St);const Wt=Ke.text.isHidden();[ze.rightJustifiedTextSymbolIndex,ze.centerJustifiedTextSymbolIndex,ze.leftJustifiedTextSymbolIndex].forEach(Dt=>{Dt>=0&&(o.text.placedSymbolArray.get(Dt).hidden=Wt||It?1:0)}),ze.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(ze.verticalPlacedTextSymbolIndex).hidden=Wt||zt?1:0);const hr=this.variableOffsets[ze.crossTileID];hr&&this.markUsedJustification(o,hr.anchor,ze,_t);const kt=this.placedOrientations[ze.crossTileID];kt&&(this.markUsedJustification(o,"left",ze,kt),this.markUsedOrientation(o,kt,ze))}if(ct){const St=Bn(Ke.icon),Wt=!(xe&&ze.verticalPlacedIconSymbolIndex&&It);ze.placedIconSymbolIndex>=0&&(Ce(o.icon,ze.numIconVertices,Wt?St:ba),o.icon.placedSymbolArray.get(ze.placedIconSymbolIndex).hidden=Ke.icon.isHidden()),ze.verticalPlacedIconSymbolIndex>=0&&(Ce(o.icon,ze.numVerticalIconVertices,Wt?ba:St),o.icon.placedSymbolArray.get(ze.verticalPlacedIconSymbolIndex).hidden=Ke.icon.isHidden())}const Et=Ie&&Ie.has(Ae)?Ie.get(Ae):{text:null,icon:null};if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const St=o.collisionArrays[Ae];if(St){let Wt=new a.P(0,0);if(St.textBox||St.verticalTextBox){let hr=!0;if(Y){const kt=this.variableOffsets[qe];kt?(Wt=wn(kt.anchor,kt.width,kt.height,kt.textOffset,kt.textBoxScale),J&&Wt._rotate(he?this.transform.angle:-this.transform.angle)):hr=!1}if(St.textBox||St.verticalTextBox){let kt;St.textBox&&(kt=It),St.verticalTextBox&&(kt=zt),$a(o.textCollisionBox.collisionVertexArray,Ke.text.placed,!hr||kt,Et.text,Wt.x,Wt.y)}}if(St.iconBox||St.verticalIconBox){const hr=!!(!zt&&St.verticalIconBox);let kt;St.iconBox&&(kt=hr),St.verticalIconBox&&(kt=!hr),$a(o.iconCollisionBox.collisionVertexArray,Ke.icon.placed,kt,Et.icon,xe?Wt.x:0,xe?Wt.y:0)}}}}if(o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.text.opacityVertexArray.length!==o.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${o.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${o.text.layoutVertexArray.length}) / 4`);if(o.icon.opacityVertexArray.length!==o.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${o.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${o.icon.layoutVertexArray.length}) / 4`);if(o.bucketInstanceId in this.collisionCircleArrays){const Ae=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=Ae.invProjMatrix,o.placementViewportMatrix=Ae.viewportMatrix,o.collisionCircleArray=Ae.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,f){const y=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*y>o}setStale(){this.stale=!0}}function $a(E,o,f,y,x,S){y&&y.length!==0||(y=[0,0,0,0]);const R=y[0]-ar,B=y[1]-ar,F=y[2]-ar,H=y[3]-ar;E.emplaceBack(o?1:0,f?1:0,x||0,S||0,R,B),E.emplaceBack(o?1:0,f?1:0,x||0,S||0,F,B),E.emplaceBack(o?1:0,f?1:0,x||0,S||0,F,H),E.emplaceBack(o?1:0,f?1:0,x||0,S||0,R,H)}const Mr=Math.pow(2,25),to=Math.pow(2,24),ro=Math.pow(2,17),Hn=Math.pow(2,16),bn=Math.pow(2,9),Ms=Math.pow(2,8),Nn=Math.pow(2,1);function Bn(E){if(E.opacity===0&&!E.placed)return 0;if(E.opacity===1&&E.placed)return 4294967295;const o=E.placed?1:0,f=Math.floor(127*E.opacity);return f*Mr+o*to+f*ro+o*Hn+f*bn+o*Ms+f*Nn+o}const ba=0;function qi(){return{isOccluded:(E,o,f)=>!1,getPitchedTextCorrection:(E,o,f)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(E,o,f,y){throw new Error("Not implemented.")},translatePosition:(E,o,f,y)=>function(x,S,R,B,F=!1){if(!R[0]&&!R[1])return[0,0];const H=F?B==="map"?x.angle:0:B==="viewport"?-x.angle:0;if(H){const Y=Math.sin(H),J=Math.cos(H);R=[R[0]*J-R[1]*Y,R[0]*Y+R[1]*J]}return[F?R[0]:fr(S,R[0],x.zoom),F?R[1]:fr(S,R[1],x.zoom)]}(E,o,f,y),getCircleRadiusCorrection:E=>1}}class Rr{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&!o.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,f,y,x,S){const R=this._bucketParts;for(;this._currentTileIndex<o.length;)if(f.getBucketParts(R,x,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,R.sort((B,F)=>B.sortKey-F.sortKey));this._currentPartIndex<R.length;)if(f.placeLayerBucketPart(R[this._currentPartIndex],this._seenCrossTileIDs,y),this._currentPartIndex++,S())return!0;return!1}}class us{constructor(o,f,y,x,S,R,B,F){this.placement=new Pn(o,qi(),f,R,B,F),this._currentPlacementIndex=y.length-1,this._forceFullPlacement=x,this._showCollisionBoxes=S,this._done=!1}isDone(){return this._done}continuePlacement(o,f,y){const x=v.now(),S=()=>!this._forceFullPlacement&&v.now()-x>2;for(;this._currentPlacementIndex>=0;){const R=f[o[this._currentPlacementIndex]],B=this.placement.collisionIndex.transform.zoom;if(R.type==="symbol"&&(!R.minzoom||R.minzoom<=B)&&(!R.maxzoom||R.maxzoom>B)){if(this._inProgressLayer||(this._inProgressLayer=new Rr(R)),this._inProgressLayer.continuePlacement(y[R.source],this.placement,this._showCollisionBoxes,R,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const Pi=512/a.X/2;class Wr{constructor(o,f,y){this.tileID=o,this.bucketInstanceId=y,this._symbolsByKey={};const x=new Map;for(let S=0;S<f.length;S++){const R=f.get(S),B=R.key,F=x.get(B);F?F.push(R):x.set(B,[R])}for(const[S,R]of x){const B={positions:R.map(F=>({x:Math.floor(F.anchorX*Pi),y:Math.floor(F.anchorY*Pi)})),crossTileIDs:R.map(F=>F.crossTileID)};if(B.positions.length>128){const F=new a.av(B.positions.length,16,Uint16Array);for(const{x:H,y:Y}of B.positions)F.add(H,Y);F.finish(),delete B.positions,B.index=F}this._symbolsByKey[S]=B}}getScaledCoordinates(o,f){const{x:y,y:x,z:S}=this.tileID.canonical,{x:R,y:B,z:F}=f.canonical,H=Pi/Math.pow(2,F-S),Y=(B*a.X+o.anchorY)*H,J=x*a.X*Pi;return{x:Math.floor((R*a.X+o.anchorX)*H-y*a.X*Pi),y:Math.floor(Y-J)}}findMatches(o,f,y){const x=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z);for(let S=0;S<o.length;S++){const R=o.get(S);if(R.crossTileID)continue;const B=this._symbolsByKey[R.key];if(!B)continue;const F=this.getScaledCoordinates(R,f);if(B.index){const H=B.index.range(F.x-x,F.y-x,F.x+x,F.y+x).sort();for(const Y of H){const J=B.crossTileIDs[Y];if(!y[J]){y[J]=!0,R.crossTileID=J;break}}}else if(B.positions)for(let H=0;H<B.positions.length;H++){const Y=B.positions[H],J=B.crossTileIDs[H];if(Math.abs(Y.x-F.x)<=x&&Math.abs(Y.y-F.y)<=x&&!y[J]){y[J]=!0,R.crossTileID=J;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:o})=>o)}}class ti{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Hi{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const f=Math.round((o-this.lng)/360);if(f!==0)for(const y in this.indexes){const x=this.indexes[y],S={};for(const R in x){const B=x[R];B.tileID=B.tileID.unwrapTo(B.tileID.wrap+f),S[B.tileID.key]=B}this.indexes[y]=S}this.lng=o}addBucket(o,f,y){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let S=0;S<f.symbolInstances.length;S++)f.symbolInstances.get(S).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const x=this.usedCrossTileIDs[o.overscaledZ];for(const S in this.indexes){const R=this.indexes[S];if(Number(S)>o.overscaledZ)for(const B in R){const F=R[B];F.tileID.isChildOf(o)&&F.findMatches(f.symbolInstances,o,x)}else{const B=R[o.scaledTo(Number(S)).key];B&&B.findMatches(f.symbolInstances,o,x)}}for(let S=0;S<f.symbolInstances.length;S++){const R=f.symbolInstances.get(S);R.crossTileID||(R.crossTileID=y.generate(),x[R.crossTileID]=!0)}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Wr(o,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(o,f){for(const y of f.getCrossTileIDsLists())for(const x of y)delete this.usedCrossTileIDs[o][x]}removeStaleBuckets(o){let f=!1;for(const y in this.indexes){const x=this.indexes[y];for(const S in x)o[x[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(y,x[S]),delete x[S],f=!0)}return f}}class Mc{constructor(){this.layerIndexes={},this.crossTileIDs=new ti,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,f,y){let x=this.layerIndexes[o.id];x===void 0&&(x=this.layerIndexes[o.id]=new Hi);let S=!1;const R={};x.handleWrapJump(y);for(const B of f){const F=B.getBucket(o);F&&o.id===F.layerIds[0]&&(F.bucketInstanceId||(F.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(B.tileID,F,this.crossTileIDs)&&(S=!0),R[F.bucketInstanceId]=!0)}return x.removeStaleBuckets(R)&&(S=!0),S}pruneUnusedLayers(o){const f={};o.forEach(y=>{f[y]=!0});for(const y in this.layerIndexes)f[y]||delete this.layerIndexes[y]}}const Gi=(E,o)=>a.t(E,o&&o.filter(f=>f.identifier!=="source.canvas")),hx=a.aw();class Dc extends a.E{constructor(o,f={}){super(),this._rtlPluginLoaded=()=>{for(const y in this.sourceCaches){const x=this.sourceCaches[y].getSource().type;x!=="vector"&&x!=="geojson"||this.sourceCaches[y].reload()}},this.map=o,this.dispatcher=new Oe(rt(),o._getMapId()),this.dispatcher.registerMessageHandler("GG",(y,x)=>this.getGlyphs(y,x)),this.dispatcher.registerMessageHandler("GI",(y,x)=>this.getImages(y,x)),this.imageManager=new te,this.imageManager.setEventedParent(this),this.glyphManager=new de(o._requestManager,f.localIdeographFontFamily),this.lineAtlas=new De(256,512),this.crossTileSymbolIndex=new Mc,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",a.ay()),wt().on(lt,this._rtlPluginLoaded),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const x=this.sourceCaches[y.sourceId];if(!x)return;const S=x.getSource();if(S&&S.vectorLayerIds)for(const R in this._layers){const B=this._layers[R];B.source===S.id&&this._validateLayer(B)}})}loadURL(o,f={},y){this.fire(new a.k("dataloading",{dataType:"style"})),f.validate=typeof f.validate!="boolean"||f.validate;const x=this.map._requestManager.transformRequest(o,"Style");this._loadStyleRequest=new AbortController;const S=this._loadStyleRequest;a.h(x,this._loadStyleRequest).then(R=>{this._loadStyleRequest=null,this._load(R.data,f,y)}).catch(R=>{this._loadStyleRequest=null,R&&!S.signal.aborted&&this.fire(new a.j(R))})}loadJSON(o,f={},y){this.fire(new a.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,v.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,f.validate=f.validate!==!1,this._load(o,f,y)}).catch(()=>{})}loadEmpty(){this.fire(new a.k("dataloading",{dataType:"style"})),this._load(hx,{validate:!1})}_load(o,f,y){var x;const S=f.transformStyle?f.transformStyle(y,o):o;if(!f.validate||!Gi(this,a.u(S))){this._loaded=!0,this.stylesheet=S;for(const R in S.sources)this.addSource(R,S.sources[R],{validate:!1});S.sprite?this._loadSprite(S.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(S.glyphs),this._createLayers(),this.light=new ve(this.stylesheet.light),this.sky=new _e(this.stylesheet.sky),this.map.setTerrain((x=this.stylesheet.terrain)!==null&&x!==void 0?x:null),this.fire(new a.k("data",{dataType:"style"})),this.fire(new a.k("style.load"))}}_createLayers(){const o=a.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",o),this._order=o.map(f=>f.id),this._layers={},this._serializedLayers=null;for(const f of o){const y=a.aA(f);y.setEventedParent(this,{layer:{id:f.id}}),this._layers[f.id]=y}}_loadSprite(o,f=!1,y=void 0){let x;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(S,R,B,F){return a._(this,void 0,void 0,function*(){const H=Z(S),Y=B>1?"@2x":"",J={},he={};for(const{id:xe,url:be}of H){const Ce=R.transformRequest(Q(be,Y,".json"),"SpriteJSON");J[xe]=a.h(Ce,F);const Ie=R.transformRequest(Q(be,Y,".png"),"SpriteImage");he[xe]=z.getImage(Ie,F)}return yield Promise.all([...Object.values(J),...Object.values(he)]),function(xe,be){return a._(this,void 0,void 0,function*(){const Ce={};for(const Ie in xe){Ce[Ie]={};const Ae=v.getImageCanvasContext((yield be[Ie]).data),ze=(yield xe[Ie]).data;for(const Ee in ze){const{width:Fe,height:qe,x:Ke,y:ct,sdf:_t,pixelRatio:It,stretchX:zt,stretchY:Et,content:St,textFitWidth:Wt,textFitHeight:hr}=ze[Ee];Ce[Ie][Ee]={data:null,pixelRatio:It,sdf:_t,stretchX:zt,stretchY:Et,content:St,textFitWidth:Wt,textFitHeight:hr,spriteData:{width:Fe,height:qe,x:Ke,y:ct,context:Ae}}}}return Ce})}(J,he)})}(o,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(S=>{if(this._spriteRequest=null,S)for(const R in S){this._spritesImagesIds[R]=[];const B=this._spritesImagesIds[R]?this._spritesImagesIds[R].filter(F=>!(F in S)):[];for(const F of B)this.imageManager.removeImage(F),this._changedImages[F]=!0;for(const F in S[R]){const H=R==="default"?F:`${R}:${F}`;this._spritesImagesIds[R].push(H),H in this.imageManager.images?this.imageManager.updateImage(H,S[R][F],!1):this.imageManager.addImage(H,S[R][F]),f&&(this._changedImages[H]=!0)}}}).catch(S=>{this._spriteRequest=null,x=S,this.fire(new a.j(x))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),f&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"})),y&&y(x)})}_unloadSprite(){for(const o of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(o),this._changedImages[o]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}_validateLayer(o){const f=this.sourceCaches[o.source];if(!f)return;const y=o.sourceLayer;if(!y)return;const x=f.getSource();(x.type==="geojson"||x.vectorLayerIds&&x.vectorLayerIds.indexOf(y)===-1)&&this.fire(new a.j(new Error(`Source layer "${y}" does not exist on source "${x.id}" as specified by style layer "${o.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(o,f=!1){const y=this._serializedAllLayers();if(!o||o.length===0)return Object.values(f?a.aB(y):y);const x=[];for(const S of o)if(y[S]){const R=f?a.aB(y[S]):y[S];x.push(R)}return x}_serializedAllLayers(){let o=this._serializedLayers;if(o)return o;o=this._serializedLayers={};const f=Object.keys(this._layers);for(const y of f){const x=this._layers[y];x.type!=="custom"&&(o[y]=x.serialize())}return o}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const o in this.sourceCaches)if(this.sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(o){if(!this._loaded)return;const f=this._changed;if(f){const x=Object.keys(this._updatedLayers),S=Object.keys(this._removedLayers);(x.length||S.length)&&this._updateWorkerLayers(x,S);for(const R in this._updatedSources){const B=this._updatedSources[R];if(B==="reload")this._reloadSource(R);else{if(B!=="clear")throw new Error(`Invalid action ${B}`);this._clearSource(R)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const R in this._updatedPaintProps)this._layers[R].updateTransitions(o);this.light.updateTransitions(o),this.sky.updateTransitions(o),this._resetUpdates()}const y={};for(const x in this.sourceCaches){const S=this.sourceCaches[x];y[x]=S.used,S.used=!1}for(const x of this._order){const S=this._layers[x];S.recalculate(o,this._availableImages),!S.isHidden(o.zoom)&&S.source&&(this.sourceCaches[S.source].used=!0)}for(const x in y){const S=this.sourceCaches[x];!!y[x]!=!!S.used&&S.fire(new a.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:x}))}this.light.recalculate(o),this.sky.recalculate(o),this.z=o.zoom,f&&this.fire(new a.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const f in this.sourceCaches)this.sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(o,f){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(o,!1),removedIds:f})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(o,f={}){var y;this._checkLoaded();const x=this.serialize();if(o=f.transformStyle?f.transformStyle(x,o):o,((y=f.validate)===null||y===void 0||y)&&Gi(this,a.u(o)))return!1;(o=a.aB(o)).layers=a.az(o.layers);const S=a.aC(x,o),R=this._getOperationsToPerform(S);if(R.unimplemented.length>0)throw new Error(`Unimplemented: ${R.unimplemented.join(", ")}.`);if(R.operations.length===0)return!1;for(const B of R.operations)B();return this.stylesheet=o,this._serializedLayers=null,!0}_getOperationsToPerform(o){const f=[],y=[];for(const x of o)switch(x.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":f.push(()=>this.addLayer.apply(this,x.args));break;case"removeLayer":f.push(()=>this.removeLayer.apply(this,x.args));break;case"setPaintProperty":f.push(()=>this.setPaintProperty.apply(this,x.args));break;case"setLayoutProperty":f.push(()=>this.setLayoutProperty.apply(this,x.args));break;case"setFilter":f.push(()=>this.setFilter.apply(this,x.args));break;case"addSource":f.push(()=>this.addSource.apply(this,x.args));break;case"removeSource":f.push(()=>this.removeSource.apply(this,x.args));break;case"setLayerZoomRange":f.push(()=>this.setLayerZoomRange.apply(this,x.args));break;case"setLight":f.push(()=>this.setLight.apply(this,x.args));break;case"setGeoJSONSourceData":f.push(()=>this.setGeoJSONSourceData.apply(this,x.args));break;case"setGlyphs":f.push(()=>this.setGlyphs.apply(this,x.args));break;case"setSprite":f.push(()=>this.setSprite.apply(this,x.args));break;case"setSky":f.push(()=>this.setSky.apply(this,x.args));break;case"setTerrain":f.push(()=>this.map.setTerrain.apply(this,x.args));break;case"setTransition":f.push(()=>{});break;default:y.push(x.command)}return{operations:f,unimplemented:y}}addImage(o,f){if(this.getImage(o))return this.fire(new a.j(new Error(`An image named "${o}" already exists.`)));this.imageManager.addImage(o,f),this._afterImageUpdated(o)}updateImage(o,f){this.imageManager.updateImage(o,f)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new a.j(new Error(`An image named "${o}" does not exist.`)));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(o,f,y={}){if(this._checkLoaded(),this.sourceCaches[o]!==void 0)throw new Error(`Source "${o}" already exists.`);if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(a.u.source,`sources.${o}`,f,null,y))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const x=this.sourceCaches[o]=new Ue(o,f,this.dispatcher);x.style=this,x.setEventedParent(this,()=>({isSourceLoaded:x.loaded(),source:x.serialize(),sourceId:o})),x.onAdd(this.map),this._changed=!0}removeSource(o){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===o)return this.fire(new a.j(new Error(`Source "${o}" cannot be removed while layer "${y}" is using it.`)));const f=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],f.fire(new a.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),f.setEventedParent(null),f.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,f){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error(`There is no source with this ID=${o}`);const y=this.sourceCaches[o].getSource();if(y.type!=="geojson")throw new Error(`geojsonSource.type is ${y.type}, which is !== 'geojson`);y.setData(f),this._changed=!0}getSource(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()}addLayer(o,f,y={}){this._checkLoaded();const x=o.id;if(this.getLayer(x))return void this.fire(new a.j(new Error(`Layer "${x}" already exists on this map.`)));let S;if(o.type==="custom"){if(Gi(this,a.aD(o)))return;S=a.aA(o)}else{if("source"in o&&typeof o.source=="object"&&(this.addSource(x,o.source),o=a.aB(o),o=a.e(o,{source:x})),this._validate(a.u.layer,`layers.${x}`,o,{arrayIndex:-1},y))return;S=a.aA(o),this._validateLayer(S),S.setEventedParent(this,{layer:{id:x}})}const R=f?this._order.indexOf(f):this._order.length;if(f&&R===-1)this.fire(new a.j(new Error(`Cannot add layer "${x}" before non-existing layer "${f}".`)));else{if(this._order.splice(R,0,x),this._layerOrderChanged=!0,this._layers[x]=S,this._removedLayers[x]&&S.source&&S.type!=="custom"){const B=this._removedLayers[x];delete this._removedLayers[x],B.type!==S.type?this._updatedSources[S.source]="clear":(this._updatedSources[S.source]="reload",this.sourceCaches[S.source].pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map)}}moveLayer(o,f){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new a.j(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===f)return;const y=this._order.indexOf(o);this._order.splice(y,1);const x=f?this._order.indexOf(f):this._order.length;f&&x===-1?this.fire(new a.j(new Error(`Cannot move layer "${o}" before non-existing layer "${f}".`))):(this._order.splice(x,0,o),this._layerOrderChanged=!0)}removeLayer(o){this._checkLoaded();const f=this._layers[o];if(!f)return void this.fire(new a.j(new Error(`Cannot remove non-existing layer "${o}".`)));f.setEventedParent(null);const y=this._order.indexOf(o);this._order.splice(y,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=f,delete this._layers[o],this._serializedLayers&&delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],f.onRemove&&f.onRemove(this.map)}getLayer(o){return this._layers[o]}getLayersOrder(){return[...this._order]}hasLayer(o){return o in this._layers}setLayerZoomRange(o,f,y){this._checkLoaded();const x=this.getLayer(o);x?x.minzoom===f&&x.maxzoom===y||(f!=null&&(x.minzoom=f),y!=null&&(x.maxzoom=y),this._updateLayer(x)):this.fire(new a.j(new Error(`Cannot set the zoom range of non-existing layer "${o}".`)))}setFilter(o,f,y={}){this._checkLoaded();const x=this.getLayer(o);if(x){if(!a.aE(x.filter,f))return f==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(a.u.filter,`layers.${x.id}.filter`,f,null,y)||(x.filter=a.aB(f),this._updateLayer(x)))}else this.fire(new a.j(new Error(`Cannot filter non-existing layer "${o}".`)))}getFilter(o){return a.aB(this.getLayer(o).filter)}setLayoutProperty(o,f,y,x={}){this._checkLoaded();const S=this.getLayer(o);S?a.aE(S.getLayoutProperty(f),y)||(S.setLayoutProperty(f,y,x),this._updateLayer(S)):this.fire(new a.j(new Error(`Cannot style non-existing layer "${o}".`)))}getLayoutProperty(o,f){const y=this.getLayer(o);if(y)return y.getLayoutProperty(f);this.fire(new a.j(new Error(`Cannot get style of non-existing layer "${o}".`)))}setPaintProperty(o,f,y,x={}){this._checkLoaded();const S=this.getLayer(o);S?a.aE(S.getPaintProperty(f),y)||(S.setPaintProperty(f,y,x)&&this._updateLayer(S),this._changed=!0,this._updatedPaintProps[o]=!0,this._serializedLayers=null):this.fire(new a.j(new Error(`Cannot style non-existing layer "${o}".`)))}getPaintProperty(o,f){return this.getLayer(o).getPaintProperty(f)}setFeatureState(o,f){this._checkLoaded();const y=o.source,x=o.sourceLayer,S=this.sourceCaches[y];if(S===void 0)return void this.fire(new a.j(new Error(`The source '${y}' does not exist in the map's style.`)));const R=S.getSource().type;R==="geojson"&&x?this.fire(new a.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):R!=="vector"||x?(o.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),S.setFeatureState(x,o.id,f)):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(o,f){this._checkLoaded();const y=o.source,x=this.sourceCaches[y];if(x===void 0)return void this.fire(new a.j(new Error(`The source '${y}' does not exist in the map's style.`)));const S=x.getSource().type,R=S==="vector"?o.sourceLayer:void 0;S!=="vector"||R?f&&typeof o.id!="string"&&typeof o.id!="number"?this.fire(new a.j(new Error("A feature id is required to remove its specific state property."))):x.removeFeatureState(R,o.id,f):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(o){this._checkLoaded();const f=o.source,y=o.sourceLayer,x=this.sourceCaches[f];if(x!==void 0)return x.getSource().type!=="vector"||y?(o.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),x.getFeatureState(y,o.id)):void this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.j(new Error(`The source '${f}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const o=a.aF(this.sourceCaches,S=>S.serialize()),f=this._serializeByIds(this._order,!0),y=this.map.getTerrain()||void 0,x=this.stylesheet;return a.aG({version:x.version,name:x.name,metadata:x.metadata,light:x.light,sky:x.sky,center:x.center,zoom:x.zoom,bearing:x.bearing,pitch:x.pitch,sprite:x.sprite,glyphs:x.glyphs,transition:x.transition,sources:o,layers:f,terrain:y},S=>S!==void 0)}_updateLayer(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&this.sourceCaches[o.source].getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(o){const f=R=>this._layers[R].type==="fill-extrusion",y={},x=[];for(let R=this._order.length-1;R>=0;R--){const B=this._order[R];if(f(B)){y[B]=R;for(const F of o){const H=F[B];if(H)for(const Y of H)x.push(Y)}}}x.sort((R,B)=>B.intersectionZ-R.intersectionZ);const S=[];for(let R=this._order.length-1;R>=0;R--){const B=this._order[R];if(f(B))for(let F=x.length-1;F>=0;F--){const H=x[F].feature;if(y[H.layer.id]<R)break;S.push(H),x.pop()}else for(const F of o){const H=F[B];if(H)for(const Y of H)S.push(Y.feature)}}return S}queryRenderedFeatures(o,f,y){f&&f.filter&&this._validate(a.u.filter,"queryRenderedFeatures.filter",f.filter,null,f);const x={};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new a.j(new Error("parameters.layers must be an Array."))),[];for(const B of f.layers){const F=this._layers[B];if(!F)return this.fire(new a.j(new Error(`The layer '${B}' does not exist in the map's style and cannot be queried for features.`))),[];x[F.source]=!0}}const S=[];f.availableImages=this._availableImages;const R=this._serializedAllLayers();for(const B in this.sourceCaches)f.layers&&!x[B]||S.push(it(this.sourceCaches[B],this._layers,R,o,f,y));return this.placement&&S.push(function(B,F,H,Y,J,he,xe){const be={},Ce=he.queryRenderedSymbols(Y),Ie=[];for(const Ae of Object.keys(Ce).map(Number))Ie.push(xe[Ae]);Ie.sort(mt);for(const Ae of Ie){const ze=Ae.featureIndex.lookupSymbolFeatures(Ce[Ae.bucketInstanceId],F,Ae.bucketIndex,Ae.sourceLayerIndex,J.filter,J.layers,J.availableImages,B);for(const Ee in ze){const Fe=be[Ee]=be[Ee]||[],qe=ze[Ee];qe.sort((Ke,ct)=>{const _t=Ae.featureSortOrder;if(_t){const It=_t.indexOf(Ke.featureIndex);return _t.indexOf(ct.featureIndex)-It}return ct.featureIndex-Ke.featureIndex});for(const Ke of qe)Fe.push(Ke)}}for(const Ae in be)be[Ae].forEach(ze=>{const Ee=ze.feature,Fe=H[B[Ae].source].getFeatureState(Ee.layer["source-layer"],Ee.id);Ee.source=Ee.layer.source,Ee.layer["source-layer"]&&(Ee.sourceLayer=Ee.layer["source-layer"]),Ee.state=Fe});return be}(this._layers,R,this.sourceCaches,o,f,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(S)}querySourceFeatures(o,f){f&&f.filter&&this._validate(a.u.filter,"querySourceFeatures.filter",f.filter,null,f);const y=this.sourceCaches[o];return y?function(x,S){const R=x.getRenderableIds().map(H=>x.getTileByID(H)),B=[],F={};for(let H=0;H<R.length;H++){const Y=R[H],J=Y.tileID.canonical.key;F[J]||(F[J]=!0,Y.querySourceFeatures(B,S))}return B}(y,f):[]}getLight(){return this.light.getLight()}setLight(o,f={}){this._checkLoaded();const y=this.light.getLight();let x=!1;for(const R in o)if(!a.aE(o[R],y[R])){x=!0;break}if(!x)return;const S={now:v.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,f),this.light.updateTransitions(S)}getSky(){var o;return(o=this.stylesheet)===null||o===void 0?void 0:o.sky}setSky(o,f={}){const y=this.getSky();let x=!1;if(!o&&!y)return;if(o&&!y)x=!0;else if(!o&&y)x=!0;else for(const R in o)if(!a.aE(o[R],y[R])){x=!0;break}if(!x)return;const S={now:v.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=o,this.sky.setSky(o,f),this.sky.updateTransitions(S)}_validate(o,f,y,x,S={}){return(!S||S.validate!==!1)&&Gi(this,o.call(a.u,a.e({key:f,style:this.serialize(),value:y,styleSpec:a.v},x)))}_remove(o=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),wt().off(lt,this._rtlPluginLoaded);for(const f in this._layers)this._layers[f].setEventedParent(null);for(const f in this.sourceCaches){const y=this.sourceCaches[f];y.setEventedParent(null),y.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),o&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(o)}_clearSource(o){this.sourceCaches[o].clearTiles()}_reloadSource(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()}_updateSources(o){for(const f in this.sourceCaches)this.sourceCaches[f].update(o,this.map.terrain)}_generateCollisionBoxes(){for(const o in this.sourceCaches)this._reloadSource(o)}_updatePlacement(o,f,y,x,S=!1){let R=!1,B=!1;const F={};for(const H of this._order){const Y=this._layers[H];if(Y.type!=="symbol")continue;if(!F[Y.source]){const he=this.sourceCaches[Y.source];F[Y.source]=he.getRenderableIds(!0).map(xe=>he.getTileByID(xe)).sort((xe,be)=>be.tileID.overscaledZ-xe.tileID.overscaledZ||(xe.tileID.isLessThan(be.tileID)?-1:1))}const J=this.crossTileSymbolIndex.addLayer(Y,F[Y.source],o.center.lng);R=R||J}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((S=S||this._layerOrderChanged||y===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(v.now(),o.zoom))&&(this.pauseablePlacement=new us(o,this.map.terrain,this._order,S,f,y,x,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,F),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(v.now()),B=!0),R&&this.pauseablePlacement.placement.setStale()),B||R)for(const H of this._order){const Y=this._layers[H];Y.type==="symbol"&&this.placement.updateLayerOpacities(Y,F[Y.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(v.now())}_releaseSymbolFadeTiles(){for(const o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,f){return a._(this,void 0,void 0,function*(){const y=yield this.imageManager.getImages(f.icons);this._updateTilesForChangedImages();const x=this.sourceCaches[f.source];return x&&x.setDependencies(f.tileID.key,f.type,f.icons),y})}getGlyphs(o,f){return a._(this,void 0,void 0,function*(){const y=yield this.glyphManager.getGlyphs(f.stacks),x=this.sourceCaches[f.source];return x&&x.setDependencies(f.tileID.key,f.type,[""]),y})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(o,f={}){this._checkLoaded(),o&&this._validate(a.u.glyphs,"glyphs",o,null,f)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=o,this.glyphManager.entries={},this.glyphManager.setURL(o))}addSprite(o,f,y={},x){this._checkLoaded();const S=[{id:o,url:f}],R=[...Z(this.stylesheet.sprite),...S];this._validate(a.u.sprite,"sprite",R,null,y)||(this.stylesheet.sprite=R,this._loadSprite(S,!0,x))}removeSprite(o){this._checkLoaded();const f=Z(this.stylesheet.sprite);if(f.find(y=>y.id===o)){if(this._spritesImagesIds[o])for(const y of this._spritesImagesIds[o])this.imageManager.removeImage(y),this._changedImages[y]=!0;f.splice(f.findIndex(y=>y.id===o),1),this.stylesheet.sprite=f.length>0?f:void 0,delete this._spritesImagesIds[o],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}else this.fire(new a.j(new Error(`Sprite "${o}" doesn't exists on this map.`)))}getSprite(){return Z(this.stylesheet.sprite)}setSprite(o,f={},y){this._checkLoaded(),o&&this._validate(a.u.sprite,"sprite",o,null,f)||(this.stylesheet.sprite=o,o?this._loadSprite(o,!0,y):(this._unloadSprite(),y&&y(null)))}}var no=a.Y([{name:"a_pos",type:"Int16",components:2}]);const Ds={prelude:zr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:zr(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:zr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:zr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:zr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:zr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:zr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:zr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:zr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:zr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:zr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:zr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:zr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:zr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:zr(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:zr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:zr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:zr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:zr(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:zr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:zr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:zr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:zr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:zr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:zr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:zr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:zr("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:zr("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:zr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:zr("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function zr(E,o){const f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,y=o.match(/attribute ([\w]+) ([\w]+)/g),x=E.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=o.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),R=S?S.concat(x):x,B={};return{fragmentSource:E=E.replace(f,(F,H,Y,J,he)=>(B[he]=!0,H==="define"?`
#ifndef HAS_UNIFORM_u_${he}
varying ${Y} ${J} ${he};
#else
uniform ${Y} ${J} u_${he};
#endif
`:`
#ifdef HAS_UNIFORM_u_${he}
    ${Y} ${J} ${he} = u_${he};
#endif
`)),vertexSource:o=o.replace(f,(F,H,Y,J,he)=>{const xe=J==="float"?"vec2":"vec4",be=he.match(/color/)?"color":xe;return B[he]?H==="define"?`
#ifndef HAS_UNIFORM_u_${he}
uniform lowp float u_${he}_t;
attribute ${Y} ${xe} a_${he};
varying ${Y} ${J} ${he};
#else
uniform ${Y} ${J} u_${he};
#endif
`:be==="vec4"?`
#ifndef HAS_UNIFORM_u_${he}
    ${he} = a_${he};
#else
    ${Y} ${J} ${he} = u_${he};
#endif
`:`
#ifndef HAS_UNIFORM_u_${he}
    ${he} = unpack_mix_${be}(a_${he}, u_${he}_t);
#else
    ${Y} ${J} ${he} = u_${he};
#endif
`:H==="define"?`
#ifndef HAS_UNIFORM_u_${he}
uniform lowp float u_${he}_t;
attribute ${Y} ${xe} a_${he};
#else
uniform ${Y} ${J} u_${he};
#endif
`:be==="vec4"?`
#ifndef HAS_UNIFORM_u_${he}
    ${Y} ${J} ${he} = a_${he};
#else
    ${Y} ${J} ${he} = u_${he};
#endif
`:`
#ifndef HAS_UNIFORM_u_${he}
    ${Y} ${J} ${he} = unpack_mix_${be}(a_${he}, u_${he}_t);
#else
    ${Y} ${J} ${he} = u_${he};
#endif
`}),staticAttributes:y,staticUniforms:R}}class Vd{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,f,y,x,S,R,B,F,H){this.context=o;let Y=this.boundPaintVertexBuffers.length!==x.length;for(let J=0;!Y&&J<x.length;J++)this.boundPaintVertexBuffers[J]!==x[J]&&(Y=!0);!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==y||Y||this.boundIndexBuffer!==S||this.boundVertexOffset!==R||this.boundDynamicVertexBuffer!==B||this.boundDynamicVertexBuffer2!==F||this.boundDynamicVertexBuffer3!==H?this.freshBind(f,y,x,S,R,B,F,H):(o.bindVertexArray.set(this.vao),B&&B.bind(),S&&S.dynamicDraw&&S.bind(),F&&F.bind(),H&&H.bind())}freshBind(o,f,y,x,S,R,B,F){const H=o.numAttributes,Y=this.context,J=Y.gl;this.vao&&this.destroy(),this.vao=Y.createVertexArray(),Y.bindVertexArray.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=y,this.boundIndexBuffer=x,this.boundVertexOffset=S,this.boundDynamicVertexBuffer=R,this.boundDynamicVertexBuffer2=B,this.boundDynamicVertexBuffer3=F,f.enableAttributes(J,o);for(const he of y)he.enableAttributes(J,o);R&&R.enableAttributes(J,o),B&&B.enableAttributes(J,o),F&&F.enableAttributes(J,o),f.bind(),f.setVertexAttribPointers(J,o,S);for(const he of y)he.bind(),he.setVertexAttribPointers(J,o,S);R&&(R.bind(),R.setVertexAttribPointers(J,o,S)),x&&x.bind(),B&&(B.bind(),B.setVertexAttribPointers(J,o,S)),F&&(F.bind(),F.setVertexAttribPointers(J,o,S)),Y.currentNumAttributes=H}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Ud=(E,o,f,y,x)=>({u_matrix:E,u_texture:0,u_ele_delta:o,u_fog_matrix:f,u_fog_color:y?y.properties.get("fog-color"):a.aM.white,u_fog_ground_blend:y?y.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:y?y.calculateFogBlendOpacity(x):0,u_horizon_color:y?y.properties.get("horizon-color"):a.aM.white,u_horizon_fog_blend:y?y.properties.get("horizon-fog-blend"):1});function Ho(E){const o=[];for(let f=0;f<E.length;f++){if(E[f]===null)continue;const y=E[f].split(" ");o.push(y.pop())}return o}class qd{constructor(o,f,y,x,S,R){const B=o.gl;this.program=B.createProgram();const F=Ho(f.staticAttributes),H=y?y.getBinderAttributes():[],Y=F.concat(H),J=Ds.prelude.staticUniforms?Ho(Ds.prelude.staticUniforms):[],he=f.staticUniforms?Ho(f.staticUniforms):[],xe=y?y.getBinderUniforms():[],be=J.concat(he).concat(xe),Ce=[];for(const Ke of be)Ce.indexOf(Ke)<0&&Ce.push(Ke);const Ie=y?y.defines():[];S&&Ie.push("#define OVERDRAW_INSPECTOR;"),R&&Ie.push("#define TERRAIN3D;");const Ae=Ie.concat(Ds.prelude.fragmentSource,f.fragmentSource).join(`
`),ze=Ie.concat(Ds.prelude.vertexSource,f.vertexSource).join(`
`),Ee=B.createShader(B.FRAGMENT_SHADER);if(B.isContextLost())return void(this.failedToCreate=!0);if(B.shaderSource(Ee,Ae),B.compileShader(Ee),!B.getShaderParameter(Ee,B.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${B.getShaderInfoLog(Ee)}`);B.attachShader(this.program,Ee);const Fe=B.createShader(B.VERTEX_SHADER);if(B.isContextLost())return void(this.failedToCreate=!0);if(B.shaderSource(Fe,ze),B.compileShader(Fe),!B.getShaderParameter(Fe,B.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${B.getShaderInfoLog(Fe)}`);B.attachShader(this.program,Fe),this.attributes={};const qe={};this.numAttributes=Y.length;for(let Ke=0;Ke<this.numAttributes;Ke++)Y[Ke]&&(B.bindAttribLocation(this.program,Ke,Y[Ke]),this.attributes[Y[Ke]]=Ke);if(B.linkProgram(this.program),!B.getProgramParameter(this.program,B.LINK_STATUS))throw new Error(`Program failed to link: ${B.getProgramInfoLog(this.program)}`);B.deleteShader(Fe),B.deleteShader(Ee);for(let Ke=0;Ke<Ce.length;Ke++){const ct=Ce[Ke];if(ct&&!qe[ct]){const _t=B.getUniformLocation(this.program,ct);_t&&(qe[ct]=_t)}}this.fixedUniforms=x(o,qe),this.terrainUniforms=((Ke,ct)=>({u_depth:new a.aH(Ke,ct.u_depth),u_terrain:new a.aH(Ke,ct.u_terrain),u_terrain_dim:new a.aI(Ke,ct.u_terrain_dim),u_terrain_matrix:new a.aJ(Ke,ct.u_terrain_matrix),u_terrain_unpack:new a.aK(Ke,ct.u_terrain_unpack),u_terrain_exaggeration:new a.aI(Ke,ct.u_terrain_exaggeration)}))(o,qe),this.binderUniforms=y?y.getUniforms(o,qe):[]}draw(o,f,y,x,S,R,B,F,H,Y,J,he,xe,be,Ce,Ie,Ae,ze){const Ee=o.gl;if(this.failedToCreate)return;if(o.program.set(this.program),o.setDepthMode(y),o.setStencilMode(x),o.setColorMode(S),o.setCullFace(R),F){o.activeTexture.set(Ee.TEXTURE2),Ee.bindTexture(Ee.TEXTURE_2D,F.depthTexture),o.activeTexture.set(Ee.TEXTURE3),Ee.bindTexture(Ee.TEXTURE_2D,F.texture);for(const qe in this.terrainUniforms)this.terrainUniforms[qe].set(F[qe])}for(const qe in this.fixedUniforms)this.fixedUniforms[qe].set(B[qe]);Ce&&Ce.setUniforms(o,this.binderUniforms,xe,{zoom:be});let Fe=0;switch(f){case Ee.LINES:Fe=2;break;case Ee.TRIANGLES:Fe=3;break;case Ee.LINE_STRIP:Fe=1}for(const qe of he.get()){const Ke=qe.vaos||(qe.vaos={});(Ke[H]||(Ke[H]=new Vd)).bind(o,this,Y,Ce?Ce.getPaintVertexBuffers():[],J,qe.vertexOffset,Ie,Ae,ze),Ee.drawElements(f,qe.primitiveLength*Fe,Ee.UNSIGNED_SHORT,qe.primitiveOffset*Fe*2)}}}function Nc(E,o,f){const y=1/fr(f,1,o.transform.tileZoom),x=Math.pow(2,f.tileID.overscaledZ),S=f.tileSize*Math.pow(2,o.transform.tileZoom)/x,R=S*(f.tileID.canonical.x+f.tileID.wrap*x),B=S*f.tileID.canonical.y;return{u_image:0,u_texsize:f.imageAtlasTexture.size,u_scale:[y,E.fromScale,E.toScale],u_fade:E.t,u_pixel_coord_upper:[R>>16,B>>16],u_pixel_coord_lower:[65535&R,65535&B]}}const gu=(E,o,f,y)=>{const x=o.style.light,S=x.properties.get("position"),R=[S.x,S.y,S.z],B=function(){var H=new a.A(9);return a.A!=Float32Array&&(H[1]=0,H[2]=0,H[3]=0,H[5]=0,H[6]=0,H[7]=0),H[0]=1,H[4]=1,H[8]=1,H}();x.properties.get("anchor")==="viewport"&&function(H,Y){var J=Math.sin(Y),he=Math.cos(Y);H[0]=he,H[1]=J,H[2]=0,H[3]=-J,H[4]=he,H[5]=0,H[6]=0,H[7]=0,H[8]=1}(B,-o.transform.angle),function(H,Y,J){var he=Y[0],xe=Y[1],be=Y[2];H[0]=he*J[0]+xe*J[3]+be*J[6],H[1]=he*J[1]+xe*J[4]+be*J[7],H[2]=he*J[2]+xe*J[5]+be*J[8]}(R,R,B);const F=x.properties.get("color");return{u_matrix:E,u_lightpos:R,u_lightintensity:x.properties.get("intensity"),u_lightcolor:[F.r,F.g,F.b],u_vertical_gradient:+f,u_opacity:y}},zc=(E,o,f,y,x,S,R)=>a.e(gu(E,o,f,y),Nc(S,o,R),{u_height_factor:-Math.pow(2,x.overscaledZ)/R.tileSize/8}),Go=E=>({u_matrix:E}),Jm=(E,o,f,y)=>a.e(Go(E),Nc(f,o,y)),dx=(E,o)=>({u_matrix:E,u_world:o}),Qm=(E,o,f,y,x)=>a.e(Jm(E,o,f,y),{u_world:x}),fx=(E,o,f,y)=>{const x=E.transform;let S,R;if(y.paint.get("circle-pitch-alignment")==="map"){const B=fr(f,1,x.zoom);S=!0,R=[B,B]}else S=!1,R=x.pixelsToGLUnits;return{u_camera_to_center_distance:x.cameraToCenterDistance,u_scale_with_map:+(y.paint.get("circle-pitch-scale")==="map"),u_matrix:E.translatePosMatrix(o.posMatrix,f,y.paint.get("circle-translate"),y.paint.get("circle-translate-anchor")),u_pitch_with_map:+S,u_device_pixel_ratio:E.pixelRatio,u_extrude_scale:R}},io=(E,o,f)=>({u_matrix:E,u_inv_matrix:o,u_camera_to_center_distance:f.cameraToCenterDistance,u_viewport_size:[f.width,f.height]}),vu=(E,o,f=1)=>({u_matrix:E,u_color:o,u_overlay:0,u_overlay_scale:f}),Ii=E=>({u_matrix:E}),Ai=(E,o,f,y)=>({u_matrix:E,u_extrude_scale:fr(o,1,f),u_intensity:y}),Rc=(E,o,f,y)=>{const x=a.H();a.aP(x,0,E.width,E.height,0,0,1);const S=E.context.gl;return{u_matrix:x,u_world:[S.drawingBufferWidth,S.drawingBufferHeight],u_image:f,u_color_ramp:y,u_opacity:o.paint.get("heatmap-opacity")}};function Lc(E,o){const f=Math.pow(2,o.canonical.z),y=o.canonical.y;return[new a.Z(0,y/f).toLngLat().lat,new a.Z(0,(y+1)/f).toLngLat().lat]}const Bc=(E,o,f,y)=>{const x=E.transform;return{u_matrix:rg(E,o,f,y),u_ratio:1/fr(o,1,x.zoom),u_device_pixel_ratio:E.pixelRatio,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},eg=(E,o,f,y,x)=>a.e(Bc(E,o,f,x),{u_image:0,u_image_height:y}),Wo=(E,o,f,y,x)=>{const S=E.transform,R=tg(o,S);return{u_matrix:rg(E,o,f,x),u_texsize:o.imageAtlasTexture.size,u_ratio:1/fr(o,1,S.zoom),u_device_pixel_ratio:E.pixelRatio,u_image:0,u_scale:[R,y.fromScale,y.toScale],u_fade:y.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]]}},px=(E,o,f,y,x,S)=>{const R=E.lineAtlas,B=tg(o,E.transform),F=f.layout.get("line-cap")==="round",H=R.getDash(y.from,F),Y=R.getDash(y.to,F),J=H.width*x.fromScale,he=Y.width*x.toScale;return a.e(Bc(E,o,f,S),{u_patternscale_a:[B/J,-H.height/2],u_patternscale_b:[B/he,-Y.height/2],u_sdfgamma:R.width/(256*Math.min(J,he)*E.pixelRatio)/2,u_image:0,u_tex_y_a:H.y,u_tex_y_b:Y.y,u_mix:x.t})};function tg(E,o){return 1/fr(E,1,o.tileZoom)}function rg(E,o,f,y){return E.translatePosMatrix(y?y.posMatrix:o.tileID.posMatrix,o,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}const mx=(E,o,f,y,x)=>{return{u_matrix:E,u_tl_parent:o,u_scale_parent:f,u_buffer_scale:1,u_fade_t:y.mix,u_opacity:y.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(R=x.paint.get("raster-saturation"),R>0?1-1/(1.001-R):-R),u_contrast_factor:(S=x.paint.get("raster-contrast"),S>0?1/(1-S):1+S),u_spin_weights:gx(x.paint.get("raster-hue-rotate"))};var S,R};function gx(E){E*=Math.PI/180;const o=Math.sin(E),f=Math.cos(E);return[(2*f+1)/3,(-Math.sqrt(3)*o-f+1)/3,(Math.sqrt(3)*o-f+1)/3]}const ng=(E,o,f,y,x,S,R,B,F,H,Y,J,he,xe)=>{const be=R.transform;return{u_is_size_zoom_constant:+(E==="constant"||E==="source"),u_is_size_feature_constant:+(E==="constant"||E==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:be.cameraToCenterDistance,u_pitch:be.pitch/360*2*Math.PI,u_rotate_symbol:+f,u_aspect_ratio:be.width/be.height,u_fade_change:R.options.fadeDuration?R.symbolFadeChange:1,u_matrix:B,u_label_plane_matrix:F,u_coord_matrix:H,u_is_text:+J,u_pitch_with_map:+y,u_is_along_line:x,u_is_variable_anchor:S,u_texsize:he,u_texture:0,u_translation:Y,u_pitched_scale:xe}},yu=(E,o,f,y,x,S,R,B,F,H,Y,J,he,xe,be)=>{const Ce=R.transform;return a.e(ng(E,o,f,y,x,S,R,B,F,H,Y,J,he,be),{u_gamma_scale:y?Math.cos(Ce._pitch)*Ce.cameraToCenterDistance:1,u_device_pixel_ratio:R.pixelRatio,u_is_halo:1})},Hd=(E,o,f,y,x,S,R,B,F,H,Y,J,he,xe)=>a.e(yu(E,o,f,y,x,S,R,B,F,H,Y,!0,J,!0,xe),{u_texsize_icon:he,u_texture_icon:1}),Oc=(E,o,f)=>({u_matrix:E,u_opacity:o,u_color:f}),Gd=(E,o,f,y,x,S)=>a.e(function(R,B,F,H){const Y=F.imageManager.getPattern(R.from.toString()),J=F.imageManager.getPattern(R.to.toString()),{width:he,height:xe}=F.imageManager.getPixelSize(),be=Math.pow(2,H.tileID.overscaledZ),Ce=H.tileSize*Math.pow(2,F.transform.tileZoom)/be,Ie=Ce*(H.tileID.canonical.x+H.tileID.wrap*be),Ae=Ce*H.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:Y.tl,u_pattern_br_a:Y.br,u_pattern_tl_b:J.tl,u_pattern_br_b:J.br,u_texsize:[he,xe],u_mix:B.t,u_pattern_size_a:Y.displaySize,u_pattern_size_b:J.displaySize,u_scale_a:B.fromScale,u_scale_b:B.toScale,u_tile_units_to_pixels:1/fr(H,1,F.transform.tileZoom),u_pixel_coord_upper:[Ie>>16,Ae>>16],u_pixel_coord_lower:[65535&Ie,65535&Ae]}}(y,S,f,x),{u_matrix:E,u_opacity:o}),Wd={fillExtrusion:(E,o)=>({u_matrix:new a.aJ(E,o.u_matrix),u_lightpos:new a.aN(E,o.u_lightpos),u_lightintensity:new a.aI(E,o.u_lightintensity),u_lightcolor:new a.aN(E,o.u_lightcolor),u_vertical_gradient:new a.aI(E,o.u_vertical_gradient),u_opacity:new a.aI(E,o.u_opacity)}),fillExtrusionPattern:(E,o)=>({u_matrix:new a.aJ(E,o.u_matrix),u_lightpos:new a.aN(E,o.u_lightpos),u_lightintensity:new a.aI(E,o.u_lightintensity),u_lightcolor:new a.aN(E,o.u_lightcolor),u_vertical_gradient:new a.aI(E,o.u_vertical_gradient),u_height_factor:new a.aI(E,o.u_height_factor),u_image:new a.aH(E,o.u_image),u_texsize:new a.aO(E,o.u_texsize),u_pixel_coord_upper:new a.aO(E,o.u_pixel_coord_upper),u_pixel_coord_lower:new a.aO(E,o.u_pixel_coord_lower),u_scale:new a.aN(E,o.u_scale),u_fade:new a.aI(E,o.u_fade),u_opacity:new a.aI(E,o.u_opacity)}),fill:(E,o)=>({u_matrix:new a.aJ(E,o.u_matrix)}),fillPattern:(E,o)=>({u_matrix:new a.aJ(E,o.u_matrix),u_image:new a.aH(E,o.u_image),u_texsize:new a.aO(E,o.u_texsize),u_pixel_coord_upper:new a.aO(E,o.u_pixel_coord_upper),u_pixel_coord_lower:new a.aO(E,o.u_pixel_coord_lower),u_scale:new a.aN(E,o.u_scale),u_fade:new a.aI(E,o.u_fade)}),fillOutline:(E,o)=>({u_matrix:new a.aJ(E,o.u_matrix),u_world:new a.aO(E,o.u_world)}),fillOutlinePattern:(E,o)=>({u_matrix:new a.aJ(E,o.u_matrix),u_world:new a.aO(E,o.u_world),u_image:new a.aH(E,o.u_image),u_texsize:new a.aO(E,o.u_texsize),u_pixel_coord_upper:new a.aO(E,o.u_pixel_coord_upper),u_pixel_coord_lower:new a.aO(E,o.u_pixel_coord_lower),u_scale:new a.aN(E,o.u_scale),u_fade:new a.aI(E,o.u_fade)}),circle:(E,o)=>({u_camera_to_center_distance:new a.aI(E,o.u_camera_to_center_distance),u_scale_with_map:new a.aH(E,o.u_scale_with_map),u_pitch_with_map:new a.aH(E,o.u_pitch_with_map),u_extrude_scale:new a.aO(E,o.u_extrude_scale),u_device_pixel_ratio:new a.aI(E,o.u_device_pixel_ratio),u_matrix:new a.aJ(E,o.u_matrix)}),collisionBox:(E,o)=>({u_matrix:new a.aJ(E,o.u_matrix),u_pixel_extrude_scale:new a.aO(E,o.u_pixel_extrude_scale)}),collisionCircle:(E,o)=>({u_matrix:new a.aJ(E,o.u_matrix),u_inv_matrix:new a.aJ(E,o.u_inv_matrix),u_camera_to_center_distance:new a.aI(E,o.u_camera_to_center_distance),u_viewport_size:new a.aO(E,o.u_viewport_size)}),debug:(E,o)=>({u_color:new a.aL(E,o.u_color),u_matrix:new a.aJ(E,o.u_matrix),u_overlay:new a.aH(E,o.u_overlay),u_overlay_scale:new a.aI(E,o.u_overlay_scale)}),clippingMask:(E,o)=>({u_matrix:new a.aJ(E,o.u_matrix)}),heatmap:(E,o)=>({u_extrude_scale:new a.aI(E,o.u_extrude_scale),u_intensity:new a.aI(E,o.u_intensity),u_matrix:new a.aJ(E,o.u_matrix)}),heatmapTexture:(E,o)=>({u_matrix:new a.aJ(E,o.u_matrix),u_world:new a.aO(E,o.u_world),u_image:new a.aH(E,o.u_image),u_color_ramp:new a.aH(E,o.u_color_ramp),u_opacity:new a.aI(E,o.u_opacity)}),hillshade:(E,o)=>({u_matrix:new a.aJ(E,o.u_matrix),u_image:new a.aH(E,o.u_image),u_latrange:new a.aO(E,o.u_latrange),u_light:new a.aO(E,o.u_light),u_shadow:new a.aL(E,o.u_shadow),u_highlight:new a.aL(E,o.u_highlight),u_accent:new a.aL(E,o.u_accent)}),hillshadePrepare:(E,o)=>({u_matrix:new a.aJ(E,o.u_matrix),u_image:new a.aH(E,o.u_image),u_dimension:new a.aO(E,o.u_dimension),u_zoom:new a.aI(E,o.u_zoom),u_unpack:new a.aK(E,o.u_unpack)}),line:(E,o)=>({u_matrix:new a.aJ(E,o.u_matrix),u_ratio:new a.aI(E,o.u_ratio),u_device_pixel_ratio:new a.aI(E,o.u_device_pixel_ratio),u_units_to_pixels:new a.aO(E,o.u_units_to_pixels)}),lineGradient:(E,o)=>({u_matrix:new a.aJ(E,o.u_matrix),u_ratio:new a.aI(E,o.u_ratio),u_device_pixel_ratio:new a.aI(E,o.u_device_pixel_ratio),u_units_to_pixels:new a.aO(E,o.u_units_to_pixels),u_image:new a.aH(E,o.u_image),u_image_height:new a.aI(E,o.u_image_height)}),linePattern:(E,o)=>({u_matrix:new a.aJ(E,o.u_matrix),u_texsize:new a.aO(E,o.u_texsize),u_ratio:new a.aI(E,o.u_ratio),u_device_pixel_ratio:new a.aI(E,o.u_device_pixel_ratio),u_image:new a.aH(E,o.u_image),u_units_to_pixels:new a.aO(E,o.u_units_to_pixels),u_scale:new a.aN(E,o.u_scale),u_fade:new a.aI(E,o.u_fade)}),lineSDF:(E,o)=>({u_matrix:new a.aJ(E,o.u_matrix),u_ratio:new a.aI(E,o.u_ratio),u_device_pixel_ratio:new a.aI(E,o.u_device_pixel_ratio),u_units_to_pixels:new a.aO(E,o.u_units_to_pixels),u_patternscale_a:new a.aO(E,o.u_patternscale_a),u_patternscale_b:new a.aO(E,o.u_patternscale_b),u_sdfgamma:new a.aI(E,o.u_sdfgamma),u_image:new a.aH(E,o.u_image),u_tex_y_a:new a.aI(E,o.u_tex_y_a),u_tex_y_b:new a.aI(E,o.u_tex_y_b),u_mix:new a.aI(E,o.u_mix)}),raster:(E,o)=>({u_matrix:new a.aJ(E,o.u_matrix),u_tl_parent:new a.aO(E,o.u_tl_parent),u_scale_parent:new a.aI(E,o.u_scale_parent),u_buffer_scale:new a.aI(E,o.u_buffer_scale),u_fade_t:new a.aI(E,o.u_fade_t),u_opacity:new a.aI(E,o.u_opacity),u_image0:new a.aH(E,o.u_image0),u_image1:new a.aH(E,o.u_image1),u_brightness_low:new a.aI(E,o.u_brightness_low),u_brightness_high:new a.aI(E,o.u_brightness_high),u_saturation_factor:new a.aI(E,o.u_saturation_factor),u_contrast_factor:new a.aI(E,o.u_contrast_factor),u_spin_weights:new a.aN(E,o.u_spin_weights)}),symbolIcon:(E,o)=>({u_is_size_zoom_constant:new a.aH(E,o.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aH(E,o.u_is_size_feature_constant),u_size_t:new a.aI(E,o.u_size_t),u_size:new a.aI(E,o.u_size),u_camera_to_center_distance:new a.aI(E,o.u_camera_to_center_distance),u_pitch:new a.aI(E,o.u_pitch),u_rotate_symbol:new a.aH(E,o.u_rotate_symbol),u_aspect_ratio:new a.aI(E,o.u_aspect_ratio),u_fade_change:new a.aI(E,o.u_fade_change),u_matrix:new a.aJ(E,o.u_matrix),u_label_plane_matrix:new a.aJ(E,o.u_label_plane_matrix),u_coord_matrix:new a.aJ(E,o.u_coord_matrix),u_is_text:new a.aH(E,o.u_is_text),u_pitch_with_map:new a.aH(E,o.u_pitch_with_map),u_is_along_line:new a.aH(E,o.u_is_along_line),u_is_variable_anchor:new a.aH(E,o.u_is_variable_anchor),u_texsize:new a.aO(E,o.u_texsize),u_texture:new a.aH(E,o.u_texture),u_translation:new a.aO(E,o.u_translation),u_pitched_scale:new a.aI(E,o.u_pitched_scale)}),symbolSDF:(E,o)=>({u_is_size_zoom_constant:new a.aH(E,o.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aH(E,o.u_is_size_feature_constant),u_size_t:new a.aI(E,o.u_size_t),u_size:new a.aI(E,o.u_size),u_camera_to_center_distance:new a.aI(E,o.u_camera_to_center_distance),u_pitch:new a.aI(E,o.u_pitch),u_rotate_symbol:new a.aH(E,o.u_rotate_symbol),u_aspect_ratio:new a.aI(E,o.u_aspect_ratio),u_fade_change:new a.aI(E,o.u_fade_change),u_matrix:new a.aJ(E,o.u_matrix),u_label_plane_matrix:new a.aJ(E,o.u_label_plane_matrix),u_coord_matrix:new a.aJ(E,o.u_coord_matrix),u_is_text:new a.aH(E,o.u_is_text),u_pitch_with_map:new a.aH(E,o.u_pitch_with_map),u_is_along_line:new a.aH(E,o.u_is_along_line),u_is_variable_anchor:new a.aH(E,o.u_is_variable_anchor),u_texsize:new a.aO(E,o.u_texsize),u_texture:new a.aH(E,o.u_texture),u_gamma_scale:new a.aI(E,o.u_gamma_scale),u_device_pixel_ratio:new a.aI(E,o.u_device_pixel_ratio),u_is_halo:new a.aH(E,o.u_is_halo),u_translation:new a.aO(E,o.u_translation),u_pitched_scale:new a.aI(E,o.u_pitched_scale)}),symbolTextAndIcon:(E,o)=>({u_is_size_zoom_constant:new a.aH(E,o.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aH(E,o.u_is_size_feature_constant),u_size_t:new a.aI(E,o.u_size_t),u_size:new a.aI(E,o.u_size),u_camera_to_center_distance:new a.aI(E,o.u_camera_to_center_distance),u_pitch:new a.aI(E,o.u_pitch),u_rotate_symbol:new a.aH(E,o.u_rotate_symbol),u_aspect_ratio:new a.aI(E,o.u_aspect_ratio),u_fade_change:new a.aI(E,o.u_fade_change),u_matrix:new a.aJ(E,o.u_matrix),u_label_plane_matrix:new a.aJ(E,o.u_label_plane_matrix),u_coord_matrix:new a.aJ(E,o.u_coord_matrix),u_is_text:new a.aH(E,o.u_is_text),u_pitch_with_map:new a.aH(E,o.u_pitch_with_map),u_is_along_line:new a.aH(E,o.u_is_along_line),u_is_variable_anchor:new a.aH(E,o.u_is_variable_anchor),u_texsize:new a.aO(E,o.u_texsize),u_texsize_icon:new a.aO(E,o.u_texsize_icon),u_texture:new a.aH(E,o.u_texture),u_texture_icon:new a.aH(E,o.u_texture_icon),u_gamma_scale:new a.aI(E,o.u_gamma_scale),u_device_pixel_ratio:new a.aI(E,o.u_device_pixel_ratio),u_is_halo:new a.aH(E,o.u_is_halo),u_translation:new a.aO(E,o.u_translation),u_pitched_scale:new a.aI(E,o.u_pitched_scale)}),background:(E,o)=>({u_matrix:new a.aJ(E,o.u_matrix),u_opacity:new a.aI(E,o.u_opacity),u_color:new a.aL(E,o.u_color)}),backgroundPattern:(E,o)=>({u_matrix:new a.aJ(E,o.u_matrix),u_opacity:new a.aI(E,o.u_opacity),u_image:new a.aH(E,o.u_image),u_pattern_tl_a:new a.aO(E,o.u_pattern_tl_a),u_pattern_br_a:new a.aO(E,o.u_pattern_br_a),u_pattern_tl_b:new a.aO(E,o.u_pattern_tl_b),u_pattern_br_b:new a.aO(E,o.u_pattern_br_b),u_texsize:new a.aO(E,o.u_texsize),u_mix:new a.aI(E,o.u_mix),u_pattern_size_a:new a.aO(E,o.u_pattern_size_a),u_pattern_size_b:new a.aO(E,o.u_pattern_size_b),u_scale_a:new a.aI(E,o.u_scale_a),u_scale_b:new a.aI(E,o.u_scale_b),u_pixel_coord_upper:new a.aO(E,o.u_pixel_coord_upper),u_pixel_coord_lower:new a.aO(E,o.u_pixel_coord_lower),u_tile_units_to_pixels:new a.aI(E,o.u_tile_units_to_pixels)}),terrain:(E,o)=>({u_matrix:new a.aJ(E,o.u_matrix),u_texture:new a.aH(E,o.u_texture),u_ele_delta:new a.aI(E,o.u_ele_delta),u_fog_matrix:new a.aJ(E,o.u_fog_matrix),u_fog_color:new a.aL(E,o.u_fog_color),u_fog_ground_blend:new a.aI(E,o.u_fog_ground_blend),u_fog_ground_blend_opacity:new a.aI(E,o.u_fog_ground_blend_opacity),u_horizon_color:new a.aL(E,o.u_horizon_color),u_horizon_fog_blend:new a.aI(E,o.u_horizon_fog_blend)}),terrainDepth:(E,o)=>({u_matrix:new a.aJ(E,o.u_matrix),u_ele_delta:new a.aI(E,o.u_ele_delta)}),terrainCoords:(E,o)=>({u_matrix:new a.aJ(E,o.u_matrix),u_texture:new a.aH(E,o.u_texture),u_terrain_coords_id:new a.aI(E,o.u_terrain_coords_id),u_ele_delta:new a.aI(E,o.u_ele_delta)}),sky:(E,o)=>({u_sky_color:new a.aL(E,o.u_sky_color),u_horizon_color:new a.aL(E,o.u_horizon_color),u_horizon:new a.aI(E,o.u_horizon),u_sky_horizon_blend:new a.aI(E,o.u_sky_horizon_blend)})};class Va{constructor(o,f,y){this.context=o;const x=o.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!y,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const f=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const vx={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Zd{constructor(o,f,y,x){this.length=f.length,this.attributes=y,this.itemSize=f.bytesPerElement,this.dynamicDraw=x,this.context=o;const S=o.gl;this.buffer=S.createBuffer(),o.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){if(o.length!==this.length)throw new Error(`Length of new data is ${o.length}, which doesn't match current length of ${this.length}`);const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,f){for(let y=0;y<this.attributes.length;y++){const x=f.attributes[this.attributes[y].name];x!==void 0&&o.enableVertexAttribArray(x)}}setVertexAttribPointers(o,f,y){for(let x=0;x<this.attributes.length;x++){const S=this.attributes[x],R=f.attributes[S.name];R!==void 0&&o.vertexAttribPointer(R,S.components,o[vx[S.type]],!1,this.itemSize,S.offset+this.itemSize*(y||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ao=new WeakMap;function Ns(E){var o;if(ao.has(E))return ao.get(E);{const f=(o=E.getParameter(E.VERSION))===null||o===void 0?void 0:o.startsWith("WebGL 2.0");return ao.set(E,f),f}}class Lr{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Fc extends Lr{getDefault(){return a.aM.transparent}set(o){const f=this.current;(o.r!==f.r||o.g!==f.g||o.b!==f.b||o.a!==f.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class yx extends Lr{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class Zo extends Lr{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class xx extends Lr{getDefault(){return[!0,!0,!0,!0]}set(o){const f=this.current;(o[0]!==f[0]||o[1]!==f[1]||o[2]!==f[2]||o[3]!==f[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class ig extends Lr{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class _x extends Lr{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class ag extends Lr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const f=this.current;(o.func!==f.func||o.ref!==f.ref||o.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class Xd extends Lr{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const f=this.current;(o[0]!==f[0]||o[1]!==f[1]||o[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class sg extends Lr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;o?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=o,this.dirty=!1}}class og extends Lr{getDefault(){return[0,1]}set(o){const f=this.current;(o[0]!==f[0]||o[1]!==f[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class lg extends Lr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;o?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=o,this.dirty=!1}}class ug extends Lr{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class so extends Lr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;o?f.enable(f.BLEND):f.disable(f.BLEND),this.current=o,this.dirty=!1}}class cg extends Lr{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const f=this.current;(o[0]!==f[0]||o[1]!==f[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class wx extends Lr{getDefault(){return a.aM.transparent}set(o){const f=this.current;(o.r!==f.r||o.g!==f.g||o.b!==f.b||o.a!==f.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class hg extends Lr{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class xu extends Lr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;o?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=o,this.dirty=!1}}class bx extends Lr{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class jc extends Lr{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class Sx extends Lr{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class Ex extends Lr{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class dg extends Lr{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const f=this.current;(o[0]!==f[0]||o[1]!==f[1]||o[2]!==f[2]||o[3]!==f[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class fg extends Lr{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class pg extends Lr{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Kd extends Lr{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class mg extends Lr{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class $c extends Lr{getDefault(){return null}set(o){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class cs extends Lr{getDefault(){return null}set(o){var f;if(o===this.current&&!this.dirty)return;const y=this.gl;Ns(y)?y.bindVertexArray(o):(f=y.getExtension("OES_vertex_array_object"))===null||f===void 0||f.bindVertexArrayOES(o),this.current=o,this.dirty=!1}}class Yd extends Lr{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class Jd extends Lr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class Qd extends Lr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class Vc extends Lr{constructor(o,f){super(o),this.context=o,this.parent=f}getDefault(){return null}}class ef extends Vc{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class oo extends Vc{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,f.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class tf extends Vc{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_STENCIL_ATTACHMENT,f.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Tx{constructor(o,f,y,x,S){this.context=o,this.width=f,this.height=y;const R=o.gl,B=this.framebuffer=R.createFramebuffer();if(this.colorAttachment=new ef(o,B),x)this.depthAttachment=S?new tf(o,B):new oo(o,B);else if(S)throw new Error("Stencil cannot be set without depth");if(R.checkFramebufferStatus(R.FRAMEBUFFER)!==R.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const o=this.context.gl,f=this.colorAttachment.get();if(f&&o.deleteTexture(f),this.depthAttachment){const y=this.depthAttachment.get();y&&o.deleteRenderbuffer(y)}o.deleteFramebuffer(this.framebuffer)}}class gn{constructor(o,f,y){this.blendFunction=o,this.blendColor=f,this.mask=y}}gn.Replace=[1,0],gn.disabled=new gn(gn.Replace,a.aM.transparent,[!1,!1,!1,!1]),gn.unblended=new gn(gn.Replace,a.aM.transparent,[!0,!0,!0,!0]),gn.alphaBlended=new gn([1,771],a.aM.transparent,[!0,!0,!0,!0]);class Cx{constructor(o){var f,y;if(this.gl=o,this.clearColor=new Fc(this),this.clearDepth=new yx(this),this.clearStencil=new Zo(this),this.colorMask=new xx(this),this.depthMask=new ig(this),this.stencilMask=new _x(this),this.stencilFunc=new ag(this),this.stencilOp=new Xd(this),this.stencilTest=new sg(this),this.depthRange=new og(this),this.depthTest=new lg(this),this.depthFunc=new ug(this),this.blend=new so(this),this.blendFunc=new cg(this),this.blendColor=new wx(this),this.blendEquation=new hg(this),this.cullFace=new xu(this),this.cullFaceSide=new bx(this),this.frontFace=new jc(this),this.program=new Sx(this),this.activeTexture=new Ex(this),this.viewport=new dg(this),this.bindFramebuffer=new fg(this),this.bindRenderbuffer=new pg(this),this.bindTexture=new Kd(this),this.bindVertexBuffer=new mg(this),this.bindElementBuffer=new $c(this),this.bindVertexArray=new cs(this),this.pixelStoreUnpack=new Yd(this),this.pixelStoreUnpackPremultiplyAlpha=new Jd(this),this.pixelStoreUnpackFlipY=new Qd(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),Ns(o)){this.HALF_FLOAT=o.HALF_FLOAT;const x=o.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(f=o.RGBA16F)!==null&&f!==void 0?f:x==null?void 0:x.RGBA16F_EXT,this.RGB16F=(y=o.RGB16F)!==null&&y!==void 0?y:x==null?void 0:x.RGB16F_EXT,o.getExtension("EXT_color_buffer_float")}else{o.getExtension("EXT_color_buffer_half_float"),o.getExtension("OES_texture_half_float_linear");const x=o.getExtension("OES_texture_half_float");this.HALF_FLOAT=x==null?void 0:x.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,f){return new Va(this,o,f)}createVertexBuffer(o,f,y){return new Zd(this,o,f,y)}createRenderbuffer(o,f,y){const x=this.gl,S=x.createRenderbuffer();return this.bindRenderbuffer.set(S),x.renderbufferStorage(x.RENDERBUFFER,o,f,y),this.bindRenderbuffer.set(null),S}createFramebuffer(o,f,y,x){return new Tx(this,o,f,y,x)}clear({color:o,depth:f,stencil:y}){const x=this.gl;let S=0;o&&(S|=x.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(S|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),y!==void 0&&(S|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(y),this.stencilMask.set(255)),x.clear(S)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){a.aE(o.blendFunction,gn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}createVertexArray(){var o;return Ns(this.gl)?this.gl.createVertexArray():(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.createVertexArrayOES()}deleteVertexArray(o){var f;return Ns(this.gl)?this.gl.deleteVertexArray(o):(f=this.gl.getExtension("OES_vertex_array_object"))===null||f===void 0?void 0:f.deleteVertexArrayOES(o)}unbindVAO(){this.bindVertexArray.set(null)}}class wr{constructor(o,f,y){this.func=o,this.mask=f,this.range=y}}wr.ReadOnly=!1,wr.ReadWrite=!0,wr.disabled=new wr(519,wr.ReadOnly,[0,1]);const Uc=7680;class Zr{constructor(o,f,y,x,S,R){this.test=o,this.ref=f,this.mask=y,this.fail=x,this.depthFail=S,this.pass=R}}Zr.disabled=new Zr({func:519,mask:0},0,0,Uc,Uc,Uc);class $r{constructor(o,f,y){this.enable=o,this.mode=f,this.frontFace=y}}let lo;function _u(E,o,f,y,x){const S=E.context,R=S.gl,B=E.useProgram("collisionBox"),F=[];let H=0,Y=0;for(let Ae=0;Ae<y.length;Ae++){const ze=y[Ae],Ee=o.getTile(ze).getBucket(f);if(!Ee)continue;const Fe=x?Ee.textCollisionBox:Ee.iconCollisionBox,qe=Ee.collisionCircleArray;if(qe.length>0){const Ke=a.H();a.aQ(Ke,Ee.placementInvProjMatrix,E.transform.glCoordMatrix),a.aQ(Ke,Ke,Ee.placementViewportMatrix),F.push({circleArray:qe,circleOffset:Y,transform:ze.posMatrix,invTransform:Ke,coord:ze}),H+=qe.length/4,Y=H}Fe&&B.draw(S,R.LINES,wr.disabled,Zr.disabled,E.colorModeForRenderPass(),$r.disabled,{u_matrix:ze.posMatrix,u_pixel_extrude_scale:[1/(J=E.transform).width,1/J.height]},E.style.map.terrain&&E.style.map.terrain.getTerrainData(ze),f.id,Fe.layoutVertexBuffer,Fe.indexBuffer,Fe.segments,null,E.transform.zoom,null,null,Fe.collisionVertexBuffer)}var J;if(!x||!F.length)return;const he=E.useProgram("collisionCircle"),xe=new a.aR;xe.resize(4*H),xe._trim();let be=0;for(const Ae of F)for(let ze=0;ze<Ae.circleArray.length/4;ze++){const Ee=4*ze,Fe=Ae.circleArray[Ee+0],qe=Ae.circleArray[Ee+1],Ke=Ae.circleArray[Ee+2],ct=Ae.circleArray[Ee+3];xe.emplace(be++,Fe,qe,Ke,ct,0),xe.emplace(be++,Fe,qe,Ke,ct,1),xe.emplace(be++,Fe,qe,Ke,ct,2),xe.emplace(be++,Fe,qe,Ke,ct,3)}(!lo||lo.length<2*H)&&(lo=function(Ae){const ze=2*Ae,Ee=new a.aT;Ee.resize(ze),Ee._trim();for(let Fe=0;Fe<ze;Fe++){const qe=6*Fe;Ee.uint16[qe+0]=4*Fe+0,Ee.uint16[qe+1]=4*Fe+1,Ee.uint16[qe+2]=4*Fe+2,Ee.uint16[qe+3]=4*Fe+2,Ee.uint16[qe+4]=4*Fe+3,Ee.uint16[qe+5]=4*Fe+0}return Ee}(H));const Ce=S.createIndexBuffer(lo,!0),Ie=S.createVertexBuffer(xe,a.aS.members,!0);for(const Ae of F){const ze=io(Ae.transform,Ae.invTransform,E.transform);he.draw(S,R.TRIANGLES,wr.disabled,Zr.disabled,E.colorModeForRenderPass(),$r.disabled,ze,E.style.map.terrain&&E.style.map.terrain.getTerrainData(Ae.coord),f.id,Ie,Ce,a.a0.simpleSegment(0,2*Ae.circleOffset,Ae.circleArray.length,Ae.circleArray.length/2),null,E.transform.zoom,null,null,null)}Ie.destroy(),Ce.destroy()}$r.disabled=new $r(!1,1029,2305),$r.backCCW=new $r(!0,1029,2305);const wu=a.an(new Float32Array(16));function rf(E,o,f,y,x,S){const{horizontalAlign:R,verticalAlign:B}=a.au(E);return new a.P((-(R-.5)*o/x+y[0])*S,(-(B-.5)*f/x+y[1])*S)}function uo(E,o,f,y,x,S){const R=o.tileAnchorPoint.add(new a.P(o.translation[0],o.translation[1]));if(o.pitchWithMap){let B=y.mult(S);f||(B=B.rotate(-x));const F=R.add(B);return Se(F.x,F.y,o.labelPlaneMatrix,o.getElevation).point}if(f){const B=Ye(o.tileAnchorPoint.x+1,o.tileAnchorPoint.y,o).point.sub(E),F=Math.atan(B.y/B.x)+(B.x<0?Math.PI:0);return E.add(y.rotate(F))}return E.add(y)}function Xo(E,o,f,y,x,S,R,B,F,H,Y,J,he,xe){const be=E.text.placedSymbolArray,Ce=E.text.dynamicLayoutVertexArray,Ie=E.icon.dynamicLayoutVertexArray,Ae={};Ce.clear();for(let ze=0;ze<be.length;ze++){const Ee=be.get(ze),Fe=Ee.hidden||!Ee.crossTileID||E.allowVerticalPlacement&&!Ee.placedOrientation?null:y[Ee.crossTileID];if(Fe){const qe=new a.P(Ee.anchorX,Ee.anchorY),Ke={getElevation:xe,width:x.width,height:x.height,labelPlaneMatrix:S,pitchWithMap:f,projection:Y,tileAnchorPoint:qe,translation:J,unwrappedTileID:he},ct=f?Se(qe.x,qe.y,R,xe):Ye(qe.x,qe.y,Ke),_t=re(x.cameraToCenterDistance,ct.signedDistanceFromCamera);let It=a.ai(E.textSizeData,F,Ee)*_t/a.ap;f&&(It*=E.tilePixelRatio/B);const{width:zt,height:Et,anchor:St,textOffset:Wt,textBoxScale:hr}=Fe,kt=rf(St,zt,Et,Wt,hr,It),Dt=Y.getPitchedTextCorrection(x,qe.add(new a.P(J[0],J[1])),he),ur=uo(ct.point,Ke,o,kt,x.angle,Dt),Jr=E.allowVerticalPlacement&&Ee.placedOrientation===a.ah.vertical?Math.PI/2:0;for(let yr=0;yr<Ee.numGlyphs;yr++)a.aj(Ce,ur,Jr);H&&Ee.associatedIconIndex>=0&&(Ae[Ee.associatedIconIndex]={shiftedAnchor:ur,angle:Jr})}else Ut(Ee.numGlyphs,Ce)}if(H){Ie.clear();const ze=E.icon.placedSymbolArray;for(let Ee=0;Ee<ze.length;Ee++){const Fe=ze.get(Ee);if(Fe.hidden)Ut(Fe.numGlyphs,Ie);else{const qe=Ae[Ee];if(qe)for(let Ke=0;Ke<Fe.numGlyphs;Ke++)a.aj(Ie,qe.shiftedAnchor,qe.angle);else Ut(Fe.numGlyphs,Ie)}}E.icon.dynamicLayoutVertexBuffer.updateData(Ie)}E.text.dynamicLayoutVertexBuffer.updateData(Ce)}function aa(E,o,f){return f.iconsInText&&o?"symbolTextAndIcon":E?"symbolSDF":"symbolIcon"}function nf(E,o,f,y,x,S,R,B,F,H,Y,J){const he=E.context,xe=he.gl,be=E.transform,Ce=qi(),Ie=B==="map",Ae=F==="map",ze=B!=="viewport"&&f.layout.get("symbol-placement")!=="point",Ee=Ie&&!Ae&&!ze,Fe=!Ae&&ze,qe=!f.layout.get("symbol-sort-key").isConstant();let Ke=!1;const ct=E.depthModeForSublayer(0,wr.ReadOnly),_t=f._unevaluatedLayout.hasValue("text-variable-anchor")||f._unevaluatedLayout.hasValue("text-variable-anchor-offset"),It=[],zt=Ce.getCircleRadiusCorrection(be);for(const Et of y){const St=o.getTile(Et),Wt=St.getBucket(f);if(!Wt)continue;const hr=x?Wt.text:Wt.icon;if(!hr||!hr.segments.get().length||!hr.hasVisibleVertices)continue;const kt=hr.programConfigurations.get(f.id),Dt=x||Wt.sdfIcons,ur=x?Wt.textSizeData:Wt.iconSizeData,Jr=Ae||be.pitch!==0,yr=E.useProgram(aa(Dt,x,Wt),kt),Sr=a.ag(ur,be.zoom),Qr=E.style.map.terrain&&E.style.map.terrain.getTerrainData(Et);let ni,Ta,en,Mi,gi=[0,0],ii=null;if(x)Ta=St.glyphAtlasTexture,en=xe.LINEAR,ni=St.glyphAtlasTexture.size,Wt.iconsInText&&(gi=St.imageAtlasTexture.size,ii=St.imageAtlasTexture,Mi=Jr||E.options.rotating||E.options.zooming||ur.kind==="composite"||ur.kind==="camera"?xe.LINEAR:xe.NEAREST);else{const Cr=f.layout.get("icon-size").constantOr(0)!==1||Wt.iconsNeedLinear;Ta=St.imageAtlasTexture,en=Dt||E.options.rotating||E.options.zooming||Cr||Jr?xe.LINEAR:xe.NEAREST,ni=St.imageAtlasTexture.size}const vi=fr(St,1,E.transform.zoom),Ha=Fe?Et.posMatrix:wu,cl=Lt(Ha,Ae,Ie,E.transform,vi),lh=Kt(Ha,Ae,Ie,E.transform,vi),hl=Kt(Et.posMatrix,Ae,Ie,E.transform,vi),la=Ce.translatePosition(E.transform,St,S,R),uh=_t&&Wt.hasTextData(),If=f.layout.get("icon-text-fit")!=="none"&&uh&&Wt.hasIconData();if(ze){const Cr=E.style.map.terrain?(dl,fl)=>E.style.map.terrain.getElevation(Et,dl,fl):null,mo=f.layout.get("text-rotation-alignment")==="map";fe(Wt,Et.posMatrix,E,x,cl,hl,Ae,H,mo,Ce,Et.toUnwrapped(),be.width,be.height,la,Cr)}const ua=Et.posMatrix,ca=x&&_t||If,zs=ze||ca?wu:cl,Ca=lh,Gn=Dt&&f.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ai;ai=Dt?Wt.iconsInText?Hd(ur.kind,Sr,Ee,Ae,ze,ca,E,ua,zs,Ca,la,ni,gi,zt):yu(ur.kind,Sr,Ee,Ae,ze,ca,E,ua,zs,Ca,la,x,ni,!0,zt):ng(ur.kind,Sr,Ee,Ae,ze,ca,E,ua,zs,Ca,la,x,ni,zt);const Xi={program:yr,buffers:hr,uniformValues:ai,atlasTexture:Ta,atlasTextureIcon:ii,atlasInterpolation:en,atlasInterpolationIcon:Mi,isSDF:Dt,hasHalo:Gn};if(qe&&Wt.canOverlap){Ke=!0;const Cr=hr.segments.get();for(const mo of Cr)It.push({segments:new a.a0([mo]),sortKey:mo.sortKey,state:Xi,terrainData:Qr})}else It.push({segments:hr.segments,sortKey:0,state:Xi,terrainData:Qr})}Ke&&It.sort((Et,St)=>Et.sortKey-St.sortKey);for(const Et of It){const St=Et.state;if(he.activeTexture.set(xe.TEXTURE0),St.atlasTexture.bind(St.atlasInterpolation,xe.CLAMP_TO_EDGE),St.atlasTextureIcon&&(he.activeTexture.set(xe.TEXTURE1),St.atlasTextureIcon&&St.atlasTextureIcon.bind(St.atlasInterpolationIcon,xe.CLAMP_TO_EDGE)),St.isSDF){const Wt=St.uniformValues;St.hasHalo&&(Wt.u_is_halo=1,af(St.buffers,Et.segments,f,E,St.program,ct,Y,J,Wt,Et.terrainData)),Wt.u_is_halo=0}af(St.buffers,Et.segments,f,E,St.program,ct,Y,J,St.uniformValues,Et.terrainData)}}function af(E,o,f,y,x,S,R,B,F,H){const Y=y.context;x.draw(Y,Y.gl.TRIANGLES,S,R,B,$r.disabled,F,H,f.id,E.layoutVertexBuffer,E.indexBuffer,o,f.paint,y.transform.zoom,E.programConfigurations.get(f.id),E.dynamicLayoutVertexBuffer,E.opacityVertexBuffer)}function sf(E,o,f,y){const x=E.context,S=x.gl,R=Zr.disabled,B=new gn([S.ONE,S.ONE],a.aM.transparent,[!0,!0,!0,!0]),F=o.getBucket(f);if(!F)return;const H=y.key;let Y=f.heatmapFbos.get(H);Y||(Y=bu(x,o.tileSize,o.tileSize),f.heatmapFbos.set(H,Y)),x.bindFramebuffer.set(Y.framebuffer),x.viewport.set([0,0,o.tileSize,o.tileSize]),x.clear({color:a.aM.transparent});const J=F.programConfigurations.get(f.id),he=E.useProgram("heatmap",J),xe=E.style.map.terrain.getTerrainData(y);he.draw(x,S.TRIANGLES,wr.disabled,R,B,$r.disabled,Ai(y.posMatrix,o,E.transform.zoom,f.paint.get("heatmap-intensity")),xe,f.id,F.layoutVertexBuffer,F.indexBuffer,F.segments,f.paint,E.transform.zoom,J)}function co(E,o,f){const y=E.context,x=y.gl;y.setColorMode(E.colorModeForRenderPass());const S=Su(y,o),R=f.key,B=o.heatmapFbos.get(R);B&&(y.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,B.colorAttachment.get()),y.activeTexture.set(x.TEXTURE1),S.bind(x.LINEAR,x.CLAMP_TO_EDGE),E.useProgram("heatmapTexture").draw(y,x.TRIANGLES,wr.disabled,Zr.disabled,E.colorModeForRenderPass(),$r.disabled,Rc(E,o,0,1),null,o.id,E.rasterBoundsBuffer,E.quadTriangleIndexBuffer,E.rasterBoundsSegments,o.paint,E.transform.zoom),B.destroy(),o.heatmapFbos.delete(R))}function bu(E,o,f){var y,x;const S=E.gl,R=S.createTexture();S.bindTexture(S.TEXTURE_2D,R),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,S.CLAMP_TO_EDGE),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,S.CLAMP_TO_EDGE),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,S.LINEAR),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,S.LINEAR);const B=(y=E.HALF_FLOAT)!==null&&y!==void 0?y:S.UNSIGNED_BYTE,F=(x=E.RGBA16F)!==null&&x!==void 0?x:S.RGBA;S.texImage2D(S.TEXTURE_2D,0,F,o,f,0,S.RGBA,B,null);const H=E.createFramebuffer(o,f,!1,!1);return H.colorAttachment.set(R),H}function Su(E,o){return o.colorRampTexture||(o.colorRampTexture=new X(E,o.colorRamp,E.gl.RGBA)),o.colorRampTexture}function Ko(E,o,f,y,x){if(!f||!y||!y.imageAtlas)return;const S=y.imageAtlas.patternPositions;let R=S[f.to.toString()],B=S[f.from.toString()];if(!R&&B&&(R=B),!B&&R&&(B=R),!R||!B){const F=x.getPaintProperty(o);R=S[F],B=S[F]}R&&B&&E.setConstantPatternPositions(R,B)}function Eu(E,o,f,y,x,S,R){const B=E.context.gl,F="fill-pattern",H=f.paint.get(F),Y=H&&H.constantOr(1),J=f.getCrossfadeParameters();let he,xe,be,Ce,Ie;R?(xe=Y&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",he=B.LINES):(xe=Y?"fillPattern":"fill",he=B.TRIANGLES);const Ae=H.constantOr(null);for(const ze of y){const Ee=o.getTile(ze);if(Y&&!Ee.patternsLoaded())continue;const Fe=Ee.getBucket(f);if(!Fe)continue;const qe=Fe.programConfigurations.get(f.id),Ke=E.useProgram(xe,qe),ct=E.style.map.terrain&&E.style.map.terrain.getTerrainData(ze);Y&&(E.context.activeTexture.set(B.TEXTURE0),Ee.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),qe.updatePaintBuffers(J)),Ko(qe,F,Ae,Ee,f);const _t=ct?ze:null,It=E.translatePosMatrix(_t?_t.posMatrix:ze.posMatrix,Ee,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));if(R){Ce=Fe.indexBuffer2,Ie=Fe.segments2;const zt=[B.drawingBufferWidth,B.drawingBufferHeight];be=xe==="fillOutlinePattern"&&Y?Qm(It,E,J,Ee,zt):dx(It,zt)}else Ce=Fe.indexBuffer,Ie=Fe.segments,be=Y?Jm(It,E,J,Ee):Go(It);Ke.draw(E.context,he,x,E.stencilModeForClipping(ze),S,$r.disabled,be,ct,f.id,Fe.layoutVertexBuffer,Ce,Ie,f.paint,E.transform.zoom,qe)}}function qc(E,o,f,y,x,S,R){const B=E.context,F=B.gl,H="fill-extrusion-pattern",Y=f.paint.get(H),J=Y.constantOr(1),he=f.getCrossfadeParameters(),xe=f.paint.get("fill-extrusion-opacity"),be=Y.constantOr(null);for(const Ce of y){const Ie=o.getTile(Ce),Ae=Ie.getBucket(f);if(!Ae)continue;const ze=E.style.map.terrain&&E.style.map.terrain.getTerrainData(Ce),Ee=Ae.programConfigurations.get(f.id),Fe=E.useProgram(J?"fillExtrusionPattern":"fillExtrusion",Ee);J&&(E.context.activeTexture.set(F.TEXTURE0),Ie.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),Ee.updatePaintBuffers(he)),Ko(Ee,H,be,Ie,f);const qe=E.translatePosMatrix(Ce.posMatrix,Ie,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),Ke=f.paint.get("fill-extrusion-vertical-gradient"),ct=J?zc(qe,E,Ke,xe,Ce,he,Ie):gu(qe,E,Ke,xe);Fe.draw(B,B.gl.TRIANGLES,x,S,R,$r.backCCW,ct,ze,f.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,f.paint,E.transform.zoom,Ee,E.style.map.terrain&&Ae.centroidVertexBuffer)}}function Yo(E,o,f,y,x,S,R){const B=E.context,F=B.gl,H=f.fbo;if(!H)return;const Y=E.useProgram("hillshade"),J=E.style.map.terrain&&E.style.map.terrain.getTerrainData(o);B.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,H.colorAttachment.get()),Y.draw(B,F.TRIANGLES,x,S,R,$r.disabled,((he,xe,be,Ce)=>{const Ie=be.paint.get("hillshade-shadow-color"),Ae=be.paint.get("hillshade-highlight-color"),ze=be.paint.get("hillshade-accent-color");let Ee=be.paint.get("hillshade-illumination-direction")*(Math.PI/180);be.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ee-=he.transform.angle);const Fe=!he.options.moving;return{u_matrix:Ce?Ce.posMatrix:he.transform.calculatePosMatrix(xe.tileID.toUnwrapped(),Fe),u_image:0,u_latrange:Lc(0,xe.tileID),u_light:[be.paint.get("hillshade-exaggeration"),Ee],u_shadow:Ie,u_highlight:Ae,u_accent:ze}})(E,f,y,J?o:null),J,y.id,E.rasterBoundsBuffer,E.quadTriangleIndexBuffer,E.rasterBoundsSegments)}function Jo(E,o,f,y,x,S){const R=E.context,B=R.gl,F=o.dem;if(F&&F.data){const H=F.dim,Y=F.stride,J=F.getPixels();if(R.activeTexture.set(B.TEXTURE1),R.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||E.getTileTexture(Y),o.demTexture){const xe=o.demTexture;xe.update(J,{premultiply:!1}),xe.bind(B.NEAREST,B.CLAMP_TO_EDGE)}else o.demTexture=new X(R,J,B.RGBA,{premultiply:!1}),o.demTexture.bind(B.NEAREST,B.CLAMP_TO_EDGE);R.activeTexture.set(B.TEXTURE0);let he=o.fbo;if(!he){const xe=new X(R,{width:H,height:H,data:null},B.RGBA);xe.bind(B.LINEAR,B.CLAMP_TO_EDGE),he=o.fbo=R.createFramebuffer(H,H,!0,!1),he.colorAttachment.set(xe.texture)}R.bindFramebuffer.set(he.framebuffer),R.viewport.set([0,0,H,H]),E.useProgram("hillshadePrepare").draw(R,B.TRIANGLES,y,x,S,$r.disabled,((xe,be)=>{const Ce=be.stride,Ie=a.H();return a.aP(Ie,0,a.X,-a.X,0,0,1),a.J(Ie,Ie,[0,-a.X,0]),{u_matrix:Ie,u_image:1,u_dimension:[Ce,Ce],u_zoom:xe.overscaledZ,u_unpack:be.getUnpackVector()}})(o.tileID,F),null,f.id,E.rasterBoundsBuffer,E.quadTriangleIndexBuffer,E.rasterBoundsSegments),o.needsHillshadePrepare=!1}}function gg(E,o,f,y,x,S){const R=y.paint.get("raster-fade-duration");if(!S&&R>0){const B=v.now(),F=(B-E.timeAdded)/R,H=o?(B-o.timeAdded)/R:-1,Y=f.getSource(),J=x.coveringZoomLevel({tileSize:Y.tileSize,roundZoom:Y.roundZoom}),he=!o||Math.abs(o.tileID.overscaledZ-J)>Math.abs(E.tileID.overscaledZ-J),xe=he&&E.refreshedUponExpiration?1:a.ac(he?F:1-H,0,1);return E.refreshedUponExpiration&&F>=1&&(E.refreshedUponExpiration=!1),o?{opacity:1,mix:1-xe}:{opacity:xe,mix:0}}return{opacity:1,mix:0}}const of=new a.aM(1,0,0,1),Dr=new a.aM(0,1,0,1),Hc=new a.aM(0,0,1,1),kx=new a.aM(1,0,1,1),vg=new a.aM(0,1,1,1);function Qo(E,o,f,y){Gc(E,0,o+f/2,E.transform.width,f,y)}function yg(E,o,f,y){Gc(E,o-f/2,0,f,E.transform.height,y)}function Gc(E,o,f,y,x,S){const R=E.context,B=R.gl;B.enable(B.SCISSOR_TEST),B.scissor(o*E.pixelRatio,f*E.pixelRatio,y*E.pixelRatio,x*E.pixelRatio),R.clear({color:S}),B.disable(B.SCISSOR_TEST)}function xg(E,o,f){const y=E.context,x=y.gl,S=f.posMatrix,R=E.useProgram("debug"),B=wr.disabled,F=Zr.disabled,H=E.colorModeForRenderPass(),Y="$debug",J=E.style.map.terrain&&E.style.map.terrain.getTerrainData(f);y.activeTexture.set(x.TEXTURE0);const he=o.getTileByID(f.key).latestRawTileData,xe=Math.floor((he&&he.byteLength||0)/1024),be=o.getTile(f).tileSize,Ce=512/Math.min(be,512)*(f.overscaledZ/E.transform.zoom)*.5;let Ie=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(Ie+=` => ${f.overscaledZ}`),function(Ae,ze){Ae.initDebugOverlayCanvas();const Ee=Ae.debugOverlayCanvas,Fe=Ae.context.gl,qe=Ae.debugOverlayCanvas.getContext("2d");qe.clearRect(0,0,Ee.width,Ee.height),qe.shadowColor="white",qe.shadowBlur=2,qe.lineWidth=1.5,qe.strokeStyle="white",qe.textBaseline="top",qe.font="bold 36px Open Sans, sans-serif",qe.fillText(ze,5,5),qe.strokeText(ze,5,5),Ae.debugOverlayTexture.update(Ee),Ae.debugOverlayTexture.bind(Fe.LINEAR,Fe.CLAMP_TO_EDGE)}(E,`${Ie} ${xe}kB`),R.draw(y,x.TRIANGLES,B,F,gn.alphaBlended,$r.disabled,vu(S,a.aM.transparent,Ce),null,Y,E.debugBuffer,E.quadTriangleIndexBuffer,E.debugSegments),R.draw(y,x.LINE_STRIP,B,F,H,$r.disabled,vu(S,a.aM.red),J,Y,E.debugBuffer,E.tileBorderIndexBuffer,E.debugSegments)}function _g(E,o,f){const y=E.context,x=y.gl,S=E.colorModeForRenderPass(),R=new wr(x.LEQUAL,wr.ReadWrite,E.depthRangeFor3D),B=E.useProgram("terrain"),F=o.getTerrainMesh();y.bindFramebuffer.set(null),y.viewport.set([0,0,E.width,E.height]);for(const H of f){const Y=E.renderToTexture.getTexture(H),J=o.getTerrainData(H.tileID);y.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,Y.texture);const he=E.transform.calculatePosMatrix(H.tileID.toUnwrapped()),xe=o.getMeshFrameDelta(E.transform.zoom),be=E.transform.calculateFogMatrix(H.tileID.toUnwrapped()),Ce=Ud(he,xe,be,E.style.sky,E.transform.pitch);B.draw(y,x.TRIANGLES,R,Zr.disabled,S,$r.backCCW,Ce,J,"terrain",F.vertexBuffer,F.indexBuffer,F.segments)}}class Wc{constructor(o,f,y){this.vertexBuffer=o,this.indexBuffer=f,this.segments=y}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class Zc{constructor(o,f){this.context=new Cx(o),this.transform=f,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ue.maxUnderzooming+Ue.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Mc}resize(o,f,y){if(this.width=Math.floor(o*y),this.height=Math.floor(f*y),this.pixelRatio=y,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const x of this.style._order)this.style._layers[x].resize()}setup(){const o=this.context,f=new a.aX;f.emplaceBack(0,0),f.emplaceBack(a.X,0),f.emplaceBack(0,a.X),f.emplaceBack(a.X,a.X),this.tileExtentBuffer=o.createVertexBuffer(f,no.members),this.tileExtentSegments=a.a0.simpleSegment(0,0,4,2);const y=new a.aX;y.emplaceBack(0,0),y.emplaceBack(a.X,0),y.emplaceBack(0,a.X),y.emplaceBack(a.X,a.X),this.debugBuffer=o.createVertexBuffer(y,no.members),this.debugSegments=a.a0.simpleSegment(0,0,4,5);const x=new a.$;x.emplaceBack(0,0,0,0),x.emplaceBack(a.X,0,a.X,0),x.emplaceBack(0,a.X,0,a.X),x.emplaceBack(a.X,a.X,a.X,a.X),this.rasterBoundsBuffer=o.createVertexBuffer(x,$t.members),this.rasterBoundsSegments=a.a0.simpleSegment(0,0,4,2);const S=new a.aX;S.emplaceBack(0,0),S.emplaceBack(1,0),S.emplaceBack(0,1),S.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(S,no.members),this.viewportSegments=a.a0.simpleSegment(0,0,4,2);const R=new a.aZ;R.emplaceBack(0),R.emplaceBack(1),R.emplaceBack(3),R.emplaceBack(2),R.emplaceBack(0),this.tileBorderIndexBuffer=o.createIndexBuffer(R);const B=new a.aY;B.emplaceBack(0,1,2),B.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(B);const F=this.context.gl;this.stencilClearMode=new Zr({func:F.ALWAYS,mask:0},0,255,F.ZERO,F.ZERO,F.ZERO)}clearStencil(){const o=this.context,f=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const y=a.H();a.aP(y,0,this.width,this.height,0,0,1),a.K(y,y,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(o,f.TRIANGLES,wr.disabled,this.stencilClearMode,gn.disabled,$r.disabled,Ii(y),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(o,f){if(this.currentStencilSource===o.source||!o.isTileClipped()||!f||!f.length)return;this.currentStencilSource=o.source;const y=this.context,x=y.gl;this.nextStencilID+f.length>256&&this.clearStencil(),y.setColorMode(gn.disabled),y.setDepthMode(wr.disabled);const S=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const R of f){const B=this._tileClippingMaskIDs[R.key]=this.nextStencilID++,F=this.style.map.terrain&&this.style.map.terrain.getTerrainData(R);S.draw(y,x.TRIANGLES,wr.disabled,new Zr({func:x.ALWAYS,mask:0},B,255,x.KEEP,x.KEEP,x.REPLACE),gn.disabled,$r.disabled,Ii(R.posMatrix),F,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,f=this.context.gl;return new Zr({func:f.NOTEQUAL,mask:255},o,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(o){const f=this.context.gl;return new Zr({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,f.KEEP,f.KEEP,f.REPLACE)}stencilConfigForOverlap(o){const f=this.context.gl,y=o.sort((R,B)=>B.overscaledZ-R.overscaledZ),x=y[y.length-1].overscaledZ,S=y[0].overscaledZ-x+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();const R={};for(let B=0;B<S;B++)R[B+x]=new Zr({func:f.GEQUAL,mask:255},B+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=S,[R,y]}return[{[x]:Zr.disabled},y]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new gn([o.CONSTANT_COLOR,o.ONE],new a.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?gn.unblended:gn.alphaBlended}depthModeForSublayer(o,f,y){if(!this.opaquePassEnabledForLayer())return wr.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new wr(y||this.context.gl.LEQUAL,f,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,f){this.style=o,this.options=f,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(v.now()),this.imageManager.beginFrame();const y=this.style._order,x=this.style.sourceCaches,S={},R={},B={};for(const F in x){const H=x[F];H.used&&H.prepare(this.context),S[F]=H.getVisibleCoordinates(),R[F]=S[F].slice().reverse(),B[F]=H.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let F=0;F<y.length;F++)if(this.style._layers[y[F]].is3D()){this.opaquePassCutoff=F;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const F of y){const H=this.style._layers[F];if(!H.hasOffscreenPass()||H.isHidden(this.transform.zoom))continue;const Y=R[H.source];(H.type==="custom"||Y.length)&&this.renderLayer(this,x[H.source],H,Y)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?a.aM.black:a.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(F,H){const Y=F.context,J=Y.gl,he=((Ae,ze,Ee)=>({u_sky_color:Ae.properties.get("sky-color"),u_horizon_color:Ae.properties.get("horizon-color"),u_horizon:(ze.height/2+ze.getHorizon())*Ee,u_sky_horizon_blend:Ae.properties.get("sky-horizon-blend")*ze.height/2*Ee}))(H,F.style.map.transform,F.pixelRatio),xe=new wr(J.LEQUAL,wr.ReadWrite,[0,1]),be=Zr.disabled,Ce=F.colorModeForRenderPass(),Ie=F.useProgram("sky");if(!H.mesh){const Ae=new a.aX;Ae.emplaceBack(-1,-1),Ae.emplaceBack(1,-1),Ae.emplaceBack(1,1),Ae.emplaceBack(-1,1);const ze=new a.aY;ze.emplaceBack(0,1,2),ze.emplaceBack(0,2,3),H.mesh=new Wc(Y.createVertexBuffer(Ae,no.members),Y.createIndexBuffer(ze),a.a0.simpleSegment(0,0,Ae.length,ze.length))}Ie.draw(Y,J.TRIANGLES,xe,be,Ce,$r.disabled,he,void 0,"sky",H.mesh.vertexBuffer,H.mesh.indexBuffer,H.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(o._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){const F=this.style._layers[y[this.currentLayer]],H=x[F.source],Y=S[F.source];this._renderTileClippingMasks(F,Y),this.renderLayer(this,H,F,Y)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){const F=this.style._layers[y[this.currentLayer]],H=x[F.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(F))continue;const Y=(F.type==="symbol"?B:R)[F.source];this._renderTileClippingMasks(F,S[F.source]),this.renderLayer(this,H,F,Y)}if(this.options.showTileBoundaries){const F=function(H,Y){let J=null;const he=Object.values(H._layers).flatMap(Ie=>Ie.source&&!Ie.isHidden(Y)?[H.sourceCaches[Ie.source]]:[]),xe=he.filter(Ie=>Ie.getSource().type==="vector"),be=he.filter(Ie=>Ie.getSource().type!=="vector"),Ce=Ie=>{(!J||J.getSource().maxzoom<Ie.getSource().maxzoom)&&(J=Ie)};return xe.forEach(Ie=>Ce(Ie)),J||be.forEach(Ie=>Ce(Ie)),J}(this.style,this.transform.zoom);F&&function(H,Y,J){for(let he=0;he<J.length;he++)xg(H,Y,J[he])}(this,F,F.getVisibleCoordinates())}this.options.showPadding&&function(F){const H=F.transform.padding;Qo(F,F.transform.height-(H.top||0),3,of),Qo(F,H.bottom||0,3,Dr),yg(F,H.left||0,3,Hc),yg(F,F.transform.width-(H.right||0),3,kx);const Y=F.transform.centerPoint;(function(J,he,xe,be){Gc(J,he-1,xe-10,2,20,be),Gc(J,he-10,xe-1,20,2,be)})(F,Y.x,F.transform.height-Y.y,vg)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(o){if(!this.style||!this.style.map||!this.style.map.terrain)return;const f=this.terrainFacilitator.matrix,y=this.transform.modelViewProjectionMatrix;let x=this.terrainFacilitator.dirty;x||(x=o?!a.a_(f,y):!a.a$(f,y)),x||(x=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),x&&(a.b0(f,y),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(S,R){const B=S.context,F=B.gl,H=gn.unblended,Y=new wr(F.LEQUAL,wr.ReadWrite,[0,1]),J=R.getTerrainMesh(),he=R.sourceCache.getRenderableTiles(),xe=S.useProgram("terrainDepth");B.bindFramebuffer.set(R.getFramebuffer("depth").framebuffer),B.viewport.set([0,0,S.width/devicePixelRatio,S.height/devicePixelRatio]),B.clear({color:a.aM.transparent,depth:1});for(const be of he){const Ce=R.getTerrainData(be.tileID),Ie={u_matrix:S.transform.calculatePosMatrix(be.tileID.toUnwrapped()),u_ele_delta:R.getMeshFrameDelta(S.transform.zoom)};xe.draw(B,F.TRIANGLES,Y,Zr.disabled,H,$r.backCCW,Ie,Ce,"terrain",J.vertexBuffer,J.indexBuffer,J.segments)}B.bindFramebuffer.set(null),B.viewport.set([0,0,S.width,S.height])}(this,this.style.map.terrain),function(S,R){const B=S.context,F=B.gl,H=gn.unblended,Y=new wr(F.LEQUAL,wr.ReadWrite,[0,1]),J=R.getTerrainMesh(),he=R.getCoordsTexture(),xe=R.sourceCache.getRenderableTiles(),be=S.useProgram("terrainCoords");B.bindFramebuffer.set(R.getFramebuffer("coords").framebuffer),B.viewport.set([0,0,S.width/devicePixelRatio,S.height/devicePixelRatio]),B.clear({color:a.aM.transparent,depth:1}),R.coordsIndex=[];for(const Ce of xe){const Ie=R.getTerrainData(Ce.tileID);B.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,he.texture);const Ae={u_matrix:S.transform.calculatePosMatrix(Ce.tileID.toUnwrapped()),u_terrain_coords_id:(255-R.coordsIndex.length)/255,u_texture:0,u_ele_delta:R.getMeshFrameDelta(S.transform.zoom)};be.draw(B,F.TRIANGLES,Y,Zr.disabled,H,$r.backCCW,Ae,Ie,"terrain",J.vertexBuffer,J.indexBuffer,J.segments),R.coordsIndex.push(Ce.tileID.key)}B.bindFramebuffer.set(null),B.viewport.set([0,0,S.width,S.height])}(this,this.style.map.terrain))}renderLayer(o,f,y,x){if(!y.isHidden(this.transform.zoom)&&(y.type==="background"||y.type==="custom"||(x||[]).length))switch(this.id=y.id,y.type){case"symbol":(function(S,R,B,F,H){if(S.renderPass!=="translucent")return;const Y=Zr.disabled,J=S.colorModeForRenderPass();(B._unevaluatedLayout.hasValue("text-variable-anchor")||B._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(he,xe,be,Ce,Ie,Ae,ze,Ee,Fe){const qe=xe.transform,Ke=qi(),ct=Ie==="map",_t=Ae==="map";for(const It of he){const zt=Ce.getTile(It),Et=zt.getBucket(be);if(!Et||!Et.text||!Et.text.segments.get().length)continue;const St=a.ag(Et.textSizeData,qe.zoom),Wt=fr(zt,1,xe.transform.zoom),hr=Lt(It.posMatrix,_t,ct,xe.transform,Wt),kt=be.layout.get("icon-text-fit")!=="none"&&Et.hasIconData();if(St){const Dt=Math.pow(2,qe.zoom-zt.tileID.overscaledZ),ur=xe.style.map.terrain?(yr,Sr)=>xe.style.map.terrain.getElevation(It,yr,Sr):null,Jr=Ke.translatePosition(qe,zt,ze,Ee);Xo(Et,ct,_t,Fe,qe,hr,It.posMatrix,Dt,St,kt,Ke,Jr,It.toUnwrapped(),ur)}}}(F,S,B,R,B.layout.get("text-rotation-alignment"),B.layout.get("text-pitch-alignment"),B.paint.get("text-translate"),B.paint.get("text-translate-anchor"),H),B.paint.get("icon-opacity").constantOr(1)!==0&&nf(S,R,B,F,!1,B.paint.get("icon-translate"),B.paint.get("icon-translate-anchor"),B.layout.get("icon-rotation-alignment"),B.layout.get("icon-pitch-alignment"),B.layout.get("icon-keep-upright"),Y,J),B.paint.get("text-opacity").constantOr(1)!==0&&nf(S,R,B,F,!0,B.paint.get("text-translate"),B.paint.get("text-translate-anchor"),B.layout.get("text-rotation-alignment"),B.layout.get("text-pitch-alignment"),B.layout.get("text-keep-upright"),Y,J),R.map.showCollisionBoxes&&(_u(S,R,B,F,!0),_u(S,R,B,F,!1))})(o,f,y,x,this.style.placement.variableOffsets);break;case"circle":(function(S,R,B,F){if(S.renderPass!=="translucent")return;const H=B.paint.get("circle-opacity"),Y=B.paint.get("circle-stroke-width"),J=B.paint.get("circle-stroke-opacity"),he=!B.layout.get("circle-sort-key").isConstant();if(H.constantOr(1)===0&&(Y.constantOr(1)===0||J.constantOr(1)===0))return;const xe=S.context,be=xe.gl,Ce=S.depthModeForSublayer(0,wr.ReadOnly),Ie=Zr.disabled,Ae=S.colorModeForRenderPass(),ze=[];for(let Ee=0;Ee<F.length;Ee++){const Fe=F[Ee],qe=R.getTile(Fe),Ke=qe.getBucket(B);if(!Ke)continue;const ct=Ke.programConfigurations.get(B.id),_t=S.useProgram("circle",ct),It=Ke.layoutVertexBuffer,zt=Ke.indexBuffer,Et=S.style.map.terrain&&S.style.map.terrain.getTerrainData(Fe),St={programConfiguration:ct,program:_t,layoutVertexBuffer:It,indexBuffer:zt,uniformValues:fx(S,Fe,qe,B),terrainData:Et};if(he){const Wt=Ke.segments.get();for(const hr of Wt)ze.push({segments:new a.a0([hr]),sortKey:hr.sortKey,state:St})}else ze.push({segments:Ke.segments,sortKey:0,state:St})}he&&ze.sort((Ee,Fe)=>Ee.sortKey-Fe.sortKey);for(const Ee of ze){const{programConfiguration:Fe,program:qe,layoutVertexBuffer:Ke,indexBuffer:ct,uniformValues:_t,terrainData:It}=Ee.state;qe.draw(xe,be.TRIANGLES,Ce,Ie,Ae,$r.disabled,_t,It,B.id,Ke,ct,Ee.segments,B.paint,S.transform.zoom,Fe)}})(o,f,y,x);break;case"heatmap":(function(S,R,B,F){if(B.paint.get("heatmap-opacity")===0)return;const H=S.context;if(S.style.map.terrain){for(const Y of F){const J=R.getTile(Y);R.hasRenderableParent(Y)||(S.renderPass==="offscreen"?sf(S,J,B,Y):S.renderPass==="translucent"&&co(S,B,Y))}H.viewport.set([0,0,S.width,S.height])}else S.renderPass==="offscreen"?function(Y,J,he,xe){const be=Y.context,Ce=be.gl,Ie=Zr.disabled,Ae=new gn([Ce.ONE,Ce.ONE],a.aM.transparent,[!0,!0,!0,!0]);(function(ze,Ee,Fe){const qe=ze.gl;ze.activeTexture.set(qe.TEXTURE1),ze.viewport.set([0,0,Ee.width/4,Ee.height/4]);let Ke=Fe.heatmapFbos.get(a.aU);Ke?(qe.bindTexture(qe.TEXTURE_2D,Ke.colorAttachment.get()),ze.bindFramebuffer.set(Ke.framebuffer)):(Ke=bu(ze,Ee.width/4,Ee.height/4),Fe.heatmapFbos.set(a.aU,Ke))})(be,Y,he),be.clear({color:a.aM.transparent});for(let ze=0;ze<xe.length;ze++){const Ee=xe[ze];if(J.hasRenderableParent(Ee))continue;const Fe=J.getTile(Ee),qe=Fe.getBucket(he);if(!qe)continue;const Ke=qe.programConfigurations.get(he.id),ct=Y.useProgram("heatmap",Ke),{zoom:_t}=Y.transform;ct.draw(be,Ce.TRIANGLES,wr.disabled,Ie,Ae,$r.disabled,Ai(Ee.posMatrix,Fe,_t,he.paint.get("heatmap-intensity")),null,he.id,qe.layoutVertexBuffer,qe.indexBuffer,qe.segments,he.paint,Y.transform.zoom,Ke)}be.viewport.set([0,0,Y.width,Y.height])}(S,R,B,F):S.renderPass==="translucent"&&function(Y,J){const he=Y.context,xe=he.gl;he.setColorMode(Y.colorModeForRenderPass());const be=J.heatmapFbos.get(a.aU);be&&(he.activeTexture.set(xe.TEXTURE0),xe.bindTexture(xe.TEXTURE_2D,be.colorAttachment.get()),he.activeTexture.set(xe.TEXTURE1),Su(he,J).bind(xe.LINEAR,xe.CLAMP_TO_EDGE),Y.useProgram("heatmapTexture").draw(he,xe.TRIANGLES,wr.disabled,Zr.disabled,Y.colorModeForRenderPass(),$r.disabled,Rc(Y,J,0,1),null,J.id,Y.viewportBuffer,Y.quadTriangleIndexBuffer,Y.viewportSegments,J.paint,Y.transform.zoom))}(S,B)})(o,f,y,x);break;case"line":(function(S,R,B,F){if(S.renderPass!=="translucent")return;const H=B.paint.get("line-opacity"),Y=B.paint.get("line-width");if(H.constantOr(1)===0||Y.constantOr(1)===0)return;const J=S.depthModeForSublayer(0,wr.ReadOnly),he=S.colorModeForRenderPass(),xe=B.paint.get("line-dasharray"),be=B.paint.get("line-pattern"),Ce=be.constantOr(1),Ie=B.paint.get("line-gradient"),Ae=B.getCrossfadeParameters(),ze=Ce?"linePattern":xe?"lineSDF":Ie?"lineGradient":"line",Ee=S.context,Fe=Ee.gl;let qe=!0;for(const Ke of F){const ct=R.getTile(Ke);if(Ce&&!ct.patternsLoaded())continue;const _t=ct.getBucket(B);if(!_t)continue;const It=_t.programConfigurations.get(B.id),zt=S.context.program.get(),Et=S.useProgram(ze,It),St=qe||Et.program!==zt,Wt=S.style.map.terrain&&S.style.map.terrain.getTerrainData(Ke),hr=be.constantOr(null);if(hr&&ct.imageAtlas){const ur=ct.imageAtlas,Jr=ur.patternPositions[hr.to.toString()],yr=ur.patternPositions[hr.from.toString()];Jr&&yr&&It.setConstantPatternPositions(Jr,yr)}const kt=Wt?Ke:null,Dt=Ce?Wo(S,ct,B,Ae,kt):xe?px(S,ct,B,xe,Ae,kt):Ie?eg(S,ct,B,_t.lineClipsArray.length,kt):Bc(S,ct,B,kt);if(Ce)Ee.activeTexture.set(Fe.TEXTURE0),ct.imageAtlasTexture.bind(Fe.LINEAR,Fe.CLAMP_TO_EDGE),It.updatePaintBuffers(Ae);else if(xe&&(St||S.lineAtlas.dirty))Ee.activeTexture.set(Fe.TEXTURE0),S.lineAtlas.bind(Ee);else if(Ie){const ur=_t.gradients[B.id];let Jr=ur.texture;if(B.gradientVersion!==ur.version){let yr=256;if(B.stepInterpolant){const Sr=R.getSource().maxzoom,Qr=Ke.canonical.z===Sr?Math.ceil(1<<S.transform.maxZoom-Ke.canonical.z):1;yr=a.ac(a.aV(_t.maxLineLength/a.X*1024*Qr),256,Ee.maxTextureSize)}ur.gradient=a.aW({expression:B.gradientExpression(),evaluationKey:"lineProgress",resolution:yr,image:ur.gradient||void 0,clips:_t.lineClipsArray}),ur.texture?ur.texture.update(ur.gradient):ur.texture=new X(Ee,ur.gradient,Fe.RGBA),ur.version=B.gradientVersion,Jr=ur.texture}Ee.activeTexture.set(Fe.TEXTURE0),Jr.bind(B.stepInterpolant?Fe.NEAREST:Fe.LINEAR,Fe.CLAMP_TO_EDGE)}Et.draw(Ee,Fe.TRIANGLES,J,S.stencilModeForClipping(Ke),he,$r.disabled,Dt,Wt,B.id,_t.layoutVertexBuffer,_t.indexBuffer,_t.segments,B.paint,S.transform.zoom,It,_t.layoutVertexBuffer2),qe=!1}})(o,f,y,x);break;case"fill":(function(S,R,B,F){const H=B.paint.get("fill-color"),Y=B.paint.get("fill-opacity");if(Y.constantOr(1)===0)return;const J=S.colorModeForRenderPass(),he=B.paint.get("fill-pattern"),xe=S.opaquePassEnabledForLayer()&&!he.constantOr(1)&&H.constantOr(a.aM.transparent).a===1&&Y.constantOr(0)===1?"opaque":"translucent";if(S.renderPass===xe){const be=S.depthModeForSublayer(1,S.renderPass==="opaque"?wr.ReadWrite:wr.ReadOnly);Eu(S,R,B,F,be,J,!1)}if(S.renderPass==="translucent"&&B.paint.get("fill-antialias")){const be=S.depthModeForSublayer(B.getPaintProperty("fill-outline-color")?2:0,wr.ReadOnly);Eu(S,R,B,F,be,J,!0)}})(o,f,y,x);break;case"fill-extrusion":(function(S,R,B,F){const H=B.paint.get("fill-extrusion-opacity");if(H!==0&&S.renderPass==="translucent"){const Y=new wr(S.context.gl.LEQUAL,wr.ReadWrite,S.depthRangeFor3D);if(H!==1||B.paint.get("fill-extrusion-pattern").constantOr(1))qc(S,R,B,F,Y,Zr.disabled,gn.disabled),qc(S,R,B,F,Y,S.stencilModeFor3D(),S.colorModeForRenderPass());else{const J=S.colorModeForRenderPass();qc(S,R,B,F,Y,Zr.disabled,J)}}})(o,f,y,x);break;case"hillshade":(function(S,R,B,F){if(S.renderPass!=="offscreen"&&S.renderPass!=="translucent")return;const H=S.context,Y=S.depthModeForSublayer(0,wr.ReadOnly),J=S.colorModeForRenderPass(),[he,xe]=S.renderPass==="translucent"?S.stencilConfigForOverlap(F):[{},F];for(const be of xe){const Ce=R.getTile(be);Ce.needsHillshadePrepare!==void 0&&Ce.needsHillshadePrepare&&S.renderPass==="offscreen"?Jo(S,Ce,B,Y,Zr.disabled,J):S.renderPass==="translucent"&&Yo(S,be,Ce,B,Y,he[be.overscaledZ],J)}H.viewport.set([0,0,S.width,S.height])})(o,f,y,x);break;case"raster":(function(S,R,B,F){if(S.renderPass!=="translucent"||B.paint.get("raster-opacity")===0||!F.length)return;const H=S.context,Y=H.gl,J=R.getSource(),he=S.useProgram("raster"),xe=S.colorModeForRenderPass(),[be,Ce]=J instanceof er?[{},F]:S.stencilConfigForOverlap(F),Ie=Ce[Ce.length-1].overscaledZ,Ae=!S.options.moving;for(const ze of Ce){const Ee=S.depthModeForSublayer(ze.overscaledZ-Ie,B.paint.get("raster-opacity")===1?wr.ReadWrite:wr.ReadOnly,Y.LESS),Fe=R.getTile(ze);Fe.registerFadeDuration(B.paint.get("raster-fade-duration"));const qe=R.findLoadedParent(ze,0),Ke=R.findLoadedSibling(ze),ct=gg(Fe,qe||Ke||null,R,B,S.transform,S.style.map.terrain);let _t,It;const zt=B.paint.get("raster-resampling")==="nearest"?Y.NEAREST:Y.LINEAR;H.activeTexture.set(Y.TEXTURE0),Fe.texture.bind(zt,Y.CLAMP_TO_EDGE,Y.LINEAR_MIPMAP_NEAREST),H.activeTexture.set(Y.TEXTURE1),qe?(qe.texture.bind(zt,Y.CLAMP_TO_EDGE,Y.LINEAR_MIPMAP_NEAREST),_t=Math.pow(2,qe.tileID.overscaledZ-Fe.tileID.overscaledZ),It=[Fe.tileID.canonical.x*_t%1,Fe.tileID.canonical.y*_t%1]):Fe.texture.bind(zt,Y.CLAMP_TO_EDGE,Y.LINEAR_MIPMAP_NEAREST),Fe.texture.useMipmap&&H.extTextureFilterAnisotropic&&S.transform.pitch>20&&Y.texParameterf(Y.TEXTURE_2D,H.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,H.extTextureFilterAnisotropicMax);const Et=S.style.map.terrain&&S.style.map.terrain.getTerrainData(ze),St=Et?ze:null,Wt=St?St.posMatrix:S.transform.calculatePosMatrix(ze.toUnwrapped(),Ae),hr=mx(Wt,It||[0,0],_t||1,ct,B);J instanceof er?he.draw(H,Y.TRIANGLES,Ee,Zr.disabled,xe,$r.disabled,hr,Et,B.id,J.boundsBuffer,S.quadTriangleIndexBuffer,J.boundsSegments):he.draw(H,Y.TRIANGLES,Ee,be[ze.overscaledZ],xe,$r.disabled,hr,Et,B.id,S.rasterBoundsBuffer,S.quadTriangleIndexBuffer,S.rasterBoundsSegments)}})(o,f,y,x);break;case"background":(function(S,R,B,F){const H=B.paint.get("background-color"),Y=B.paint.get("background-opacity");if(Y===0)return;const J=S.context,he=J.gl,xe=S.transform,be=xe.tileSize,Ce=B.paint.get("background-pattern");if(S.isPatternMissing(Ce))return;const Ie=!Ce&&H.a===1&&Y===1&&S.opaquePassEnabledForLayer()?"opaque":"translucent";if(S.renderPass!==Ie)return;const Ae=Zr.disabled,ze=S.depthModeForSublayer(0,Ie==="opaque"?wr.ReadWrite:wr.ReadOnly),Ee=S.colorModeForRenderPass(),Fe=S.useProgram(Ce?"backgroundPattern":"background"),qe=F||xe.coveringTiles({tileSize:be,terrain:S.style.map.terrain});Ce&&(J.activeTexture.set(he.TEXTURE0),S.imageManager.bind(S.context));const Ke=B.getCrossfadeParameters();for(const ct of qe){const _t=F?ct.posMatrix:S.transform.calculatePosMatrix(ct.toUnwrapped()),It=Ce?Gd(_t,Y,S,Ce,{tileID:ct,tileSize:be},Ke):Oc(_t,Y,H),zt=S.style.map.terrain&&S.style.map.terrain.getTerrainData(ct);Fe.draw(J,he.TRIANGLES,ze,Ae,Ee,$r.disabled,It,zt,B.id,S.tileExtentBuffer,S.quadTriangleIndexBuffer,S.tileExtentSegments)}})(o,0,y,x);break;case"custom":(function(S,R,B){const F=S.context,H=B.implementation;if(S.renderPass==="offscreen"){const Y=H.prerender;Y&&(S.setCustomLayerDefaults(),F.setColorMode(S.colorModeForRenderPass()),Y.call(H,F.gl,S.transform.customLayerMatrix()),F.setDirty(),S.setBaseState())}else if(S.renderPass==="translucent"){S.setCustomLayerDefaults(),F.setColorMode(S.colorModeForRenderPass()),F.setStencilMode(Zr.disabled);const Y=H.renderingMode==="3d"?new wr(S.context.gl.LEQUAL,wr.ReadWrite,S.depthRangeFor3D):S.depthModeForSublayer(0,wr.ReadOnly);F.setDepthMode(Y),H.render(F.gl,S.transform.customLayerMatrix(),{farZ:S.transform.farZ,nearZ:S.transform.nearZ,fov:S.transform._fov,modelViewProjectionMatrix:S.transform.modelViewProjectionMatrix,projectionMatrix:S.transform.projectionMatrix}),F.setDirty(),S.setBaseState(),F.bindFramebuffer.set(null)}})(o,0,y)}}translatePosMatrix(o,f,y,x,S){if(!y[0]&&!y[1])return o;const R=S?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(R){const H=Math.sin(R),Y=Math.cos(R);y=[y[0]*Y-y[1]*H,y[0]*H+y[1]*Y]}const B=[S?y[0]:fr(f,y[0],this.transform.zoom),S?y[1]:fr(f,y[1],this.transform.zoom),0],F=new Float32Array(16);return a.J(F,o,B),F}saveTileTexture(o){const f=this._tileTextures[o.size[0]];f?f.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const f=this._tileTextures[o];return f&&f.length>0?f.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const f=this.imageManager.getPattern(o.from.toString()),y=this.imageManager.getPattern(o.to.toString());return!f||!y}useProgram(o,f){this.cache=this.cache||{};const y=o+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[y]||(this.cache[y]=new qd(this.context,Ds[o],f,Wd[o],this._showOverdrawInspector,this.style.map.terrain)),this.cache[y]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new X(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:o,drawingBufferHeight:f}=this.context.gl;return this.width!==o||this.height!==f}}class el{constructor(o,f){this.points=o,this.planes=f}static fromInvProjectionMatrix(o,f,y){const x=Math.pow(2,y),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(B=>{const F=1/(B=a.af([],B,o))[3]/f*x;return a.b1(B,B,[F,F,1/B[3],F])}),R=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(B=>{const F=function(he,xe){var be=xe[0],Ce=xe[1],Ie=xe[2],Ae=be*be+Ce*Ce+Ie*Ie;return Ae>0&&(Ae=1/Math.sqrt(Ae)),he[0]=xe[0]*Ae,he[1]=xe[1]*Ae,he[2]=xe[2]*Ae,he}([],function(he,xe,be){var Ce=xe[0],Ie=xe[1],Ae=xe[2],ze=be[0],Ee=be[1],Fe=be[2];return he[0]=Ie*Fe-Ae*Ee,he[1]=Ae*ze-Ce*Fe,he[2]=Ce*Ee-Ie*ze,he}([],$([],S[B[0]],S[B[1]]),$([],S[B[2]],S[B[1]]))),H=-((Y=F)[0]*(J=S[B[1]])[0]+Y[1]*J[1]+Y[2]*J[2]);var Y,J;return F.concat(H)});return new el(S,R)}}class tl{constructor(o,f){this.min=o,this.max=f,this.center=function(y,x,S){return y[0]=.5*x[0],y[1]=.5*x[1],y[2]=.5*x[2],y}([],function(y,x,S){return y[0]=x[0]+S[0],y[1]=x[1]+S[1],y[2]=x[2]+S[2],y}([],this.min,this.max))}quadrant(o){const f=[o%2==0,o<2],y=V(this.min),x=V(this.max);for(let S=0;S<f.length;S++)y[S]=f[S]?this.min[S]:this.center[S],x[S]=f[S]?this.center[S]:this.max[S];return x[2]=this.max[2],new tl(y,x)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}intersects(o){const f=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let y=!0;for(let x=0;x<o.planes.length;x++){const S=o.planes[x];let R=0;for(let B=0;B<f.length;B++)a.b2(S,f[B])>=0&&R++;if(R===0)return 0;R!==f.length&&(y=!1)}if(y)return 2;for(let x=0;x<3;x++){let S=Number.MAX_VALUE,R=-Number.MAX_VALUE;for(let B=0;B<o.points.length;B++){const F=o.points[B][x]-this.min[x];S=Math.min(S,F),R=Math.max(R,F)}if(R<0||S>this.max[x]-this.min[x])return 0}return 1}}class rl{constructor(o=0,f=0,y=0,x=0){if(isNaN(o)||o<0||isNaN(f)||f<0||isNaN(y)||y<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=f,this.left=y,this.right=x}interpolate(o,f,y){return f.top!=null&&o.top!=null&&(this.top=a.y.number(o.top,f.top,y)),f.bottom!=null&&o.bottom!=null&&(this.bottom=a.y.number(o.bottom,f.bottom,y)),f.left!=null&&o.left!=null&&(this.left=a.y.number(o.left,f.left,y)),f.right!=null&&o.right!=null&&(this.right=a.y.number(o.right,f.right,y)),this}getCenter(o,f){const y=a.ac((this.left+o-this.right)/2,0,o),x=a.ac((this.top+f-this.bottom)/2,0,f);return new a.P(y,x)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new rl(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const lf=85.051129;class nl{constructor(o,f,y,x,S){this.tileSize=512,this._renderWorldCopies=S===void 0||!!S,this._minZoom=o||0,this._maxZoom=f||22,this._minPitch=y??0,this._maxPitch=x??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new rl,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const o=new nl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return o.apply(this),o}apply(o){this.tileSize=o.tileSize,this.latRange=o.latRange,this.lngRange=o.lngRange,this.width=o.width,this.height=o.height,this._center=o._center,this._elevation=o._elevation,this.minElevationForCurrentTile=o.minElevationForCurrentTile,this.zoom=o.zoom,this.angle=o.angle,this._fov=o._fov,this._pitch=o._pitch,this._unmodified=o._unmodified,this._edgeInsets=o._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(o){const f=-a.b3(o,-180,180)*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=function(){var y=new a.A(4);return a.A!=Float32Array&&(y[1]=0,y[2]=0),y[0]=1,y[3]=1,y}(),function(y,x,S){var R=x[0],B=x[1],F=x[2],H=x[3],Y=Math.sin(S),J=Math.cos(S);y[0]=R*J+F*Y,y[1]=B*J+H*Y,y[2]=R*-Y+F*J,y[3]=B*-Y+H*J}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const f=a.ac(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(o){const f=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this.tileZoom=Math.max(0,Math.floor(f)),this.scale=this.zoomScale(f),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(o){o!==this._elevation&&(this._elevation=o,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,f,y){this._unmodified=!1,this._edgeInsets.interpolate(o,f,y),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const f=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,f)}getVisibleUnwrappedCoordinates(o){const f=[new a.b4(0,o)];if(this._renderWorldCopies){const y=this.pointCoordinate(new a.P(0,0)),x=this.pointCoordinate(new a.P(this.width,0)),S=this.pointCoordinate(new a.P(this.width,this.height)),R=this.pointCoordinate(new a.P(0,this.height)),B=Math.floor(Math.min(y.x,x.x,S.x,R.x)),F=Math.floor(Math.max(y.x,x.x,S.x,R.x)),H=1;for(let Y=B-H;Y<=F+H;Y++)Y!==0&&f.push(new a.b4(Y,o))}return f}coveringTiles(o){var f,y;let x=this.coveringZoomLevel(o);const S=x;if(o.minzoom!==void 0&&x<o.minzoom)return[];o.maxzoom!==void 0&&x>o.maxzoom&&(x=o.maxzoom);const R=this.pointCoordinate(this.getCameraPoint()),B=a.Z.fromLngLat(this.center),F=Math.pow(2,x),H=[F*R.x,F*R.y,0],Y=[F*B.x,F*B.y,0],J=el.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,x);let he=o.minzoom||0;!o.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(he=x);const xe=o.terrain?2/Math.min(this.tileSize,o.tileSize)*this.tileSize:3,be=Ee=>({aabb:new tl([Ee*F,0,0],[(Ee+1)*F,F,0]),zoom:0,x:0,y:0,wrap:Ee,fullyVisible:!1}),Ce=[],Ie=[],Ae=x,ze=o.reparseOverscaled?S:x;if(this._renderWorldCopies)for(let Ee=1;Ee<=3;Ee++)Ce.push(be(-Ee)),Ce.push(be(Ee));for(Ce.push(be(0));Ce.length>0;){const Ee=Ce.pop(),Fe=Ee.x,qe=Ee.y;let Ke=Ee.fullyVisible;if(!Ke){const Et=Ee.aabb.intersects(J);if(Et===0)continue;Ke=Et===2}const ct=o.terrain?H:Y,_t=Ee.aabb.distanceX(ct),It=Ee.aabb.distanceY(ct),zt=Math.max(Math.abs(_t),Math.abs(It));if(Ee.zoom===Ae||zt>xe+(1<<Ae-Ee.zoom)-2&&Ee.zoom>=he){const Et=Ae-Ee.zoom,St=H[0]-.5-(Fe<<Et),Wt=H[1]-.5-(qe<<Et);Ie.push({tileID:new a.S(Ee.zoom===Ae?ze:Ee.zoom,Ee.wrap,Ee.zoom,Fe,qe),distanceSq:G([Y[0]-.5-Fe,Y[1]-.5-qe]),tileDistanceToCamera:Math.sqrt(St*St+Wt*Wt)})}else for(let Et=0;Et<4;Et++){const St=(Fe<<1)+Et%2,Wt=(qe<<1)+(Et>>1),hr=Ee.zoom+1;let kt=Ee.aabb.quadrant(Et);if(o.terrain){const Dt=new a.S(hr,Ee.wrap,hr,St,Wt),ur=o.terrain.getMinMaxElevation(Dt),Jr=(f=ur.minElevation)!==null&&f!==void 0?f:this.elevation,yr=(y=ur.maxElevation)!==null&&y!==void 0?y:this.elevation;kt=new tl([kt.min[0],kt.min[1],Jr],[kt.max[0],kt.max[1],yr])}Ce.push({aabb:kt,zoom:hr,x:St,y:Wt,wrap:Ee.wrap,fullyVisible:Ke})}}return Ie.sort((Ee,Fe)=>Ee.distanceSq-Fe.distanceSq).map(Ee=>Ee.tileID)}resize(o,f){this.width=o,this.height=f,this.pixelsToGLUnits=[2/o,-2/f],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const f=a.ac(o.lat,-85.051129,lf);return new a.P(a.O(o.lng)*this.worldSize,a.Q(f)*this.worldSize)}unproject(o){return new a.Z(o.x/this.worldSize,o.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(o){const f=this.elevation,y=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,x=this.pointLocation(this.centerPoint,o),S=o.getElevationForLngLatZoom(x,this.tileZoom);if(!(this.elevation-S))return;const R=y+f-S,B=Math.cos(this._pitch)*this.cameraToCenterDistance/R/a.b5(1,x.lat),F=this.scaleZoom(B/this.tileSize);this._elevation=S,this._center=x,this.zoom=F}setLocationAtPoint(o,f){const y=this.pointCoordinate(f),x=this.pointCoordinate(this.centerPoint),S=this.locationCoordinate(o),R=new a.Z(S.x-(y.x-x.x),S.y-(y.y-x.y));this.center=this.coordinateLocation(R),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(o,f){return f?this.coordinatePoint(this.locationCoordinate(o),f.getElevationForLngLatZoom(o,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(o))}pointLocation(o,f){return this.coordinateLocation(this.pointCoordinate(o,f))}locationCoordinate(o){return a.Z.fromLngLat(o)}coordinateLocation(o){return o&&o.toLngLat()}pointCoordinate(o,f){if(f){const he=f.pointCoordinate(o);if(he!=null)return he}const y=[o.x,o.y,0,1],x=[o.x,o.y,1,1];a.af(y,y,this.pixelMatrixInverse),a.af(x,x,this.pixelMatrixInverse);const S=y[3],R=x[3],B=y[1]/S,F=x[1]/R,H=y[2]/S,Y=x[2]/R,J=H===Y?0:(0-H)/(Y-H);return new a.Z(a.y.number(y[0]/S,x[0]/R,J)/this.worldSize,a.y.number(B,F,J)/this.worldSize)}coordinatePoint(o,f=0,y=this.pixelMatrix){const x=[o.x*this.worldSize,o.y*this.worldSize,f,1];return a.af(x,x,y),new a.P(x[0]/x[3],x[1]/x[3])}getBounds(){const o=Math.max(0,this.height/2-this.getHorizon());return new $e().extend(this.pointLocation(new a.P(0,o))).extend(this.pointLocation(new a.P(this.width,o))).extend(this.pointLocation(new a.P(this.width,this.height))).extend(this.pointLocation(new a.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new $e([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(o){o?(this.lngRange=[o.getWest(),o.getEast()],this.latRange=[o.getSouth(),o.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,lf])}calculateTileMatrix(o){const f=o.canonical,y=this.worldSize/this.zoomScale(f.z),x=f.x+Math.pow(2,f.z)*o.wrap,S=a.an(new Float64Array(16));return a.J(S,S,[x*y,f.y*y,0]),a.K(S,S,[y/a.X,y/a.X,1]),S}calculatePosMatrix(o,f=!1){const y=o.key,x=f?this._alignedPosMatrixCache:this._posMatrixCache;if(x[y])return x[y];const S=this.calculateTileMatrix(o);return a.L(S,f?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,S),x[y]=new Float32Array(S),x[y]}calculateFogMatrix(o){const f=o.key,y=this._fogMatrixCache;if(y[f])return y[f];const x=this.calculateTileMatrix(o);return a.L(x,this.fogMatrix,x),y[f]=new Float32Array(x),y[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(o,f){f=a.ac(+f,this.minZoom,this.maxZoom);const y={center:new a.N(o.lng,o.lat),zoom:f};let x=this.lngRange;if(!this._renderWorldCopies&&x===null){const Ee=179.9999999999;x=[-Ee,Ee]}const S=this.tileSize*this.zoomScale(y.zoom);let R=0,B=S,F=0,H=S,Y=0,J=0;const{x:he,y:xe}=this.size;if(this.latRange){const Ee=this.latRange;R=a.Q(Ee[1])*S,B=a.Q(Ee[0])*S,B-R<xe&&(Y=xe/(B-R))}x&&(F=a.b3(a.O(x[0])*S,0,S),H=a.b3(a.O(x[1])*S,0,S),H<F&&(H+=S),H-F<he&&(J=he/(H-F)));const{x:be,y:Ce}=this.project.call({worldSize:S},o);let Ie,Ae;const ze=Math.max(J||0,Y||0);if(ze){const Ee=new a.P(J?(H+F)/2:be,Y?(B+R)/2:Ce);return y.center=this.unproject.call({worldSize:S},Ee).wrap(),y.zoom+=this.scaleZoom(ze),y}if(this.latRange){const Ee=xe/2;Ce-Ee<R&&(Ae=R+Ee),Ce+Ee>B&&(Ae=B-Ee)}if(x){const Ee=(F+H)/2;let Fe=be;this._renderWorldCopies&&(Fe=a.b3(be,Ee-S/2,Ee+S/2));const qe=he/2;Fe-qe<F&&(Ie=F+qe),Fe+qe>H&&(Ie=H-qe)}if(Ie!==void 0||Ae!==void 0){const Ee=new a.P(Ie??be,Ae??Ce);y.center=this.unproject.call({worldSize:S},Ee).wrap()}return y}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const o=this._unmodified,{center:f,zoom:y}=this.getConstrained(this.center,this.zoom);this.center=f,this.zoom=y,this._unmodified=o,this._constraining=!1}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,f=this.point.x,y=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=a.b5(1,this.center.lat)*this.worldSize;let x=a.an(new Float64Array(16));a.K(x,x,[this.width/2,-this.height/2,1]),a.J(x,x,[1,-1,0]),this.labelPlaneMatrix=x,x=a.an(new Float64Array(16)),a.K(x,x,[1,-1,1]),a.J(x,x,[-1,-1,0]),a.K(x,x,[2/this.width,2/this.height,1]),this.glCoordMatrix=x;const S=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),R=Math.min(this.elevation,this.minElevationForCurrentTile),B=S-R*this._pixelPerMeter/Math.cos(this._pitch),F=R<0?B:S,H=Math.PI/2+this._pitch,Y=this._fov*(.5+o.y/this.height),J=Math.sin(Y)*F/Math.sin(a.ac(Math.PI-H-Y,.01,Math.PI-.01)),he=this.getHorizon(),xe=2*Math.atan(he/this.cameraToCenterDistance)*(.5+o.y/(2*he)),be=Math.sin(xe)*F/Math.sin(a.ac(Math.PI-H-xe,.01,Math.PI-.01)),Ce=Math.min(J,be);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*Ce+F),this.nearZ=this.height/50,x=new Float64Array(16),a.b6(x,this._fov,this.width/this.height,this.nearZ,this.farZ),x[8]=2*-o.x/this.width,x[9]=2*o.y/this.height,this.projectionMatrix=a.ae(x),a.K(x,x,[1,-1,1]),a.J(x,x,[0,0,-this.cameraToCenterDistance]),a.b7(x,x,this._pitch),a.ad(x,x,this.angle),a.J(x,x,[-f,-y,0]),this.mercatorMatrix=a.K([],x,[this.worldSize,this.worldSize,this.worldSize]),a.K(x,x,[1,1,this._pixelPerMeter]),this.pixelMatrix=a.L(new Float64Array(16),this.labelPlaneMatrix,x),a.J(x,x,[0,0,-this.elevation]),this.modelViewProjectionMatrix=x,this.invModelViewProjectionMatrix=a.as([],x),this.fogMatrix=new Float64Array(16),a.b6(this.fogMatrix,this._fov,this.width/this.height,S,this.farZ),this.fogMatrix[8]=2*-o.x/this.width,this.fogMatrix[9]=2*o.y/this.height,a.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),a.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),a.b7(this.fogMatrix,this.fogMatrix,this._pitch),a.ad(this.fogMatrix,this.fogMatrix,this.angle),a.J(this.fogMatrix,this.fogMatrix,[-f,-y,0]),a.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),a.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=a.L(new Float64Array(16),this.labelPlaneMatrix,x);const Ie=this.width%2/2,Ae=this.height%2/2,ze=Math.cos(this.angle),Ee=Math.sin(this.angle),Fe=f-Math.round(f)+ze*Ie+Ee*Ae,qe=y-Math.round(y)+ze*Ae+Ee*Ie,Ke=new Float64Array(x);if(a.J(Ke,Ke,[Fe>.5?Fe-1:Fe,qe>.5?qe-1:qe,0]),this.alignedModelViewProjectionMatrix=Ke,x=a.as(new Float64Array(16),this.pixelMatrix),!x)throw new Error("failed to invert matrix");this.pixelMatrixInverse=x,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const o=this.pointCoordinate(new a.P(0,0)),f=[o.x*this.worldSize,o.y*this.worldSize,0,1];return a.af(f,f,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,o))}getCameraQueryGeometry(o){const f=this.getCameraPoint();if(o.length===1)return[o[0],f];{let y=f.x,x=f.y,S=f.x,R=f.y;for(const B of o)y=Math.min(y,B.x),x=Math.min(x,B.y),S=Math.max(S,B.x),R=Math.max(R,B.y);return[new a.P(y,x),new a.P(S,x),new a.P(S,R),new a.P(y,R),new a.P(y,x)]}}lngLatToCameraDepth(o,f){const y=this.locationCoordinate(o),x=[y.x*this.worldSize,y.y*this.worldSize,f,1];return a.af(x,x,this.modelViewProjectionMatrix),x[2]/x[3]}}function Tu(E,o){let f,y=!1,x=null,S=null;const R=()=>{x=null,y&&(E.apply(S,f),x=setTimeout(R,o),y=!1)};return(...B)=>(y=!0,S=this,f=B,x||R(),x)}class Xc{constructor(o){this._getCurrentHash=()=>{const f=window.location.hash.replace("#","");if(this._hashName){let y;return f.split("&").map(x=>x.split("=")).forEach(x=>{x[0]===this._hashName&&(y=x)}),(y&&y[1]||"").split("/")}return f.split("/")},this._onHashChange=()=>{const f=this._getCurrentHash();if(f.length>=3&&!f.some(y=>isNaN(y))){const y=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(f[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:y,pitch:+(f[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const f=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,f)},this._removeHash=()=>{const f=this._getCurrentHash();if(f.length===0)return;const y=f.join("/");let x=y;x.split("&").length>0&&(x=x.split("&")[0]),this._hashName&&(x=`${this._hashName}=${y}`);let S=window.location.hash.replace(x,"");S.startsWith("#&")?S=S.slice(0,1)+S.slice(2):S==="#"&&(S="");let R=window.location.href.replace(/(#.+)?$/,S);R=R.replace("&&","&"),window.history.replaceState(window.history.state,null,R)},this._updateHash=Tu(this._updateHashUnthrottled,300),this._hashName=o&&encodeURIComponent(o)}addTo(o){return this._map=o,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(o){const f=this._map.getCenter(),y=Math.round(100*this._map.getZoom())/100,x=Math.ceil((y*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,x),R=Math.round(f.lng*S)/S,B=Math.round(f.lat*S)/S,F=this._map.getBearing(),H=this._map.getPitch();let Y="";if(Y+=o?`/${R}/${B}/${y}`:`${y}/${B}/${R}`,(F||H)&&(Y+="/"+Math.round(10*F)/10),H&&(Y+=`/${Math.round(H)}`),this._hashName){const J=this._hashName;let he=!1;const xe=window.location.hash.slice(1).split("&").map(be=>{const Ce=be.split("=")[0];return Ce===J?(he=!0,`${Ce}=${Y}`):be}).filter(be=>be);return he||xe.push(`${J}=${Y}`),`#${xe.join("&")}`}return`#${Y}`}}const Kc={linearity:.3,easing:a.b8(0,0,.3,1)},uf=a.e({deceleration:2500,maxSpeed:1400},Kc),Px=a.e({deceleration:20,maxSpeed:1400},Kc),wg=a.e({deceleration:1e3,maxSpeed:360},Kc),Yc=a.e({deceleration:1e3,maxSpeed:90},Kc);class cf{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:v.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,f=v.now();for(;o.length>0&&f-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const f={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:S}of this._inertiaBuffer)f.zoom+=S.zoomDelta||0,f.bearing+=S.bearingDelta||0,f.pitch+=S.pitchDelta||0,S.panDelta&&f.pan._add(S.panDelta),S.around&&(f.around=S.around),S.pinchAround&&(f.pinchAround=S.pinchAround);const y=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(f.pan.mag()){const S=ku(f.pan.mag(),y,a.e({},uf,o||{}));x.offset=f.pan.mult(S.amount/f.pan.mag()),x.center=this._map.transform.center,Cu(x,S)}if(f.zoom){const S=ku(f.zoom,y,Px);x.zoom=this._map.transform.zoom+S.amount,Cu(x,S)}if(f.bearing){const S=ku(f.bearing,y,wg);x.bearing=this._map.transform.bearing+a.ac(S.amount,-179,179),Cu(x,S)}if(f.pitch){const S=ku(f.pitch,y,Yc);x.pitch=this._map.transform.pitch+S.amount,Cu(x,S)}if(x.zoom||x.bearing){const S=f.pinchAround===void 0?f.around:f.pinchAround;x.around=S?this._map.unproject(S):this._map.getCenter()}return this.clear(),a.e(x,{noMoveStart:!0})}}function Cu(E,o){(!E.duration||E.duration<o.duration)&&(E.duration=o.duration,E.easing=o.easing)}function ku(E,o,f){const{maxSpeed:y,linearity:x,deceleration:S}=f,R=a.ac(E*x/(o/1e3),-y,y),B=Math.abs(R)/(S*x);return{easing:f.easing,duration:1e3*B,amount:R*(B/2)}}class ri extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,f,y,x={}){const S=_.mousePos(f.getCanvas(),y),R=f.unproject(S);super(o,a.e({point:S,lngLat:R,originalEvent:y},x)),this._defaultPrevented=!1,this.target=f}}class ho extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,f,y){const x=o==="touchend"?y.changedTouches:y.touches,S=_.touchPos(f.getCanvasContainer(),x),R=S.map(F=>f.unproject(F)),B=S.reduce((F,H,Y,J)=>F.add(H.div(J.length)),new a.P(0,0));super(o,{points:S,point:B,lngLats:R,lngLat:f.unproject(B),originalEvent:y}),this._defaultPrevented=!1}}class bg extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,f,y){super(o,{originalEvent:y}),this._defaultPrevented=!1}}class Sg{constructor(o,f){this._map=o,this._clickTolerance=f.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new bg(o.type,this._map,o))}mousedown(o,f){return this._mousedownPos=f,this._firePreventable(new ri(o.type,this._map,o))}mouseup(o){this._map.fire(new ri(o.type,this._map,o))}click(o,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new ri(o.type,this._map,o))}dblclick(o){return this._firePreventable(new ri(o.type,this._map,o))}mouseover(o){this._map.fire(new ri(o.type,this._map,o))}mouseout(o){this._map.fire(new ri(o.type,this._map,o))}touchstart(o){return this._firePreventable(new ho(o.type,this._map,o))}touchmove(o){this._map.fire(new ho(o.type,this._map,o))}touchend(o){this._map.fire(new ho(o.type,this._map,o))}touchcancel(o){this._map.fire(new ho(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class vn{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(o){this._map.fire(new ri(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ri("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._ignoreContextMenu||this._map.fire(new ri(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Sa{constructor(o){this._map=o}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(o){return this.transform.pointLocation(a.P.convert(o),this._map.terrain)}}class Wi{constructor(o,f){this._map=o,this._tr=new Sa(o),this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,f){this.isEnabled()&&o.shiftKey&&o.button===0&&(_.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(o,f){if(!this._active)return;const y=f;if(this._lastPos.equals(y)||!this._box&&y.dist(this._startPos)<this._clickTolerance)return;const x=this._startPos;this._lastPos=y,this._box||(this._box=_.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",o));const S=Math.min(x.x,y.x),R=Math.max(x.x,y.x),B=Math.min(x.y,y.y),F=Math.max(x.y,y.y);_.setTransform(this._box,`translate(${S}px,${B}px)`),this._box.style.width=R-S+"px",this._box.style.height=F-B+"px"}mouseupWindow(o,f){if(!this._active||o.button!==0)return;const y=this._startPos,x=f;if(this.reset(),_.suppressClick(),y.x!==x.x||y.y!==x.y)return this._map.fire(new a.k("boxzoomend",{originalEvent:o})),{cameraAnimation:S=>S.fitScreenCoordinates(y,x,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(_.remove(this._box),this._box=null),_.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,f){return this._map.fire(new a.k(o,{originalEvent:f}))}}function Pu(E,o){if(E.length!==o.length)throw new Error(`The number of touches and points are not equal - touches ${E.length}, points ${o.length}`);const f={};for(let y=0;y<E.length;y++)f[E[y].identifier]=o[y];return f}class hf{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,f,y){(this.centroid||y.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=o.timeStamp),y.length===this.numTouches&&(this.centroid=function(x){const S=new a.P(0,0);for(const R of x)S._add(R);return S.div(x.length)}(f),this.touches=Pu(y,f)))}touchmove(o,f,y){if(this.aborted||!this.centroid)return;const x=Pu(y,f);for(const S in this.touches){const R=x[S];(!R||R.dist(this.touches[S])>30)&&(this.aborted=!0)}}touchend(o,f,y){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),y.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class Jc{constructor(o){this.singleTap=new hf(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,f,y){this.singleTap.touchstart(o,f,y)}touchmove(o,f,y){this.singleTap.touchmove(o,f,y)}touchend(o,f,y){const x=this.singleTap.touchend(o,f,y);if(x){const S=o.timeStamp-this.lastTime<500,R=!this.lastTap||this.lastTap.dist(x)<30;if(S&&R||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class il{constructor(o){this._tr=new Sa(o),this._zoomIn=new Jc({numTouches:1,numTaps:2}),this._zoomOut=new Jc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,f,y){this._zoomIn.touchstart(o,f,y),this._zoomOut.touchstart(o,f,y)}touchmove(o,f,y){this._zoomIn.touchmove(o,f,y),this._zoomOut.touchmove(o,f,y)}touchend(o,f,y){const x=this._zoomIn.touchend(o,f,y),S=this._zoomOut.touchend(o,f,y),R=this._tr;return x?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:B=>B.easeTo({duration:300,zoom:R.zoom+1,around:R.unproject(x)},{originalEvent:o})}):S?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:B=>B.easeTo({duration:300,zoom:R.zoom-1,around:R.unproject(S)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class hs{constructor(o){this._enabled=!!o.enable,this._moveStateManager=o.moveStateManager,this._clickTolerance=o.clickTolerance||1,this._moveFunction=o.move,this._activateOnStart=!!o.activateOnStart,o.assignEvents(this),this.reset()}reset(o){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(o)}_move(...o){const f=this._moveFunction(...o);if(f.bearingDelta||f.pitchDelta||f.around||f.panDelta)return this._active=!0,f}dragStart(o,f){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(o)&&(this._moveStateManager.startMove(o),this._lastPoint=f.length?f[0]:f,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(o,f){if(!this.isEnabled())return;const y=this._lastPoint;if(!y)return;if(o.preventDefault(),!this._moveStateManager.isValidMoveEvent(o))return void this.reset(o);const x=f.length?f[0]:f;return!this._moved&&x.dist(y)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=x,this._move(y,x))}dragEnd(o){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(o)&&(this._moved&&_.suppressClick(),this.reset(o))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const df={0:1,2:2};class Qc{constructor(o){this._correctEvent=o.checkCorrectEvent}startMove(o){const f=_.mouseButton(o);this._eventButton=f}endMove(o){delete this._eventButton}isValidStartEvent(o){return this._correctEvent(o)}isValidMoveEvent(o){return!function(f,y){const x=df[y];return f.buttons===void 0||(f.buttons&x)!==x}(o,this._eventButton)}isValidEndEvent(o){return _.mouseButton(o)===this._eventButton}}class ff{constructor(){this._firstTouch=void 0}_isOneFingerTouch(o){return o.targetTouches.length===1}_isSameTouchEvent(o){return o.targetTouches[0].identifier===this._firstTouch}startMove(o){this._firstTouch=o.targetTouches[0].identifier}endMove(o){delete this._firstTouch}isValidStartEvent(o){return this._isOneFingerTouch(o)}isValidMoveEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}isValidEndEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}}const eh=E=>{E.mousedown=E.dragStart,E.mousemoveWindow=E.dragMove,E.mouseup=E.dragEnd,E.contextmenu=o=>{o.preventDefault()}},pf=({enable:E,clickTolerance:o,bearingDegreesPerPixelMoved:f=.8})=>{const y=new Qc({checkCorrectEvent:x=>_.mouseButton(x)===0&&x.ctrlKey||_.mouseButton(x)===2});return new hs({clickTolerance:o,move:(x,S)=>({bearingDelta:(S.x-x.x)*f}),moveStateManager:y,enable:E,assignEvents:eh})},mf=({enable:E,clickTolerance:o,pitchDegreesPerPixelMoved:f=-.5})=>{const y=new Qc({checkCorrectEvent:x=>_.mouseButton(x)===0&&x.ctrlKey||_.mouseButton(x)===2});return new hs({clickTolerance:o,move:(x,S)=>({pitchDelta:(S.y-x.y)*f}),moveStateManager:y,enable:E,assignEvents:eh})};class fo{constructor(o,f){this._clickTolerance=o.clickTolerance||1,this._map=f,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}_shouldBePrevented(o){return o<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(o,f,y){return this._calculateTransform(o,f,y)}touchmove(o,f,y){if(this._active){if(!this._shouldBePrevented(y.length))return o.preventDefault(),this._calculateTransform(o,f,y);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",o)}}touchend(o,f,y){this._calculateTransform(o,f,y),this._active&&this._shouldBePrevented(y.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,f,y){y.length>0&&(this._active=!0);const x=Pu(y,f),S=new a.P(0,0),R=new a.P(0,0);let B=0;for(const H in x){const Y=x[H],J=this._touches[H];J&&(S._add(Y),R._add(Y.sub(J)),B++,x[H]=Y)}if(this._touches=x,this._shouldBePrevented(B)||!R.mag())return;const F=R.div(B);return this._sum._add(F),this._sum.mag()<this._clickTolerance?void 0:{around:S.div(B),panDelta:F}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class th{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(o,f,y){this._firstTwoTouches||y.length<2||(this._firstTwoTouches=[y[0].identifier,y[1].identifier],this._start([f[0],f[1]]))}touchmove(o,f,y){if(!this._firstTwoTouches)return;o.preventDefault();const[x,S]=this._firstTwoTouches,R=Iu(y,f,x),B=Iu(y,f,S);if(!R||!B)return;const F=this._aroundCenter?null:R.add(B).div(2);return this._move([R,B],F,o)}touchend(o,f,y){if(!this._firstTwoTouches)return;const[x,S]=this._firstTwoTouches,R=Iu(y,f,x),B=Iu(y,f,S);R&&B||(this._active&&_.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Iu(E,o,f){for(let y=0;y<E.length;y++)if(E[y].identifier===f)return o[y]}function gf(E,o){return Math.log(E/o)/Math.LN2}class vf extends th{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,f){const y=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(gf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:gf(this._distance,y),pinchAround:f}}}function yf(E,o){return 180*E.angleWith(o)/Math.PI}class xf extends th{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,f,y){const x=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:yf(this._vector,x),pinchAround:f}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const f=25/(Math.PI*this._minDiameter)*360,y=yf(o,this._startVector);return Math.abs(y)<f}}function rh(E){return Math.abs(E.y)>Math.abs(E.x)}class Au extends th{constructor(o){super(),this._currentTouchCount=0,this._map=o}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(o,f,y){super.touchstart(o,f,y),this._currentTouchCount=y.length}_start(o){this._lastPoints=o,rh(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,f,y){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const x=o[0].sub(this._lastPoints[0]),S=o[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(x,S,y.timeStamp),this._valid?(this._lastPoints=o,this._active=!0,{pitchDelta:(x.y+S.y)/2*-.5}):void 0}gestureBeginsVertically(o,f,y){if(this._valid!==void 0)return this._valid;const x=o.mag()>=2,S=f.mag()>=2;if(!x&&!S)return;if(!x||!S)return this._firstMove===void 0&&(this._firstMove=y),y-this._firstMove<100&&void 0;const R=o.y>0==f.y>0;return rh(o)&&rh(f)&&R}}const Eg={panStep:100,bearingStep:15,pitchStep:10};class sa{constructor(o){this._tr=new Sa(o);const f=Eg;this._panStep=f.panStep,this._bearingStep=f.bearingStep,this._pitchStep=f.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let f=0,y=0,x=0,S=0,R=0;switch(o.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:o.shiftKey?y=-1:(o.preventDefault(),S=-1);break;case 39:o.shiftKey?y=1:(o.preventDefault(),S=1);break;case 38:o.shiftKey?x=1:(o.preventDefault(),R=-1);break;case 40:o.shiftKey?x=-1:(o.preventDefault(),R=1);break;default:return}return this._rotationDisabled&&(y=0,x=0),{cameraAnimation:B=>{const F=this._tr;B.easeTo({duration:300,easeId:"keyboardHandler",easing:Ua,zoom:f?Math.round(F.zoom)+f*(o.shiftKey?2:1):F.zoom,bearing:F.bearing+y*this._bearingStep,pitch:F.pitch+x*this._pitchStep,offset:[-S*this._panStep,-R*this._panStep],center:F.center},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ua(E){return E*(2-E)}const _f=4.000244140625;class Ea{constructor(o,f){this._onTimeout=y=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(y)},this._map=o,this._tr=new Sa(o),this._triggerRenderFrame=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(o){return!!this._map.cooperativeGestures.isEnabled()&&!(o.ctrlKey||this._map.cooperativeGestures.isBypassed(o))}wheel(o){if(!this.isEnabled())return;if(this._shouldBePrevented(o))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",o);let f=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const y=v.now(),x=y-(this._lastWheelEventTime||0);this._lastWheelEventTime=y,f!==0&&f%_f==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(x*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),o.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=o,this._delta-=f,this._active||this._start(o)),o.preventDefault()}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=_.mousePos(this._map.getCanvas(),o),y=this._tr;this._around=f.y>y.transform.height/2-y.transform.getHorizon()?a.N.convert(this._aroundCenter?y.center:y.unproject(f)):a.N.convert(y.center),this._aroundPoint=y.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._tr.transform;if(this._delta!==0){const F=this._type==="wheel"&&Math.abs(this._delta)>_f?this._wheelZoomRate:this._defaultZoomRate;let H=2/(1+Math.exp(-Math.abs(this._delta*F)));this._delta<0&&H!==0&&(H=1/H);const Y=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):o.scale;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(Y*H))),this._type==="wheel"&&(this._startZoom=o.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const f=typeof this._targetZoom=="number"?this._targetZoom:o.zoom,y=this._startZoom,x=this._easing;let S,R=!1;const B=v.now()-this._lastWheelEventTime;if(this._type==="wheel"&&y&&x&&B){const F=Math.min(B/200,1),H=x(F);S=a.y.number(y,f,H),F<1?this._frameId||(this._frameId=!0):R=!0}else S=f,R=!0;return this._active=!0,R&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!R,zoomDelta:S-o.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let f=a.b9;if(this._prevEase){const y=this._prevEase,x=(v.now()-y.start)/y.duration,S=y.easing(x+.01)-y.easing(x),R=.27/Math.sqrt(S*S+1e-4)*.01,B=Math.sqrt(.0729-R*R);f=a.b8(R,B,.25,1)}return this._prevEase={start:v.now(),duration:o,easing:f},f}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class po{constructor(o,f){this._clickZoom=o,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ix{constructor(o){this._tr=new Sa(o),this.reset()}reset(){this._active=!1}dblclick(o,f){return o.preventDefault(),{cameraAnimation:y=>{y.easeTo({duration:300,zoom:this._tr.zoom+(o.shiftKey?-1:1),around:this._tr.unproject(f)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ax{constructor(){this._tap=new Jc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(o,f,y){if(!this._swipePoint)if(this._tapTime){const x=f[0],S=o.timeStamp-this._tapTime<500,R=this._tapPoint.dist(x)<30;S&&R?y.length>0&&(this._swipePoint=x,this._swipeTouch=y[0].identifier):this.reset()}else this._tap.touchstart(o,f,y)}touchmove(o,f,y){if(this._tapTime){if(this._swipePoint){if(y[0].identifier!==this._swipeTouch)return;const x=f[0],S=x.y-this._swipePoint.y;return this._swipePoint=x,o.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(o,f,y)}touchend(o,f,y){if(this._tapTime)this._swipePoint&&y.length===0&&this.reset();else{const x=this._tap.touchend(o,f,y);x&&(this._tapTime=o.timeStamp,this._tapPoint=x)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Tg{constructor(o,f,y){this._el=o,this._mousePan=f,this._touchPan=y}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Cg{constructor(o,f,y){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=f,this._mousePitch=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class wf{constructor(o,f,y,x){this._el=o,this._touchZoom=f,this._touchRotate=y,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class al{constructor(o,f){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=o,this._options=f,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const o=this._map.getCanvasContainer();o.classList.add("maplibregl-cooperative-gestures"),this._container=_.create("div","maplibregl-cooperative-gesture-screen",o);let f=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(f=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const y=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),x=document.createElement("div");x.className="maplibregl-desktop-message",x.textContent=f,this._container.appendChild(x);const S=document.createElement("div");S.className="maplibregl-mobile-message",S.textContent=y,this._container.appendChild(S),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(_.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(o){return o[this._bypassKey]}notifyGestureBlocked(o,f){this._enabled&&(this._map.fire(new a.k("cooperativegestureprevented",{gestureType:o,originalEvent:f})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const oa=E=>E.zoom||E.drag||E.pitch||E.rotate;class Ft extends a.k{}function nh(E){return E.panDelta&&E.panDelta.mag()||E.zoomDelta||E.bearingDelta||E.pitchDelta}class bf{constructor(o,f){this.handleWindowEvent=x=>{this.handleEvent(x,`${x.type}Window`)},this.handleEvent=(x,S)=>{if(x.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const R=x.type==="renderFrame"?void 0:x,B={needsRenderFrame:!1},F={},H={},Y=x.touches,J=Y?this._getMapTouches(Y):void 0,he=J?_.touchPos(this._map.getCanvas(),J):_.mousePos(this._map.getCanvas(),x);for(const{handlerName:Ce,handler:Ie,allowed:Ae}of this._handlers){if(!Ie.isEnabled())continue;let ze;this._blockedByActive(H,Ae,Ce)?Ie.reset():Ie[S||x.type]&&(ze=Ie[S||x.type](x,he,J),this.mergeHandlerResult(B,F,ze,Ce,R),ze&&ze.needsRenderFrame&&this._triggerRenderFrame()),(ze||Ie.isActive())&&(H[Ce]=Ie)}const xe={};for(const Ce in this._previousActiveHandlers)H[Ce]||(xe[Ce]=R);this._previousActiveHandlers=H,(Object.keys(xe).length||nh(B))&&(this._changes.push([B,F,xe]),this._triggerRenderFrame()),(Object.keys(H).length||nh(B))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:be}=B;be&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],be(this._map))},this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new cf(o),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f);const y=this._el;this._listeners=[[y,"touchstart",{passive:!0}],[y,"touchmove",{passive:!1}],[y,"touchend",void 0],[y,"touchcancel",void 0],[y,"mousedown",void 0],[y,"mousemove",void 0],[y,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[y,"mouseover",void 0],[y,"mouseout",void 0],[y,"dblclick",void 0],[y,"click",void 0],[y,"keydown",{capture:!1}],[y,"keyup",void 0],[y,"wheel",{passive:!1}],[y,"contextmenu",void 0],[window,"blur",void 0]];for(const[x,S,R]of this._listeners)_.addEventListener(x,S,x===document?this.handleWindowEvent:this.handleEvent,R)}destroy(){for(const[o,f,y]of this._listeners)_.removeEventListener(o,f,o===document?this.handleWindowEvent:this.handleEvent,y)}_addDefaultHandlers(o){const f=this._map,y=f.getCanvasContainer();this._add("mapEvent",new Sg(f,o));const x=f.boxZoom=new Wi(f,o);this._add("boxZoom",x),o.interactive&&o.boxZoom&&x.enable();const S=f.cooperativeGestures=new al(f,o.cooperativeGestures);this._add("cooperativeGestures",S),o.cooperativeGestures&&S.enable();const R=new il(f),B=new Ix(f);f.doubleClickZoom=new po(B,R),this._add("tapZoom",R),this._add("clickZoom",B),o.interactive&&o.doubleClickZoom&&f.doubleClickZoom.enable();const F=new Ax;this._add("tapDragZoom",F);const H=f.touchPitch=new Au(f);this._add("touchPitch",H),o.interactive&&o.touchPitch&&f.touchPitch.enable(o.touchPitch);const Y=pf(o),J=mf(o);f.dragRotate=new Cg(o,Y,J),this._add("mouseRotate",Y,["mousePitch"]),this._add("mousePitch",J,["mouseRotate"]),o.interactive&&o.dragRotate&&f.dragRotate.enable();const he=(({enable:ze,clickTolerance:Ee})=>{const Fe=new Qc({checkCorrectEvent:qe=>_.mouseButton(qe)===0&&!qe.ctrlKey});return new hs({clickTolerance:Ee,move:(qe,Ke)=>({around:Ke,panDelta:Ke.sub(qe)}),activateOnStart:!0,moveStateManager:Fe,enable:ze,assignEvents:eh})})(o),xe=new fo(o,f);f.dragPan=new Tg(y,he,xe),this._add("mousePan",he),this._add("touchPan",xe,["touchZoom","touchRotate"]),o.interactive&&o.dragPan&&f.dragPan.enable(o.dragPan);const be=new xf,Ce=new vf;f.touchZoomRotate=new wf(y,Ce,be,F),this._add("touchRotate",be,["touchPan","touchZoom"]),this._add("touchZoom",Ce,["touchPan","touchRotate"]),o.interactive&&o.touchZoomRotate&&f.touchZoomRotate.enable(o.touchZoomRotate);const Ie=f.scrollZoom=new Ea(f,()=>this._triggerRenderFrame());this._add("scrollZoom",Ie,["mousePan"]),o.interactive&&o.scrollZoom&&f.scrollZoom.enable(o.scrollZoom);const Ae=f.keyboard=new sa(f);this._add("keyboard",Ae),o.interactive&&o.keyboard&&f.keyboard.enable(),this._add("blockableMapEvent",new vn(f))}_add(o,f,y){this._handlers.push({handlerName:o,handler:f,allowed:y}),this._handlersById[o]=f}stop(o){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!oa(this._eventsInProgress)||this.isZooming()}_blockedByActive(o,f,y){for(const x in o)if(x!==y&&(!f||f.indexOf(x)<0))return!0;return!1}_getMapTouches(o){const f=[];for(const y of o)this._el.contains(y.target)&&f.push(y);return f}mergeHandlerResult(o,f,y,x,S){if(!y)return;a.e(o,y);const R={handlerName:x,originalEvent:y.originalEvent||S};y.zoomDelta!==void 0&&(f.zoom=R),y.panDelta!==void 0&&(f.drag=R),y.pitchDelta!==void 0&&(f.pitch=R),y.bearingDelta!==void 0&&(f.rotate=R)}_applyChanges(){const o={},f={},y={};for(const[x,S,R]of this._changes)x.panDelta&&(o.panDelta=(o.panDelta||new a.P(0,0))._add(x.panDelta)),x.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(o.around=x.around),x.pinchAround!==void 0&&(o.pinchAround=x.pinchAround),x.noInertia&&(o.noInertia=x.noInertia),a.e(f,S),a.e(y,R);this._updateMapTransform(o,f,y),this._changes=[]}_updateMapTransform(o,f,y){const x=this._map,S=x._getTransformForUpdate(),R=x.terrain;if(!(nh(o)||R&&this._terrainMovement))return this._fireEvents(f,y,!0);let{panDelta:B,zoomDelta:F,bearingDelta:H,pitchDelta:Y,around:J,pinchAround:he}=o;he!==void 0&&(J=he),x._stop(!0),J=J||x.transform.centerPoint;const xe=S.pointLocation(B?J.sub(B):J);H&&(S.bearing+=H),Y&&(S.pitch+=Y),F&&(S.zoom+=F),R?this._terrainMovement||!f.drag&&!f.zoom?f.drag&&this._terrainMovement?S.center=S.pointLocation(S.centerPoint.sub(B)):S.setLocationAtPoint(xe,J):(this._terrainMovement=!0,this._map._elevationFreeze=!0,S.setLocationAtPoint(xe,J)):S.setLocationAtPoint(xe,J),x._applyUpdatedTransform(S),this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(f,y,!0)}_fireEvents(o,f,y){const x=oa(this._eventsInProgress),S=oa(o),R={};for(const J in o){const{originalEvent:he}=o[J];this._eventsInProgress[J]||(R[`${J}start`]=he),this._eventsInProgress[J]=o[J]}!x&&S&&this._fireEvent("movestart",S.originalEvent);for(const J in R)this._fireEvent(J,R[J]);S&&this._fireEvent("move",S.originalEvent);for(const J in o){const{originalEvent:he}=o[J];this._fireEvent(J,he)}const B={};let F;for(const J in this._eventsInProgress){const{handlerName:he,originalEvent:xe}=this._eventsInProgress[J];this._handlersById[he].isActive()||(delete this._eventsInProgress[J],F=f[he]||xe,B[`${J}end`]=F)}for(const J in B)this._fireEvent(J,B[J]);const H=oa(this._eventsInProgress),Y=(x||S)&&!H;if(Y&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const J=this._map._getTransformForUpdate();J.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(J)}if(y&&Y){this._updatingCamera=!0;const J=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),he=xe=>xe!==0&&-this._bearingSnap<xe&&xe<this._bearingSnap;!J||!J.essential&&v.prefersReducedMotion?(this._map.fire(new a.k("moveend",{originalEvent:F})),he(this._map.getBearing())&&this._map.resetNorth()):(he(J.bearing||this._map.getBearing())&&(J.bearing=0),J.freezeElevation=!0,this._map.easeTo(J,{originalEvent:F})),this._updatingCamera=!1}}_fireEvent(o,f){this._map.fire(new a.k(o,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{delete this._frameId,this.handleEvent(new Ft("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class kg extends a.E{constructor(o,f){super(),this._renderFrameCallback=()=>{const y=Math.min((v.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(y)),y<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=f.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new a.N(this.transform.center.lng,this.transform.center.lat)}setCenter(o,f){return this.jumpTo({center:o},f)}panBy(o,f,y){return o=a.P.convert(o).mult(-1),this.panTo(this.transform.center,a.e({offset:o},f),y)}panTo(o,f,y){return this.easeTo(a.e({center:o},f),y)}getZoom(){return this.transform.zoom}setZoom(o,f){return this.jumpTo({zoom:o},f),this}zoomTo(o,f,y){return this.easeTo(a.e({zoom:o},f),y)}zoomIn(o,f){return this.zoomTo(this.getZoom()+1,o,f),this}zoomOut(o,f){return this.zoomTo(this.getZoom()-1,o,f),this}getBearing(){return this.transform.bearing}setBearing(o,f){return this.jumpTo({bearing:o},f),this}getPadding(){return this.transform.padding}setPadding(o,f){return this.jumpTo({padding:o},f),this}rotateTo(o,f,y){return this.easeTo(a.e({bearing:o},f),y)}resetNorth(o,f){return this.rotateTo(0,a.e({duration:1e3},o),f),this}resetNorthPitch(o,f){return this.easeTo(a.e({bearing:0,pitch:0,duration:1e3},o),f),this}snapToNorth(o,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,f):this}getPitch(){return this.transform.pitch}setPitch(o,f){return this.jumpTo({pitch:o},f),this}cameraForBounds(o,f){o=$e.convert(o).adjustAntiMeridian();const y=f&&f.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),y,f)}_cameraForBoxAndBearing(o,f,y,x){const S={top:0,bottom:0,right:0,left:0};if(typeof(x=a.e({padding:S,offset:[0,0],maxZoom:this.transform.maxZoom},x)).padding=="number"){const Et=x.padding;x.padding={top:Et,bottom:Et,right:Et,left:Et}}x.padding=a.e(S,x.padding);const R=this.transform,B=R.padding,F=new $e(o,f),H=R.project(F.getNorthWest()),Y=R.project(F.getNorthEast()),J=R.project(F.getSouthEast()),he=R.project(F.getSouthWest()),xe=a.ba(-y),be=H.rotate(xe),Ce=Y.rotate(xe),Ie=J.rotate(xe),Ae=he.rotate(xe),ze=new a.P(Math.max(be.x,Ce.x,Ae.x,Ie.x),Math.max(be.y,Ce.y,Ae.y,Ie.y)),Ee=new a.P(Math.min(be.x,Ce.x,Ae.x,Ie.x),Math.min(be.y,Ce.y,Ae.y,Ie.y)),Fe=ze.sub(Ee),qe=(R.width-(B.left+B.right+x.padding.left+x.padding.right))/Fe.x,Ke=(R.height-(B.top+B.bottom+x.padding.top+x.padding.bottom))/Fe.y;if(Ke<0||qe<0)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ct=Math.min(R.scaleZoom(R.scale*Math.min(qe,Ke)),x.maxZoom),_t=a.P.convert(x.offset),It=new a.P((x.padding.left-x.padding.right)/2,(x.padding.top-x.padding.bottom)/2).rotate(a.ba(y)),zt=_t.add(It).mult(R.scale/R.zoomScale(ct));return{center:R.unproject(H.add(J).div(2).sub(zt)),zoom:ct,bearing:y}}fitBounds(o,f,y){return this._fitInternal(this.cameraForBounds(o,f),f,y)}fitScreenCoordinates(o,f,y,x,S){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.P.convert(o)),this.transform.pointLocation(a.P.convert(f)),y,x),x,S)}_fitInternal(o,f,y){return o?(delete(f=a.e(o,f)).padding,f.linear?this.easeTo(f,y):this.flyTo(f,y)):this}jumpTo(o,f){this.stop();const y=this._getTransformForUpdate();let x=!1,S=!1,R=!1;return"zoom"in o&&y.zoom!==+o.zoom&&(x=!0,y.zoom=+o.zoom),o.center!==void 0&&(y.center=a.N.convert(o.center)),"bearing"in o&&y.bearing!==+o.bearing&&(S=!0,y.bearing=+o.bearing),"pitch"in o&&y.pitch!==+o.pitch&&(R=!0,y.pitch=+o.pitch),o.padding==null||y.isPaddingEqual(o.padding)||(y.padding=o.padding),this._applyUpdatedTransform(y),this.fire(new a.k("movestart",f)).fire(new a.k("move",f)),x&&this.fire(new a.k("zoomstart",f)).fire(new a.k("zoom",f)).fire(new a.k("zoomend",f)),S&&this.fire(new a.k("rotatestart",f)).fire(new a.k("rotate",f)).fire(new a.k("rotateend",f)),R&&this.fire(new a.k("pitchstart",f)).fire(new a.k("pitch",f)).fire(new a.k("pitchend",f)),this.fire(new a.k("moveend",f))}calculateCameraOptionsFromTo(o,f,y,x=0){const S=a.Z.fromLngLat(o,f),R=a.Z.fromLngLat(y,x),B=R.x-S.x,F=R.y-S.y,H=R.z-S.z,Y=Math.hypot(B,F,H);if(Y===0)throw new Error("Can't calculate camera options with same From and To");const J=Math.hypot(B,F),he=this.transform.scaleZoom(this.transform.cameraToCenterDistance/Y/this.transform.tileSize),xe=180*Math.atan2(B,-F)/Math.PI;let be=180*Math.acos(J/Y)/Math.PI;return be=H<0?90-be:90+be,{center:R.toLngLat(),zoom:he,pitch:be,bearing:xe}}easeTo(o,f){var y;this._stop(!1,o.easeId),((o=a.e({offset:[0,0],duration:500,easing:a.b9},o)).animate===!1||!o.essential&&v.prefersReducedMotion)&&(o.duration=0);const x=this._getTransformForUpdate(),S=x.zoom,R=x.bearing,B=x.pitch,F=x.padding,H="bearing"in o?this._normalizeBearing(o.bearing,R):R,Y="pitch"in o?+o.pitch:B,J="padding"in o?o.padding:x.padding,he=a.P.convert(o.offset);let xe=x.centerPoint.add(he);const be=x.pointLocation(xe),{center:Ce,zoom:Ie}=x.getConstrained(a.N.convert(o.center||be),(y=o.zoom)!==null&&y!==void 0?y:S);this._normalizeCenter(Ce,x);const Ae=x.project(be),ze=x.project(Ce).sub(Ae),Ee=x.zoomScale(Ie-S);let Fe,qe;o.around&&(Fe=a.N.convert(o.around),qe=x.locationPoint(Fe));const Ke={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Ie!==S,this._rotating=this._rotating||R!==H,this._pitching=this._pitching||Y!==B,this._padding=!x.isPaddingEqual(J),this._easeId=o.easeId,this._prepareEase(f,o.noMoveStart,Ke),this.terrain&&this._prepareElevation(Ce),this._ease(ct=>{if(this._zooming&&(x.zoom=a.y.number(S,Ie,ct)),this._rotating&&(x.bearing=a.y.number(R,H,ct)),this._pitching&&(x.pitch=a.y.number(B,Y,ct)),this._padding&&(x.interpolatePadding(F,J,ct),xe=x.centerPoint.add(he)),this.terrain&&!o.freezeElevation&&this._updateElevation(ct),Fe)x.setLocationAtPoint(Fe,qe);else{const _t=x.zoomScale(x.zoom-S),It=Ie>S?Math.min(2,Ee):Math.max(.5,Ee),zt=Math.pow(It,1-ct),Et=x.unproject(Ae.add(ze.mult(ct*zt)).mult(_t));x.setLocationAtPoint(x.renderWorldCopies?Et.wrap():Et,xe)}this._applyUpdatedTransform(x),this._fireMoveEvents(f)},ct=>{this.terrain&&o.freezeElevation&&this._finalizeElevation(),this._afterEase(f,ct)},o),this}_prepareEase(o,f,y={}){this._moving=!0,f||y.moving||this.fire(new a.k("movestart",o)),this._zooming&&!y.zooming&&this.fire(new a.k("zoomstart",o)),this._rotating&&!y.rotating&&this.fire(new a.k("rotatestart",o)),this._pitching&&!y.pitching&&this.fire(new a.k("pitchstart",o))}_prepareElevation(o){this._elevationCenter=o,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(o){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const f=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(o<1&&f!==this._elevationTarget){const y=this._elevationTarget-this._elevationStart;this._elevationStart+=o*(y-(f-(y*o+this._elevationStart))/(1-o)),this._elevationTarget=f}this.transform.elevation=a.y.number(this._elevationStart,this._elevationTarget,o)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(o){const f=o.getCameraPosition(),y=this.terrain.getElevationForLngLatZoom(f.lngLat,o.zoom);if(f.altitude<y){const x=this.calculateCameraOptionsFromTo(f.lngLat,y,o.center,o.elevation);return{pitch:x.pitch,zoom:x.zoom}}return{}}_applyUpdatedTransform(o){const f=[];if(this.terrain&&f.push(x=>this._elevateCameraIfInsideTerrain(x)),this.transformCameraUpdate&&f.push(x=>this.transformCameraUpdate(x)),!f.length)return;const y=o.clone();for(const x of f){const S=y.clone(),{center:R,zoom:B,pitch:F,bearing:H,elevation:Y}=x(S);R&&(S.center=R),B!==void 0&&(S.zoom=B),F!==void 0&&(S.pitch=F),H!==void 0&&(S.bearing=H),Y!==void 0&&(S.elevation=Y),y.apply(S)}this.transform.apply(y)}_fireMoveEvents(o){this.fire(new a.k("move",o)),this._zooming&&this.fire(new a.k("zoom",o)),this._rotating&&this.fire(new a.k("rotate",o)),this._pitching&&this.fire(new a.k("pitch",o))}_afterEase(o,f){if(this._easeId&&f&&this._easeId===f)return;delete this._easeId;const y=this._zooming,x=this._rotating,S=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,y&&this.fire(new a.k("zoomend",o)),x&&this.fire(new a.k("rotateend",o)),S&&this.fire(new a.k("pitchend",o)),this.fire(new a.k("moveend",o))}flyTo(o,f){var y;if(!o.essential&&v.prefersReducedMotion){const Dt=a.M(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Dt,f)}this.stop(),o=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.b9},o);const x=this._getTransformForUpdate(),S=x.zoom,R=x.bearing,B=x.pitch,F=x.padding,H="bearing"in o?this._normalizeBearing(o.bearing,R):R,Y="pitch"in o?+o.pitch:B,J="padding"in o?o.padding:x.padding,he=a.P.convert(o.offset);let xe=x.centerPoint.add(he);const be=x.pointLocation(xe),{center:Ce,zoom:Ie}=x.getConstrained(a.N.convert(o.center||be),(y=o.zoom)!==null&&y!==void 0?y:S);this._normalizeCenter(Ce,x);const Ae=x.zoomScale(Ie-S),ze=x.project(be),Ee=x.project(Ce).sub(ze);let Fe=o.curve;const qe=Math.max(x.width,x.height),Ke=qe/Ae,ct=Ee.mag();if("minZoom"in o){const Dt=a.ac(Math.min(o.minZoom,S,Ie),x.minZoom,x.maxZoom),ur=qe/x.zoomScale(Dt-S);Fe=Math.sqrt(ur/ct*2)}const _t=Fe*Fe;function It(Dt){const ur=(Ke*Ke-qe*qe+(Dt?-1:1)*_t*_t*ct*ct)/(2*(Dt?Ke:qe)*_t*ct);return Math.log(Math.sqrt(ur*ur+1)-ur)}function zt(Dt){return(Math.exp(Dt)-Math.exp(-Dt))/2}function Et(Dt){return(Math.exp(Dt)+Math.exp(-Dt))/2}const St=It(!1);let Wt=function(Dt){return Et(St)/Et(St+Fe*Dt)},hr=function(Dt){return qe*((Et(St)*(zt(ur=St+Fe*Dt)/Et(ur))-zt(St))/_t)/ct;var ur},kt=(It(!0)-St)/Fe;if(Math.abs(ct)<1e-6||!isFinite(kt)){if(Math.abs(qe-Ke)<1e-6)return this.easeTo(o,f);const Dt=Ke<qe?-1:1;kt=Math.abs(Math.log(Ke/qe))/Fe,hr=()=>0,Wt=ur=>Math.exp(Dt*Fe*ur)}return o.duration="duration"in o?+o.duration:1e3*kt/("screenSpeed"in o?+o.screenSpeed/Fe:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=R!==H,this._pitching=Y!==B,this._padding=!x.isPaddingEqual(J),this._prepareEase(f,!1),this.terrain&&this._prepareElevation(Ce),this._ease(Dt=>{const ur=Dt*kt,Jr=1/Wt(ur);x.zoom=Dt===1?Ie:S+x.scaleZoom(Jr),this._rotating&&(x.bearing=a.y.number(R,H,Dt)),this._pitching&&(x.pitch=a.y.number(B,Y,Dt)),this._padding&&(x.interpolatePadding(F,J,Dt),xe=x.centerPoint.add(he)),this.terrain&&!o.freezeElevation&&this._updateElevation(Dt);const yr=Dt===1?Ce:x.unproject(ze.add(Ee.mult(hr(ur))).mult(Jr));x.setLocationAtPoint(x.renderWorldCopies?yr.wrap():yr,xe),this._applyUpdatedTransform(x),this._fireMoveEvents(f)},()=>{this.terrain&&o.freezeElevation&&this._finalizeElevation(),this._afterEase(f)},o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,f){var y;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const x=this._onEaseEnd;delete this._onEaseEnd,x.call(this,f)}return o||(y=this.handlers)===null||y===void 0||y.stop(!1),this}_ease(o,f,y){y.animate===!1||y.duration===0?(o(1),f()):(this._easeStart=v.now(),this._easeOptions=y,this._onEaseFrame=o,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(o,f){o=a.b3(o,-180,180);const y=Math.abs(o-f);return Math.abs(o-360-f)<y&&(o-=360),Math.abs(o+360-f)<y&&(o+=360),o}_normalizeCenter(o,f){if(!f.renderWorldCopies||f.lngRange)return;const y=o.lng-f.center.lng;o.lng+=y>180?-360:y<-180?360:0}queryTerrainElevation(o){return this.terrain?this.terrain.getElevationForLngLatZoom(a.N.convert(o),this.transform.tileZoom)-this.transform.elevation:null}}const sl={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class ol{constructor(o=sl){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=f=>{!f||f.sourceDataType!=="metadata"&&f.sourceDataType!=="visibility"&&f.dataType!=="style"&&f.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=o}getDefaultPosition(){return"bottom-right"}onAdd(o){return this._map=o,this._compact=this.options.compact,this._container=_.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=_.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=_.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){_.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(o,f){const y=this._map._getUIString(`AttributionControl.${f}`);o.title=y,o.setAttribute("aria-label",y)}_updateAttributions(){if(!this._map.style)return;let o=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=o.concat(this.options.customAttribution.map(x=>typeof x!="string"?"":x)):typeof this.options.customAttribution=="string"&&o.push(this.options.customAttribution)),this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const f=this._map.style.sourceCaches;for(const x in f){const S=f[x];if(S.used||S.usedForTerrain){const R=S.getSource();R.attribution&&o.indexOf(R.attribution)<0&&o.push(R.attribution)}}o=o.filter(x=>String(x).trim()),o.sort((x,S)=>x.length-S.length),o=o.filter((x,S)=>{for(let R=S+1;R<o.length;R++)if(o[R].indexOf(x)>=0)return!1;return!0});const y=o.join(" | ");y!==this._attribHTML&&(this._attribHTML=y,o.length?(this._innerContainer.innerHTML=y,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Sf{constructor(o={}){this._updateCompact=()=>{const f=this._container.children;if(f.length){const y=f[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&y.classList.add("maplibregl-compact"):y.classList.remove("maplibregl-compact")}},this.options=o}getDefaultPosition(){return"bottom-left"}onAdd(o){this._map=o,this._compact=this.options&&this.options.compact,this._container=_.create("div","maplibregl-ctrl");const f=_.create("a","maplibregl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://maplibre.org/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){_.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Tr{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const f=++this._id;return this._queue.push({callback:o,id:f,cancelled:!1}),f}remove(o){const f=this._currentlyRunning,y=f?this._queue.concat(f):this._queue;for(const x of y)if(x.id===o)return void(x.cancelled=!0)}run(o=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const f=this._currentlyRunning=this._queue;this._queue=[];for(const y of f)if(!y.cancelled&&(y.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Ef=a.Y([{name:"a_pos3d",type:"Int16",components:3}]);class Mx extends a.E{constructor(o){super(),this.sourceCache=o,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,o.usedForTerrain=!0,o.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(o,f){this.sourceCache.update(o,f),this._renderableTilesKeys=[];const y={};for(const x of o.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:f}))y[x.key]=!0,this._renderableTilesKeys.push(x.key),this._tiles[x.key]||(x.posMatrix=new Float64Array(16),a.aP(x.posMatrix,0,a.X,0,a.X,0,1),this._tiles[x.key]=new at(x,this.tileSize));for(const x in this._tiles)y[x]||delete this._tiles[x]}freeRtt(o){for(const f in this._tiles){const y=this._tiles[f];(!o||y.tileID.equals(o)||y.tileID.isChildOf(o)||o.isChildOf(y.tileID))&&(y.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(o=>this.getTileByID(o))}getTileByID(o){return this._tiles[o]}getTerrainCoords(o){const f={};for(const y of this._renderableTilesKeys){const x=this._tiles[y].tileID;if(x.canonical.equals(o.canonical)){const S=o.clone();S.posMatrix=new Float64Array(16),a.aP(S.posMatrix,0,a.X,0,a.X,0,1),f[y]=S}else if(x.canonical.isChildOf(o.canonical)){const S=o.clone();S.posMatrix=new Float64Array(16);const R=x.canonical.z-o.canonical.z,B=x.canonical.x-(x.canonical.x>>R<<R),F=x.canonical.y-(x.canonical.y>>R<<R),H=a.X>>R;a.aP(S.posMatrix,0,H,0,H,0,1),a.J(S.posMatrix,S.posMatrix,[-B*H,-F*H,0]),f[y]=S}else if(o.canonical.isChildOf(x.canonical)){const S=o.clone();S.posMatrix=new Float64Array(16);const R=o.canonical.z-x.canonical.z,B=o.canonical.x-(o.canonical.x>>R<<R),F=o.canonical.y-(o.canonical.y>>R<<R),H=a.X>>R;a.aP(S.posMatrix,0,a.X,0,a.X,0,1),a.J(S.posMatrix,S.posMatrix,[B*H,F*H,0]),a.K(S.posMatrix,S.posMatrix,[1/2**R,1/2**R,0]),f[y]=S}}return f}getSourceTile(o,f){const y=this.sourceCache._source;let x=o.overscaledZ-this.deltaZoom;if(x>y.maxzoom&&(x=y.maxzoom),x<y.minzoom)return null;this._sourceTileCache[o.key]||(this._sourceTileCache[o.key]=o.scaledTo(x).key);let S=this.sourceCache.getTileByID(this._sourceTileCache[o.key]);if((!S||!S.dem)&&f)for(;x>=y.minzoom&&(!S||!S.dem);)S=this.sourceCache.getTileByID(o.scaledTo(x--).key);return S}tilesAfterTime(o=Date.now()){return Object.values(this._tiles).filter(f=>f.timeAdded>=o)}}class Tf{constructor(o,f,y){this.painter=o,this.sourceCache=new Mx(f),this.options=y,this.exaggeration=typeof y.exaggeration=="number"?y.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(o,f,y,x=a.X){var S;if(!(f>=0&&f<x&&y>=0&&y<x))return 0;const R=this.getTerrainData(o),B=(S=R.tile)===null||S===void 0?void 0:S.dem;if(!B)return 0;const F=function(be,Ce,Ie){var Ae=Ce[0],ze=Ce[1];return be[0]=Ie[0]*Ae+Ie[4]*ze+Ie[12],be[1]=Ie[1]*Ae+Ie[5]*ze+Ie[13],be}([],[f/x*a.X,y/x*a.X],R.u_terrain_matrix),H=[F[0]*B.dim,F[1]*B.dim],Y=Math.floor(H[0]),J=Math.floor(H[1]),he=H[0]-Y,xe=H[1]-J;return B.get(Y,J)*(1-he)*(1-xe)+B.get(Y+1,J)*he*(1-xe)+B.get(Y,J+1)*(1-he)*xe+B.get(Y+1,J+1)*he*xe}getElevationForLngLatZoom(o,f){if(!a.bb(f,o.wrap()))return 0;const{tileID:y,mercatorX:x,mercatorY:S}=this._getOverscaledTileIDFromLngLatZoom(o,f);return this.getElevation(y,x%a.X,S%a.X,a.X)}getElevation(o,f,y,x=a.X){return this.getDEMElevation(o,f,y,x)*this.exaggeration}getTerrainData(o){if(!this._emptyDemTexture){const x=this.painter.context,S=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new X(x,S,x.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new X(x,new a.R({width:1,height:1}),x.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(x.gl.NEAREST,x.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.an([])}const f=this.sourceCache.getSourceTile(o,!0);if(f&&f.dem&&(!f.demTexture||f.needsTerrainPrepare)){const x=this.painter.context;f.demTexture=this.painter.getTileTexture(f.dem.stride),f.demTexture?f.demTexture.update(f.dem.getPixels(),{premultiply:!1}):f.demTexture=new X(x,f.dem.getPixels(),x.gl.RGBA,{premultiply:!1}),f.demTexture.bind(x.gl.NEAREST,x.gl.CLAMP_TO_EDGE),f.needsTerrainPrepare=!1}const y=f&&f+f.tileID.key+o.key;if(y&&!this._demMatrixCache[y]){const x=this.sourceCache.sourceCache._source.maxzoom;let S=o.canonical.z-f.tileID.canonical.z;o.overscaledZ>o.canonical.z&&(o.canonical.z>=x?S=o.canonical.z-x:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const R=o.canonical.x-(o.canonical.x>>S<<S),B=o.canonical.y-(o.canonical.y>>S<<S),F=a.bc(new Float64Array(16),[1/(a.X<<S),1/(a.X<<S),0]);a.J(F,F,[R*a.X,B*a.X,0]),this._demMatrixCache[o.key]={matrix:F,coord:o}}return{u_depth:2,u_terrain:3,u_terrain_dim:f&&f.dem&&f.dem.dim||1,u_terrain_matrix:y?this._demMatrixCache[o.key].matrix:this._emptyDemMatrix,u_terrain_unpack:f&&f.dem&&f.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(f&&f.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:f}}getFramebuffer(o){const f=this.painter,y=f.width/devicePixelRatio,x=f.height/devicePixelRatio;return!this._fbo||this._fbo.width===y&&this._fbo.height===x||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new X(f.context,{width:y,height:x,data:null},f.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(f.context.gl.NEAREST,f.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new X(f.context,{width:y,height:x,data:null},f.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(f.context.gl.NEAREST,f.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=f.context.createFramebuffer(y,x,!0,!1),this._fbo.depthAttachment.set(f.context.createRenderbuffer(f.context.gl.DEPTH_COMPONENT16,y,x))),this._fbo.colorAttachment.set(o==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const o=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const f=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let S=0,R=0;S<this._coordsTextureSize;S++)for(let B=0;B<this._coordsTextureSize;B++,R+=4)f[R+0]=255&B,f[R+1]=255&S,f[R+2]=B>>8<<4|S>>8,f[R+3]=0;const y=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(f.buffer)),x=new X(o,y,o.gl.RGBA,{premultiply:!1});return x.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),this._coordsTexture=x,x}pointCoordinate(o){this.painter.maybeDrawDepthAndCoords(!0);const f=new Uint8Array(4),y=this.painter.context,x=y.gl,S=Math.round(o.x*this.painter.pixelRatio/devicePixelRatio),R=Math.round(o.y*this.painter.pixelRatio/devicePixelRatio),B=Math.round(this.painter.height/devicePixelRatio);y.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),x.readPixels(S,B-R-1,1,1,x.RGBA,x.UNSIGNED_BYTE,f),y.bindFramebuffer.set(null);const F=f[0]+(f[2]>>4<<8),H=f[1]+((15&f[2])<<8),Y=this.coordsIndex[255-f[3]],J=Y&&this.sourceCache.getTileByID(Y);if(!J)return null;const he=this._coordsTextureSize,xe=(1<<J.tileID.canonical.z)*he;return new a.Z((J.tileID.canonical.x*he+F)/xe+J.tileID.wrap,(J.tileID.canonical.y*he+H)/xe,this.getElevation(J.tileID,F,H,he))}depthAtPoint(o){const f=new Uint8Array(4),y=this.painter.context,x=y.gl;return y.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),x.readPixels(o.x,this.painter.height/devicePixelRatio-o.y-1,1,1,x.RGBA,x.UNSIGNED_BYTE,f),y.bindFramebuffer.set(null),(f[0]/16777216+f[1]/65536+f[2]/256+f[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const o=this.painter.context,f=new a.bd,y=new a.aY,x=this.meshSize,S=a.X/x,R=x*x;for(let J=0;J<=x;J++)for(let he=0;he<=x;he++)f.emplaceBack(he*S,J*S,0);for(let J=0;J<R;J+=x+1)for(let he=0;he<x;he++)y.emplaceBack(he+J,x+he+J+1,x+he+J+2),y.emplaceBack(he+J,x+he+J+2,he+J+1);const B=f.length,F=B+2*(x+1);for(const J of[0,1])for(let he=0;he<=x;he++)for(const xe of[0,1])f.emplaceBack(he*S,J*a.X,xe);for(let J=0;J<2*x;J+=2)y.emplaceBack(F+J,F+J+1,F+J+3),y.emplaceBack(F+J,F+J+3,F+J+2),y.emplaceBack(B+J,B+J+3,B+J+1),y.emplaceBack(B+J,B+J+2,B+J+3);const H=f.length,Y=H+2*(x+1);for(const J of[0,1])for(let he=0;he<=x;he++)for(const xe of[0,1])f.emplaceBack(J*a.X,he*S,xe);for(let J=0;J<2*x;J+=2)y.emplaceBack(H+J,H+J+1,H+J+3),y.emplaceBack(H+J,H+J+3,H+J+2),y.emplaceBack(Y+J,Y+J+3,Y+J+1),y.emplaceBack(Y+J,Y+J+2,Y+J+3);return this._mesh=new Wc(o.createVertexBuffer(f,Ef.members),o.createIndexBuffer(y),a.a0.simpleSegment(0,0,f.length,y.length)),this._mesh}getMeshFrameDelta(o){return 2*Math.PI*a.be/Math.pow(2,o)/5}getMinTileElevationForLngLatZoom(o,f){var y;const{tileID:x}=this._getOverscaledTileIDFromLngLatZoom(o,f);return(y=this.getMinMaxElevation(x).minElevation)!==null&&y!==void 0?y:0}getMinMaxElevation(o){const f=this.getTerrainData(o).tile,y={minElevation:null,maxElevation:null};return f&&f.dem&&(y.minElevation=f.dem.min*this.exaggeration,y.maxElevation=f.dem.max*this.exaggeration),y}_getOverscaledTileIDFromLngLatZoom(o,f){const y=a.Z.fromLngLat(o.wrap()),x=(1<<f)*a.X,S=y.x*x,R=y.y*x,B=Math.floor(S/a.X),F=Math.floor(R/a.X);return{tileID:new a.S(f,0,f,B,F),mercatorX:S,mercatorY:R}}}class Dx{constructor(o,f,y){this._context=o,this._size=f,this._tileSize=y,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const o of this._objects)o.texture.destroy(),o.fbo.destroy()}_createObject(o){const f=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),y=new X(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return y.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),f.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),f.colorAttachment.set(y.texture),{id:o,fbo:f,texture:y,stamp:-1,inUse:!1}}getObjectForId(o){return this._objects[o]}useObject(o){o.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(f=>o.id!==f),this._recentlyUsed.push(o.id)}stampObject(o){o.stamp=++this._stamp}getOrCreateFreeObject(){for(const f of this._recentlyUsed)if(!this._objects[f].inUse)return this._objects[f];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const o=this._createObject(this._objects.length);return this._objects.push(o),o}freeObject(o){o.inUse=!1}freeAllObjects(){for(const o of this._objects)this.freeObject(o)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(o=>!o.inUse)===!1}}const ll={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Pg{constructor(o,f){this.painter=o,this.terrain=f,this.pool=new Dx(o.context,30,f.sourceCache.tileSize*f.qualityFactor)}destruct(){this.pool.destruct()}getTexture(o){return this.pool.getObjectForId(o.rtt[this._stacks.length-1].id).texture}prepareForRender(o,f){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=o._order.filter(y=>!o._layers[y].isHidden(f)),this._coordsDescendingInv={};for(const y in o.sourceCaches){this._coordsDescendingInv[y]={};const x=o.sourceCaches[y].getVisibleCoordinates();for(const S of x){const R=this.terrain.sourceCache.getTerrainCoords(S);for(const B in R)this._coordsDescendingInv[y][B]||(this._coordsDescendingInv[y][B]=[]),this._coordsDescendingInv[y][B].push(R[B])}}this._coordsDescendingInvStr={};for(const y of o._order){const x=o._layers[y],S=x.source;if(ll[x.type]&&!this._coordsDescendingInvStr[S]){this._coordsDescendingInvStr[S]={};for(const R in this._coordsDescendingInv[S])this._coordsDescendingInvStr[S][R]=this._coordsDescendingInv[S][R].map(B=>B.key).sort().join()}}for(const y of this._renderableTiles)for(const x in this._coordsDescendingInvStr){const S=this._coordsDescendingInvStr[x][y.tileID.key];S&&S!==y.rttCoords[x]&&(y.rtt=[])}}renderLayer(o){if(o.isHidden(this.painter.transform.zoom))return!1;const f=o.type,y=this.painter,x=this._renderableLayerIds[this._renderableLayerIds.length-1]===o.id;if(ll[f]&&(this._prevType&&ll[this._prevType]||this._stacks.push([]),this._prevType=f,this._stacks[this._stacks.length-1].push(o.id),!x))return!0;if(ll[this._prevType]||ll[f]&&x){this._prevType=f;const S=this._stacks.length-1,R=this._stacks[S]||[];for(const B of this._renderableTiles){if(this.pool.isFull()&&(_g(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(B),B.rtt[S]){const H=this.pool.getObjectForId(B.rtt[S].id);if(H.stamp===B.rtt[S].stamp){this.pool.useObject(H);continue}}const F=this.pool.getOrCreateFreeObject();this.pool.useObject(F),this.pool.stampObject(F),B.rtt[S]={id:F.id,stamp:F.stamp},y.context.bindFramebuffer.set(F.fbo.framebuffer),y.context.clear({color:a.aM.transparent,stencil:0}),y.currentStencilSource=void 0;for(let H=0;H<R.length;H++){const Y=y.style._layers[R[H]],J=Y.source?this._coordsDescendingInv[Y.source][B.tileID.key]:[B.tileID];y.context.viewport.set([0,0,F.fbo.width,F.fbo.height]),y._renderTileClippingMasks(Y,J),y.renderLayer(y,y.style.sourceCaches[Y.source],Y,J),Y.source&&(B.rttCoords[Y.source]=this._coordsDescendingInvStr[Y.source][B.tileID.key])}}return _g(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),ll[f]}return!1}}const Cf={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ig=d,Nx={hash:!1,interactive:!0,bearingSnap:7,attributionControl:sl,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},kf=E=>{E.touchstart=E.dragStart,E.touchmoveWindow=E.dragMove,E.touchend=E.dragEnd},zx={showCompass:!0,showZoom:!0,visualizePitch:!1};class Rx{constructor(o,f,y=!1){this.mousedown=R=>{this.startMouse(a.e({},R,{ctrlKey:!0,preventDefault:()=>R.preventDefault()}),_.mousePos(this.element,R)),_.addEventListener(window,"mousemove",this.mousemove),_.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=R=>{this.moveMouse(R,_.mousePos(this.element,R))},this.mouseup=R=>{this.mouseRotate.dragEnd(R),this.mousePitch&&this.mousePitch.dragEnd(R),this.offTemp()},this.touchstart=R=>{R.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=_.touchPos(this.element,R.targetTouches)[0],this.startTouch(R,this._startPos),_.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),_.addEventListener(window,"touchend",this.touchend))},this.touchmove=R=>{R.targetTouches.length!==1?this.reset():(this._lastPos=_.touchPos(this.element,R.targetTouches)[0],this.moveTouch(R,this._lastPos))},this.touchend=R=>{R.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const x=o.dragRotate._mouseRotate.getClickTolerance(),S=o.dragRotate._mousePitch.getClickTolerance();this.element=f,this.mouseRotate=pf({clickTolerance:x,enable:!0}),this.touchRotate=(({enable:R,clickTolerance:B,bearingDegreesPerPixelMoved:F=.8})=>{const H=new ff;return new hs({clickTolerance:B,move:(Y,J)=>({bearingDelta:(J.x-Y.x)*F}),moveStateManager:H,enable:R,assignEvents:kf})})({clickTolerance:x,enable:!0}),this.map=o,y&&(this.mousePitch=mf({clickTolerance:S,enable:!0}),this.touchPitch=(({enable:R,clickTolerance:B,pitchDegreesPerPixelMoved:F=-.5})=>{const H=new ff;return new hs({clickTolerance:B,move:(Y,J)=>({pitchDelta:(J.y-Y.y)*F}),moveStateManager:H,enable:R,assignEvents:kf})})({clickTolerance:S,enable:!0})),_.addEventListener(f,"mousedown",this.mousedown),_.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),_.addEventListener(f,"touchcancel",this.reset)}startMouse(o,f){this.mouseRotate.dragStart(o,f),this.mousePitch&&this.mousePitch.dragStart(o,f),_.disableDrag()}startTouch(o,f){this.touchRotate.dragStart(o,f),this.touchPitch&&this.touchPitch.dragStart(o,f),_.disableDrag()}moveMouse(o,f){const y=this.map,{bearingDelta:x}=this.mouseRotate.dragMove(o,f)||{};if(x&&y.setBearing(y.getBearing()+x),this.mousePitch){const{pitchDelta:S}=this.mousePitch.dragMove(o,f)||{};S&&y.setPitch(y.getPitch()+S)}}moveTouch(o,f){const y=this.map,{bearingDelta:x}=this.touchRotate.dragMove(o,f)||{};if(x&&y.setBearing(y.getBearing()+x),this.touchPitch){const{pitchDelta:S}=this.touchPitch.dragMove(o,f)||{};S&&y.setPitch(y.getPitch()+S)}}off(){const o=this.element;_.removeEventListener(o,"mousedown",this.mousedown),_.removeEventListener(o,"touchstart",this.touchstart,{passive:!1}),_.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),_.removeEventListener(window,"touchend",this.touchend),_.removeEventListener(o,"touchcancel",this.reset),this.offTemp()}offTemp(){_.enableDrag(),_.removeEventListener(window,"mousemove",this.mousemove),_.removeEventListener(window,"mouseup",this.mouseup),_.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),_.removeEventListener(window,"touchend",this.touchend)}}let Zi;function Yr(E,o,f){const y=new a.N(E.lng,E.lat);if(E=new a.N(E.lng,E.lat),o){const x=new a.N(E.lng-360,E.lat),S=new a.N(E.lng+360,E.lat),R=f.locationPoint(E).distSqr(o);f.locationPoint(x).distSqr(o)<R?E=x:f.locationPoint(S).distSqr(o)<R&&(E=S)}for(;Math.abs(E.lng-f.center.lng)>180;){const x=f.locationPoint(E);if(x.x>=0&&x.y>=0&&x.x<=f.width&&x.y<=f.height)break;E.lng>f.center.lng?E.lng-=360:E.lng+=360}return E.lng!==y.lng&&f.locationPoint(E).y>f.height/2-f.getHorizon()?E:y}const ul={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ih(E,o,f){const y=E.classList;for(const x in ul)y.remove(`maplibregl-${f}-anchor-${x}`);y.add(`maplibregl-${f}-anchor-${o}`)}class ah extends a.E{constructor(o){if(super(),this._onKeyPress=f=>{const y=f.code,x=f.charCode||f.keyCode;y!=="Space"&&y!=="Enter"&&x!==32&&x!==13||this.togglePopup()},this._onMapClick=f=>{const y=f.originalEvent.target,x=this._element;this._popup&&(y===x||x.contains(y))&&this.togglePopup()},this._update=f=>{var y;if(!this._map)return;const x=this._map.loaded()&&!this._map.isMoving();((f==null?void 0:f.type)==="terrain"||(f==null?void 0:f.type)==="render"&&!x)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Yr(this._lngLat,this._flatPos,this._map.transform):(y=this._lngLat)===null||y===void 0?void 0:y.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let S="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?S=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(S=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let R="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?R="rotateX(0deg)":this._pitchAlignment==="map"&&(R=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||f&&f.type!=="moveend"||(this._pos=this._pos.round()),_.setTransform(this._element,`${ul[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${R} ${S}`),v.frameAsync(new AbortController).then(()=>{this._updateOpacity(f&&f.type==="moveend")}).catch(()=>{})},this._onMove=f=>{if(!this._isDragging){const y=this._clickTolerance||this._map._clickTolerance;this._isDragging=f.point.dist(this._pointerdownPos)>=y}this._isDragging&&(this._pos=f.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.k("dragstart"))),this.fire(new a.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.k("dragend")),this._state="inactive"},this._addDragHandler=f=>{this._element.contains(f.originalEvent.target)&&(f.preventDefault(),this._positionDelta=f.point.sub(this._pos).add(this._offset),this._pointerdownPos=f.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._subpixelPositioning=o&&o.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment!=="auto"?o.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(o==null?void 0:o.opacity,o==null?void 0:o.opacityWhenCovered),o&&o.element)this._element=o.element,this._offset=a.P.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=_.create("div");const f=_.createNS("http://www.w3.org/2000/svg","svg"),y=41,x=27;f.setAttributeNS(null,"display","block"),f.setAttributeNS(null,"height",`${y}px`),f.setAttributeNS(null,"width",`${x}px`),f.setAttributeNS(null,"viewBox",`0 0 ${x} ${y}`);const S=_.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"stroke","none"),S.setAttributeNS(null,"stroke-width","1"),S.setAttributeNS(null,"fill","none"),S.setAttributeNS(null,"fill-rule","evenodd");const R=_.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill-rule","nonzero");const B=_.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"transform","translate(3.0, 29.0)"),B.setAttributeNS(null,"fill","#000000");const F=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Ae of F){const ze=_.createNS("http://www.w3.org/2000/svg","ellipse");ze.setAttributeNS(null,"opacity","0.04"),ze.setAttributeNS(null,"cx","10.5"),ze.setAttributeNS(null,"cy","5.80029008"),ze.setAttributeNS(null,"rx",Ae.rx),ze.setAttributeNS(null,"ry",Ae.ry),B.appendChild(ze)}const H=_.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"fill",this._color);const Y=_.createNS("http://www.w3.org/2000/svg","path");Y.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),H.appendChild(Y);const J=_.createNS("http://www.w3.org/2000/svg","g");J.setAttributeNS(null,"opacity","0.25"),J.setAttributeNS(null,"fill","#000000");const he=_.createNS("http://www.w3.org/2000/svg","path");he.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),J.appendChild(he);const xe=_.createNS("http://www.w3.org/2000/svg","g");xe.setAttributeNS(null,"transform","translate(6.0, 7.0)"),xe.setAttributeNS(null,"fill","#FFFFFF");const be=_.createNS("http://www.w3.org/2000/svg","g");be.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Ce=_.createNS("http://www.w3.org/2000/svg","circle");Ce.setAttributeNS(null,"fill","#000000"),Ce.setAttributeNS(null,"opacity","0.25"),Ce.setAttributeNS(null,"cx","5.5"),Ce.setAttributeNS(null,"cy","5.5"),Ce.setAttributeNS(null,"r","5.4999962");const Ie=_.createNS("http://www.w3.org/2000/svg","circle");Ie.setAttributeNS(null,"fill","#FFFFFF"),Ie.setAttributeNS(null,"cx","5.5"),Ie.setAttributeNS(null,"cy","5.5"),Ie.setAttributeNS(null,"r","5.4999962"),be.appendChild(Ce),be.appendChild(Ie),R.appendChild(B),R.appendChild(H),R.appendChild(J),R.appendChild(xe),R.appendChild(be),f.appendChild(R),f.setAttributeNS(null,"height",y*this._scale+"px"),f.setAttributeNS(null,"width",x*this._scale+"px"),this._element.appendChild(f),this._offset=a.P.convert(o&&o.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",f=>{f.preventDefault()}),this._element.addEventListener("mousedown",f=>{f.preventDefault()}),ih(this._element,this._anchor,"marker"),o&&o.className)for(const f of o.className.split(" "))this._element.classList.add(f);this._popup=null}addTo(o){return this.remove(),this._map=o,this._element.setAttribute("aria-label",o._getUIString("Marker.Title")),o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),o.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),_.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=a.N.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const x=Math.abs(13.5)/Math.SQRT2;o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(o){return this._subpixelPositioning=o,this}getPopup(){return this._popup}togglePopup(){const o=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:o?(o.isOpen()?o.remove():(o.setLngLat(this._lngLat),o.addTo(this._map)),this):this}_updateOpacity(o=!1){var f,y;if(!(!((f=this._map)===null||f===void 0)&&f.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(o)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const x=this._map,S=x.terrain.depthAtPoint(this._pos),R=x.terrain.getElevationForLngLatZoom(this._lngLat,x.transform.tileZoom);if(x.transform.lngLatToCameraDepth(this._lngLat,R)-S<.006)return void(this._element.style.opacity=this._opacity);const B=-this._offset.y/x.transform._pixelPerMeter,F=Math.sin(x.getPitch()*Math.PI/180)*B,H=x.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),Y=x.transform.lngLatToCameraDepth(this._lngLat,R+F)-H>.006;!((y=this._popup)===null||y===void 0)&&y.isOpen()&&Y&&this._popup.remove(),this._element.style.opacity=Y?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(o){return this._offset=a.P.convert(o),this._update(),this}addClassName(o){this._element.classList.add(o)}removeClassName(o){this._element.classList.remove(o)}toggleClassName(o){return this._element.classList.toggle(o)}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&o!=="auto"?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(o,f){return o===void 0&&f===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),o!==void 0&&(this._opacity=o),f!==void 0&&(this._opacityWhenCovered=f),this._map&&this._updateOpacity(!0),this}}const Ag={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Mu=0,Du=!1;const qa={maxWidth:100,unit:"metric"};function Nu(E,o,f){const y=f&&f.maxWidth||100,x=E._container.clientHeight/2,S=E.unproject([0,x]),R=E.unproject([y,x]),B=S.distanceTo(R);if(f&&f.unit==="imperial"){const F=3.2808*B;F>5280?Gt(o,y,F/5280,E._getUIString("ScaleControl.Miles")):Gt(o,y,F,E._getUIString("ScaleControl.Feet"))}else f&&f.unit==="nautical"?Gt(o,y,B/1852,E._getUIString("ScaleControl.NauticalMiles")):B>=1e3?Gt(o,y,B/1e3,E._getUIString("ScaleControl.Kilometers")):Gt(o,y,B,E._getUIString("ScaleControl.Meters"))}function Gt(E,o,f,y){const x=function(S){const R=Math.pow(10,`${Math.floor(S)}`.length-1);let B=S/R;return B=B>=10?10:B>=5?5:B>=3?3:B>=2?2:B>=1?1:function(F){const H=Math.pow(10,Math.ceil(-Math.log(F)/Math.LN10));return Math.round(F*H)/H}(B),R*B}(f);E.style.width=o*(x/f)+"px",E.innerHTML=`${x}&nbsp;${y}`}const ir={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},sh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function oh(E){if(E){if(typeof E=="number"){const o=Math.round(Math.abs(E)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,E),"top-left":new a.P(o,o),"top-right":new a.P(-o,o),bottom:new a.P(0,-E),"bottom-left":new a.P(o,-o),"bottom-right":new a.P(-o,-o),left:new a.P(E,0),right:new a.P(-E,0)}}if(E instanceof a.P||Array.isArray(E)){const o=a.P.convert(E);return{center:o,top:o,"top-left":o,"top-right":o,bottom:o,"bottom-left":o,"bottom-right":o,left:o,right:o}}return{center:a.P.convert(E.center||[0,0]),top:a.P.convert(E.top||[0,0]),"top-left":a.P.convert(E["top-left"]||[0,0]),"top-right":a.P.convert(E["top-right"]||[0,0]),bottom:a.P.convert(E.bottom||[0,0]),"bottom-left":a.P.convert(E["bottom-left"]||[0,0]),"bottom-right":a.P.convert(E["bottom-right"]||[0,0]),left:a.P.convert(E.left||[0,0]),right:a.P.convert(E.right||[0,0])}}return oh(new a.P(0,0))}const Pf=d;u.AJAXError=a.bh,u.Evented=a.E,u.LngLat=a.N,u.MercatorCoordinate=a.Z,u.Point=a.P,u.addProtocol=a.bi,u.config=a.a,u.removeProtocol=a.bj,u.AttributionControl=ol,u.BoxZoomHandler=Wi,u.CanvasSource=tr,u.CooperativeGesturesHandler=al,u.DoubleClickZoomHandler=po,u.DragPanHandler=Tg,u.DragRotateHandler=Cg,u.EdgeInsets=rl,u.FullscreenControl=class extends a.E{constructor(E={}){super(),this._onFullscreenChange=()=>{var o;let f=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((o=f==null?void 0:f.shadowRoot)===null||o===void 0)&&o.fullscreenElement;)f=f.shadowRoot.fullscreenElement;f===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,E&&E.container&&(E.container instanceof HTMLElement?this._container=E.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(E){return this._map=E,this._container||(this._container=this._map.getContainer()),this._controlContainer=_.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){_.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const E=this._fullscreenButton=_.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);_.create("span","maplibregl-ctrl-icon",E).setAttribute("aria-hidden","true"),E.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const E=this._getTitle();this._fullscreenButton.setAttribute("aria-label",E),this._fullscreenButton.title=E}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},u.GeoJSONSource=qt,u.GeolocateControl=class extends a.E{constructor(E){super(),this._onSuccess=o=>{if(this._map){if(this._isOutOfMapMaxBounds(o))return this._setErrorState(),this.fire(new a.k("outofmaxbounds",o)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=o,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(o),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(o),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.k("geolocate",o)),this._finish()}},this._updateCamera=o=>{const f=new a.N(o.coords.longitude,o.coords.latitude),y=o.coords.accuracy,x=this._map.getBearing(),S=a.e({bearing:x},this.options.fitBoundsOptions),R=$e.fromLngLat(f,y);this._map.fitBounds(R,S,{geolocateSource:!0})},this._updateMarker=o=>{if(o){const f=new a.N(o.coords.longitude,o.coords.latitude);this._accuracyCircleMarker.setLngLat(f).addTo(this._map),this._userLocationDotMarker.setLngLat(f).addTo(this._map),this._accuracy=o.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=o=>{if(this._map){if(this.options.trackUserLocation)if(o.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(o.code===3&&Du)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.k("error",o)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=_.create("button","maplibregl-ctrl-geolocate",this._container),_.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=o=>{if(this._map){if(o===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}else{const f=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=_.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new ah({element:this._dotElement}),this._circleElement=_.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ah({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",f=>{f.geolocateSource||this._watchState!=="ACTIVE_LOCK"||f.originalEvent&&f.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.k("trackuserlocationend")),this.fire(new a.k("userlocationlostfocus")))})}},this.options=a.e({},Ag,E)}onAdd(E){return this._map=E,this._container=_.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return a._(this,arguments,void 0,function*(o=!1){if(Zi!==void 0&&!o)return Zi;if(window.navigator.permissions===void 0)return Zi=!!window.navigator.geolocation,Zi;try{Zi=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Zi=!!window.navigator.geolocation}return Zi})}().then(o=>this._finishSetupUI(o)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),_.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Mu=0,Du=!1}_isOutOfMapMaxBounds(E){const o=this._map.getMaxBounds(),f=E.coords;return o&&(f.longitude<o.getWest()||f.longitude>o.getEast()||f.latitude<o.getSouth()||f.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const E=this._map.getBounds(),o=E.getSouthEast(),f=E.getNorthEast(),y=o.distanceTo(f),x=Math.ceil(this._accuracy/(y/this._map._container.clientHeight)*2);this._circleElement.style.width=`${x}px`,this._circleElement.style.height=`${x}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Mu--,Du=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.k("trackuserlocationstart")),this.fire(new a.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let E;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Mu++,Mu>1?(E={maximumAge:6e5,timeout:0},Du=!0):(E=this.options.positionOptions,Du=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,E)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},u.Hash=Xc,u.ImageSource=er,u.KeyboardHandler=sa,u.LngLatBounds=$e,u.LogoControl=Sf,u.Map=class extends kg{constructor(E){a.bf.mark(a.bg.create);const o=Object.assign(Object.assign({},Nx),E);if(o.minZoom!=null&&o.maxZoom!=null&&o.minZoom>o.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(o.minPitch!=null&&o.maxPitch!=null&&o.minPitch>o.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(o.minPitch!=null&&o.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(o.maxPitch!=null&&o.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new nl(o.minZoom,o.maxZoom,o.minPitch,o.maxPitch,o.renderWorldCopies),{bearingSnap:o.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Tr,this._controls=[],this._mapId=a.a4(),this._contextLost=f=>{f.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.k("webglcontextlost",{originalEvent:f}))},this._contextRestored=f=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.k("webglcontextrestored",{originalEvent:f}))},this._onMapScroll=f=>{if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=o.interactive,this._maxTileCacheSize=o.maxTileCacheSize,this._maxTileCacheZoomLevels=o.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=o.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=o.preserveDrawingBuffer===!0,this._antialias=o.antialias===!0,this._trackResize=o.trackResize===!0,this._bearingSnap=o.bearingSnap,this._refreshExpiredTiles=o.refreshExpiredTiles===!0,this._fadeDuration=o.fadeDuration,this._crossSourceCollisions=o.crossSourceCollisions===!0,this._collectResourceTiming=o.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Cf),o.locale),this._clickTolerance=o.clickTolerance,this._overridePixelRatio=o.pixelRatio,this._maxCanvasSize=o.maxCanvasSize,this.transformCameraUpdate=o.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=o.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=z.addThrottleControl(()=>this.isMoving()),this._requestManager=new O(o.transformRequest),typeof o.container=="string"){if(this._container=document.getElementById(o.container),!this._container)throw new Error(`Container '${o.container}' not found.`)}else{if(!(o.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=o.container}if(o.maxBounds&&this.setMaxBounds(o.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let f=!1;const y=Tu(x=>{this._trackResize&&!this._removed&&(this.resize(x),this.redraw())},50);this._resizeObserver=new ResizeObserver(x=>{f?y(x):f=!0}),this._resizeObserver.observe(this._container)}this.handlers=new bf(this,o),this._hash=o.hash&&new Xc(typeof o.hash=="string"&&o.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:o.center,zoom:o.zoom,bearing:o.bearing,pitch:o.pitch}),o.bounds&&(this.resize(),this.fitBounds(o.bounds,a.e({},o.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=o.localIdeographFontFamily,this._validateStyle=o.validateStyle,o.style&&this.setStyle(o.style,{localIdeographFontFamily:o.localIdeographFontFamily}),o.attributionControl&&this.addControl(new ol(typeof o.attributionControl=="boolean"?void 0:o.attributionControl)),o.maplibreLogo&&this.addControl(new Sf,o.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",f=>{this._update(f.dataType==="style"),this.fire(new a.k(`${f.dataType}data`,f))}),this.on("dataloading",f=>{this.fire(new a.k(`${f.dataType}dataloading`,f))}),this.on("dataabort",f=>{this.fire(new a.k("sourcedataabort",f))})}_getMapId(){return this._mapId}addControl(E,o){if(o===void 0&&(o=E.getDefaultPosition?E.getDefaultPosition():"top-right"),!E||!E.onAdd)return this.fire(new a.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=E.onAdd(this);this._controls.push(E);const y=this._controlPositions[o];return o.indexOf("bottom")!==-1?y.insertBefore(f,y.firstChild):y.appendChild(f),this}removeControl(E){if(!E||!E.onRemove)return this.fire(new a.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(E);return o>-1&&this._controls.splice(o,1),E.onRemove(this),this}hasControl(E){return this._controls.indexOf(E)>-1}calculateCameraOptionsFromTo(E,o,f,y){return y==null&&this.terrain&&(y=this.terrain.getElevationForLngLatZoom(f,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(E,o,f,y)}resize(E){var o;const f=this._containerDimensions(),y=f[0],x=f[1],S=this._getClampedPixelRatio(y,x);if(this._resizeCanvas(y,x,S),this.painter.resize(y,x,S),this.painter.overLimit()){const B=this.painter.context.gl;this._maxCanvasSize=[B.drawingBufferWidth,B.drawingBufferHeight];const F=this._getClampedPixelRatio(y,x);this._resizeCanvas(y,x,F),this.painter.resize(y,x,F)}this.transform.resize(y,x),(o=this._requestedCameraState)===null||o===void 0||o.resize(y,x);const R=!this._moving;return R&&(this.stop(),this.fire(new a.k("movestart",E)).fire(new a.k("move",E))),this.fire(new a.k("resize",E)),R&&this.fire(new a.k("moveend",E)),this}_getClampedPixelRatio(E,o){const{0:f,1:y}=this._maxCanvasSize,x=this.getPixelRatio(),S=E*x,R=o*x;return Math.min(S>f?f/S:1,R>y?y/R:1)*x}getPixelRatio(){var E;return(E=this._overridePixelRatio)!==null&&E!==void 0?E:devicePixelRatio}setPixelRatio(E){this._overridePixelRatio=E,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(E){return this.transform.setMaxBounds($e.convert(E)),this._update()}setMinZoom(E){if((E=E??-2)>=-2&&E<=this.transform.maxZoom)return this.transform.minZoom=E,this._update(),this.getZoom()<E&&this.setZoom(E),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(E){if((E=E??22)>=this.transform.minZoom)return this.transform.maxZoom=E,this._update(),this.getZoom()>E&&this.setZoom(E),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(E){if((E=E??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(E>=0&&E<=this.transform.maxPitch)return this.transform.minPitch=E,this._update(),this.getPitch()<E&&this.setPitch(E),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(E){if((E=E??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(E>=this.transform.minPitch)return this.transform.maxPitch=E,this._update(),this.getPitch()>E&&this.setPitch(E),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(E){return this.transform.renderWorldCopies=E,this._update()}project(E){return this.transform.locationPoint(a.N.convert(E),this.style&&this.terrain)}unproject(E){return this.transform.pointLocation(a.P.convert(E),this.terrain)}isMoving(){var E;return this._moving||((E=this.handlers)===null||E===void 0?void 0:E.isMoving())}isZooming(){var E;return this._zooming||((E=this.handlers)===null||E===void 0?void 0:E.isZooming())}isRotating(){var E;return this._rotating||((E=this.handlers)===null||E===void 0?void 0:E.isRotating())}_createDelegatedListener(E,o,f){if(E==="mouseenter"||E==="mouseover"){let y=!1;return{layers:o,listener:f,delegates:{mousemove:S=>{const R=o.filter(F=>this.getLayer(F)),B=R.length!==0?this.queryRenderedFeatures(S.point,{layers:R}):[];B.length?y||(y=!0,f.call(this,new ri(E,this,S.originalEvent,{features:B}))):y=!1},mouseout:()=>{y=!1}}}}if(E==="mouseleave"||E==="mouseout"){let y=!1;return{layers:o,listener:f,delegates:{mousemove:R=>{const B=o.filter(F=>this.getLayer(F));(B.length!==0?this.queryRenderedFeatures(R.point,{layers:B}):[]).length?y=!0:y&&(y=!1,f.call(this,new ri(E,this,R.originalEvent)))},mouseout:R=>{y&&(y=!1,f.call(this,new ri(E,this,R.originalEvent)))}}}}{const y=x=>{const S=o.filter(B=>this.getLayer(B)),R=S.length!==0?this.queryRenderedFeatures(x.point,{layers:S}):[];R.length&&(x.features=R,f.call(this,x),delete x.features)};return{layers:o,listener:f,delegates:{[E]:y}}}}_saveDelegatedListener(E,o){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[E]=this._delegatedListeners[E]||[],this._delegatedListeners[E].push(o)}_removeDelegatedListener(E,o,f){if(!this._delegatedListeners||!this._delegatedListeners[E])return;const y=this._delegatedListeners[E];for(let x=0;x<y.length;x++){const S=y[x];if(S.listener===f&&S.layers.length===o.length&&S.layers.every(R=>o.includes(R))){for(const R in S.delegates)this.off(R,S.delegates[R]);return void y.splice(x,1)}}}on(E,o,f){if(f===void 0)return super.on(E,o);const y=this._createDelegatedListener(E,typeof o=="string"?[o]:o,f);this._saveDelegatedListener(E,y);for(const x in y.delegates)this.on(x,y.delegates[x]);return this}once(E,o,f){if(f===void 0)return super.once(E,o);const y=typeof o=="string"?[o]:o,x=this._createDelegatedListener(E,y,f);for(const S in x.delegates){const R=x.delegates[S];x.delegates[S]=(...B)=>{this._removeDelegatedListener(E,y,f),R(...B)}}this._saveDelegatedListener(E,x);for(const S in x.delegates)this.once(S,x.delegates[S]);return this}off(E,o,f){return f===void 0?super.off(E,o):(this._removeDelegatedListener(E,typeof o=="string"?[o]:o,f),this)}queryRenderedFeatures(E,o){if(!this.style)return[];let f;const y=E instanceof a.P||Array.isArray(E),x=y?E:[[0,0],[this.transform.width,this.transform.height]];if(o=o||(y?{}:E)||{},x instanceof a.P||typeof x[0]=="number")f=[a.P.convert(x)];else{const S=a.P.convert(x[0]),R=a.P.convert(x[1]);f=[S,new a.P(R.x,S.y),R,new a.P(S.x,R.y),S]}return this.style.queryRenderedFeatures(f,o,this.transform)}querySourceFeatures(E,o){return this.style.querySourceFeatures(E,o)}setStyle(E,o){return(o=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},o)).diff!==!1&&o.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&E?(this._diffStyle(E,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._updateStyle(E,o))}setTransformRequest(E){return this._requestManager.setTransformRequest(E),this}_getUIString(E){const o=this._locale[E];if(o==null)throw new Error(`Missing UI string '${E}'`);return o}_updateStyle(E,o){if(o.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(E,o));const f=this.style&&o.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!E)),E?(this.style=new Dc(this,o||{}),this.style.setEventedParent(this,{style:this.style}),typeof E=="string"?this.style.loadURL(E,o,f):this.style.loadJSON(E,o,f),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Dc(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(E,o){if(typeof E=="string"){const f=this._requestManager.transformRequest(E,"Style");a.h(f,new AbortController).then(y=>{this._updateDiff(y.data,o)}).catch(y=>{y&&this.fire(new a.j(y))})}else typeof E=="object"&&this._updateDiff(E,o)}_updateDiff(E,o){try{this.style.setState(E,o)&&this._update(!0)}catch(f){a.w(`Unable to perform style diff: ${f.message||f.error||f}.  Rebuilding the style from scratch.`),this._updateStyle(E,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(E,o){return this._lazyInitEmptyStyle(),this.style.addSource(E,o),this._update(!0)}isSourceLoaded(E){const o=this.style&&this.style.sourceCaches[E];if(o!==void 0)return o.loaded();this.fire(new a.j(new Error(`There is no source with ID '${E}'`)))}setTerrain(E){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),E){const o=this.style.sourceCaches[E.source];if(!o)throw new Error(`cannot load terrain, because there exists no source with ID: ${E.source}`);this.terrain===null&&o.reload();for(const f in this.style._layers){const y=this.style._layers[f];y.type==="hillshade"&&y.source===E.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Tf(this.painter,o,E),this.painter.renderToTexture=new Pg(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=f=>{f.dataType==="style"?this.terrain.sourceCache.freeRtt():f.dataType==="source"&&f.tile&&(f.sourceId!==E.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(f.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new a.k("terrain",{terrain:E})),this}getTerrain(){var E,o;return(o=(E=this.terrain)===null||E===void 0?void 0:E.options)!==null&&o!==void 0?o:null}areTilesLoaded(){const E=this.style&&this.style.sourceCaches;for(const o in E){const f=E[o]._tiles;for(const y in f){const x=f[y];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}removeSource(E){return this.style.removeSource(E),this._update(!0)}getSource(E){return this.style.getSource(E)}addImage(E,o,f={}){const{pixelRatio:y=1,sdf:x=!1,stretchX:S,stretchY:R,content:B,textFitWidth:F,textFitHeight:H}=f;if(this._lazyInitEmptyStyle(),!(o instanceof HTMLImageElement||a.b(o))){if(o.width===void 0||o.height===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:Y,height:J,data:he}=o,xe=o;return this.style.addImage(E,{data:new a.R({width:Y,height:J},new Uint8Array(he)),pixelRatio:y,stretchX:S,stretchY:R,content:B,textFitWidth:F,textFitHeight:H,sdf:x,version:0,userImage:xe}),xe.onAdd&&xe.onAdd(this,E),this}}{const{width:Y,height:J,data:he}=v.getImageData(o);this.style.addImage(E,{data:new a.R({width:Y,height:J},he),pixelRatio:y,stretchX:S,stretchY:R,content:B,textFitWidth:F,textFitHeight:H,sdf:x,version:0})}}updateImage(E,o){const f=this.style.getImage(E);if(!f)return this.fire(new a.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=o instanceof HTMLImageElement||a.b(o)?v.getImageData(o):o,{width:x,height:S,data:R}=y;if(x===void 0||S===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(x!==f.data.width||S!==f.data.height)return this.fire(new a.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const B=!(o instanceof HTMLImageElement||a.b(o));return f.data.replace(R,B),this.style.updateImage(E,f),this}getImage(E){return this.style.getImage(E)}hasImage(E){return E?!!this.style.getImage(E):(this.fire(new a.j(new Error("Missing required image id"))),!1)}removeImage(E){this.style.removeImage(E)}loadImage(E){return z.getImage(this._requestManager.transformRequest(E,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(E,o){return this._lazyInitEmptyStyle(),this.style.addLayer(E,o),this._update(!0)}moveLayer(E,o){return this.style.moveLayer(E,o),this._update(!0)}removeLayer(E){return this.style.removeLayer(E),this._update(!0)}getLayer(E){return this.style.getLayer(E)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(E,o,f){return this.style.setLayerZoomRange(E,o,f),this._update(!0)}setFilter(E,o,f={}){return this.style.setFilter(E,o,f),this._update(!0)}getFilter(E){return this.style.getFilter(E)}setPaintProperty(E,o,f,y={}){return this.style.setPaintProperty(E,o,f,y),this._update(!0)}getPaintProperty(E,o){return this.style.getPaintProperty(E,o)}setLayoutProperty(E,o,f,y={}){return this.style.setLayoutProperty(E,o,f,y),this._update(!0)}getLayoutProperty(E,o){return this.style.getLayoutProperty(E,o)}setGlyphs(E,o={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(E,o),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(E,o,f={}){return this._lazyInitEmptyStyle(),this.style.addSprite(E,o,f,y=>{y||this._update(!0)}),this}removeSprite(E){return this._lazyInitEmptyStyle(),this.style.removeSprite(E),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(E,o={}){return this._lazyInitEmptyStyle(),this.style.setSprite(E,o,f=>{f||this._update(!0)}),this}setLight(E,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(E,o),this._update(!0)}getLight(){return this.style.getLight()}setSky(E){return this._lazyInitEmptyStyle(),this.style.setSky(E),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(E,o){return this.style.setFeatureState(E,o),this._update()}removeFeatureState(E,o){return this.style.removeFeatureState(E,o),this._update()}getFeatureState(E){return this.style.getFeatureState(E)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let E=0,o=0;return this._container&&(E=this._container.clientWidth||400,o=this._container.clientHeight||300),[E,o]}_setupContainer(){const E=this._container;E.classList.add("maplibregl-map");const o=this._canvasContainer=_.create("div","maplibregl-canvas-container",E);this._interactive&&o.classList.add("maplibregl-interactive"),this._canvas=_.create("canvas","maplibregl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const f=this._containerDimensions(),y=this._getClampedPixelRatio(f[0],f[1]);this._resizeCanvas(f[0],f[1],y);const x=this._controlContainer=_.create("div","maplibregl-control-container",E),S=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(R=>{S[R]=_.create("div",`maplibregl-ctrl-${R} `,x)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(E,o,f){this._canvas.width=Math.floor(f*E),this._canvas.height=Math.floor(f*o),this._canvas.style.width=`${E}px`,this._canvas.style.height=`${o}px`}_setupPainter(){const E={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let o=null;this._canvas.addEventListener("webglcontextcreationerror",y=>{o={requestedAttributes:E},y&&(o.statusMessage=y.statusMessage,o.type=y.type)},{once:!0});const f=this._canvas.getContext("webgl2",E)||this._canvas.getContext("webgl",E);if(!f){const y="Failed to initialize WebGL";throw o?(o.message=y,new Error(JSON.stringify(o))):new Error(y)}this.painter=new Zc(f,this.transform),b.testSupport(f)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(E){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||E,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(E){return this._update(),this._renderTaskQueue.add(E)}_cancelRenderFrame(E){this._renderTaskQueue.remove(E)}_render(E){const o=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(E),this._removed)return;let f=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const x=this.transform.zoom,S=v.now();this.style.zoomHistory.update(x,S);const R=new a.z(x,{now:S,fadeDuration:o,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),B=R.crossFadingFactor();B===1&&B===this._crossFadingFactor||(f=!0,this._crossFadingFactor=B),this.style.update(R)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,o,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:o,showPadding:this.showPadding}),this.fire(new a.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.bf.mark(a.bg.load),this.fire(new a.k("load"))),this.style&&(this.style.hasTransitions()||f)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const y=this._sourcesDirty||this._styleDirty||this._placementDirty;return y||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.k("idle")),!this._loaded||this._fullyLoaded||y||(this._fullyLoaded=!0,a.bf.mark(a.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var E;this._hash&&this._hash.remove();for(const f of this._controls)f.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),z.removeThrottleControl(this._imageQueueHandle),(E=this._resizeObserver)===null||E===void 0||E.disconnect();const o=this.painter.context.gl.getExtension("WEBGL_lose_context");o!=null&&o.loseContext&&o.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),_.remove(this._canvasContainer),_.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),a.bf.clearMetrics(),this._removed=!0,this.fire(new a.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,v.frameAsync(this._frameRequest).then(E=>{a.bf.frame(E),this._frameRequest=null,this._render(E)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(E){this._showTileBoundaries!==E&&(this._showTileBoundaries=E,this._update())}get showPadding(){return!!this._showPadding}set showPadding(E){this._showPadding!==E&&(this._showPadding=E,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(E){this._showCollisionBoxes!==E&&(this._showCollisionBoxes=E,E?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(E){this._showOverdrawInspector!==E&&(this._showOverdrawInspector=E,this._update())}get repaint(){return!!this._repaint}set repaint(E){this._repaint!==E&&(this._repaint=E,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(E){this._vertices=E,this._update()}get version(){return Ig}getCameraTargetElevation(){return this.transform.elevation}},u.MapMouseEvent=ri,u.MapTouchEvent=ho,u.MapWheelEvent=bg,u.Marker=ah,u.NavigationControl=class{constructor(E){this._updateZoomButtons=()=>{const o=this._map.getZoom(),f=o===this._map.getMaxZoom(),y=o===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=y,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",y.toString())},this._rotateCompassArrow=()=>{const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=o},this._setButtonTitle=(o,f)=>{const y=this._map._getUIString(`NavigationControl.${f}`);o.title=y,o.setAttribute("aria-label",y)},this.options=a.e({},zx,E),this._container=_.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",o=>this._map.zoomIn({},{originalEvent:o})),_.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",o=>this._map.zoomOut({},{originalEvent:o})),_.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})}),this._compassIcon=_.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(E){return this._map=E,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Rx(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){_.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(E,o){const f=_.create("button",E,this._container);return f.type="button",f.addEventListener("click",o),f}},u.Popup=class extends a.E{constructor(E){super(),this.remove=()=>(this._content&&_.remove(this._content),this._container&&(_.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.k("close"))),this),this._onMouseUp=o=>{this._update(o.point)},this._onMouseMove=o=>{this._update(o.point)},this._onDrag=o=>{this._update(o.point)},this._update=o=>{var f;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=_.create("div","maplibregl-popup",this._map.getContainer()),this._tip=_.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const B of this.options.className.split(" "))this._container.classList.add(B);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Yr(this._lngLat,this._flatPos,this._map.transform):(f=this._lngLat)===null||f===void 0?void 0:f.wrap(),this._trackPointer&&!o)return;const y=this._flatPos=this._pos=this._trackPointer&&o?o:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&o?o:this._map.transform.locationPoint(this._lngLat));let x=this.options.anchor;const S=oh(this.options.offset);if(!x){const B=this._container.offsetWidth,F=this._container.offsetHeight;let H;H=y.y+S.bottom.y<F?["top"]:y.y>this._map.transform.height-F?["bottom"]:[],y.x<B/2?H.push("left"):y.x>this._map.transform.width-B/2&&H.push("right"),x=H.length===0?"bottom":H.join("-")}let R=y.add(S[x]);this.options.subpixelPositioning||(R=R.round()),_.setTransform(this._container,`${ul[x]} translate(${R.x}px,${R.y}px)`),ih(this._container,x,"popup")},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(ir),E)}addTo(E){return this._map&&this.remove(),this._map=E,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(E){return this._lngLat=a.N.convert(E),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(E){return this.setDOMContent(document.createTextNode(E))}setHTML(E){const o=document.createDocumentFragment(),f=document.createElement("body");let y;for(f.innerHTML=E;y=f.firstChild,y;)o.appendChild(y);return this.setDOMContent(o)}getMaxWidth(){var E;return(E=this._container)===null||E===void 0?void 0:E.style.maxWidth}setMaxWidth(E){return this.options.maxWidth=E,this._update(),this}setDOMContent(E){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=_.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(E),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(E){return this._container&&this._container.classList.add(E),this}removeClassName(E){return this._container&&this._container.classList.remove(E),this}setOffset(E){return this.options.offset=E,this._update(),this}toggleClassName(E){if(this._container)return this._container.classList.toggle(E)}setSubpixelPositioning(E){this.options.subpixelPositioning=E}_createCloseButton(){this.options.closeButton&&(this._closeButton=_.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const E=this._container.querySelector(sh);E&&E.focus()}},u.RasterDEMTileSource=gt,u.RasterTileSource=yt,u.ScaleControl=class{constructor(E){this._onMove=()=>{Nu(this._map,this._container,this.options)},this.setUnit=o=>{this.options.unit=o,Nu(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},qa),E)}getDefaultPosition(){return"bottom-left"}onAdd(E){return this._map=E,this._container=_.create("div","maplibregl-ctrl maplibregl-ctrl-scale",E.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){_.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},u.ScrollZoomHandler=Ea,u.Style=Dc,u.TerrainControl=class{constructor(E){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=E}onAdd(E){return this._map=E,this._container=_.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=_.create("button","maplibregl-ctrl-terrain",this._container),_.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){_.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},u.TwoFingersTouchPitchHandler=Au,u.TwoFingersTouchRotateHandler=xf,u.TwoFingersTouchZoomHandler=vf,u.TwoFingersTouchZoomRotateHandler=wf,u.VectorTileSource=pt,u.VideoSource=Vt,u.addSourceType=(E,o)=>a._(void 0,void 0,void 0,function*(){if(vr(E))throw new Error(`A source type called "${E}" already exists.`);((f,y)=>{pr[f]=y})(E,o)}),u.clearPrewarmedResources=function(){const E=et;E&&(E.isPreloaded()&&E.numActive()===1?(E.release(Le),et=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},u.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},u.getRTLTextPluginStatus=function(){return wt().getRTLTextPluginStatus()},u.getVersion=function(){return Pf},u.getWorkerCount=function(){return je.workerCount},u.getWorkerUrl=function(){return a.a.WORKER_URL},u.importScriptInWorkers=function(E){return Ge().broadcast("IS",E)},u.prewarm=function(){rt().acquire(Le)},u.setMaxParallelImageRequests=function(E){a.a.MAX_PARALLEL_IMAGE_REQUESTS=E},u.setRTLTextPlugin=function(E,o){return wt().setRTLTextPlugin(E,o)},u.setWorkerCount=function(E){je.workerCount=E},u.setWorkerUrl=function(E){a.a.WORKER_URL=E}});var s=r;return s})})(mN);var DF=mN.exports;const ud=w2(DF),O1=new EventTarget,hk=e=>{O1.dispatchEvent(new CustomEvent("focus",{detail:e}))},vN=e=>{const t=r=>{e(r.detail)};return O1.addEventListener("focus",t),()=>{O1.removeEventListener("focus",t)}},NF={},dk=e=>{let t;const r=new Set,n=(g,v)=>{const _=typeof g=="function"?g(t):g;if(!Object.is(_,t)){const b=t;t=v??(typeof _!="object"||_===null)?_:Object.assign({},t,_),r.forEach(k=>k(t,b))}},i=()=>t,d={setState:n,getState:i,getInitialState:()=>p,subscribe:g=>(r.add(g),()=>r.delete(g)),destroy:()=>{(NF?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()}},p=t=e(n,i,d);return d},yN=e=>e?dk(e):dk;var xN={exports:{}},_N={},wN={exports:{}},bN={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ed=ce;function zF(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var RF=typeof Object.is=="function"?Object.is:zF,LF=Ed.useState,BF=Ed.useEffect,OF=Ed.useLayoutEffect,FF=Ed.useDebugValue;function jF(e,t){var r=t(),n=LF({inst:{value:r,getSnapshot:t}}),i=n[0].inst,s=n[1];return OF(function(){i.value=r,i.getSnapshot=t,J_(i)&&s({inst:i})},[e,r,t]),BF(function(){return J_(i)&&s({inst:i}),e(function(){J_(i)&&s({inst:i})})},[e]),FF(r),r}function J_(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!RF(e,r)}catch{return!0}}function $F(e,t){return t()}var VF=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?$F:jF;bN.useSyncExternalStore=Ed.useSyncExternalStore!==void 0?Ed.useSyncExternalStore:VF;wN.exports=bN;var UF=wN.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var D0=ce,qF=UF;function HF(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var GF=typeof Object.is=="function"?Object.is:HF,WF=qF.useSyncExternalStore,ZF=D0.useRef,XF=D0.useEffect,KF=D0.useMemo,YF=D0.useDebugValue;_N.useSyncExternalStoreWithSelector=function(e,t,r,n,i){var s=ZF(null);if(s.current===null){var u={hasValue:!1,value:null};s.current=u}else u=s.current;s=KF(function(){function d(b){if(!p){if(p=!0,g=b,b=n(b),i!==void 0&&u.hasValue){var k=u.value;if(i(k,b))return v=k}return v=b}if(k=v,GF(g,b))return k;var A=n(b);return i!==void 0&&i(k,A)?(g=b,k):(g=b,v=A)}var p=!1,g,v,_=r===void 0?null:r;return[function(){return d(t())},_===null?void 0:function(){return d(_())}]},[t,r,n,i]);var a=WF(e,s[0],s[1]);return XF(function(){u.hasValue=!0,u.value=a},[a]),YF(a),a};xN.exports=_N;var JF=xN.exports;const SN=w2(JF),EN={},{useDebugValue:QF}=Qe,{useSyncExternalStoreWithSelector:ej}=SN;let fk=!1;const tj=e=>e;function rj(e,t=tj,r){(EN?"production":void 0)!=="production"&&r&&!fk&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),fk=!0);const n=ej(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,r);return QF(n),n}const pk=e=>{(EN?"production":void 0)!=="production"&&typeof e!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t=typeof e=="function"?yN(e):e,r=(n,i)=>rj(t,n,i);return Object.assign(r,t),r},ls=e=>e?pk(e):pk,N0=ls(e=>({id:void 0,type:void 0,set:t=>e(t),clear:()=>e({id:void 0,type:void 0})})),nj=({message:e,duration:t=3e3,onClose:r})=>(ce.useEffect(()=>{const n=setTimeout(r,t);return()=>clearTimeout(n)},[t,r]),D.jsx("div",{className:"fixed top-4 right-4 bg-teal-600 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-fade-in",children:e}));let ry=[];const lr=e=>{ry.forEach(t=>t(e))},ij=e=>(ry.push(e),()=>{ry=ry.filter(t=>t!==e)});function aj({locations:e,followLive:t=!1,latestEntity:r=null}){const n=ce.useRef(null),i=ce.useRef(null),s=ce.useRef(new Map),u=N0(g=>g.set),a="https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json";ce.useEffect(()=>{if(!i.current)return;if(n.current){setTimeout(()=>{var v;return(v=n.current)==null?void 0:v.resize()},100);return}setTimeout(()=>{!i.current||n.current||(n.current=new ud.Map({container:i.current,style:a,center:[-4.25,55.86],zoom:10}),n.current.addControl(new ud.NavigationControl,"top-right"))},50)},[a]),ce.useEffect(()=>{if(!n.current||!i.current)return;const g=new ResizeObserver(()=>{n.current&&n.current.resize()});return g.observe(i.current),()=>g.disconnect()},[]);const d=ce.useCallback(()=>{if(!n.current)return;const g=new Set;e.forEach(v=>{if(g.add(v.id),s.current.get(v.id))s.current.get(v.id).setLngLat([v.lon,v.lat]);else{const _=document.createElement("div");_.className="w-3 h-3 rounded-full bg-teal-400 border border-white/50",_.onclick=()=>u({id:v.id,type:v.type||"Location"});const b=new ud.Marker({element:_}).setLngLat([v.lon,v.lat]).addTo(n.current);s.current.set(v.id,b)}});for(const[v,_]of s.current)g.has(v)||(_.remove(),s.current.delete(v))},[e,u]);ce.useEffect(()=>{const g=setTimeout(d,150);return()=>clearTimeout(g)},[d]);const p=ce.useRef(0);return ce.useEffect(()=>{if(!t||!r||!n.current)return;const g=e.find(_=>_.id===r.id);if(!g||typeof g.lat!="number"||typeof g.lon!="number")return;const v=Date.now();if(v-p.current<2e3){lr(`New event: ${r.type||r.id}`);return}p.current=v,n.current.flyTo({center:[g.lon,g.lat],zoom:12,duration:1500})},[t,r,e]),ce.useEffect(()=>vN(({id:v})=>{if(!n.current)return;const _=s.current.get(v);if(_){const k=_.getLngLat();n.current.flyTo({center:[k.lng,k.lat],zoom:12,duration:1500});return}const b=e.find(k=>k.id===v);b&&typeof b.lat=="number"&&typeof b.lon=="number"&&n.current.flyTo({center:[b.lon,b.lat],zoom:12,duration:1500})}),[e]),D.jsx("div",{ref:i,className:"w-full h-full rounded-lg overflow-hidden",style:{minHeight:0}})}const sj="http://localhost:8088/graphql".replace(/^http/,"ws").replace(/\/graphql\/?$/,"")+"/ws";function vS(e){let t=null,r=!1,n=500;const i=()=>{if(!r){try{t=new WebSocket(sj)}catch{s();return}t.onmessage=u=>{try{e(JSON.parse(u.data))}catch{}},t.onclose=s,t.onerror=s}},s=()=>{r||(setTimeout(i,n),n=Math.min(n*2,5e3))};return i(),()=>{r=!0;try{t==null||t.close()}catch{}}}const mk=1e3;function z0(e,t="timestamp",r="desc",n){const[i,s]=ce.useState([]),[u,a]=ce.useState(!0),[d,p]=ce.useState(null),g=ce.useRef(new Map),v=ce.useRef(null),_=ce.useCallback(b=>{v.current=b},[]);return ce.useEffect(()=>((async()=>{a(!0),p(null);try{const A=new URLSearchParams;A.set("sort",t),A.set("order",r);const P=await fetch(`http://localhost:8081/entities?${A}`);if(!P.ok)throw new Error(`HTTP ${P.status}`);const I=await P.json();g.current=new Map(I.map(V=>[V.id,V]));const z=Array.from(g.current.values());z.sort((V,U)=>{var Z,Q;const $=((Z=V.attrs)==null?void 0:Z.timestamp)||"",G=((Q=U.attrs)==null?void 0:Q.timestamp)||"";return r==="desc"?G.localeCompare($):$.localeCompare(G)});const O=n?z.slice(0,n):z.slice(0,mk);s(O)}catch(A){p(A.message)}finally{a(!1)}})(),vS(A=>{if(A.t==="entity.upsert"&&A.data){const M=A.data;e&&M.type,g.current.set(M.id,M);const P=Array.from(g.current.values());P.sort((z,O)=>{var $,G;const V=(($=z.attrs)==null?void 0:$.timestamp)||"",U=((G=O.attrs)==null?void 0:G.timestamp)||"";return r==="desc"?U.localeCompare(V):V.localeCompare(U)});const I=n?P.slice(0,n):P.slice(0,mk);s(I),v.current&&v.current(M)}})),[e,t,r,n]),{entities:i,loading:u,error:d,onNewEntity:_}}const TN=ls(e=>({followLiveMap:!1,followLiveGraph:!1,setFollowLiveMap:t=>e({followLiveMap:t}),setFollowLiveGraph:t=>e({followLiveGraph:t})})),CN=()=>{const{entities:e,loading:t,error:r,onNewEntity:n}=z0(),{followLiveMap:i,setFollowLiveMap:s}=TN(),[u,a]=ce.useState(null);ce.useEffect(()=>{n(p=>{a(p)})},[n]);const d=ce.useMemo(()=>e.filter(p=>typeof p.attrs.lat=="number"&&typeof p.attrs.lon=="number").map(p=>({id:p.id,lat:p.attrs.lat,lon:p.attrs.lon,attrs:p.attrs,type:p.type})),[e]);return D.jsxs(lc,{title:"Map",children:[D.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-white/10",children:[D.jsx("div",{className:"text-sm opacity-80",children:"Map"}),D.jsxs("label",{className:"flex items-center gap-2 text-xs cursor-pointer",children:[D.jsx("input",{type:"checkbox",checked:i,onChange:p=>s(p.target.checked),className:"w-3 h-3"}),"Follow Live"]})]}),t&&D.jsx("div",{className:"text-sm text-muted mb-2 flex-shrink-0 p-3",children:"Loading..."}),r&&D.jsxs("div",{className:"text-sm text-red-400 mb-2 flex-shrink-0 p-3",children:["Error: ",r]}),!t&&!r&&D.jsx("div",{className:"flex-1 min-h-0 p-3 flex flex-col",children:D.jsx(aj,{locations:d,followLive:i,latestEntity:u})})]})};function F1(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function oj(e){if(Array.isArray(e))return e}function lj(e){if(Array.isArray(e))return F1(e)}function hu(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function uj(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,PN(n.key),n)}}function du(e,t,r){return t&&uj(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function va(e,t){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=yS(e))||t){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s,u=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var d=r.next();return u=d.done,d},e:function(d){a=!0,s=d},f:function(){try{u||r.return==null||r.return()}finally{if(a)throw s}}}}function kN(e,t,r){return(t=PN(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function cj(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function hj(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,i,s,u,a=[],d=!0,p=!1;try{if(s=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;d=!1}else for(;!(d=(n=s.call(r)).done)&&(a.push(n.value),a.length!==t);d=!0);}catch(g){p=!0,i=g}finally{try{if(!d&&r.return!=null&&(u=r.return(),Object(u)!==u))return}finally{if(p)throw i}}return a}}function dj(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fj(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Vn(e,t){return oj(e)||hj(e,t)||yS(e,t)||dj()}function Vy(e){return lj(e)||cj(e)||yS(e)||fj()}function pj(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function PN(e){var t=pj(e,"string");return typeof t=="symbol"?t:t+""}function Jn(e){"@babel/helpers - typeof";return Jn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Jn(e)}function yS(e,t){if(e){if(typeof e=="string")return F1(e,t);var r={}.toString.call(e).slice(8,-1);return r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set"?Array.from(e):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?F1(e,t):void 0}}var Zn=typeof window>"u"?null:window,gk=Zn?Zn.navigator:null;Zn&&Zn.document;var mj=Jn(""),IN=Jn({}),gj=Jn(function(){}),vj=typeof HTMLElement>"u"?"undefined":Jn(HTMLElement),Lm=function(t){return t&&t.instanceString&&Cn(t.instanceString)?t.instanceString():null},sr=function(t){return t!=null&&Jn(t)==mj},Cn=function(t){return t!=null&&Jn(t)===gj},an=function(t){return!La(t)&&(Array.isArray?Array.isArray(t):t!=null&&t instanceof Array)},Fr=function(t){return t!=null&&Jn(t)===IN&&!an(t)&&t.constructor===Object},yj=function(t){return t!=null&&Jn(t)===IN},Rt=function(t){return t!=null&&Jn(t)===Jn(1)&&!isNaN(t)},xj=function(t){return Rt(t)&&Math.floor(t)===t},Uy=function(t){if(vj!=="undefined")return t!=null&&t instanceof HTMLElement},La=function(t){return Bm(t)||AN(t)},Bm=function(t){return Lm(t)==="collection"&&t._private.single},AN=function(t){return Lm(t)==="collection"&&!t._private.single},xS=function(t){return Lm(t)==="core"},MN=function(t){return Lm(t)==="stylesheet"},_j=function(t){return Lm(t)==="event"},ru=function(t){return t==null?!0:!!(t===""||t.match(/^\s+$/))},wj=function(t){return typeof HTMLElement>"u"?!1:t instanceof HTMLElement},bj=function(t){return Fr(t)&&Rt(t.x1)&&Rt(t.x2)&&Rt(t.y1)&&Rt(t.y2)},Sj=function(t){return yj(t)&&Cn(t.then)},Ej=function(){return gk&&gk.userAgent.match(/msie|trident|edge/i)},Td=function(t,r){r||(r=function(){if(arguments.length===1)return arguments[0];if(arguments.length===0)return"undefined";for(var s=[],u=0;u<arguments.length;u++)s.push(arguments[u]);return s.join("$")});var n=function(){var s=this,u=arguments,a,d=r.apply(s,u),p=n.cache;return(a=p[d])||(a=p[d]=t.apply(s,u)),a};return n.cache={},n},_S=Td(function(e){return e.replace(/([A-Z])/g,function(t){return"-"+t.toLowerCase()})}),R0=Td(function(e){return e.replace(/(-\w)/g,function(t){return t[1].toUpperCase()})}),DN=Td(function(e,t){return e+t[0].toUpperCase()+t.substring(1)},function(e,t){return e+"$"+t}),vk=function(t){return ru(t)?t:t.charAt(0).toUpperCase()+t.substring(1)},Fl=function(t,r){return t.slice(-1*r.length)===r},Yn="(?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))",Tj="rgb[a]?\\(("+Yn+"[%]?)\\s*,\\s*("+Yn+"[%]?)\\s*,\\s*("+Yn+"[%]?)(?:\\s*,\\s*("+Yn+"))?\\)",Cj="rgb[a]?\\((?:"+Yn+"[%]?)\\s*,\\s*(?:"+Yn+"[%]?)\\s*,\\s*(?:"+Yn+"[%]?)(?:\\s*,\\s*(?:"+Yn+"))?\\)",kj="hsl[a]?\\(("+Yn+")\\s*,\\s*("+Yn+"[%])\\s*,\\s*("+Yn+"[%])(?:\\s*,\\s*("+Yn+"))?\\)",Pj="hsl[a]?\\((?:"+Yn+")\\s*,\\s*(?:"+Yn+"[%])\\s*,\\s*(?:"+Yn+"[%])(?:\\s*,\\s*(?:"+Yn+"))?\\)",Ij="\\#[0-9a-fA-F]{3}",Aj="\\#[0-9a-fA-F]{6}",NN=function(t,r){return t<r?-1:t>r?1:0},Mj=function(t,r){return-1*NN(t,r)},dr=Object.assign!=null?Object.assign.bind(Object):function(e){for(var t=arguments,r=1;r<t.length;r++){var n=t[r];if(n!=null)for(var i=Object.keys(n),s=0;s<i.length;s++){var u=i[s];e[u]=n[u]}}return e},Dj=function(t){if(!(!(t.length===4||t.length===7)||t[0]!=="#")){var r=t.length===4,n,i,s,u=16;return r?(n=parseInt(t[1]+t[1],u),i=parseInt(t[2]+t[2],u),s=parseInt(t[3]+t[3],u)):(n=parseInt(t[1]+t[2],u),i=parseInt(t[3]+t[4],u),s=parseInt(t[5]+t[6],u)),[n,i,s]}},Nj=function(t){var r,n,i,s,u,a,d,p;function g(k,A,M){return M<0&&(M+=1),M>1&&(M-=1),M<1/6?k+(A-k)*6*M:M<1/2?A:M<2/3?k+(A-k)*(2/3-M)*6:k}var v=new RegExp("^"+kj+"$").exec(t);if(v){if(n=parseInt(v[1]),n<0?n=(360- -1*n%360)%360:n>360&&(n=n%360),n/=360,i=parseFloat(v[2]),i<0||i>100||(i=i/100,s=parseFloat(v[3]),s<0||s>100)||(s=s/100,u=v[4],u!==void 0&&(u=parseFloat(u),u<0||u>1)))return;if(i===0)a=d=p=Math.round(s*255);else{var _=s<.5?s*(1+i):s+i-s*i,b=2*s-_;a=Math.round(255*g(b,_,n+1/3)),d=Math.round(255*g(b,_,n)),p=Math.round(255*g(b,_,n-1/3))}r=[a,d,p,u]}return r},zj=function(t){var r,n=new RegExp("^"+Tj+"$").exec(t);if(n){r=[];for(var i=[],s=1;s<=3;s++){var u=n[s];if(u[u.length-1]==="%"&&(i[s]=!0),u=parseFloat(u),i[s]&&(u=u/100*255),u<0||u>255)return;r.push(Math.floor(u))}var a=i[1]||i[2]||i[3],d=i[1]&&i[2]&&i[3];if(a&&!d)return;var p=n[4];if(p!==void 0){if(p=parseFloat(p),p<0||p>1)return;r.push(p)}}return r},Rj=function(t){return Lj[t.toLowerCase()]},zN=function(t){return(an(t)?t:null)||Rj(t)||Dj(t)||zj(t)||Nj(t)},Lj={transparent:[0,0,0,0],aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],grey:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},RN=function(t){for(var r=t.map,n=t.keys,i=n.length,s=0;s<i;s++){var u=n[s];if(Fr(u))throw Error("Tried to set map with object key");s<n.length-1?(r[u]==null&&(r[u]={}),r=r[u]):r[u]=t.value}},LN=function(t){for(var r=t.map,n=t.keys,i=n.length,s=0;s<i;s++){var u=n[s];if(Fr(u))throw Error("Tried to get map with object key");if(r=r[u],r==null)return r}return r},yv=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Om(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Q_,yk;function Fm(){if(yk)return Q_;yk=1;function e(t){var r=typeof t;return t!=null&&(r=="object"||r=="function")}return Q_=e,Q_}var ew,xk;function Bj(){if(xk)return ew;xk=1;var e=typeof yv=="object"&&yv&&yv.Object===Object&&yv;return ew=e,ew}var tw,_k;function L0(){if(_k)return tw;_k=1;var e=Bj(),t=typeof self=="object"&&self&&self.Object===Object&&self,r=e||t||Function("return this")();return tw=r,tw}var rw,wk;function Oj(){if(wk)return rw;wk=1;var e=L0(),t=function(){return e.Date.now()};return rw=t,rw}var nw,bk;function Fj(){if(bk)return nw;bk=1;var e=/\s/;function t(r){for(var n=r.length;n--&&e.test(r.charAt(n)););return n}return nw=t,nw}var iw,Sk;function jj(){if(Sk)return iw;Sk=1;var e=Fj(),t=/^\s+/;function r(n){return n&&n.slice(0,e(n)+1).replace(t,"")}return iw=r,iw}var aw,Ek;function wS(){if(Ek)return aw;Ek=1;var e=L0(),t=e.Symbol;return aw=t,aw}var sw,Tk;function $j(){if(Tk)return sw;Tk=1;var e=wS(),t=Object.prototype,r=t.hasOwnProperty,n=t.toString,i=e?e.toStringTag:void 0;function s(u){var a=r.call(u,i),d=u[i];try{u[i]=void 0;var p=!0}catch{}var g=n.call(u);return p&&(a?u[i]=d:delete u[i]),g}return sw=s,sw}var ow,Ck;function Vj(){if(Ck)return ow;Ck=1;var e=Object.prototype,t=e.toString;function r(n){return t.call(n)}return ow=r,ow}var lw,kk;function BN(){if(kk)return lw;kk=1;var e=wS(),t=$j(),r=Vj(),n="[object Null]",i="[object Undefined]",s=e?e.toStringTag:void 0;function u(a){return a==null?a===void 0?i:n:s&&s in Object(a)?t(a):r(a)}return lw=u,lw}var uw,Pk;function Uj(){if(Pk)return uw;Pk=1;function e(t){return t!=null&&typeof t=="object"}return uw=e,uw}var cw,Ik;function jm(){if(Ik)return cw;Ik=1;var e=BN(),t=Uj(),r="[object Symbol]";function n(i){return typeof i=="symbol"||t(i)&&e(i)==r}return cw=n,cw}var hw,Ak;function qj(){if(Ak)return hw;Ak=1;var e=jj(),t=Fm(),r=jm(),n=NaN,i=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,u=/^0o[0-7]+$/i,a=parseInt;function d(p){if(typeof p=="number")return p;if(r(p))return n;if(t(p)){var g=typeof p.valueOf=="function"?p.valueOf():p;p=t(g)?g+"":g}if(typeof p!="string")return p===0?p:+p;p=e(p);var v=s.test(p);return v||u.test(p)?a(p.slice(2),v?2:8):i.test(p)?n:+p}return hw=d,hw}var dw,Mk;function Hj(){if(Mk)return dw;Mk=1;var e=Fm(),t=Oj(),r=qj(),n="Expected a function",i=Math.max,s=Math.min;function u(a,d,p){var g,v,_,b,k,A,M=0,P=!1,I=!1,z=!0;if(typeof a!="function")throw new TypeError(n);d=r(d)||0,e(p)&&(P=!!p.leading,I="maxWait"in p,_=I?i(r(p.maxWait)||0,d):_,z="trailing"in p?!!p.trailing:z);function O(te){var W=g,oe=v;return g=v=void 0,M=te,b=a.apply(oe,W),b}function V(te){return M=te,k=setTimeout(G,d),P?O(te):b}function U(te){var W=te-A,oe=te-M,se=d-W;return I?s(se,_-oe):se}function $(te){var W=te-A,oe=te-M;return A===void 0||W>=d||W<0||I&&oe>=_}function G(){var te=t();if($(te))return Z(te);k=setTimeout(G,U(te))}function Z(te){return k=void 0,z&&g?O(te):(g=v=void 0,b)}function Q(){k!==void 0&&clearTimeout(k),M=0,g=A=v=k=void 0}function X(){return k===void 0?b:Z(t())}function ie(){var te=t(),W=$(te);if(g=arguments,v=this,A=te,W){if(k===void 0)return V(A);if(I)return clearTimeout(k),k=setTimeout(G,d),O(A)}return k===void 0&&(k=setTimeout(G,d)),b}return ie.cancel=Q,ie.flush=X,ie}return dw=u,dw}var Gj=Hj(),$m=Om(Gj),fw=Zn?Zn.performance:null,ON=fw&&fw.now?function(){return fw.now()}:function(){return Date.now()},Wj=function(){if(Zn){if(Zn.requestAnimationFrame)return function(e){Zn.requestAnimationFrame(e)};if(Zn.mozRequestAnimationFrame)return function(e){Zn.mozRequestAnimationFrame(e)};if(Zn.webkitRequestAnimationFrame)return function(e){Zn.webkitRequestAnimationFrame(e)};if(Zn.msRequestAnimationFrame)return function(e){Zn.msRequestAnimationFrame(e)}}return function(e){e&&setTimeout(function(){e(ON())},1e3/60)}}(),qy=function(t){return Wj(t)},Bo=ON,Ku=9261,FN=65599,Oh=5381,jN=function(t){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ku,n=r,i;i=t.next(),!i.done;)n=n*FN+i.value|0;return n},sm=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ku;return r*FN+t|0},om=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Oh;return(r<<5)+r+t|0},Zj=function(t,r){return t*2097152+r},Sl=function(t){return t[0]*2097152+t[1]},xv=function(t,r){return[sm(t[0],r[0]),om(t[1],r[1])]},Dk=function(t,r){var n={value:0,done:!1},i=0,s=t.length,u={next:function(){return i<s?n.value=t[i++]:n.done=!0,n}};return jN(u,r)},gc=function(t,r){var n={value:0,done:!1},i=0,s=t.length,u={next:function(){return i<s?n.value=t.charCodeAt(i++):n.done=!0,n}};return jN(u,r)},$N=function(){return Xj(arguments)},Xj=function(t){for(var r,n=0;n<t.length;n++){var i=t[n];n===0?r=gc(i):r=gc(i,r)}return r};function Kj(e,t,r,n,i){var s=i*Math.PI/180,u=Math.cos(s)*(e-r)-Math.sin(s)*(t-n)+r,a=Math.sin(s)*(e-r)+Math.cos(s)*(t-n)+n;return{x:u,y:a}}var Yj=function(t,r,n,i,s,u){return{x:(t-n)*s+n,y:(r-i)*u+i}};function Jj(e,t,r){if(r===0)return e;var n=(t.x1+t.x2)/2,i=(t.y1+t.y2)/2,s=t.w/t.h,u=1/s,a=Kj(e.x,e.y,n,i,r),d=Yj(a.x,a.y,n,i,s,u);return{x:d.x,y:d.y}}var Nk=!0,Qj=console.warn!=null,e6=console.trace!=null,bS=Number.MAX_SAFE_INTEGER||9007199254740991,VN=function(){return!0},Hy=function(){return!1},zk=function(){return 0},SS=function(){},_n=function(t){throw new Error(t)},UN=function(t){if(t!==void 0)Nk=!!t;else return Nk},Gr=function(t){UN()&&(Qj?console.warn(t):(console.log(t),e6&&console.trace()))},t6=function(t){return dr({},t)},Gs=function(t){return t==null?t:an(t)?t.slice():Fr(t)?t6(t):t},r6=function(t){return t.slice()},qN=function(t,r){for(r=t="";t++<36;r+=t*51&52?(t^15?8^Math.random()*(t^20?16:4):4).toString(16):"-");return r},n6={},HN=function(){return n6},Ti=function(t){var r=Object.keys(t);return function(n){for(var i={},s=0;s<r.length;s++){var u=r[s],a=n==null?void 0:n[u];i[u]=a===void 0?t[u]:a}return i}},nu=function(t,r,n){for(var i=t.length-1;i>=0;i--)t[i]===r&&t.splice(i,1)},ES=function(t){t.splice(0,t.length)},i6=function(t,r){for(var n=0;n<r.length;n++){var i=r[n];t.push(i)}},fa=function(t,r,n){return n&&(r=DN(n,r)),t[r]},To=function(t,r,n,i){n&&(r=DN(n,r)),t[r]=i},a6=function(){function e(){hu(this,e),this._obj={}}return du(e,[{key:"set",value:function(r,n){return this._obj[r]=n,this}},{key:"delete",value:function(r){return this._obj[r]=void 0,this}},{key:"clear",value:function(){this._obj={}}},{key:"has",value:function(r){return this._obj[r]!==void 0}},{key:"get",value:function(r){return this._obj[r]}}])}(),Po=typeof Map<"u"?Map:a6,s6="undefined",o6=function(){function e(t){if(hu(this,e),this._obj=Object.create(null),this.size=0,t!=null){var r;t.instanceString!=null&&t.instanceString()===this.instanceString()?r=t.toArray():r=t;for(var n=0;n<r.length;n++)this.add(r[n])}}return du(e,[{key:"instanceString",value:function(){return"set"}},{key:"add",value:function(r){var n=this._obj;n[r]!==1&&(n[r]=1,this.size++)}},{key:"delete",value:function(r){var n=this._obj;n[r]===1&&(n[r]=0,this.size--)}},{key:"clear",value:function(){this._obj=Object.create(null)}},{key:"has",value:function(r){return this._obj[r]===1}},{key:"toArray",value:function(){var r=this;return Object.keys(this._obj).filter(function(n){return r.has(n)})}},{key:"forEach",value:function(r,n){return this.toArray().forEach(r,n)}}])}(),Ld=(typeof Set>"u"?"undefined":Jn(Set))!==s6?Set:o6,B0=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(t===void 0||r===void 0||!xS(t)){_n("An element must have a core reference and parameters set");return}var i=r.group;if(i==null&&(r.data&&r.data.source!=null&&r.data.target!=null?i="edges":i="nodes"),i!=="nodes"&&i!=="edges"){_n("An element must be of type `nodes` or `edges`; you specified `"+i+"`");return}this.length=1,this[0]=this;var s=this._private={cy:t,single:!0,data:r.data||{},position:r.position||{x:0,y:0},autoWidth:void 0,autoHeight:void 0,autoPadding:void 0,compoundBoundsClean:!1,listeners:[],group:i,style:{},rstyle:{},styleCxts:[],styleKeys:{},removed:!0,selected:!!r.selected,selectable:r.selectable===void 0?!0:!!r.selectable,locked:!!r.locked,grabbed:!1,grabbable:r.grabbable===void 0?!0:!!r.grabbable,pannable:r.pannable===void 0?i==="edges":!!r.pannable,active:!1,classes:new Ld,animation:{current:[],queue:[]},rscratch:{},scratch:r.scratch||{},edges:[],children:[],parent:r.parent&&r.parent.isNode()?r.parent:null,traversalCache:{},backgrounding:!1,bbCache:null,bbCacheShift:{x:0,y:0},bodyBounds:null,overlayBounds:null,labelBounds:{all:null,source:null,target:null,main:null},arrowBounds:{source:null,target:null,"mid-source":null,"mid-target":null}};if(s.position.x==null&&(s.position.x=0),s.position.y==null&&(s.position.y=0),r.renderedPosition){var u=r.renderedPosition,a=t.pan(),d=t.zoom();s.position={x:(u.x-a.x)/d,y:(u.y-a.y)/d}}var p=[];an(r.classes)?p=r.classes:sr(r.classes)&&(p=r.classes.split(/\s+/));for(var g=0,v=p.length;g<v;g++){var _=p[g];!_||_===""||s.classes.add(_)}this.createEmitter(),(n===void 0||n)&&this.restore();var b=r.style||r.css;b&&(Gr("Setting a `style` bypass at element creation should be done only when absolutely necessary.  Try to use the stylesheet instead."),this.style(b))},Rk=function(t){return t={bfs:t.bfs||!t.dfs,dfs:t.dfs||!t.bfs},function(n,i,s){var u;Fr(n)&&!La(n)&&(u=n,n=u.roots||u.root,i=u.visit,s=u.directed),s=arguments.length===2&&!Cn(i)?i:s,i=Cn(i)?i:function(){};for(var a=this._private.cy,d=n=sr(n)?this.filter(n):n,p=[],g=[],v={},_={},b={},k=0,A,M=this.byGroup(),P=M.nodes,I=M.edges,z=0;z<d.length;z++){var O=d[z],V=O.id();O.isNode()&&(p.unshift(O),t.bfs&&(b[V]=!0,g.push(O)),_[V]=0)}for(var U=function(){var te=t.bfs?p.shift():p.pop(),W=te.id();if(t.dfs){if(b[W])return 0;b[W]=!0,g.push(te)}var oe=_[W],se=v[W],de=se!=null?se.source():null,me=se!=null?se.target():null,ae=se==null?void 0:te.same(de)?me[0]:de[0],ve;if(ve=i(te,se,ae,k++,oe),ve===!0)return A=te,1;if(ve===!1)return 1;for(var pe=te.connectedEdges().filter(function(Je){return(!s||Je.source().same(te))&&I.has(Je)}),_e=0;_e<pe.length;_e++){var De=pe[_e],Le=De.connectedNodes().filter(function(Je){return!Je.same(te)&&P.has(Je)}),je=Le.id();Le.length!==0&&!b[je]&&(Le=Le[0],p.push(Le),t.bfs&&(b[je]=!0,g.push(Le)),v[je]=De,_[je]=_[W]+1)}},$;p.length!==0&&($=U(),!($!==0&&$===1)););for(var G=a.collection(),Z=0;Z<g.length;Z++){var Q=g[Z],X=v[Q.id()];X!=null&&G.push(X),G.push(Q)}return{path:a.collection(G),found:a.collection(A)}}},lm={breadthFirstSearch:Rk({bfs:!0}),depthFirstSearch:Rk({dfs:!0})};lm.bfs=lm.breadthFirstSearch;lm.dfs=lm.depthFirstSearch;var ny={exports:{}},l6=ny.exports,Lk;function u6(){return Lk||(Lk=1,function(e,t){(function(){var r,n,i,s,u,a,d,p,g,v,_,b,k,A,M;i=Math.floor,v=Math.min,n=function(P,I){return P<I?-1:P>I?1:0},g=function(P,I,z,O,V){var U;if(z==null&&(z=0),V==null&&(V=n),z<0)throw new Error("lo must be non-negative");for(O==null&&(O=P.length);z<O;)U=i((z+O)/2),V(I,P[U])<0?O=U:z=U+1;return[].splice.apply(P,[z,z-z].concat(I)),I},a=function(P,I,z){return z==null&&(z=n),P.push(I),A(P,0,P.length-1,z)},u=function(P,I){var z,O;return I==null&&(I=n),z=P.pop(),P.length?(O=P[0],P[0]=z,M(P,0,I)):O=z,O},p=function(P,I,z){var O;return z==null&&(z=n),O=P[0],P[0]=I,M(P,0,z),O},d=function(P,I,z){var O;return z==null&&(z=n),P.length&&z(P[0],I)<0&&(O=[P[0],I],I=O[0],P[0]=O[1],M(P,0,z)),I},s=function(P,I){var z,O,V,U,$,G;for(I==null&&(I=n),U=(function(){G=[];for(var Z=0,Q=i(P.length/2);0<=Q?Z<Q:Z>Q;0<=Q?Z++:Z--)G.push(Z);return G}).apply(this).reverse(),$=[],O=0,V=U.length;O<V;O++)z=U[O],$.push(M(P,z,I));return $},k=function(P,I,z){var O;if(z==null&&(z=n),O=P.indexOf(I),O!==-1)return A(P,0,O,z),M(P,O,z)},_=function(P,I,z){var O,V,U,$,G;if(z==null&&(z=n),V=P.slice(0,I),!V.length)return V;for(s(V,z),G=P.slice(I),U=0,$=G.length;U<$;U++)O=G[U],d(V,O,z);return V.sort(z).reverse()},b=function(P,I,z){var O,V,U,$,G,Z,Q,X,ie;if(z==null&&(z=n),I*10<=P.length){if(U=P.slice(0,I).sort(z),!U.length)return U;for(V=U[U.length-1],Q=P.slice(I),$=0,Z=Q.length;$<Z;$++)O=Q[$],z(O,V)<0&&(g(U,O,0,null,z),U.pop(),V=U[U.length-1]);return U}for(s(P,z),ie=[],G=0,X=v(I,P.length);0<=X?G<X:G>X;0<=X?++G:--G)ie.push(u(P,z));return ie},A=function(P,I,z,O){var V,U,$;for(O==null&&(O=n),V=P[z];z>I;){if($=z-1>>1,U=P[$],O(V,U)<0){P[z]=U,z=$;continue}break}return P[z]=V},M=function(P,I,z){var O,V,U,$,G;for(z==null&&(z=n),V=P.length,G=I,U=P[I],O=2*I+1;O<V;)$=O+1,$<V&&!(z(P[O],P[$])<0)&&(O=$),P[I]=P[O],I=O,O=2*I+1;return P[I]=U,A(P,G,I,z)},r=function(){P.push=a,P.pop=u,P.replace=p,P.pushpop=d,P.heapify=s,P.updateItem=k,P.nlargest=_,P.nsmallest=b;function P(I){this.cmp=I??n,this.nodes=[]}return P.prototype.push=function(I){return a(this.nodes,I,this.cmp)},P.prototype.pop=function(){return u(this.nodes,this.cmp)},P.prototype.peek=function(){return this.nodes[0]},P.prototype.contains=function(I){return this.nodes.indexOf(I)!==-1},P.prototype.replace=function(I){return p(this.nodes,I,this.cmp)},P.prototype.pushpop=function(I){return d(this.nodes,I,this.cmp)},P.prototype.heapify=function(){return s(this.nodes,this.cmp)},P.prototype.updateItem=function(I){return k(this.nodes,I,this.cmp)},P.prototype.clear=function(){return this.nodes=[]},P.prototype.empty=function(){return this.nodes.length===0},P.prototype.size=function(){return this.nodes.length},P.prototype.clone=function(){var I;return I=new P,I.nodes=this.nodes.slice(0),I},P.prototype.toArray=function(){return this.nodes.slice(0)},P.prototype.insert=P.prototype.push,P.prototype.top=P.prototype.peek,P.prototype.front=P.prototype.peek,P.prototype.has=P.prototype.contains,P.prototype.copy=P.prototype.clone,P}(),function(P,I){return e.exports=I()}(this,function(){return r})}).call(l6)}(ny)),ny.exports}var pw,Bk;function c6(){return Bk||(Bk=1,pw=u6()),pw}var h6=c6(),Vm=Om(h6),d6=Ti({root:null,weight:function(t){return 1},directed:!1}),f6={dijkstra:function(t){if(!Fr(t)){var r=arguments;t={root:r[0],weight:r[1],directed:r[2]}}var n=d6(t),i=n.root,s=n.weight,u=n.directed,a=this,d=s,p=sr(i)?this.filter(i)[0]:i[0],g={},v={},_={},b=this.byGroup(),k=b.nodes,A=b.edges;A.unmergeBy(function(oe){return oe.isLoop()});for(var M=function(se){return g[se.id()]},P=function(se,de){g[se.id()]=de,I.updateItem(se)},I=new Vm(function(oe,se){return M(oe)-M(se)}),z=0;z<k.length;z++){var O=k[z];g[O.id()]=O.same(p)?0:1/0,I.push(O)}for(var V=function(se,de){for(var me=(u?se.edgesTo(de):se.edgesWith(de)).intersect(A),ae=1/0,ve,pe=0;pe<me.length;pe++){var _e=me[pe],De=d(_e);(De<ae||!ve)&&(ae=De,ve=_e)}return{edge:ve,dist:ae}};I.size()>0;){var U=I.pop(),$=M(U),G=U.id();if(_[G]=$,$!==1/0)for(var Z=U.neighborhood().intersect(k),Q=0;Q<Z.length;Q++){var X=Z[Q],ie=X.id(),te=V(U,X),W=$+te.dist;W<M(X)&&(P(X,W),v[ie]={node:U,edge:te.edge})}}return{distanceTo:function(se){var de=sr(se)?k.filter(se)[0]:se[0];return _[de.id()]},pathTo:function(se){var de=sr(se)?k.filter(se)[0]:se[0],me=[],ae=de,ve=ae.id();if(de.length>0)for(me.unshift(de);v[ve];){var pe=v[ve];me.unshift(pe.edge),me.unshift(pe.node),ae=pe.node,ve=ae.id()}return a.spawn(me)}}}},p6={kruskal:function(t){t=t||function(z){return 1};for(var r=this.byGroup(),n=r.nodes,i=r.edges,s=n.length,u=new Array(s),a=n,d=function(O){for(var V=0;V<u.length;V++){var U=u[V];if(U.has(O))return V}},p=0;p<s;p++)u[p]=this.spawn(n[p]);for(var g=i.sort(function(z,O){return t(z)-t(O)}),v=0;v<g.length;v++){var _=g[v],b=_.source()[0],k=_.target()[0],A=d(b),M=d(k),P=u[A],I=u[M];A!==M&&(a.merge(_),P.merge(I),u.splice(M,1))}return a}},m6=Ti({root:null,goal:null,weight:function(t){return 1},heuristic:function(t){return 0},directed:!1}),g6={aStar:function(t){var r=this.cy(),n=m6(t),i=n.root,s=n.goal,u=n.heuristic,a=n.directed,d=n.weight;i=r.collection(i)[0],s=r.collection(s)[0];var p=i.id(),g=s.id(),v={},_={},b={},k=new Vm(function(ve,pe){return _[ve.id()]-_[pe.id()]}),A=new Ld,M={},P={},I=function(pe,_e){k.push(pe),A.add(_e)},z,O,V=function(){z=k.pop(),O=z.id(),A.delete(O)},U=function(pe){return A.has(pe)};I(i,p),v[p]=0,_[p]=u(i);for(var $=0;k.size()>0;){if(V(),$++,O===g){for(var G=[],Z=s,Q=g,X=P[Q];G.unshift(Z),X!=null&&G.unshift(X),Z=M[Q],Z!=null;)Q=Z.id(),X=P[Q];return{found:!0,distance:v[O],path:this.spawn(G),steps:$}}b[O]=!0;for(var ie=z._private.edges,te=0;te<ie.length;te++){var W=ie[te];if(this.hasElementWithId(W.id())&&!(a&&W.data("source")!==O)){var oe=W.source(),se=W.target(),de=oe.id()!==O?oe:se,me=de.id();if(this.hasElementWithId(me)&&!b[me]){var ae=v[O]+d(W);if(!U(me)){v[me]=ae,_[me]=ae+u(de),I(de,me),M[me]=z,P[me]=W;continue}ae<v[me]&&(v[me]=ae,_[me]=ae+u(de),M[me]=z,P[me]=W)}}}}return{found:!1,distance:void 0,path:void 0,steps:$}}},v6=Ti({weight:function(t){return 1},directed:!1}),y6={floydWarshall:function(t){for(var r=this.cy(),n=v6(t),i=n.weight,s=n.directed,u=i,a=this.byGroup(),d=a.nodes,p=a.edges,g=d.length,v=g*g,_=function(De){return d.indexOf(De)},b=function(De){return d[De]},k=new Array(v),A=0;A<v;A++){var M=A%g,P=(A-M)/g;P===M?k[A]=0:k[A]=1/0}for(var I=new Array(v),z=new Array(v),O=0;O<p.length;O++){var V=p[O],U=V.source()[0],$=V.target()[0];if(U!==$){var G=_(U),Z=_($),Q=G*g+Z,X=u(V);if(k[Q]>X&&(k[Q]=X,I[Q]=Z,z[Q]=V),!s){var ie=Z*g+G;!s&&k[ie]>X&&(k[ie]=X,I[ie]=G,z[ie]=V)}}}for(var te=0;te<g;te++)for(var W=0;W<g;W++)for(var oe=W*g+te,se=0;se<g;se++){var de=W*g+se,me=te*g+se;k[oe]+k[me]<k[de]&&(k[de]=k[oe]+k[me],I[de]=I[oe])}var ae=function(De){return(sr(De)?r.filter(De):De)[0]},ve=function(De){return _(ae(De))},pe={distance:function(De,Le){var je=ve(De),Je=ve(Le);return k[je*g+Je]},path:function(De,Le){var je=ve(De),Je=ve(Le),et=b(je);if(je===Je)return et.collection();if(I[je*g+Je]==null)return r.collection();var ft=r.collection(),rt=je,Oe;for(ft.merge(et);je!==Je;)rt=je,je=I[je*g+Je],Oe=z[rt*g+je],ft.merge(Oe),ft.merge(b(je));return ft}};return pe}},x6=Ti({weight:function(t){return 1},directed:!1,root:null}),_6={bellmanFord:function(t){var r=this,n=x6(t),i=n.weight,s=n.directed,u=n.root,a=i,d=this,p=this.cy(),g=this.byGroup(),v=g.edges,_=g.nodes,b=_.length,k=new Po,A=!1,M=[];u=p.collection(u)[0],v.unmergeBy(function(At){return At.isLoop()});for(var P=v.length,I=function(pt){var yt=k.get(pt.id());return yt||(yt={},k.set(pt.id(),yt)),yt},z=function(pt){return(sr(pt)?p.$(pt):pt)[0]},O=function(pt){return I(z(pt)).dist},V=function(pt){for(var yt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:u,gt=z(pt),qt=[],$t=gt;;){if($t==null)return r.spawn();var er=I($t),Vt=er.edge,tr=er.pred;if(qt.unshift($t[0]),$t.same(yt)&&qt.length>0)break;Vt!=null&&qt.unshift(Vt),$t=tr}return d.spawn(qt)},U=0;U<b;U++){var $=_[U],G=I($);$.same(u)?G.dist=0:G.dist=1/0,G.pred=null,G.edge=null}for(var Z=!1,Q=function(pt,yt,gt,qt,$t,er){var Vt=qt.dist+er;Vt<$t.dist&&!gt.same(qt.edge)&&($t.dist=Vt,$t.pred=pt,$t.edge=gt,Z=!0)},X=1;X<b;X++){Z=!1;for(var ie=0;ie<P;ie++){var te=v[ie],W=te.source(),oe=te.target(),se=a(te),de=I(W),me=I(oe);Q(W,oe,te,de,me,se),s||Q(oe,W,te,me,de,se)}if(!Z)break}if(Z)for(var ae=[],ve=0;ve<P;ve++){var pe=v[ve],_e=pe.source(),De=pe.target(),Le=a(pe),je=I(_e).dist,Je=I(De).dist;if(je+Le<Je||!s&&Je+Le<je)if(A||(Gr("Graph contains a negative weight cycle for Bellman-Ford"),A=!0),t.findNegativeWeightCycles!==!1){var et=[];je+Le<Je&&et.push(_e),!s&&Je+Le<je&&et.push(De);for(var ft=et.length,rt=0;rt<ft;rt++){var Oe=et[rt],Ge=[Oe];Ge.push(I(Oe).edge);for(var Ze=I(Oe).pred;Ge.indexOf(Ze)===-1;)Ge.push(Ze),Ge.push(I(Ze).edge),Ze=I(Ze).pred;Ge=Ge.slice(Ge.indexOf(Ze));for(var it=Ge[0].id(),mt=0,Tt=2;Tt<Ge.length;Tt+=2)Ge[Tt].id()<it&&(it=Ge[Tt].id(),mt=Tt);Ge=Ge.slice(mt).concat(Ge.slice(0,mt)),Ge.push(Ge[0]);var $e=Ge.map(function(At){return At.id()}).join(",");ae.indexOf($e)===-1&&(M.push(d.spawn(Ge)),ae.push($e))}}else break}return{distanceTo:O,pathTo:V,hasNegativeWeightCycle:A,negativeWeightCycles:M}}},w6=Math.sqrt(2),b6=function(t,r,n){n.length===0&&_n("Karger-Stein must be run on a connected (sub)graph");for(var i=n[t],s=i[1],u=i[2],a=r[s],d=r[u],p=n,g=p.length-1;g>=0;g--){var v=p[g],_=v[1],b=v[2];(r[_]===a&&r[b]===d||r[_]===d&&r[b]===a)&&p.splice(g,1)}for(var k=0;k<p.length;k++){var A=p[k];A[1]===d?(p[k]=A.slice(),p[k][1]=a):A[2]===d&&(p[k]=A.slice(),p[k][2]=a)}for(var M=0;M<r.length;M++)r[M]===d&&(r[M]=a);return p},mw=function(t,r,n,i){for(;n>i;){var s=Math.floor(Math.random()*r.length);r=b6(s,t,r),n--}return r},S6={kargerStein:function(){var t=this,r=this.byGroup(),n=r.nodes,i=r.edges;i.unmergeBy(function(me){return me.isLoop()});var s=n.length,u=i.length,a=Math.ceil(Math.pow(Math.log(s)/Math.LN2,2)),d=Math.floor(s/w6);if(s<2){_n("At least 2 nodes are required for Karger-Stein algorithm");return}for(var p=[],g=0;g<u;g++){var v=i[g];p.push([g,n.indexOf(v.source()),n.indexOf(v.target())])}for(var _=1/0,b=[],k=new Array(s),A=new Array(s),M=new Array(s),P=function(ae,ve){for(var pe=0;pe<s;pe++)ve[pe]=ae[pe]},I=0;I<=a;I++){for(var z=0;z<s;z++)A[z]=z;var O=mw(A,p.slice(),s,d),V=O.slice();P(A,M);var U=mw(A,O,d,2),$=mw(M,V,d,2);U.length<=$.length&&U.length<_?(_=U.length,b=U,P(A,k)):$.length<=U.length&&$.length<_&&(_=$.length,b=$,P(M,k))}for(var G=this.spawn(b.map(function(me){return i[me[0]]})),Z=this.spawn(),Q=this.spawn(),X=k[0],ie=0;ie<k.length;ie++){var te=k[ie],W=n[ie];te===X?Z.merge(W):Q.merge(W)}var oe=function(ae){var ve=t.spawn();return ae.forEach(function(pe){ve.merge(pe),pe.connectedEdges().forEach(function(_e){t.contains(_e)&&!G.contains(_e)&&ve.merge(_e)})}),ve},se=[oe(Z),oe(Q)],de={cut:G,components:se,partition1:Z,partition2:Q};return de}},gw,E6=function(t){return{x:t.x,y:t.y}},O0=function(t,r,n){return{x:t.x*r+n.x,y:t.y*r+n.y}},GN=function(t,r,n){return{x:(t.x-n.x)/r,y:(t.y-n.y)/r}},Jh=function(t){return{x:t[0],y:t[1]}},T6=function(t){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:t.length,i=1/0,s=r;s<n;s++){var u=t[s];isFinite(u)&&(i=Math.min(u,i))}return i},C6=function(t){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:t.length,i=-1/0,s=r;s<n;s++){var u=t[s];isFinite(u)&&(i=Math.max(u,i))}return i},k6=function(t){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:t.length,i=0,s=0,u=r;u<n;u++){var a=t[u];isFinite(a)&&(i+=a,s++)}return i/s},P6=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:t.length,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,u=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0;i?t=t.slice(r,n):(n<t.length&&t.splice(n,t.length-n),r>0&&t.splice(0,r));for(var a=0,d=t.length-1;d>=0;d--){var p=t[d];u?isFinite(p)||(t[d]=-1/0,a++):t.splice(d,1)}s&&t.sort(function(_,b){return _-b});var g=t.length,v=Math.floor(g/2);return g%2!==0?t[v+1+a]:(t[v-1+a]+t[v+a])/2},I6=function(t){return Math.PI*t/180},_v=function(t,r){return Math.atan2(r,t)-Math.PI/2},TS=Math.log2||function(e){return Math.log(e)/Math.log(2)},CS=function(t){return t>0?1:t<0?-1:0},vc=function(t,r){return Math.sqrt(Wu(t,r))},Wu=function(t,r){var n=r.x-t.x,i=r.y-t.y;return n*n+i*i},A6=function(t){for(var r=t.length,n=0,i=0;i<r;i++)n+=t[i];for(var s=0;s<r;s++)t[s]=t[s]/n;return t},ci=function(t,r,n,i){return(1-i)*(1-i)*t+2*(1-i)*i*r+i*i*n},cd=function(t,r,n,i){return{x:ci(t.x,r.x,n.x,i),y:ci(t.y,r.y,n.y,i)}},M6=function(t,r,n,i){var s={x:r.x-t.x,y:r.y-t.y},u=vc(t,r),a={x:s.x/u,y:s.y/u};return n=n??0,i=i??n*u,{x:t.x+a.x*i,y:t.y+a.y*i}},um=function(t,r,n){return Math.max(t,Math.min(n,r))},ta=function(t){if(t==null)return{x1:1/0,y1:1/0,x2:-1/0,y2:-1/0,w:0,h:0};if(t.x1!=null&&t.y1!=null){if(t.x2!=null&&t.y2!=null&&t.x2>=t.x1&&t.y2>=t.y1)return{x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,w:t.x2-t.x1,h:t.y2-t.y1};if(t.w!=null&&t.h!=null&&t.w>=0&&t.h>=0)return{x1:t.x1,y1:t.y1,x2:t.x1+t.w,y2:t.y1+t.h,w:t.w,h:t.h}}},D6=function(t){return{x1:t.x1,x2:t.x2,w:t.w,y1:t.y1,y2:t.y2,h:t.h}},N6=function(t){t.x1=1/0,t.y1=1/0,t.x2=-1/0,t.y2=-1/0,t.w=0,t.h=0},z6=function(t,r){t.x1=Math.min(t.x1,r.x1),t.x2=Math.max(t.x2,r.x2),t.w=t.x2-t.x1,t.y1=Math.min(t.y1,r.y1),t.y2=Math.max(t.y2,r.y2),t.h=t.y2-t.y1},WN=function(t,r,n){t.x1=Math.min(t.x1,r),t.x2=Math.max(t.x2,r),t.w=t.x2-t.x1,t.y1=Math.min(t.y1,n),t.y2=Math.max(t.y2,n),t.h=t.y2-t.y1},iy=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return t.x1-=r,t.x2+=r,t.y1-=r,t.y2+=r,t.w=t.x2-t.x1,t.h=t.y2-t.y1,t},ay=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0],n,i,s,u;if(r.length===1)n=i=s=u=r[0];else if(r.length===2)n=s=r[0],u=i=r[1];else if(r.length===4){var a=Vn(r,4);n=a[0],i=a[1],s=a[2],u=a[3]}return t.x1-=u,t.x2+=i,t.y1-=n,t.y2+=s,t.w=t.x2-t.x1,t.h=t.y2-t.y1,t},Ok=function(t,r){t.x1=r.x1,t.y1=r.y1,t.x2=r.x2,t.y2=r.y2,t.w=t.x2-t.x1,t.h=t.y2-t.y1},kS=function(t,r){return!(t.x1>r.x2||r.x1>t.x2||t.x2<r.x1||r.x2<t.x1||t.y2<r.y1||r.y2<t.y1||t.y1>r.y2||r.y1>t.y2)},jl=function(t,r,n){return t.x1<=r&&r<=t.x2&&t.y1<=n&&n<=t.y2},Fk=function(t,r){return jl(t,r.x,r.y)},ZN=function(t,r){return jl(t,r.x1,r.y1)&&jl(t,r.x2,r.y2)},R6=(gw=Math.hypot)!==null&&gw!==void 0?gw:function(e,t){return Math.sqrt(e*e+t*t)};function L6(e,t){if(e.length<3)throw new Error("Need at least 3 vertices");var r=function(G,Z){return{x:G.x+Z.x,y:G.y+Z.y}},n=function(G,Z){return{x:G.x-Z.x,y:G.y-Z.y}},i=function(G,Z){return{x:G.x*Z,y:G.y*Z}},s=function(G,Z){return G.x*Z.y-G.y*Z.x},u=function(G){var Z=R6(G.x,G.y);return Z===0?{x:0,y:0}:{x:G.x/Z,y:G.y/Z}},a=function(G){for(var Z=0,Q=0;Q<G.length;Q++){var X=G[Q],ie=G[(Q+1)%G.length];Z+=X.x*ie.y-ie.x*X.y}return Z/2},d=function(G,Z,Q,X){var ie=n(Z,G),te=n(X,Q),W=s(ie,te);if(Math.abs(W)<1e-9)return r(G,i(ie,.5));var oe=s(n(Q,G),te)/W;return r(G,i(ie,oe))},p=e.map(function($){return{x:$.x,y:$.y}});a(p)<0&&p.reverse();for(var g=p.length,v=[],_=0;_<g;_++){var b=p[_],k=p[(_+1)%g],A=n(k,b),M=u({x:A.y,y:-A.x});v.push(M)}for(var P=v.map(function($,G){var Z=r(p[G],i($,t)),Q=r(p[(G+1)%g],i($,t));return{p1:Z,p2:Q}}),I=[],z=0;z<g;z++){var O=P[(z-1+g)%g],V=P[z],U=d(O.p1,O.p2,V.p1,V.p2);I.push(U)}return I}function B6(e,t,r,n,i,s){var u=G6(e,t,r,n,i),a=L6(u,s),d=ta();return a.forEach(function(p){return WN(d,p.x,p.y)}),d}var XN=function(t,r,n,i,s,u,a){var d=arguments.length>7&&arguments[7]!==void 0?arguments[7]:"auto",p=d==="auto"?iu(s,u):d,g=s/2,v=u/2;p=Math.min(p,g,v);var _=p!==g,b=p!==v,k;if(_){var A=n-g+p-a,M=i-v-a,P=n+g-p+a,I=M;if(k=$l(t,r,n,i,A,M,P,I,!1),k.length>0)return k}if(b){var z=n+g+a,O=i-v+p-a,V=z,U=i+v-p+a;if(k=$l(t,r,n,i,z,O,V,U,!1),k.length>0)return k}if(_){var $=n-g+p-a,G=i+v+a,Z=n+g-p+a,Q=G;if(k=$l(t,r,n,i,$,G,Z,Q,!1),k.length>0)return k}if(b){var X=n-g-a,ie=i-v+p-a,te=X,W=i+v-p+a;if(k=$l(t,r,n,i,X,ie,te,W,!1),k.length>0)return k}var oe;{var se=n-g+p,de=i-v+p;if(oe=wp(t,r,n,i,se,de,p+a),oe.length>0&&oe[0]<=se&&oe[1]<=de)return[oe[0],oe[1]]}{var me=n+g-p,ae=i-v+p;if(oe=wp(t,r,n,i,me,ae,p+a),oe.length>0&&oe[0]>=me&&oe[1]<=ae)return[oe[0],oe[1]]}{var ve=n+g-p,pe=i+v-p;if(oe=wp(t,r,n,i,ve,pe,p+a),oe.length>0&&oe[0]>=ve&&oe[1]>=pe)return[oe[0],oe[1]]}{var _e=n-g+p,De=i+v-p;if(oe=wp(t,r,n,i,_e,De,p+a),oe.length>0&&oe[0]<=_e&&oe[1]>=De)return[oe[0],oe[1]]}return[]},O6=function(t,r,n,i,s,u,a){var d=a,p=Math.min(n,s),g=Math.max(n,s),v=Math.min(i,u),_=Math.max(i,u);return p-d<=t&&t<=g+d&&v-d<=r&&r<=_+d},F6=function(t,r,n,i,s,u,a,d,p){var g={x1:Math.min(n,a,s)-p,x2:Math.max(n,a,s)+p,y1:Math.min(i,d,u)-p,y2:Math.max(i,d,u)+p};return!(t<g.x1||t>g.x2||r<g.y1||r>g.y2)},j6=function(t,r,n,i){n-=i;var s=r*r-4*t*n;if(s<0)return[];var u=Math.sqrt(s),a=2*t,d=(-r+u)/a,p=(-r-u)/a;return[d,p]},$6=function(t,r,n,i,s){var u=1e-5;t===0&&(t=u),r/=t,n/=t,i/=t;var a,d,p,g,v,_,b,k;if(d=(3*n-r*r)/9,p=-(27*i)+r*(9*n-2*(r*r)),p/=54,a=d*d*d+p*p,s[1]=0,b=r/3,a>0){v=p+Math.sqrt(a),v=v<0?-Math.pow(-v,1/3):Math.pow(v,1/3),_=p-Math.sqrt(a),_=_<0?-Math.pow(-_,1/3):Math.pow(_,1/3),s[0]=-b+v+_,b+=(v+_)/2,s[4]=s[2]=-b,b=Math.sqrt(3)*(-_+v)/2,s[3]=b,s[5]=-b;return}if(s[5]=s[3]=0,a===0){k=p<0?-Math.pow(-p,1/3):Math.pow(p,1/3),s[0]=-b+2*k,s[4]=s[2]=-(k+b);return}d=-d,g=d*d*d,g=Math.acos(p/Math.sqrt(g)),k=2*Math.sqrt(d),s[0]=-b+k*Math.cos(g/3),s[2]=-b+k*Math.cos((g+2*Math.PI)/3),s[4]=-b+k*Math.cos((g+4*Math.PI)/3)},V6=function(t,r,n,i,s,u,a,d){var p=1*n*n-4*n*s+2*n*a+4*s*s-4*s*a+a*a+i*i-4*i*u+2*i*d+4*u*u-4*u*d+d*d,g=1*9*n*s-3*n*n-3*n*a-6*s*s+3*s*a+9*i*u-3*i*i-3*i*d-6*u*u+3*u*d,v=1*3*n*n-6*n*s+n*a-n*t+2*s*s+2*s*t-a*t+3*i*i-6*i*u+i*d-i*r+2*u*u+2*u*r-d*r,_=1*n*s-n*n+n*t-s*t+i*u-i*i+i*r-u*r,b=[];$6(p,g,v,_,b);for(var k=1e-7,A=[],M=0;M<6;M+=2)Math.abs(b[M+1])<k&&b[M]>=0&&b[M]<=1&&A.push(b[M]);A.push(1),A.push(0);for(var P=-1,I,z,O,V=0;V<A.length;V++)I=Math.pow(1-A[V],2)*n+2*(1-A[V])*A[V]*s+A[V]*A[V]*a,z=Math.pow(1-A[V],2)*i+2*(1-A[V])*A[V]*u+A[V]*A[V]*d,O=Math.pow(I-t,2)+Math.pow(z-r,2),P>=0?O<P&&(P=O):P=O;return P},U6=function(t,r,n,i,s,u){var a=[t-n,r-i],d=[s-n,u-i],p=d[0]*d[0]+d[1]*d[1],g=a[0]*a[0]+a[1]*a[1],v=a[0]*d[0]+a[1]*d[1],_=v*v/p;return v<0?g:_>p?(t-s)*(t-s)+(r-u)*(r-u):g-_},pa=function(t,r,n){for(var i,s,u,a,d,p=0,g=0;g<n.length/2;g++)if(i=n[g*2],s=n[g*2+1],g+1<n.length/2?(u=n[(g+1)*2],a=n[(g+1)*2+1]):(u=n[(g+1-n.length/2)*2],a=n[(g+1-n.length/2)*2+1]),!(i==t&&u==t))if(i>=t&&t>=u||i<=t&&t<=u)d=(t-i)/(u-i)*(a-s)+s,d>r&&p++;else continue;return p%2!==0},Oo=function(t,r,n,i,s,u,a,d,p){var g=new Array(n.length),v;d[0]!=null?(v=Math.atan(d[1]/d[0]),d[0]<0?v=v+Math.PI/2:v=-v-Math.PI/2):v=d;for(var _=Math.cos(-v),b=Math.sin(-v),k=0;k<g.length/2;k++)g[k*2]=u/2*(n[k*2]*_-n[k*2+1]*b),g[k*2+1]=a/2*(n[k*2+1]*_+n[k*2]*b),g[k*2]+=i,g[k*2+1]+=s;var A;if(p>0){var M=Wy(g,-p);A=Gy(M)}else A=g;return pa(t,r,A)},q6=function(t,r,n,i,s,u,a,d){for(var p=new Array(n.length*2),g=0;g<d.length;g++){var v=d[g];p[g*4+0]=v.startX,p[g*4+1]=v.startY,p[g*4+2]=v.stopX,p[g*4+3]=v.stopY;var _=Math.pow(v.cx-t,2)+Math.pow(v.cy-r,2);if(_<=Math.pow(v.radius,2))return!0}return pa(t,r,p)},Gy=function(t){for(var r=new Array(t.length/2),n,i,s,u,a,d,p,g,v=0;v<t.length/4;v++){n=t[v*4],i=t[v*4+1],s=t[v*4+2],u=t[v*4+3],v<t.length/4-1?(a=t[(v+1)*4],d=t[(v+1)*4+1],p=t[(v+1)*4+2],g=t[(v+1)*4+3]):(a=t[0],d=t[1],p=t[2],g=t[3]);var _=$l(n,i,s,u,a,d,p,g,!0);r[v*2]=_[0],r[v*2+1]=_[1]}return r},Wy=function(t,r){for(var n=new Array(t.length*2),i,s,u,a,d=0;d<t.length/2;d++){i=t[d*2],s=t[d*2+1],d<t.length/2-1?(u=t[(d+1)*2],a=t[(d+1)*2+1]):(u=t[0],a=t[1]);var p=a-s,g=-(u-i),v=Math.sqrt(p*p+g*g),_=p/v,b=g/v;n[d*4]=i+_*r,n[d*4+1]=s+b*r,n[d*4+2]=u+_*r,n[d*4+3]=a+b*r}return n},H6=function(t,r,n,i,s,u){var a=n-t,d=i-r;a/=s,d/=u;var p=Math.sqrt(a*a+d*d),g=p-1;if(g<0)return[];var v=g/p;return[(n-t)*v+t,(i-r)*v+r]},rc=function(t,r,n,i,s,u,a){return t-=s,r-=u,t/=n/2+a,r/=i/2+a,t*t+r*r<=1},wp=function(t,r,n,i,s,u,a){var d=[n-t,i-r],p=[t-s,r-u],g=d[0]*d[0]+d[1]*d[1],v=2*(p[0]*d[0]+p[1]*d[1]),_=p[0]*p[0]+p[1]*p[1]-a*a,b=v*v-4*g*_;if(b<0)return[];var k=(-v+Math.sqrt(b))/(2*g),A=(-v-Math.sqrt(b))/(2*g),M=Math.min(k,A),P=Math.max(k,A),I=[];if(M>=0&&M<=1&&I.push(M),P>=0&&P<=1&&I.push(P),I.length===0)return[];var z=I[0]*d[0]+t,O=I[0]*d[1]+r;if(I.length>1){if(I[0]==I[1])return[z,O];var V=I[1]*d[0]+t,U=I[1]*d[1]+r;return[z,O,V,U]}else return[z,O]},vw=function(t,r,n){return r<=t&&t<=n||n<=t&&t<=r?t:t<=r&&r<=n||n<=r&&r<=t?r:n},$l=function(t,r,n,i,s,u,a,d,p){var g=t-s,v=n-t,_=a-s,b=r-u,k=i-r,A=d-u,M=_*b-A*g,P=v*b-k*g,I=A*v-_*k;if(I!==0){var z=M/I,O=P/I,V=.001,U=0-V,$=1+V;return U<=z&&z<=$&&U<=O&&O<=$?[t+z*v,r+z*k]:p?[t+z*v,r+z*k]:[]}else return M===0||P===0?vw(t,n,a)===a?[a,d]:vw(t,n,s)===s?[s,u]:vw(s,a,n)===n?[n,i]:[]:[]},G6=function(t,r,n,i,s){var u=[],a=i/2,d=s/2,p=r,g=n;u.push({x:p+a*t[0],y:g+d*t[1]});for(var v=1;v<t.length/2;v++)u.push({x:p+a*t[v*2],y:g+d*t[v*2+1]});return u},cm=function(t,r,n,i,s,u,a,d){var p=[],g,v=new Array(n.length),_=!0;u==null&&(_=!1);var b;if(_){for(var k=0;k<v.length/2;k++)v[k*2]=n[k*2]*u+i,v[k*2+1]=n[k*2+1]*a+s;if(d>0){var A=Wy(v,-d);b=Gy(A)}else b=v}else b=n;for(var M,P,I,z,O=0;O<b.length/2;O++)M=b[O*2],P=b[O*2+1],O<b.length/2-1?(I=b[(O+1)*2],z=b[(O+1)*2+1]):(I=b[0],z=b[1]),g=$l(t,r,i,s,M,P,I,z),g.length!==0&&p.push(g[0],g[1]);return p},W6=function(t,r,n,i,s,u,a,d,p){var g=[],v,_=new Array(n.length*2);p.forEach(function(I,z){z===0?(_[_.length-2]=I.startX,_[_.length-1]=I.startY):(_[z*4-2]=I.startX,_[z*4-1]=I.startY),_[z*4]=I.stopX,_[z*4+1]=I.stopY,v=wp(t,r,i,s,I.cx,I.cy,I.radius),v.length!==0&&g.push(v[0],v[1])});for(var b=0;b<_.length/4;b++)v=$l(t,r,i,s,_[b*4],_[b*4+1],_[b*4+2],_[b*4+3],!1),v.length!==0&&g.push(v[0],v[1]);if(g.length>2){for(var k=[g[0],g[1]],A=Math.pow(k[0]-t,2)+Math.pow(k[1]-r,2),M=1;M<g.length/2;M++){var P=Math.pow(g[M*2]-t,2)+Math.pow(g[M*2+1]-r,2);P<=A&&(k[0]=g[M*2],k[1]=g[M*2+1],A=P)}return k}return g},wv=function(t,r,n){var i=[t[0]-r[0],t[1]-r[1]],s=Math.sqrt(i[0]*i[0]+i[1]*i[1]),u=(s-n)/s;return u<0&&(u=1e-5),[r[0]+u*i[0],r[1]+u*i[1]]},Ji=function(t,r){var n=j1(t,r);return n=KN(n),n},KN=function(t){for(var r,n,i=t.length/2,s=1/0,u=1/0,a=-1/0,d=-1/0,p=0;p<i;p++)r=t[2*p],n=t[2*p+1],s=Math.min(s,r),a=Math.max(a,r),u=Math.min(u,n),d=Math.max(d,n);for(var g=2/(a-s),v=2/(d-u),_=0;_<i;_++)r=t[2*_]=t[2*_]*g,n=t[2*_+1]=t[2*_+1]*v,s=Math.min(s,r),a=Math.max(a,r),u=Math.min(u,n),d=Math.max(d,n);if(u<-1)for(var b=0;b<i;b++)n=t[2*b+1]=t[2*b+1]+(-1-u);return t},j1=function(t,r){var n=1/t*2*Math.PI,i=t%2===0?Math.PI/2+n/2:Math.PI/2;i+=r;for(var s=new Array(t*2),u,a=0;a<t;a++)u=a*n+i,s[2*a]=Math.cos(u),s[2*a+1]=Math.sin(-u);return s},iu=function(t,r){return Math.min(t/4,r/4,8)},YN=function(t,r){return Math.min(t/10,r/10,8)},PS=function(){return 8},Z6=function(t,r,n){return[t-2*r+n,2*(r-t),t]},$1=function(t,r){return{heightOffset:Math.min(15,.05*r),widthOffset:Math.min(100,.25*t),ctrlPtOffsetPct:.05}};function yw(e,t){function r(v){for(var _=[],b=0;b<v.length;b++){var k=v[b],A=v[(b+1)%v.length],M={x:A.x-k.x,y:A.y-k.y},P={x:-M.y,y:M.x},I=Math.sqrt(P.x*P.x+P.y*P.y);_.push({x:P.x/I,y:P.y/I})}return _}function n(v,_){var b=1/0,k=-1/0,A=va(v),M;try{for(A.s();!(M=A.n()).done;){var P=M.value,I=P.x*_.x+P.y*_.y;b=Math.min(b,I),k=Math.max(k,I)}}catch(z){A.e(z)}finally{A.f()}return{min:b,max:k}}function i(v,_){return!(v.max<_.min||_.max<v.min)}var s=[].concat(Vy(r(e)),Vy(r(t))),u=va(s),a;try{for(u.s();!(a=u.n()).done;){var d=a.value,p=n(e,d),g=n(t,d);if(!i(p,g))return!1}}catch(v){u.e(v)}finally{u.f()}return!0}var X6=Ti({dampingFactor:.8,precision:1e-6,iterations:200,weight:function(t){return 1}}),K6={pageRank:function(t){for(var r=X6(t),n=r.dampingFactor,i=r.precision,s=r.iterations,u=r.weight,a=this._private.cy,d=this.byGroup(),p=d.nodes,g=d.edges,v=p.length,_=v*v,b=g.length,k=new Array(_),A=new Array(v),M=(1-n)/v,P=0;P<v;P++){for(var I=0;I<v;I++){var z=P*v+I;k[z]=0}A[P]=0}for(var O=0;O<b;O++){var V=g[O],U=V.data("source"),$=V.data("target");if(U!==$){var G=p.indexOfId(U),Z=p.indexOfId($),Q=u(V),X=Z*v+G;k[X]+=Q,A[G]+=Q}}for(var ie=1/v+M,te=0;te<v;te++)if(A[te]===0)for(var W=0;W<v;W++){var oe=W*v+te;k[oe]=ie}else for(var se=0;se<v;se++){var de=se*v+te;k[de]=k[de]/A[te]+M}for(var me=new Array(v),ae=new Array(v),ve,pe=0;pe<v;pe++)me[pe]=1;for(var _e=0;_e<s;_e++){for(var De=0;De<v;De++)ae[De]=0;for(var Le=0;Le<v;Le++)for(var je=0;je<v;je++){var Je=Le*v+je;ae[Le]+=k[Je]*me[je]}A6(ae),ve=me,me=ae,ae=ve;for(var et=0,ft=0;ft<v;ft++){var rt=ve[ft]-me[ft];et+=rt*rt}if(et<i)break}var Oe={rank:function(Ze){return Ze=a.collection(Ze)[0],me[p.indexOf(Ze)]}};return Oe}},jk=Ti({root:null,weight:function(t){return 1},directed:!1,alpha:0}),hd={degreeCentralityNormalized:function(t){t=jk(t);var r=this.cy(),n=this.nodes(),i=n.length;if(t.directed){for(var g={},v={},_=0,b=0,k=0;k<i;k++){var A=n[k],M=A.id();t.root=A;var P=this.degreeCentrality(t);_<P.indegree&&(_=P.indegree),b<P.outdegree&&(b=P.outdegree),g[M]=P.indegree,v[M]=P.outdegree}return{indegree:function(z){return _==0?0:(sr(z)&&(z=r.filter(z)),g[z.id()]/_)},outdegree:function(z){return b===0?0:(sr(z)&&(z=r.filter(z)),v[z.id()]/b)}}}else{for(var s={},u=0,a=0;a<i;a++){var d=n[a];t.root=d;var p=this.degreeCentrality(t);u<p.degree&&(u=p.degree),s[d.id()]=p.degree}return{degree:function(z){return u===0?0:(sr(z)&&(z=r.filter(z)),s[z.id()]/u)}}}},degreeCentrality:function(t){t=jk(t);var r=this.cy(),n=this,i=t,s=i.root,u=i.weight,a=i.directed,d=i.alpha;if(s=r.collection(s)[0],a){for(var b=s.connectedEdges(),k=b.filter(function(U){return U.target().same(s)&&n.has(U)}),A=b.filter(function(U){return U.source().same(s)&&n.has(U)}),M=k.length,P=A.length,I=0,z=0,O=0;O<k.length;O++)I+=u(k[O]);for(var V=0;V<A.length;V++)z+=u(A[V]);return{indegree:Math.pow(M,1-d)*Math.pow(I,d),outdegree:Math.pow(P,1-d)*Math.pow(z,d)}}else{for(var p=s.connectedEdges().intersection(n),g=p.length,v=0,_=0;_<p.length;_++)v+=u(p[_]);return{degree:Math.pow(g,1-d)*Math.pow(v,d)}}}};hd.dc=hd.degreeCentrality;hd.dcn=hd.degreeCentralityNormalised=hd.degreeCentralityNormalized;var $k=Ti({harmonic:!0,weight:function(){return 1},directed:!1,root:null}),dd={closenessCentralityNormalized:function(t){for(var r=$k(t),n=r.harmonic,i=r.weight,s=r.directed,u=this.cy(),a={},d=0,p=this.nodes(),g=this.floydWarshall({weight:i,directed:s}),v=0;v<p.length;v++){for(var _=0,b=p[v],k=0;k<p.length;k++)if(v!==k){var A=g.distance(b,p[k]);n?_+=1/A:_+=A}n||(_=1/_),d<_&&(d=_),a[b.id()]=_}return{closeness:function(P){return d==0?0:(sr(P)?P=u.filter(P)[0].id():P=P.id(),a[P]/d)}}},closenessCentrality:function(t){var r=$k(t),n=r.root,i=r.weight,s=r.directed,u=r.harmonic;n=this.filter(n)[0];for(var a=this.dijkstra({root:n,weight:i,directed:s}),d=0,p=this.nodes(),g=0;g<p.length;g++){var v=p[g];if(!v.same(n)){var _=a.distanceTo(v);u?d+=1/_:d+=_}}return u?d:1/d}};dd.cc=dd.closenessCentrality;dd.ccn=dd.closenessCentralityNormalised=dd.closenessCentralityNormalized;var Y6=Ti({weight:null,directed:!1}),V1={betweennessCentrality:function(t){for(var r=Y6(t),n=r.directed,i=r.weight,s=i!=null,u=this.cy(),a=this.nodes(),d={},p={},g=0,v={set:function(z,O){p[z]=O,O>g&&(g=O)},get:function(z){return p[z]}},_=0;_<a.length;_++){var b=a[_],k=b.id();n?d[k]=b.outgoers().nodes():d[k]=b.openNeighborhood().nodes(),v.set(k,0)}for(var A=function(){for(var z=a[M].id(),O=[],V={},U={},$={},G=new Vm(function(Le,je){return $[Le]-$[je]}),Z=0;Z<a.length;Z++){var Q=a[Z].id();V[Q]=[],U[Q]=0,$[Q]=1/0}for(U[z]=1,$[z]=0,G.push(z);!G.empty();){var X=G.pop();if(O.push(X),s)for(var ie=0;ie<d[X].length;ie++){var te=d[X][ie],W=u.getElementById(X),oe=void 0;W.edgesTo(te).length>0?oe=W.edgesTo(te)[0]:oe=te.edgesTo(W)[0];var se=i(oe);te=te.id(),$[te]>$[X]+se&&($[te]=$[X]+se,G.nodes.indexOf(te)<0?G.push(te):G.updateItem(te),U[te]=0,V[te]=[]),$[te]==$[X]+se&&(U[te]=U[te]+U[X],V[te].push(X))}else for(var de=0;de<d[X].length;de++){var me=d[X][de].id();$[me]==1/0&&(G.push(me),$[me]=$[X]+1),$[me]==$[X]+1&&(U[me]=U[me]+U[X],V[me].push(X))}}for(var ae={},ve=0;ve<a.length;ve++)ae[a[ve].id()]=0;for(;O.length>0;){for(var pe=O.pop(),_e=0;_e<V[pe].length;_e++){var De=V[pe][_e];ae[De]=ae[De]+U[De]/U[pe]*(1+ae[pe])}pe!=a[M].id()&&v.set(pe,v.get(pe)+ae[pe])}},M=0;M<a.length;M++)A();var P={betweenness:function(z){var O=u.collection(z).id();return v.get(O)},betweennessNormalized:function(z){if(g==0)return 0;var O=u.collection(z).id();return v.get(O)/g}};return P.betweennessNormalised=P.betweennessNormalized,P}};V1.bc=V1.betweennessCentrality;var J6=Ti({expandFactor:2,inflateFactor:2,multFactor:1,maxIterations:20,attributes:[function(e){return 1}]}),Q6=function(t){return J6(t)},e$=function(t,r){for(var n=0,i=0;i<r.length;i++)n+=r[i](t);return n},t$=function(t,r,n){for(var i=0;i<r;i++)t[i*r+i]=n},JN=function(t,r){for(var n,i=0;i<r;i++){n=0;for(var s=0;s<r;s++)n+=t[s*r+i];for(var u=0;u<r;u++)t[u*r+i]=t[u*r+i]/n}},r$=function(t,r,n){for(var i=new Array(n*n),s=0;s<n;s++){for(var u=0;u<n;u++)i[s*n+u]=0;for(var a=0;a<n;a++)for(var d=0;d<n;d++)i[s*n+d]+=t[s*n+a]*r[a*n+d]}return i},n$=function(t,r,n){for(var i=t.slice(0),s=1;s<n;s++)t=r$(t,i,r);return t},i$=function(t,r,n){for(var i=new Array(r*r),s=0;s<r*r;s++)i[s]=Math.pow(t[s],n);return JN(i,r),i},a$=function(t,r,n,i){for(var s=0;s<n;s++){var u=Math.round(t[s]*Math.pow(10,i))/Math.pow(10,i),a=Math.round(r[s]*Math.pow(10,i))/Math.pow(10,i);if(u!==a)return!1}return!0},s$=function(t,r,n,i){for(var s=[],u=0;u<r;u++){for(var a=[],d=0;d<r;d++)Math.round(t[u*r+d]*1e3)/1e3>0&&a.push(n[d]);a.length!==0&&s.push(i.collection(a))}return s},o$=function(t,r){for(var n=0;n<t.length;n++)if(!r[n]||t[n].id()!==r[n].id())return!1;return!0},l$=function(t){for(var r=0;r<t.length;r++)for(var n=0;n<t.length;n++)r!=n&&o$(t[r],t[n])&&t.splice(n,1);return t},Vk=function(t){for(var r=this.nodes(),n=this.edges(),i=this.cy(),s=Q6(t),u={},a=0;a<r.length;a++)u[r[a].id()]=a;for(var d=r.length,p=d*d,g=new Array(p),v,_=0;_<p;_++)g[_]=0;for(var b=0;b<n.length;b++){var k=n[b],A=u[k.source().id()],M=u[k.target().id()],P=e$(k,s.attributes);g[A*d+M]+=P,g[M*d+A]+=P}t$(g,d,s.multFactor),JN(g,d);for(var I=!0,z=0;I&&z<s.maxIterations;)I=!1,v=n$(g,d,s.expandFactor),g=i$(v,d,s.inflateFactor),a$(g,v,p,4)||(I=!0),z++;var O=s$(g,d,r,i);return O=l$(O),O},u$={markovClustering:Vk,mcl:Vk},c$=function(t){return t},QN=function(t,r){return Math.abs(r-t)},Uk=function(t,r,n){return t+QN(r,n)},qk=function(t,r,n){return t+Math.pow(n-r,2)},h$=function(t){return Math.sqrt(t)},d$=function(t,r,n){return Math.max(t,QN(r,n))},rp=function(t,r,n,i,s){for(var u=arguments.length>5&&arguments[5]!==void 0?arguments[5]:c$,a=i,d,p,g=0;g<t;g++)d=r(g),p=n(g),a=s(a,d,p);return u(a)},Cd={euclidean:function(t,r,n){return t>=2?rp(t,r,n,0,qk,h$):rp(t,r,n,0,Uk)},squaredEuclidean:function(t,r,n){return rp(t,r,n,0,qk)},manhattan:function(t,r,n){return rp(t,r,n,0,Uk)},max:function(t,r,n){return rp(t,r,n,-1/0,d$)}};Cd["squared-euclidean"]=Cd.squaredEuclidean;Cd.squaredeuclidean=Cd.squaredEuclidean;function F0(e,t,r,n,i,s){var u;return Cn(e)?u=e:u=Cd[e]||Cd.euclidean,t===0&&Cn(e)?u(i,s):u(t,r,n,i,s)}var f$=Ti({k:2,m:2,sensitivityThreshold:1e-4,distance:"euclidean",maxIterations:10,attributes:[],testMode:!1,testCentroids:null}),IS=function(t){return f$(t)},Zy=function(t,r,n,i,s){var u=s!=="kMedoids",a=u?function(v){return n[v]}:function(v){return i[v](n)},d=function(_){return i[_](r)},p=n,g=r;return F0(t,i.length,a,d,p,g)},xw=function(t,r,n){for(var i=n.length,s=new Array(i),u=new Array(i),a=new Array(r),d=null,p=0;p<i;p++)s[p]=t.min(n[p]).value,u[p]=t.max(n[p]).value;for(var g=0;g<r;g++){d=[];for(var v=0;v<i;v++)d[v]=Math.random()*(u[v]-s[v])+s[v];a[g]=d}return a},ez=function(t,r,n,i,s){for(var u=1/0,a=0,d=0;d<r.length;d++){var p=Zy(n,t,r[d],i,s);p<u&&(u=p,a=d)}return a},tz=function(t,r,n){for(var i=[],s=null,u=0;u<r.length;u++)s=r[u],n[s.id()]===t&&i.push(s);return i},p$=function(t,r,n){return Math.abs(r-t)<=n},m$=function(t,r,n){for(var i=0;i<t.length;i++)for(var s=0;s<t[i].length;s++){var u=Math.abs(t[i][s]-r[i][s]);if(u>n)return!1}return!0},g$=function(t,r,n){for(var i=0;i<n;i++)if(t===r[i])return!0;return!1},Hk=function(t,r){var n=new Array(r);if(t.length<50)for(var i=0;i<r;i++){for(var s=t[Math.floor(Math.random()*t.length)];g$(s,n,i);)s=t[Math.floor(Math.random()*t.length)];n[i]=s}else for(var u=0;u<r;u++)n[u]=t[Math.floor(Math.random()*t.length)];return n},Gk=function(t,r,n){for(var i=0,s=0;s<r.length;s++)i+=Zy("manhattan",r[s],t,n,"kMedoids");return i},v$=function(t){var r=this.cy(),n=this.nodes(),i=null,s=IS(t),u=new Array(s.k),a={},d;s.testMode?typeof s.testCentroids=="number"?(s.testCentroids,d=xw(n,s.k,s.attributes)):Jn(s.testCentroids)==="object"?d=s.testCentroids:d=xw(n,s.k,s.attributes):d=xw(n,s.k,s.attributes);for(var p=!0,g=0;p&&g<s.maxIterations;){for(var v=0;v<n.length;v++)i=n[v],a[i.id()]=ez(i,d,s.distance,s.attributes,"kMeans");p=!1;for(var _=0;_<s.k;_++){var b=tz(_,n,a);if(b.length!==0){for(var k=s.attributes.length,A=d[_],M=new Array(k),P=new Array(k),I=0;I<k;I++){P[I]=0;for(var z=0;z<b.length;z++)i=b[z],P[I]+=s.attributes[I](i);M[I]=P[I]/b.length,p$(M[I],A[I],s.sensitivityThreshold)||(p=!0)}d[_]=M,u[_]=r.collection(b)}}g++}return u},y$=function(t){var r=this.cy(),n=this.nodes(),i=null,s=IS(t),u=new Array(s.k),a,d={},p,g=new Array(s.k);s.testMode?typeof s.testCentroids=="number"||(Jn(s.testCentroids)==="object"?a=s.testCentroids:a=Hk(n,s.k)):a=Hk(n,s.k);for(var v=!0,_=0;v&&_<s.maxIterations;){for(var b=0;b<n.length;b++)i=n[b],d[i.id()]=ez(i,a,s.distance,s.attributes,"kMedoids");v=!1;for(var k=0;k<a.length;k++){var A=tz(k,n,d);if(A.length!==0){g[k]=Gk(a[k],A,s.attributes);for(var M=0;M<A.length;M++)p=Gk(A[M],A,s.attributes),p<g[k]&&(g[k]=p,a[k]=A[M],v=!0);u[k]=r.collection(A)}}_++}return u},x$=function(t,r,n,i,s){for(var u,a,d=0;d<r.length;d++)for(var p=0;p<t.length;p++)i[d][p]=Math.pow(n[d][p],s.m);for(var g=0;g<t.length;g++)for(var v=0;v<s.attributes.length;v++){u=0,a=0;for(var _=0;_<r.length;_++)u+=i[_][g]*s.attributes[v](r[_]),a+=i[_][g];t[g][v]=u/a}},_$=function(t,r,n,i,s){for(var u=0;u<t.length;u++)r[u]=t[u].slice();for(var a,d,p,g=2/(s.m-1),v=0;v<n.length;v++)for(var _=0;_<i.length;_++){a=0;for(var b=0;b<n.length;b++)d=Zy(s.distance,i[_],n[v],s.attributes,"cmeans"),p=Zy(s.distance,i[_],n[b],s.attributes,"cmeans"),a+=Math.pow(d/p,g);t[_][v]=1/a}},w$=function(t,r,n,i){for(var s=new Array(n.k),u=0;u<s.length;u++)s[u]=[];for(var a,d,p=0;p<r.length;p++){a=-1/0,d=-1;for(var g=0;g<r[0].length;g++)r[p][g]>a&&(a=r[p][g],d=g);s[d].push(t[p])}for(var v=0;v<s.length;v++)s[v]=i.collection(s[v]);return s},Wk=function(t){var r=this.cy(),n=this.nodes(),i=IS(t),s,u,a,d,p;d=new Array(n.length);for(var g=0;g<n.length;g++)d[g]=new Array(i.k);a=new Array(n.length);for(var v=0;v<n.length;v++)a[v]=new Array(i.k);for(var _=0;_<n.length;_++){for(var b=0,k=0;k<i.k;k++)a[_][k]=Math.random(),b+=a[_][k];for(var A=0;A<i.k;A++)a[_][A]=a[_][A]/b}u=new Array(i.k);for(var M=0;M<i.k;M++)u[M]=new Array(i.attributes.length);p=new Array(n.length);for(var P=0;P<n.length;P++)p[P]=new Array(i.k);for(var I=!0,z=0;I&&z<i.maxIterations;)I=!1,x$(u,n,a,p,i),_$(a,d,u,n,i),m$(a,d,i.sensitivityThreshold)||(I=!0),z++;return s=w$(n,a,i,r),{clusters:s,degreeOfMembership:a}},b$={kMeans:v$,kMedoids:y$,fuzzyCMeans:Wk,fcm:Wk},S$=Ti({distance:"euclidean",linkage:"min",mode:"threshold",threshold:1/0,addDendrogram:!1,dendrogramDepth:0,attributes:[]}),E$={single:"min",complete:"max"},T$=function(t){var r=S$(t),n=E$[r.linkage];return n!=null&&(r.linkage=n),r},Zk=function(t,r,n,i,s){for(var u=0,a=1/0,d,p=s.attributes,g=function(Z,Q){return F0(s.distance,p.length,function(X){return p[X](Z)},function(X){return p[X](Q)},Z,Q)},v=0;v<t.length;v++){var _=t[v].key,b=n[_][i[_]];b<a&&(u=_,a=b)}if(s.mode==="threshold"&&a>=s.threshold||s.mode==="dendrogram"&&t.length===1)return!1;var k=r[u],A=r[i[u]],M;s.mode==="dendrogram"?M={left:k,right:A,key:k.key}:M={value:k.value.concat(A.value),key:k.key},t[k.index]=M,t.splice(A.index,1),r[k.key]=M;for(var P=0;P<t.length;P++){var I=t[P];k.key===I.key?d=1/0:s.linkage==="min"?(d=n[k.key][I.key],n[k.key][I.key]>n[A.key][I.key]&&(d=n[A.key][I.key])):s.linkage==="max"?(d=n[k.key][I.key],n[k.key][I.key]<n[A.key][I.key]&&(d=n[A.key][I.key])):s.linkage==="mean"?d=(n[k.key][I.key]*k.size+n[A.key][I.key]*A.size)/(k.size+A.size):s.mode==="dendrogram"?d=g(I.value,k.value):d=g(I.value[0],k.value[0]),n[k.key][I.key]=n[I.key][k.key]=d}for(var z=0;z<t.length;z++){var O=t[z].key;if(i[O]===k.key||i[O]===A.key){for(var V=O,U=0;U<t.length;U++){var $=t[U].key;n[O][$]<n[O][V]&&(V=$)}i[O]=V}t[z].index=z}return k.key=A.key=k.index=A.index=null,!0},Qh=function(t,r,n){t&&(t.value?r.push(t.value):(t.left&&Qh(t.left,r),t.right&&Qh(t.right,r)))},U1=function(t,r){if(!t)return"";if(t.left&&t.right){var n=U1(t.left,r),i=U1(t.right,r),s=r.add({group:"nodes",data:{id:n+","+i}});return r.add({group:"edges",data:{source:n,target:s.id()}}),r.add({group:"edges",data:{source:i,target:s.id()}}),s.id()}else if(t.value)return t.value.id()},q1=function(t,r,n){if(!t)return[];var i=[],s=[],u=[];return r===0?(t.left&&Qh(t.left,i),t.right&&Qh(t.right,s),u=i.concat(s),[n.collection(u)]):r===1?t.value?[n.collection(t.value)]:(t.left&&Qh(t.left,i),t.right&&Qh(t.right,s),[n.collection(i),n.collection(s)]):t.value?[n.collection(t.value)]:(t.left&&(i=q1(t.left,r-1,n)),t.right&&(s=q1(t.right,r-1,n)),i.concat(s))},Xk=function(t){for(var r=this.cy(),n=this.nodes(),i=T$(t),s=i.attributes,u=function(z,O){return F0(i.distance,s.length,function(V){return s[V](z)},function(V){return s[V](O)},z,O)},a=[],d=[],p=[],g=[],v=0;v<n.length;v++){var _={value:i.mode==="dendrogram"?n[v]:[n[v]],key:v,index:v};a[v]=_,g[v]=_,d[v]=[],p[v]=0}for(var b=0;b<a.length;b++)for(var k=0;k<=b;k++){var A=void 0;i.mode==="dendrogram"?A=b===k?1/0:u(a[b].value,a[k].value):A=b===k?1/0:u(a[b].value[0],a[k].value[0]),d[b][k]=A,d[k][b]=A,A<d[b][p[b]]&&(p[b]=k)}for(var M=Zk(a,g,d,p,i);M;)M=Zk(a,g,d,p,i);var P;return i.mode==="dendrogram"?(P=q1(a[0],i.dendrogramDepth,r),i.addDendrogram&&U1(a[0],r)):(P=new Array(a.length),a.forEach(function(I,z){I.key=I.index=null,P[z]=r.collection(I.value)})),P},C$={hierarchicalClustering:Xk,hca:Xk},k$=Ti({distance:"euclidean",preference:"median",damping:.8,maxIterations:1e3,minIterations:100,attributes:[]}),P$=function(t){var r=t.damping,n=t.preference;.5<=r&&r<1||_n("Damping must range on [0.5, 1).  Got: ".concat(r));var i=["median","mean","min","max"];return i.some(function(s){return s===n})||Rt(n)||_n("Preference must be one of [".concat(i.map(function(s){return"'".concat(s,"'")}).join(", "),"] or a number.  Got: ").concat(n)),k$(t)},I$=function(t,r,n,i){var s=function(a,d){return i[d](a)};return-F0(t,i.length,function(u){return s(r,u)},function(u){return s(n,u)},r,n)},A$=function(t,r){var n=null;return r==="median"?n=P6(t):r==="mean"?n=k6(t):r==="min"?n=T6(t):r==="max"?n=C6(t):n=r,n},M$=function(t,r,n){for(var i=[],s=0;s<t;s++)r[s*t+s]+n[s*t+s]>0&&i.push(s);return i},Kk=function(t,r,n){for(var i=[],s=0;s<t;s++){for(var u=-1,a=-1/0,d=0;d<n.length;d++){var p=n[d];r[s*t+p]>a&&(u=p,a=r[s*t+p])}u>0&&i.push(u)}for(var g=0;g<n.length;g++)i[n[g]]=n[g];return i},D$=function(t,r,n){for(var i=Kk(t,r,n),s=0;s<n.length;s++){for(var u=[],a=0;a<i.length;a++)i[a]===n[s]&&u.push(a);for(var d=-1,p=-1/0,g=0;g<u.length;g++){for(var v=0,_=0;_<u.length;_++)v+=r[u[_]*t+u[g]];v>p&&(d=g,p=v)}n[s]=u[d]}return i=Kk(t,r,n),i},Yk=function(t){for(var r=this.cy(),n=this.nodes(),i=P$(t),s={},u=0;u<n.length;u++)s[n[u].id()]=u;var a,d,p,g,v,_;a=n.length,d=a*a,p=new Array(d);for(var b=0;b<d;b++)p[b]=-1/0;for(var k=0;k<a;k++)for(var A=0;A<a;A++)k!==A&&(p[k*a+A]=I$(i.distance,n[k],n[A],i.attributes));g=A$(p,i.preference);for(var M=0;M<a;M++)p[M*a+M]=g;v=new Array(d);for(var P=0;P<d;P++)v[P]=0;_=new Array(d);for(var I=0;I<d;I++)_[I]=0;for(var z=new Array(a),O=new Array(a),V=new Array(a),U=0;U<a;U++)z[U]=0,O[U]=0,V[U]=0;for(var $=new Array(a*i.minIterations),G=0;G<$.length;G++)$[G]=0;var Z;for(Z=0;Z<i.maxIterations;Z++){for(var Q=0;Q<a;Q++){for(var X=-1/0,ie=-1/0,te=-1,W=0,oe=0;oe<a;oe++)z[oe]=v[Q*a+oe],W=_[Q*a+oe]+p[Q*a+oe],W>=X?(ie=X,X=W,te=oe):W>ie&&(ie=W);for(var se=0;se<a;se++)v[Q*a+se]=(1-i.damping)*(p[Q*a+se]-X)+i.damping*z[se];v[Q*a+te]=(1-i.damping)*(p[Q*a+te]-ie)+i.damping*z[te]}for(var de=0;de<a;de++){for(var me=0,ae=0;ae<a;ae++)z[ae]=_[ae*a+de],O[ae]=Math.max(0,v[ae*a+de]),me+=O[ae];me-=O[de],O[de]=v[de*a+de],me+=O[de];for(var ve=0;ve<a;ve++)_[ve*a+de]=(1-i.damping)*Math.min(0,me-O[ve])+i.damping*z[ve];_[de*a+de]=(1-i.damping)*(me-O[de])+i.damping*z[de]}for(var pe=0,_e=0;_e<a;_e++){var De=_[_e*a+_e]+v[_e*a+_e]>0?1:0;$[Z%i.minIterations*a+_e]=De,pe+=De}if(pe>0&&(Z>=i.minIterations-1||Z==i.maxIterations-1)){for(var Le=0,je=0;je<a;je++){V[je]=0;for(var Je=0;Je<i.minIterations;Je++)V[je]+=$[Je*a+je];(V[je]===0||V[je]===i.minIterations)&&Le++}if(Le===a)break}}for(var et=M$(a,v,_),ft=D$(a,p,et),rt={},Oe=0;Oe<et.length;Oe++)rt[et[Oe]]=[];for(var Ge=0;Ge<n.length;Ge++){var Ze=s[n[Ge].id()],it=ft[Ze];it!=null&&rt[it].push(n[Ge])}for(var mt=new Array(et.length),Tt=0;Tt<et.length;Tt++)mt[Tt]=r.collection(rt[et[Tt]]);return mt},N$={affinityPropagation:Yk,ap:Yk},z$=Ti({root:void 0,directed:!1}),R$={hierholzer:function(t){if(!Fr(t)){var r=arguments;t={root:r[0],directed:r[1]}}var n=z$(t),i=n.root,s=n.directed,u=this,a=!1,d,p,g;i&&(g=sr(i)?this.filter(i)[0].id():i[0].id());var v={},_={};s?u.forEach(function(I){var z=I.id();if(I.isNode()){var O=I.indegree(!0),V=I.outdegree(!0),U=O-V,$=V-O;U==1?d?a=!0:d=z:$==1?p?a=!0:p=z:($>1||U>1)&&(a=!0),v[z]=[],I.outgoers().forEach(function(G){G.isEdge()&&v[z].push(G.id())})}else _[z]=[void 0,I.target().id()]}):u.forEach(function(I){var z=I.id();if(I.isNode()){var O=I.degree(!0);O%2&&(d?p?a=!0:p=z:d=z),v[z]=[],I.connectedEdges().forEach(function(V){return v[z].push(V.id())})}else _[z]=[I.source().id(),I.target().id()]});var b={found:!1,trail:void 0};if(a)return b;if(p&&d)if(s){if(g&&p!=g)return b;g=p}else{if(g&&p!=g&&d!=g)return b;g||(g=p)}else g||(g=u[0].id());var k=function(z){for(var O=z,V=[z],U,$,G;v[O].length;)U=v[O].shift(),$=_[U][0],G=_[U][1],O!=G?(v[G]=v[G].filter(function(Z){return Z!=U}),O=G):!s&&O!=$&&(v[$]=v[$].filter(function(Z){return Z!=U}),O=$),V.unshift(U),V.unshift(O);return V},A=[],M=[];for(M=k(g);M.length!=1;)v[M[0]].length==0?(A.unshift(u.getElementById(M.shift())),A.unshift(u.getElementById(M.shift()))):M=k(M.shift()).concat(M);A.unshift(u.getElementById(M.shift()));for(var P in v)if(v[P].length)return b;return b.found=!0,b.trail=this.spawn(A,!0),b}},bv=function(){var t=this,r={},n=0,i=0,s=[],u=[],a={},d=function(_,b){for(var k=u.length-1,A=[],M=t.spawn();u[k].x!=_||u[k].y!=b;)A.push(u.pop().edge),k--;A.push(u.pop().edge),A.forEach(function(P){var I=P.connectedNodes().intersection(t);M.merge(P),I.forEach(function(z){var O=z.id(),V=z.connectedEdges().intersection(t);M.merge(z),r[O].cutVertex?M.merge(V.filter(function(U){return U.isLoop()})):M.merge(V)})}),s.push(M)},p=function(_,b,k){_===k&&(i+=1),r[b]={id:n,low:n++,cutVertex:!1};var A=t.getElementById(b).connectedEdges().intersection(t);if(A.size()===0)s.push(t.spawn(t.getElementById(b)));else{var M,P,I,z;A.forEach(function(O){M=O.source().id(),P=O.target().id(),I=M===b?P:M,I!==k&&(z=O.id(),a[z]||(a[z]=!0,u.push({x:b,y:I,edge:O})),I in r?r[b].low=Math.min(r[b].low,r[I].id):(p(_,I,b),r[b].low=Math.min(r[b].low,r[I].low),r[b].id<=r[I].low&&(r[b].cutVertex=!0,d(b,I))))})}};t.forEach(function(v){if(v.isNode()){var _=v.id();_ in r||(i=0,p(_,_),r[_].cutVertex=i>1)}});var g=Object.keys(r).filter(function(v){return r[v].cutVertex}).map(function(v){return t.getElementById(v)});return{cut:t.spawn(g),components:s}},L$={hopcroftTarjanBiconnected:bv,htbc:bv,htb:bv,hopcroftTarjanBiconnectedComponents:bv},Sv=function(){var t=this,r={},n=0,i=[],s=[],u=t.spawn(t),a=function(p){s.push(p),r[p]={index:n,low:n++,explored:!1};var g=t.getElementById(p).connectedEdges().intersection(t);if(g.forEach(function(A){var M=A.target().id();M!==p&&(M in r||a(M),r[M].explored||(r[p].low=Math.min(r[p].low,r[M].low)))}),r[p].index===r[p].low){for(var v=t.spawn();;){var _=s.pop();if(v.merge(t.getElementById(_)),r[_].low=r[p].index,r[_].explored=!0,_===p)break}var b=v.edgesWith(v),k=v.merge(b);i.push(k),u=u.difference(k)}};return t.forEach(function(d){if(d.isNode()){var p=d.id();p in r||a(p)}}),{cut:u,components:i}},B$={tarjanStronglyConnected:Sv,tsc:Sv,tscc:Sv,tarjanStronglyConnectedComponents:Sv},rz={};[lm,f6,p6,g6,y6,_6,S6,K6,hd,dd,V1,u$,b$,C$,N$,R$,L$,B$].forEach(function(e){dr(rz,e)});/*!
Embeddable Minimum Strictly-Compliant Promises/A+ 1.1.1 Thenable
Copyright (c) 2013-2014 Ralf S. Engelschall (http://engelschall.com)
Licensed under The MIT License (http://opensource.org/licenses/MIT)
*/var nz=0,iz=1,az=2,Is=function(t){if(!(this instanceof Is))return new Is(t);this.id="Thenable/1.0.7",this.state=nz,this.fulfillValue=void 0,this.rejectReason=void 0,this.onFulfilled=[],this.onRejected=[],this.proxy={then:this.then.bind(this)},typeof t=="function"&&t.call(this,this.fulfill.bind(this),this.reject.bind(this))};Is.prototype={fulfill:function(t){return Jk(this,iz,"fulfillValue",t)},reject:function(t){return Jk(this,az,"rejectReason",t)},then:function(t,r){var n=this,i=new Is;return n.onFulfilled.push(eP(t,i,"fulfill")),n.onRejected.push(eP(r,i,"reject")),sz(n),i.proxy}};var Jk=function(t,r,n,i){return t.state===nz&&(t.state=r,t[n]=i,sz(t)),t},sz=function(t){t.state===iz?Qk(t,"onFulfilled",t.fulfillValue):t.state===az&&Qk(t,"onRejected",t.rejectReason)},Qk=function(t,r,n){if(t[r].length!==0){var i=t[r];t[r]=[];var s=function(){for(var a=0;a<i.length;a++)i[a](n)};typeof setImmediate=="function"?setImmediate(s):setTimeout(s,0)}},eP=function(t,r,n){return function(i){if(typeof t!="function")r[n].call(r,i);else{var s;try{s=t(i)}catch(u){r.reject(u);return}oz(r,s)}}},oz=function(t,r){if(t===r||t.proxy===r){t.reject(new TypeError("cannot resolve promise with itself"));return}var n;if(Jn(r)==="object"&&r!==null||typeof r=="function")try{n=r.then}catch(s){t.reject(s);return}if(typeof n=="function"){var i=!1;try{n.call(r,function(s){i||(i=!0,s===r?t.reject(new TypeError("circular thenable chain")):oz(t,s))},function(s){i||(i=!0,t.reject(s))})}catch(s){i||t.reject(s)}return}t.fulfill(r)};Is.all=function(e){return new Is(function(t,r){for(var n=new Array(e.length),i=0,s=function(d,p){n[d]=p,i++,i===e.length&&t(n)},u=0;u<e.length;u++)(function(a){var d=e[a],p=d!=null&&d.then!=null;if(p)d.then(function(v){s(a,v)},function(v){r(v)});else{var g=d;s(a,g)}})(u)})};Is.resolve=function(e){return new Is(function(t,r){t(e)})};Is.reject=function(e){return new Is(function(t,r){r(e)})};var Bd=typeof Promise<"u"?Promise:Is,H1=function(t,r,n){var i=xS(t),s=!i,u=this._private=dr({duration:1e3},r,n);if(u.target=t,u.style=u.style||u.css,u.started=!1,u.playing=!1,u.hooked=!1,u.applying=!1,u.progress=0,u.completes=[],u.frames=[],u.complete&&Cn(u.complete)&&u.completes.push(u.complete),s){var a=t.position();u.startPosition=u.startPosition||{x:a.x,y:a.y},u.startStyle=u.startStyle||t.cy().style().getAnimationStartStyle(t,u.style)}if(i){var d=t.pan();u.startPan={x:d.x,y:d.y},u.startZoom=t.zoom()}this.length=1,this[0]=this},yc=H1.prototype;dr(yc,{instanceString:function(){return"animation"},hook:function(){var t=this._private;if(!t.hooked){var r,n=t.target._private.animation;t.queue?r=n.queue:r=n.current,r.push(this),La(t.target)&&t.target.cy().addToAnimationPool(t.target),t.hooked=!0}return this},play:function(){var t=this._private;return t.progress===1&&(t.progress=0),t.playing=!0,t.started=!1,t.stopped=!1,this.hook(),this},playing:function(){return this._private.playing},apply:function(){var t=this._private;return t.applying=!0,t.started=!1,t.stopped=!1,this.hook(),this},applying:function(){return this._private.applying},pause:function(){var t=this._private;return t.playing=!1,t.started=!1,this},stop:function(){var t=this._private;return t.playing=!1,t.started=!1,t.stopped=!0,this},rewind:function(){return this.progress(0)},fastforward:function(){return this.progress(1)},time:function(t){var r=this._private;return t===void 0?r.progress*r.duration:this.progress(t/r.duration)},progress:function(t){var r=this._private,n=r.playing;return t===void 0?r.progress:(n&&this.pause(),r.progress=t,r.started=!1,n&&this.play(),this)},completed:function(){return this._private.progress===1},reverse:function(){var t=this._private,r=t.playing;r&&this.pause(),t.progress=1-t.progress,t.started=!1;var n=function(p,g){var v=t[p];v!=null&&(t[p]=t[g],t[g]=v)};if(n("zoom","startZoom"),n("pan","startPan"),n("position","startPosition"),t.style)for(var i=0;i<t.style.length;i++){var s=t.style[i],u=s.name,a=t.startStyle[u];t.startStyle[u]=s,t.style[i]=a}return r&&this.play(),this},promise:function(t){var r=this._private,n;switch(t){case"frame":n=r.frames;break;default:case"complete":case"completed":n=r.completes}return new Bd(function(i,s){n.push(function(){i()})})}});yc.complete=yc.completed;yc.run=yc.play;yc.running=yc.playing;var O$={animated:function(){return function(){var r=this,n=r.length!==void 0,i=n?r:[r],s=this._private.cy||this;if(!s.styleEnabled())return!1;var u=i[0];if(u)return u._private.animation.current.length>0}},clearQueue:function(){return function(){var r=this,n=r.length!==void 0,i=n?r:[r],s=this._private.cy||this;if(!s.styleEnabled())return this;for(var u=0;u<i.length;u++){var a=i[u];a._private.animation.queue=[]}return this}},delay:function(){return function(r,n){var i=this._private.cy||this;return i.styleEnabled()?this.animate({delay:r,duration:r,complete:n}):this}},delayAnimation:function(){return function(r,n){var i=this._private.cy||this;return i.styleEnabled()?this.animation({delay:r,duration:r,complete:n}):this}},animation:function(){return function(r,n){var i=this,s=i.length!==void 0,u=s?i:[i],a=this._private.cy||this,d=!s,p=!d;if(!a.styleEnabled())return this;var g=a.style();r=dr({},r,n);var v=Object.keys(r).length===0;if(v)return new H1(u[0],r);switch(r.duration===void 0&&(r.duration=400),r.duration){case"slow":r.duration=600;break;case"fast":r.duration=200;break}if(p&&(r.style=g.getPropsList(r.style||r.css),r.css=void 0),p&&r.renderedPosition!=null){var _=r.renderedPosition,b=a.pan(),k=a.zoom();r.position=GN(_,k,b)}if(d&&r.panBy!=null){var A=r.panBy,M=a.pan();r.pan={x:M.x+A.x,y:M.y+A.y}}var P=r.center||r.centre;if(d&&P!=null){var I=a.getCenterPan(P.eles,r.zoom);I!=null&&(r.pan=I)}if(d&&r.fit!=null){var z=r.fit,O=a.getFitViewport(z.eles||z.boundingBox,z.padding);O!=null&&(r.pan=O.pan,r.zoom=O.zoom)}if(d&&Fr(r.zoom)){var V=a.getZoomedViewport(r.zoom);V!=null?(V.zoomed&&(r.zoom=V.zoom),V.panned&&(r.pan=V.pan)):r.zoom=null}return new H1(u[0],r)}},animate:function(){return function(r,n){var i=this,s=i.length!==void 0,u=s?i:[i],a=this._private.cy||this;if(!a.styleEnabled())return this;n&&(r=dr({},r,n));for(var d=0;d<u.length;d++){var p=u[d],g=p.animated()&&(r.queue===void 0||r.queue),v=p.animation(r,g?{queue:!0}:void 0);v.play()}return this}},stop:function(){return function(r,n){var i=this,s=i.length!==void 0,u=s?i:[i],a=this._private.cy||this;if(!a.styleEnabled())return this;for(var d=0;d<u.length;d++){for(var p=u[d],g=p._private,v=g.animation.current,_=0;_<v.length;_++){var b=v[_],k=b._private;n&&(k.duration=0)}r&&(g.animation.queue=[]),n||(g.animation.current=[])}return a.notify("draw"),this}}},_w,tP;function j0(){if(tP)return _w;tP=1;var e=Array.isArray;return _w=e,_w}var ww,rP;function F$(){if(rP)return ww;rP=1;var e=j0(),t=jm(),r=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,n=/^\w*$/;function i(s,u){if(e(s))return!1;var a=typeof s;return a=="number"||a=="symbol"||a=="boolean"||s==null||t(s)?!0:n.test(s)||!r.test(s)||u!=null&&s in Object(u)}return ww=i,ww}var bw,nP;function j$(){if(nP)return bw;nP=1;var e=BN(),t=Fm(),r="[object AsyncFunction]",n="[object Function]",i="[object GeneratorFunction]",s="[object Proxy]";function u(a){if(!t(a))return!1;var d=e(a);return d==n||d==i||d==r||d==s}return bw=u,bw}var Sw,iP;function $$(){if(iP)return Sw;iP=1;var e=L0(),t=e["__core-js_shared__"];return Sw=t,Sw}var Ew,aP;function V$(){if(aP)return Ew;aP=1;var e=$$(),t=function(){var n=/[^.]+$/.exec(e&&e.keys&&e.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}();function r(n){return!!t&&t in n}return Ew=r,Ew}var Tw,sP;function U$(){if(sP)return Tw;sP=1;var e=Function.prototype,t=e.toString;function r(n){if(n!=null){try{return t.call(n)}catch{}try{return n+""}catch{}}return""}return Tw=r,Tw}var Cw,oP;function q$(){if(oP)return Cw;oP=1;var e=j$(),t=V$(),r=Fm(),n=U$(),i=/[\\^$.*+?()[\]{}|]/g,s=/^\[object .+?Constructor\]$/,u=Function.prototype,a=Object.prototype,d=u.toString,p=a.hasOwnProperty,g=RegExp("^"+d.call(p).replace(i,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function v(_){if(!r(_)||t(_))return!1;var b=e(_)?g:s;return b.test(n(_))}return Cw=v,Cw}var kw,lP;function H$(){if(lP)return kw;lP=1;function e(t,r){return t==null?void 0:t[r]}return kw=e,kw}var Pw,uP;function AS(){if(uP)return Pw;uP=1;var e=q$(),t=H$();function r(n,i){var s=t(n,i);return e(s)?s:void 0}return Pw=r,Pw}var Iw,cP;function $0(){if(cP)return Iw;cP=1;var e=AS(),t=e(Object,"create");return Iw=t,Iw}var Aw,hP;function G$(){if(hP)return Aw;hP=1;var e=$0();function t(){this.__data__=e?e(null):{},this.size=0}return Aw=t,Aw}var Mw,dP;function W$(){if(dP)return Mw;dP=1;function e(t){var r=this.has(t)&&delete this.__data__[t];return this.size-=r?1:0,r}return Mw=e,Mw}var Dw,fP;function Z$(){if(fP)return Dw;fP=1;var e=$0(),t="__lodash_hash_undefined__",r=Object.prototype,n=r.hasOwnProperty;function i(s){var u=this.__data__;if(e){var a=u[s];return a===t?void 0:a}return n.call(u,s)?u[s]:void 0}return Dw=i,Dw}var Nw,pP;function X$(){if(pP)return Nw;pP=1;var e=$0(),t=Object.prototype,r=t.hasOwnProperty;function n(i){var s=this.__data__;return e?s[i]!==void 0:r.call(s,i)}return Nw=n,Nw}var zw,mP;function K$(){if(mP)return zw;mP=1;var e=$0(),t="__lodash_hash_undefined__";function r(n,i){var s=this.__data__;return this.size+=this.has(n)?0:1,s[n]=e&&i===void 0?t:i,this}return zw=r,zw}var Rw,gP;function Y$(){if(gP)return Rw;gP=1;var e=G$(),t=W$(),r=Z$(),n=X$(),i=K$();function s(u){var a=-1,d=u==null?0:u.length;for(this.clear();++a<d;){var p=u[a];this.set(p[0],p[1])}}return s.prototype.clear=e,s.prototype.delete=t,s.prototype.get=r,s.prototype.has=n,s.prototype.set=i,Rw=s,Rw}var Lw,vP;function J$(){if(vP)return Lw;vP=1;function e(){this.__data__=[],this.size=0}return Lw=e,Lw}var Bw,yP;function lz(){if(yP)return Bw;yP=1;function e(t,r){return t===r||t!==t&&r!==r}return Bw=e,Bw}var Ow,xP;function V0(){if(xP)return Ow;xP=1;var e=lz();function t(r,n){for(var i=r.length;i--;)if(e(r[i][0],n))return i;return-1}return Ow=t,Ow}var Fw,_P;function Q$(){if(_P)return Fw;_P=1;var e=V0(),t=Array.prototype,r=t.splice;function n(i){var s=this.__data__,u=e(s,i);if(u<0)return!1;var a=s.length-1;return u==a?s.pop():r.call(s,u,1),--this.size,!0}return Fw=n,Fw}var jw,wP;function eV(){if(wP)return jw;wP=1;var e=V0();function t(r){var n=this.__data__,i=e(n,r);return i<0?void 0:n[i][1]}return jw=t,jw}var $w,bP;function tV(){if(bP)return $w;bP=1;var e=V0();function t(r){return e(this.__data__,r)>-1}return $w=t,$w}var Vw,SP;function rV(){if(SP)return Vw;SP=1;var e=V0();function t(r,n){var i=this.__data__,s=e(i,r);return s<0?(++this.size,i.push([r,n])):i[s][1]=n,this}return Vw=t,Vw}var Uw,EP;function nV(){if(EP)return Uw;EP=1;var e=J$(),t=Q$(),r=eV(),n=tV(),i=rV();function s(u){var a=-1,d=u==null?0:u.length;for(this.clear();++a<d;){var p=u[a];this.set(p[0],p[1])}}return s.prototype.clear=e,s.prototype.delete=t,s.prototype.get=r,s.prototype.has=n,s.prototype.set=i,Uw=s,Uw}var qw,TP;function iV(){if(TP)return qw;TP=1;var e=AS(),t=L0(),r=e(t,"Map");return qw=r,qw}var Hw,CP;function aV(){if(CP)return Hw;CP=1;var e=Y$(),t=nV(),r=iV();function n(){this.size=0,this.__data__={hash:new e,map:new(r||t),string:new e}}return Hw=n,Hw}var Gw,kP;function sV(){if(kP)return Gw;kP=1;function e(t){var r=typeof t;return r=="string"||r=="number"||r=="symbol"||r=="boolean"?t!=="__proto__":t===null}return Gw=e,Gw}var Ww,PP;function U0(){if(PP)return Ww;PP=1;var e=sV();function t(r,n){var i=r.__data__;return e(n)?i[typeof n=="string"?"string":"hash"]:i.map}return Ww=t,Ww}var Zw,IP;function oV(){if(IP)return Zw;IP=1;var e=U0();function t(r){var n=e(this,r).delete(r);return this.size-=n?1:0,n}return Zw=t,Zw}var Xw,AP;function lV(){if(AP)return Xw;AP=1;var e=U0();function t(r){return e(this,r).get(r)}return Xw=t,Xw}var Kw,MP;function uV(){if(MP)return Kw;MP=1;var e=U0();function t(r){return e(this,r).has(r)}return Kw=t,Kw}var Yw,DP;function cV(){if(DP)return Yw;DP=1;var e=U0();function t(r,n){var i=e(this,r),s=i.size;return i.set(r,n),this.size+=i.size==s?0:1,this}return Yw=t,Yw}var Jw,NP;function hV(){if(NP)return Jw;NP=1;var e=aV(),t=oV(),r=lV(),n=uV(),i=cV();function s(u){var a=-1,d=u==null?0:u.length;for(this.clear();++a<d;){var p=u[a];this.set(p[0],p[1])}}return s.prototype.clear=e,s.prototype.delete=t,s.prototype.get=r,s.prototype.has=n,s.prototype.set=i,Jw=s,Jw}var Qw,zP;function dV(){if(zP)return Qw;zP=1;var e=hV(),t="Expected a function";function r(n,i){if(typeof n!="function"||i!=null&&typeof i!="function")throw new TypeError(t);var s=function(){var u=arguments,a=i?i.apply(this,u):u[0],d=s.cache;if(d.has(a))return d.get(a);var p=n.apply(this,u);return s.cache=d.set(a,p)||d,p};return s.cache=new(r.Cache||e),s}return r.Cache=e,Qw=r,Qw}var eb,RP;function fV(){if(RP)return eb;RP=1;var e=dV(),t=500;function r(n){var i=e(n,function(u){return s.size===t&&s.clear(),u}),s=i.cache;return i}return eb=r,eb}var tb,LP;function uz(){if(LP)return tb;LP=1;var e=fV(),t=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,r=/\\(\\)?/g,n=e(function(i){var s=[];return i.charCodeAt(0)===46&&s.push(""),i.replace(t,function(u,a,d,p){s.push(d?p.replace(r,"$1"):a||u)}),s});return tb=n,tb}var rb,BP;function cz(){if(BP)return rb;BP=1;function e(t,r){for(var n=-1,i=t==null?0:t.length,s=Array(i);++n<i;)s[n]=r(t[n],n,t);return s}return rb=e,rb}var nb,OP;function pV(){if(OP)return nb;OP=1;var e=wS(),t=cz(),r=j0(),n=jm(),i=e?e.prototype:void 0,s=i?i.toString:void 0;function u(a){if(typeof a=="string")return a;if(r(a))return t(a,u)+"";if(n(a))return s?s.call(a):"";var d=a+"";return d=="0"&&1/a==-1/0?"-0":d}return nb=u,nb}var ib,FP;function hz(){if(FP)return ib;FP=1;var e=pV();function t(r){return r==null?"":e(r)}return ib=t,ib}var ab,jP;function dz(){if(jP)return ab;jP=1;var e=j0(),t=F$(),r=uz(),n=hz();function i(s,u){return e(s)?s:t(s,u)?[s]:r(n(s))}return ab=i,ab}var sb,$P;function MS(){if($P)return sb;$P=1;var e=jm();function t(r){if(typeof r=="string"||e(r))return r;var n=r+"";return n=="0"&&1/r==-1/0?"-0":n}return sb=t,sb}var ob,VP;function mV(){if(VP)return ob;VP=1;var e=dz(),t=MS();function r(n,i){i=e(i,n);for(var s=0,u=i.length;n!=null&&s<u;)n=n[t(i[s++])];return s&&s==u?n:void 0}return ob=r,ob}var lb,UP;function gV(){if(UP)return lb;UP=1;var e=mV();function t(r,n,i){var s=r==null?void 0:e(r,n);return s===void 0?i:s}return lb=t,lb}var vV=gV(),yV=Om(vV),ub,qP;function xV(){if(qP)return ub;qP=1;var e=AS(),t=function(){try{var r=e(Object,"defineProperty");return r({},"",{}),r}catch{}}();return ub=t,ub}var cb,HP;function _V(){if(HP)return cb;HP=1;var e=xV();function t(r,n,i){n=="__proto__"&&e?e(r,n,{configurable:!0,enumerable:!0,value:i,writable:!0}):r[n]=i}return cb=t,cb}var hb,GP;function wV(){if(GP)return hb;GP=1;var e=_V(),t=lz(),r=Object.prototype,n=r.hasOwnProperty;function i(s,u,a){var d=s[u];(!(n.call(s,u)&&t(d,a))||a===void 0&&!(u in s))&&e(s,u,a)}return hb=i,hb}var db,WP;function bV(){if(WP)return db;WP=1;var e=9007199254740991,t=/^(?:0|[1-9]\d*)$/;function r(n,i){var s=typeof n;return i=i??e,!!i&&(s=="number"||s!="symbol"&&t.test(n))&&n>-1&&n%1==0&&n<i}return db=r,db}var fb,ZP;function SV(){if(ZP)return fb;ZP=1;var e=wV(),t=dz(),r=bV(),n=Fm(),i=MS();function s(u,a,d,p){if(!n(u))return u;a=t(a,u);for(var g=-1,v=a.length,_=v-1,b=u;b!=null&&++g<v;){var k=i(a[g]),A=d;if(k==="__proto__"||k==="constructor"||k==="prototype")return u;if(g!=_){var M=b[k];A=p?p(M,k,b):void 0,A===void 0&&(A=n(M)?M:r(a[g+1])?[]:{})}e(b,k,A),b=b[k]}return u}return fb=s,fb}var pb,XP;function EV(){if(XP)return pb;XP=1;var e=SV();function t(r,n,i){return r==null?r:e(r,n,i)}return pb=t,pb}var TV=EV(),CV=Om(TV),mb,KP;function kV(){if(KP)return mb;KP=1;function e(t,r){var n=-1,i=t.length;for(r||(r=Array(i));++n<i;)r[n]=t[n];return r}return mb=e,mb}var gb,YP;function PV(){if(YP)return gb;YP=1;var e=cz(),t=kV(),r=j0(),n=jm(),i=uz(),s=MS(),u=hz();function a(d){return r(d)?e(d,s):n(d)?[d]:t(i(u(d)))}return gb=a,gb}var IV=PV(),AV=Om(IV),MV={data:function(t){var r={field:"data",bindingEvent:"data",allowBinding:!1,allowSetting:!1,allowGetting:!1,settingEvent:"data",settingTriggersEvent:!1,triggerFnName:"trigger",immutableKeys:{},updateStyle:!1,beforeGet:function(i){},beforeSet:function(i,s){},onSet:function(i){},canSet:function(i){return!0}};return t=dr({},r,t),function(i,s){var u=t,a=this,d=a.length!==void 0,p=d?a:[a],g=d?a[0]:a;if(sr(i)){var v=i.indexOf(".")!==-1,_=v&&AV(i);if(u.allowGetting&&s===void 0){var b;return g&&(u.beforeGet(g),_&&g._private[u.field][i]===void 0?b=yV(g._private[u.field],_):b=g._private[u.field][i]),b}else if(u.allowSetting&&s!==void 0){var k=!u.immutableKeys[i];if(k){var A=kN({},i,s);u.beforeSet(a,A);for(var M=0,P=p.length;M<P;M++){var I=p[M];u.canSet(I)&&(_&&g._private[u.field][i]===void 0?CV(I._private[u.field],_,s):I._private[u.field][i]=s)}u.updateStyle&&a.updateStyle(),u.onSet(a),u.settingTriggersEvent&&a[u.triggerFnName](u.settingEvent)}}}else if(u.allowSetting&&Fr(i)){var z=i,O,V,U=Object.keys(z);u.beforeSet(a,z);for(var $=0;$<U.length;$++){O=U[$],V=z[O];var G=!u.immutableKeys[O];if(G)for(var Z=0;Z<p.length;Z++){var Q=p[Z];u.canSet(Q)&&(Q._private[u.field][O]=V)}}u.updateStyle&&a.updateStyle(),u.onSet(a),u.settingTriggersEvent&&a[u.triggerFnName](u.settingEvent)}else if(u.allowBinding&&Cn(i)){var X=i;a.on(u.bindingEvent,X)}else if(u.allowGetting&&i===void 0){var ie;return g&&(u.beforeGet(g),ie=g._private[u.field]),ie}return a}},removeData:function(t){var r={field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!1,immutableKeys:{}};return t=dr({},r,t),function(i){var s=t,u=this,a=u.length!==void 0,d=a?u:[u];if(sr(i)){for(var p=i.split(/\s+/),g=p.length,v=0;v<g;v++){var _=p[v];if(!ru(_)){var b=!s.immutableKeys[_];if(b)for(var k=0,A=d.length;k<A;k++)d[k]._private[s.field][_]=void 0}}s.triggerEvent&&u[s.triggerFnName](s.event)}else if(i===void 0){for(var M=0,P=d.length;M<P;M++)for(var I=d[M]._private[s.field],z=Object.keys(I),O=0;O<z.length;O++){var V=z[O],U=!s.immutableKeys[V];U&&(I[V]=void 0)}s.triggerEvent&&u[s.triggerFnName](s.event)}return u}}},DV={eventAliasesOn:function(t){var r=t;r.addListener=r.listen=r.bind=r.on,r.unlisten=r.unbind=r.off=r.removeListener,r.trigger=r.emit,r.pon=r.promiseOn=function(n,i){var s=this,u=Array.prototype.slice.call(arguments,0);return new Bd(function(a,d){var p=function(b){s.off.apply(s,v),a(b)},g=u.concat([p]),v=g.concat([]);s.on.apply(s,g)})}}},Hr={};[O$,MV,DV].forEach(function(e){dr(Hr,e)});var NV={animate:Hr.animate(),animation:Hr.animation(),animated:Hr.animated(),clearQueue:Hr.clearQueue(),delay:Hr.delay(),delayAnimation:Hr.delayAnimation(),stop:Hr.stop()},sy={classes:function(t){var r=this;if(t===void 0){var n=[];return r[0]._private.classes.forEach(function(k){return n.push(k)}),n}else an(t)||(t=(t||"").match(/\S+/g)||[]);for(var i=[],s=new Ld(t),u=0;u<r.length;u++){for(var a=r[u],d=a._private,p=d.classes,g=!1,v=0;v<t.length;v++){var _=t[v],b=p.has(_);if(!b){g=!0;break}}g||(g=p.size!==t.length),g&&(d.classes=s,i.push(a))}return i.length>0&&this.spawn(i).updateStyle().emit("class"),r},addClass:function(t){return this.toggleClass(t,!0)},hasClass:function(t){var r=this[0];return r!=null&&r._private.classes.has(t)},toggleClass:function(t,r){an(t)||(t=t.match(/\S+/g)||[]);for(var n=this,i=r===void 0,s=[],u=0,a=n.length;u<a;u++)for(var d=n[u],p=d._private.classes,g=!1,v=0;v<t.length;v++){var _=t[v],b=p.has(_),k=!1;r||i&&!b?(p.add(_),k=!0):(!r||i&&b)&&(p.delete(_),k=!0),!g&&k&&(s.push(d),g=!0)}return s.length>0&&this.spawn(s).updateStyle().emit("class"),n},removeClass:function(t){return this.toggleClass(t,!1)},flashClass:function(t,r){var n=this;if(r==null)r=250;else if(r===0)return n;return n.addClass(t),setTimeout(function(){n.removeClass(t)},r),n}};sy.className=sy.classNames=sy.classes;var Br={metaChar:"[\\!\\\"\\#\\$\\%\\&\\'\\(\\)\\*\\+\\,\\.\\/\\:\\;\\<\\=\\>\\?\\@\\[\\]\\^\\`\\{\\|\\}\\~]",comparatorOp:"=|\\!=|>|>=|<|<=|\\$=|\\^=|\\*=",boolOp:"\\?|\\!|\\^",string:`"(?:\\\\"|[^"])*"|'(?:\\\\'|[^'])*'`,number:Yn,meta:"degree|indegree|outdegree",separator:"\\s*,\\s*",descendant:"\\s+",child:"\\s+>\\s+",subject:"\\$",group:"node|edge|\\*",directedEdge:"\\s+->\\s+",undirectedEdge:"\\s+<->\\s+"};Br.variable="(?:[\\w-.]|(?:\\\\"+Br.metaChar+"))+";Br.className="(?:[\\w-]|(?:\\\\"+Br.metaChar+"))+";Br.value=Br.string+"|"+Br.number;Br.id=Br.variable;(function(){var e,t,r;for(e=Br.comparatorOp.split("|"),r=0;r<e.length;r++)t=e[r],Br.comparatorOp+="|@"+t;for(e=Br.comparatorOp.split("|"),r=0;r<e.length;r++)t=e[r],!(t.indexOf("!")>=0)&&t!=="="&&(Br.comparatorOp+="|\\!"+t)})();var rn=function(){return{checks:[]}},Qt={GROUP:0,COLLECTION:1,FILTER:2,DATA_COMPARE:3,DATA_EXIST:4,DATA_BOOL:5,META_COMPARE:6,STATE:7,ID:8,CLASS:9,UNDIRECTED_EDGE:10,DIRECTED_EDGE:11,NODE_SOURCE:12,NODE_TARGET:13,NODE_NEIGHBOR:14,CHILD:15,DESCENDANT:16,PARENT:17,ANCESTOR:18,COMPOUND_SPLIT:19,TRUE:20},G1=[{selector:":selected",matches:function(t){return t.selected()}},{selector:":unselected",matches:function(t){return!t.selected()}},{selector:":selectable",matches:function(t){return t.selectable()}},{selector:":unselectable",matches:function(t){return!t.selectable()}},{selector:":locked",matches:function(t){return t.locked()}},{selector:":unlocked",matches:function(t){return!t.locked()}},{selector:":visible",matches:function(t){return t.visible()}},{selector:":hidden",matches:function(t){return!t.visible()}},{selector:":transparent",matches:function(t){return t.transparent()}},{selector:":grabbed",matches:function(t){return t.grabbed()}},{selector:":free",matches:function(t){return!t.grabbed()}},{selector:":removed",matches:function(t){return t.removed()}},{selector:":inside",matches:function(t){return!t.removed()}},{selector:":grabbable",matches:function(t){return t.grabbable()}},{selector:":ungrabbable",matches:function(t){return!t.grabbable()}},{selector:":animated",matches:function(t){return t.animated()}},{selector:":unanimated",matches:function(t){return!t.animated()}},{selector:":parent",matches:function(t){return t.isParent()}},{selector:":childless",matches:function(t){return t.isChildless()}},{selector:":child",matches:function(t){return t.isChild()}},{selector:":orphan",matches:function(t){return t.isOrphan()}},{selector:":nonorphan",matches:function(t){return t.isChild()}},{selector:":compound",matches:function(t){return t.isNode()?t.isParent():t.source().isParent()||t.target().isParent()}},{selector:":loop",matches:function(t){return t.isLoop()}},{selector:":simple",matches:function(t){return t.isSimple()}},{selector:":active",matches:function(t){return t.active()}},{selector:":inactive",matches:function(t){return!t.active()}},{selector:":backgrounding",matches:function(t){return t.backgrounding()}},{selector:":nonbackgrounding",matches:function(t){return!t.backgrounding()}}].sort(function(e,t){return Mj(e.selector,t.selector)}),zV=function(){for(var e={},t,r=0;r<G1.length;r++)t=G1[r],e[t.selector]=t.matches;return e}(),RV=function(t,r){return zV[t](r)},LV="("+G1.map(function(e){return e.selector}).join("|")+")",Ch=function(t){return t.replace(new RegExp("\\\\("+Br.metaChar+")","g"),function(r,n){return n})},El=function(t,r,n){t[t.length-1]=n},W1=[{name:"group",query:!0,regex:"("+Br.group+")",populate:function(t,r,n){var i=Vn(n,1),s=i[0];r.checks.push({type:Qt.GROUP,value:s==="*"?s:s+"s"})}},{name:"state",query:!0,regex:LV,populate:function(t,r,n){var i=Vn(n,1),s=i[0];r.checks.push({type:Qt.STATE,value:s})}},{name:"id",query:!0,regex:"\\#("+Br.id+")",populate:function(t,r,n){var i=Vn(n,1),s=i[0];r.checks.push({type:Qt.ID,value:Ch(s)})}},{name:"className",query:!0,regex:"\\.("+Br.className+")",populate:function(t,r,n){var i=Vn(n,1),s=i[0];r.checks.push({type:Qt.CLASS,value:Ch(s)})}},{name:"dataExists",query:!0,regex:"\\[\\s*("+Br.variable+")\\s*\\]",populate:function(t,r,n){var i=Vn(n,1),s=i[0];r.checks.push({type:Qt.DATA_EXIST,field:Ch(s)})}},{name:"dataCompare",query:!0,regex:"\\[\\s*("+Br.variable+")\\s*("+Br.comparatorOp+")\\s*("+Br.value+")\\s*\\]",populate:function(t,r,n){var i=Vn(n,3),s=i[0],u=i[1],a=i[2],d=new RegExp("^"+Br.string+"$").exec(a)!=null;d?a=a.substring(1,a.length-1):a=parseFloat(a),r.checks.push({type:Qt.DATA_COMPARE,field:Ch(s),operator:u,value:a})}},{name:"dataBool",query:!0,regex:"\\[\\s*("+Br.boolOp+")\\s*("+Br.variable+")\\s*\\]",populate:function(t,r,n){var i=Vn(n,2),s=i[0],u=i[1];r.checks.push({type:Qt.DATA_BOOL,field:Ch(u),operator:s})}},{name:"metaCompare",query:!0,regex:"\\[\\[\\s*("+Br.meta+")\\s*("+Br.comparatorOp+")\\s*("+Br.number+")\\s*\\]\\]",populate:function(t,r,n){var i=Vn(n,3),s=i[0],u=i[1],a=i[2];r.checks.push({type:Qt.META_COMPARE,field:Ch(s),operator:u,value:parseFloat(a)})}},{name:"nextQuery",separator:!0,regex:Br.separator,populate:function(t,r){var n=t.currentSubject,i=t.edgeCount,s=t.compoundCount,u=t[t.length-1];n!=null&&(u.subject=n,t.currentSubject=null),u.edgeCount=i,u.compoundCount=s,t.edgeCount=0,t.compoundCount=0;var a=t[t.length++]=rn();return a}},{name:"directedEdge",separator:!0,regex:Br.directedEdge,populate:function(t,r){if(t.currentSubject==null){var n=rn(),i=r,s=rn();return n.checks.push({type:Qt.DIRECTED_EDGE,source:i,target:s}),El(t,r,n),t.edgeCount++,s}else{var u=rn(),a=r,d=rn();return u.checks.push({type:Qt.NODE_SOURCE,source:a,target:d}),El(t,r,u),t.edgeCount++,d}}},{name:"undirectedEdge",separator:!0,regex:Br.undirectedEdge,populate:function(t,r){if(t.currentSubject==null){var n=rn(),i=r,s=rn();return n.checks.push({type:Qt.UNDIRECTED_EDGE,nodes:[i,s]}),El(t,r,n),t.edgeCount++,s}else{var u=rn(),a=r,d=rn();return u.checks.push({type:Qt.NODE_NEIGHBOR,node:a,neighbor:d}),El(t,r,u),d}}},{name:"child",separator:!0,regex:Br.child,populate:function(t,r){if(t.currentSubject==null){var n=rn(),i=rn(),s=t[t.length-1];return n.checks.push({type:Qt.CHILD,parent:s,child:i}),El(t,r,n),t.compoundCount++,i}else if(t.currentSubject===r){var u=rn(),a=t[t.length-1],d=rn(),p=rn(),g=rn(),v=rn();return u.checks.push({type:Qt.COMPOUND_SPLIT,left:a,right:d,subject:p}),p.checks=r.checks,r.checks=[{type:Qt.TRUE}],v.checks.push({type:Qt.TRUE}),d.checks.push({type:Qt.PARENT,parent:v,child:g}),El(t,a,u),t.currentSubject=p,t.compoundCount++,g}else{var _=rn(),b=rn(),k=[{type:Qt.PARENT,parent:_,child:b}];return _.checks=r.checks,r.checks=k,t.compoundCount++,b}}},{name:"descendant",separator:!0,regex:Br.descendant,populate:function(t,r){if(t.currentSubject==null){var n=rn(),i=rn(),s=t[t.length-1];return n.checks.push({type:Qt.DESCENDANT,ancestor:s,descendant:i}),El(t,r,n),t.compoundCount++,i}else if(t.currentSubject===r){var u=rn(),a=t[t.length-1],d=rn(),p=rn(),g=rn(),v=rn();return u.checks.push({type:Qt.COMPOUND_SPLIT,left:a,right:d,subject:p}),p.checks=r.checks,r.checks=[{type:Qt.TRUE}],v.checks.push({type:Qt.TRUE}),d.checks.push({type:Qt.ANCESTOR,ancestor:v,descendant:g}),El(t,a,u),t.currentSubject=p,t.compoundCount++,g}else{var _=rn(),b=rn(),k=[{type:Qt.ANCESTOR,ancestor:_,descendant:b}];return _.checks=r.checks,r.checks=k,t.compoundCount++,b}}},{name:"subject",modifier:!0,regex:Br.subject,populate:function(t,r){if(t.currentSubject!=null&&t.currentSubject!==r)return Gr("Redefinition of subject in selector `"+t.toString()+"`"),!1;t.currentSubject=r;var n=t[t.length-1],i=n.checks[0],s=i==null?null:i.type;s===Qt.DIRECTED_EDGE?i.type=Qt.NODE_TARGET:s===Qt.UNDIRECTED_EDGE&&(i.type=Qt.NODE_NEIGHBOR,i.node=i.nodes[1],i.neighbor=i.nodes[0],i.nodes=null)}}];W1.forEach(function(e){return e.regexObj=new RegExp("^"+e.regex)});var BV=function(t){for(var r,n,i,s=0;s<W1.length;s++){var u=W1[s],a=u.name,d=t.match(u.regexObj);if(d!=null){n=d,r=u,i=a;var p=d[0];t=t.substring(p.length);break}}return{expr:r,match:n,name:i,remaining:t}},OV=function(t){var r=t.match(/^\s+/);if(r){var n=r[0];t=t.substring(n.length)}return t},FV=function(t){var r=this,n=r.inputText=t,i=r[0]=rn();for(r.length=1,n=OV(n);;){var s=BV(n);if(s.expr==null)return Gr("The selector `"+t+"`is invalid"),!1;var u=s.match.slice(1),a=s.expr.populate(r,i,u);if(a===!1)return!1;if(a!=null&&(i=a),n=s.remaining,n.match(/^\s*$/))break}var d=r[r.length-1];r.currentSubject!=null&&(d.subject=r.currentSubject),d.edgeCount=r.edgeCount,d.compoundCount=r.compoundCount;for(var p=0;p<r.length;p++){var g=r[p];if(g.compoundCount>0&&g.edgeCount>0)return Gr("The selector `"+t+"` is invalid because it uses both a compound selector and an edge selector"),!1;if(g.edgeCount>1)return Gr("The selector `"+t+"` is invalid because it uses multiple edge selectors"),!1;g.edgeCount===1&&Gr("The selector `"+t+"` is deprecated.  Edge selectors do not take effect on changes to source and target nodes after an edge is added, for performance reasons.  Use a class or data selector on edges instead, updating the class or data of an edge when your app detects a change in source or target nodes.")}return!0},jV=function(){if(this.toStringCache!=null)return this.toStringCache;for(var t=function(g){return g??""},r=function(g){return sr(g)?'"'+g+'"':t(g)},n=function(g){return" "+g+" "},i=function(g,v){var _=g.type,b=g.value;switch(_){case Qt.GROUP:{var k=t(b);return k.substring(0,k.length-1)}case Qt.DATA_COMPARE:{var A=g.field,M=g.operator;return"["+A+n(t(M))+r(b)+"]"}case Qt.DATA_BOOL:{var P=g.operator,I=g.field;return"["+t(P)+I+"]"}case Qt.DATA_EXIST:{var z=g.field;return"["+z+"]"}case Qt.META_COMPARE:{var O=g.operator,V=g.field;return"[["+V+n(t(O))+r(b)+"]]"}case Qt.STATE:return b;case Qt.ID:return"#"+b;case Qt.CLASS:return"."+b;case Qt.PARENT:case Qt.CHILD:return s(g.parent,v)+n(">")+s(g.child,v);case Qt.ANCESTOR:case Qt.DESCENDANT:return s(g.ancestor,v)+" "+s(g.descendant,v);case Qt.COMPOUND_SPLIT:{var U=s(g.left,v),$=s(g.subject,v),G=s(g.right,v);return U+(U.length>0?" ":"")+$+G}case Qt.TRUE:return""}},s=function(g,v){return g.checks.reduce(function(_,b,k){return _+(v===g&&k===0?"$":"")+i(b,v)},"")},u="",a=0;a<this.length;a++){var d=this[a];u+=s(d,d.subject),this.length>1&&a<this.length-1&&(u+=", ")}return this.toStringCache=u,u},$V={parse:FV,toString:jV},fz=function(t,r,n){var i,s=sr(t),u=Rt(t),a=sr(n),d,p,g=!1,v=!1,_=!1;switch(r.indexOf("!")>=0&&(r=r.replace("!",""),v=!0),r.indexOf("@")>=0&&(r=r.replace("@",""),g=!0),(s||a||g)&&(d=!s&&!u?"":""+t,p=""+n),g&&(t=d=d.toLowerCase(),n=p=p.toLowerCase()),r){case"*=":i=d.indexOf(p)>=0;break;case"$=":i=d.indexOf(p,d.length-p.length)>=0;break;case"^=":i=d.indexOf(p)===0;break;case"=":i=t===n;break;case">":_=!0,i=t>n;break;case">=":_=!0,i=t>=n;break;case"<":_=!0,i=t<n;break;case"<=":_=!0,i=t<=n;break;default:i=!1;break}return v&&(t!=null||!_)&&(i=!i),i},VV=function(t,r){switch(r){case"?":return!!t;case"!":return!t;case"^":return t===void 0}},UV=function(t){return t!==void 0},DS=function(t,r){return t.data(r)},qV=function(t,r){return t[r]()},Dn=[],mn=function(t,r){return t.checks.every(function(n){return Dn[n.type](n,r)})};Dn[Qt.GROUP]=function(e,t){var r=e.value;return r==="*"||r===t.group()};Dn[Qt.STATE]=function(e,t){var r=e.value;return RV(r,t)};Dn[Qt.ID]=function(e,t){var r=e.value;return t.id()===r};Dn[Qt.CLASS]=function(e,t){var r=e.value;return t.hasClass(r)};Dn[Qt.META_COMPARE]=function(e,t){var r=e.field,n=e.operator,i=e.value;return fz(qV(t,r),n,i)};Dn[Qt.DATA_COMPARE]=function(e,t){var r=e.field,n=e.operator,i=e.value;return fz(DS(t,r),n,i)};Dn[Qt.DATA_BOOL]=function(e,t){var r=e.field,n=e.operator;return VV(DS(t,r),n)};Dn[Qt.DATA_EXIST]=function(e,t){var r=e.field;return e.operator,UV(DS(t,r))};Dn[Qt.UNDIRECTED_EDGE]=function(e,t){var r=e.nodes[0],n=e.nodes[1],i=t.source(),s=t.target();return mn(r,i)&&mn(n,s)||mn(n,i)&&mn(r,s)};Dn[Qt.NODE_NEIGHBOR]=function(e,t){return mn(e.node,t)&&t.neighborhood().some(function(r){return r.isNode()&&mn(e.neighbor,r)})};Dn[Qt.DIRECTED_EDGE]=function(e,t){return mn(e.source,t.source())&&mn(e.target,t.target())};Dn[Qt.NODE_SOURCE]=function(e,t){return mn(e.source,t)&&t.outgoers().some(function(r){return r.isNode()&&mn(e.target,r)})};Dn[Qt.NODE_TARGET]=function(e,t){return mn(e.target,t)&&t.incomers().some(function(r){return r.isNode()&&mn(e.source,r)})};Dn[Qt.CHILD]=function(e,t){return mn(e.child,t)&&mn(e.parent,t.parent())};Dn[Qt.PARENT]=function(e,t){return mn(e.parent,t)&&t.children().some(function(r){return mn(e.child,r)})};Dn[Qt.DESCENDANT]=function(e,t){return mn(e.descendant,t)&&t.ancestors().some(function(r){return mn(e.ancestor,r)})};Dn[Qt.ANCESTOR]=function(e,t){return mn(e.ancestor,t)&&t.descendants().some(function(r){return mn(e.descendant,r)})};Dn[Qt.COMPOUND_SPLIT]=function(e,t){return mn(e.subject,t)&&mn(e.left,t)&&mn(e.right,t)};Dn[Qt.TRUE]=function(){return!0};Dn[Qt.COLLECTION]=function(e,t){var r=e.value;return r.has(t)};Dn[Qt.FILTER]=function(e,t){var r=e.value;return r(t)};var HV=function(t){var r=this;if(r.length===1&&r[0].checks.length===1&&r[0].checks[0].type===Qt.ID)return t.getElementById(r[0].checks[0].value).collection();var n=function(s){for(var u=0;u<r.length;u++){var a=r[u];if(mn(a,s))return!0}return!1};return r.text()==null&&(n=function(){return!0}),t.filter(n)},GV=function(t){for(var r=this,n=0;n<r.length;n++){var i=r[n];if(mn(i,t))return!0}return!1},WV={matches:GV,filter:HV},au=function(t){this.inputText=t,this.currentSubject=null,this.compoundCount=0,this.edgeCount=0,this.length=0,t==null||sr(t)&&t.match(/^\s*$/)||(La(t)?this.addQuery({checks:[{type:Qt.COLLECTION,value:t.collection()}]}):Cn(t)?this.addQuery({checks:[{type:Qt.FILTER,value:t}]}):sr(t)?this.parse(t)||(this.invalid=!0):_n("A selector must be created from a string; found "))},su=au.prototype;[$V,WV].forEach(function(e){return dr(su,e)});su.text=function(){return this.inputText};su.size=function(){return this.length};su.eq=function(e){return this[e]};su.sameText=function(e){return!this.invalid&&!e.invalid&&this.text()===e.text()};su.addQuery=function(e){this[this.length++]=e};su.selector=su.toString;var Kl={allAre:function(t){var r=new au(t);return this.every(function(n){return r.matches(n)})},is:function(t){var r=new au(t);return this.some(function(n){return r.matches(n)})},some:function(t,r){for(var n=0;n<this.length;n++){var i=r?t.apply(r,[this[n],n,this]):t(this[n],n,this);if(i)return!0}return!1},every:function(t,r){for(var n=0;n<this.length;n++){var i=r?t.apply(r,[this[n],n,this]):t(this[n],n,this);if(!i)return!1}return!0},same:function(t){if(this===t)return!0;t=this.cy().collection(t);var r=this.length,n=t.length;return r!==n?!1:r===1?this[0]===t[0]:this.every(function(i){return t.hasElementWithId(i.id())})},anySame:function(t){return t=this.cy().collection(t),this.some(function(r){return t.hasElementWithId(r.id())})},allAreNeighbors:function(t){t=this.cy().collection(t);var r=this.neighborhood();return t.every(function(n){return r.hasElementWithId(n.id())})},contains:function(t){t=this.cy().collection(t);var r=this;return t.every(function(n){return r.hasElementWithId(n.id())})}};Kl.allAreNeighbours=Kl.allAreNeighbors;Kl.has=Kl.contains;Kl.equal=Kl.equals=Kl.same;var ns=function(t,r){return function(i,s,u,a){var d=i,p=this,g;if(d==null?g="":La(d)&&d.length===1&&(g=d.id()),p.length===1&&g){var v=p[0]._private,_=v.traversalCache=v.traversalCache||{},b=_[r]=_[r]||[],k=gc(g),A=b[k];return A||(b[k]=t.call(p,i,s,u,a))}else return t.call(p,i,s,u,a)}},kd={parent:function(t){var r=[];if(this.length===1){var n=this[0]._private.parent;if(n)return n}for(var i=0;i<this.length;i++){var s=this[i],u=s._private.parent;u&&r.push(u)}return this.spawn(r,!0).filter(t)},parents:function(t){for(var r=[],n=this.parent();n.nonempty();){for(var i=0;i<n.length;i++){var s=n[i];r.push(s)}n=n.parent()}return this.spawn(r,!0).filter(t)},commonAncestors:function(t){for(var r,n=0;n<this.length;n++){var i=this[n],s=i.parents();r=r||s,r=r.intersect(s)}return r.filter(t)},orphans:function(t){return this.stdFilter(function(r){return r.isOrphan()}).filter(t)},nonorphans:function(t){return this.stdFilter(function(r){return r.isChild()}).filter(t)},children:ns(function(e){for(var t=[],r=0;r<this.length;r++)for(var n=this[r],i=n._private.children,s=0;s<i.length;s++)t.push(i[s]);return this.spawn(t,!0).filter(e)},"children"),siblings:function(t){return this.parent().children().not(this).filter(t)},isParent:function(){var t=this[0];if(t)return t.isNode()&&t._private.children.length!==0},isChildless:function(){var t=this[0];if(t)return t.isNode()&&t._private.children.length===0},isChild:function(){var t=this[0];if(t)return t.isNode()&&t._private.parent!=null},isOrphan:function(){var t=this[0];if(t)return t.isNode()&&t._private.parent==null},descendants:function(t){var r=[];function n(i){for(var s=0;s<i.length;s++){var u=i[s];r.push(u),u.children().nonempty()&&n(u.children())}}return n(this.children()),this.spawn(r,!0).filter(t)}};function NS(e,t,r,n){for(var i=[],s=new Ld,u=e.cy(),a=u.hasCompoundNodes(),d=0;d<e.length;d++){var p=e[d];r?i.push(p):a&&n(i,s,p)}for(;i.length>0;){var g=i.shift();t(g),s.add(g.id()),a&&n(i,s,g)}return e}function pz(e,t,r){if(r.isParent())for(var n=r._private.children,i=0;i<n.length;i++){var s=n[i];t.has(s.id())||e.push(s)}}kd.forEachDown=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return NS(this,e,t,pz)};function mz(e,t,r){if(r.isChild()){var n=r._private.parent;t.has(n.id())||e.push(n)}}kd.forEachUp=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return NS(this,e,t,mz)};function ZV(e,t,r){mz(e,t,r),pz(e,t,r)}kd.forEachUpAndDown=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return NS(this,e,t,ZV)};kd.ancestors=kd.parents;var hm,gz;hm=gz={data:Hr.data({field:"data",bindingEvent:"data",allowBinding:!0,allowSetting:!0,settingEvent:"data",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,immutableKeys:{id:!0,source:!0,target:!0,parent:!0},updateStyle:!0}),removeData:Hr.removeData({field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!0,immutableKeys:{id:!0,source:!0,target:!0,parent:!0},updateStyle:!0}),scratch:Hr.data({field:"scratch",bindingEvent:"scratch",allowBinding:!0,allowSetting:!0,settingEvent:"scratch",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeScratch:Hr.removeData({field:"scratch",event:"scratch",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0}),rscratch:Hr.data({field:"rscratch",allowBinding:!1,allowSetting:!0,settingTriggersEvent:!1,allowGetting:!0}),removeRscratch:Hr.removeData({field:"rscratch",triggerEvent:!1}),id:function(){var t=this[0];if(t)return t._private.data.id}};hm.attr=hm.data;hm.removeAttr=hm.removeData;var XV=gz,q0={};function vb(e){return function(t){var r=this;if(t===void 0&&(t=!0),r.length!==0)if(r.isNode()&&!r.removed()){for(var n=0,i=r[0],s=i._private.edges,u=0;u<s.length;u++){var a=s[u];!t&&a.isLoop()||(n+=e(i,a))}return n}else return}}dr(q0,{degree:vb(function(e,t){return t.source().same(t.target())?2:1}),indegree:vb(function(e,t){return t.target().same(e)?1:0}),outdegree:vb(function(e,t){return t.source().same(e)?1:0})});function kh(e,t){return function(r){for(var n,i=this.nodes(),s=0;s<i.length;s++){var u=i[s],a=u[e](r);a!==void 0&&(n===void 0||t(a,n))&&(n=a)}return n}}dr(q0,{minDegree:kh("degree",function(e,t){return e<t}),maxDegree:kh("degree",function(e,t){return e>t}),minIndegree:kh("indegree",function(e,t){return e<t}),maxIndegree:kh("indegree",function(e,t){return e>t}),minOutdegree:kh("outdegree",function(e,t){return e<t}),maxOutdegree:kh("outdegree",function(e,t){return e>t})});dr(q0,{totalDegree:function(t){for(var r=0,n=this.nodes(),i=0;i<n.length;i++)r+=n[i].degree(t);return r}});var Cs,vz,yz=function(t,r,n){for(var i=0;i<t.length;i++){var s=t[i];if(!s.locked()){var u=s._private.position,a={x:r.x!=null?r.x-u.x:0,y:r.y!=null?r.y-u.y:0};s.isParent()&&!(a.x===0&&a.y===0)&&s.children().shift(a,n),s.dirtyBoundingBoxCache()}}},JP={field:"position",bindingEvent:"position",allowBinding:!0,allowSetting:!0,settingEvent:"position",settingTriggersEvent:!0,triggerFnName:"emitAndNotify",allowGetting:!0,validKeys:["x","y"],beforeGet:function(t){t.updateCompoundBounds()},beforeSet:function(t,r){yz(t,r,!1)},onSet:function(t){t.dirtyCompoundBoundsCache()},canSet:function(t){return!t.locked()}};Cs=vz={position:Hr.data(JP),silentPosition:Hr.data(dr({},JP,{allowBinding:!1,allowSetting:!0,settingTriggersEvent:!1,allowGetting:!1,beforeSet:function(t,r){yz(t,r,!0)},onSet:function(t){t.dirtyCompoundBoundsCache()}})),positions:function(t,r){if(Fr(t))r?this.silentPosition(t):this.position(t);else if(Cn(t)){var n=t,i=this.cy();i.startBatch();for(var s=0;s<this.length;s++){var u=this[s],a=void 0;(a=n(u,s))&&(r?u.silentPosition(a):u.position(a))}i.endBatch()}return this},silentPositions:function(t){return this.positions(t,!0)},shift:function(t,r,n){var i;if(Fr(t)?(i={x:Rt(t.x)?t.x:0,y:Rt(t.y)?t.y:0},n=r):sr(t)&&Rt(r)&&(i={x:0,y:0},i[t]=r),i!=null){var s=this.cy();s.startBatch();for(var u=0;u<this.length;u++){var a=this[u];if(!(s.hasCompoundNodes()&&a.isChild()&&a.ancestors().anySame(this))){var d=a.position(),p={x:d.x+i.x,y:d.y+i.y};n?a.silentPosition(p):a.position(p)}}s.endBatch()}return this},silentShift:function(t,r){return Fr(t)?this.shift(t,!0):sr(t)&&Rt(r)&&this.shift(t,r,!0),this},renderedPosition:function(t,r){var n=this[0],i=this.cy(),s=i.zoom(),u=i.pan(),a=Fr(t)?t:void 0,d=a!==void 0||r!==void 0&&sr(t);if(n&&n.isNode())if(d)for(var p=0;p<this.length;p++){var g=this[p];r!==void 0?g.position(t,(r-u[t])/s):a!==void 0&&g.position(GN(a,s,u))}else{var v=n.position();return a=O0(v,s,u),t===void 0?a:a[t]}else if(!d)return;return this},relativePosition:function(t,r){var n=this[0],i=this.cy(),s=Fr(t)?t:void 0,u=s!==void 0||r!==void 0&&sr(t),a=i.hasCompoundNodes();if(n&&n.isNode())if(u)for(var d=0;d<this.length;d++){var p=this[d],g=a?p.parent():null,v=g&&g.length>0,_=v;v&&(g=g[0]);var b=_?g.position():{x:0,y:0};r!==void 0?p.position(t,r+b[t]):s!==void 0&&p.position({x:s.x+b.x,y:s.y+b.y})}else{var k=n.position(),A=a?n.parent():null,M=A&&A.length>0,P=M;M&&(A=A[0]);var I=P?A.position():{x:0,y:0};return s={x:k.x-I.x,y:k.y-I.y},t===void 0?s:s[t]}else if(!u)return;return this}};Cs.modelPosition=Cs.point=Cs.position;Cs.modelPositions=Cs.points=Cs.positions;Cs.renderedPoint=Cs.renderedPosition;Cs.relativePoint=Cs.relativePosition;var KV=vz,fd,fu;fd=fu={};fu.renderedBoundingBox=function(e){var t=this.boundingBox(e),r=this.cy(),n=r.zoom(),i=r.pan(),s=t.x1*n+i.x,u=t.x2*n+i.x,a=t.y1*n+i.y,d=t.y2*n+i.y;return{x1:s,x2:u,y1:a,y2:d,w:u-s,h:d-a}};fu.dirtyCompoundBoundsCache=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=this.cy();return!t.styleEnabled()||!t.hasCompoundNodes()?this:(this.forEachUp(function(r){if(r.isParent()){var n=r._private;n.compoundBoundsClean=!1,n.bbCache=null,e||r.emitAndNotify("bounds")}}),this)};fu.updateCompoundBounds=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=this.cy();if(!t.styleEnabled()||!t.hasCompoundNodes())return this;if(!e&&t.batching())return this;function r(u){if(!u.isParent())return;var a=u._private,d=u.children(),p=u.pstyle("compound-sizing-wrt-labels").value==="include",g={width:{val:u.pstyle("min-width").pfValue,left:u.pstyle("min-width-bias-left"),right:u.pstyle("min-width-bias-right")},height:{val:u.pstyle("min-height").pfValue,top:u.pstyle("min-height-bias-top"),bottom:u.pstyle("min-height-bias-bottom")}},v=d.boundingBox({includeLabels:p,includeOverlays:!1,useCache:!1}),_=a.position;(v.w===0||v.h===0)&&(v={w:u.pstyle("width").pfValue,h:u.pstyle("height").pfValue},v.x1=_.x-v.w/2,v.x2=_.x+v.w/2,v.y1=_.y-v.h/2,v.y2=_.y+v.h/2);function b(Z,Q,X){var ie=0,te=0,W=Q+X;return Z>0&&W>0&&(ie=Q/W*Z,te=X/W*Z),{biasDiff:ie,biasComplementDiff:te}}function k(Z,Q,X,ie){if(X.units==="%")switch(ie){case"width":return Z>0?X.pfValue*Z:0;case"height":return Q>0?X.pfValue*Q:0;case"average":return Z>0&&Q>0?X.pfValue*(Z+Q)/2:0;case"min":return Z>0&&Q>0?Z>Q?X.pfValue*Q:X.pfValue*Z:0;case"max":return Z>0&&Q>0?Z>Q?X.pfValue*Z:X.pfValue*Q:0;default:return 0}else return X.units==="px"?X.pfValue:0}var A=g.width.left.value;g.width.left.units==="px"&&g.width.val>0&&(A=A*100/g.width.val);var M=g.width.right.value;g.width.right.units==="px"&&g.width.val>0&&(M=M*100/g.width.val);var P=g.height.top.value;g.height.top.units==="px"&&g.height.val>0&&(P=P*100/g.height.val);var I=g.height.bottom.value;g.height.bottom.units==="px"&&g.height.val>0&&(I=I*100/g.height.val);var z=b(g.width.val-v.w,A,M),O=z.biasDiff,V=z.biasComplementDiff,U=b(g.height.val-v.h,P,I),$=U.biasDiff,G=U.biasComplementDiff;a.autoPadding=k(v.w,v.h,u.pstyle("padding"),u.pstyle("padding-relative-to").value),a.autoWidth=Math.max(v.w,g.width.val),_.x=(-O+v.x1+v.x2+V)/2,a.autoHeight=Math.max(v.h,g.height.val),_.y=(-$+v.y1+v.y2+G)/2}for(var n=0;n<this.length;n++){var i=this[n],s=i._private;(!s.compoundBoundsClean||e)&&(r(i),t.batching()||(s.compoundBoundsClean=!0))}return this};var es=function(t){return t===1/0||t===-1/0?0:t},_s=function(t,r,n,i,s){i-r===0||s-n===0||r==null||n==null||i==null||s==null||(t.x1=r<t.x1?r:t.x1,t.x2=i>t.x2?i:t.x2,t.y1=n<t.y1?n:t.y1,t.y2=s>t.y2?s:t.y2,t.w=t.x2-t.x1,t.h=t.y2-t.y1)},Il=function(t,r){return r==null?t:_s(t,r.x1,r.y1,r.x2,r.y2)},np=function(t,r,n){return fa(t,r,n)},Ev=function(t,r,n){if(!r.cy().headless()){var i=r._private,s=i.rstyle,u=s.arrowWidth/2,a=r.pstyle(n+"-arrow-shape").value,d,p;if(a!=="none"){n==="source"?(d=s.srcX,p=s.srcY):n==="target"?(d=s.tgtX,p=s.tgtY):(d=s.midX,p=s.midY);var g=i.arrowBounds=i.arrowBounds||{},v=g[n]=g[n]||{};v.x1=d-u,v.y1=p-u,v.x2=d+u,v.y2=p+u,v.w=v.x2-v.x1,v.h=v.y2-v.y1,iy(v,1),_s(t,v.x1,v.y1,v.x2,v.y2)}}},yb=function(t,r,n){if(!r.cy().headless()){var i;n?i=n+"-":i="";var s=r._private,u=s.rstyle,a=r.pstyle(i+"label").strValue;if(a){var d=r.pstyle("text-halign"),p=r.pstyle("text-valign"),g=np(u,"labelWidth",n),v=np(u,"labelHeight",n),_=np(u,"labelX",n),b=np(u,"labelY",n),k=r.pstyle(i+"text-margin-x").pfValue,A=r.pstyle(i+"text-margin-y").pfValue,M=r.isEdge(),P=r.pstyle(i+"text-rotation"),I=r.pstyle("text-outline-width").pfValue,z=r.pstyle("text-border-width").pfValue,O=z/2,V=r.pstyle("text-background-padding").pfValue,U=2,$=v,G=g,Z=G/2,Q=$/2,X,ie,te,W;if(M)X=_-Z,ie=_+Z,te=b-Q,W=b+Q;else{switch(d.value){case"left":X=_-G,ie=_;break;case"center":X=_-Z,ie=_+Z;break;case"right":X=_,ie=_+G;break}switch(p.value){case"top":te=b-$,W=b;break;case"center":te=b-Q,W=b+Q;break;case"bottom":te=b,W=b+$;break}}var oe=k-Math.max(I,O)-V-U,se=k+Math.max(I,O)+V+U,de=A-Math.max(I,O)-V-U,me=A+Math.max(I,O)+V+U;X+=oe,ie+=se,te+=de,W+=me;var ae=n||"main",ve=s.labelBounds,pe=ve[ae]=ve[ae]||{};pe.x1=X,pe.y1=te,pe.x2=ie,pe.y2=W,pe.w=ie-X,pe.h=W-te,pe.leftPad=oe,pe.rightPad=se,pe.topPad=de,pe.botPad=me;var _e=M&&P.strValue==="autorotate",De=P.pfValue!=null&&P.pfValue!==0;if(_e||De){var Le=_e?np(s.rstyle,"labelAngle",n):P.pfValue,je=Math.cos(Le),Je=Math.sin(Le),et=(X+ie)/2,ft=(te+W)/2;if(!M){switch(d.value){case"left":et=ie;break;case"right":et=X;break}switch(p.value){case"top":ft=W;break;case"bottom":ft=te;break}}var rt=function(At,pt){return At=At-et,pt=pt-ft,{x:At*je-pt*Je+et,y:At*Je+pt*je+ft}},Oe=rt(X,te),Ge=rt(X,W),Ze=rt(ie,te),it=rt(ie,W);X=Math.min(Oe.x,Ge.x,Ze.x,it.x),ie=Math.max(Oe.x,Ge.x,Ze.x,it.x),te=Math.min(Oe.y,Ge.y,Ze.y,it.y),W=Math.max(Oe.y,Ge.y,Ze.y,it.y)}var mt=ae+"Rot",Tt=ve[mt]=ve[mt]||{};Tt.x1=X,Tt.y1=te,Tt.x2=ie,Tt.y2=W,Tt.w=ie-X,Tt.h=W-te,_s(t,X,te,ie,W),_s(s.labelBounds.all,X,te,ie,W)}return t}},QP=function(t,r){if(!r.cy().headless()){var n=r.pstyle("outline-opacity").value,i=r.pstyle("outline-width").value,s=r.pstyle("outline-offset").value,u=i+s;xz(t,r,n,u,"outside",u/2)}},xz=function(t,r,n,i,s,u){if(!(n===0||i<=0||s==="inside")){var a=r.cy(),d=r.pstyle("shape").value,p=a.renderer().nodeShapes[d],g=r.position(),v=g.x,_=g.y,b=r.width(),k=r.height();if(p.hasMiterBounds){s==="center"&&(i/=2);var A=p.miterBounds(v,_,b,k,i);Il(t,A)}else u!=null&&u>0&&ay(t,[u,u,u,u])}},YV=function(t,r){if(!r.cy().headless()){var n=r.pstyle("border-opacity").value,i=r.pstyle("border-width").pfValue,s=r.pstyle("border-position").value;xz(t,r,n,i,s)}},JV=function(t,r){var n=t._private.cy,i=n.styleEnabled(),s=n.headless(),u=ta(),a=t._private,d=t.isNode(),p=t.isEdge(),g,v,_,b,k,A,M=a.rstyle,P=d&&i?t.pstyle("bounds-expansion").pfValue:[0],I=function($e){return $e.pstyle("display").value!=="none"},z=!i||I(t)&&(!p||I(t.source())&&I(t.target()));if(z){var O=0,V=0;i&&r.includeOverlays&&(O=t.pstyle("overlay-opacity").value,O!==0&&(V=t.pstyle("overlay-padding").value));var U=0,$=0;i&&r.includeUnderlays&&(U=t.pstyle("underlay-opacity").value,U!==0&&($=t.pstyle("underlay-padding").value));var G=Math.max(V,$),Z=0,Q=0;if(i&&(Z=t.pstyle("width").pfValue,Q=Z/2),d&&r.includeNodes){var X=t.position();k=X.x,A=X.y;var ie=t.outerWidth(),te=ie/2,W=t.outerHeight(),oe=W/2;g=k-te,v=k+te,_=A-oe,b=A+oe,_s(u,g,_,v,b),i&&QP(u,t),i&&r.includeOutlines&&!s&&QP(u,t),i&&YV(u,t)}else if(p&&r.includeEdges)if(i&&!s){var se=t.pstyle("curve-style").strValue;if(g=Math.min(M.srcX,M.midX,M.tgtX),v=Math.max(M.srcX,M.midX,M.tgtX),_=Math.min(M.srcY,M.midY,M.tgtY),b=Math.max(M.srcY,M.midY,M.tgtY),g-=Q,v+=Q,_-=Q,b+=Q,_s(u,g,_,v,b),se==="haystack"){var de=M.haystackPts;if(de&&de.length===2){if(g=de[0].x,_=de[0].y,v=de[1].x,b=de[1].y,g>v){var me=g;g=v,v=me}if(_>b){var ae=_;_=b,b=ae}_s(u,g-Q,_-Q,v+Q,b+Q)}}else if(se==="bezier"||se==="unbundled-bezier"||Fl(se,"segments")||Fl(se,"taxi")){var ve;switch(se){case"bezier":case"unbundled-bezier":ve=M.bezierPts;break;case"segments":case"taxi":case"round-segments":case"round-taxi":ve=M.linePts;break}if(ve!=null)for(var pe=0;pe<ve.length;pe++){var _e=ve[pe];g=_e.x-Q,v=_e.x+Q,_=_e.y-Q,b=_e.y+Q,_s(u,g,_,v,b)}}}else{var De=t.source(),Le=De.position(),je=t.target(),Je=je.position();if(g=Le.x,v=Je.x,_=Le.y,b=Je.y,g>v){var et=g;g=v,v=et}if(_>b){var ft=_;_=b,b=ft}g-=Q,v+=Q,_-=Q,b+=Q,_s(u,g,_,v,b)}if(i&&r.includeEdges&&p&&(Ev(u,t,"mid-source"),Ev(u,t,"mid-target"),Ev(u,t,"source"),Ev(u,t,"target")),i){var rt=t.pstyle("ghost").value==="yes";if(rt){var Oe=t.pstyle("ghost-offset-x").pfValue,Ge=t.pstyle("ghost-offset-y").pfValue;_s(u,u.x1+Oe,u.y1+Ge,u.x2+Oe,u.y2+Ge)}}var Ze=a.bodyBounds=a.bodyBounds||{};Ok(Ze,u),ay(Ze,P),iy(Ze,1),i&&(g=u.x1,v=u.x2,_=u.y1,b=u.y2,_s(u,g-G,_-G,v+G,b+G));var it=a.overlayBounds=a.overlayBounds||{};Ok(it,u),ay(it,P),iy(it,1);var mt=a.labelBounds=a.labelBounds||{};mt.all!=null?N6(mt.all):mt.all=ta(),i&&r.includeLabels&&(r.includeMainLabels&&yb(u,t,null),p&&(r.includeSourceLabels&&yb(u,t,"source"),r.includeTargetLabels&&yb(u,t,"target")))}return u.x1=es(u.x1),u.y1=es(u.y1),u.x2=es(u.x2),u.y2=es(u.y2),u.w=es(u.x2-u.x1),u.h=es(u.y2-u.y1),u.w>0&&u.h>0&&z&&(ay(u,P),iy(u,1)),u},_z=function(t){var r=0,n=function(u){return(u?1:0)<<r++},i=0;return i+=n(t.incudeNodes),i+=n(t.includeEdges),i+=n(t.includeLabels),i+=n(t.includeMainLabels),i+=n(t.includeSourceLabels),i+=n(t.includeTargetLabels),i+=n(t.includeOverlays),i+=n(t.includeOutlines),i},wz=function(t){var r=function(a){return Math.round(a)};if(t.isEdge()){var n=t.source().position(),i=t.target().position();return Dk([r(n.x),r(n.y),r(i.x),r(i.y)])}else{var s=t.position();return Dk([r(s.x),r(s.y)])}},eI=function(t,r){var n=t._private,i,s=t.isEdge(),u=r==null?tI:_z(r),a=u===tI;if(n.bbCache==null?(i=JV(t,dm),n.bbCache=i,n.bbCachePosKey=wz(t)):i=n.bbCache,!a){var d=t.isNode();i=ta(),(r.includeNodes&&d||r.includeEdges&&!d)&&(r.includeOverlays?Il(i,n.overlayBounds):Il(i,n.bodyBounds)),r.includeLabels&&(r.includeMainLabels&&(!s||r.includeSourceLabels&&r.includeTargetLabels)?Il(i,n.labelBounds.all):(r.includeMainLabels&&Il(i,n.labelBounds.mainRot),r.includeSourceLabels&&Il(i,n.labelBounds.sourceRot),r.includeTargetLabels&&Il(i,n.labelBounds.targetRot))),i.w=i.x2-i.x1,i.h=i.y2-i.y1}return i},dm={includeNodes:!0,includeEdges:!0,includeLabels:!0,includeMainLabels:!0,includeSourceLabels:!0,includeTargetLabels:!0,includeOverlays:!0,includeUnderlays:!0,includeOutlines:!0,useCache:!0},tI=_z(dm),rI=Ti(dm);fu.boundingBox=function(e){var t,r=e===void 0||e.useCache===void 0||e.useCache===!0,n=Td(function(g){var v=g._private;return v.bbCache==null||v.styleDirty||v.bbCachePosKey!==wz(g)},function(g){return g.id()});if(r&&this.length===1&&!n(this[0]))e===void 0?e=dm:e=rI(e),t=eI(this[0],e);else{t=ta(),e=e||dm;var i=rI(e),s=this,u=s.cy(),a=u.styleEnabled();this.edges().forEach(n),this.nodes().forEach(n),a&&this.recalculateRenderedStyle(r),this.updateCompoundBounds(!r);for(var d=0;d<s.length;d++){var p=s[d];n(p)&&p.dirtyBoundingBoxCache(),Il(t,eI(p,i))}}return t.x1=es(t.x1),t.y1=es(t.y1),t.x2=es(t.x2),t.y2=es(t.y2),t.w=es(t.x2-t.x1),t.h=es(t.y2-t.y1),t};fu.dirtyBoundingBoxCache=function(){for(var e=0;e<this.length;e++){var t=this[e]._private;t.bbCache=null,t.bbCachePosKey=null,t.bodyBounds=null,t.overlayBounds=null,t.labelBounds.all=null,t.labelBounds.source=null,t.labelBounds.target=null,t.labelBounds.main=null,t.labelBounds.sourceRot=null,t.labelBounds.targetRot=null,t.labelBounds.mainRot=null,t.arrowBounds.source=null,t.arrowBounds.target=null,t.arrowBounds["mid-source"]=null,t.arrowBounds["mid-target"]=null}return this.emitAndNotify("bounds"),this};fu.boundingBoxAt=function(e){var t=this.nodes(),r=this.cy(),n=r.hasCompoundNodes(),i=r.collection();if(n&&(i=t.filter(function(p){return p.isParent()}),t=t.not(i)),Fr(e)){var s=e;e=function(){return s}}var u=function(g,v){return g._private.bbAtOldPos=e(g,v)},a=function(g){return g._private.bbAtOldPos};r.startBatch(),t.forEach(u).silentPositions(e),n&&(i.dirtyCompoundBoundsCache(),i.dirtyBoundingBoxCache(),i.updateCompoundBounds(!0));var d=D6(this.boundingBox({useCache:!1}));return t.silentPositions(a),n&&(i.dirtyCompoundBoundsCache(),i.dirtyBoundingBoxCache(),i.updateCompoundBounds(!0)),r.endBatch(),d};fd.boundingbox=fd.bb=fd.boundingBox;fd.renderedBoundingbox=fd.renderedBoundingBox;var QV=fu,bp,Um;bp=Um={};var bz=function(t){t.uppercaseName=vk(t.name),t.autoName="auto"+t.uppercaseName,t.labelName="label"+t.uppercaseName,t.outerName="outer"+t.uppercaseName,t.uppercaseOuterName=vk(t.outerName),bp[t.name]=function(){var n=this[0],i=n._private,s=i.cy,u=s._private.styleEnabled;if(n)if(u){if(n.isParent())return n.updateCompoundBounds(),i[t.autoName]||0;var a=n.pstyle(t.name);switch(a.strValue){case"label":return n.recalculateRenderedStyle(),i.rstyle[t.labelName]||0;default:return a.pfValue}}else return 1},bp["outer"+t.uppercaseName]=function(){var n=this[0],i=n._private,s=i.cy,u=s._private.styleEnabled;if(n)if(u){var a=n[t.name](),d=n.pstyle("border-position").value,p;d==="center"?p=n.pstyle("border-width").pfValue:d==="outside"?p=2*n.pstyle("border-width").pfValue:p=0;var g=2*n.padding();return a+p+g}else return 1},bp["rendered"+t.uppercaseName]=function(){var n=this[0];if(n){var i=n[t.name]();return i*this.cy().zoom()}},bp["rendered"+t.uppercaseOuterName]=function(){var n=this[0];if(n){var i=n[t.outerName]();return i*this.cy().zoom()}}};bz({name:"width"});bz({name:"height"});Um.padding=function(){var e=this[0],t=e._private;return e.isParent()?(e.updateCompoundBounds(),t.autoPadding!==void 0?t.autoPadding:e.pstyle("padding").pfValue):e.pstyle("padding").pfValue};Um.paddedHeight=function(){var e=this[0];return e.height()+2*e.padding()};Um.paddedWidth=function(){var e=this[0];return e.width()+2*e.padding()};var e8=Um,t8=function(t,r){if(t.isEdge()&&t.takesUpSpace())return r(t)},r8=function(t,r){if(t.isEdge()&&t.takesUpSpace()){var n=t.cy();return O0(r(t),n.zoom(),n.pan())}},n8=function(t,r){if(t.isEdge()&&t.takesUpSpace()){var n=t.cy(),i=n.pan(),s=n.zoom();return r(t).map(function(u){return O0(u,s,i)})}},i8=function(t){return t.renderer().getControlPoints(t)},a8=function(t){return t.renderer().getSegmentPoints(t)},s8=function(t){return t.renderer().getSourceEndpoint(t)},o8=function(t){return t.renderer().getTargetEndpoint(t)},l8=function(t){return t.renderer().getEdgeMidpoint(t)},nI={controlPoints:{get:i8,mult:!0},segmentPoints:{get:a8,mult:!0},sourceEndpoint:{get:s8},targetEndpoint:{get:o8},midpoint:{get:l8}},u8=function(t){return"rendered"+t[0].toUpperCase()+t.substr(1)},c8=Object.keys(nI).reduce(function(e,t){var r=nI[t],n=u8(t);return e[t]=function(){return t8(this,r.get)},r.mult?e[n]=function(){return n8(this,r.get)}:e[n]=function(){return r8(this,r.get)},e},{}),h8=dr({},KV,QV,e8,c8);/*!
Event object based on jQuery events, MIT license

https://jquery.org/license/
https://tldrlegal.com/license/mit-license
https://github.com/jquery/jquery/blob/master/src/event.js
*/var Sz=function(t,r){this.recycle(t,r)};function ip(){return!1}function Tv(){return!0}Sz.prototype={instanceString:function(){return"event"},recycle:function(t,r){if(this.isImmediatePropagationStopped=this.isPropagationStopped=this.isDefaultPrevented=ip,t!=null&&t.preventDefault?(this.type=t.type,this.isDefaultPrevented=t.defaultPrevented?Tv:ip):t!=null&&t.type?r=t:this.type=t,r!=null&&(this.originalEvent=r.originalEvent,this.type=r.type!=null?r.type:this.type,this.cy=r.cy,this.target=r.target,this.position=r.position,this.renderedPosition=r.renderedPosition,this.namespace=r.namespace,this.layout=r.layout),this.cy!=null&&this.position!=null&&this.renderedPosition==null){var n=this.position,i=this.cy.zoom(),s=this.cy.pan();this.renderedPosition={x:n.x*i+s.x,y:n.y*i+s.y}}this.timeStamp=t&&t.timeStamp||Date.now()},preventDefault:function(){this.isDefaultPrevented=Tv;var t=this.originalEvent;t&&t.preventDefault&&t.preventDefault()},stopPropagation:function(){this.isPropagationStopped=Tv;var t=this.originalEvent;t&&t.stopPropagation&&t.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=Tv,this.stopPropagation()},isDefaultPrevented:ip,isPropagationStopped:ip,isImmediatePropagationStopped:ip};var Ez=/^([^.]+)(\.(?:[^.]+))?$/,d8=".*",Tz={qualifierCompare:function(t,r){return t===r},eventMatches:function(){return!0},addEventFields:function(){},callbackContext:function(t){return t},beforeEmit:function(){},afterEmit:function(){},bubble:function(){return!1},parent:function(){return null},context:null},iI=Object.keys(Tz),f8={};function H0(){for(var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:f8,t=arguments.length>1?arguments[1]:void 0,r=0;r<iI.length;r++){var n=iI[r];this[n]=e[n]||Tz[n]}this.context=t||this.context,this.listeners=[],this.emitting=0}var ou=H0.prototype,Cz=function(t,r,n,i,s,u,a){Cn(i)&&(s=i,i=null),a&&(u==null?u=a:u=dr({},u,a));for(var d=an(n)?n:n.split(/\s+/),p=0;p<d.length;p++){var g=d[p];if(!ru(g)){var v=g.match(Ez);if(v){var _=v[1],b=v[2]?v[2]:null,k=r(t,g,_,b,i,s,u);if(k===!1)break}}}},aI=function(t,r){return t.addEventFields(t.context,r),new Sz(r.type,r)},p8=function(t,r,n){if(_j(n)){r(t,n);return}else if(Fr(n)){r(t,aI(t,n));return}for(var i=an(n)?n:n.split(/\s+/),s=0;s<i.length;s++){var u=i[s];if(!ru(u)){var a=u.match(Ez);if(a){var d=a[1],p=a[2]?a[2]:null,g=aI(t,{type:d,namespace:p,target:t.context});r(t,g)}}}};ou.on=ou.addListener=function(e,t,r,n,i){return Cz(this,function(s,u,a,d,p,g,v){Cn(g)&&s.listeners.push({event:u,callback:g,type:a,namespace:d,qualifier:p,conf:v})},e,t,r,n,i),this};ou.one=function(e,t,r,n){return this.on(e,t,r,n,{one:!0})};ou.removeListener=ou.off=function(e,t,r,n){var i=this;this.emitting!==0&&(this.listeners=r6(this.listeners));for(var s=this.listeners,u=function(p){var g=s[p];Cz(i,function(v,_,b,k,A,M){if((g.type===b||e==="*")&&(!k&&g.namespace!==".*"||g.namespace===k)&&(!A||v.qualifierCompare(g.qualifier,A))&&(!M||g.callback===M))return s.splice(p,1),!1},e,t,r,n)},a=s.length-1;a>=0;a--)u(a);return this};ou.removeAllListeners=function(){return this.removeListener("*")};ou.emit=ou.trigger=function(e,t,r){var n=this.listeners,i=n.length;return this.emitting++,an(t)||(t=[t]),p8(this,function(s,u){r!=null&&(n=[{event:u.event,type:u.type,namespace:u.namespace,callback:r}],i=n.length);for(var a=function(){var g=n[d];if(g.type===u.type&&(!g.namespace||g.namespace===u.namespace||g.namespace===d8)&&s.eventMatches(s.context,g,u)){var v=[u];t!=null&&i6(v,t),s.beforeEmit(s.context,g,u),g.conf&&g.conf.one&&(s.listeners=s.listeners.filter(function(k){return k!==g}));var _=s.callbackContext(s.context,g,u),b=g.callback.apply(_,v);s.afterEmit(s.context,g,u),b===!1&&(u.stopPropagation(),u.preventDefault())}},d=0;d<i;d++)a();s.bubble(s.context)&&!u.isPropagationStopped()&&s.parent(s.context).emit(u,t)},e),this.emitting--,this};var m8={qualifierCompare:function(t,r){return t==null||r==null?t==null&&r==null:t.sameText(r)},eventMatches:function(t,r,n){var i=r.qualifier;return i!=null?t!==n.target&&Bm(n.target)&&i.matches(n.target):!0},addEventFields:function(t,r){r.cy=t.cy(),r.target=t},callbackContext:function(t,r,n){return r.qualifier!=null?n.target:t},beforeEmit:function(t,r){r.conf&&r.conf.once&&r.conf.onceCollection.removeListener(r.event,r.qualifier,r.callback)},bubble:function(){return!0},parent:function(t){return t.isChild()?t.parent():t.cy()}},Cv=function(t){return sr(t)?new au(t):t},kz={createEmitter:function(){for(var t=0;t<this.length;t++){var r=this[t],n=r._private;n.emitter||(n.emitter=new H0(m8,r))}return this},emitter:function(){return this._private.emitter},on:function(t,r,n){for(var i=Cv(r),s=0;s<this.length;s++){var u=this[s];u.emitter().on(t,i,n)}return this},removeListener:function(t,r,n){for(var i=Cv(r),s=0;s<this.length;s++){var u=this[s];u.emitter().removeListener(t,i,n)}return this},removeAllListeners:function(){for(var t=0;t<this.length;t++){var r=this[t];r.emitter().removeAllListeners()}return this},one:function(t,r,n){for(var i=Cv(r),s=0;s<this.length;s++){var u=this[s];u.emitter().one(t,i,n)}return this},once:function(t,r,n){for(var i=Cv(r),s=0;s<this.length;s++){var u=this[s];u.emitter().on(t,i,n,{once:!0,onceCollection:this})}},emit:function(t,r){for(var n=0;n<this.length;n++){var i=this[n];i.emitter().emit(t,r)}return this},emitAndNotify:function(t,r){if(this.length!==0)return this.cy().notify(t,this),this.emit(t,r),this}};Hr.eventAliasesOn(kz);var Pz={nodes:function(t){return this.filter(function(r){return r.isNode()}).filter(t)},edges:function(t){return this.filter(function(r){return r.isEdge()}).filter(t)},byGroup:function(){for(var t=this.spawn(),r=this.spawn(),n=0;n<this.length;n++){var i=this[n];i.isNode()?t.push(i):r.push(i)}return{nodes:t,edges:r}},filter:function(t,r){if(t===void 0)return this;if(sr(t)||La(t))return new au(t).filter(this);if(Cn(t)){for(var n=this.spawn(),i=this,s=0;s<i.length;s++){var u=i[s],a=r?t.apply(r,[u,s,i]):t(u,s,i);a&&n.push(u)}return n}return this.spawn()},not:function(t){if(t){sr(t)&&(t=this.filter(t));for(var r=this.spawn(),n=0;n<this.length;n++){var i=this[n],s=t.has(i);s||r.push(i)}return r}else return this},absoluteComplement:function(){var t=this.cy();return t.mutableElements().not(this)},intersect:function(t){if(sr(t)){var r=t;return this.filter(r)}for(var n=this.spawn(),i=this,s=t,u=this.length<t.length,a=u?i:s,d=u?s:i,p=0;p<a.length;p++){var g=a[p];d.has(g)&&n.push(g)}return n},xor:function(t){var r=this._private.cy;sr(t)&&(t=r.$(t));var n=this.spawn(),i=this,s=t,u=function(d,p){for(var g=0;g<d.length;g++){var v=d[g],_=v._private.data.id,b=p.hasElementWithId(_);b||n.push(v)}};return u(i,s),u(s,i),n},diff:function(t){var r=this._private.cy;sr(t)&&(t=r.$(t));var n=this.spawn(),i=this.spawn(),s=this.spawn(),u=this,a=t,d=function(g,v,_){for(var b=0;b<g.length;b++){var k=g[b],A=k._private.data.id,M=v.hasElementWithId(A);M?s.merge(k):_.push(k)}};return d(u,a,n),d(a,u,i),{left:n,right:i,both:s}},add:function(t){var r=this._private.cy;if(!t)return this;if(sr(t)){var n=t;t=r.mutableElements().filter(n)}for(var i=this.spawnSelf(),s=0;s<t.length;s++){var u=t[s],a=!this.has(u);a&&i.push(u)}return i},merge:function(t){var r=this._private,n=r.cy;if(!t)return this;if(t&&sr(t)){var i=t;t=n.mutableElements().filter(i)}for(var s=r.map,u=0;u<t.length;u++){var a=t[u],d=a._private.data.id,p=!s.has(d);if(p){var g=this.length++;this[g]=a,s.set(d,{ele:a,index:g})}}return this},unmergeAt:function(t){var r=this[t],n=r.id(),i=this._private,s=i.map;this[t]=void 0,s.delete(n);var u=t===this.length-1;if(this.length>1&&!u){var a=this.length-1,d=this[a],p=d._private.data.id;this[a]=void 0,this[t]=d,s.set(p,{ele:d,index:t})}return this.length--,this},unmergeOne:function(t){t=t[0];var r=this._private,n=t._private.data.id,i=r.map,s=i.get(n);if(!s)return this;var u=s.index;return this.unmergeAt(u),this},unmerge:function(t){var r=this._private.cy;if(!t)return this;if(t&&sr(t)){var n=t;t=r.mutableElements().filter(n)}for(var i=0;i<t.length;i++)this.unmergeOne(t[i]);return this},unmergeBy:function(t){for(var r=this.length-1;r>=0;r--){var n=this[r];t(n)&&this.unmergeAt(r)}return this},map:function(t,r){for(var n=[],i=this,s=0;s<i.length;s++){var u=i[s],a=r?t.apply(r,[u,s,i]):t(u,s,i);n.push(a)}return n},reduce:function(t,r){for(var n=r,i=this,s=0;s<i.length;s++)n=t(n,i[s],s,i);return n},max:function(t,r){for(var n=-1/0,i,s=this,u=0;u<s.length;u++){var a=s[u],d=r?t.apply(r,[a,u,s]):t(a,u,s);d>n&&(n=d,i=a)}return{value:n,ele:i}},min:function(t,r){for(var n=1/0,i,s=this,u=0;u<s.length;u++){var a=s[u],d=r?t.apply(r,[a,u,s]):t(a,u,s);d<n&&(n=d,i=a)}return{value:n,ele:i}}},jr=Pz;jr.u=jr["|"]=jr["+"]=jr.union=jr.or=jr.add;jr["\\"]=jr["!"]=jr["-"]=jr.difference=jr.relativeComplement=jr.subtract=jr.not;jr.n=jr["&"]=jr["."]=jr.and=jr.intersection=jr.intersect;jr["^"]=jr["(+)"]=jr["(-)"]=jr.symmetricDifference=jr.symdiff=jr.xor;jr.fnFilter=jr.filterFn=jr.stdFilter=jr.filter;jr.complement=jr.abscomp=jr.absoluteComplement;var g8={isNode:function(){return this.group()==="nodes"},isEdge:function(){return this.group()==="edges"},isLoop:function(){return this.isEdge()&&this.source()[0]===this.target()[0]},isSimple:function(){return this.isEdge()&&this.source()[0]!==this.target()[0]},group:function(){var t=this[0];if(t)return t._private.group}},Iz=function(t,r){var n=t.cy(),i=n.hasCompoundNodes();function s(g){var v=g.pstyle("z-compound-depth");return v.value==="auto"?i?g.zDepth():0:v.value==="bottom"?-1:v.value==="top"?bS:0}var u=s(t)-s(r);if(u!==0)return u;function a(g){var v=g.pstyle("z-index-compare");return v.value==="auto"&&g.isNode()?1:0}var d=a(t)-a(r);if(d!==0)return d;var p=t.pstyle("z-index").value-r.pstyle("z-index").value;return p!==0?p:t.poolIndex()-r.poolIndex()},Xy={forEach:function(t,r){if(Cn(t))for(var n=this.length,i=0;i<n;i++){var s=this[i],u=r?t.apply(r,[s,i,this]):t(s,i,this);if(u===!1)break}return this},toArray:function(){for(var t=[],r=0;r<this.length;r++)t.push(this[r]);return t},slice:function(t,r){var n=[],i=this.length;r==null&&(r=i),t==null&&(t=0),t<0&&(t=i+t),r<0&&(r=i+r);for(var s=t;s>=0&&s<r&&s<i;s++)n.push(this[s]);return this.spawn(n)},size:function(){return this.length},eq:function(t){return this[t]||this.spawn()},first:function(){return this[0]||this.spawn()},last:function(){return this[this.length-1]||this.spawn()},empty:function(){return this.length===0},nonempty:function(){return!this.empty()},sort:function(t){if(!Cn(t))return this;var r=this.toArray().sort(t);return this.spawn(r)},sortByZIndex:function(){return this.sort(Iz)},zDepth:function(){var t=this[0];if(t){var r=t._private,n=r.group;if(n==="nodes"){var i=r.data.parent?t.parents().size():0;return t.isParent()?i:bS-1}else{var s=r.source,u=r.target,a=s.zDepth(),d=u.zDepth();return Math.max(a,d,0)}}}};Xy.each=Xy.forEach;var v8=function(){var t="undefined",r=(typeof Symbol>"u"?"undefined":Jn(Symbol))!=t&&Jn(Symbol.iterator)!=t;r&&(Xy[Symbol.iterator]=function(){var n=this,i={value:void 0,done:!1},s=0,u=this.length;return kN({next:function(){return s<u?i.value=n[s++]:(i.value=void 0,i.done=!0),i}},Symbol.iterator,function(){return this})})};v8();var y8=Ti({nodeDimensionsIncludeLabels:!1}),oy={layoutDimensions:function(t){t=y8(t);var r;if(!this.takesUpSpace())r={w:0,h:0};else if(t.nodeDimensionsIncludeLabels){var n=this.boundingBox();r={w:n.w,h:n.h}}else r={w:this.outerWidth(),h:this.outerHeight()};return(r.w===0||r.h===0)&&(r.w=r.h=1),r},layoutPositions:function(t,r,n){var i=this.nodes().filter(function(V){return!V.isParent()}),s=this.cy(),u=r.eles,a=function(U){return U.id()},d=Td(n,a);t.emit({type:"layoutstart",layout:t}),t.animations=[];var p=function(U,$,G){var Z={x:$.x1+$.w/2,y:$.y1+$.h/2},Q={x:(G.x-Z.x)*U,y:(G.y-Z.y)*U};return{x:Z.x+Q.x,y:Z.y+Q.y}},g=r.spacingFactor&&r.spacingFactor!==1,v=function(){if(!g)return null;for(var U=ta(),$=0;$<i.length;$++){var G=i[$],Z=d(G,$);WN(U,Z.x,Z.y)}return U},_=v(),b=Td(function(V,U){var $=d(V,U);if(g){var G=Math.abs(r.spacingFactor);$=p(G,_,$)}return r.transform!=null&&($=r.transform(V,$)),$},a);if(r.animate){for(var k=0;k<i.length;k++){var A=i[k],M=b(A,k),P=r.animateFilter==null||r.animateFilter(A,k);if(P){var I=A.animation({position:M,duration:r.animationDuration,easing:r.animationEasing});t.animations.push(I)}else A.position(M)}if(r.fit){var z=s.animation({fit:{boundingBox:u.boundingBoxAt(b),padding:r.padding},duration:r.animationDuration,easing:r.animationEasing});t.animations.push(z)}else if(r.zoom!==void 0&&r.pan!==void 0){var O=s.animation({zoom:r.zoom,pan:r.pan,duration:r.animationDuration,easing:r.animationEasing});t.animations.push(O)}t.animations.forEach(function(V){return V.play()}),t.one("layoutready",r.ready),t.emit({type:"layoutready",layout:t}),Bd.all(t.animations.map(function(V){return V.promise()})).then(function(){t.one("layoutstop",r.stop),t.emit({type:"layoutstop",layout:t})})}else i.positions(b),r.fit&&s.fit(r.eles,r.padding),r.zoom!=null&&s.zoom(r.zoom),r.pan&&s.pan(r.pan),t.one("layoutready",r.ready),t.emit({type:"layoutready",layout:t}),t.one("layoutstop",r.stop),t.emit({type:"layoutstop",layout:t});return this},layout:function(t){var r=this.cy();return r.makeLayout(dr({},t,{eles:this}))}};oy.createLayout=oy.makeLayout=oy.layout;function Az(e,t,r){var n=r._private,i=n.styleCache=n.styleCache||[],s;return(s=i[e])!=null||(s=i[e]=t(r)),s}function G0(e,t){return e=gc(e),function(n){return Az(e,t,n)}}function W0(e,t){e=gc(e);var r=function(i){return t.call(i)};return function(){var i=this[0];if(i)return Az(e,r,i)}}var bi={recalculateRenderedStyle:function(t){var r=this.cy(),n=r.renderer(),i=r.styleEnabled();return n&&i&&n.recalculateRenderedStyle(this,t),this},dirtyStyleCache:function(){var t=this.cy(),r=function(s){return s._private.styleCache=null};if(t.hasCompoundNodes()){var n;n=this.spawnSelf().merge(this.descendants()).merge(this.parents()),n.merge(n.connectedEdges()),n.forEach(r)}else this.forEach(function(i){r(i),i.connectedEdges().forEach(r)});return this},updateStyle:function(t){var r=this._private.cy;if(!r.styleEnabled())return this;if(r.batching()){var n=r._private.batchStyleEles;return n.merge(this),this}var i=r.hasCompoundNodes(),s=this;t=!!(t||t===void 0),i&&(s=this.spawnSelf().merge(this.descendants()).merge(this.parents()));var u=s;return t?u.emitAndNotify("style"):u.emit("style"),s.forEach(function(a){return a._private.styleDirty=!0}),this},cleanStyle:function(){var t=this.cy();if(t.styleEnabled())for(var r=0;r<this.length;r++){var n=this[r];n._private.styleDirty&&(n._private.styleDirty=!1,t.style().apply(n))}},parsedStyle:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=this[0],i=n.cy();if(i.styleEnabled()&&n){n._private.styleDirty&&(n._private.styleDirty=!1,i.style().apply(n));var s=n._private.style[t];return s??(r?i.style().getDefaultProperty(t):null)}},numericStyle:function(t){var r=this[0];if(r.cy().styleEnabled()&&r){var n=r.pstyle(t);return n.pfValue!==void 0?n.pfValue:n.value}},numericStyleUnits:function(t){var r=this[0];if(r.cy().styleEnabled()&&r)return r.pstyle(t).units},renderedStyle:function(t){var r=this.cy();if(!r.styleEnabled())return this;var n=this[0];if(n)return r.style().getRenderedStyle(n,t)},style:function(t,r){var n=this.cy();if(!n.styleEnabled())return this;var i=!1,s=n.style();if(Fr(t)){var u=t;s.applyBypass(this,u,i),this.emitAndNotify("style")}else if(sr(t))if(r===void 0){var a=this[0];return a?s.getStylePropertyValue(a,t):void 0}else s.applyBypass(this,t,r,i),this.emitAndNotify("style");else if(t===void 0){var d=this[0];return d?s.getRawStyle(d):void 0}return this},removeStyle:function(t){var r=this.cy();if(!r.styleEnabled())return this;var n=!1,i=r.style(),s=this;if(t===void 0)for(var u=0;u<s.length;u++){var a=s[u];i.removeAllBypasses(a,n)}else{t=t.split(/\s+/);for(var d=0;d<s.length;d++){var p=s[d];i.removeBypasses(p,t,n)}}return this.emitAndNotify("style"),this},show:function(){return this.css("display","element"),this},hide:function(){return this.css("display","none"),this},effectiveOpacity:function(){var t=this.cy();if(!t.styleEnabled())return 1;var r=t.hasCompoundNodes(),n=this[0];if(n){var i=n._private,s=n.pstyle("opacity").value;if(!r)return s;var u=i.data.parent?n.parents():null;if(u)for(var a=0;a<u.length;a++){var d=u[a],p=d.pstyle("opacity").value;s=p*s}return s}},transparent:function(){var t=this.cy();if(!t.styleEnabled())return!1;var r=this[0],n=r.cy().hasCompoundNodes();if(r)return n?r.effectiveOpacity()===0:r.pstyle("opacity").value===0},backgrounding:function(){var t=this.cy();if(!t.styleEnabled())return!1;var r=this[0];return!!r._private.backgrounding}};function xb(e,t){var r=e._private,n=r.data.parent?e.parents():null;if(n)for(var i=0;i<n.length;i++){var s=n[i];if(!t(s))return!1}return!0}function zS(e){var t=e.ok,r=e.edgeOkViaNode||e.ok,n=e.parentOk||e.ok;return function(){var i=this.cy();if(!i.styleEnabled())return!0;var s=this[0],u=i.hasCompoundNodes();if(s){var a=s._private;if(!t(s))return!1;if(s.isNode())return!u||xb(s,n);var d=a.source,p=a.target;return r(d)&&(!u||xb(d,r))&&(d===p||r(p)&&(!u||xb(p,r)))}}}var Od=G0("eleTakesUpSpace",function(e){return e.pstyle("display").value==="element"&&e.width()!==0&&(e.isNode()?e.height()!==0:!0)});bi.takesUpSpace=W0("takesUpSpace",zS({ok:Od}));var x8=G0("eleInteractive",function(e){return e.pstyle("events").value==="yes"&&e.pstyle("visibility").value==="visible"&&Od(e)}),_8=G0("parentInteractive",function(e){return e.pstyle("visibility").value==="visible"&&Od(e)});bi.interactive=W0("interactive",zS({ok:x8,parentOk:_8,edgeOkViaNode:Od}));bi.noninteractive=function(){var e=this[0];if(e)return!e.interactive()};var w8=G0("eleVisible",function(e){return e.pstyle("visibility").value==="visible"&&e.pstyle("opacity").pfValue!==0&&Od(e)}),b8=Od;bi.visible=W0("visible",zS({ok:w8,edgeOkViaNode:b8}));bi.hidden=function(){var e=this[0];if(e)return!e.visible()};bi.isBundledBezier=W0("isBundledBezier",function(){return this.cy().styleEnabled()?!this.removed()&&this.pstyle("curve-style").value==="bezier"&&this.takesUpSpace():!1});bi.bypass=bi.css=bi.style;bi.renderedCss=bi.renderedStyle;bi.removeBypass=bi.removeCss=bi.removeStyle;bi.pstyle=bi.parsedStyle;var Yl={};function sI(e){return function(){var t=arguments,r=[];if(t.length===2){var n=t[0],i=t[1];this.on(e.event,n,i)}else if(t.length===1&&Cn(t[0])){var s=t[0];this.on(e.event,s)}else if(t.length===0||t.length===1&&an(t[0])){for(var u=t.length===1?t[0]:null,a=0;a<this.length;a++){var d=this[a],p=!e.ableField||d._private[e.ableField],g=d._private[e.field]!=e.value;if(e.overrideAble){var v=e.overrideAble(d);if(v!==void 0&&(p=v,!v))return this}p&&(d._private[e.field]=e.value,g&&r.push(d))}var _=this.spawn(r);_.updateStyle(),_.emit(e.event),u&&_.emit(u)}return this}}function Fd(e){Yl[e.field]=function(){var t=this[0];if(t){if(e.overrideField){var r=e.overrideField(t);if(r!==void 0)return r}return t._private[e.field]}},Yl[e.on]=sI({event:e.on,field:e.field,ableField:e.ableField,overrideAble:e.overrideAble,value:!0}),Yl[e.off]=sI({event:e.off,field:e.field,ableField:e.ableField,overrideAble:e.overrideAble,value:!1})}Fd({field:"locked",overrideField:function(t){return t.cy().autolock()?!0:void 0},on:"lock",off:"unlock"});Fd({field:"grabbable",overrideField:function(t){return t.cy().autoungrabify()||t.pannable()?!1:void 0},on:"grabify",off:"ungrabify"});Fd({field:"selected",ableField:"selectable",overrideAble:function(t){return t.cy().autounselectify()?!1:void 0},on:"select",off:"unselect"});Fd({field:"selectable",overrideField:function(t){return t.cy().autounselectify()?!1:void 0},on:"selectify",off:"unselectify"});Yl.deselect=Yl.unselect;Yl.grabbed=function(){var e=this[0];if(e)return e._private.grabbed};Fd({field:"active",on:"activate",off:"unactivate"});Fd({field:"pannable",on:"panify",off:"unpanify"});Yl.inactive=function(){var e=this[0];if(e)return!e._private.active};var $i={},oI=function(t){return function(n){for(var i=this,s=[],u=0;u<i.length;u++){var a=i[u];if(a.isNode()){for(var d=!1,p=a.connectedEdges(),g=0;g<p.length;g++){var v=p[g],_=v.source(),b=v.target();if(t.noIncomingEdges&&b===a&&_!==a||t.noOutgoingEdges&&_===a&&b!==a){d=!0;break}}d||s.push(a)}}return this.spawn(s,!0).filter(n)}},lI=function(t){return function(r){for(var n=this,i=[],s=0;s<n.length;s++){var u=n[s];if(u.isNode())for(var a=u.connectedEdges(),d=0;d<a.length;d++){var p=a[d],g=p.source(),v=p.target();t.outgoing&&g===u?(i.push(p),i.push(v)):t.incoming&&v===u&&(i.push(p),i.push(g))}}return this.spawn(i,!0).filter(r)}},uI=function(t){return function(r){for(var n=this,i=[],s={};;){var u=t.outgoing?n.outgoers():n.incomers();if(u.length===0)break;for(var a=!1,d=0;d<u.length;d++){var p=u[d],g=p.id();s[g]||(s[g]=!0,i.push(p),a=!0)}if(!a)break;n=u}return this.spawn(i,!0).filter(r)}};$i.clearTraversalCache=function(){for(var e=0;e<this.length;e++)this[e]._private.traversalCache=null};dr($i,{roots:oI({noIncomingEdges:!0}),leaves:oI({noOutgoingEdges:!0}),outgoers:ns(lI({outgoing:!0}),"outgoers"),successors:uI({outgoing:!0}),incomers:ns(lI({incoming:!0}),"incomers"),predecessors:uI({})});dr($i,{neighborhood:ns(function(e){for(var t=[],r=this.nodes(),n=0;n<r.length;n++)for(var i=r[n],s=i.connectedEdges(),u=0;u<s.length;u++){var a=s[u],d=a.source(),p=a.target(),g=i===d?p:d;g.length>0&&t.push(g[0]),t.push(a[0])}return this.spawn(t,!0).filter(e)},"neighborhood"),closedNeighborhood:function(t){return this.neighborhood().add(this).filter(t)},openNeighborhood:function(t){return this.neighborhood(t)}});$i.neighbourhood=$i.neighborhood;$i.closedNeighbourhood=$i.closedNeighborhood;$i.openNeighbourhood=$i.openNeighborhood;dr($i,{source:ns(function(t){var r=this[0],n;return r&&(n=r._private.source||r.cy().collection()),n&&t?n.filter(t):n},"source"),target:ns(function(t){var r=this[0],n;return r&&(n=r._private.target||r.cy().collection()),n&&t?n.filter(t):n},"target"),sources:cI({attr:"source"}),targets:cI({attr:"target"})});function cI(e){return function(r){for(var n=[],i=0;i<this.length;i++){var s=this[i],u=s._private[e.attr];u&&n.push(u)}return this.spawn(n,!0).filter(r)}}dr($i,{edgesWith:ns(hI(),"edgesWith"),edgesTo:ns(hI({thisIsSrc:!0}),"edgesTo")});function hI(e){return function(r){var n=[],i=this._private.cy,s=e||{};sr(r)&&(r=i.$(r));for(var u=0;u<r.length;u++)for(var a=r[u]._private.edges,d=0;d<a.length;d++){var p=a[d],g=p._private.data,v=this.hasElementWithId(g.source)&&r.hasElementWithId(g.target),_=r.hasElementWithId(g.source)&&this.hasElementWithId(g.target),b=v||_;b&&((s.thisIsSrc||s.thisIsTgt)&&(s.thisIsSrc&&!v||s.thisIsTgt&&!_)||n.push(p))}return this.spawn(n,!0)}}dr($i,{connectedEdges:ns(function(e){for(var t=[],r=this,n=0;n<r.length;n++){var i=r[n];if(i.isNode())for(var s=i._private.edges,u=0;u<s.length;u++){var a=s[u];t.push(a)}}return this.spawn(t,!0).filter(e)},"connectedEdges"),connectedNodes:ns(function(e){for(var t=[],r=this,n=0;n<r.length;n++){var i=r[n];i.isEdge()&&(t.push(i.source()[0]),t.push(i.target()[0]))}return this.spawn(t,!0).filter(e)},"connectedNodes"),parallelEdges:ns(dI(),"parallelEdges"),codirectedEdges:ns(dI({codirected:!0}),"codirectedEdges")});function dI(e){var t={codirected:!1};return e=dr({},t,e),function(n){for(var i=[],s=this.edges(),u=e,a=0;a<s.length;a++)for(var d=s[a],p=d._private,g=p.source,v=g._private.data.id,_=p.data.target,b=g._private.edges,k=0;k<b.length;k++){var A=b[k],M=A._private.data,P=M.target,I=M.source,z=P===_&&I===v,O=v===P&&_===I;(u.codirected&&z||!u.codirected&&(z||O))&&i.push(A)}return this.spawn(i,!0).filter(n)}}dr($i,{components:function(t){var r=this,n=r.cy(),i=n.collection(),s=t==null?r.nodes():t.nodes(),u=[];t!=null&&s.empty()&&(s=t.sources());var a=function(g,v){i.merge(g),s.unmerge(g),v.merge(g)};if(s.empty())return r.spawn();var d=function(){var g=n.collection();u.push(g);var v=s[0];a(v,g),r.bfs({directed:!1,roots:v,visit:function(b){return a(b,g)}}),g.forEach(function(_){_.connectedEdges().forEach(function(b){r.has(b)&&g.has(b.source())&&g.has(b.target())&&g.merge(b)})})};do d();while(s.length>0);return u},component:function(){var t=this[0];return t.cy().mutableElements().components(t)[0]}});$i.componentsOf=$i.components;var Si=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(t===void 0){_n("A collection must have a reference to the core");return}var s=new Po,u=!1;if(!r)r=[];else if(r.length>0&&Fr(r[0])&&!Bm(r[0])){u=!0;for(var a=[],d=new Ld,p=0,g=r.length;p<g;p++){var v=r[p];v.data==null&&(v.data={});var _=v.data;if(_.id==null)_.id=qN();else if(t.hasElementWithId(_.id)||d.has(_.id))continue;var b=new B0(t,v,!1);a.push(b),d.add(_.id)}r=a}this.length=0;for(var k=0,A=r.length;k<A;k++){var M=r[k][0];if(M!=null){var P=M._private.data.id;(!n||!s.has(P))&&(n&&s.set(P,{index:this.length,ele:M}),this[this.length]=M,this.length++)}}this._private={eles:this,cy:t,get map(){return this.lazyMap==null&&this.rebuildMap(),this.lazyMap},set map(I){this.lazyMap=I},rebuildMap:function(){for(var z=this.lazyMap=new Po,O=this.eles,V=0;V<O.length;V++){var U=O[V];z.set(U.id(),{index:V,ele:U})}}},n&&(this._private.map=s),u&&!i&&this.restore()},ln=B0.prototype=Si.prototype=Object.create(Array.prototype);ln.instanceString=function(){return"collection"};ln.spawn=function(e,t){return new Si(this.cy(),e,t)};ln.spawnSelf=function(){return this.spawn(this)};ln.cy=function(){return this._private.cy};ln.renderer=function(){return this._private.cy.renderer()};ln.element=function(){return this[0]};ln.collection=function(){return AN(this)?this:new Si(this._private.cy,[this])};ln.unique=function(){return new Si(this._private.cy,this,!0)};ln.hasElementWithId=function(e){return e=""+e,this._private.map.has(e)};ln.getElementById=function(e){e=""+e;var t=this._private.cy,r=this._private.map.get(e);return r?r.ele:new Si(t)};ln.$id=ln.getElementById;ln.poolIndex=function(){var e=this._private.cy,t=e._private.elements,r=this[0]._private.data.id;return t._private.map.get(r).index};ln.indexOf=function(e){var t=e[0]._private.data.id;return this._private.map.get(t).index};ln.indexOfId=function(e){return e=""+e,this._private.map.get(e).index};ln.json=function(e){var t=this.element(),r=this.cy();if(t==null&&e)return this;if(t!=null){var n=t._private;if(Fr(e)){if(r.startBatch(),e.data){t.data(e.data);var i=n.data;if(t.isEdge()){var s=!1,u={},a=e.data.source,d=e.data.target;a!=null&&a!=i.source&&(u.source=""+a,s=!0),d!=null&&d!=i.target&&(u.target=""+d,s=!0),s&&(t=t.move(u))}else{var p="parent"in e.data,g=e.data.parent;p&&(g!=null||i.parent!=null)&&g!=i.parent&&(g===void 0&&(g=null),g!=null&&(g=""+g),t=t.move({parent:g}))}}e.position&&t.position(e.position);var v=function(A,M,P){var I=e[A];I!=null&&I!==n[A]&&(I?t[M]():t[P]())};return v("removed","remove","restore"),v("selected","select","unselect"),v("selectable","selectify","unselectify"),v("locked","lock","unlock"),v("grabbable","grabify","ungrabify"),v("pannable","panify","unpanify"),e.classes!=null&&t.classes(e.classes),r.endBatch(),this}else if(e===void 0){var _={data:Gs(n.data),position:Gs(n.position),group:n.group,removed:n.removed,selected:n.selected,selectable:n.selectable,locked:n.locked,grabbable:n.grabbable,pannable:n.pannable,classes:null};_.classes="";var b=0;return n.classes.forEach(function(k){return _.classes+=b++===0?k:" "+k}),_}}};ln.jsons=function(){for(var e=[],t=0;t<this.length;t++){var r=this[t],n=r.json();e.push(n)}return e};ln.clone=function(){for(var e=this.cy(),t=[],r=0;r<this.length;r++){var n=this[r],i=n.json(),s=new B0(e,i,!1);t.push(s)}return new Si(e,t)};ln.copy=ln.clone;ln.restore=function(){for(var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=this,n=r.cy(),i=n._private,s=[],u=[],a,d=0,p=r.length;d<p;d++){var g=r[d];t&&!g.removed()||(g.isNode()?s.push(g):u.push(g))}a=s.concat(u);var v,_=function(){a.splice(v,1),v--};for(v=0;v<a.length;v++){var b=a[v],k=b._private,A=k.data;if(b.clearTraversalCache(),!(!t&&!k.removed)){if(A.id===void 0)A.id=qN();else if(Rt(A.id))A.id=""+A.id;else if(ru(A.id)||!sr(A.id)){_n("Can not create element with invalid string ID `"+A.id+"`"),_();continue}else if(n.hasElementWithId(A.id)){_n("Can not create second element with ID `"+A.id+"`"),_();continue}}var M=A.id;if(b.isNode()){var P=k.position;P.x==null&&(P.x=0),P.y==null&&(P.y=0)}if(b.isEdge()){for(var I=b,z=["source","target"],O=z.length,V=!1,U=0;U<O;U++){var $=z[U],G=A[$];Rt(G)&&(G=A[$]=""+A[$]),G==null||G===""?(_n("Can not create edge `"+M+"` with unspecified "+$),V=!0):n.hasElementWithId(G)||(_n("Can not create edge `"+M+"` with nonexistant "+$+" `"+G+"`"),V=!0)}if(V){_();continue}var Z=n.getElementById(A.source),Q=n.getElementById(A.target);Z.same(Q)?Z._private.edges.push(I):(Z._private.edges.push(I),Q._private.edges.push(I)),I._private.source=Z,I._private.target=Q}k.map=new Po,k.map.set(M,{ele:b,index:0}),k.removed=!1,t&&n.addToPool(b)}for(var X=0;X<s.length;X++){var ie=s[X],te=ie._private.data;Rt(te.parent)&&(te.parent=""+te.parent);var W=te.parent,oe=W!=null;if(oe||ie._private.parent){var se=ie._private.parent?n.collection().merge(ie._private.parent):n.getElementById(W);if(se.empty())te.parent=void 0;else if(se[0].removed())Gr("Node added with missing parent, reference to parent removed"),te.parent=void 0,ie._private.parent=null;else{for(var de=!1,me=se;!me.empty();){if(ie.same(me)){de=!0,te.parent=void 0;break}me=me.parent()}de||(se[0]._private.children.push(ie),ie._private.parent=se[0],i.hasCompoundNodes=!0)}}}if(a.length>0){for(var ae=a.length===r.length?r:new Si(n,a),ve=0;ve<ae.length;ve++){var pe=ae[ve];pe.isNode()||(pe.parallelEdges().clearTraversalCache(),pe.source().clearTraversalCache(),pe.target().clearTraversalCache())}var _e;i.hasCompoundNodes?_e=n.collection().merge(ae).merge(ae.connectedNodes()).merge(ae.parent()):_e=ae,_e.dirtyCompoundBoundsCache().dirtyBoundingBoxCache().updateStyle(e),e?ae.emitAndNotify("add"):t&&ae.emit("add")}return r};ln.removed=function(){var e=this[0];return e&&e._private.removed};ln.inside=function(){var e=this[0];return e&&!e._private.removed};ln.remove=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=this,n=[],i={},s=r._private.cy;function u(W){for(var oe=W._private.edges,se=0;se<oe.length;se++)d(oe[se])}function a(W){for(var oe=W._private.children,se=0;se<oe.length;se++)d(oe[se])}function d(W){var oe=i[W.id()];t&&W.removed()||oe||(i[W.id()]=!0,W.isNode()?(n.push(W),u(W),a(W)):n.unshift(W))}for(var p=0,g=r.length;p<g;p++){var v=r[p];d(v)}function _(W,oe){var se=W._private.edges;nu(se,oe),W.clearTraversalCache()}function b(W){W.clearTraversalCache()}var k=[];k.ids={};function A(W,oe){oe=oe[0],W=W[0];var se=W._private.children,de=W.id();nu(se,oe),oe._private.parent=null,k.ids[de]||(k.ids[de]=!0,k.push(W))}r.dirtyCompoundBoundsCache(),t&&s.removeFromPool(n);for(var M=0;M<n.length;M++){var P=n[M];if(P.isEdge()){var I=P.source()[0],z=P.target()[0];_(I,P),_(z,P);for(var O=P.parallelEdges(),V=0;V<O.length;V++){var U=O[V];b(U),U.isBundledBezier()&&U.dirtyBoundingBoxCache()}}else{var $=P.parent();$.length!==0&&A($,P)}t&&(P._private.removed=!0)}var G=s._private.elements;s._private.hasCompoundNodes=!1;for(var Z=0;Z<G.length;Z++){var Q=G[Z];if(Q.isParent()){s._private.hasCompoundNodes=!0;break}}var X=new Si(this.cy(),n);X.size()>0&&(e?X.emitAndNotify("remove"):t&&X.emit("remove"));for(var ie=0;ie<k.length;ie++){var te=k[ie];(!t||!te.removed())&&te.updateStyle()}return X};ln.move=function(e){var t=this._private.cy,r=this,n=!1,i=!1,s=function(k){return k==null?k:""+k};if(e.source!==void 0||e.target!==void 0){var u=s(e.source),a=s(e.target),d=u!=null&&t.hasElementWithId(u),p=a!=null&&t.hasElementWithId(a);(d||p)&&(t.batch(function(){r.remove(n,i),r.emitAndNotify("moveout");for(var b=0;b<r.length;b++){var k=r[b],A=k._private.data;k.isEdge()&&(d&&(A.source=u),p&&(A.target=a))}r.restore(n,i)}),r.emitAndNotify("move"))}else if(e.parent!==void 0){var g=s(e.parent),v=g===null||t.hasElementWithId(g);if(v){var _=g===null?void 0:g;t.batch(function(){var b=r.remove(n,i);b.emitAndNotify("moveout");for(var k=0;k<r.length;k++){var A=r[k],M=A._private.data;A.isNode()&&(M.parent=_)}b.restore(n,i)}),r.emitAndNotify("move")}}return this};[rz,NV,sy,Kl,kd,XV,q0,h8,kz,Pz,g8,Xy,oy,bi,Yl,$i].forEach(function(e){dr(ln,e)});var S8={add:function(t){var r,n=this;if(La(t)){var i=t;if(i._private.cy===n)r=i.restore();else{for(var s=[],u=0;u<i.length;u++){var a=i[u];s.push(a.json())}r=new Si(n,s)}}else if(an(t)){var d=t;r=new Si(n,d)}else if(Fr(t)&&(an(t.nodes)||an(t.edges))){for(var p=t,g=[],v=["nodes","edges"],_=0,b=v.length;_<b;_++){var k=v[_],A=p[k];if(an(A))for(var M=0,P=A.length;M<P;M++){var I=dr({group:k},A[M]);g.push(I)}}r=new Si(n,g)}else{var z=t;r=new B0(n,z).collection()}return r},remove:function(t){if(!La(t)){if(sr(t)){var r=t;t=this.$(r)}}return t.remove()}};/*! Bezier curve function generator. Copyright Gaetan Renaudeau. MIT License: http://en.wikipedia.org/wiki/MIT_License */function E8(e,t,r,n){var i=4,s=.001,u=1e-7,a=10,d=11,p=1/(d-1),g=typeof Float32Array<"u";if(arguments.length!==4)return!1;for(var v=0;v<4;++v)if(typeof arguments[v]!="number"||isNaN(arguments[v])||!isFinite(arguments[v]))return!1;e=Math.min(e,1),r=Math.min(r,1),e=Math.max(e,0),r=Math.max(r,0);var _=g?new Float32Array(d):new Array(d);function b(Q,X){return 1-3*X+3*Q}function k(Q,X){return 3*X-6*Q}function A(Q){return 3*Q}function M(Q,X,ie){return((b(X,ie)*Q+k(X,ie))*Q+A(X))*Q}function P(Q,X,ie){return 3*b(X,ie)*Q*Q+2*k(X,ie)*Q+A(X)}function I(Q,X){for(var ie=0;ie<i;++ie){var te=P(X,e,r);if(te===0)return X;var W=M(X,e,r)-Q;X-=W/te}return X}function z(){for(var Q=0;Q<d;++Q)_[Q]=M(Q*p,e,r)}function O(Q,X,ie){var te,W,oe=0;do W=X+(ie-X)/2,te=M(W,e,r)-Q,te>0?ie=W:X=W;while(Math.abs(te)>u&&++oe<a);return W}function V(Q){for(var X=0,ie=1,te=d-1;ie!==te&&_[ie]<=Q;++ie)X+=p;--ie;var W=(Q-_[ie])/(_[ie+1]-_[ie]),oe=X+W*p,se=P(oe,e,r);return se>=s?I(Q,oe):se===0?oe:O(Q,X,X+p)}var U=!1;function $(){U=!0,(e!==t||r!==n)&&z()}var G=function(X){return U||$(),e===t&&r===n?X:X===0?0:X===1?1:M(V(X),t,n)};G.getControlPoints=function(){return[{x:e,y:t},{x:r,y:n}]};var Z="generateBezier("+[e,t,r,n]+")";return G.toString=function(){return Z},G}/*! Runge-Kutta spring physics function generator. Adapted from Framer.js, copyright Koen Bok. MIT License: http://en.wikipedia.org/wiki/MIT_License */var T8=function(){function e(n){return-n.tension*n.x-n.friction*n.v}function t(n,i,s){var u={x:n.x+s.dx*i,v:n.v+s.dv*i,tension:n.tension,friction:n.friction};return{dx:u.v,dv:e(u)}}function r(n,i){var s={dx:n.v,dv:e(n)},u=t(n,i*.5,s),a=t(n,i*.5,u),d=t(n,i,a),p=1/6*(s.dx+2*(u.dx+a.dx)+d.dx),g=1/6*(s.dv+2*(u.dv+a.dv)+d.dv);return n.x=n.x+p*i,n.v=n.v+g*i,n}return function n(i,s,u){var a={x:-1,v:0,tension:null,friction:null},d=[0],p=0,g=1/1e4,v=16/1e3,_,b,k;for(i=parseFloat(i)||500,s=parseFloat(s)||20,u=u||null,a.tension=i,a.friction=s,_=u!==null,_?(p=n(i,s),b=p/u*v):b=v;k=r(k||a,b),d.push(1+k.x),p+=16,Math.abs(k.x)>g&&Math.abs(k.v)>g;);return _?function(A){return d[A*(d.length-1)|0]}:p}}(),sn=function(t,r,n,i){var s=E8(t,r,n,i);return function(u,a,d){return u+(a-u)*s(d)}},ly={linear:function(t,r,n){return t+(r-t)*n},ease:sn(.25,.1,.25,1),"ease-in":sn(.42,0,1,1),"ease-out":sn(0,0,.58,1),"ease-in-out":sn(.42,0,.58,1),"ease-in-sine":sn(.47,0,.745,.715),"ease-out-sine":sn(.39,.575,.565,1),"ease-in-out-sine":sn(.445,.05,.55,.95),"ease-in-quad":sn(.55,.085,.68,.53),"ease-out-quad":sn(.25,.46,.45,.94),"ease-in-out-quad":sn(.455,.03,.515,.955),"ease-in-cubic":sn(.55,.055,.675,.19),"ease-out-cubic":sn(.215,.61,.355,1),"ease-in-out-cubic":sn(.645,.045,.355,1),"ease-in-quart":sn(.895,.03,.685,.22),"ease-out-quart":sn(.165,.84,.44,1),"ease-in-out-quart":sn(.77,0,.175,1),"ease-in-quint":sn(.755,.05,.855,.06),"ease-out-quint":sn(.23,1,.32,1),"ease-in-out-quint":sn(.86,0,.07,1),"ease-in-expo":sn(.95,.05,.795,.035),"ease-out-expo":sn(.19,1,.22,1),"ease-in-out-expo":sn(1,0,0,1),"ease-in-circ":sn(.6,.04,.98,.335),"ease-out-circ":sn(.075,.82,.165,1),"ease-in-out-circ":sn(.785,.135,.15,.86),spring:function(t,r,n){if(n===0)return ly.linear;var i=T8(t,r,n);return function(s,u,a){return s+(u-s)*i(a)}},"cubic-bezier":sn};function fI(e,t,r,n,i){if(n===1||t===r)return r;var s=i(t,r,n);return e==null||((e.roundValue||e.color)&&(s=Math.round(s)),e.min!==void 0&&(s=Math.max(s,e.min)),e.max!==void 0&&(s=Math.min(s,e.max))),s}function pI(e,t){return e.pfValue!=null||e.value!=null?e.pfValue!=null&&(t==null||t.type.units!=="%")?e.pfValue:e.value:e}function Ph(e,t,r,n,i){var s=i!=null?i.type:null;r<0?r=0:r>1&&(r=1);var u=pI(e,i),a=pI(t,i);if(Rt(u)&&Rt(a))return fI(s,u,a,r,n);if(an(u)&&an(a)){for(var d=[],p=0;p<a.length;p++){var g=u[p],v=a[p];if(g!=null&&v!=null){var _=fI(s,g,v,r,n);d.push(_)}else d.push(v)}return d}}function C8(e,t,r,n){var i=!n,s=e._private,u=t._private,a=u.easing,d=u.startTime,p=n?e:e.cy(),g=p.style();if(!u.easingImpl)if(a==null)u.easingImpl=ly.linear;else{var v;if(sr(a)){var _=g.parse("transition-timing-function",a);v=_.value}else v=a;var b,k;sr(v)?(b=v,k=[]):(b=v[1],k=v.slice(2).map(function(ae){return+ae})),k.length>0?(b==="spring"&&k.push(u.duration),u.easingImpl=ly[b].apply(null,k)):u.easingImpl=ly[b]}var A=u.easingImpl,M;if(u.duration===0?M=1:M=(r-d)/u.duration,u.applying&&(M=u.progress),M<0?M=0:M>1&&(M=1),u.delay==null){var P=u.startPosition,I=u.position;if(I&&i&&!e.locked()){var z={};ap(P.x,I.x)&&(z.x=Ph(P.x,I.x,M,A)),ap(P.y,I.y)&&(z.y=Ph(P.y,I.y,M,A)),e.position(z)}var O=u.startPan,V=u.pan,U=s.pan,$=V!=null&&n;$&&(ap(O.x,V.x)&&(U.x=Ph(O.x,V.x,M,A)),ap(O.y,V.y)&&(U.y=Ph(O.y,V.y,M,A)),e.emit("pan"));var G=u.startZoom,Z=u.zoom,Q=Z!=null&&n;Q&&(ap(G,Z)&&(s.zoom=um(s.minZoom,Ph(G,Z,M,A),s.maxZoom)),e.emit("zoom")),($||Q)&&e.emit("viewport");var X=u.style;if(X&&X.length>0&&i){for(var ie=0;ie<X.length;ie++){var te=X[ie],W=te.name,oe=te,se=u.startStyle[W],de=g.properties[se.name],me=Ph(se,oe,M,A,de);g.overrideBypass(e,W,me)}e.emit("style")}}return u.progress=M,M}function ap(e,t){return e==null||t==null?!1:Rt(e)&&Rt(t)?!0:!!(e&&t)}function k8(e,t,r,n){var i=t._private;i.started=!0,i.startTime=r-i.progress*i.duration}function mI(e,t){var r=t._private.aniEles,n=[];function i(g,v){var _=g._private,b=_.animation.current,k=_.animation.queue,A=!1;if(b.length===0){var M=k.shift();M&&b.push(M)}for(var P=function(U){for(var $=U.length-1;$>=0;$--){var G=U[$];G()}U.splice(0,U.length)},I=b.length-1;I>=0;I--){var z=b[I],O=z._private;if(O.stopped){b.splice(I,1),O.hooked=!1,O.playing=!1,O.started=!1,P(O.frames);continue}!O.playing&&!O.applying||(O.playing&&O.applying&&(O.applying=!1),O.started||k8(g,z,e),C8(g,z,e,v),O.applying&&(O.applying=!1),P(O.frames),O.step!=null&&O.step(e),z.completed()&&(b.splice(I,1),O.hooked=!1,O.playing=!1,O.started=!1,P(O.completes)),A=!0)}return!v&&b.length===0&&k.length===0&&n.push(g),A}for(var s=!1,u=0;u<r.length;u++){var a=r[u],d=i(a);s=s||d}var p=i(t,!0);(s||p)&&(r.length>0?t.notify("draw",r):t.notify("draw")),r.unmerge(n),t.emit("step")}var P8={animate:Hr.animate(),animation:Hr.animation(),animated:Hr.animated(),clearQueue:Hr.clearQueue(),delay:Hr.delay(),delayAnimation:Hr.delayAnimation(),stop:Hr.stop(),addToAnimationPool:function(t){var r=this;r.styleEnabled()&&r._private.aniEles.merge(t)},stopAnimationLoop:function(){this._private.animationsRunning=!1},startAnimationLoop:function(){var t=this;if(t._private.animationsRunning=!0,!t.styleEnabled())return;function r(){t._private.animationsRunning&&qy(function(s){mI(s,t),r()})}var n=t.renderer();n&&n.beforeRender?n.beforeRender(function(s,u){mI(u,t)},n.beforeRenderPriorities.animations):r()}},I8={qualifierCompare:function(t,r){return t==null||r==null?t==null&&r==null:t.sameText(r)},eventMatches:function(t,r,n){var i=r.qualifier;return i!=null?t!==n.target&&Bm(n.target)&&i.matches(n.target):!0},addEventFields:function(t,r){r.cy=t,r.target=t},callbackContext:function(t,r,n){return r.qualifier!=null?n.target:t}},kv=function(t){return sr(t)?new au(t):t},Mz={createEmitter:function(){var t=this._private;return t.emitter||(t.emitter=new H0(I8,this)),this},emitter:function(){return this._private.emitter},on:function(t,r,n){return this.emitter().on(t,kv(r),n),this},removeListener:function(t,r,n){return this.emitter().removeListener(t,kv(r),n),this},removeAllListeners:function(){return this.emitter().removeAllListeners(),this},one:function(t,r,n){return this.emitter().one(t,kv(r),n),this},once:function(t,r,n){return this.emitter().one(t,kv(r),n),this},emit:function(t,r){return this.emitter().emit(t,r),this},emitAndNotify:function(t,r){return this.emit(t),this.notify(t,r),this}};Hr.eventAliasesOn(Mz);var Z1={png:function(t){var r=this._private.renderer;return t=t||{},r.png(t)},jpg:function(t){var r=this._private.renderer;return t=t||{},t.bg=t.bg||"#fff",r.jpg(t)}};Z1.jpeg=Z1.jpg;var uy={layout:function(t){var r=this;if(t==null){_n("Layout options must be specified to make a layout");return}if(t.name==null){_n("A `name` must be specified to make a layout");return}var n=t.name,i=r.extension("layout",n);if(i==null){_n("No such layout `"+n+"` found.  Did you forget to import it and `cytoscape.use()` it?");return}var s;sr(t.eles)?s=r.$(t.eles):s=t.eles!=null?t.eles:r.$();var u=new i(dr({},t,{cy:r,eles:s}));return u}};uy.createLayout=uy.makeLayout=uy.layout;var A8={notify:function(t,r){var n=this._private;if(this.batching()){n.batchNotifications=n.batchNotifications||{};var i=n.batchNotifications[t]=n.batchNotifications[t]||this.collection();r!=null&&i.merge(r);return}if(n.notificationsEnabled){var s=this.renderer();this.destroyed()||!s||s.notify(t,r)}},notifications:function(t){var r=this._private;return t===void 0?r.notificationsEnabled:(r.notificationsEnabled=!!t,this)},noNotifications:function(t){this.notifications(!1),t(),this.notifications(!0)},batching:function(){return this._private.batchCount>0},startBatch:function(){var t=this._private;return t.batchCount==null&&(t.batchCount=0),t.batchCount===0&&(t.batchStyleEles=this.collection(),t.batchNotifications={}),t.batchCount++,this},endBatch:function(){var t=this._private;if(t.batchCount===0)return this;if(t.batchCount--,t.batchCount===0){t.batchStyleEles.updateStyle();var r=this.renderer();Object.keys(t.batchNotifications).forEach(function(n){var i=t.batchNotifications[n];i.empty()?r.notify(n):r.notify(n,i)})}return this},batch:function(t){return this.startBatch(),t(),this.endBatch(),this},batchData:function(t){var r=this;return this.batch(function(){for(var n=Object.keys(t),i=0;i<n.length;i++){var s=n[i],u=t[s],a=r.getElementById(s);a.data(u)}})}},M8=Ti({hideEdgesOnViewport:!1,textureOnViewport:!1,motionBlur:!1,motionBlurOpacity:.05,pixelRatio:void 0,desktopTapThreshold:4,touchTapThreshold:8,wheelSensitivity:1,debug:!1,showFps:!1,webgl:!1,webglDebug:!1,webglDebugShowAtlases:!1,webglTexSize:2048,webglTexRows:36,webglTexRowsNodes:18,webglBatchSize:2048,webglTexPerBatch:14,webglBgColor:[255,255,255]}),X1={renderTo:function(t,r,n,i){var s=this._private.renderer;return s.renderTo(t,r,n,i),this},renderer:function(){return this._private.renderer},forceRender:function(){return this.notify("draw"),this},resize:function(){return this.invalidateSize(),this.emitAndNotify("resize"),this},initRenderer:function(t){var r=this,n=r.extension("renderer",t.name);if(n==null){_n("Can not initialise: No such renderer `".concat(t.name,"` found. Did you forget to import it and `cytoscape.use()` it?"));return}t.wheelSensitivity!==void 0&&Gr("You have set a custom wheel sensitivity.  This will make your app zoom unnaturally when using mainstream mice.  You should change this value from the default only if you can guarantee that all your users will use the same hardware and OS configuration as your current machine.");var i=M8(t);i.cy=r,r._private.renderer=new n(i),this.notify("init")},destroyRenderer:function(){var t=this;t.notify("destroy");var r=t.container();if(r)for(r._cyreg=null;r.childNodes.length>0;)r.removeChild(r.childNodes[0]);t._private.renderer=null,t.mutableElements().forEach(function(n){var i=n._private;i.rscratch={},i.rstyle={},i.animation.current=[],i.animation.queue=[]})},onRender:function(t){return this.on("render",t)},offRender:function(t){return this.off("render",t)}};X1.invalidateDimensions=X1.resize;var cy={collection:function(t,r){return sr(t)?this.$(t):La(t)?t.collection():an(t)?(r||(r={}),new Si(this,t,r.unique,r.removed)):new Si(this)},nodes:function(t){var r=this.$(function(n){return n.isNode()});return t?r.filter(t):r},edges:function(t){var r=this.$(function(n){return n.isEdge()});return t?r.filter(t):r},$:function(t){var r=this._private.elements;return t?r.filter(t):r.spawnSelf()},mutableElements:function(){return this._private.elements}};cy.elements=cy.filter=cy.$;var mi={},Bp="t",D8="f";mi.apply=function(e){for(var t=this,r=t._private,n=r.cy,i=n.collection(),s=0;s<e.length;s++){var u=e[s],a=t.getContextMeta(u);if(!a.empty){var d=t.getContextStyle(a),p=t.applyContextStyle(a,d,u);u._private.appliedInitStyle?t.updateTransitions(u,p.diffProps):u._private.appliedInitStyle=!0;var g=t.updateStyleHints(u);g&&i.push(u)}}return i};mi.getPropertiesDiff=function(e,t){var r=this,n=r._private.propDiffs=r._private.propDiffs||{},i=e+"-"+t,s=n[i];if(s)return s;for(var u=[],a={},d=0;d<r.length;d++){var p=r[d],g=e[d]===Bp,v=t[d]===Bp,_=g!==v,b=p.mappedProperties.length>0;if(_||v&&b){var k=void 0;_&&b||_?k=p.properties:b&&(k=p.mappedProperties);for(var A=0;A<k.length;A++){for(var M=k[A],P=M.name,I=!1,z=d+1;z<r.length;z++){var O=r[z],V=t[z]===Bp;if(V&&(I=O.properties[M.name]!=null,I))break}!a[P]&&!I&&(a[P]=!0,u.push(P))}}}return n[i]=u,u};mi.getContextMeta=function(e){for(var t=this,r="",n,i=e._private.styleCxtKey||"",s=0;s<t.length;s++){var u=t[s],a=u.selector&&u.selector.matches(e);a?r+=Bp:r+=D8}return n=t.getPropertiesDiff(i,r),e._private.styleCxtKey=r,{key:r,diffPropNames:n,empty:n.length===0}};mi.getContextStyle=function(e){var t=e.key,r=this,n=this._private.contextStyles=this._private.contextStyles||{};if(n[t])return n[t];for(var i={_private:{key:t}},s=0;s<r.length;s++){var u=r[s],a=t[s]===Bp;if(a)for(var d=0;d<u.properties.length;d++){var p=u.properties[d];i[p.name]=p}}return n[t]=i,i};mi.applyContextStyle=function(e,t,r){for(var n=this,i=e.diffPropNames,s={},u=n.types,a=0;a<i.length;a++){var d=i[a],p=t[d],g=r.pstyle(d);if(!p)if(g)g.bypass?p={name:d,deleteBypassed:!0}:p={name:d,delete:!0};else continue;if(g!==p){if(p.mapped===u.fn&&g!=null&&g.mapping!=null&&g.mapping.value===p.value){var v=g.mapping,_=v.fnValue=p.value(r);if(_===v.prevFnValue)continue}var b=s[d]={prev:g};n.applyParsedProperty(r,p),b.next=r.pstyle(d),b.next&&b.next.bypass&&(b.next=b.next.bypassed)}}return{diffProps:s}};mi.updateStyleHints=function(e){var t=e._private,r=this,n=r.propertyGroupNames,i=r.propertyGroupKeys,s=function(Ze,it,mt){return r.getPropertiesHash(Ze,it,mt)},u=t.styleKey;if(e.removed())return!1;var a=t.group==="nodes",d=e._private.style;n=Object.keys(d);for(var p=0;p<i.length;p++){var g=i[p];t.styleKeys[g]=[Ku,Oh]}for(var v=function(Ze,it){return t.styleKeys[it][0]=sm(Ze,t.styleKeys[it][0])},_=function(Ze,it){return t.styleKeys[it][1]=om(Ze,t.styleKeys[it][1])},b=function(Ze,it){v(Ze,it),_(Ze,it)},k=function(Ze,it){for(var mt=0;mt<Ze.length;mt++){var Tt=Ze.charCodeAt(mt);v(Tt,it),_(Tt,it)}},A=2e9,M=function(Ze){return-128<Ze&&Ze<128&&Math.floor(Ze)!==Ze?A-(Ze*1024|0):Ze},P=0;P<n.length;P++){var I=n[P],z=d[I];if(z!=null){var O=this.properties[I],V=O.type,U=O.groupKey,$=void 0;O.hashOverride!=null?$=O.hashOverride(e,z):z.pfValue!=null&&($=z.pfValue);var G=O.enums==null?z.value:null,Z=$!=null,Q=G!=null,X=Z||Q,ie=z.units;if(V.number&&X&&!V.multiple){var te=Z?$:G;b(M(te),U),!Z&&ie!=null&&k(ie,U)}else k(z.strValue,U)}}for(var W=[Ku,Oh],oe=0;oe<i.length;oe++){var se=i[oe],de=t.styleKeys[se];W[0]=sm(de[0],W[0]),W[1]=om(de[1],W[1])}t.styleKey=Zj(W[0],W[1]);var me=t.styleKeys;t.labelDimsKey=Sl(me.labelDimensions);var ae=s(e,["label"],me.labelDimensions);if(t.labelKey=Sl(ae),t.labelStyleKey=Sl(xv(me.commonLabel,ae)),!a){var ve=s(e,["source-label"],me.labelDimensions);t.sourceLabelKey=Sl(ve),t.sourceLabelStyleKey=Sl(xv(me.commonLabel,ve));var pe=s(e,["target-label"],me.labelDimensions);t.targetLabelKey=Sl(pe),t.targetLabelStyleKey=Sl(xv(me.commonLabel,pe))}if(a){var _e=t.styleKeys,De=_e.nodeBody,Le=_e.nodeBorder,je=_e.nodeOutline,Je=_e.backgroundImage,et=_e.compound,ft=_e.pie,rt=_e.stripe,Oe=[De,Le,je,Je,et,ft,rt].filter(function(Ge){return Ge!=null}).reduce(xv,[Ku,Oh]);t.nodeKey=Sl(Oe),t.hasPie=ft!=null&&ft[0]!==Ku&&ft[1]!==Oh,t.hasStripe=rt!=null&&rt[0]!==Ku&&rt[1]!==Oh}return u!==t.styleKey};mi.clearStyleHints=function(e){var t=e._private;t.styleCxtKey="",t.styleKeys={},t.styleKey=null,t.labelKey=null,t.labelStyleKey=null,t.sourceLabelKey=null,t.sourceLabelStyleKey=null,t.targetLabelKey=null,t.targetLabelStyleKey=null,t.nodeKey=null,t.hasPie=null,t.hasStripe=null};mi.applyParsedProperty=function(e,t){var r=this,n=t,i=e._private.style,s,u=r.types,a=r.properties[n.name].type,d=n.bypass,p=i[n.name],g=p&&p.bypass,v=e._private,_="mapping",b=function(De){return De==null?null:De.pfValue!=null?De.pfValue:De.value},k=function(){var De=b(p),Le=b(n);r.checkTriggers(e,n.name,De,Le)};if(t.name==="curve-style"&&e.isEdge()&&(t.value!=="bezier"&&e.isLoop()||t.value==="haystack"&&(e.source().isParent()||e.target().isParent()))&&(n=t=this.parse(t.name,"bezier",d)),n.delete)return i[n.name]=void 0,k(),!0;if(n.deleteBypassed)return p?p.bypass?(p.bypassed=void 0,k(),!0):!1:(k(),!0);if(n.deleteBypass)return p?p.bypass?(i[n.name]=p.bypassed,k(),!0):!1:(k(),!0);var A=function(){Gr("Do not assign mappings to elements without corresponding data (i.e. ele `"+e.id()+"` has no mapping for property `"+n.name+"` with data field `"+n.field+"`); try a `["+n.field+"]` selector to limit scope to elements with `"+n.field+"` defined")};switch(n.mapped){case u.mapData:{for(var M=n.field.split("."),P=v.data,I=0;I<M.length&&P;I++){var z=M[I];P=P[z]}if(P==null)return A(),!1;var O;if(Rt(P)){var V=n.fieldMax-n.fieldMin;V===0?O=0:O=(P-n.fieldMin)/V}else return Gr("Do not use continuous mappers without specifying numeric data (i.e. `"+n.field+": "+P+"` for `"+e.id()+"` is non-numeric)"),!1;if(O<0?O=0:O>1&&(O=1),a.color){var U=n.valueMin[0],$=n.valueMax[0],G=n.valueMin[1],Z=n.valueMax[1],Q=n.valueMin[2],X=n.valueMax[2],ie=n.valueMin[3]==null?1:n.valueMin[3],te=n.valueMax[3]==null?1:n.valueMax[3],W=[Math.round(U+($-U)*O),Math.round(G+(Z-G)*O),Math.round(Q+(X-Q)*O),Math.round(ie+(te-ie)*O)];s={bypass:n.bypass,name:n.name,value:W,strValue:"rgb("+W[0]+", "+W[1]+", "+W[2]+")"}}else if(a.number){var oe=n.valueMin+(n.valueMax-n.valueMin)*O;s=this.parse(n.name,oe,n.bypass,_)}else return!1;if(!s)return A(),!1;s.mapping=n,n=s;break}case u.data:{for(var se=n.field.split("."),de=v.data,me=0;me<se.length&&de;me++){var ae=se[me];de=de[ae]}if(de!=null&&(s=this.parse(n.name,de,n.bypass,_)),!s)return A(),!1;s.mapping=n,n=s;break}case u.fn:{var ve=n.value,pe=n.fnValue!=null?n.fnValue:ve(e);if(n.prevFnValue=pe,pe==null)return Gr("Custom function mappers may not return null (i.e. `"+n.name+"` for ele `"+e.id()+"` is null)"),!1;if(s=this.parse(n.name,pe,n.bypass,_),!s)return Gr("Custom function mappers may not return invalid values for the property type (i.e. `"+n.name+"` for ele `"+e.id()+"` is invalid)"),!1;s.mapping=Gs(n),n=s;break}case void 0:break;default:return!1}return d?(g?n.bypassed=p.bypassed:n.bypassed=p,i[n.name]=n):g?p.bypassed=n:i[n.name]=n,k(),!0};mi.cleanElements=function(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(this.clearStyleHints(n),n.dirtyCompoundBoundsCache(),n.dirtyBoundingBoxCache(),!t)n._private.style={};else for(var i=n._private.style,s=Object.keys(i),u=0;u<s.length;u++){var a=s[u],d=i[a];d!=null&&(d.bypass?d.bypassed=null:i[a]=null)}}};mi.update=function(){var e=this._private.cy,t=e.mutableElements();t.updateStyle()};mi.updateTransitions=function(e,t){var r=this,n=e._private,i=e.pstyle("transition-property").value,s=e.pstyle("transition-duration").pfValue,u=e.pstyle("transition-delay").pfValue;if(i.length>0&&s>0){for(var a={},d=!1,p=0;p<i.length;p++){var g=i[p],v=e.pstyle(g),_=t[g];if(_){var b=_.prev,k=b,A=_.next!=null?_.next:v,M=!1,P=void 0,I=1e-6;k&&(Rt(k.pfValue)&&Rt(A.pfValue)?(M=A.pfValue-k.pfValue,P=k.pfValue+I*M):Rt(k.value)&&Rt(A.value)?(M=A.value-k.value,P=k.value+I*M):an(k.value)&&an(A.value)&&(M=k.value[0]!==A.value[0]||k.value[1]!==A.value[1]||k.value[2]!==A.value[2],P=k.strValue),M&&(a[g]=A.strValue,this.applyBypass(e,g,P),d=!0))}}if(!d)return;n.transitioning=!0,new Bd(function(z){u>0?e.delayAnimation(u).play().promise().then(z):z()}).then(function(){return e.animation({style:a,duration:s,easing:e.pstyle("transition-timing-function").value,queue:!1}).play().promise()}).then(function(){r.removeBypasses(e,i),e.emitAndNotify("style"),n.transitioning=!1})}else n.transitioning&&(this.removeBypasses(e,i),e.emitAndNotify("style"),n.transitioning=!1)};mi.checkTrigger=function(e,t,r,n,i,s){var u=this.properties[t],a=i(u);e.removed()||a!=null&&a(r,n,e)&&s(u)};mi.checkZOrderTrigger=function(e,t,r,n){var i=this;this.checkTrigger(e,t,r,n,function(s){return s.triggersZOrder},function(){i._private.cy.notify("zorder",e)})};mi.checkBoundsTrigger=function(e,t,r,n){this.checkTrigger(e,t,r,n,function(i){return i.triggersBounds},function(i){e.dirtyCompoundBoundsCache(),e.dirtyBoundingBoxCache()})};mi.checkConnectedEdgesBoundsTrigger=function(e,t,r,n){this.checkTrigger(e,t,r,n,function(i){return i.triggersBoundsOfConnectedEdges},function(i){e.connectedEdges().forEach(function(s){s.dirtyBoundingBoxCache()})})};mi.checkParallelEdgesBoundsTrigger=function(e,t,r,n){this.checkTrigger(e,t,r,n,function(i){return i.triggersBoundsOfParallelEdges},function(i){e.parallelEdges().forEach(function(s){s.dirtyBoundingBoxCache()})})};mi.checkTriggers=function(e,t,r,n){e.dirtyStyleCache(),this.checkZOrderTrigger(e,t,r,n),this.checkBoundsTrigger(e,t,r,n),this.checkConnectedEdgesBoundsTrigger(e,t,r,n),this.checkParallelEdgesBoundsTrigger(e,t,r,n)};var qm={};qm.applyBypass=function(e,t,r,n){var i=this,s=[],u=!0;if(t==="*"||t==="**"){if(r!==void 0)for(var a=0;a<i.properties.length;a++){var d=i.properties[a],p=d.name,g=this.parse(p,r,!0);g&&s.push(g)}}else if(sr(t)){var v=this.parse(t,r,!0);v&&s.push(v)}else if(Fr(t)){var _=t;n=r;for(var b=Object.keys(_),k=0;k<b.length;k++){var A=b[k],M=_[A];if(M===void 0&&(M=_[R0(A)]),M!==void 0){var P=this.parse(A,M,!0);P&&s.push(P)}}}else return!1;if(s.length===0)return!1;for(var I=!1,z=0;z<e.length;z++){for(var O=e[z],V={},U=void 0,$=0;$<s.length;$++){var G=s[$];if(n){var Z=O.pstyle(G.name);U=V[G.name]={prev:Z}}I=this.applyParsedProperty(O,Gs(G))||I,n&&(U.next=O.pstyle(G.name))}I&&this.updateStyleHints(O),n&&this.updateTransitions(O,V,u)}return I};qm.overrideBypass=function(e,t,r){t=_S(t);for(var n=0;n<e.length;n++){var i=e[n],s=i._private.style[t],u=this.properties[t].type,a=u.color,d=u.mutiple,p=s?s.pfValue!=null?s.pfValue:s.value:null;!s||!s.bypass?this.applyBypass(i,t,r):(s.value=r,s.pfValue!=null&&(s.pfValue=r),a?s.strValue="rgb("+r.join(",")+")":d?s.strValue=r.join(" "):s.strValue=""+r,this.updateStyleHints(i)),this.checkTriggers(i,t,p,r)}};qm.removeAllBypasses=function(e,t){return this.removeBypasses(e,this.propertyNames,t)};qm.removeBypasses=function(e,t,r){for(var n=!0,i=0;i<e.length;i++){for(var s=e[i],u={},a=0;a<t.length;a++){var d=t[a],p=this.properties[d],g=s.pstyle(p.name);if(!(!g||!g.bypass)){var v="",_=this.parse(d,v,!0),b=u[p.name]={prev:g};this.applyParsedProperty(s,_),b.next=s.pstyle(p.name)}}this.updateStyleHints(s),r&&this.updateTransitions(s,u,n)}};var RS={};RS.getEmSizeInPixels=function(){var e=this.containerCss("font-size");return e!=null?parseFloat(e):1};RS.containerCss=function(e){var t=this._private.cy,r=t.container(),n=t.window();if(n&&r&&n.getComputedStyle)return n.getComputedStyle(r).getPropertyValue(e)};var Ks={};Ks.getRenderedStyle=function(e,t){return t?this.getStylePropertyValue(e,t,!0):this.getRawStyle(e,!0)};Ks.getRawStyle=function(e,t){var r=this;if(e=e[0],e){for(var n={},i=0;i<r.properties.length;i++){var s=r.properties[i],u=r.getStylePropertyValue(e,s.name,t);u!=null&&(n[s.name]=u,n[R0(s.name)]=u)}return n}};Ks.getIndexedStyle=function(e,t,r,n){var i=e.pstyle(t)[r][n];return i??e.cy().style().getDefaultProperty(t)[r][0]};Ks.getStylePropertyValue=function(e,t,r){var n=this;if(e=e[0],e){var i=n.properties[t];i.alias&&(i=i.pointsTo);var s=i.type,u=e.pstyle(i.name);if(u){var a=u.value,d=u.units,p=u.strValue;if(r&&s.number&&a!=null&&Rt(a)){var g=e.cy().zoom(),v=function(M){return M*g},_=function(M,P){return v(M)+P},b=an(a),k=b?d.every(function(A){return A!=null}):d!=null;return k?b?a.map(function(A,M){return _(A,d[M])}).join(" "):_(a,d):b?a.map(function(A){return sr(A)?A:""+v(A)}).join(" "):""+v(a)}else if(p!=null)return p}return null}};Ks.getAnimationStartStyle=function(e,t){for(var r={},n=0;n<t.length;n++){var i=t[n],s=i.name,u=e.pstyle(s);u!==void 0&&(Fr(u)?u=this.parse(s,u.strValue):u=this.parse(s,u)),u&&(r[s]=u)}return r};Ks.getPropsList=function(e){var t=this,r=[],n=e,i=t.properties;if(n)for(var s=Object.keys(n),u=0;u<s.length;u++){var a=s[u],d=n[a],p=i[a]||i[_S(a)],g=this.parse(p.name,d);g&&r.push(g)}return r};Ks.getNonDefaultPropertiesHash=function(e,t,r){var n=r.slice(),i,s,u,a,d,p;for(d=0;d<t.length;d++)if(i=t[d],s=e.pstyle(i,!1),s!=null)if(s.pfValue!=null)n[0]=sm(a,n[0]),n[1]=om(a,n[1]);else for(u=s.strValue,p=0;p<u.length;p++)a=u.charCodeAt(p),n[0]=sm(a,n[0]),n[1]=om(a,n[1]);return n};Ks.getPropertiesHash=Ks.getNonDefaultPropertiesHash;var Z0={};Z0.appendFromJson=function(e){for(var t=this,r=0;r<e.length;r++){var n=e[r],i=n.selector,s=n.style||n.css,u=Object.keys(s);t.selector(i);for(var a=0;a<u.length;a++){var d=u[a],p=s[d];t.css(d,p)}}return t};Z0.fromJson=function(e){var t=this;return t.resetToDefault(),t.appendFromJson(e),t};Z0.json=function(){for(var e=[],t=this.defaultLength;t<this.length;t++){for(var r=this[t],n=r.selector,i=r.properties,s={},u=0;u<i.length;u++){var a=i[u];s[a.name]=a.strValue}e.push({selector:n?n.toString():"core",style:s})}return e};var LS={};LS.appendFromString=function(e){var t=this,r=this,n=""+e,i,s,u;n=n.replace(/[/][*](\s|.)+?[*][/]/g,"");function a(){n.length>i.length?n=n.substr(i.length):n=""}function d(){s.length>u.length?s=s.substr(u.length):s=""}for(;;){var p=n.match(/^\s*$/);if(p)break;var g=n.match(/^\s*((?:.|\s)+?)\s*\{((?:.|\s)+?)\}/);if(!g){Gr("Halting stylesheet parsing: String stylesheet contains more to parse but no selector and block found in: "+n);break}i=g[0];var v=g[1];if(v!=="core"){var _=new au(v);if(_.invalid){Gr("Skipping parsing of block: Invalid selector found in string stylesheet: "+v),a();continue}}var b=g[2],k=!1;s=b;for(var A=[];;){var M=s.match(/^\s*$/);if(M)break;var P=s.match(/^\s*(.+?)\s*:\s*(.+?)(?:\s*;|\s*$)/);if(!P){Gr("Skipping parsing of block: Invalid formatting of style property and value definitions found in:"+b),k=!0;break}u=P[0];var I=P[1],z=P[2],O=t.properties[I];if(!O){Gr("Skipping property: Invalid property name in: "+u),d();continue}var V=r.parse(I,z);if(!V){Gr("Skipping property: Invalid property definition in: "+u),d();continue}A.push({name:I,val:z}),d()}if(k){a();break}r.selector(v);for(var U=0;U<A.length;U++){var $=A[U];r.css($.name,$.val)}a()}return r};LS.fromString=function(e){var t=this;return t.resetToDefault(),t.appendFromString(e),t};var $n={};(function(){var e=Yn,t=Cj,r=Pj,n=Ij,i=Aj,s=function(Ge){return"^"+Ge+"\\s*\\(\\s*([\\w\\.]+)\\s*\\)$"},u=function(Ge){var Ze=e+"|\\w+|"+t+"|"+r+"|"+n+"|"+i;return"^"+Ge+"\\s*\\(([\\w\\.]+)\\s*\\,\\s*("+e+")\\s*\\,\\s*("+e+")\\s*,\\s*("+Ze+")\\s*\\,\\s*("+Ze+")\\)$"},a=[`^url\\s*\\(\\s*['"]?(.+?)['"]?\\s*\\)$`,"^(none)$","^(.+)$"];$n.types={time:{number:!0,min:0,units:"s|ms",implicitUnits:"ms"},percent:{number:!0,min:0,max:100,units:"%",implicitUnits:"%"},percentages:{number:!0,min:0,max:100,units:"%",implicitUnits:"%",multiple:!0},zeroOneNumber:{number:!0,min:0,max:1,unitless:!0},zeroOneNumbers:{number:!0,min:0,max:1,unitless:!0,multiple:!0},nOneOneNumber:{number:!0,min:-1,max:1,unitless:!0},nonNegativeInt:{number:!0,min:0,integer:!0,unitless:!0},nonNegativeNumber:{number:!0,min:0,unitless:!0},position:{enums:["parent","origin"]},nodeSize:{number:!0,min:0,enums:["label"]},number:{number:!0,unitless:!0},numbers:{number:!0,unitless:!0,multiple:!0},positiveNumber:{number:!0,unitless:!0,min:0,strictMin:!0},size:{number:!0,min:0},bidirectionalSize:{number:!0},bidirectionalSizeMaybePercent:{number:!0,allowPercent:!0},bidirectionalSizes:{number:!0,multiple:!0},sizeMaybePercent:{number:!0,min:0,allowPercent:!0},axisDirection:{enums:["horizontal","leftward","rightward","vertical","upward","downward","auto"]},axisDirectionExplicit:{enums:["leftward","rightward","upward","downward"]},axisDirectionPrimary:{enums:["horizontal","vertical"]},paddingRelativeTo:{enums:["width","height","average","min","max"]},bgWH:{number:!0,min:0,allowPercent:!0,enums:["auto"],multiple:!0},bgPos:{number:!0,allowPercent:!0,multiple:!0},bgRelativeTo:{enums:["inner","include-padding"],multiple:!0},bgRepeat:{enums:["repeat","repeat-x","repeat-y","no-repeat"],multiple:!0},bgFit:{enums:["none","contain","cover"],multiple:!0},bgCrossOrigin:{enums:["anonymous","use-credentials","null"],multiple:!0},bgClip:{enums:["none","node"],multiple:!0},bgContainment:{enums:["inside","over"],multiple:!0},boxSelection:{enums:["contain","overlap","none"]},color:{color:!0},colors:{color:!0,multiple:!0},fill:{enums:["solid","linear-gradient","radial-gradient"]},bool:{enums:["yes","no"]},bools:{enums:["yes","no"],multiple:!0},lineStyle:{enums:["solid","dotted","dashed"]},lineCap:{enums:["butt","round","square"]},linePosition:{enums:["center","inside","outside"]},lineJoin:{enums:["round","bevel","miter"]},borderStyle:{enums:["solid","dotted","dashed","double"]},curveStyle:{enums:["bezier","unbundled-bezier","haystack","segments","straight","straight-triangle","taxi","round-segments","round-taxi"]},radiusType:{enums:["arc-radius","influence-radius"],multiple:!0},fontFamily:{regex:'^([\\w- \\"]+(?:\\s*,\\s*[\\w- \\"]+)*)$'},fontStyle:{enums:["italic","normal","oblique"]},fontWeight:{enums:["normal","bold","bolder","lighter","100","200","300","400","500","600","800","900",100,200,300,400,500,600,700,800,900]},textDecoration:{enums:["none","underline","overline","line-through"]},textTransform:{enums:["none","uppercase","lowercase"]},textWrap:{enums:["none","wrap","ellipsis"]},textOverflowWrap:{enums:["whitespace","anywhere"]},textBackgroundShape:{enums:["rectangle","roundrectangle","round-rectangle","circle"]},nodeShape:{enums:["rectangle","roundrectangle","round-rectangle","cutrectangle","cut-rectangle","bottomroundrectangle","bottom-round-rectangle","barrel","ellipse","triangle","round-triangle","square","pentagon","round-pentagon","hexagon","round-hexagon","concavehexagon","concave-hexagon","heptagon","round-heptagon","octagon","round-octagon","tag","round-tag","star","diamond","round-diamond","vee","rhomboid","right-rhomboid","polygon"]},overlayShape:{enums:["roundrectangle","round-rectangle","ellipse"]},cornerRadius:{number:!0,min:0,units:"px|em",implicitUnits:"px",enums:["auto"]},compoundIncludeLabels:{enums:["include","exclude"]},arrowShape:{enums:["tee","triangle","triangle-tee","circle-triangle","triangle-cross","triangle-backcurve","vee","square","circle","diamond","chevron","none"]},arrowFill:{enums:["filled","hollow"]},arrowWidth:{number:!0,units:"%|px|em",implicitUnits:"px",enums:["match-line"]},display:{enums:["element","none"]},visibility:{enums:["hidden","visible"]},zCompoundDepth:{enums:["bottom","orphan","auto","top"]},zIndexCompare:{enums:["auto","manual"]},valign:{enums:["top","center","bottom"]},halign:{enums:["left","center","right"]},justification:{enums:["left","center","right","auto"]},text:{string:!0},data:{mapping:!0,regex:s("data")},layoutData:{mapping:!0,regex:s("layoutData")},scratch:{mapping:!0,regex:s("scratch")},mapData:{mapping:!0,regex:u("mapData")},mapLayoutData:{mapping:!0,regex:u("mapLayoutData")},mapScratch:{mapping:!0,regex:u("mapScratch")},fn:{mapping:!0,fn:!0},url:{regexes:a,singleRegexMatchValue:!0},urls:{regexes:a,singleRegexMatchValue:!0,multiple:!0},propList:{propList:!0},angle:{number:!0,units:"deg|rad",implicitUnits:"rad"},textRotation:{number:!0,units:"deg|rad",implicitUnits:"rad",enums:["none","autorotate"]},polygonPointList:{number:!0,multiple:!0,evenMultiple:!0,min:-1,max:1,unitless:!0},edgeDistances:{enums:["intersection","node-position","endpoints"]},edgeEndpoint:{number:!0,multiple:!0,units:"%|px|em|deg|rad",implicitUnits:"px",enums:["inside-to-node","outside-to-node","outside-to-node-or-label","outside-to-line","outside-to-line-or-label"],singleEnum:!0,validate:function(Ge,Ze){switch(Ge.length){case 2:return Ze[0]!=="deg"&&Ze[0]!=="rad"&&Ze[1]!=="deg"&&Ze[1]!=="rad";case 1:return sr(Ge[0])||Ze[0]==="deg"||Ze[0]==="rad";default:return!1}}},easing:{regexes:["^(spring)\\s*\\(\\s*("+e+")\\s*,\\s*("+e+")\\s*\\)$","^(cubic-bezier)\\s*\\(\\s*("+e+")\\s*,\\s*("+e+")\\s*,\\s*("+e+")\\s*,\\s*("+e+")\\s*\\)$"],enums:["linear","ease","ease-in","ease-out","ease-in-out","ease-in-sine","ease-out-sine","ease-in-out-sine","ease-in-quad","ease-out-quad","ease-in-out-quad","ease-in-cubic","ease-out-cubic","ease-in-out-cubic","ease-in-quart","ease-out-quart","ease-in-out-quart","ease-in-quint","ease-out-quint","ease-in-out-quint","ease-in-expo","ease-out-expo","ease-in-out-expo","ease-in-circ","ease-out-circ","ease-in-out-circ"]},gradientDirection:{enums:["to-bottom","to-top","to-left","to-right","to-bottom-right","to-bottom-left","to-top-right","to-top-left","to-right-bottom","to-left-bottom","to-right-top","to-left-top"]},boundsExpansion:{number:!0,multiple:!0,min:0,validate:function(Ge){var Ze=Ge.length;return Ze===1||Ze===2||Ze===4}}};var d={zeroNonZero:function(Ge,Ze){return(Ge==null||Ze==null)&&Ge!==Ze||Ge==0&&Ze!=0?!0:Ge!=0&&Ze==0},any:function(Ge,Ze){return Ge!=Ze},emptyNonEmpty:function(Ge,Ze){var it=ru(Ge),mt=ru(Ze);return it&&!mt||!it&&mt}},p=$n.types,g=[{name:"label",type:p.text,triggersBounds:d.any,triggersZOrder:d.emptyNonEmpty},{name:"text-rotation",type:p.textRotation,triggersBounds:d.any},{name:"text-margin-x",type:p.bidirectionalSize,triggersBounds:d.any},{name:"text-margin-y",type:p.bidirectionalSize,triggersBounds:d.any}],v=[{name:"source-label",type:p.text,triggersBounds:d.any},{name:"source-text-rotation",type:p.textRotation,triggersBounds:d.any},{name:"source-text-margin-x",type:p.bidirectionalSize,triggersBounds:d.any},{name:"source-text-margin-y",type:p.bidirectionalSize,triggersBounds:d.any},{name:"source-text-offset",type:p.size,triggersBounds:d.any}],_=[{name:"target-label",type:p.text,triggersBounds:d.any},{name:"target-text-rotation",type:p.textRotation,triggersBounds:d.any},{name:"target-text-margin-x",type:p.bidirectionalSize,triggersBounds:d.any},{name:"target-text-margin-y",type:p.bidirectionalSize,triggersBounds:d.any},{name:"target-text-offset",type:p.size,triggersBounds:d.any}],b=[{name:"font-family",type:p.fontFamily,triggersBounds:d.any},{name:"font-style",type:p.fontStyle,triggersBounds:d.any},{name:"font-weight",type:p.fontWeight,triggersBounds:d.any},{name:"font-size",type:p.size,triggersBounds:d.any},{name:"text-transform",type:p.textTransform,triggersBounds:d.any},{name:"text-wrap",type:p.textWrap,triggersBounds:d.any},{name:"text-overflow-wrap",type:p.textOverflowWrap,triggersBounds:d.any},{name:"text-max-width",type:p.size,triggersBounds:d.any},{name:"text-outline-width",type:p.size,triggersBounds:d.any},{name:"line-height",type:p.positiveNumber,triggersBounds:d.any}],k=[{name:"text-valign",type:p.valign,triggersBounds:d.any},{name:"text-halign",type:p.halign,triggersBounds:d.any},{name:"color",type:p.color},{name:"text-outline-color",type:p.color},{name:"text-outline-opacity",type:p.zeroOneNumber},{name:"text-background-color",type:p.color},{name:"text-background-opacity",type:p.zeroOneNumber},{name:"text-background-padding",type:p.size,triggersBounds:d.any},{name:"text-border-opacity",type:p.zeroOneNumber},{name:"text-border-color",type:p.color},{name:"text-border-width",type:p.size,triggersBounds:d.any},{name:"text-border-style",type:p.borderStyle,triggersBounds:d.any},{name:"text-background-shape",type:p.textBackgroundShape,triggersBounds:d.any},{name:"text-justification",type:p.justification},{name:"box-select-labels",type:p.bool,triggersBounds:d.any}],A=[{name:"events",type:p.bool,triggersZOrder:d.any},{name:"text-events",type:p.bool,triggersZOrder:d.any},{name:"box-selection",type:p.boxSelection,triggersZOrder:d.any}],M=[{name:"display",type:p.display,triggersZOrder:d.any,triggersBounds:d.any,triggersBoundsOfConnectedEdges:d.any,triggersBoundsOfParallelEdges:function(Ge,Ze,it){return Ge===Ze?!1:it.pstyle("curve-style").value==="bezier"}},{name:"visibility",type:p.visibility,triggersZOrder:d.any},{name:"opacity",type:p.zeroOneNumber,triggersZOrder:d.zeroNonZero},{name:"text-opacity",type:p.zeroOneNumber},{name:"min-zoomed-font-size",type:p.size},{name:"z-compound-depth",type:p.zCompoundDepth,triggersZOrder:d.any},{name:"z-index-compare",type:p.zIndexCompare,triggersZOrder:d.any},{name:"z-index",type:p.number,triggersZOrder:d.any}],P=[{name:"overlay-padding",type:p.size,triggersBounds:d.any},{name:"overlay-color",type:p.color},{name:"overlay-opacity",type:p.zeroOneNumber,triggersBounds:d.zeroNonZero},{name:"overlay-shape",type:p.overlayShape,triggersBounds:d.any},{name:"overlay-corner-radius",type:p.cornerRadius}],I=[{name:"underlay-padding",type:p.size,triggersBounds:d.any},{name:"underlay-color",type:p.color},{name:"underlay-opacity",type:p.zeroOneNumber,triggersBounds:d.zeroNonZero},{name:"underlay-shape",type:p.overlayShape,triggersBounds:d.any},{name:"underlay-corner-radius",type:p.cornerRadius}],z=[{name:"transition-property",type:p.propList},{name:"transition-duration",type:p.time},{name:"transition-delay",type:p.time},{name:"transition-timing-function",type:p.easing}],O=function(Ge,Ze){return Ze.value==="label"?-Ge.poolIndex():Ze.pfValue},V=[{name:"height",type:p.nodeSize,triggersBounds:d.any,hashOverride:O},{name:"width",type:p.nodeSize,triggersBounds:d.any,hashOverride:O},{name:"shape",type:p.nodeShape,triggersBounds:d.any},{name:"shape-polygon-points",type:p.polygonPointList,triggersBounds:d.any},{name:"corner-radius",type:p.cornerRadius},{name:"background-color",type:p.color},{name:"background-fill",type:p.fill},{name:"background-opacity",type:p.zeroOneNumber},{name:"background-blacken",type:p.nOneOneNumber},{name:"background-gradient-stop-colors",type:p.colors},{name:"background-gradient-stop-positions",type:p.percentages},{name:"background-gradient-direction",type:p.gradientDirection},{name:"padding",type:p.sizeMaybePercent,triggersBounds:d.any},{name:"padding-relative-to",type:p.paddingRelativeTo,triggersBounds:d.any},{name:"bounds-expansion",type:p.boundsExpansion,triggersBounds:d.any}],U=[{name:"border-color",type:p.color},{name:"border-opacity",type:p.zeroOneNumber},{name:"border-width",type:p.size,triggersBounds:d.any},{name:"border-style",type:p.borderStyle},{name:"border-cap",type:p.lineCap},{name:"border-join",type:p.lineJoin},{name:"border-dash-pattern",type:p.numbers},{name:"border-dash-offset",type:p.number},{name:"border-position",type:p.linePosition}],$=[{name:"outline-color",type:p.color},{name:"outline-opacity",type:p.zeroOneNumber},{name:"outline-width",type:p.size,triggersBounds:d.any},{name:"outline-style",type:p.borderStyle},{name:"outline-offset",type:p.size,triggersBounds:d.any}],G=[{name:"background-image",type:p.urls},{name:"background-image-crossorigin",type:p.bgCrossOrigin},{name:"background-image-opacity",type:p.zeroOneNumbers},{name:"background-image-containment",type:p.bgContainment},{name:"background-image-smoothing",type:p.bools},{name:"background-position-x",type:p.bgPos},{name:"background-position-y",type:p.bgPos},{name:"background-width-relative-to",type:p.bgRelativeTo},{name:"background-height-relative-to",type:p.bgRelativeTo},{name:"background-repeat",type:p.bgRepeat},{name:"background-fit",type:p.bgFit},{name:"background-clip",type:p.bgClip},{name:"background-width",type:p.bgWH},{name:"background-height",type:p.bgWH},{name:"background-offset-x",type:p.bgPos},{name:"background-offset-y",type:p.bgPos}],Z=[{name:"position",type:p.position,triggersBounds:d.any},{name:"compound-sizing-wrt-labels",type:p.compoundIncludeLabels,triggersBounds:d.any},{name:"min-width",type:p.size,triggersBounds:d.any},{name:"min-width-bias-left",type:p.sizeMaybePercent,triggersBounds:d.any},{name:"min-width-bias-right",type:p.sizeMaybePercent,triggersBounds:d.any},{name:"min-height",type:p.size,triggersBounds:d.any},{name:"min-height-bias-top",type:p.sizeMaybePercent,triggersBounds:d.any},{name:"min-height-bias-bottom",type:p.sizeMaybePercent,triggersBounds:d.any}],Q=[{name:"line-style",type:p.lineStyle},{name:"line-color",type:p.color},{name:"line-fill",type:p.fill},{name:"line-cap",type:p.lineCap},{name:"line-opacity",type:p.zeroOneNumber},{name:"line-dash-pattern",type:p.numbers},{name:"line-dash-offset",type:p.number},{name:"line-outline-width",type:p.size},{name:"line-outline-color",type:p.color},{name:"line-gradient-stop-colors",type:p.colors},{name:"line-gradient-stop-positions",type:p.percentages},{name:"curve-style",type:p.curveStyle,triggersBounds:d.any,triggersBoundsOfParallelEdges:function(Ge,Ze){return Ge===Ze?!1:Ge==="bezier"||Ze==="bezier"}},{name:"haystack-radius",type:p.zeroOneNumber,triggersBounds:d.any},{name:"source-endpoint",type:p.edgeEndpoint,triggersBounds:d.any},{name:"target-endpoint",type:p.edgeEndpoint,triggersBounds:d.any},{name:"control-point-step-size",type:p.size,triggersBounds:d.any},{name:"control-point-distances",type:p.bidirectionalSizes,triggersBounds:d.any},{name:"control-point-weights",type:p.numbers,triggersBounds:d.any},{name:"segment-distances",type:p.bidirectionalSizes,triggersBounds:d.any},{name:"segment-weights",type:p.numbers,triggersBounds:d.any},{name:"segment-radii",type:p.numbers,triggersBounds:d.any},{name:"radius-type",type:p.radiusType,triggersBounds:d.any},{name:"taxi-turn",type:p.bidirectionalSizeMaybePercent,triggersBounds:d.any},{name:"taxi-turn-min-distance",type:p.size,triggersBounds:d.any},{name:"taxi-direction",type:p.axisDirection,triggersBounds:d.any},{name:"taxi-radius",type:p.number,triggersBounds:d.any},{name:"edge-distances",type:p.edgeDistances,triggersBounds:d.any},{name:"arrow-scale",type:p.positiveNumber,triggersBounds:d.any},{name:"loop-direction",type:p.angle,triggersBounds:d.any},{name:"loop-sweep",type:p.angle,triggersBounds:d.any},{name:"source-distance-from-node",type:p.size,triggersBounds:d.any},{name:"target-distance-from-node",type:p.size,triggersBounds:d.any}],X=[{name:"ghost",type:p.bool,triggersBounds:d.any},{name:"ghost-offset-x",type:p.bidirectionalSize,triggersBounds:d.any},{name:"ghost-offset-y",type:p.bidirectionalSize,triggersBounds:d.any},{name:"ghost-opacity",type:p.zeroOneNumber}],ie=[{name:"selection-box-color",type:p.color},{name:"selection-box-opacity",type:p.zeroOneNumber},{name:"selection-box-border-color",type:p.color},{name:"selection-box-border-width",type:p.size},{name:"active-bg-color",type:p.color},{name:"active-bg-opacity",type:p.zeroOneNumber},{name:"active-bg-size",type:p.size},{name:"outside-texture-bg-color",type:p.color},{name:"outside-texture-bg-opacity",type:p.zeroOneNumber}],te=[];$n.pieBackgroundN=16,te.push({name:"pie-size",type:p.sizeMaybePercent}),te.push({name:"pie-hole",type:p.sizeMaybePercent}),te.push({name:"pie-start-angle",type:p.angle});for(var W=1;W<=$n.pieBackgroundN;W++)te.push({name:"pie-"+W+"-background-color",type:p.color}),te.push({name:"pie-"+W+"-background-size",type:p.percent}),te.push({name:"pie-"+W+"-background-opacity",type:p.zeroOneNumber});var oe=[];$n.stripeBackgroundN=16,oe.push({name:"stripe-size",type:p.sizeMaybePercent}),oe.push({name:"stripe-direction",type:p.axisDirectionPrimary});for(var se=1;se<=$n.stripeBackgroundN;se++)oe.push({name:"stripe-"+se+"-background-color",type:p.color}),oe.push({name:"stripe-"+se+"-background-size",type:p.percent}),oe.push({name:"stripe-"+se+"-background-opacity",type:p.zeroOneNumber});var de=[],me=$n.arrowPrefixes=["source","mid-source","target","mid-target"];[{name:"arrow-shape",type:p.arrowShape,triggersBounds:d.any},{name:"arrow-color",type:p.color},{name:"arrow-fill",type:p.arrowFill},{name:"arrow-width",type:p.arrowWidth}].forEach(function(Oe){me.forEach(function(Ge){var Ze=Ge+"-"+Oe.name,it=Oe.type,mt=Oe.triggersBounds;de.push({name:Ze,type:it,triggersBounds:mt})})},{});var ae=$n.properties=[].concat(A,z,M,P,I,X,k,b,g,v,_,V,U,$,G,te,oe,Z,Q,de,ie),ve=$n.propertyGroups={behavior:A,transition:z,visibility:M,overlay:P,underlay:I,ghost:X,commonLabel:k,labelDimensions:b,mainLabel:g,sourceLabel:v,targetLabel:_,nodeBody:V,nodeBorder:U,nodeOutline:$,backgroundImage:G,pie:te,stripe:oe,compound:Z,edgeLine:Q,edgeArrow:de,core:ie},pe=$n.propertyGroupNames={},_e=$n.propertyGroupKeys=Object.keys(ve);_e.forEach(function(Oe){pe[Oe]=ve[Oe].map(function(Ge){return Ge.name}),ve[Oe].forEach(function(Ge){return Ge.groupKey=Oe})});var De=$n.aliases=[{name:"content",pointsTo:"label"},{name:"control-point-distance",pointsTo:"control-point-distances"},{name:"control-point-weight",pointsTo:"control-point-weights"},{name:"segment-distance",pointsTo:"segment-distances"},{name:"segment-weight",pointsTo:"segment-weights"},{name:"segment-radius",pointsTo:"segment-radii"},{name:"edge-text-rotation",pointsTo:"text-rotation"},{name:"padding-left",pointsTo:"padding"},{name:"padding-right",pointsTo:"padding"},{name:"padding-top",pointsTo:"padding"},{name:"padding-bottom",pointsTo:"padding"}];$n.propertyNames=ae.map(function(Oe){return Oe.name});for(var Le=0;Le<ae.length;Le++){var je=ae[Le];ae[je.name]=je}for(var Je=0;Je<De.length;Je++){var et=De[Je],ft=ae[et.pointsTo],rt={name:et.name,alias:!0,pointsTo:ft};ae.push(rt),ae[et.name]=rt}})();$n.getDefaultProperty=function(e){return this.getDefaultProperties()[e]};$n.getDefaultProperties=function(){var e=this._private;if(e.defaultProperties!=null)return e.defaultProperties;for(var t=dr({"selection-box-color":"#ddd","selection-box-opacity":.65,"selection-box-border-color":"#aaa","selection-box-border-width":1,"active-bg-color":"black","active-bg-opacity":.15,"active-bg-size":30,"outside-texture-bg-color":"#000","outside-texture-bg-opacity":.125,events:"yes","text-events":"no","text-valign":"top","text-halign":"center","text-justification":"auto","line-height":1,color:"#000","box-selection":"contain","text-outline-color":"#000","text-outline-width":0,"text-outline-opacity":1,"text-opacity":1,"text-decoration":"none","text-transform":"none","text-wrap":"none","text-overflow-wrap":"whitespace","text-max-width":9999,"text-background-color":"#000","text-background-opacity":0,"text-background-shape":"rectangle","text-background-padding":0,"text-border-opacity":0,"text-border-width":0,"text-border-style":"solid","text-border-color":"#000","font-family":"Helvetica Neue, Helvetica, sans-serif","font-style":"normal","font-weight":"normal","font-size":16,"min-zoomed-font-size":0,"text-rotation":"none","source-text-rotation":"none","target-text-rotation":"none",visibility:"visible",display:"element",opacity:1,"z-compound-depth":"auto","z-index-compare":"auto","z-index":0,label:"","text-margin-x":0,"text-margin-y":0,"source-label":"","source-text-offset":0,"source-text-margin-x":0,"source-text-margin-y":0,"target-label":"","target-text-offset":0,"target-text-margin-x":0,"target-text-margin-y":0,"overlay-opacity":0,"overlay-color":"#000","overlay-padding":10,"overlay-shape":"round-rectangle","overlay-corner-radius":"auto","underlay-opacity":0,"underlay-color":"#000","underlay-padding":10,"underlay-shape":"round-rectangle","underlay-corner-radius":"auto","transition-property":"none","transition-duration":0,"transition-delay":0,"transition-timing-function":"linear","box-select-labels":"no","background-blacken":0,"background-color":"#999","background-fill":"solid","background-opacity":1,"background-image":"none","background-image-crossorigin":"anonymous","background-image-opacity":1,"background-image-containment":"inside","background-image-smoothing":"yes","background-position-x":"50%","background-position-y":"50%","background-offset-x":0,"background-offset-y":0,"background-width-relative-to":"include-padding","background-height-relative-to":"include-padding","background-repeat":"no-repeat","background-fit":"none","background-clip":"node","background-width":"auto","background-height":"auto","border-color":"#000","border-opacity":1,"border-width":0,"border-style":"solid","border-dash-pattern":[4,2],"border-dash-offset":0,"border-cap":"butt","border-join":"miter","border-position":"center","outline-color":"#999","outline-opacity":1,"outline-width":0,"outline-offset":0,"outline-style":"solid",height:30,width:30,shape:"ellipse","shape-polygon-points":"-1, -1,   1, -1,   1, 1,   -1, 1","corner-radius":"auto","bounds-expansion":0,"background-gradient-direction":"to-bottom","background-gradient-stop-colors":"#999","background-gradient-stop-positions":"0%",ghost:"no","ghost-offset-y":0,"ghost-offset-x":0,"ghost-opacity":0,padding:0,"padding-relative-to":"width",position:"origin","compound-sizing-wrt-labels":"include","min-width":0,"min-width-bias-left":0,"min-width-bias-right":0,"min-height":0,"min-height-bias-top":0,"min-height-bias-bottom":0},{"pie-size":"100%","pie-hole":0,"pie-start-angle":"0deg"},[{name:"pie-{{i}}-background-color",value:"black"},{name:"pie-{{i}}-background-size",value:"0%"},{name:"pie-{{i}}-background-opacity",value:1}].reduce(function(d,p){for(var g=1;g<=$n.pieBackgroundN;g++){var v=p.name.replace("{{i}}",g),_=p.value;d[v]=_}return d},{}),{"stripe-size":"100%","stripe-direction":"horizontal"},[{name:"stripe-{{i}}-background-color",value:"black"},{name:"stripe-{{i}}-background-size",value:"0%"},{name:"stripe-{{i}}-background-opacity",value:1}].reduce(function(d,p){for(var g=1;g<=$n.stripeBackgroundN;g++){var v=p.name.replace("{{i}}",g),_=p.value;d[v]=_}return d},{}),{"line-style":"solid","line-color":"#999","line-fill":"solid","line-cap":"butt","line-opacity":1,"line-outline-width":0,"line-outline-color":"#000","line-gradient-stop-colors":"#999","line-gradient-stop-positions":"0%","control-point-step-size":40,"control-point-weights":.5,"segment-weights":.5,"segment-distances":20,"segment-radii":15,"radius-type":"arc-radius","taxi-turn":"50%","taxi-radius":15,"taxi-turn-min-distance":10,"taxi-direction":"auto","edge-distances":"intersection","curve-style":"haystack","haystack-radius":0,"arrow-scale":1,"loop-direction":"-45deg","loop-sweep":"-90deg","source-distance-from-node":0,"target-distance-from-node":0,"source-endpoint":"outside-to-node","target-endpoint":"outside-to-node","line-dash-pattern":[6,3],"line-dash-offset":0},[{name:"arrow-shape",value:"none"},{name:"arrow-color",value:"#999"},{name:"arrow-fill",value:"filled"},{name:"arrow-width",value:1}].reduce(function(d,p){return $n.arrowPrefixes.forEach(function(g){var v=g+"-"+p.name,_=p.value;d[v]=_}),d},{})),r={},n=0;n<this.properties.length;n++){var i=this.properties[n];if(!i.pointsTo){var s=i.name,u=t[s],a=this.parse(s,u);r[s]=a}}return e.defaultProperties=r,e.defaultProperties};$n.addDefaultStylesheet=function(){this.selector(":parent").css({shape:"rectangle",padding:10,"background-color":"#eee","border-color":"#ccc","border-width":1}).selector("edge").css({width:3}).selector(":loop").css({"curve-style":"bezier"}).selector("edge:compound").css({"curve-style":"bezier","source-endpoint":"outside-to-line","target-endpoint":"outside-to-line"}).selector(":selected").css({"background-color":"#0169D9","line-color":"#0169D9","source-arrow-color":"#0169D9","target-arrow-color":"#0169D9","mid-source-arrow-color":"#0169D9","mid-target-arrow-color":"#0169D9"}).selector(":parent:selected").css({"background-color":"#CCE1F9","border-color":"#aec8e5"}).selector(":active").css({"overlay-color":"black","overlay-padding":10,"overlay-opacity":.25}),this.defaultLength=this.length};var X0={};X0.parse=function(e,t,r,n){var i=this;if(Cn(t))return i.parseImplWarn(e,t,r,n);var s=n==="mapping"||n===!0||n===!1||n==null?"dontcare":n,u=r?"t":"f",a=""+t,d=$N(e,a,u,s),p=i.propCache=i.propCache||[],g;return(g=p[d])||(g=p[d]=i.parseImplWarn(e,t,r,n)),(r||n==="mapping")&&(g=Gs(g),g&&(g.value=Gs(g.value))),g};X0.parseImplWarn=function(e,t,r,n){var i=this.parseImpl(e,t,r,n);return!i&&t!=null&&Gr("The style property `".concat(e,": ").concat(t,"` is invalid")),i&&(i.name==="width"||i.name==="height")&&t==="label"&&Gr("The style value of `label` is deprecated for `"+i.name+"`"),i};X0.parseImpl=function(e,t,r,n){var i=this;e=_S(e);var s=i.properties[e],u=t,a=i.types;if(!s||t===void 0)return null;s.alias&&(s=s.pointsTo,e=s.name);var d=sr(t);d&&(t=t.trim());var p=s.type;if(!p)return null;if(r&&(t===""||t===null))return{name:e,value:t,bypass:!0,deleteBypass:!0};if(Cn(t))return{name:e,value:t,strValue:"fn",mapped:a.fn,bypass:r};var g,v;if(!(!d||n||t.length<7||t[1]!=="a")){if(t.length>=7&&t[0]==="d"&&(g=new RegExp(a.data.regex).exec(t))){if(r)return!1;var _=a.data;return{name:e,value:g,strValue:""+t,mapped:_,field:g[1],bypass:r}}else if(t.length>=10&&t[0]==="m"&&(v=new RegExp(a.mapData.regex).exec(t))){if(r||p.multiple)return!1;var b=a.mapData;if(!(p.color||p.number))return!1;var k=this.parse(e,v[4]);if(!k||k.mapped)return!1;var A=this.parse(e,v[5]);if(!A||A.mapped)return!1;if(k.pfValue===A.pfValue||k.strValue===A.strValue)return Gr("`"+e+": "+t+"` is not a valid mapper because the output range is zero; converting to `"+e+": "+k.strValue+"`"),this.parse(e,k.strValue);if(p.color){var M=k.value,P=A.value,I=M[0]===P[0]&&M[1]===P[1]&&M[2]===P[2]&&(M[3]===P[3]||(M[3]==null||M[3]===1)&&(P[3]==null||P[3]===1));if(I)return!1}return{name:e,value:v,strValue:""+t,mapped:b,field:v[1],fieldMin:parseFloat(v[2]),fieldMax:parseFloat(v[3]),valueMin:k.value,valueMax:A.value,bypass:r}}}if(p.multiple&&n!=="multiple"){var z;if(d?z=t.split(/\s+/):an(t)?z=t:z=[t],p.evenMultiple&&z.length%2!==0)return null;for(var O=[],V=[],U=[],$="",G=!1,Z=0;Z<z.length;Z++){var Q=i.parse(e,z[Z],r,"multiple");G=G||sr(Q.value),O.push(Q.value),U.push(Q.pfValue!=null?Q.pfValue:Q.value),V.push(Q.units),$+=(Z>0?" ":"")+Q.strValue}return p.validate&&!p.validate(O,V)?null:p.singleEnum&&G?O.length===1&&sr(O[0])?{name:e,value:O[0],strValue:O[0],bypass:r}:null:{name:e,value:O,pfValue:U,strValue:$,bypass:r,units:V}}var X=function(){for(var rt=0;rt<p.enums.length;rt++){var Oe=p.enums[rt];if(Oe===t)return{name:e,value:t,strValue:""+t,bypass:r}}return null};if(p.number){var ie,te="px";if(p.units&&(ie=p.units),p.implicitUnits&&(te=p.implicitUnits),!p.unitless)if(d){var W="px|em"+(p.allowPercent?"|\\%":"");ie&&(W=ie);var oe=t.match("^("+Yn+")("+W+")?$");oe&&(t=oe[1],ie=oe[2]||te)}else(!ie||p.implicitUnits)&&(ie=te);if(t=parseFloat(t),isNaN(t)&&p.enums===void 0)return null;if(isNaN(t)&&p.enums!==void 0)return t=u,X();if(p.integer&&!xj(t)||p.min!==void 0&&(t<p.min||p.strictMin&&t===p.min)||p.max!==void 0&&(t>p.max||p.strictMax&&t===p.max))return null;var se={name:e,value:t,strValue:""+t+(ie||""),units:ie,bypass:r};return p.unitless||ie!=="px"&&ie!=="em"?se.pfValue=t:se.pfValue=ie==="px"||!ie?t:this.getEmSizeInPixels()*t,(ie==="ms"||ie==="s")&&(se.pfValue=ie==="ms"?t:1e3*t),(ie==="deg"||ie==="rad")&&(se.pfValue=ie==="rad"?t:I6(t)),ie==="%"&&(se.pfValue=t/100),se}else if(p.propList){var de=[],me=""+t;if(me!=="none"){for(var ae=me.split(/\s*,\s*|\s+/),ve=0;ve<ae.length;ve++){var pe=ae[ve].trim();i.properties[pe]?de.push(pe):Gr("`"+pe+"` is not a valid property name")}if(de.length===0)return null}return{name:e,value:de,strValue:de.length===0?"none":de.join(" "),bypass:r}}else if(p.color){var _e=zN(t);return _e?{name:e,value:_e,pfValue:_e,strValue:"rgb("+_e[0]+","+_e[1]+","+_e[2]+")",bypass:r}:null}else if(p.regex||p.regexes){if(p.enums){var De=X();if(De)return De}for(var Le=p.regexes?p.regexes:[p.regex],je=0;je<Le.length;je++){var Je=new RegExp(Le[je]),et=Je.exec(t);if(et)return{name:e,value:p.singleRegexMatchValue?et[1]:et,strValue:""+t,bypass:r}}return null}else return p.string?{name:e,value:""+t,strValue:""+t,bypass:r}:p.enums?X():null};var fi=function(t){if(!(this instanceof fi))return new fi(t);if(!xS(t)){_n("A style must have a core reference");return}this._private={cy:t,coreStyle:{}},this.length=0,this.resetToDefault()},Vi=fi.prototype;Vi.instanceString=function(){return"style"};Vi.clear=function(){for(var e=this._private,t=e.cy,r=t.elements(),n=0;n<this.length;n++)this[n]=void 0;return this.length=0,e.contextStyles={},e.propDiffs={},this.cleanElements(r,!0),r.forEach(function(i){var s=i[0]._private;s.styleDirty=!0,s.appliedInitStyle=!1}),this};Vi.resetToDefault=function(){return this.clear(),this.addDefaultStylesheet(),this};Vi.core=function(e){return this._private.coreStyle[e]||this.getDefaultProperty(e)};Vi.selector=function(e){var t=e==="core"?null:new au(e),r=this.length++;return this[r]={selector:t,properties:[],mappedProperties:[],index:r},this};Vi.css=function(){var e=this,t=arguments;if(t.length===1)for(var r=t[0],n=0;n<e.properties.length;n++){var i=e.properties[n],s=r[i.name];s===void 0&&(s=r[R0(i.name)]),s!==void 0&&this.cssRule(i.name,s)}else t.length===2&&this.cssRule(t[0],t[1]);return this};Vi.style=Vi.css;Vi.cssRule=function(e,t){var r=this.parse(e,t);if(r){var n=this.length-1;this[n].properties.push(r),this[n].properties[r.name]=r,r.name.match(/pie-(\d+)-background-size/)&&r.value&&(this._private.hasPie=!0),r.name.match(/stripe-(\d+)-background-size/)&&r.value&&(this._private.hasStripe=!0),r.mapped&&this[n].mappedProperties.push(r);var i=!this[n].selector;i&&(this._private.coreStyle[r.name]=r)}return this};Vi.append=function(e){return MN(e)?e.appendToStyle(this):an(e)?this.appendFromJson(e):sr(e)&&this.appendFromString(e),this};fi.fromJson=function(e,t){var r=new fi(e);return r.fromJson(t),r};fi.fromString=function(e,t){return new fi(e).fromString(t)};[mi,qm,RS,Ks,Z0,LS,$n,X0].forEach(function(e){dr(Vi,e)});fi.types=Vi.types;fi.properties=Vi.properties;fi.propertyGroups=Vi.propertyGroups;fi.propertyGroupNames=Vi.propertyGroupNames;fi.propertyGroupKeys=Vi.propertyGroupKeys;var N8={style:function(t){if(t){var r=this.setStyle(t);r.update()}return this._private.style},setStyle:function(t){var r=this._private;return MN(t)?r.style=t.generateStyle(this):an(t)?r.style=fi.fromJson(this,t):sr(t)?r.style=fi.fromString(this,t):r.style=fi(this),r.style},updateStyle:function(){this.mutableElements().updateStyle()}},z8="single",xc={autolock:function(t){if(t!==void 0)this._private.autolock=!!t;else return this._private.autolock;return this},autoungrabify:function(t){if(t!==void 0)this._private.autoungrabify=!!t;else return this._private.autoungrabify;return this},autounselectify:function(t){if(t!==void 0)this._private.autounselectify=!!t;else return this._private.autounselectify;return this},selectionType:function(t){var r=this._private;if(r.selectionType==null&&(r.selectionType=z8),t!==void 0)(t==="additive"||t==="single")&&(r.selectionType=t);else return r.selectionType;return this},panningEnabled:function(t){if(t!==void 0)this._private.panningEnabled=!!t;else return this._private.panningEnabled;return this},userPanningEnabled:function(t){if(t!==void 0)this._private.userPanningEnabled=!!t;else return this._private.userPanningEnabled;return this},zoomingEnabled:function(t){if(t!==void 0)this._private.zoomingEnabled=!!t;else return this._private.zoomingEnabled;return this},userZoomingEnabled:function(t){if(t!==void 0)this._private.userZoomingEnabled=!!t;else return this._private.userZoomingEnabled;return this},boxSelectionEnabled:function(t){if(t!==void 0)this._private.boxSelectionEnabled=!!t;else return this._private.boxSelectionEnabled;return this},pan:function(){var t=arguments,r=this._private.pan,n,i,s,u,a;switch(t.length){case 0:return r;case 1:if(sr(t[0]))return n=t[0],r[n];if(Fr(t[0])){if(!this._private.panningEnabled)return this;s=t[0],u=s.x,a=s.y,Rt(u)&&(r.x=u),Rt(a)&&(r.y=a),this.emit("pan viewport")}break;case 2:if(!this._private.panningEnabled)return this;n=t[0],i=t[1],(n==="x"||n==="y")&&Rt(i)&&(r[n]=i),this.emit("pan viewport");break}return this.notify("viewport"),this},panBy:function(t,r){var n=arguments,i=this._private.pan,s,u,a,d,p;if(!this._private.panningEnabled)return this;switch(n.length){case 1:Fr(t)&&(a=n[0],d=a.x,p=a.y,Rt(d)&&(i.x+=d),Rt(p)&&(i.y+=p),this.emit("pan viewport"));break;case 2:s=t,u=r,(s==="x"||s==="y")&&Rt(u)&&(i[s]+=u),this.emit("pan viewport");break}return this.notify("viewport"),this},gc:function(){this.notify("gc")},fit:function(t,r){var n=this.getFitViewport(t,r);if(n){var i=this._private;i.zoom=n.zoom,i.pan=n.pan,this.emit("pan zoom viewport"),this.notify("viewport")}return this},getFitViewport:function(t,r){if(Rt(t)&&r===void 0&&(r=t,t=void 0),!(!this._private.panningEnabled||!this._private.zoomingEnabled)){var n;if(sr(t)){var i=t;t=this.$(i)}else if(bj(t)){var s=t;n={x1:s.x1,y1:s.y1,x2:s.x2,y2:s.y2},n.w=n.x2-n.x1,n.h=n.y2-n.y1}else La(t)||(t=this.mutableElements());if(!(La(t)&&t.empty())){n=n||t.boundingBox();var u=this.width(),a=this.height(),d;if(r=Rt(r)?r:0,!isNaN(u)&&!isNaN(a)&&u>0&&a>0&&!isNaN(n.w)&&!isNaN(n.h)&&n.w>0&&n.h>0){d=Math.min((u-2*r)/n.w,(a-2*r)/n.h),d=d>this._private.maxZoom?this._private.maxZoom:d,d=d<this._private.minZoom?this._private.minZoom:d;var p={x:(u-d*(n.x1+n.x2))/2,y:(a-d*(n.y1+n.y2))/2};return{zoom:d,pan:p}}}}},zoomRange:function(t,r){var n=this._private;if(r==null){var i=t;t=i.min,r=i.max}return Rt(t)&&Rt(r)&&t<=r?(n.minZoom=t,n.maxZoom=r):Rt(t)&&r===void 0&&t<=n.maxZoom?n.minZoom=t:Rt(r)&&t===void 0&&r>=n.minZoom&&(n.maxZoom=r),this},minZoom:function(t){return t===void 0?this._private.minZoom:this.zoomRange({min:t})},maxZoom:function(t){return t===void 0?this._private.maxZoom:this.zoomRange({max:t})},getZoomedViewport:function(t){var r=this._private,n=r.pan,i=r.zoom,s,u,a=!1;if(r.zoomingEnabled||(a=!0),Rt(t)?u=t:Fr(t)&&(u=t.level,t.position!=null?s=O0(t.position,i,n):t.renderedPosition!=null&&(s=t.renderedPosition),s!=null&&!r.panningEnabled&&(a=!0)),u=u>r.maxZoom?r.maxZoom:u,u=u<r.minZoom?r.minZoom:u,a||!Rt(u)||u===i||s!=null&&(!Rt(s.x)||!Rt(s.y)))return null;if(s!=null){var d=n,p=i,g=u,v={x:-g/p*(s.x-d.x)+s.x,y:-g/p*(s.y-d.y)+s.y};return{zoomed:!0,panned:!0,zoom:g,pan:v}}else return{zoomed:!0,panned:!1,zoom:u,pan:n}},zoom:function(t){if(t===void 0)return this._private.zoom;var r=this.getZoomedViewport(t),n=this._private;return r==null||!r.zoomed?this:(n.zoom=r.zoom,r.panned&&(n.pan.x=r.pan.x,n.pan.y=r.pan.y),this.emit("zoom"+(r.panned?" pan":"")+" viewport"),this.notify("viewport"),this)},viewport:function(t){var r=this._private,n=!0,i=!0,s=[],u=!1,a=!1;if(!t)return this;if(Rt(t.zoom)||(n=!1),Fr(t.pan)||(i=!1),!n&&!i)return this;if(n){var d=t.zoom;d<r.minZoom||d>r.maxZoom||!r.zoomingEnabled?u=!0:(r.zoom=d,s.push("zoom"))}if(i&&(!u||!t.cancelOnFailedZoom)&&r.panningEnabled){var p=t.pan;Rt(p.x)&&(r.pan.x=p.x,a=!1),Rt(p.y)&&(r.pan.y=p.y,a=!1),a||s.push("pan")}return s.length>0&&(s.push("viewport"),this.emit(s.join(" ")),this.notify("viewport")),this},center:function(t){var r=this.getCenterPan(t);return r&&(this._private.pan=r,this.emit("pan viewport"),this.notify("viewport")),this},getCenterPan:function(t,r){if(this._private.panningEnabled){if(sr(t)){var n=t;t=this.mutableElements().filter(n)}else La(t)||(t=this.mutableElements());if(t.length!==0){var i=t.boundingBox(),s=this.width(),u=this.height();r=r===void 0?this._private.zoom:r;var a={x:(s-r*(i.x1+i.x2))/2,y:(u-r*(i.y1+i.y2))/2};return a}}},reset:function(){return!this._private.panningEnabled||!this._private.zoomingEnabled?this:(this.viewport({pan:{x:0,y:0},zoom:1}),this)},invalidateSize:function(){this._private.sizeCache=null},size:function(){var t=this._private,r=t.container,n=this;return t.sizeCache=t.sizeCache||(r?function(){var i=n.window().getComputedStyle(r),s=function(a){return parseFloat(i.getPropertyValue(a))};return{width:r.clientWidth-s("padding-left")-s("padding-right"),height:r.clientHeight-s("padding-top")-s("padding-bottom")}}():{width:1,height:1})},width:function(){return this.size().width},height:function(){return this.size().height},extent:function(){var t=this._private.pan,r=this._private.zoom,n=this.renderedExtent(),i={x1:(n.x1-t.x)/r,x2:(n.x2-t.x)/r,y1:(n.y1-t.y)/r,y2:(n.y2-t.y)/r};return i.w=i.x2-i.x1,i.h=i.y2-i.y1,i},renderedExtent:function(){var t=this.width(),r=this.height();return{x1:0,y1:0,x2:t,y2:r,w:t,h:r}},multiClickDebounceTime:function(t){if(t)this._private.multiClickDebounceTime=t;else return this._private.multiClickDebounceTime;return this}};xc.centre=xc.center;xc.autolockNodes=xc.autolock;xc.autoungrabifyNodes=xc.autoungrabify;var fm={data:Hr.data({field:"data",bindingEvent:"data",allowBinding:!0,allowSetting:!0,settingEvent:"data",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeData:Hr.removeData({field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0}),scratch:Hr.data({field:"scratch",bindingEvent:"scratch",allowBinding:!0,allowSetting:!0,settingEvent:"scratch",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeScratch:Hr.removeData({field:"scratch",event:"scratch",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0})};fm.attr=fm.data;fm.removeAttr=fm.removeData;var pm=function(t){var r=this;t=dr({},t);var n=t.container;n&&!Uy(n)&&Uy(n[0])&&(n=n[0]);var i=n?n._cyreg:null;i=i||{},i&&i.cy&&(i.cy.destroy(),i={});var s=i.readies=i.readies||[];n&&(n._cyreg=i),i.cy=r;var u=Zn!==void 0&&n!==void 0&&!t.headless,a=t;a.layout=dr({name:u?"grid":"null"},a.layout),a.renderer=dr({name:u?"canvas":"null"},a.renderer);var d=function(k,A,M){return A!==void 0?A:M!==void 0?M:k},p=this._private={container:n,ready:!1,options:a,elements:new Si(this),listeners:[],aniEles:new Si(this),data:a.data||{},scratch:{},layout:null,renderer:null,destroyed:!1,notificationsEnabled:!0,minZoom:1e-50,maxZoom:1e50,zoomingEnabled:d(!0,a.zoomingEnabled),userZoomingEnabled:d(!0,a.userZoomingEnabled),panningEnabled:d(!0,a.panningEnabled),userPanningEnabled:d(!0,a.userPanningEnabled),boxSelectionEnabled:d(!0,a.boxSelectionEnabled),autolock:d(!1,a.autolock,a.autolockNodes),autoungrabify:d(!1,a.autoungrabify,a.autoungrabifyNodes),autounselectify:d(!1,a.autounselectify),styleEnabled:a.styleEnabled===void 0?u:a.styleEnabled,zoom:Rt(a.zoom)?a.zoom:1,pan:{x:Fr(a.pan)&&Rt(a.pan.x)?a.pan.x:0,y:Fr(a.pan)&&Rt(a.pan.y)?a.pan.y:0},animation:{current:[],queue:[]},hasCompoundNodes:!1,multiClickDebounceTime:d(250,a.multiClickDebounceTime)};this.createEmitter(),this.selectionType(a.selectionType),this.zoomRange({min:a.minZoom,max:a.maxZoom});var g=function(k,A){var M=k.some(Sj);if(M)return Bd.all(k).then(A);A(k)};p.styleEnabled&&r.setStyle([]);var v=dr({},a,a.renderer);r.initRenderer(v);var _=function(k,A,M){r.notifications(!1);var P=r.mutableElements();P.length>0&&P.remove(),k!=null&&(Fr(k)||an(k))&&r.add(k),r.one("layoutready",function(z){r.notifications(!0),r.emit(z),r.one("load",A),r.emitAndNotify("load")}).one("layoutstop",function(){r.one("done",M),r.emit("done")});var I=dr({},r._private.options.layout);I.eles=r.elements(),r.layout(I).run()};g([a.style,a.elements],function(b){var k=b[0],A=b[1];p.styleEnabled&&r.style().append(k),_(A,function(){r.startAnimationLoop(),p.ready=!0,Cn(a.ready)&&r.on("ready",a.ready);for(var M=0;M<s.length;M++){var P=s[M];r.on("ready",P)}i&&(i.readies=[]),r.emit("ready")},a.done)})},Ky=pm.prototype;dr(Ky,{instanceString:function(){return"core"},isReady:function(){return this._private.ready},destroyed:function(){return this._private.destroyed},ready:function(t){return this.isReady()?this.emitter().emit("ready",[],t):this.on("ready",t),this},destroy:function(){var t=this;if(!t.destroyed())return t.stopAnimationLoop(),t.destroyRenderer(),this.emit("destroy"),t._private.destroyed=!0,t},hasElementWithId:function(t){return this._private.elements.hasElementWithId(t)},getElementById:function(t){return this._private.elements.getElementById(t)},hasCompoundNodes:function(){return this._private.hasCompoundNodes},headless:function(){return this._private.renderer.isHeadless()},styleEnabled:function(){return this._private.styleEnabled},addToPool:function(t){return this._private.elements.merge(t),this},removeFromPool:function(t){return this._private.elements.unmerge(t),this},container:function(){return this._private.container||null},window:function(){var t=this._private.container;if(t==null)return Zn;var r=this._private.container.ownerDocument;return r===void 0||r==null?Zn:r.defaultView||Zn},mount:function(t){if(t!=null){var r=this,n=r._private,i=n.options;return!Uy(t)&&Uy(t[0])&&(t=t[0]),r.stopAnimationLoop(),r.destroyRenderer(),n.container=t,n.styleEnabled=!0,r.invalidateSize(),r.initRenderer(dr({},i,i.renderer,{name:i.renderer.name==="null"?"canvas":i.renderer.name})),r.startAnimationLoop(),r.style(i.style),r.emit("mount"),r}},unmount:function(){var t=this;return t.stopAnimationLoop(),t.destroyRenderer(),t.initRenderer({name:"null"}),t.emit("unmount"),t},options:function(){return Gs(this._private.options)},json:function(t){var r=this,n=r._private,i=r.mutableElements(),s=function(O){return r.getElementById(O.id())};if(Fr(t)){if(r.startBatch(),t.elements){var u={},a=function(O,V){for(var U=[],$=[],G=0;G<O.length;G++){var Z=O[G];if(!Z.data.id){Gr("cy.json() cannot handle elements without an ID attribute");continue}var Q=""+Z.data.id,X=r.getElementById(Q);u[Q]=!0,X.length!==0?$.push({ele:X,json:Z}):(V&&(Z.group=V),U.push(Z))}r.add(U);for(var ie=0;ie<$.length;ie++){var te=$[ie],W=te.ele,oe=te.json;W.json(oe)}};if(an(t.elements))a(t.elements);else for(var d=["nodes","edges"],p=0;p<d.length;p++){var g=d[p],v=t.elements[g];an(v)&&a(v,g)}var _=r.collection();i.filter(function(z){return!u[z.id()]}).forEach(function(z){z.isParent()?_.merge(z):z.remove()}),_.forEach(function(z){return z.children().move({parent:null})}),_.forEach(function(z){return s(z).remove()})}t.style&&r.style(t.style),t.zoom!=null&&t.zoom!==n.zoom&&r.zoom(t.zoom),t.pan&&(t.pan.x!==n.pan.x||t.pan.y!==n.pan.y)&&r.pan(t.pan),t.data&&r.data(t.data);for(var b=["minZoom","maxZoom","zoomingEnabled","userZoomingEnabled","panningEnabled","userPanningEnabled","boxSelectionEnabled","autolock","autoungrabify","autounselectify","multiClickDebounceTime"],k=0;k<b.length;k++){var A=b[k];t[A]!=null&&r[A](t[A])}return r.endBatch(),this}else{var M=!!t,P={};M?P.elements=this.elements().map(function(z){return z.json()}):(P.elements={},i.forEach(function(z){var O=z.group();P.elements[O]||(P.elements[O]=[]),P.elements[O].push(z.json())})),this._private.styleEnabled&&(P.style=r.style().json()),P.data=Gs(r.data());var I=n.options;return P.zoomingEnabled=n.zoomingEnabled,P.userZoomingEnabled=n.userZoomingEnabled,P.zoom=n.zoom,P.minZoom=n.minZoom,P.maxZoom=n.maxZoom,P.panningEnabled=n.panningEnabled,P.userPanningEnabled=n.userPanningEnabled,P.pan=Gs(n.pan),P.boxSelectionEnabled=n.boxSelectionEnabled,P.renderer=Gs(I.renderer),P.hideEdgesOnViewport=I.hideEdgesOnViewport,P.textureOnViewport=I.textureOnViewport,P.wheelSensitivity=I.wheelSensitivity,P.motionBlur=I.motionBlur,P.multiClickDebounceTime=I.multiClickDebounceTime,P}}});Ky.$id=Ky.getElementById;[S8,P8,Mz,Z1,uy,A8,X1,cy,N8,xc,fm].forEach(function(e){dr(Ky,e)});var R8={fit:!0,directed:!1,direction:"downward",padding:30,circle:!1,grid:!1,spacingFactor:1.75,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,roots:void 0,depthSort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(t,r){return!0},ready:void 0,stop:void 0,transform:function(t,r){return r}},L8={maximal:!1,acyclic:!1},Ih=function(t){return t.scratch("breadthfirst")},gI=function(t,r){return t.scratch("breadthfirst",r)};function Dz(e){this.options=dr({},R8,L8,e)}Dz.prototype.run=function(){var e=this.options,t=e.cy,r=e.eles,n=r.nodes().filter(function(yt){return yt.isChildless()}),i=r,s=e.directed,u=e.acyclic||e.maximal||e.maximalAdjustments>0,a=!!e.boundingBox,d=ta(a?e.boundingBox:structuredClone(t.extent())),p;if(La(e.roots))p=e.roots;else if(an(e.roots)){for(var g=[],v=0;v<e.roots.length;v++){var _=e.roots[v],b=t.getElementById(_);g.push(b)}p=t.collection(g)}else if(sr(e.roots))p=t.$(e.roots);else if(s)p=n.roots();else{var k=r.components();p=t.collection();for(var A=function(){var gt=k[M],qt=gt.maxDegree(!1),$t=gt.filter(function(er){return er.degree(!1)===qt});p=p.add($t)},M=0;M<k.length;M++)A()}var P=[],I={},z=function(gt,qt){P[qt]==null&&(P[qt]=[]);var $t=P[qt].length;P[qt].push(gt),gI(gt,{index:$t,depth:qt})},O=function(gt,qt){var $t=Ih(gt),er=$t.depth,Vt=$t.index;P[er][Vt]=null,gt.isChildless()&&z(gt,qt)};i.bfs({roots:p,directed:e.directed,visit:function(gt,qt,$t,er,Vt){var tr=gt[0],pr=tr.id();tr.isChildless()&&z(tr,Vt),I[pr]=!0}});for(var V=[],U=0;U<n.length;U++){var $=n[U];I[$.id()]||V.push($)}var G=function(gt){for(var qt=P[gt],$t=0;$t<qt.length;$t++){var er=qt[$t];if(er==null){qt.splice($t,1),$t--;continue}gI(er,{depth:gt,index:$t})}},Z=function(gt,qt){for(var $t=Ih(gt),er=gt.incomers().filter(function(Ht){return Ht.isNode()&&r.has(Ht)}),Vt=-1,tr=gt.id(),pr=0;pr<er.length;pr++){var vr=er[pr],lt=Ih(vr);Vt=Math.max(Vt,lt.depth)}if($t.depth<=Vt){if(!e.acyclic&&qt[tr])return null;var mr=Vt+1;return O(gt,mr),qt[tr]=mr,!0}return!1};if(s&&u){var Q=[],X={},ie=function(gt){return Q.push(gt)},te=function(){return Q.shift()};for(n.forEach(function(yt){return Q.push(yt)});Q.length>0;){var W=te(),oe=Z(W,X);if(oe)W.outgoers().filter(function(yt){return yt.isNode()&&r.has(yt)}).forEach(ie);else if(oe===null){Gr("Detected double maximal shift for node `"+W.id()+"`.  Bailing maximal adjustment due to cycle.  Use `options.maximal: true` only on DAGs.");break}}}var se=0;if(e.avoidOverlap)for(var de=0;de<n.length;de++){var me=n[de],ae=me.layoutDimensions(e),ve=ae.w,pe=ae.h;se=Math.max(se,ve,pe)}var _e={},De=function(gt){if(_e[gt.id()])return _e[gt.id()];for(var qt=Ih(gt).depth,$t=gt.neighborhood(),er=0,Vt=0,tr=0;tr<$t.length;tr++){var pr=$t[tr];if(!(pr.isEdge()||pr.isParent()||!n.has(pr))){var vr=Ih(pr);if(vr!=null){var lt=vr.index,mr=vr.depth;if(!(lt==null||mr==null)){var Ht=P[mr].length;mr<qt&&(er+=lt/Ht,Vt++)}}}}return Vt=Math.max(1,Vt),er=er/Vt,Vt===0&&(er=0),_e[gt.id()]=er,er},Le=function(gt,qt){var $t=De(gt),er=De(qt),Vt=$t-er;return Vt===0?NN(gt.id(),qt.id()):Vt};e.depthSort!==void 0&&(Le=e.depthSort);for(var je=P.length,Je=0;Je<je;Je++)P[Je].sort(Le),G(Je);for(var et=[],ft=0;ft<V.length;ft++)et.push(V[ft]);var rt=function(){for(var gt=0;gt<je;gt++)G(gt)};et.length&&(P.unshift(et),je=P.length,rt());for(var Oe=0,Ge=0;Ge<je;Ge++)Oe=Math.max(P[Ge].length,Oe);var Ze={x:d.x1+d.w/2,y:d.y1+d.h/2},it=n.reduce(function(yt,gt){return function(qt){return{w:yt.w===-1?qt.w:(yt.w+qt.w)/2,h:yt.h===-1?qt.h:(yt.h+qt.h)/2}}(gt.boundingBox({includeLabels:e.nodeDimensionsIncludeLabels}))},{w:-1,h:-1}),mt=Math.max(je===1?0:a?(d.h-e.padding*2-it.h)/(je-1):(d.h-e.padding*2-it.h)/(je+1),se),Tt=P.reduce(function(yt,gt){return Math.max(yt,gt.length)},0),$e=function(gt){var qt=Ih(gt),$t=qt.depth,er=qt.index;if(e.circle){var Vt=Math.min(d.w/2/je,d.h/2/je);Vt=Math.max(Vt,se);var tr=Vt*$t+Vt-(je>0&&P[0].length<=3?Vt/2:0),pr=2*Math.PI/P[$t].length*er;return $t===0&&P[0].length===1&&(tr=1),{x:Ze.x+tr*Math.cos(pr),y:Ze.y+tr*Math.sin(pr)}}else{var vr=P[$t].length,lt=Math.max(vr===1?0:a?(d.w-e.padding*2-it.w)/((e.grid?Tt:vr)-1):(d.w-e.padding*2-it.w)/((e.grid?Tt:vr)+1),se),mr={x:Ze.x+(er+1-(vr+1)/2)*lt,y:Ze.y+($t+1-(je+1)/2)*mt};return mr}},At={downward:0,leftward:90,upward:180,rightward:-90};Object.keys(At).indexOf(e.direction)===-1&&_n("Invalid direction '".concat(e.direction,"' specified for breadthfirst layout. Valid values are: ").concat(Object.keys(At).join(", ")));var pt=function(gt){return Jj($e(gt),d,At[e.direction])};return r.nodes().layoutPositions(this,e,pt),this};var B8={fit:!0,padding:30,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,spacingFactor:void 0,radius:void 0,startAngle:3/2*Math.PI,sweep:void 0,clockwise:!0,sort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(t,r){return!0},ready:void 0,stop:void 0,transform:function(t,r){return r}};function Nz(e){this.options=dr({},B8,e)}Nz.prototype.run=function(){var e=this.options,t=e,r=e.cy,n=t.eles,i=t.counterclockwise!==void 0?!t.counterclockwise:t.clockwise,s=n.nodes().not(":parent");t.sort&&(s=s.sort(t.sort));for(var u=ta(t.boundingBox?t.boundingBox:{x1:0,y1:0,w:r.width(),h:r.height()}),a={x:u.x1+u.w/2,y:u.y1+u.h/2},d=t.sweep===void 0?2*Math.PI-2*Math.PI/s.length:t.sweep,p=d/Math.max(1,s.length-1),g,v=0,_=0;_<s.length;_++){var b=s[_],k=b.layoutDimensions(t),A=k.w,M=k.h;v=Math.max(v,A,M)}if(Rt(t.radius)?g=t.radius:s.length<=1?g=0:g=Math.min(u.h,u.w)/2-v,s.length>1&&t.avoidOverlap){v*=1.75;var P=Math.cos(p)-Math.cos(0),I=Math.sin(p)-Math.sin(0),z=Math.sqrt(v*v/(P*P+I*I));g=Math.max(z,g)}var O=function(U,$){var G=t.startAngle+$*p*(i?1:-1),Z=g*Math.cos(G),Q=g*Math.sin(G),X={x:a.x+Z,y:a.y+Q};return X};return n.nodes().layoutPositions(this,t,O),this};var O8={fit:!0,padding:30,startAngle:3/2*Math.PI,sweep:void 0,clockwise:!0,equidistant:!1,minNodeSpacing:10,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,height:void 0,width:void 0,spacingFactor:void 0,concentric:function(t){return t.degree()},levelWidth:function(t){return t.maxDegree()/4},animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(t,r){return!0},ready:void 0,stop:void 0,transform:function(t,r){return r}};function zz(e){this.options=dr({},O8,e)}zz.prototype.run=function(){for(var e=this.options,t=e,r=t.counterclockwise!==void 0?!t.counterclockwise:t.clockwise,n=e.cy,i=t.eles,s=i.nodes().not(":parent"),u=ta(t.boundingBox?t.boundingBox:{x1:0,y1:0,w:n.width(),h:n.height()}),a={x:u.x1+u.w/2,y:u.y1+u.h/2},d=[],p=0,g=0;g<s.length;g++){var v=s[g],_=void 0;_=t.concentric(v),d.push({value:_,node:v}),v._private.scratch.concentric=_}s.updateStyle();for(var b=0;b<s.length;b++){var k=s[b],A=k.layoutDimensions(t);p=Math.max(p,A.w,A.h)}d.sort(function(mt,Tt){return Tt.value-mt.value});for(var M=t.levelWidth(s),P=[[]],I=P[0],z=0;z<d.length;z++){var O=d[z];if(I.length>0){var V=Math.abs(I[0].value-O.value);V>=M&&(I=[],P.push(I))}I.push(O)}var U=p+t.minNodeSpacing;if(!t.avoidOverlap){var $=P.length>0&&P[0].length>1,G=Math.min(u.w,u.h)/2-U,Z=G/(P.length+$?1:0);U=Math.min(U,Z)}for(var Q=0,X=0;X<P.length;X++){var ie=P[X],te=t.sweep===void 0?2*Math.PI-2*Math.PI/ie.length:t.sweep,W=ie.dTheta=te/Math.max(1,ie.length-1);if(ie.length>1&&t.avoidOverlap){var oe=Math.cos(W)-Math.cos(0),se=Math.sin(W)-Math.sin(0),de=Math.sqrt(U*U/(oe*oe+se*se));Q=Math.max(de,Q)}ie.r=Q,Q+=U}if(t.equidistant){for(var me=0,ae=0,ve=0;ve<P.length;ve++){var pe=P[ve],_e=pe.r-ae;me=Math.max(me,_e)}ae=0;for(var De=0;De<P.length;De++){var Le=P[De];De===0&&(ae=Le.r),Le.r=ae,ae+=me}}for(var je={},Je=0;Je<P.length;Je++)for(var et=P[Je],ft=et.dTheta,rt=et.r,Oe=0;Oe<et.length;Oe++){var Ge=et[Oe],Ze=t.startAngle+(r?1:-1)*ft*Oe,it={x:a.x+rt*Math.cos(Ze),y:a.y+rt*Math.sin(Ze)};je[Ge.node.id()]=it}return i.nodes().layoutPositions(this,t,function(mt){var Tt=mt.id();return je[Tt]}),this};var _b,F8={ready:function(){},stop:function(){},animate:!0,animationEasing:void 0,animationDuration:void 0,animateFilter:function(t,r){return!0},animationThreshold:250,refresh:20,fit:!0,padding:30,boundingBox:void 0,nodeDimensionsIncludeLabels:!1,randomize:!1,componentSpacing:40,nodeRepulsion:function(t){return 2048},nodeOverlap:4,idealEdgeLength:function(t){return 32},edgeElasticity:function(t){return 32},nestingFactor:1.2,gravity:1,numIter:1e3,initialTemp:1e3,coolingFactor:.99,minTemp:1};function K0(e){this.options=dr({},F8,e),this.options.layout=this;var t=this.options.eles.nodes(),r=this.options.eles.edges(),n=r.filter(function(i){var s=i.source().data("id"),u=i.target().data("id"),a=t.some(function(p){return p.data("id")===s}),d=t.some(function(p){return p.data("id")===u});return!a||!d});this.options.eles=this.options.eles.not(n)}K0.prototype.run=function(){var e=this.options,t=e.cy,r=this;r.stopped=!1,(e.animate===!0||e.animate===!1)&&r.emit({type:"layoutstart",layout:r}),e.debug===!0?_b=!0:_b=!1;var n=j8(t,r,e);_b&&V8(n),e.randomize&&U8(n);var i=Bo(),s=function(){q8(n,t,e),e.fit===!0&&t.fit(e.padding)},u=function(_){return!(r.stopped||_>=e.numIter||(H8(n,e),n.temperature=n.temperature*e.coolingFactor,n.temperature<e.minTemp))},a=function(){if(e.animate===!0||e.animate===!1)s(),r.one("layoutstop",e.stop),r.emit({type:"layoutstop",layout:r});else{var _=e.eles.nodes(),b=Lz(n,e,_);_.layoutPositions(r,e,b)}},d=0,p=!0;if(e.animate===!0){var g=function(){for(var _=0;p&&_<e.refresh;)p=u(d),d++,_++;if(!p)yI(n,e),a();else{var b=Bo();b-i>=e.animationThreshold&&s(),qy(g)}};g()}else{for(;p;)p=u(d),d++;yI(n,e),a()}return this};K0.prototype.stop=function(){return this.stopped=!0,this.thread&&this.thread.stop(),this.emit("layoutstop"),this};K0.prototype.destroy=function(){return this.thread&&this.thread.stop(),this};var j8=function(t,r,n){for(var i=n.eles.edges(),s=n.eles.nodes(),u=ta(n.boundingBox?n.boundingBox:{x1:0,y1:0,w:t.width(),h:t.height()}),a={isCompound:t.hasCompoundNodes(),layoutNodes:[],idToIndex:{},nodeSize:s.size(),graphSet:[],indexToGraph:[],layoutEdges:[],edgeSize:i.size(),temperature:n.initialTemp,clientWidth:u.w,clientHeight:u.h,boundingBox:u},d=n.eles.components(),p={},g=0;g<d.length;g++)for(var v=d[g],_=0;_<v.length;_++){var b=v[_];p[b.id()]=g}for(var g=0;g<a.nodeSize;g++){var k=s[g],A=k.layoutDimensions(n),M={};M.isLocked=k.locked(),M.id=k.data("id"),M.parentId=k.data("parent"),M.cmptId=p[k.id()],M.children=[],M.positionX=k.position("x"),M.positionY=k.position("y"),M.offsetX=0,M.offsetY=0,M.height=A.w,M.width=A.h,M.maxX=M.positionX+M.width/2,M.minX=M.positionX-M.width/2,M.maxY=M.positionY+M.height/2,M.minY=M.positionY-M.height/2,M.padLeft=parseFloat(k.style("padding")),M.padRight=parseFloat(k.style("padding")),M.padTop=parseFloat(k.style("padding")),M.padBottom=parseFloat(k.style("padding")),M.nodeRepulsion=Cn(n.nodeRepulsion)?n.nodeRepulsion(k):n.nodeRepulsion,a.layoutNodes.push(M),a.idToIndex[M.id]=g}for(var P=[],I=0,z=-1,O=[],g=0;g<a.nodeSize;g++){var k=a.layoutNodes[g],V=k.parentId;V!=null?a.layoutNodes[a.idToIndex[V]].children.push(k.id):(P[++z]=k.id,O.push(k.id))}for(a.graphSet.push(O);I<=z;){var U=P[I++],$=a.idToIndex[U],b=a.layoutNodes[$],G=b.children;if(G.length>0){a.graphSet.push(G);for(var g=0;g<G.length;g++)P[++z]=G[g]}}for(var g=0;g<a.graphSet.length;g++)for(var Z=a.graphSet[g],_=0;_<Z.length;_++){var Q=a.idToIndex[Z[_]];a.indexToGraph[Q]=g}for(var g=0;g<a.edgeSize;g++){var X=i[g],ie={};ie.id=X.data("id"),ie.sourceId=X.data("source"),ie.targetId=X.data("target");var te=Cn(n.idealEdgeLength)?n.idealEdgeLength(X):n.idealEdgeLength,W=Cn(n.edgeElasticity)?n.edgeElasticity(X):n.edgeElasticity,oe=a.idToIndex[ie.sourceId],se=a.idToIndex[ie.targetId],de=a.indexToGraph[oe],me=a.indexToGraph[se];if(de!=me){for(var ae=$8(ie.sourceId,ie.targetId,a),ve=a.graphSet[ae],pe=0,M=a.layoutNodes[oe];ve.indexOf(M.id)===-1;)M=a.layoutNodes[a.idToIndex[M.parentId]],pe++;for(M=a.layoutNodes[se];ve.indexOf(M.id)===-1;)M=a.layoutNodes[a.idToIndex[M.parentId]],pe++;te*=pe*n.nestingFactor}ie.idealLength=te,ie.elasticity=W,a.layoutEdges.push(ie)}return a},$8=function(t,r,n){var i=Rz(t,r,0,n);return 2>i.count?0:i.graph},Rz=function(t,r,n,i){var s=i.graphSet[n];if(-1<s.indexOf(t)&&-1<s.indexOf(r))return{count:2,graph:n};for(var u=0,a=0;a<s.length;a++){var d=s[a],p=i.idToIndex[d],g=i.layoutNodes[p].children;if(g.length!==0){var v=i.indexToGraph[i.idToIndex[g[0]]],_=Rz(t,r,v,i);if(_.count!==0)if(_.count===1){if(u++,u===2)break}else return _}}return{count:u,graph:n}},V8,U8=function(t,r){for(var n=t.clientWidth,i=t.clientHeight,s=0;s<t.nodeSize;s++){var u=t.layoutNodes[s];u.children.length===0&&!u.isLocked&&(u.positionX=Math.random()*n,u.positionY=Math.random()*i)}},Lz=function(t,r,n){var i=t.boundingBox,s={x1:1/0,x2:-1/0,y1:1/0,y2:-1/0};return r.boundingBox&&(n.forEach(function(u){var a=t.layoutNodes[t.idToIndex[u.data("id")]];s.x1=Math.min(s.x1,a.positionX),s.x2=Math.max(s.x2,a.positionX),s.y1=Math.min(s.y1,a.positionY),s.y2=Math.max(s.y2,a.positionY)}),s.w=s.x2-s.x1,s.h=s.y2-s.y1),function(u,a){var d=t.layoutNodes[t.idToIndex[u.data("id")]];if(r.boundingBox){var p=s.w===0?.5:(d.positionX-s.x1)/s.w,g=s.h===0?.5:(d.positionY-s.y1)/s.h;return{x:i.x1+p*i.w,y:i.y1+g*i.h}}else return{x:d.positionX,y:d.positionY}}},q8=function(t,r,n){var i=n.layout,s=n.eles.nodes(),u=Lz(t,n,s);s.positions(u),t.ready!==!0&&(t.ready=!0,i.one("layoutready",n.ready),i.emit({type:"layoutready",layout:this}))},H8=function(t,r,n){G8(t,r),X8(t),K8(t,r),Y8(t),J8(t)},G8=function(t,r){for(var n=0;n<t.graphSet.length;n++)for(var i=t.graphSet[n],s=i.length,u=0;u<s;u++)for(var a=t.layoutNodes[t.idToIndex[i[u]]],d=u+1;d<s;d++){var p=t.layoutNodes[t.idToIndex[i[d]]];W8(a,p,t,r)}},vI=function(t){return-1+2*t*Math.random()},W8=function(t,r,n,i){var s=t.cmptId,u=r.cmptId;if(!(s!==u&&!n.isCompound)){var a=r.positionX-t.positionX,d=r.positionY-t.positionY,p=1;a===0&&d===0&&(a=vI(p),d=vI(p));var g=Z8(t,r,a,d);if(g>0)var v=i.nodeOverlap*g,_=Math.sqrt(a*a+d*d),b=v*a/_,k=v*d/_;else var A=Yy(t,a,d),M=Yy(r,-1*a,-1*d),P=M.x-A.x,I=M.y-A.y,z=P*P+I*I,_=Math.sqrt(z),v=(t.nodeRepulsion+r.nodeRepulsion)/z,b=v*P/_,k=v*I/_;t.isLocked||(t.offsetX-=b,t.offsetY-=k),r.isLocked||(r.offsetX+=b,r.offsetY+=k)}},Z8=function(t,r,n,i){if(n>0)var s=t.maxX-r.minX;else var s=r.maxX-t.minX;if(i>0)var u=t.maxY-r.minY;else var u=r.maxY-t.minY;return s>=0&&u>=0?Math.sqrt(s*s+u*u):0},Yy=function(t,r,n){var i=t.positionX,s=t.positionY,u=t.height||1,a=t.width||1,d=n/r,p=u/a,g={};return r===0&&0<n||r===0&&0>n?(g.x=i,g.y=s+u/2,g):0<r&&-1*p<=d&&d<=p?(g.x=i+a/2,g.y=s+a*n/2/r,g):0>r&&-1*p<=d&&d<=p?(g.x=i-a/2,g.y=s-a*n/2/r,g):0<n&&(d<=-1*p||d>=p)?(g.x=i+u*r/2/n,g.y=s+u/2,g):(0>n&&(d<=-1*p||d>=p)&&(g.x=i-u*r/2/n,g.y=s-u/2),g)},X8=function(t,r){for(var n=0;n<t.edgeSize;n++){var i=t.layoutEdges[n],s=t.idToIndex[i.sourceId],u=t.layoutNodes[s],a=t.idToIndex[i.targetId],d=t.layoutNodes[a],p=d.positionX-u.positionX,g=d.positionY-u.positionY;if(!(p===0&&g===0)){var v=Yy(u,p,g),_=Yy(d,-1*p,-1*g),b=_.x-v.x,k=_.y-v.y,A=Math.sqrt(b*b+k*k),M=Math.pow(i.idealLength-A,2)/i.elasticity;if(A!==0)var P=M*b/A,I=M*k/A;else var P=0,I=0;u.isLocked||(u.offsetX+=P,u.offsetY+=I),d.isLocked||(d.offsetX-=P,d.offsetY-=I)}}},K8=function(t,r){if(r.gravity!==0)for(var n=1,i=0;i<t.graphSet.length;i++){var s=t.graphSet[i],u=s.length;if(i===0)var a=t.clientHeight/2,d=t.clientWidth/2;else var p=t.layoutNodes[t.idToIndex[s[0]]],g=t.layoutNodes[t.idToIndex[p.parentId]],a=g.positionX,d=g.positionY;for(var v=0;v<u;v++){var _=t.layoutNodes[t.idToIndex[s[v]]];if(!_.isLocked){var b=a-_.positionX,k=d-_.positionY,A=Math.sqrt(b*b+k*k);if(A>n){var M=r.gravity*b/A,P=r.gravity*k/A;_.offsetX+=M,_.offsetY+=P}}}}},Y8=function(t,r){var n=[],i=0,s=-1;for(n.push.apply(n,t.graphSet[0]),s+=t.graphSet[0].length;i<=s;){var u=n[i++],a=t.idToIndex[u],d=t.layoutNodes[a],p=d.children;if(0<p.length&&!d.isLocked){for(var g=d.offsetX,v=d.offsetY,_=0;_<p.length;_++){var b=t.layoutNodes[t.idToIndex[p[_]]];b.offsetX+=g,b.offsetY+=v,n[++s]=p[_]}d.offsetX=0,d.offsetY=0}}},J8=function(t,r){for(var n=0;n<t.nodeSize;n++){var i=t.layoutNodes[n];0<i.children.length&&(i.maxX=void 0,i.minX=void 0,i.maxY=void 0,i.minY=void 0)}for(var n=0;n<t.nodeSize;n++){var i=t.layoutNodes[n];if(!(0<i.children.length||i.isLocked)){var s=Q8(i.offsetX,i.offsetY,t.temperature);i.positionX+=s.x,i.positionY+=s.y,i.offsetX=0,i.offsetY=0,i.minX=i.positionX-i.width,i.maxX=i.positionX+i.width,i.minY=i.positionY-i.height,i.maxY=i.positionY+i.height,Bz(i,t)}}for(var n=0;n<t.nodeSize;n++){var i=t.layoutNodes[n];0<i.children.length&&!i.isLocked&&(i.positionX=(i.maxX+i.minX)/2,i.positionY=(i.maxY+i.minY)/2,i.width=i.maxX-i.minX,i.height=i.maxY-i.minY)}},Q8=function(t,r,n){var i=Math.sqrt(t*t+r*r);if(i>n)var s={x:n*t/i,y:n*r/i};else var s={x:t,y:r};return s},Bz=function(t,r){var n=t.parentId;if(n!=null){var i=r.layoutNodes[r.idToIndex[n]],s=!1;if((i.maxX==null||t.maxX+i.padRight>i.maxX)&&(i.maxX=t.maxX+i.padRight,s=!0),(i.minX==null||t.minX-i.padLeft<i.minX)&&(i.minX=t.minX-i.padLeft,s=!0),(i.maxY==null||t.maxY+i.padBottom>i.maxY)&&(i.maxY=t.maxY+i.padBottom,s=!0),(i.minY==null||t.minY-i.padTop<i.minY)&&(i.minY=t.minY-i.padTop,s=!0),s)return Bz(i,r)}},yI=function(t,r){for(var n=t.layoutNodes,i=[],s=0;s<n.length;s++){var u=n[s],a=u.cmptId,d=i[a]=i[a]||[];d.push(u)}for(var p=0,s=0;s<i.length;s++){var g=i[s];if(g){g.x1=1/0,g.x2=-1/0,g.y1=1/0,g.y2=-1/0;for(var v=0;v<g.length;v++){var _=g[v];g.x1=Math.min(g.x1,_.positionX-_.width/2),g.x2=Math.max(g.x2,_.positionX+_.width/2),g.y1=Math.min(g.y1,_.positionY-_.height/2),g.y2=Math.max(g.y2,_.positionY+_.height/2)}g.w=g.x2-g.x1,g.h=g.y2-g.y1,p+=g.w*g.h}}i.sort(function(I,z){return z.w*z.h-I.w*I.h});for(var b=0,k=0,A=0,M=0,P=Math.sqrt(p)*t.clientWidth/t.clientHeight,s=0;s<i.length;s++){var g=i[s];if(g){for(var v=0;v<g.length;v++){var _=g[v];_.isLocked||(_.positionX+=b-g.x1,_.positionY+=k-g.y1)}b+=g.w+r.componentSpacing,A+=g.w+r.componentSpacing,M=Math.max(M,g.h),A>P&&(k+=M+r.componentSpacing,b=0,A=0,M=0)}}},eU={fit:!0,padding:30,boundingBox:void 0,avoidOverlap:!0,avoidOverlapPadding:10,nodeDimensionsIncludeLabels:!1,spacingFactor:void 0,condense:!1,rows:void 0,cols:void 0,position:function(t){},sort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(t,r){return!0},ready:void 0,stop:void 0,transform:function(t,r){return r}};function Oz(e){this.options=dr({},eU,e)}Oz.prototype.run=function(){var e=this.options,t=e,r=e.cy,n=t.eles,i=n.nodes().not(":parent");t.sort&&(i=i.sort(t.sort));var s=ta(t.boundingBox?t.boundingBox:{x1:0,y1:0,w:r.width(),h:r.height()});if(s.h===0||s.w===0)n.nodes().layoutPositions(this,t,function(De){return{x:s.x1,y:s.y1}});else{var u=i.size(),a=Math.sqrt(u*s.h/s.w),d=Math.round(a),p=Math.round(s.w/s.h*a),g=function(Le){if(Le==null)return Math.min(d,p);var je=Math.min(d,p);je==d?d=Le:p=Le},v=function(Le){if(Le==null)return Math.max(d,p);var je=Math.max(d,p);je==d?d=Le:p=Le},_=t.rows,b=t.cols!=null?t.cols:t.columns;if(_!=null&&b!=null)d=_,p=b;else if(_!=null&&b==null)d=_,p=Math.ceil(u/d);else if(_==null&&b!=null)p=b,d=Math.ceil(u/p);else if(p*d>u){var k=g(),A=v();(k-1)*A>=u?g(k-1):(A-1)*k>=u&&v(A-1)}else for(;p*d<u;){var M=g(),P=v();(P+1)*M>=u?v(P+1):g(M+1)}var I=s.w/p,z=s.h/d;if(t.condense&&(I=0,z=0),t.avoidOverlap)for(var O=0;O<i.length;O++){var V=i[O],U=V._private.position;(U.x==null||U.y==null)&&(U.x=0,U.y=0);var $=V.layoutDimensions(t),G=t.avoidOverlapPadding,Z=$.w+G,Q=$.h+G;I=Math.max(I,Z),z=Math.max(z,Q)}for(var X={},ie=function(Le,je){return!!X["c-"+Le+"-"+je]},te=function(Le,je){X["c-"+Le+"-"+je]=!0},W=0,oe=0,se=function(){oe++,oe>=p&&(oe=0,W++)},de={},me=0;me<i.length;me++){var ae=i[me],ve=t.position(ae);if(ve&&(ve.row!==void 0||ve.col!==void 0)){var pe={row:ve.row,col:ve.col};if(pe.col===void 0)for(pe.col=0;ie(pe.row,pe.col);)pe.col++;else if(pe.row===void 0)for(pe.row=0;ie(pe.row,pe.col);)pe.row++;de[ae.id()]=pe,te(pe.row,pe.col)}}var _e=function(Le,je){var Je,et;if(Le.locked()||Le.isParent())return!1;var ft=de[Le.id()];if(ft)Je=ft.col*I+I/2+s.x1,et=ft.row*z+z/2+s.y1;else{for(;ie(W,oe);)se();Je=oe*I+I/2+s.x1,et=W*z+z/2+s.y1,te(W,oe),se()}return{x:Je,y:et}};i.layoutPositions(this,t,_e)}return this};var tU={ready:function(){},stop:function(){}};function BS(e){this.options=dr({},tU,e)}BS.prototype.run=function(){var e=this.options,t=e.eles,r=this;return e.cy,r.emit("layoutstart"),t.nodes().positions(function(){return{x:0,y:0}}),r.one("layoutready",e.ready),r.emit("layoutready"),r.one("layoutstop",e.stop),r.emit("layoutstop"),this};BS.prototype.stop=function(){return this};var rU={positions:void 0,zoom:void 0,pan:void 0,fit:!0,padding:30,spacingFactor:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(t,r){return!0},ready:void 0,stop:void 0,transform:function(t,r){return r}};function Fz(e){this.options=dr({},rU,e)}Fz.prototype.run=function(){var e=this.options,t=e.eles,r=t.nodes(),n=Cn(e.positions);function i(s){if(e.positions==null)return E6(s.position());if(n)return e.positions(s);var u=e.positions[s._private.data.id];return u??null}return r.layoutPositions(this,e,function(s,u){var a=i(s);return s.locked()||a==null?!1:a}),this};var nU={fit:!0,padding:30,boundingBox:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(t,r){return!0},ready:void 0,stop:void 0,transform:function(t,r){return r}};function jz(e){this.options=dr({},nU,e)}jz.prototype.run=function(){var e=this.options,t=e.cy,r=e.eles,n=ta(e.boundingBox?e.boundingBox:{x1:0,y1:0,w:t.width(),h:t.height()}),i=function(u,a){return{x:n.x1+Math.round(Math.random()*n.w),y:n.y1+Math.round(Math.random()*n.h)}};return r.nodes().layoutPositions(this,e,i),this};var iU=[{name:"breadthfirst",impl:Dz},{name:"circle",impl:Nz},{name:"concentric",impl:zz},{name:"cose",impl:K0},{name:"grid",impl:Oz},{name:"null",impl:BS},{name:"preset",impl:Fz},{name:"random",impl:jz}];function $z(e){this.options=e,this.notifications=0}var xI=function(){},_I=function(){throw new Error("A headless instance can not render images")};$z.prototype={recalculateRenderedStyle:xI,notify:function(){this.notifications++},init:xI,isHeadless:function(){return!0},png:_I,jpg:_I};var OS={};OS.arrowShapeWidth=.3;OS.registerArrowShapes=function(){var e=this.arrowShapes={},t=this,r=function(p,g,v,_,b,k,A){var M=b.x-v/2-A,P=b.x+v/2+A,I=b.y-v/2-A,z=b.y+v/2+A,O=M<=p&&p<=P&&I<=g&&g<=z;return O},n=function(p,g,v,_,b){var k=p*Math.cos(_)-g*Math.sin(_),A=p*Math.sin(_)+g*Math.cos(_),M=k*v,P=A*v,I=M+b.x,z=P+b.y;return{x:I,y:z}},i=function(p,g,v,_){for(var b=[],k=0;k<p.length;k+=2){var A=p[k],M=p[k+1];b.push(n(A,M,g,v,_))}return b},s=function(p){for(var g=[],v=0;v<p.length;v++){var _=p[v];g.push(_.x,_.y)}return g},u=function(p){return p.pstyle("width").pfValue*p.pstyle("arrow-scale").pfValue*2},a=function(p,g){sr(g)&&(g=e[g]),e[p]=dr({name:p,points:[-.15,-.3,.15,-.3,.15,.3,-.15,.3],collide:function(_,b,k,A,M,P){var I=s(i(this.points,k+2*P,A,M)),z=pa(_,b,I);return z},roughCollide:r,draw:function(_,b,k,A){var M=i(this.points,b,k,A);t.arrowShapeImpl("polygon")(_,M)},spacing:function(_){return 0},gap:u},g)};a("none",{collide:Hy,roughCollide:Hy,draw:SS,spacing:zk,gap:zk}),a("triangle",{points:[-.15,-.3,0,0,.15,-.3]}),a("arrow","triangle"),a("triangle-backcurve",{points:e.triangle.points,controlPoint:[0,-.15],roughCollide:r,draw:function(p,g,v,_,b){var k=i(this.points,g,v,_),A=this.controlPoint,M=n(A[0],A[1],g,v,_);t.arrowShapeImpl(this.name)(p,k,M)},gap:function(p){return u(p)*.8}}),a("triangle-tee",{points:[0,0,.15,-.3,-.15,-.3,0,0],pointsTee:[-.15,-.4,-.15,-.5,.15,-.5,.15,-.4],collide:function(p,g,v,_,b,k,A){var M=s(i(this.points,v+2*A,_,b)),P=s(i(this.pointsTee,v+2*A,_,b)),I=pa(p,g,M)||pa(p,g,P);return I},draw:function(p,g,v,_,b){var k=i(this.points,g,v,_),A=i(this.pointsTee,g,v,_);t.arrowShapeImpl(this.name)(p,k,A)}}),a("circle-triangle",{radius:.15,pointsTr:[0,-.15,.15,-.45,-.15,-.45,0,-.15],collide:function(p,g,v,_,b,k,A){var M=b,P=Math.pow(M.x-p,2)+Math.pow(M.y-g,2)<=Math.pow((v+2*A)*this.radius,2),I=s(i(this.points,v+2*A,_,b));return pa(p,g,I)||P},draw:function(p,g,v,_,b){var k=i(this.pointsTr,g,v,_);t.arrowShapeImpl(this.name)(p,k,_.x,_.y,this.radius*g)},spacing:function(p){return t.getArrowWidth(p.pstyle("width").pfValue,p.pstyle("arrow-scale").value)*this.radius}}),a("triangle-cross",{points:[0,0,.15,-.3,-.15,-.3,0,0],baseCrossLinePts:[-.15,-.4,-.15,-.4,.15,-.4,.15,-.4],crossLinePts:function(p,g){var v=this.baseCrossLinePts.slice(),_=g/p,b=3,k=5;return v[b]=v[b]-_,v[k]=v[k]-_,v},collide:function(p,g,v,_,b,k,A){var M=s(i(this.points,v+2*A,_,b)),P=s(i(this.crossLinePts(v,k),v+2*A,_,b)),I=pa(p,g,M)||pa(p,g,P);return I},draw:function(p,g,v,_,b){var k=i(this.points,g,v,_),A=i(this.crossLinePts(g,b),g,v,_);t.arrowShapeImpl(this.name)(p,k,A)}}),a("vee",{points:[-.15,-.3,0,0,.15,-.3,0,-.15],gap:function(p){return u(p)*.525}}),a("circle",{radius:.15,collide:function(p,g,v,_,b,k,A){var M=b,P=Math.pow(M.x-p,2)+Math.pow(M.y-g,2)<=Math.pow((v+2*A)*this.radius,2);return P},draw:function(p,g,v,_,b){t.arrowShapeImpl(this.name)(p,_.x,_.y,this.radius*g)},spacing:function(p){return t.getArrowWidth(p.pstyle("width").pfValue,p.pstyle("arrow-scale").value)*this.radius}}),a("tee",{points:[-.15,0,-.15,-.1,.15,-.1,.15,0],spacing:function(p){return 1},gap:function(p){return 1}}),a("square",{points:[-.15,0,.15,0,.15,-.3,-.15,-.3]}),a("diamond",{points:[-.15,-.15,0,-.3,.15,-.15,0,0],gap:function(p){return p.pstyle("width").pfValue*p.pstyle("arrow-scale").value}}),a("chevron",{points:[0,0,-.15,-.15,-.1,-.2,0,-.1,.1,-.2,.15,-.15],gap:function(p){return .95*p.pstyle("width").pfValue*p.pstyle("arrow-scale").value}})};var kc={};kc.projectIntoViewport=function(e,t){var r=this.cy,n=this.findContainerClientCoords(),i=n[0],s=n[1],u=n[4],a=r.pan(),d=r.zoom(),p=((e-i)/u-a.x)/d,g=((t-s)/u-a.y)/d;return[p,g]};kc.findContainerClientCoords=function(){if(this.containerBB)return this.containerBB;var e=this.container,t=e.getBoundingClientRect(),r=this.cy.window().getComputedStyle(e),n=function(P){return parseFloat(r.getPropertyValue(P))},i={left:n("padding-left"),right:n("padding-right"),top:n("padding-top"),bottom:n("padding-bottom")},s={left:n("border-left-width"),right:n("border-right-width"),top:n("border-top-width"),bottom:n("border-bottom-width")},u=e.clientWidth,a=e.clientHeight,d=i.left+i.right,p=i.top+i.bottom,g=s.left+s.right,v=t.width/(u+g),_=u-d,b=a-p,k=t.left+i.left+s.left,A=t.top+i.top+s.top;return this.containerBB=[k,A,_,b,v]};kc.invalidateContainerClientCoordsCache=function(){this.containerBB=null};kc.findNearestElement=function(e,t,r,n){return this.findNearestElements(e,t,r,n)[0]};kc.findNearestElements=function(e,t,r,n){var i=this,s=this,u=s.getCachedZSortedEles(),a=[],d=s.cy.zoom(),p=s.cy.hasCompoundNodes(),g=(n?24:8)/d,v=(n?8:2)/d,_=(n?8:2)/d,b=1/0,k,A;r&&(u=u.interactive);function M($,G){if($.isNode()){if(A)return;A=$,a.push($)}if($.isEdge()&&(G==null||G<b))if(k){if(k.pstyle("z-compound-depth").value===$.pstyle("z-compound-depth").value&&k.pstyle("z-compound-depth").value===$.pstyle("z-compound-depth").value){for(var Z=0;Z<a.length;Z++)if(a[Z].isEdge()){a[Z]=$,k=$,b=G??b;break}}}else a.push($),k=$,b=G??b}function P($){var G=$.outerWidth()+2*v,Z=$.outerHeight()+2*v,Q=G/2,X=Z/2,ie=$.position(),te=$.pstyle("corner-radius").value==="auto"?"auto":$.pstyle("corner-radius").pfValue,W=$._private.rscratch;if(ie.x-Q<=e&&e<=ie.x+Q&&ie.y-X<=t&&t<=ie.y+X){var oe=s.nodeShapes[i.getNodeShape($)];if(oe.checkPoint(e,t,0,G,Z,ie.x,ie.y,te,W))return M($,0),!0}}function I($){var G=$._private,Z=G.rscratch,Q=$.pstyle("width").pfValue,X=$.pstyle("arrow-scale").value,ie=Q/2+g,te=ie*ie,W=ie*2,me=G.source,ae=G.target,oe;if(Z.edgeType==="segments"||Z.edgeType==="straight"||Z.edgeType==="haystack"){for(var se=Z.allpts,de=0;de+3<se.length;de+=2)if(O6(e,t,se[de],se[de+1],se[de+2],se[de+3],W)&&te>(oe=U6(e,t,se[de],se[de+1],se[de+2],se[de+3])))return M($,oe),!0}else if(Z.edgeType==="bezier"||Z.edgeType==="multibezier"||Z.edgeType==="self"||Z.edgeType==="compound"){for(var se=Z.allpts,de=0;de+5<Z.allpts.length;de+=4)if(F6(e,t,se[de],se[de+1],se[de+2],se[de+3],se[de+4],se[de+5],W)&&te>(oe=V6(e,t,se[de],se[de+1],se[de+2],se[de+3],se[de+4],se[de+5])))return M($,oe),!0}for(var me=me||G.source,ae=ae||G.target,ve=i.getArrowWidth(Q,X),pe=[{name:"source",x:Z.arrowStartX,y:Z.arrowStartY,angle:Z.srcArrowAngle},{name:"target",x:Z.arrowEndX,y:Z.arrowEndY,angle:Z.tgtArrowAngle},{name:"mid-source",x:Z.midX,y:Z.midY,angle:Z.midsrcArrowAngle},{name:"mid-target",x:Z.midX,y:Z.midY,angle:Z.midtgtArrowAngle}],de=0;de<pe.length;de++){var _e=pe[de],De=s.arrowShapes[$.pstyle(_e.name+"-arrow-shape").value],Le=$.pstyle("width").pfValue;if(De.roughCollide(e,t,ve,_e.angle,{x:_e.x,y:_e.y},Le,g)&&De.collide(e,t,ve,_e.angle,{x:_e.x,y:_e.y},Le,g))return M($),!0}p&&a.length>0&&(P(me),P(ae))}function z($,G,Z){return fa($,G,Z)}function O($,G){var Z=$._private,Q=_,X;G?X=G+"-":X="",$.boundingBox();var ie=Z.labelBounds[G||"main"],te=$.pstyle(X+"label").value,W=$.pstyle("text-events").strValue==="yes";if(!(!W||!te)){var oe=z(Z.rscratch,"labelX",G),se=z(Z.rscratch,"labelY",G),de=z(Z.rscratch,"labelAngle",G),me=$.pstyle(X+"text-margin-x").pfValue,ae=$.pstyle(X+"text-margin-y").pfValue,ve=ie.x1-Q-me,pe=ie.x2+Q-me,_e=ie.y1-Q-ae,De=ie.y2+Q-ae;if(de){var Le=Math.cos(de),je=Math.sin(de),Je=function(it,mt){return it=it-oe,mt=mt-se,{x:it*Le-mt*je+oe,y:it*je+mt*Le+se}},et=Je(ve,_e),ft=Je(ve,De),rt=Je(pe,_e),Oe=Je(pe,De),Ge=[et.x+me,et.y+ae,rt.x+me,rt.y+ae,Oe.x+me,Oe.y+ae,ft.x+me,ft.y+ae];if(pa(e,t,Ge))return M($),!0}else if(jl(ie,e,t))return M($),!0}}for(var V=u.length-1;V>=0;V--){var U=u[V];U.isNode()?P(U)||O(U):I(U)||O(U)||O(U,"source")||O(U,"target")}return a};kc.getAllInBox=function(e,t,r,n){var i=this.getCachedZSortedEles().interactive,s=this.cy.zoom(),u=2/s,a=[],d=Math.min(e,r),p=Math.max(e,r),g=Math.min(t,n),v=Math.max(t,n);e=d,r=p,t=g,n=v;var _=ta({x1:e,y1:t,x2:r,y2:n}),b=[{x:_.x1,y:_.y1},{x:_.x2,y:_.y1},{x:_.x2,y:_.y2},{x:_.x1,y:_.y2}],k=[[b[0],b[1]],[b[1],b[2]],[b[2],b[3]],[b[3],b[0]]];function A(it,mt,Tt){return fa(it,mt,Tt)}function M(it,mt){var Tt=it._private,$e=u,At="";it.boundingBox();var pt=Tt.labelBounds.main;if(!pt)return null;var yt=A(Tt.rscratch,"labelX",mt),gt=A(Tt.rscratch,"labelY",mt),qt=A(Tt.rscratch,"labelAngle",mt),$t=it.pstyle(At+"text-margin-x").pfValue,er=it.pstyle(At+"text-margin-y").pfValue,Vt=pt.x1-$e-$t,tr=pt.x2+$e-$t,pr=pt.y1-$e-er,vr=pt.y2+$e-er;if(qt){var lt=Math.cos(qt),mr=Math.sin(qt),Ht=function(at,le){return at=at-yt,le=le-gt,{x:at*lt-le*mr+yt,y:at*mr+le*lt+gt}};return[Ht(Vt,pr),Ht(tr,pr),Ht(tr,vr),Ht(Vt,vr)]}else return[{x:Vt,y:pr},{x:tr,y:pr},{x:tr,y:vr},{x:Vt,y:vr}]}function P(it,mt,Tt,$e){function At(pt,yt,gt){return(gt.y-pt.y)*(yt.x-pt.x)>(yt.y-pt.y)*(gt.x-pt.x)}return At(it,Tt,$e)!==At(mt,Tt,$e)&&At(it,mt,Tt)!==At(it,mt,$e)}for(var I=0;I<i.length;I++){var z=i[I];if(z.isNode()){var O=z,V=O.pstyle("text-events").strValue==="yes",U=O.pstyle("box-selection").strValue,$=O.pstyle("box-select-labels").strValue==="yes";if(U==="none")continue;var G=(U==="overlap"||$)&&V,Z=O.boundingBox({includeNodes:!0,includeEdges:!1,includeLabels:G});if(U==="contain"){var Q=!1;if($&&V){var X=M(O);X&&yw(X,b)&&(a.push(O),Q=!0)}!Q&&ZN(_,Z)&&a.push(O)}else if(U==="overlap"&&kS(_,Z)){var ie=O.boundingBox({includeNodes:!0,includeEdges:!0,includeLabels:!1,includeMainLabels:!1,includeSourceLabels:!1,includeTargetLabels:!1}),te=[{x:ie.x1,y:ie.y1},{x:ie.x2,y:ie.y1},{x:ie.x2,y:ie.y2},{x:ie.x1,y:ie.y2}];if(yw(te,b))a.push(O);else{var W=M(O);W&&yw(W,b)&&a.push(O)}}}else{var oe=z,se=oe._private,de=se.rscratch,me=oe.pstyle("box-selection").strValue;if(me==="none")continue;if(me==="contain"){if(de.startX!=null&&de.startY!=null&&!jl(_,de.startX,de.startY)||de.endX!=null&&de.endY!=null&&!jl(_,de.endX,de.endY))continue;if(de.edgeType==="bezier"||de.edgeType==="multibezier"||de.edgeType==="self"||de.edgeType==="compound"||de.edgeType==="segments"||de.edgeType==="haystack"){for(var ae=se.rstyle.bezierPts||se.rstyle.linePts||se.rstyle.haystackPts,ve=!0,pe=0;pe<ae.length;pe++)if(!Fk(_,ae[pe])){ve=!1;break}ve&&a.push(oe)}else de.edgeType==="straight"&&a.push(oe)}else if(me==="overlap"){var _e=!1;if(de.startX!=null&&de.startY!=null&&de.endX!=null&&de.endY!=null&&(jl(_,de.startX,de.startY)||jl(_,de.endX,de.endY)))a.push(oe),_e=!0;else if(!_e&&de.edgeType==="haystack"){for(var De=se.rstyle.haystackPts,Le=0;Le<De.length;Le++)if(Fk(_,De[Le])){a.push(oe),_e=!0;break}}if(!_e){var je=se.rstyle.bezierPts||se.rstyle.linePts||se.rstyle.haystackPts;if((!je||je.length<2)&&de.edgeType==="straight"&&de.startX!=null&&de.startY!=null&&de.endX!=null&&de.endY!=null&&(je=[{x:de.startX,y:de.startY},{x:de.endX,y:de.endY}]),!je||je.length<2)continue;for(var Je=0;Je<je.length-1;Je++){for(var et=je[Je],ft=je[Je+1],rt=0;rt<k.length;rt++){var Oe=Vn(k[rt],2),Ge=Oe[0],Ze=Oe[1];if(P(et,ft,Ge,Ze)){a.push(oe),_e=!0;break}}if(_e)break}}}}}return a};var Jy={};Jy.calculateArrowAngles=function(e){var t=e._private.rscratch,r=t.edgeType==="haystack",n=t.edgeType==="bezier",i=t.edgeType==="multibezier",s=t.edgeType==="segments",u=t.edgeType==="compound",a=t.edgeType==="self",d,p,g,v,_,b,P,I;if(r?(g=t.haystackPts[0],v=t.haystackPts[1],_=t.haystackPts[2],b=t.haystackPts[3]):(g=t.arrowStartX,v=t.arrowStartY,_=t.arrowEndX,b=t.arrowEndY),P=t.midX,I=t.midY,s)d=g-t.segpts[0],p=v-t.segpts[1];else if(i||u||a||n){var k=t.allpts,A=ci(k[0],k[2],k[4],.1),M=ci(k[1],k[3],k[5],.1);d=g-A,p=v-M}else d=g-P,p=v-I;t.srcArrowAngle=_v(d,p);var P=t.midX,I=t.midY;if(r&&(P=(g+_)/2,I=(v+b)/2),d=_-g,p=b-v,s){var k=t.allpts;if(k.length/2%2===0){var z=k.length/2,O=z-2;d=k[z]-k[O],p=k[z+1]-k[O+1]}else if(t.isRound)d=t.midVector[1],p=-t.midVector[0];else{var z=k.length/2-1,O=z-2;d=k[z]-k[O],p=k[z+1]-k[O+1]}}else if(i||u||a){var k=t.allpts,V=t.ctrlpts,U,$,G,Z;if(V.length/2%2===0){var Q=k.length/2-1,X=Q+2,ie=X+2;U=ci(k[Q],k[X],k[ie],0),$=ci(k[Q+1],k[X+1],k[ie+1],0),G=ci(k[Q],k[X],k[ie],1e-4),Z=ci(k[Q+1],k[X+1],k[ie+1],1e-4)}else{var X=k.length/2-1,Q=X-2,ie=X+2;U=ci(k[Q],k[X],k[ie],.4999),$=ci(k[Q+1],k[X+1],k[ie+1],.4999),G=ci(k[Q],k[X],k[ie],.5),Z=ci(k[Q+1],k[X+1],k[ie+1],.5)}d=G-U,p=Z-$}if(t.midtgtArrowAngle=_v(d,p),t.midDispX=d,t.midDispY=p,d*=-1,p*=-1,s){var k=t.allpts;if(k.length/2%2!==0){if(!t.isRound){var z=k.length/2-1,te=z+2;d=-(k[te]-k[z]),p=-(k[te+1]-k[z+1])}}}if(t.midsrcArrowAngle=_v(d,p),s)d=_-t.segpts[t.segpts.length-2],p=b-t.segpts[t.segpts.length-1];else if(i||u||a||n){var k=t.allpts,W=k.length,A=ci(k[W-6],k[W-4],k[W-2],.9),M=ci(k[W-5],k[W-3],k[W-1],.9);d=_-A,p=b-M}else d=_-P,p=b-I;t.tgtArrowAngle=_v(d,p)};Jy.getArrowWidth=Jy.getArrowHeight=function(e,t){var r=this.arrowWidthCache=this.arrowWidthCache||{},n=r[e+", "+t];return n||(n=Math.max(Math.pow(e*13.37,.9),29)*t,r[e+", "+t]=n,n)};var K1,Y1,Us={},Ya={},wI,bI,Yu,hy,_o,Vu,Zu,$s,Ah,Pv,Vz,Uz,J1,Q1,SI,EI=function(t,r,n){n.x=r.x-t.x,n.y=r.y-t.y,n.len=Math.sqrt(n.x*n.x+n.y*n.y),n.nx=n.x/n.len,n.ny=n.y/n.len,n.ang=Math.atan2(n.ny,n.nx)},aU=function(t,r){r.x=t.x*-1,r.y=t.y*-1,r.nx=t.nx*-1,r.ny=t.ny*-1,r.ang=t.ang>0?-(Math.PI-t.ang):Math.PI+t.ang},sU=function(t,r,n,i,s){if(t!==SI?EI(r,t,Us):aU(Ya,Us),EI(r,n,Ya),wI=Us.nx*Ya.ny-Us.ny*Ya.nx,bI=Us.nx*Ya.nx-Us.ny*-Ya.ny,_o=Math.asin(Math.max(-1,Math.min(1,wI))),Math.abs(_o)<1e-6){K1=r.x,Y1=r.y,Zu=Ah=0;return}Yu=1,hy=!1,bI<0?_o<0?_o=Math.PI+_o:(_o=Math.PI-_o,Yu=-1,hy=!0):_o>0&&(Yu=-1,hy=!0),r.radius!==void 0?Ah=r.radius:Ah=i,Vu=_o/2,Pv=Math.min(Us.len/2,Ya.len/2),s?($s=Math.abs(Math.cos(Vu)*Ah/Math.sin(Vu)),$s>Pv?($s=Pv,Zu=Math.abs($s*Math.sin(Vu)/Math.cos(Vu))):Zu=Ah):($s=Math.min(Pv,Ah),Zu=Math.abs($s*Math.sin(Vu)/Math.cos(Vu))),J1=r.x+Ya.nx*$s,Q1=r.y+Ya.ny*$s,K1=J1-Ya.ny*Zu*Yu,Y1=Q1+Ya.nx*Zu*Yu,Vz=r.x+Us.nx*$s,Uz=r.y+Us.ny*$s,SI=r};function qz(e,t){t.radius===0?e.lineTo(t.cx,t.cy):e.arc(t.cx,t.cy,t.radius,t.startAngle,t.endAngle,t.counterClockwise)}function FS(e,t,r,n){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;return n===0||t.radius===0?{cx:t.x,cy:t.y,radius:0,startX:t.x,startY:t.y,stopX:t.x,stopY:t.y,startAngle:void 0,endAngle:void 0,counterClockwise:void 0}:(sU(e,t,r,n,i),{cx:K1,cy:Y1,radius:Zu,startX:Vz,startY:Uz,stopX:J1,stopY:Q1,startAngle:Us.ang+Math.PI/2*Yu,endAngle:Ya.ang-Math.PI/2*Yu,counterClockwise:hy})}var mm=.01,oU=Math.sqrt(2*mm),Ui={};Ui.findMidptPtsEtc=function(e,t){var r=t.posPts,n=t.intersectionPts,i=t.vectorNormInverse,s,u=e.pstyle("source-endpoint"),a=e.pstyle("target-endpoint"),d=u.units!=null&&a.units!=null,p=function(V,U,$,G){var Z=G-U,Q=$-V,X=Math.sqrt(Q*Q+Z*Z);return{x:-Z/X,y:Q/X}},g=e.pstyle("edge-distances").value;switch(g){case"node-position":s=r;break;case"intersection":s=n;break;case"endpoints":{if(d){var v=this.manualEndptToPx(e.source()[0],u),_=Vn(v,2),b=_[0],k=_[1],A=this.manualEndptToPx(e.target()[0],a),M=Vn(A,2),P=M[0],I=M[1],z={x1:b,y1:k,x2:P,y2:I};i=p(b,k,P,I),s=z}else Gr("Edge ".concat(e.id()," has edge-distances:endpoints specified without manual endpoints specified via source-endpoint and target-endpoint.  Falling back on edge-distances:intersection (default).")),s=n;break}}return{midptPts:s,vectorNormInverse:i}};Ui.findHaystackPoints=function(e){for(var t=0;t<e.length;t++){var r=e[t],n=r._private,i=n.rscratch;if(!i.haystack){var s=Math.random()*2*Math.PI;i.source={x:Math.cos(s),y:Math.sin(s)},s=Math.random()*2*Math.PI,i.target={x:Math.cos(s),y:Math.sin(s)}}var u=n.source,a=n.target,d=u.position(),p=a.position(),g=u.width(),v=a.width(),_=u.height(),b=a.height(),k=r.pstyle("haystack-radius").value,A=k/2;i.haystackPts=i.allpts=[i.source.x*g*A+d.x,i.source.y*_*A+d.y,i.target.x*v*A+p.x,i.target.y*b*A+p.y],i.midX=(i.allpts[0]+i.allpts[2])/2,i.midY=(i.allpts[1]+i.allpts[3])/2,i.edgeType="haystack",i.haystack=!0,this.storeEdgeProjections(r),this.calculateArrowAngles(r),this.recalculateEdgeLabelProjections(r),this.calculateLabelAngles(r)}};Ui.findSegmentsPoints=function(e,t){var r=e._private.rscratch,n=e.pstyle("segment-weights"),i=e.pstyle("segment-distances"),s=e.pstyle("segment-radii"),u=e.pstyle("radius-type"),a=Math.min(n.pfValue.length,i.pfValue.length),d=s.pfValue[s.pfValue.length-1],p=u.pfValue[u.pfValue.length-1];r.edgeType="segments",r.segpts=[],r.radii=[],r.isArcRadius=[];for(var g=0;g<a;g++){var v=n.pfValue[g],_=i.pfValue[g],b=1-v,k=v,A=this.findMidptPtsEtc(e,t),M=A.midptPts,P=A.vectorNormInverse,I={x:M.x1*b+M.x2*k,y:M.y1*b+M.y2*k};r.segpts.push(I.x+P.x*_,I.y+P.y*_),r.radii.push(s.pfValue[g]!==void 0?s.pfValue[g]:d),r.isArcRadius.push((u.pfValue[g]!==void 0?u.pfValue[g]:p)==="arc-radius")}};Ui.findLoopPoints=function(e,t,r,n){var i=e._private.rscratch,s=t.dirCounts,u=t.srcPos,a=e.pstyle("control-point-distances"),d=a?a.pfValue[0]:void 0,p=e.pstyle("loop-direction").pfValue,g=e.pstyle("loop-sweep").pfValue,v=e.pstyle("control-point-step-size").pfValue;i.edgeType="self";var _=r,b=v;n&&(_=0,b=d);var k=p-Math.PI/2,A=k-g/2,M=k+g/2,P=p+"_"+g;_=s[P]===void 0?s[P]=0:++s[P],i.ctrlpts=[u.x+Math.cos(A)*1.4*b*(_/3+1),u.y+Math.sin(A)*1.4*b*(_/3+1),u.x+Math.cos(M)*1.4*b*(_/3+1),u.y+Math.sin(M)*1.4*b*(_/3+1)]};Ui.findCompoundLoopPoints=function(e,t,r,n){var i=e._private.rscratch;i.edgeType="compound";var s=t.srcPos,u=t.tgtPos,a=t.srcW,d=t.srcH,p=t.tgtW,g=t.tgtH,v=e.pstyle("control-point-step-size").pfValue,_=e.pstyle("control-point-distances"),b=_?_.pfValue[0]:void 0,k=r,A=v;n&&(k=0,A=b);var M=50,P={x:s.x-a/2,y:s.y-d/2},I={x:u.x-p/2,y:u.y-g/2},z={x:Math.min(P.x,I.x),y:Math.min(P.y,I.y)},O=.5,V=Math.max(O,Math.log(a*mm)),U=Math.max(O,Math.log(p*mm));i.ctrlpts=[z.x,z.y-(1+Math.pow(M,1.12)/100)*A*(k/3+1)*V,z.x-(1+Math.pow(M,1.12)/100)*A*(k/3+1)*U,z.y]};Ui.findStraightEdgePoints=function(e){e._private.rscratch.edgeType="straight"};Ui.findBezierPoints=function(e,t,r,n,i){var s=e._private.rscratch,u=e.pstyle("control-point-step-size").pfValue,a=e.pstyle("control-point-distances"),d=e.pstyle("control-point-weights"),p=a&&d?Math.min(a.value.length,d.value.length):1,g=a?a.pfValue[0]:void 0,v=d.value[0],_=n;s.edgeType=_?"multibezier":"bezier",s.ctrlpts=[];for(var b=0;b<p;b++){var k=(.5-t.eles.length/2+r)*u*(i?-1:1),A=void 0,M=CS(k);_&&(g=a?a.pfValue[b]:u,v=d.value[b]),n?A=g:A=g!==void 0?M*g:void 0;var P=A!==void 0?A:k,I=1-v,z=v,O=this.findMidptPtsEtc(e,t),V=O.midptPts,U=O.vectorNormInverse,$={x:V.x1*I+V.x2*z,y:V.y1*I+V.y2*z};s.ctrlpts.push($.x+U.x*P,$.y+U.y*P)}};Ui.findTaxiPoints=function(e,t){var r=e._private.rscratch;r.edgeType="segments";var n="vertical",i="horizontal",s="leftward",u="rightward",a="downward",d="upward",p="auto",g=t.posPts,v=t.srcW,_=t.srcH,b=t.tgtW,k=t.tgtH,A=e.pstyle("edge-distances").value,M=A!=="node-position",P=e.pstyle("taxi-direction").value,I=P,z=e.pstyle("taxi-turn"),O=z.units==="%",V=z.pfValue,U=V<0,$=e.pstyle("taxi-turn-min-distance").pfValue,G=M?(v+b)/2:0,Z=M?(_+k)/2:0,Q=g.x2-g.x1,X=g.y2-g.y1,ie=function(le,Be){return le>0?Math.max(le-Be,0):Math.min(le+Be,0)},te=ie(Q,G),W=ie(X,Z),oe=!1;I===p?P=Math.abs(te)>Math.abs(W)?i:n:I===d||I===a?(P=n,oe=!0):(I===s||I===u)&&(P=i,oe=!0);var se=P===n,de=se?W:te,me=se?X:Q,ae=CS(me),ve=!1;!(oe&&(O||U))&&(I===a&&me<0||I===d&&me>0||I===s&&me>0||I===u&&me<0)&&(ae*=-1,de=ae*Math.abs(de),ve=!0);var pe;if(O){var _e=V<0?1+V:V;pe=_e*de}else{var De=V<0?de:0;pe=De+V*ae}var Le=function(le){return Math.abs(le)<$||Math.abs(le)>=Math.abs(de)},je=Le(pe),Je=Le(Math.abs(de)-Math.abs(pe)),et=je||Je;if(et&&!ve)if(se){var ft=Math.abs(me)<=_/2,rt=Math.abs(Q)<=b/2;if(ft){var Oe=(g.x1+g.x2)/2,Ge=g.y1,Ze=g.y2;r.segpts=[Oe,Ge,Oe,Ze]}else if(rt){var it=(g.y1+g.y2)/2,mt=g.x1,Tt=g.x2;r.segpts=[mt,it,Tt,it]}else r.segpts=[g.x1,g.y2]}else{var $e=Math.abs(me)<=v/2,At=Math.abs(X)<=k/2;if($e){var pt=(g.y1+g.y2)/2,yt=g.x1,gt=g.x2;r.segpts=[yt,pt,gt,pt]}else if(At){var qt=(g.x1+g.x2)/2,$t=g.y1,er=g.y2;r.segpts=[qt,$t,qt,er]}else r.segpts=[g.x2,g.y1]}else if(se){var Vt=g.y1+pe+(M?_/2*ae:0),tr=g.x1,pr=g.x2;r.segpts=[tr,Vt,pr,Vt]}else{var vr=g.x1+pe+(M?v/2*ae:0),lt=g.y1,mr=g.y2;r.segpts=[vr,lt,vr,mr]}if(r.isRound){var Ht=e.pstyle("taxi-radius").value,wt=e.pstyle("radius-type").value[0]==="arc-radius";r.radii=new Array(r.segpts.length/2).fill(Ht),r.isArcRadius=new Array(r.segpts.length/2).fill(wt)}};Ui.tryToCorrectInvalidPoints=function(e,t){var r=e._private.rscratch;if(r.edgeType==="bezier"){var n=t.srcPos,i=t.tgtPos,s=t.srcW,u=t.srcH,a=t.tgtW,d=t.tgtH,p=t.srcShape,g=t.tgtShape,v=t.srcCornerRadius,_=t.tgtCornerRadius,b=t.srcRs,k=t.tgtRs,A=!Rt(r.startX)||!Rt(r.startY),M=!Rt(r.arrowStartX)||!Rt(r.arrowStartY),P=!Rt(r.endX)||!Rt(r.endY),I=!Rt(r.arrowEndX)||!Rt(r.arrowEndY),z=3,O=this.getArrowWidth(e.pstyle("width").pfValue,e.pstyle("arrow-scale").value)*this.arrowShapeWidth,V=z*O,U=vc({x:r.ctrlpts[0],y:r.ctrlpts[1]},{x:r.startX,y:r.startY}),$=U<V,G=vc({x:r.ctrlpts[0],y:r.ctrlpts[1]},{x:r.endX,y:r.endY}),Z=G<V,Q=!1;if(A||M||$){Q=!0;var X={x:r.ctrlpts[0]-n.x,y:r.ctrlpts[1]-n.y},ie=Math.sqrt(X.x*X.x+X.y*X.y),te={x:X.x/ie,y:X.y/ie},W=Math.max(s,u),oe={x:r.ctrlpts[0]+te.x*2*W,y:r.ctrlpts[1]+te.y*2*W},se=p.intersectLine(n.x,n.y,s,u,oe.x,oe.y,0,v,b);$?(r.ctrlpts[0]=r.ctrlpts[0]+te.x*(V-U),r.ctrlpts[1]=r.ctrlpts[1]+te.y*(V-U)):(r.ctrlpts[0]=se[0]+te.x*V,r.ctrlpts[1]=se[1]+te.y*V)}if(P||I||Z){Q=!0;var de={x:r.ctrlpts[0]-i.x,y:r.ctrlpts[1]-i.y},me=Math.sqrt(de.x*de.x+de.y*de.y),ae={x:de.x/me,y:de.y/me},ve=Math.max(s,u),pe={x:r.ctrlpts[0]+ae.x*2*ve,y:r.ctrlpts[1]+ae.y*2*ve},_e=g.intersectLine(i.x,i.y,a,d,pe.x,pe.y,0,_,k);Z?(r.ctrlpts[0]=r.ctrlpts[0]+ae.x*(V-G),r.ctrlpts[1]=r.ctrlpts[1]+ae.y*(V-G)):(r.ctrlpts[0]=_e[0]+ae.x*V,r.ctrlpts[1]=_e[1]+ae.y*V)}Q&&this.findEndpoints(e)}};Ui.storeAllpts=function(e){var t=e._private.rscratch;if(t.edgeType==="multibezier"||t.edgeType==="bezier"||t.edgeType==="self"||t.edgeType==="compound"){t.allpts=[],t.allpts.push(t.startX,t.startY);for(var r=0;r+1<t.ctrlpts.length;r+=2)t.allpts.push(t.ctrlpts[r],t.ctrlpts[r+1]),r+3<t.ctrlpts.length&&t.allpts.push((t.ctrlpts[r]+t.ctrlpts[r+2])/2,(t.ctrlpts[r+1]+t.ctrlpts[r+3])/2);t.allpts.push(t.endX,t.endY);var n,i;t.ctrlpts.length/2%2===0?(n=t.allpts.length/2-1,t.midX=t.allpts[n],t.midY=t.allpts[n+1]):(n=t.allpts.length/2-3,i=.5,t.midX=ci(t.allpts[n],t.allpts[n+2],t.allpts[n+4],i),t.midY=ci(t.allpts[n+1],t.allpts[n+3],t.allpts[n+5],i))}else if(t.edgeType==="straight")t.allpts=[t.startX,t.startY,t.endX,t.endY],t.midX=(t.startX+t.endX+t.arrowStartX+t.arrowEndX)/4,t.midY=(t.startY+t.endY+t.arrowStartY+t.arrowEndY)/4;else if(t.edgeType==="segments"){if(t.allpts=[],t.allpts.push(t.startX,t.startY),t.allpts.push.apply(t.allpts,t.segpts),t.allpts.push(t.endX,t.endY),t.isRound){t.roundCorners=[];for(var s=2;s+3<t.allpts.length;s+=2){var u=t.radii[s/2-1],a=t.isArcRadius[s/2-1];t.roundCorners.push(FS({x:t.allpts[s-2],y:t.allpts[s-1]},{x:t.allpts[s],y:t.allpts[s+1],radius:u},{x:t.allpts[s+2],y:t.allpts[s+3]},u,a))}}if(t.segpts.length%4===0){var d=t.segpts.length/2,p=d-2;t.midX=(t.segpts[p]+t.segpts[d])/2,t.midY=(t.segpts[p+1]+t.segpts[d+1])/2}else{var g=t.segpts.length/2-1;if(!t.isRound)t.midX=t.segpts[g],t.midY=t.segpts[g+1];else{var v={x:t.segpts[g],y:t.segpts[g+1]},_=t.roundCorners[g/2];if(_.radius===0){var b={x:t.segpts[g+2],y:t.segpts[g+3]};t.midX=v.x,t.midY=v.y,t.midVector=[v.y-b.y,b.x-v.x]}else{var k=[v.x-_.cx,v.y-_.cy],A=_.radius/Math.sqrt(Math.pow(k[0],2)+Math.pow(k[1],2));k=k.map(function(M){return M*A}),t.midX=_.cx+k[0],t.midY=_.cy+k[1],t.midVector=k}}}}};Ui.checkForInvalidEdgeWarning=function(e){var t=e[0]._private.rscratch;t.nodesOverlap||Rt(t.startX)&&Rt(t.startY)&&Rt(t.endX)&&Rt(t.endY)?t.loggedErr=!1:t.loggedErr||(t.loggedErr=!0,Gr("Edge `"+e.id()+"` has invalid endpoints and so it is impossible to draw.  Adjust your edge style (e.g. control points) accordingly or use an alternative edge type.  This is expected behaviour when the source node and the target node overlap."))};Ui.findEdgeControlPoints=function(e){var t=this;if(!(!e||e.length===0)){for(var r=this,n=r.cy,i=n.hasCompoundNodes(),s=new Po,u=function(Z,Q){return[].concat(Vy(Z),[Q?1:0]).join("-")},a=[],d=[],p=0;p<e.length;p++){var g=e[p],v=g._private,_=g.pstyle("curve-style").value;if(!(g.removed()||!g.takesUpSpace())){if(_==="haystack"){d.push(g);continue}var b=_==="unbundled-bezier"||Fl(_,"segments")||_==="straight"||_==="straight-triangle"||Fl(_,"taxi"),k=_==="unbundled-bezier"||_==="bezier",A=v.source,M=v.target,P=A.poolIndex(),I=M.poolIndex(),z=[P,I].sort(),O=u(z,b),V=s.get(O);V==null&&(V={eles:[]},a.push({pairId:z,edgeIsUnbundled:b}),s.set(O,V)),V.eles.push(g),b&&(V.hasUnbundled=!0),k&&(V.hasBezier=!0)}}for(var U=function(){var Z=a[$],Q=Z.pairId,X=Z.edgeIsUnbundled,ie=u(Q,X),te=s.get(ie),W;if(!te.hasUnbundled){var oe=te.eles[0].parallelEdges().filter(function(wt){return wt.isBundledBezier()});ES(te.eles),oe.forEach(function(wt){return te.eles.push(wt)}),te.eles.sort(function(wt,at){return wt.poolIndex()-at.poolIndex()})}var se=te.eles[0],de=se.source(),me=se.target();if(de.poolIndex()>me.poolIndex()){var ae=de;de=me,me=ae}var ve=te.srcPos=de.position(),pe=te.tgtPos=me.position(),_e=te.srcW=de.outerWidth(),De=te.srcH=de.outerHeight(),Le=te.tgtW=me.outerWidth(),je=te.tgtH=me.outerHeight(),Je=te.srcShape=r.nodeShapes[t.getNodeShape(de)],et=te.tgtShape=r.nodeShapes[t.getNodeShape(me)],ft=te.srcCornerRadius=de.pstyle("corner-radius").value==="auto"?"auto":de.pstyle("corner-radius").pfValue,rt=te.tgtCornerRadius=me.pstyle("corner-radius").value==="auto"?"auto":me.pstyle("corner-radius").pfValue,Oe=te.tgtRs=me._private.rscratch,Ge=te.srcRs=de._private.rscratch;te.dirCounts={north:0,west:0,south:0,east:0,northwest:0,southwest:0,northeast:0,southeast:0};for(var Ze=0;Ze<te.eles.length;Ze++){var it=te.eles[Ze],mt=it[0]._private.rscratch,Tt=it.pstyle("curve-style").value,$e=Tt==="unbundled-bezier"||Fl(Tt,"segments")||Fl(Tt,"taxi"),At=!de.same(it.source());if(!te.calculatedIntersection&&de!==me&&(te.hasBezier||te.hasUnbundled)){te.calculatedIntersection=!0;var pt=Je.intersectLine(ve.x,ve.y,_e,De,pe.x,pe.y,0,ft,Ge),yt=te.srcIntn=pt,gt=et.intersectLine(pe.x,pe.y,Le,je,ve.x,ve.y,0,rt,Oe),qt=te.tgtIntn=gt,$t=te.intersectionPts={x1:pt[0],x2:gt[0],y1:pt[1],y2:gt[1]},er=te.posPts={x1:ve.x,x2:pe.x,y1:ve.y,y2:pe.y},Vt=gt[1]-pt[1],tr=gt[0]-pt[0],pr=Math.sqrt(tr*tr+Vt*Vt);Rt(pr)&&pr>=oU||(pr=Math.sqrt(Math.max(tr*tr,mm)+Math.max(Vt*Vt,mm)));var vr=te.vector={x:tr,y:Vt},lt=te.vectorNorm={x:vr.x/pr,y:vr.y/pr},mr={x:-lt.y,y:lt.x};te.nodesOverlap=!Rt(pr)||et.checkPoint(pt[0],pt[1],0,Le,je,pe.x,pe.y,rt,Oe)||Je.checkPoint(gt[0],gt[1],0,_e,De,ve.x,ve.y,ft,Ge),te.vectorNormInverse=mr,W={nodesOverlap:te.nodesOverlap,dirCounts:te.dirCounts,calculatedIntersection:!0,hasBezier:te.hasBezier,hasUnbundled:te.hasUnbundled,eles:te.eles,srcPos:pe,srcRs:Oe,tgtPos:ve,tgtRs:Ge,srcW:Le,srcH:je,tgtW:_e,tgtH:De,srcIntn:qt,tgtIntn:yt,srcShape:et,tgtShape:Je,posPts:{x1:er.x2,y1:er.y2,x2:er.x1,y2:er.y1},intersectionPts:{x1:$t.x2,y1:$t.y2,x2:$t.x1,y2:$t.y1},vector:{x:-vr.x,y:-vr.y},vectorNorm:{x:-lt.x,y:-lt.y},vectorNormInverse:{x:-mr.x,y:-mr.y}}}var Ht=At?W:te;mt.nodesOverlap=Ht.nodesOverlap,mt.srcIntn=Ht.srcIntn,mt.tgtIntn=Ht.tgtIntn,mt.isRound=Tt.startsWith("round"),i&&(de.isParent()||de.isChild()||me.isParent()||me.isChild())&&(de.parents().anySame(me)||me.parents().anySame(de)||de.same(me)&&de.isParent())?t.findCompoundLoopPoints(it,Ht,Ze,$e):de===me?t.findLoopPoints(it,Ht,Ze,$e):Tt.endsWith("segments")?t.findSegmentsPoints(it,Ht):Tt.endsWith("taxi")?t.findTaxiPoints(it,Ht):Tt==="straight"||!$e&&te.eles.length%2===1&&Ze===Math.floor(te.eles.length/2)?t.findStraightEdgePoints(it):t.findBezierPoints(it,Ht,Ze,$e,At),t.findEndpoints(it),t.tryToCorrectInvalidPoints(it,Ht),t.checkForInvalidEdgeWarning(it),t.storeAllpts(it),t.storeEdgeProjections(it),t.calculateArrowAngles(it),t.recalculateEdgeLabelProjections(it),t.calculateLabelAngles(it)}},$=0;$<a.length;$++)U();this.findHaystackPoints(d)}};function Hz(e){var t=[];if(e!=null){for(var r=0;r<e.length;r+=2){var n=e[r],i=e[r+1];t.push({x:n,y:i})}return t}}Ui.getSegmentPoints=function(e){var t=e[0]._private.rscratch;this.recalculateRenderedStyle(e);var r=t.edgeType;if(r==="segments")return Hz(t.segpts)};Ui.getControlPoints=function(e){var t=e[0]._private.rscratch;this.recalculateRenderedStyle(e);var r=t.edgeType;if(r==="bezier"||r==="multibezier"||r==="self"||r==="compound")return Hz(t.ctrlpts)};Ui.getEdgeMidpoint=function(e){var t=e[0]._private.rscratch;return this.recalculateRenderedStyle(e),{x:t.midX,y:t.midY}};var Hm={};Hm.manualEndptToPx=function(e,t){var r=this,n=e.position(),i=e.outerWidth(),s=e.outerHeight(),u=e._private.rscratch;if(t.value.length===2){var a=[t.pfValue[0],t.pfValue[1]];return t.units[0]==="%"&&(a[0]=a[0]*i),t.units[1]==="%"&&(a[1]=a[1]*s),a[0]+=n.x,a[1]+=n.y,a}else{var d=t.pfValue[0];d=-Math.PI/2+d;var p=2*Math.max(i,s),g=[n.x+Math.cos(d)*p,n.y+Math.sin(d)*p];return r.nodeShapes[this.getNodeShape(e)].intersectLine(n.x,n.y,i,s,g[0],g[1],0,e.pstyle("corner-radius").value==="auto"?"auto":e.pstyle("corner-radius").pfValue,u)}};Hm.findEndpoints=function(e){var t,r,n,i,s=this,u,a=e.source()[0],d=e.target()[0],p=a.position(),g=d.position(),v=e.pstyle("target-arrow-shape").value,_=e.pstyle("source-arrow-shape").value,b=e.pstyle("target-distance-from-node").pfValue,k=e.pstyle("source-distance-from-node").pfValue,A=a._private.rscratch,M=d._private.rscratch,P=e.pstyle("curve-style").value,I=e._private.rscratch,z=I.edgeType,O=Fl(P,"taxi"),V=z==="self"||z==="compound",U=z==="bezier"||z==="multibezier"||V,$=z!=="bezier",G=z==="straight"||z==="segments",Z=z==="segments",Q=U||$||G,X=V||O,ie=e.pstyle("source-endpoint"),te=X?"outside-to-node":ie.value,W=a.pstyle("corner-radius").value==="auto"?"auto":a.pstyle("corner-radius").pfValue,oe=e.pstyle("target-endpoint"),se=X?"outside-to-node":oe.value,de=d.pstyle("corner-radius").value==="auto"?"auto":d.pstyle("corner-radius").pfValue;I.srcManEndpt=ie,I.tgtManEndpt=oe;var me,ae,ve,pe,_e=(t=(oe==null||(r=oe.pfValue)===null||r===void 0?void 0:r.length)===2?oe.pfValue:null)!==null&&t!==void 0?t:[0,0],De=(n=(ie==null||(i=ie.pfValue)===null||i===void 0?void 0:i.length)===2?ie.pfValue:null)!==null&&n!==void 0?n:[0,0];if(U){var Le=[I.ctrlpts[0],I.ctrlpts[1]],je=$?[I.ctrlpts[I.ctrlpts.length-2],I.ctrlpts[I.ctrlpts.length-1]]:Le;me=je,ae=Le}else if(G){var Je=Z?I.segpts.slice(0,2):[g.x+_e[0],g.y+_e[1]],et=Z?I.segpts.slice(I.segpts.length-2):[p.x+De[0],p.y+De[1]];me=et,ae=Je}if(se==="inside-to-node")u=[g.x,g.y];else if(oe.units)u=this.manualEndptToPx(d,oe);else if(se==="outside-to-line")u=I.tgtIntn;else if(se==="outside-to-node"||se==="outside-to-node-or-label"?ve=me:(se==="outside-to-line"||se==="outside-to-line-or-label")&&(ve=[p.x,p.y]),u=s.nodeShapes[this.getNodeShape(d)].intersectLine(g.x,g.y,d.outerWidth(),d.outerHeight(),ve[0],ve[1],0,de,M),se==="outside-to-node-or-label"||se==="outside-to-line-or-label"){var ft=d._private.rscratch,rt=ft.labelWidth,Oe=ft.labelHeight,Ge=ft.labelX,Ze=ft.labelY,it=rt/2,mt=Oe/2,Tt=d.pstyle("text-valign").value;Tt==="top"?Ze-=mt:Tt==="bottom"&&(Ze+=mt);var $e=d.pstyle("text-halign").value;$e==="left"?Ge-=it:$e==="right"&&(Ge+=it);var At=cm(ve[0],ve[1],[Ge-it,Ze-mt,Ge+it,Ze-mt,Ge+it,Ze+mt,Ge-it,Ze+mt],g.x,g.y);if(At.length>0){var pt=p,yt=Wu(pt,Jh(u)),gt=Wu(pt,Jh(At)),qt=yt;if(gt<yt&&(u=At,qt=gt),At.length>2){var $t=Wu(pt,{x:At[2],y:At[3]});$t<qt&&(u=[At[2],At[3]])}}}var er=wv(u,me,s.arrowShapes[v].spacing(e)+b),Vt=wv(u,me,s.arrowShapes[v].gap(e)+b);if(I.endX=Vt[0],I.endY=Vt[1],I.arrowEndX=er[0],I.arrowEndY=er[1],te==="inside-to-node")u=[p.x,p.y];else if(ie.units)u=this.manualEndptToPx(a,ie);else if(te==="outside-to-line")u=I.srcIntn;else if(te==="outside-to-node"||te==="outside-to-node-or-label"?pe=ae:(te==="outside-to-line"||te==="outside-to-line-or-label")&&(pe=[g.x,g.y]),u=s.nodeShapes[this.getNodeShape(a)].intersectLine(p.x,p.y,a.outerWidth(),a.outerHeight(),pe[0],pe[1],0,W,A),te==="outside-to-node-or-label"||te==="outside-to-line-or-label"){var tr=a._private.rscratch,pr=tr.labelWidth,vr=tr.labelHeight,lt=tr.labelX,mr=tr.labelY,Ht=pr/2,wt=vr/2,at=a.pstyle("text-valign").value;at==="top"?mr-=wt:at==="bottom"&&(mr+=wt);var le=a.pstyle("text-halign").value;le==="left"?lt-=Ht:le==="right"&&(lt+=Ht);var Be=cm(pe[0],pe[1],[lt-Ht,mr-wt,lt+Ht,mr-wt,lt+Ht,mr+wt,lt-Ht,mr+wt],p.x,p.y);if(Be.length>0){var Ue=g,tt=Wu(Ue,Jh(u)),st=Wu(Ue,Jh(Be)),dt=tt;if(st<tt&&(u=[Be[0],Be[1]],dt=st),Be.length>2){var ht=Wu(Ue,{x:Be[2],y:Be[3]});ht<dt&&(u=[Be[2],Be[3]])}}}var Ot=wv(u,ae,s.arrowShapes[_].spacing(e)+k),Lt=wv(u,ae,s.arrowShapes[_].gap(e)+k);I.startX=Lt[0],I.startY=Lt[1],I.arrowStartX=Ot[0],I.arrowStartY=Ot[1],Q&&(!Rt(I.startX)||!Rt(I.startY)||!Rt(I.endX)||!Rt(I.endY)?I.badLine=!0:I.badLine=!1)};Hm.getSourceEndpoint=function(e){var t=e[0]._private.rscratch;switch(this.recalculateRenderedStyle(e),t.edgeType){case"haystack":return{x:t.haystackPts[0],y:t.haystackPts[1]};default:return{x:t.arrowStartX,y:t.arrowStartY}}};Hm.getTargetEndpoint=function(e){var t=e[0]._private.rscratch;switch(this.recalculateRenderedStyle(e),t.edgeType){case"haystack":return{x:t.haystackPts[2],y:t.haystackPts[3]};default:return{x:t.arrowEndX,y:t.arrowEndY}}};var jS={};function lU(e,t,r){for(var n=function(p,g,v,_){return ci(p,g,v,_)},i=t._private,s=i.rstyle.bezierPts,u=0;u<e.bezierProjPcts.length;u++){var a=e.bezierProjPcts[u];s.push({x:n(r[0],r[2],r[4],a),y:n(r[1],r[3],r[5],a)})}}jS.storeEdgeProjections=function(e){var t=e._private,r=t.rscratch,n=r.edgeType;if(t.rstyle.bezierPts=null,t.rstyle.linePts=null,t.rstyle.haystackPts=null,n==="multibezier"||n==="bezier"||n==="self"||n==="compound"){t.rstyle.bezierPts=[];for(var i=0;i+5<r.allpts.length;i+=4)lU(this,e,r.allpts.slice(i,i+6))}else if(n==="segments")for(var s=t.rstyle.linePts=[],i=0;i+1<r.allpts.length;i+=2)s.push({x:r.allpts[i],y:r.allpts[i+1]});else if(n==="haystack"){var u=r.haystackPts;t.rstyle.haystackPts=[{x:u[0],y:u[1]},{x:u[2],y:u[3]}]}t.rstyle.arrowWidth=this.getArrowWidth(e.pstyle("width").pfValue,e.pstyle("arrow-scale").value)*this.arrowShapeWidth};jS.recalculateEdgeProjections=function(e){this.findEdgeControlPoints(e)};var Ys={};Ys.recalculateNodeLabelProjection=function(e){var t=e.pstyle("label").strValue;if(!ru(t)){var r,n,i=e._private,s=e.width(),u=e.height(),a=e.padding(),d=e.position(),p=e.pstyle("text-halign").strValue,g=e.pstyle("text-valign").strValue,v=i.rscratch,_=i.rstyle;switch(p){case"left":r=d.x-s/2-a;break;case"right":r=d.x+s/2+a;break;default:r=d.x}switch(g){case"top":n=d.y-u/2-a;break;case"bottom":n=d.y+u/2+a;break;default:n=d.y}v.labelX=r,v.labelY=n,_.labelX=r,_.labelY=n,this.calculateLabelAngles(e),this.applyLabelDimensions(e)}};var Gz=function(t,r){var n=Math.atan(r/t);return t===0&&n<0&&(n=n*-1),n},Wz=function(t,r){var n=r.x-t.x,i=r.y-t.y;return Gz(n,i)},uU=function(t,r,n,i){var s=um(0,i-.001,1),u=um(0,i+.001,1),a=cd(t,r,n,s),d=cd(t,r,n,u);return Wz(a,d)};Ys.recalculateEdgeLabelProjections=function(e){var t,r=e._private,n=r.rscratch,i=this,s={mid:e.pstyle("label").strValue,source:e.pstyle("source-label").strValue,target:e.pstyle("target-label").strValue};if(s.mid||s.source||s.target){t={x:n.midX,y:n.midY};var u=function(v,_,b){To(r.rscratch,v,_,b),To(r.rstyle,v,_,b)};u("labelX",null,t.x),u("labelY",null,t.y);var a=Gz(n.midDispX,n.midDispY);u("labelAutoAngle",null,a);var d=function(){if(d.cache)return d.cache;for(var v=[],_=0;_+5<n.allpts.length;_+=4){var b={x:n.allpts[_],y:n.allpts[_+1]},k={x:n.allpts[_+2],y:n.allpts[_+3]},A={x:n.allpts[_+4],y:n.allpts[_+5]};v.push({p0:b,p1:k,p2:A,startDist:0,length:0,segments:[]})}var M=r.rstyle.bezierPts,P=i.bezierProjPcts.length;function I($,G,Z,Q,X){var ie=vc(G,Z),te=$.segments[$.segments.length-1],W={p0:G,p1:Z,t0:Q,t1:X,startDist:te?te.startDist+te.length:0,length:ie};$.segments.push(W),$.length+=ie}for(var z=0;z<v.length;z++){var O=v[z],V=v[z-1];V&&(O.startDist=V.startDist+V.length),I(O,O.p0,M[z*P],0,i.bezierProjPcts[0]);for(var U=0;U<P-1;U++)I(O,M[z*P+U],M[z*P+U+1],i.bezierProjPcts[U],i.bezierProjPcts[U+1]);I(O,M[z*P+P-1],O.p2,i.bezierProjPcts[P-1],1)}return d.cache=v},p=function(v){var _,b=v==="source";if(s[v]){var k=e.pstyle(v+"-text-offset").pfValue;switch(n.edgeType){case"self":case"compound":case"bezier":case"multibezier":{for(var A=d(),M,P=0,I=0,z=0;z<A.length;z++){for(var O=A[b?z:A.length-1-z],V=0;V<O.segments.length;V++){var U=O.segments[b?V:O.segments.length-1-V],$=z===A.length-1&&V===O.segments.length-1;if(P=I,I+=U.length,I>=k||$){M={cp:O,segment:U};break}}if(M)break}var G=M.cp,Z=M.segment,Q=(k-P)/Z.length,X=Z.t1-Z.t0,ie=b?Z.t0+X*Q:Z.t1-X*Q;ie=um(0,ie,1),t=cd(G.p0,G.p1,G.p2,ie),_=uU(G.p0,G.p1,G.p2,ie);break}case"straight":case"segments":case"haystack":{for(var te=0,W,oe,se,de,me=n.allpts.length,ae=0;ae+3<me&&(b?(se={x:n.allpts[ae],y:n.allpts[ae+1]},de={x:n.allpts[ae+2],y:n.allpts[ae+3]}):(se={x:n.allpts[me-2-ae],y:n.allpts[me-1-ae]},de={x:n.allpts[me-4-ae],y:n.allpts[me-3-ae]}),W=vc(se,de),oe=te,te+=W,!(te>=k));ae+=2);var ve=k-oe,pe=ve/W;pe=um(0,pe,1),t=M6(se,de,pe),_=Wz(se,de);break}}u("labelX",v,t.x),u("labelY",v,t.y),u("labelAutoAngle",v,_)}};p("source"),p("target"),this.applyLabelDimensions(e)}};Ys.applyLabelDimensions=function(e){this.applyPrefixedLabelDimensions(e),e.isEdge()&&(this.applyPrefixedLabelDimensions(e,"source"),this.applyPrefixedLabelDimensions(e,"target"))};Ys.applyPrefixedLabelDimensions=function(e,t){var r=e._private,n=this.getLabelText(e,t),i=gc(n,e._private.labelDimsKey);if(fa(r.rscratch,"prefixedLabelDimsKey",t)!==i){To(r.rscratch,"prefixedLabelDimsKey",t,i);var s=this.calculateLabelDimensions(e,n),u=e.pstyle("line-height").pfValue,a=e.pstyle("text-wrap").strValue,d=fa(r.rscratch,"labelWrapCachedLines",t)||[],p=a!=="wrap"?1:Math.max(d.length,1),g=s.height/p,v=g*u,_=s.width,b=s.height+(p-1)*(u-1)*g;To(r.rstyle,"labelWidth",t,_),To(r.rscratch,"labelWidth",t,_),To(r.rstyle,"labelHeight",t,b),To(r.rscratch,"labelHeight",t,b),To(r.rscratch,"labelLineHeight",t,v)}};Ys.getLabelText=function(e,t){var r=e._private,n=t?t+"-":"",i=e.pstyle(n+"label").strValue,s=e.pstyle("text-transform").value,u=function(De,Le){return Le?(To(r.rscratch,De,t,Le),Le):fa(r.rscratch,De,t)};if(!i)return"";s=="none"||(s=="uppercase"?i=i.toUpperCase():s=="lowercase"&&(i=i.toLowerCase()));var a=e.pstyle("text-wrap").value;if(a==="wrap"){var d=u("labelKey");if(d!=null&&u("labelWrapKey")===d)return u("labelWrapCachedText");for(var p="",g=i.split(`
`),v=e.pstyle("text-max-width").pfValue,_=e.pstyle("text-overflow-wrap").value,b=_==="anywhere",k=[],A=/[\s\u200b]+|$/g,M=0;M<g.length;M++){var P=g[M],I=this.calculateLabelDimensions(e,P),z=I.width;if(b){var O=P.split("").join(p);P=O}if(z>v){var V=P.matchAll(A),U="",$=0,G=va(V),Z;try{for(G.s();!(Z=G.n()).done;){var Q=Z.value,X=Q[0],ie=P.substring($,Q.index);$=Q.index+X.length;var te=U.length===0?ie:U+ie+X,W=this.calculateLabelDimensions(e,te),oe=W.width;oe<=v?U+=ie+X:(U&&k.push(U),U=ie+X)}}catch(_e){G.e(_e)}finally{G.f()}U.match(/^[\s\u200b]+$/)||k.push(U)}else k.push(P)}u("labelWrapCachedLines",k),i=u("labelWrapCachedText",k.join(`
`)),u("labelWrapKey",d)}else if(a==="ellipsis"){var se=e.pstyle("text-max-width").pfValue,de="",me="",ae=!1;if(this.calculateLabelDimensions(e,i).width<se)return i;for(var ve=0;ve<i.length;ve++){var pe=this.calculateLabelDimensions(e,de+i[ve]+me).width;if(pe>se)break;de+=i[ve],ve===i.length-1&&(ae=!0)}return ae||(de+=me),de}return i};Ys.getLabelJustification=function(e){var t=e.pstyle("text-justification").strValue,r=e.pstyle("text-halign").strValue;if(t==="auto")if(e.isNode())switch(r){case"left":return"right";case"right":return"left";default:return"center"}else return"center";else return t};Ys.calculateLabelDimensions=function(e,t){var r=this,n=r.cy.window(),i=n.document,s=0,u=e.pstyle("font-style").strValue,a=e.pstyle("font-size").pfValue,d=e.pstyle("font-family").strValue,p=e.pstyle("font-weight").strValue,g=this.labelCalcCanvas,v=this.labelCalcCanvasContext;if(!g){g=this.labelCalcCanvas=i.createElement("canvas"),v=this.labelCalcCanvasContext=g.getContext("2d");var _=g.style;_.position="absolute",_.left="-9999px",_.top="-9999px",_.zIndex="-1",_.visibility="hidden",_.pointerEvents="none"}v.font="".concat(u," ").concat(p," ").concat(a,"px ").concat(d);for(var b=0,k=0,A=t.split(`
`),M=0;M<A.length;M++){var P=A[M],I=v.measureText(P),z=Math.ceil(I.width),O=a;b=Math.max(z,b),k+=O}return b+=s,k+=s,{width:b,height:k}};Ys.calculateLabelAngle=function(e,t){var r=e._private,n=r.rscratch,i=e.isEdge(),s=t?t+"-":"",u=e.pstyle(s+"text-rotation"),a=u.strValue;return a==="none"?0:i&&a==="autorotate"?n.labelAutoAngle:a==="autorotate"?0:u.pfValue};Ys.calculateLabelAngles=function(e){var t=this,r=e.isEdge(),n=e._private,i=n.rscratch;i.labelAngle=t.calculateLabelAngle(e),r&&(i.sourceLabelAngle=t.calculateLabelAngle(e,"source"),i.targetLabelAngle=t.calculateLabelAngle(e,"target"))};var Zz={},TI=28,CI=!1;Zz.getNodeShape=function(e){var t=this,r=e.pstyle("shape").value;if(r==="cutrectangle"&&(e.width()<TI||e.height()<TI))return CI||(Gr("The `cutrectangle` node shape can not be used at small sizes so `rectangle` is used instead"),CI=!0),"rectangle";if(e.isParent())return r==="rectangle"||r==="roundrectangle"||r==="round-rectangle"||r==="cutrectangle"||r==="cut-rectangle"||r==="barrel"?r:"rectangle";if(r==="polygon"){var n=e.pstyle("shape-polygon-points").value;return t.nodeShapes.makePolygon(n).name}return r};var Y0={};Y0.registerCalculationListeners=function(){var e=this.cy,t=e.collection(),r=this,n=function(u){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(t.merge(u),a)for(var d=0;d<u.length;d++){var p=u[d],g=p._private,v=g.rstyle;v.clean=!1,v.cleanConnected=!1}};r.binder(e).on("bounds.* dirty.*",function(u){var a=u.target;n(a)}).on("style.* background.*",function(u){var a=u.target;n(a,!1)});var i=function(u){if(u){var a=r.onUpdateEleCalcsFns;t.cleanStyle();for(var d=0;d<t.length;d++){var p=t[d],g=p._private.rstyle;p.isNode()&&!g.cleanConnected&&(n(p.connectedEdges()),g.cleanConnected=!0)}if(a)for(var v=0;v<a.length;v++){var _=a[v];_(u,t)}r.recalculateRenderedStyle(t),t=e.collection()}};r.flushRenderedStyleQueue=function(){i(!0)},r.beforeRender(i,r.beforeRenderPriorities.eleCalcs)};Y0.onUpdateEleCalcs=function(e){var t=this.onUpdateEleCalcsFns=this.onUpdateEleCalcsFns||[];t.push(e)};Y0.recalculateRenderedStyle=function(e,t){var r=function(O){return O._private.rstyle.cleanConnected};if(e.length!==0){var n=[],i=[];if(!this.destroyed){t===void 0&&(t=!0);for(var s=0;s<e.length;s++){var u=e[s],a=u._private,d=a.rstyle;u.isEdge()&&(!r(u.source())||!r(u.target()))&&(d.clean=!1),u.isEdge()&&u.isBundledBezier()&&u.parallelEdges().some(function(z){return!z._private.rstyle.clean&&z.isBundledBezier()})&&(d.clean=!1),!(t&&d.clean||u.removed())&&u.pstyle("display").value!=="none"&&(a.group==="nodes"?i.push(u):n.push(u),d.clean=!0)}for(var p=0;p<i.length;p++){var g=i[p],v=g._private,_=v.rstyle,b=g.position();this.recalculateNodeLabelProjection(g),_.nodeX=b.x,_.nodeY=b.y,_.nodeW=g.pstyle("width").pfValue,_.nodeH=g.pstyle("height").pfValue}this.recalculateEdgeProjections(n);for(var k=0;k<n.length;k++){var A=n[k],M=A._private,P=M.rstyle,I=M.rscratch;P.srcX=I.arrowStartX,P.srcY=I.arrowStartY,P.tgtX=I.arrowEndX,P.tgtY=I.arrowEndY,P.midX=I.midX,P.midY=I.midY,P.labelAngle=I.labelAngle,P.sourceLabelAngle=I.sourceLabelAngle,P.targetLabelAngle=I.targetLabelAngle}}}};var J0={};J0.updateCachedGrabbedEles=function(){var e=this.cachedZSortedEles;if(e){e.drag=[],e.nondrag=[];for(var t=[],r=0;r<e.length;r++){var n=e[r],i=n._private.rscratch;n.grabbed()&&!n.isParent()?t.push(n):i.inDragLayer?e.drag.push(n):e.nondrag.push(n)}for(var r=0;r<t.length;r++){var n=t[r];e.drag.push(n)}}};J0.invalidateCachedZSortedEles=function(){this.cachedZSortedEles=null};J0.getCachedZSortedEles=function(e){if(e||!this.cachedZSortedEles){var t=this.cy.mutableElements().toArray();t.sort(Iz),t.interactive=t.filter(function(r){return r.interactive()}),this.cachedZSortedEles=t,this.updateCachedGrabbedEles()}else t=this.cachedZSortedEles;return t};var Xz={};[kc,Jy,Ui,Hm,jS,Ys,Zz,Y0,J0].forEach(function(e){dr(Xz,e)});var Kz={};Kz.getCachedImage=function(e,t,r){var n=this,i=n.imageCache=n.imageCache||{},s=i[e];if(s)return s.image.complete||s.image.addEventListener("load",r),s.image;s=i[e]=i[e]||{};var u=s.image=new Image;u.addEventListener("load",r),u.addEventListener("error",function(){u.error=!0});var a="data:",d=e.substring(0,a.length).toLowerCase()===a;return d||(t=t==="null"?null:t,u.crossOrigin=t),u.src=e,u};var jd={};jd.registerBinding=function(e,t,r,n){var i=Array.prototype.slice.apply(arguments,[1]);if(Array.isArray(e)){for(var s=[],u=0;u<e.length;u++){var a=e[u];if(a!==void 0){var d=this.binder(a);s.push(d.on.apply(d,i))}}return s}var d=this.binder(e);return d.on.apply(d,i)};jd.binder=function(e){var t=this,r=t.cy.window(),n=e===r||e===r.document||e===r.document.body||wj(e);if(t.supportsPassiveEvents==null){var i=!1;try{var s=Object.defineProperty({},"passive",{get:function(){return i=!0,!0}});r.addEventListener("test",null,s)}catch{}t.supportsPassiveEvents=i}var u=function(d,p,g){var v=Array.prototype.slice.call(arguments);return n&&t.supportsPassiveEvents&&(v[2]={capture:g??!1,passive:!1,once:!1}),t.bindings.push({target:e,args:v}),(e.addEventListener||e.on).apply(e,v),this};return{on:u,addEventListener:u,addListener:u,bind:u}};jd.nodeIsDraggable=function(e){return e&&e.isNode()&&!e.locked()&&e.grabbable()};jd.nodeIsGrabbable=function(e){return this.nodeIsDraggable(e)&&e.interactive()};jd.load=function(){var e=this,t=e.cy.window(),r=function(le){return le.selected()},n=function(le){var Be=le.getRootNode();if(Be&&Be.nodeType===11&&Be.host!==void 0)return Be},i=function(le,Be,Ue,tt){le==null&&(le=e.cy);for(var st=0;st<Be.length;st++){var dt=Be[st];le.emit({originalEvent:Ue,type:dt,position:tt})}},s=function(le){return le.shiftKey||le.metaKey||le.ctrlKey},u=function(le,Be){var Ue=!0;if(e.cy.hasCompoundNodes()&&le&&le.pannable())for(var tt=0;Be&&tt<Be.length;tt++){var le=Be[tt];if(le.isNode()&&le.isParent()&&!le.pannable()){Ue=!1;break}}else Ue=!0;return Ue},a=function(le){le[0]._private.grabbed=!0},d=function(le){le[0]._private.grabbed=!1},p=function(le){le[0]._private.rscratch.inDragLayer=!0},g=function(le){le[0]._private.rscratch.inDragLayer=!1},v=function(le){le[0]._private.rscratch.isGrabTarget=!0},_=function(le){le[0]._private.rscratch.isGrabTarget=!1},b=function(le,Be){var Ue=Be.addToList,tt=Ue.has(le);!tt&&le.grabbable()&&!le.locked()&&(Ue.merge(le),a(le))},k=function(le,Be){if(le.cy().hasCompoundNodes()&&!(Be.inDragLayer==null&&Be.addToList==null)){var Ue=le.descendants();Be.inDragLayer&&(Ue.forEach(p),Ue.connectedEdges().forEach(p)),Be.addToList&&b(Ue,Be)}},A=function(le,Be){Be=Be||{};var Ue=le.cy().hasCompoundNodes();Be.inDragLayer&&(le.forEach(p),le.neighborhood().stdFilter(function(tt){return!Ue||tt.isEdge()}).forEach(p)),Be.addToList&&le.forEach(function(tt){b(tt,Be)}),k(le,Be),I(le,{inDragLayer:Be.inDragLayer}),e.updateCachedGrabbedEles()},M=A,P=function(le){le&&(e.getCachedZSortedEles().forEach(function(Be){d(Be),g(Be),_(Be)}),e.updateCachedGrabbedEles())},I=function(le,Be){if(!(Be.inDragLayer==null&&Be.addToList==null)&&le.cy().hasCompoundNodes()){var Ue=le.ancestors().orphans();if(!Ue.same(le)){var tt=Ue.descendants().spawnSelf().merge(Ue).unmerge(le).unmerge(le.descendants()),st=tt.connectedEdges();Be.inDragLayer&&(st.forEach(p),tt.forEach(p)),Be.addToList&&tt.forEach(function(dt){b(dt,Be)})}}},z=function(){document.activeElement!=null&&document.activeElement.blur!=null&&document.activeElement.blur()},O=typeof MutationObserver<"u",V=typeof ResizeObserver<"u";O?(e.removeObserver=new MutationObserver(function(at){for(var le=0;le<at.length;le++){var Be=at[le],Ue=Be.removedNodes;if(Ue)for(var tt=0;tt<Ue.length;tt++){var st=Ue[tt];if(st===e.container){e.destroy();break}}}}),e.container.parentNode&&e.removeObserver.observe(e.container.parentNode,{childList:!0})):e.registerBinding(e.container,"DOMNodeRemoved",function(at){e.destroy()});var U=$m(function(){e.cy.resize()},100);O&&(e.styleObserver=new MutationObserver(U),e.styleObserver.observe(e.container,{attributes:!0})),e.registerBinding(t,"resize",U),V&&(e.resizeObserver=new ResizeObserver(U),e.resizeObserver.observe(e.container));var $=function(le,Be){for(;le!=null;)Be(le),le=le.parentNode},G=function(){e.invalidateContainerClientCoordsCache()};$(e.container,function(at){e.registerBinding(at,"transitionend",G),e.registerBinding(at,"animationend",G),e.registerBinding(at,"scroll",G)}),e.registerBinding(e.container,"contextmenu",function(at){at.preventDefault()});var Z=function(){return e.selection[4]!==0},Q=function(le){for(var Be=e.findContainerClientCoords(),Ue=Be[0],tt=Be[1],st=Be[2],dt=Be[3],ht=le.touches?le.touches:[le],Ot=!1,Lt=0;Lt<ht.length;Lt++){var Kt=ht[Lt];if(Ue<=Kt.clientX&&Kt.clientX<=Ue+st&&tt<=Kt.clientY&&Kt.clientY<=tt+dt){Ot=!0;break}}if(!Ot)return!1;for(var Se=e.container,re=le.target,ee=re.parentNode,fe=!1;ee;){if(ee===Se){fe=!0;break}ee=ee.parentNode}return!!fe};e.registerBinding(e.container,"mousedown",function(le){if(Q(le)&&!(e.hoverData.which===1&&le.which!==1)){le.preventDefault(),z(),e.hoverData.capture=!0,e.hoverData.which=le.which;var Be=e.cy,Ue=[le.clientX,le.clientY],tt=e.projectIntoViewport(Ue[0],Ue[1]),st=e.selection,dt=e.findNearestElements(tt[0],tt[1],!0,!1),ht=dt[0],Ot=e.dragData.possibleDragElements;e.hoverData.mdownPos=tt,e.hoverData.mdownGPos=Ue;var Lt=function(we){return{originalEvent:le,type:we,position:{x:tt[0],y:tt[1]}}},Kt=function(){e.hoverData.tapholdCancelled=!1,clearTimeout(e.hoverData.tapholdTimeout),e.hoverData.tapholdTimeout=setTimeout(function(){if(!e.hoverData.tapholdCancelled){var we=e.hoverData.down;we?we.emit(Lt("taphold")):Be.emit(Lt("taphold"))}},e.tapholdDuration)};if(le.which==3){e.hoverData.cxtStarted=!0;var Se={originalEvent:le,type:"cxttapstart",position:{x:tt[0],y:tt[1]}};ht?(ht.activate(),ht.emit(Se),e.hoverData.down=ht):Be.emit(Se),e.hoverData.downTime=new Date().getTime(),e.hoverData.cxtDragged=!1}else if(le.which==1){ht&&ht.activate();{if(ht!=null&&e.nodeIsGrabbable(ht)){var re=function(we){we.emit(Lt("grab"))};if(v(ht),!ht.selected())Ot=e.dragData.possibleDragElements=Be.collection(),M(ht,{addToList:Ot}),ht.emit(Lt("grabon")).emit(Lt("grab"));else{Ot=e.dragData.possibleDragElements=Be.collection();var ee=Be.$(function(fe){return fe.isNode()&&fe.selected()&&e.nodeIsGrabbable(fe)});A(ee,{addToList:Ot}),ht.emit(Lt("grabon")),ee.forEach(re)}e.redrawHint("eles",!0),e.redrawHint("drag",!0)}e.hoverData.down=ht,e.hoverData.downs=dt,e.hoverData.downTime=new Date().getTime()}i(ht,["mousedown","tapstart","vmousedown"],le,{x:tt[0],y:tt[1]}),ht==null?(st[4]=1,e.data.bgActivePosistion={x:tt[0],y:tt[1]},e.redrawHint("select",!0),e.redraw()):ht.pannable()&&(st[4]=1),Kt()}st[0]=st[2]=tt[0],st[1]=st[3]=tt[1]}},!1);var X=n(e.container);e.registerBinding([t,X],"mousemove",function(le){var Be=e.hoverData.capture;if(!(!Be&&!Q(le))){var Ue=!1,tt=e.cy,st=tt.zoom(),dt=[le.clientX,le.clientY],ht=e.projectIntoViewport(dt[0],dt[1]),Ot=e.hoverData.mdownPos,Lt=e.hoverData.mdownGPos,Kt=e.selection,Se=null;!e.hoverData.draggingEles&&!e.hoverData.dragging&&!e.hoverData.selecting&&(Se=e.findNearestElement(ht[0],ht[1],!0,!1));var re=e.hoverData.last,ee=e.hoverData.down,fe=[ht[0]-Kt[2],ht[1]-Kt[3]],we=e.dragData.possibleDragElements,Me;if(Lt){var Ne=dt[0]-Lt[0],Ve=Ne*Ne,ke=dt[1]-Lt[1],Ye=ke*ke,ot=Ve+Ye;e.hoverData.isOverThresholdDrag=Me=ot>=e.desktopTapThreshold2}var Xe=s(le);Me&&(e.hoverData.tapholdCancelled=!0);var xt=function(){var br=e.hoverData.dragDelta=e.hoverData.dragDelta||[];br.length===0?(br.push(fe[0]),br.push(fe[1])):(br[0]+=fe[0],br[1]+=fe[1])};Ue=!0,i(Se,["mousemove","vmousemove","tapdrag"],le,{x:ht[0],y:ht[1]});var Ct=function(br){return{originalEvent:le,type:br,position:{x:ht[0],y:ht[1]}}},Ut=function(){e.data.bgActivePosistion=void 0,e.hoverData.selecting||tt.emit(Ct("boxstart")),Kt[4]=1,e.hoverData.selecting=!0,e.redrawHint("select",!0),e.redraw()};if(e.hoverData.which===3){if(Me){var gr=Ct("cxtdrag");ee?ee.emit(gr):tt.emit(gr),e.hoverData.cxtDragged=!0,(!e.hoverData.cxtOver||Se!==e.hoverData.cxtOver)&&(e.hoverData.cxtOver&&e.hoverData.cxtOver.emit(Ct("cxtdragout")),e.hoverData.cxtOver=Se,Se&&Se.emit(Ct("cxtdragover")))}}else if(e.hoverData.dragging){if(Ue=!0,tt.panningEnabled()&&tt.userPanningEnabled()){var ar;if(e.hoverData.justStartedPan){var xr=e.hoverData.mdownPos;ar={x:(ht[0]-xr[0])*st,y:(ht[1]-xr[1])*st},e.hoverData.justStartedPan=!1}else ar={x:fe[0]*st,y:fe[1]*st};tt.panBy(ar),tt.emit(Ct("dragpan")),e.hoverData.dragged=!0}ht=e.projectIntoViewport(le.clientX,le.clientY)}else if(Kt[4]==1&&(ee==null||ee.pannable())){if(Me){if(!e.hoverData.dragging&&tt.boxSelectionEnabled()&&(Xe||!tt.panningEnabled()||!tt.userPanningEnabled()))Ut();else if(!e.hoverData.selecting&&tt.panningEnabled()&&tt.userPanningEnabled()){var fr=u(ee,e.hoverData.downs);fr&&(e.hoverData.dragging=!0,e.hoverData.justStartedPan=!0,Kt[4]=0,e.data.bgActivePosistion=Jh(Ot),e.redrawHint("select",!0),e.redraw())}ee&&ee.pannable()&&ee.active()&&ee.unactivate()}}else{if(ee&&ee.pannable()&&ee.active()&&ee.unactivate(),(!ee||!ee.grabbed())&&Se!=re&&(re&&i(re,["mouseout","tapdragout"],le,{x:ht[0],y:ht[1]}),Se&&i(Se,["mouseover","tapdragover"],le,{x:ht[0],y:ht[1]}),e.hoverData.last=Se),ee)if(Me){if(tt.boxSelectionEnabled()&&Xe)ee&&ee.grabbed()&&(P(we),ee.emit(Ct("freeon")),we.emit(Ct("free")),e.dragData.didDrag&&(ee.emit(Ct("dragfreeon")),we.emit(Ct("dragfree")))),Ut();else if(ee&&ee.grabbed()&&e.nodeIsDraggable(ee)){var kr=!e.dragData.didDrag;kr&&e.redrawHint("eles",!0),e.dragData.didDrag=!0,e.hoverData.draggingEles||A(we,{inDragLayer:!0});var _r={x:0,y:0};if(Rt(fe[0])&&Rt(fe[1])&&(_r.x+=fe[0],_r.y+=fe[1],kr)){var rr=e.hoverData.dragDelta;rr&&Rt(rr[0])&&Rt(rr[1])&&(_r.x+=rr[0],_r.y+=rr[1])}e.hoverData.draggingEles=!0,we.silentShift(_r).emit(Ct("position")).emit(Ct("drag")),e.redrawHint("drag",!0),e.redraw()}}else xt();Ue=!0}if(Kt[2]=ht[0],Kt[3]=ht[1],Ue)return le.stopPropagation&&le.stopPropagation(),le.preventDefault&&le.preventDefault(),!1}},!1);var ie,te,W;e.registerBinding(t,"mouseup",function(le){if(!(e.hoverData.which===1&&le.which!==1&&e.hoverData.capture)){var Be=e.hoverData.capture;if(Be){e.hoverData.capture=!1;var Ue=e.cy,tt=e.projectIntoViewport(le.clientX,le.clientY),st=e.selection,dt=e.findNearestElement(tt[0],tt[1],!0,!1),ht=e.dragData.possibleDragElements,Ot=e.hoverData.down,Lt=s(le);e.data.bgActivePosistion&&(e.redrawHint("select",!0),e.redraw()),e.hoverData.tapholdCancelled=!0,e.data.bgActivePosistion=void 0,Ot&&Ot.unactivate();var Kt=function(Ne){return{originalEvent:le,type:Ne,position:{x:tt[0],y:tt[1]}}};if(e.hoverData.which===3){var Se=Kt("cxttapend");if(Ot?Ot.emit(Se):Ue.emit(Se),!e.hoverData.cxtDragged){var re=Kt("cxttap");Ot?Ot.emit(re):Ue.emit(re)}e.hoverData.cxtDragged=!1,e.hoverData.which=null}else if(e.hoverData.which===1){if(i(dt,["mouseup","tapend","vmouseup"],le,{x:tt[0],y:tt[1]}),!e.dragData.didDrag&&!e.hoverData.dragged&&!e.hoverData.selecting&&!e.hoverData.isOverThresholdDrag&&(i(Ot,["click","tap","vclick"],le,{x:tt[0],y:tt[1]}),te=!1,le.timeStamp-W<=Ue.multiClickDebounceTime()?(ie&&clearTimeout(ie),te=!0,W=null,i(Ot,["dblclick","dbltap","vdblclick"],le,{x:tt[0],y:tt[1]})):(ie=setTimeout(function(){te||i(Ot,["oneclick","onetap","voneclick"],le,{x:tt[0],y:tt[1]})},Ue.multiClickDebounceTime()),W=le.timeStamp)),Ot==null&&!e.dragData.didDrag&&!e.hoverData.selecting&&!e.hoverData.dragged&&!s(le)&&(Ue.$(r).unselect(["tapunselect"]),ht.length>0&&e.redrawHint("eles",!0),e.dragData.possibleDragElements=ht=Ue.collection()),dt==Ot&&!e.dragData.didDrag&&!e.hoverData.selecting&&dt!=null&&dt._private.selectable&&(e.hoverData.dragging||(Ue.selectionType()==="additive"||Lt?dt.selected()?dt.unselect(["tapunselect"]):dt.select(["tapselect"]):Lt||(Ue.$(r).unmerge(dt).unselect(["tapunselect"]),dt.select(["tapselect"]))),e.redrawHint("eles",!0)),e.hoverData.selecting){var ee=Ue.collection(e.getAllInBox(st[0],st[1],st[2],st[3]));e.redrawHint("select",!0),ee.length>0&&e.redrawHint("eles",!0),Ue.emit(Kt("boxend"));var fe=function(Ne){return Ne.selectable()&&!Ne.selected()};Ue.selectionType()==="additive"||Lt||Ue.$(r).unmerge(ee).unselect(),ee.emit(Kt("box")).stdFilter(fe).select().emit(Kt("boxselect")),e.redraw()}if(e.hoverData.dragging&&(e.hoverData.dragging=!1,e.redrawHint("select",!0),e.redrawHint("eles",!0),e.redraw()),!st[4]){e.redrawHint("drag",!0),e.redrawHint("eles",!0);var we=Ot&&Ot.grabbed();P(ht),we&&(Ot.emit(Kt("freeon")),ht.emit(Kt("free")),e.dragData.didDrag&&(Ot.emit(Kt("dragfreeon")),ht.emit(Kt("dragfree"))))}}st[4]=0,e.hoverData.down=null,e.hoverData.cxtStarted=!1,e.hoverData.draggingEles=!1,e.hoverData.selecting=!1,e.hoverData.isOverThresholdDrag=!1,e.dragData.didDrag=!1,e.hoverData.dragged=!1,e.hoverData.dragDelta=[],e.hoverData.mdownPos=null,e.hoverData.mdownGPos=null,e.hoverData.which=null}}},!1);var oe=[],se=4,de,me=1e5,ae=function(le,Be){for(var Ue=0;Ue<le.length;Ue++)if(le[Ue]%Be!==0)return!1;return!0},ve=function(le){for(var Be=Math.abs(le[0]),Ue=1;Ue<le.length;Ue++)if(Math.abs(le[Ue])!==Be)return!1;return!0},pe=function(le){var Be=!1,Ue=le.deltaY;if(Ue==null&&(le.wheelDeltaY!=null?Ue=le.wheelDeltaY/4:le.wheelDelta!=null&&(Ue=le.wheelDelta/4)),Ue!==0){if(de==null)if(oe.length>=se){var tt=oe;if(de=ae(tt,5),!de){var st=Math.abs(tt[0]);de=ve(tt)&&st>5}if(de)for(var dt=0;dt<tt.length;dt++)me=Math.min(Math.abs(tt[dt]),me)}else oe.push(Ue),Be=!0;else de&&(me=Math.min(Math.abs(Ue),me));if(!e.scrollingPage){var ht=e.cy,Ot=ht.zoom(),Lt=ht.pan(),Kt=e.projectIntoViewport(le.clientX,le.clientY),Se=[Kt[0]*Ot+Lt.x,Kt[1]*Ot+Lt.y];if(e.hoverData.draggingEles||e.hoverData.dragging||e.hoverData.cxtStarted||Z()){le.preventDefault();return}if(ht.panningEnabled()&&ht.userPanningEnabled()&&ht.zoomingEnabled()&&ht.userZoomingEnabled()){le.preventDefault(),e.data.wheelZooming=!0,clearTimeout(e.data.wheelTimeout),e.data.wheelTimeout=setTimeout(function(){e.data.wheelZooming=!1,e.redrawHint("eles",!0),e.redraw()},150);var re;Be&&Math.abs(Ue)>5&&(Ue=CS(Ue)*5),re=Ue/-250,de&&(re/=me,re*=3),re=re*e.wheelSensitivity;var ee=le.deltaMode===1;ee&&(re*=33);var fe=ht.zoom()*Math.pow(10,re);le.type==="gesturechange"&&(fe=e.gestureStartZoom*le.scale),ht.zoom({level:fe,renderedPosition:{x:Se[0],y:Se[1]}}),ht.emit({type:le.type==="gesturechange"?"pinchzoom":"scrollzoom",originalEvent:le,position:{x:Kt[0],y:Kt[1]}})}}}};e.registerBinding(e.container,"wheel",pe,!0),e.registerBinding(t,"scroll",function(le){e.scrollingPage=!0,clearTimeout(e.scrollingPageTimeout),e.scrollingPageTimeout=setTimeout(function(){e.scrollingPage=!1},250)},!0),e.registerBinding(e.container,"gesturestart",function(le){e.gestureStartZoom=e.cy.zoom(),e.hasTouchStarted||le.preventDefault()},!0),e.registerBinding(e.container,"gesturechange",function(at){e.hasTouchStarted||pe(at)},!0),e.registerBinding(e.container,"mouseout",function(le){var Be=e.projectIntoViewport(le.clientX,le.clientY);e.cy.emit({originalEvent:le,type:"mouseout",position:{x:Be[0],y:Be[1]}})},!1),e.registerBinding(e.container,"mouseover",function(le){var Be=e.projectIntoViewport(le.clientX,le.clientY);e.cy.emit({originalEvent:le,type:"mouseover",position:{x:Be[0],y:Be[1]}})},!1);var _e,De,Le,je,Je,et,ft,rt,Oe,Ge,Ze,it,mt,Tt=function(le,Be,Ue,tt){return Math.sqrt((Ue-le)*(Ue-le)+(tt-Be)*(tt-Be))},$e=function(le,Be,Ue,tt){return(Ue-le)*(Ue-le)+(tt-Be)*(tt-Be)},At;e.registerBinding(e.container,"touchstart",At=function(le){if(e.hasTouchStarted=!0,!!Q(le)){z(),e.touchData.capture=!0,e.data.bgActivePosistion=void 0;var Be=e.cy,Ue=e.touchData.now,tt=e.touchData.earlier;if(le.touches[0]){var st=e.projectIntoViewport(le.touches[0].clientX,le.touches[0].clientY);Ue[0]=st[0],Ue[1]=st[1]}if(le.touches[1]){var st=e.projectIntoViewport(le.touches[1].clientX,le.touches[1].clientY);Ue[2]=st[0],Ue[3]=st[1]}if(le.touches[2]){var st=e.projectIntoViewport(le.touches[2].clientX,le.touches[2].clientY);Ue[4]=st[0],Ue[5]=st[1]}var dt=function(Xe){return{originalEvent:le,type:Xe,position:{x:Ue[0],y:Ue[1]}}};if(le.touches[1]){e.touchData.singleTouchMoved=!0,P(e.dragData.touchDragEles);var ht=e.findContainerClientCoords();Oe=ht[0],Ge=ht[1],Ze=ht[2],it=ht[3],_e=le.touches[0].clientX-Oe,De=le.touches[0].clientY-Ge,Le=le.touches[1].clientX-Oe,je=le.touches[1].clientY-Ge,mt=0<=_e&&_e<=Ze&&0<=Le&&Le<=Ze&&0<=De&&De<=it&&0<=je&&je<=it;var Ot=Be.pan(),Lt=Be.zoom();Je=Tt(_e,De,Le,je),et=$e(_e,De,Le,je),ft=[(_e+Le)/2,(De+je)/2],rt=[(ft[0]-Ot.x)/Lt,(ft[1]-Ot.y)/Lt];var Kt=200,Se=Kt*Kt;if(et<Se&&!le.touches[2]){var re=e.findNearestElement(Ue[0],Ue[1],!0,!0),ee=e.findNearestElement(Ue[2],Ue[3],!0,!0);re&&re.isNode()?(re.activate().emit(dt("cxttapstart")),e.touchData.start=re):ee&&ee.isNode()?(ee.activate().emit(dt("cxttapstart")),e.touchData.start=ee):Be.emit(dt("cxttapstart")),e.touchData.start&&(e.touchData.start._private.grabbed=!1),e.touchData.cxt=!0,e.touchData.cxtDragged=!1,e.data.bgActivePosistion=void 0,e.redraw();return}}if(le.touches[2])Be.boxSelectionEnabled()&&le.preventDefault();else if(!le.touches[1]){if(le.touches[0]){var fe=e.findNearestElements(Ue[0],Ue[1],!0,!0),we=fe[0];if(we!=null&&(we.activate(),e.touchData.start=we,e.touchData.starts=fe,e.nodeIsGrabbable(we))){var Me=e.dragData.touchDragEles=Be.collection(),Ne=null;e.redrawHint("eles",!0),e.redrawHint("drag",!0),we.selected()?(Ne=Be.$(function(ot){return ot.selected()&&e.nodeIsGrabbable(ot)}),A(Ne,{addToList:Me})):M(we,{addToList:Me}),v(we),we.emit(dt("grabon")),Ne?Ne.forEach(function(ot){ot.emit(dt("grab"))}):we.emit(dt("grab"))}i(we,["touchstart","tapstart","vmousedown"],le,{x:Ue[0],y:Ue[1]}),we==null&&(e.data.bgActivePosistion={x:st[0],y:st[1]},e.redrawHint("select",!0),e.redraw()),e.touchData.singleTouchMoved=!1,e.touchData.singleTouchStartTime=+new Date,clearTimeout(e.touchData.tapholdTimeout),e.touchData.tapholdTimeout=setTimeout(function(){e.touchData.singleTouchMoved===!1&&!e.pinching&&!e.touchData.selecting&&i(e.touchData.start,["taphold"],le,{x:Ue[0],y:Ue[1]})},e.tapholdDuration)}}if(le.touches.length>=1){for(var Ve=e.touchData.startPosition=[null,null,null,null,null,null],ke=0;ke<Ue.length;ke++)Ve[ke]=tt[ke]=Ue[ke];var Ye=le.touches[0];e.touchData.startGPosition=[Ye.clientX,Ye.clientY]}}},!1);var pt;e.registerBinding(t,"touchmove",pt=function(le){var Be=e.touchData.capture;if(!(!Be&&!Q(le))){var Ue=e.selection,tt=e.cy,st=e.touchData.now,dt=e.touchData.earlier,ht=tt.zoom();if(le.touches[0]){var Ot=e.projectIntoViewport(le.touches[0].clientX,le.touches[0].clientY);st[0]=Ot[0],st[1]=Ot[1]}if(le.touches[1]){var Ot=e.projectIntoViewport(le.touches[1].clientX,le.touches[1].clientY);st[2]=Ot[0],st[3]=Ot[1]}if(le.touches[2]){var Ot=e.projectIntoViewport(le.touches[2].clientX,le.touches[2].clientY);st[4]=Ot[0],st[5]=Ot[1]}var Lt=function(Gi){return{originalEvent:le,type:Gi,position:{x:st[0],y:st[1]}}},Kt=e.touchData.startGPosition,Se;if(Be&&le.touches[0]&&Kt){for(var re=[],ee=0;ee<st.length;ee++)re[ee]=st[ee]-dt[ee];var fe=le.touches[0].clientX-Kt[0],we=fe*fe,Me=le.touches[0].clientY-Kt[1],Ne=Me*Me,Ve=we+Ne;Se=Ve>=e.touchTapThreshold2}if(Be&&e.touchData.cxt){le.preventDefault();var ke=le.touches[0].clientX-Oe,Ye=le.touches[0].clientY-Ge,ot=le.touches[1].clientX-Oe,Xe=le.touches[1].clientY-Ge,xt=$e(ke,Ye,ot,Xe),Ct=xt/et,Ut=150,gr=Ut*Ut,ar=1.5,xr=ar*ar;if(Ct>=xr||xt>=gr){e.touchData.cxt=!1,e.data.bgActivePosistion=void 0,e.redrawHint("select",!0);var fr=Lt("cxttapend");e.touchData.start?(e.touchData.start.unactivate().emit(fr),e.touchData.start=null):tt.emit(fr)}}if(Be&&e.touchData.cxt){var fr=Lt("cxtdrag");e.data.bgActivePosistion=void 0,e.redrawHint("select",!0),e.touchData.start?e.touchData.start.emit(fr):tt.emit(fr),e.touchData.start&&(e.touchData.start._private.grabbed=!1),e.touchData.cxtDragged=!0;var kr=e.findNearestElement(st[0],st[1],!0,!0);(!e.touchData.cxtOver||kr!==e.touchData.cxtOver)&&(e.touchData.cxtOver&&e.touchData.cxtOver.emit(Lt("cxtdragout")),e.touchData.cxtOver=kr,kr&&kr.emit(Lt("cxtdragover")))}else if(Be&&le.touches[2]&&tt.boxSelectionEnabled())le.preventDefault(),e.data.bgActivePosistion=void 0,this.lastThreeTouch=+new Date,e.touchData.selecting||tt.emit(Lt("boxstart")),e.touchData.selecting=!0,e.touchData.didSelect=!0,Ue[4]=1,!Ue||Ue.length===0||Ue[0]===void 0?(Ue[0]=(st[0]+st[2]+st[4])/3,Ue[1]=(st[1]+st[3]+st[5])/3,Ue[2]=(st[0]+st[2]+st[4])/3+1,Ue[3]=(st[1]+st[3]+st[5])/3+1):(Ue[2]=(st[0]+st[2]+st[4])/3,Ue[3]=(st[1]+st[3]+st[5])/3),e.redrawHint("select",!0),e.redraw();else if(Be&&le.touches[1]&&!e.touchData.didSelect&&tt.zoomingEnabled()&&tt.panningEnabled()&&tt.userZoomingEnabled()&&tt.userPanningEnabled()){le.preventDefault(),e.data.bgActivePosistion=void 0,e.redrawHint("select",!0);var _r=e.dragData.touchDragEles;if(_r){e.redrawHint("drag",!0);for(var rr=0;rr<_r.length;rr++){var Er=_r[rr]._private;Er.grabbed=!1,Er.rscratch.inDragLayer=!1}}var br=e.touchData.start,ke=le.touches[0].clientX-Oe,Ye=le.touches[0].clientY-Ge,ot=le.touches[1].clientX-Oe,Xe=le.touches[1].clientY-Ge,cn=Tt(ke,Ye,ot,Xe),wn=cn/Je;if(mt){var Pn=ke-_e,$a=Ye-De,Mr=ot-Le,to=Xe-je,ro=(Pn+Mr)/2,Hn=($a+to)/2,bn=tt.zoom(),Ms=bn*wn,Nn=tt.pan(),Bn=rt[0]*bn+Nn.x,ba=rt[1]*bn+Nn.y,qi={x:-Ms/bn*(Bn-Nn.x-ro)+Bn,y:-Ms/bn*(ba-Nn.y-Hn)+ba};if(br&&br.active()){var _r=e.dragData.touchDragEles;P(_r),e.redrawHint("drag",!0),e.redrawHint("eles",!0),br.unactivate().emit(Lt("freeon")),_r.emit(Lt("free")),e.dragData.didDrag&&(br.emit(Lt("dragfreeon")),_r.emit(Lt("dragfree")))}tt.viewport({zoom:Ms,pan:qi,cancelOnFailedZoom:!0}),tt.emit(Lt("pinchzoom")),Je=cn,_e=ke,De=Ye,Le=ot,je=Xe,e.pinching=!0}if(le.touches[0]){var Ot=e.projectIntoViewport(le.touches[0].clientX,le.touches[0].clientY);st[0]=Ot[0],st[1]=Ot[1]}if(le.touches[1]){var Ot=e.projectIntoViewport(le.touches[1].clientX,le.touches[1].clientY);st[2]=Ot[0],st[3]=Ot[1]}if(le.touches[2]){var Ot=e.projectIntoViewport(le.touches[2].clientX,le.touches[2].clientY);st[4]=Ot[0],st[5]=Ot[1]}}else if(le.touches[0]&&!e.touchData.didSelect){var Rr=e.touchData.start,us=e.touchData.last,kr;if(!e.hoverData.draggingEles&&!e.swipePanning&&(kr=e.findNearestElement(st[0],st[1],!0,!0)),Be&&Rr!=null&&le.preventDefault(),Be&&Rr!=null&&e.nodeIsDraggable(Rr))if(Se){var _r=e.dragData.touchDragEles,Pi=!e.dragData.didDrag;Pi&&A(_r,{inDragLayer:!0}),e.dragData.didDrag=!0;var Wr={x:0,y:0};if(Rt(re[0])&&Rt(re[1])&&(Wr.x+=re[0],Wr.y+=re[1],Pi)){e.redrawHint("eles",!0);var ti=e.touchData.dragDelta;ti&&Rt(ti[0])&&Rt(ti[1])&&(Wr.x+=ti[0],Wr.y+=ti[1])}e.hoverData.draggingEles=!0,_r.silentShift(Wr).emit(Lt("position")).emit(Lt("drag")),e.redrawHint("drag",!0),e.touchData.startPosition[0]==dt[0]&&e.touchData.startPosition[1]==dt[1]&&e.redrawHint("eles",!0),e.redraw()}else{var ti=e.touchData.dragDelta=e.touchData.dragDelta||[];ti.length===0?(ti.push(re[0]),ti.push(re[1])):(ti[0]+=re[0],ti[1]+=re[1])}if(i(Rr||kr,["touchmove","tapdrag","vmousemove"],le,{x:st[0],y:st[1]}),(!Rr||!Rr.grabbed())&&kr!=us&&(us&&us.emit(Lt("tapdragout")),kr&&kr.emit(Lt("tapdragover"))),e.touchData.last=kr,Be)for(var rr=0;rr<st.length;rr++)st[rr]&&e.touchData.startPosition[rr]&&Se&&(e.touchData.singleTouchMoved=!0);if(Be&&(Rr==null||Rr.pannable())&&tt.panningEnabled()&&tt.userPanningEnabled()){var Hi=u(Rr,e.touchData.starts);Hi&&(le.preventDefault(),e.data.bgActivePosistion||(e.data.bgActivePosistion=Jh(e.touchData.startPosition)),e.swipePanning?(tt.panBy({x:re[0]*ht,y:re[1]*ht}),tt.emit(Lt("dragpan"))):Se&&(e.swipePanning=!0,tt.panBy({x:fe*ht,y:Me*ht}),tt.emit(Lt("dragpan")),Rr&&(Rr.unactivate(),e.redrawHint("select",!0),e.touchData.start=null)));var Ot=e.projectIntoViewport(le.touches[0].clientX,le.touches[0].clientY);st[0]=Ot[0],st[1]=Ot[1]}}for(var ee=0;ee<st.length;ee++)dt[ee]=st[ee];Be&&le.touches.length>0&&!e.hoverData.draggingEles&&!e.swipePanning&&e.data.bgActivePosistion!=null&&(e.data.bgActivePosistion=void 0,e.redrawHint("select",!0),e.redraw())}},!1);var yt;e.registerBinding(t,"touchcancel",yt=function(le){var Be=e.touchData.start;e.touchData.capture=!1,Be&&Be.unactivate()});var gt,qt,$t,er;if(e.registerBinding(t,"touchend",gt=function(le){var Be=e.touchData.start,Ue=e.touchData.capture;if(Ue)le.touches.length===0&&(e.touchData.capture=!1),le.preventDefault();else return;var tt=e.selection;e.swipePanning=!1,e.hoverData.draggingEles=!1;var st=e.cy,dt=st.zoom(),ht=e.touchData.now,Ot=e.touchData.earlier;if(le.touches[0]){var Lt=e.projectIntoViewport(le.touches[0].clientX,le.touches[0].clientY);ht[0]=Lt[0],ht[1]=Lt[1]}if(le.touches[1]){var Lt=e.projectIntoViewport(le.touches[1].clientX,le.touches[1].clientY);ht[2]=Lt[0],ht[3]=Lt[1]}if(le.touches[2]){var Lt=e.projectIntoViewport(le.touches[2].clientX,le.touches[2].clientY);ht[4]=Lt[0],ht[5]=Lt[1]}var Kt=function(gr){return{originalEvent:le,type:gr,position:{x:ht[0],y:ht[1]}}};Be&&Be.unactivate();var Se;if(e.touchData.cxt){if(Se=Kt("cxttapend"),Be?Be.emit(Se):st.emit(Se),!e.touchData.cxtDragged){var re=Kt("cxttap");Be?Be.emit(re):st.emit(re)}e.touchData.start&&(e.touchData.start._private.grabbed=!1),e.touchData.cxt=!1,e.touchData.start=null,e.redraw();return}if(!le.touches[2]&&st.boxSelectionEnabled()&&e.touchData.selecting){e.touchData.selecting=!1;var ee=st.collection(e.getAllInBox(tt[0],tt[1],tt[2],tt[3]));tt[0]=void 0,tt[1]=void 0,tt[2]=void 0,tt[3]=void 0,tt[4]=0,e.redrawHint("select",!0),st.emit(Kt("boxend"));var fe=function(gr){return gr.selectable()&&!gr.selected()};ee.emit(Kt("box")).stdFilter(fe).select().emit(Kt("boxselect")),ee.nonempty()&&e.redrawHint("eles",!0),e.redraw()}if(Be!=null&&Be.unactivate(),le.touches[2])e.data.bgActivePosistion=void 0,e.redrawHint("select",!0);else if(!le.touches[1]){if(!le.touches[0]){if(!le.touches[0]){e.data.bgActivePosistion=void 0,e.redrawHint("select",!0);var we=e.dragData.touchDragEles;if(Be!=null){var Me=Be._private.grabbed;P(we),e.redrawHint("drag",!0),e.redrawHint("eles",!0),Me&&(Be.emit(Kt("freeon")),we.emit(Kt("free")),e.dragData.didDrag&&(Be.emit(Kt("dragfreeon")),we.emit(Kt("dragfree")))),i(Be,["touchend","tapend","vmouseup","tapdragout"],le,{x:ht[0],y:ht[1]}),Be.unactivate(),e.touchData.start=null}else{var Ne=e.findNearestElement(ht[0],ht[1],!0,!0);i(Ne,["touchend","tapend","vmouseup","tapdragout"],le,{x:ht[0],y:ht[1]})}var Ve=e.touchData.startPosition[0]-ht[0],ke=Ve*Ve,Ye=e.touchData.startPosition[1]-ht[1],ot=Ye*Ye,Xe=ke+ot,xt=Xe*dt*dt;e.touchData.singleTouchMoved||(Be||st.$(":selected").unselect(["tapunselect"]),i(Be,["tap","vclick"],le,{x:ht[0],y:ht[1]}),qt=!1,le.timeStamp-er<=st.multiClickDebounceTime()?($t&&clearTimeout($t),qt=!0,er=null,i(Be,["dbltap","vdblclick"],le,{x:ht[0],y:ht[1]})):($t=setTimeout(function(){qt||i(Be,["onetap","voneclick"],le,{x:ht[0],y:ht[1]})},st.multiClickDebounceTime()),er=le.timeStamp)),Be!=null&&!e.dragData.didDrag&&Be._private.selectable&&xt<e.touchTapThreshold2&&!e.pinching&&(st.selectionType()==="single"?(st.$(r).unmerge(Be).unselect(["tapunselect"]),Be.select(["tapselect"])):Be.selected()?Be.unselect(["tapunselect"]):Be.select(["tapselect"]),e.redrawHint("eles",!0)),e.touchData.singleTouchMoved=!0}}}for(var Ct=0;Ct<ht.length;Ct++)Ot[Ct]=ht[Ct];e.dragData.didDrag=!1,le.touches.length===0&&(e.touchData.dragDelta=[],e.touchData.startPosition=[null,null,null,null,null,null],e.touchData.startGPosition=null,e.touchData.didSelect=!1),le.touches.length<2&&(le.touches.length===1&&(e.touchData.startGPosition=[le.touches[0].clientX,le.touches[0].clientY]),e.pinching=!1,e.redrawHint("eles",!0),e.redraw())},!1),typeof TouchEvent>"u"){var Vt=[],tr=function(le){return{clientX:le.clientX,clientY:le.clientY,force:1,identifier:le.pointerId,pageX:le.pageX,pageY:le.pageY,radiusX:le.width/2,radiusY:le.height/2,screenX:le.screenX,screenY:le.screenY,target:le.target}},pr=function(le){return{event:le,touch:tr(le)}},vr=function(le){Vt.push(pr(le))},lt=function(le){for(var Be=0;Be<Vt.length;Be++){var Ue=Vt[Be];if(Ue.event.pointerId===le.pointerId){Vt.splice(Be,1);return}}},mr=function(le){var Be=Vt.filter(function(Ue){return Ue.event.pointerId===le.pointerId})[0];Be.event=le,Be.touch=tr(le)},Ht=function(le){le.touches=Vt.map(function(Be){return Be.touch})},wt=function(le){return le.pointerType==="mouse"||le.pointerType===4};e.registerBinding(e.container,"pointerdown",function(at){wt(at)||(at.preventDefault(),vr(at),Ht(at),At(at))}),e.registerBinding(e.container,"pointerup",function(at){wt(at)||(lt(at),Ht(at),gt(at))}),e.registerBinding(e.container,"pointercancel",function(at){wt(at)||(lt(at),Ht(at),yt(at))}),e.registerBinding(e.container,"pointermove",function(at){wt(at)||(at.preventDefault(),mr(at),Ht(at),pt(at))})}};var Vo={};Vo.generatePolygon=function(e,t){return this.nodeShapes[e]={renderer:this,name:e,points:t,draw:function(n,i,s,u,a,d){this.renderer.nodeShapeImpl("polygon",n,i,s,u,a,this.points)},intersectLine:function(n,i,s,u,a,d,p,g){return cm(a,d,this.points,n,i,s/2,u/2,p)},checkPoint:function(n,i,s,u,a,d,p,g){return Oo(n,i,this.points,d,p,u,a,[0,-1],s)},hasMiterBounds:e!=="rectangle",miterBounds:function(n,i,s,u,a,d){return B6(this.points,n,i,s,u,a)}}};Vo.generateEllipse=function(){return this.nodeShapes.ellipse={renderer:this,name:"ellipse",draw:function(t,r,n,i,s,u){this.renderer.nodeShapeImpl(this.name,t,r,n,i,s)},intersectLine:function(t,r,n,i,s,u,a,d){return H6(s,u,t,r,n/2+a,i/2+a)},checkPoint:function(t,r,n,i,s,u,a,d){return rc(t,r,i,s,u,a,n)}}};Vo.generateRoundPolygon=function(e,t){return this.nodeShapes[e]={renderer:this,name:e,points:t,getOrCreateCorners:function(n,i,s,u,a,d,p){if(d[p]!==void 0&&d[p+"-cx"]===n&&d[p+"-cy"]===i)return d[p];d[p]=new Array(t.length/2),d[p+"-cx"]=n,d[p+"-cy"]=i;var g=s/2,v=u/2;a=a==="auto"?YN(s,u):a;for(var _=new Array(t.length/2),b=0;b<t.length/2;b++)_[b]={x:n+g*t[b*2],y:i+v*t[b*2+1]};var k,A,M,P,I=_.length;for(A=_[I-1],k=0;k<I;k++)M=_[k%I],P=_[(k+1)%I],d[p][k]=FS(A,M,P,a),A=M,M=P;return d[p]},draw:function(n,i,s,u,a,d,p){this.renderer.nodeShapeImpl("round-polygon",n,i,s,u,a,this.points,this.getOrCreateCorners(i,s,u,a,d,p,"drawCorners"))},intersectLine:function(n,i,s,u,a,d,p,g,v){return W6(a,d,this.points,n,i,s,u,p,this.getOrCreateCorners(n,i,s,u,g,v,"corners"))},checkPoint:function(n,i,s,u,a,d,p,g,v){return q6(n,i,this.points,d,p,u,a,this.getOrCreateCorners(d,p,u,a,g,v,"corners"))}}};Vo.generateRoundRectangle=function(){return this.nodeShapes["round-rectangle"]=this.nodeShapes.roundrectangle={renderer:this,name:"round-rectangle",points:Ji(4,0),draw:function(t,r,n,i,s,u){this.renderer.nodeShapeImpl(this.name,t,r,n,i,s,this.points,u)},intersectLine:function(t,r,n,i,s,u,a,d){return XN(s,u,t,r,n,i,a,d)},checkPoint:function(t,r,n,i,s,u,a,d){var p=i/2,g=s/2;d=d==="auto"?iu(i,s):d,d=Math.min(p,g,d);var v=d*2;return!!(Oo(t,r,this.points,u,a,i,s-v,[0,-1],n)||Oo(t,r,this.points,u,a,i-v,s,[0,-1],n)||rc(t,r,v,v,u-p+d,a-g+d,n)||rc(t,r,v,v,u+p-d,a-g+d,n)||rc(t,r,v,v,u+p-d,a+g-d,n)||rc(t,r,v,v,u-p+d,a+g-d,n))}}};Vo.generateCutRectangle=function(){return this.nodeShapes["cut-rectangle"]=this.nodeShapes.cutrectangle={renderer:this,name:"cut-rectangle",cornerLength:PS(),points:Ji(4,0),draw:function(t,r,n,i,s,u){this.renderer.nodeShapeImpl(this.name,t,r,n,i,s,null,u)},generateCutTrianglePts:function(t,r,n,i,s){var u=s==="auto"?this.cornerLength:s,a=r/2,d=t/2,p=n-d,g=n+d,v=i-a,_=i+a;return{topLeft:[p,v+u,p+u,v,p+u,v+u],topRight:[g-u,v,g,v+u,g-u,v+u],bottomRight:[g,_-u,g-u,_,g-u,_-u],bottomLeft:[p+u,_,p,_-u,p+u,_-u]}},intersectLine:function(t,r,n,i,s,u,a,d){var p=this.generateCutTrianglePts(n+2*a,i+2*a,t,r,d),g=[].concat.apply([],[p.topLeft.splice(0,4),p.topRight.splice(0,4),p.bottomRight.splice(0,4),p.bottomLeft.splice(0,4)]);return cm(s,u,g,t,r)},checkPoint:function(t,r,n,i,s,u,a,d){var p=d==="auto"?this.cornerLength:d;if(Oo(t,r,this.points,u,a,i,s-2*p,[0,-1],n)||Oo(t,r,this.points,u,a,i-2*p,s,[0,-1],n))return!0;var g=this.generateCutTrianglePts(i,s,u,a);return pa(t,r,g.topLeft)||pa(t,r,g.topRight)||pa(t,r,g.bottomRight)||pa(t,r,g.bottomLeft)}}};Vo.generateBarrel=function(){return this.nodeShapes.barrel={renderer:this,name:"barrel",points:Ji(4,0),draw:function(t,r,n,i,s,u){this.renderer.nodeShapeImpl(this.name,t,r,n,i,s)},intersectLine:function(t,r,n,i,s,u,a,d){var p=.15,g=.5,v=.85,_=this.generateBarrelBezierPts(n+2*a,i+2*a,t,r),b=function(M){var P=cd({x:M[0],y:M[1]},{x:M[2],y:M[3]},{x:M[4],y:M[5]},p),I=cd({x:M[0],y:M[1]},{x:M[2],y:M[3]},{x:M[4],y:M[5]},g),z=cd({x:M[0],y:M[1]},{x:M[2],y:M[3]},{x:M[4],y:M[5]},v);return[M[0],M[1],P.x,P.y,I.x,I.y,z.x,z.y,M[4],M[5]]},k=[].concat(b(_.topLeft),b(_.topRight),b(_.bottomRight),b(_.bottomLeft));return cm(s,u,k,t,r)},generateBarrelBezierPts:function(t,r,n,i){var s=r/2,u=t/2,a=n-u,d=n+u,p=i-s,g=i+s,v=$1(t,r),_=v.heightOffset,b=v.widthOffset,k=v.ctrlPtOffsetPct*t,A={topLeft:[a,p+_,a+k,p,a+b,p],topRight:[d-b,p,d-k,p,d,p+_],bottomRight:[d,g-_,d-k,g,d-b,g],bottomLeft:[a+b,g,a+k,g,a,g-_]};return A.topLeft.isTop=!0,A.topRight.isTop=!0,A.bottomLeft.isBottom=!0,A.bottomRight.isBottom=!0,A},checkPoint:function(t,r,n,i,s,u,a,d){var p=$1(i,s),g=p.heightOffset,v=p.widthOffset;if(Oo(t,r,this.points,u,a,i,s-2*g,[0,-1],n)||Oo(t,r,this.points,u,a,i-2*v,s,[0,-1],n))return!0;for(var _=this.generateBarrelBezierPts(i,s,u,a),b=function(G,Z,Q){var X=Q[4],ie=Q[2],te=Q[0],W=Q[5],oe=Q[1],se=Math.min(X,te),de=Math.max(X,te),me=Math.min(W,oe),ae=Math.max(W,oe);if(se<=G&&G<=de&&me<=Z&&Z<=ae){var ve=Z6(X,ie,te),pe=j6(ve[0],ve[1],ve[2],G),_e=pe.filter(function(De){return 0<=De&&De<=1});if(_e.length>0)return _e[0]}return null},k=Object.keys(_),A=0;A<k.length;A++){var M=k[A],P=_[M],I=b(t,r,P);if(I!=null){var z=P[5],O=P[3],V=P[1],U=ci(z,O,V,I);if(P.isTop&&U<=r||P.isBottom&&r<=U)return!0}}return!1}}};Vo.generateBottomRoundrectangle=function(){return this.nodeShapes["bottom-round-rectangle"]=this.nodeShapes.bottomroundrectangle={renderer:this,name:"bottom-round-rectangle",points:Ji(4,0),draw:function(t,r,n,i,s,u){this.renderer.nodeShapeImpl(this.name,t,r,n,i,s,this.points,u)},intersectLine:function(t,r,n,i,s,u,a,d){var p=t-(n/2+a),g=r-(i/2+a),v=g,_=t+(n/2+a),b=$l(s,u,t,r,p,g,_,v,!1);return b.length>0?b:XN(s,u,t,r,n,i,a,d)},checkPoint:function(t,r,n,i,s,u,a,d){d=d==="auto"?iu(i,s):d;var p=2*d;if(Oo(t,r,this.points,u,a,i,s-p,[0,-1],n)||Oo(t,r,this.points,u,a,i-p,s,[0,-1],n))return!0;var g=i/2+2*n,v=s/2+2*n,_=[u-g,a-v,u-g,a,u+g,a,u+g,a-v];return!!(pa(t,r,_)||rc(t,r,p,p,u+i/2-d,a+s/2-d,n)||rc(t,r,p,p,u-i/2+d,a+s/2-d,n))}}};Vo.registerNodeShapes=function(){var e=this.nodeShapes={},t=this;this.generateEllipse(),this.generatePolygon("triangle",Ji(3,0)),this.generateRoundPolygon("round-triangle",Ji(3,0)),this.generatePolygon("rectangle",Ji(4,0)),e.square=e.rectangle,this.generateRoundRectangle(),this.generateCutRectangle(),this.generateBarrel(),this.generateBottomRoundrectangle();{var r=[0,1,1,0,0,-1,-1,0];this.generatePolygon("diamond",r),this.generateRoundPolygon("round-diamond",r)}this.generatePolygon("pentagon",Ji(5,0)),this.generateRoundPolygon("round-pentagon",Ji(5,0)),this.generatePolygon("hexagon",Ji(6,0)),this.generateRoundPolygon("round-hexagon",Ji(6,0)),this.generatePolygon("heptagon",Ji(7,0)),this.generateRoundPolygon("round-heptagon",Ji(7,0)),this.generatePolygon("octagon",Ji(8,0)),this.generateRoundPolygon("round-octagon",Ji(8,0));var n=new Array(20);{var i=j1(5,0),s=j1(5,Math.PI/5),u=.5*(3-Math.sqrt(5));u*=1.57;for(var a=0;a<s.length/2;a++)s[a*2]*=u,s[a*2+1]*=u;for(var a=0;a<20/4;a++)n[a*4]=i[a*2],n[a*4+1]=i[a*2+1],n[a*4+2]=s[a*2],n[a*4+3]=s[a*2+1]}n=KN(n),this.generatePolygon("star",n),this.generatePolygon("vee",[-1,-1,0,-.333,1,-1,0,1]),this.generatePolygon("rhomboid",[-1,-1,.333,-1,1,1,-.333,1]),this.generatePolygon("right-rhomboid",[-.333,-1,1,-1,.333,1,-1,1]),this.nodeShapes.concavehexagon=this.generatePolygon("concave-hexagon",[-1,-.95,-.75,0,-1,.95,1,.95,.75,0,1,-.95]);{var d=[-1,-1,.25,-1,1,0,.25,1,-1,1];this.generatePolygon("tag",d),this.generateRoundPolygon("round-tag",d)}e.makePolygon=function(p){var g=p.join("$"),v="polygon-"+g,_;return(_=this[v])?_:t.generatePolygon(v,p)}};var Gm={};Gm.timeToRender=function(){return this.redrawTotalTime/this.redrawCount};Gm.redraw=function(e){e=e||HN();var t=this;t.averageRedrawTime===void 0&&(t.averageRedrawTime=0),t.lastRedrawTime===void 0&&(t.lastRedrawTime=0),t.lastDrawTime===void 0&&(t.lastDrawTime=0),t.requestedFrame=!0,t.renderOptions=e};Gm.beforeRender=function(e,t){if(!this.destroyed){t==null&&_n("Priority is not optional for beforeRender");var r=this.beforeRenderCallbacks;r.push({fn:e,priority:t}),r.sort(function(n,i){return i.priority-n.priority})}};var kI=function(t,r,n){for(var i=t.beforeRenderCallbacks,s=0;s<i.length;s++)i[s].fn(r,n)};Gm.startRenderLoop=function(){var e=this,t=e.cy;if(!e.renderLoopStarted){e.renderLoopStarted=!0;var r=function(i){if(!e.destroyed){if(!t.batching())if(e.requestedFrame&&!e.skipFrame){kI(e,!0,i);var s=Bo();e.render(e.renderOptions);var u=e.lastDrawTime=Bo();e.averageRedrawTime===void 0&&(e.averageRedrawTime=u-s),e.redrawCount===void 0&&(e.redrawCount=0),e.redrawCount++,e.redrawTotalTime===void 0&&(e.redrawTotalTime=0);var a=u-s;e.redrawTotalTime+=a,e.lastRedrawTime=a,e.averageRedrawTime=e.averageRedrawTime/2+a/2,e.requestedFrame=!1}else kI(e,!1,i);e.skipFrame=!1,qy(r)}};qy(r)}};var cU=function(t){this.init(t)},Yz=cU,$d=Yz.prototype;$d.clientFunctions=["redrawHint","render","renderTo","matchCanvasSize","nodeShapeImpl","arrowShapeImpl"];$d.init=function(e){var t=this;t.options=e,t.cy=e.cy;var r=t.container=e.cy.container(),n=t.cy.window();if(n){var i=n.document,s=i.head,u="__________cytoscape_stylesheet",a="__________cytoscape_container",d=i.getElementById(u)!=null;if(r.className.indexOf(a)<0&&(r.className=(r.className||"")+" "+a),!d){var p=i.createElement("style");p.id=u,p.textContent="."+a+" { position: relative; }",s.insertBefore(p,s.children[0])}var g=n.getComputedStyle(r),v=g.getPropertyValue("position");v==="static"&&Gr("A Cytoscape container has style position:static and so can not use UI extensions properly")}t.selection=[void 0,void 0,void 0,void 0,0],t.bezierProjPcts=[.05,.225,.4,.5,.6,.775,.95],t.hoverData={down:null,last:null,downTime:null,triggerMode:null,dragging:!1,initialPan:[null,null],capture:!1},t.dragData={possibleDragElements:[]},t.touchData={start:null,capture:!1,startPosition:[null,null,null,null,null,null],singleTouchStartTime:null,singleTouchMoved:!0,now:[null,null,null,null,null,null],earlier:[null,null,null,null,null,null]},t.redraws=0,t.showFps=e.showFps,t.debug=e.debug,t.webgl=e.webgl,t.hideEdgesOnViewport=e.hideEdgesOnViewport,t.textureOnViewport=e.textureOnViewport,t.wheelSensitivity=e.wheelSensitivity,t.motionBlurEnabled=e.motionBlur,t.forcedPixelRatio=Rt(e.pixelRatio)?e.pixelRatio:null,t.motionBlur=e.motionBlur,t.motionBlurOpacity=e.motionBlurOpacity,t.motionBlurTransparency=1-t.motionBlurOpacity,t.motionBlurPxRatio=1,t.mbPxRBlurry=1,t.minMbLowQualFrames=4,t.fullQualityMb=!1,t.clearedForMotionBlur=[],t.desktopTapThreshold=e.desktopTapThreshold,t.desktopTapThreshold2=e.desktopTapThreshold*e.desktopTapThreshold,t.touchTapThreshold=e.touchTapThreshold,t.touchTapThreshold2=e.touchTapThreshold*e.touchTapThreshold,t.tapholdDuration=500,t.bindings=[],t.beforeRenderCallbacks=[],t.beforeRenderPriorities={animations:400,eleCalcs:300,eleTxrDeq:200,lyrTxrDeq:150,lyrTxrSkip:100},t.registerNodeShapes(),t.registerArrowShapes(),t.registerCalculationListeners()};$d.notify=function(e,t){var r=this,n=r.cy;if(!this.destroyed){if(e==="init"){r.load();return}if(e==="destroy"){r.destroy();return}(e==="add"||e==="remove"||e==="move"&&n.hasCompoundNodes()||e==="load"||e==="zorder"||e==="mount")&&r.invalidateCachedZSortedEles(),e==="viewport"&&r.redrawHint("select",!0),e==="gc"&&r.redrawHint("gc",!0),(e==="load"||e==="resize"||e==="mount")&&(r.invalidateContainerClientCoordsCache(),r.matchCanvasSize(r.container)),r.redrawHint("eles",!0),r.redrawHint("drag",!0),this.startRenderLoop(),this.redraw()}};$d.destroy=function(){var e=this;e.destroyed=!0,e.cy.stopAnimationLoop();for(var t=0;t<e.bindings.length;t++){var r=e.bindings[t],n=r,i=n.target;(i.off||i.removeEventListener).apply(i,n.args)}if(e.bindings=[],e.beforeRenderCallbacks=[],e.onUpdateEleCalcsFns=[],e.removeObserver&&e.removeObserver.disconnect(),e.styleObserver&&e.styleObserver.disconnect(),e.resizeObserver&&e.resizeObserver.disconnect(),e.labelCalcDiv)try{document.body.removeChild(e.labelCalcDiv)}catch{}};$d.isHeadless=function(){return!1};[OS,Xz,Kz,jd,Vo,Gm].forEach(function(e){dr($d,e)});var wb=1e3/60,Jz={setupDequeueing:function(t){return function(){var n=this,i=this.renderer;if(!n.dequeueingSetup){n.dequeueingSetup=!0;var s=$m(function(){i.redrawHint("eles",!0),i.redrawHint("drag",!0),i.redraw()},t.deqRedrawThreshold),u=function(p,g){var v=Bo(),_=i.averageRedrawTime,b=i.lastRedrawTime,k=[],A=i.cy.extent(),M=i.getPixelRatio();for(p||i.flushRenderedStyleQueue();;){var P=Bo(),I=P-v,z=P-g;if(b<wb){var O=wb-(p?_:0);if(z>=t.deqFastCost*O)break}else if(p){if(I>=t.deqCost*b||I>=t.deqAvgCost*_)break}else if(z>=t.deqNoDrawCost*wb)break;var V=t.deq(n,M,A);if(V.length>0)for(var U=0;U<V.length;U++)k.push(V[U]);else break}k.length>0&&(t.onDeqd(n,k),!p&&t.shouldRedraw(n,k,M,A)&&s())},a=t.priority||SS;i.beforeRender(u,a(n))}}}},hU=function(){function e(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Hy;hu(this,e),this.idsByKey=new Po,this.keyForId=new Po,this.cachesByLvl=new Po,this.lvls=[],this.getKey=t,this.doesEleInvalidateKey=r}return du(e,[{key:"getIdsFor",value:function(r){r==null&&_n("Can not get id list for null key");var n=this.idsByKey,i=this.idsByKey.get(r);return i||(i=new Ld,n.set(r,i)),i}},{key:"addIdForKey",value:function(r,n){r!=null&&this.getIdsFor(r).add(n)}},{key:"deleteIdForKey",value:function(r,n){r!=null&&this.getIdsFor(r).delete(n)}},{key:"getNumberOfIdsForKey",value:function(r){return r==null?0:this.getIdsFor(r).size}},{key:"updateKeyMappingFor",value:function(r){var n=r.id(),i=this.keyForId.get(n),s=this.getKey(r);this.deleteIdForKey(i,n),this.addIdForKey(s,n),this.keyForId.set(n,s)}},{key:"deleteKeyMappingFor",value:function(r){var n=r.id(),i=this.keyForId.get(n);this.deleteIdForKey(i,n),this.keyForId.delete(n)}},{key:"keyHasChangedFor",value:function(r){var n=r.id(),i=this.keyForId.get(n),s=this.getKey(r);return i!==s}},{key:"isInvalid",value:function(r){return this.keyHasChangedFor(r)||this.doesEleInvalidateKey(r)}},{key:"getCachesAt",value:function(r){var n=this.cachesByLvl,i=this.lvls,s=n.get(r);return s||(s=new Po,n.set(r,s),i.push(r)),s}},{key:"getCache",value:function(r,n){return this.getCachesAt(n).get(r)}},{key:"get",value:function(r,n){var i=this.getKey(r),s=this.getCache(i,n);return s!=null&&this.updateKeyMappingFor(r),s}},{key:"getForCachedKey",value:function(r,n){var i=this.keyForId.get(r.id()),s=this.getCache(i,n);return s}},{key:"hasCache",value:function(r,n){return this.getCachesAt(n).has(r)}},{key:"has",value:function(r,n){var i=this.getKey(r);return this.hasCache(i,n)}},{key:"setCache",value:function(r,n,i){i.key=r,this.getCachesAt(n).set(r,i)}},{key:"set",value:function(r,n,i){var s=this.getKey(r);this.setCache(s,n,i),this.updateKeyMappingFor(r)}},{key:"deleteCache",value:function(r,n){this.getCachesAt(n).delete(r)}},{key:"delete",value:function(r,n){var i=this.getKey(r);this.deleteCache(i,n)}},{key:"invalidateKey",value:function(r){var n=this;this.lvls.forEach(function(i){return n.deleteCache(r,i)})}},{key:"invalidate",value:function(r){var n=r.id(),i=this.keyForId.get(n);this.deleteKeyMappingFor(r);var s=this.doesEleInvalidateKey(r);return s&&this.invalidateKey(i),s||this.getNumberOfIdsForKey(i)===0}}])}(),PI=25,Iv=50,dy=-4,e2=3,Qz=7.99,dU=8,fU=1024,pU=1024,mU=1024,gU=.2,vU=.8,yU=10,xU=.15,_U=.1,wU=.9,bU=.9,SU=100,EU=1,ed={dequeue:"dequeue",downscale:"downscale",highQuality:"highQuality"},TU=Ti({getKey:null,doesEleInvalidateKey:Hy,drawElement:null,getBoundingBox:null,getRotationPoint:null,getRotationOffset:null,isVisible:VN,allowEdgeTxrCaching:!0,allowParentTxrCaching:!0}),Sp=function(t,r){var n=this;n.renderer=t,n.onDequeues=[];var i=TU(r);dr(n,i),n.lookup=new hU(i.getKey,i.doesEleInvalidateKey),n.setupDequeueing()},Qn=Sp.prototype;Qn.reasons=ed;Qn.getTextureQueue=function(e){var t=this;return t.eleImgCaches=t.eleImgCaches||{},t.eleImgCaches[e]=t.eleImgCaches[e]||[]};Qn.getRetiredTextureQueue=function(e){var t=this,r=t.eleImgCaches.retired=t.eleImgCaches.retired||{},n=r[e]=r[e]||[];return n};Qn.getElementQueue=function(){var e=this,t=e.eleCacheQueue=e.eleCacheQueue||new Vm(function(r,n){return n.reqs-r.reqs});return t};Qn.getElementKeyToQueue=function(){var e=this,t=e.eleKeyToCacheQueue=e.eleKeyToCacheQueue||{};return t};Qn.getElement=function(e,t,r,n,i){var s=this,u=this.renderer,a=u.cy.zoom(),d=this.lookup;if(!t||t.w===0||t.h===0||isNaN(t.w)||isNaN(t.h)||!e.visible()||e.removed()||!s.allowEdgeTxrCaching&&e.isEdge()||!s.allowParentTxrCaching&&e.isParent())return null;if(n==null&&(n=Math.ceil(TS(a*r))),n<dy)n=dy;else if(a>=Qz||n>e2)return null;var p=Math.pow(2,n),g=t.h*p,v=t.w*p,_=u.eleTextBiggerThanMin(e,p);if(!this.isVisible(e,_))return null;var b=d.get(e,n);if(b&&b.invalidated&&(b.invalidated=!1,b.texture.invalidatedWidth-=b.width),b)return b;var k;if(g<=PI?k=PI:g<=Iv?k=Iv:k=Math.ceil(g/Iv)*Iv,g>mU||v>pU)return null;var A=s.getTextureQueue(k),M=A[A.length-2],P=function(){return s.recycleTexture(k,v)||s.addTexture(k,v)};M||(M=A[A.length-1]),M||(M=P()),M.width-M.usedWidth<v&&(M=P());for(var I=function(se){return se&&se.scaledLabelShown===_},z=i&&i===ed.dequeue,O=i&&i===ed.highQuality,V=i&&i===ed.downscale,U,$=n+1;$<=e2;$++){var G=d.get(e,$);if(G){U=G;break}}var Z=U&&U.level===n+1?U:null,Q=function(){M.context.drawImage(Z.texture.canvas,Z.x,0,Z.width,Z.height,M.usedWidth,0,v,g)};if(M.context.setTransform(1,0,0,1,0,0),M.context.clearRect(M.usedWidth,0,v,k),I(Z))Q();else if(I(U))if(O){for(var X=U.level;X>n;X--)Z=s.getElement(e,t,r,X,ed.downscale);Q()}else return s.queueElement(e,U.level-1),U;else{var ie;if(!z&&!O&&!V)for(var te=n-1;te>=dy;te--){var W=d.get(e,te);if(W){ie=W;break}}if(I(ie))return s.queueElement(e,n),ie;M.context.translate(M.usedWidth,0),M.context.scale(p,p),this.drawElement(M.context,e,t,_,!1),M.context.scale(1/p,1/p),M.context.translate(-M.usedWidth,0)}return b={x:M.usedWidth,texture:M,level:n,scale:p,width:v,height:g,scaledLabelShown:_},M.usedWidth+=Math.ceil(v+dU),M.eleCaches.push(b),d.set(e,n,b),s.checkTextureFullness(M),b};Qn.invalidateElements=function(e){for(var t=0;t<e.length;t++)this.invalidateElement(e[t])};Qn.invalidateElement=function(e){var t=this,r=t.lookup,n=[],i=r.isInvalid(e);if(i){for(var s=dy;s<=e2;s++){var u=r.getForCachedKey(e,s);u&&n.push(u)}var a=r.invalidate(e);if(a)for(var d=0;d<n.length;d++){var p=n[d],g=p.texture;g.invalidatedWidth+=p.width,p.invalidated=!0,t.checkTextureUtility(g)}t.removeFromQueue(e)}};Qn.checkTextureUtility=function(e){e.invalidatedWidth>=gU*e.width&&this.retireTexture(e)};Qn.checkTextureFullness=function(e){var t=this,r=t.getTextureQueue(e.height);e.usedWidth/e.width>vU&&e.fullnessChecks>=yU?nu(r,e):e.fullnessChecks++};Qn.retireTexture=function(e){var t=this,r=e.height,n=t.getTextureQueue(r),i=this.lookup;nu(n,e),e.retired=!0;for(var s=e.eleCaches,u=0;u<s.length;u++){var a=s[u];i.deleteCache(a.key,a.level)}ES(s);var d=t.getRetiredTextureQueue(r);d.push(e)};Qn.addTexture=function(e,t){var r=this,n=r.getTextureQueue(e),i={};return n.push(i),i.eleCaches=[],i.height=e,i.width=Math.max(fU,t),i.usedWidth=0,i.invalidatedWidth=0,i.fullnessChecks=0,i.canvas=r.renderer.makeOffscreenCanvas(i.width,i.height),i.context=i.canvas.getContext("2d"),i};Qn.recycleTexture=function(e,t){for(var r=this,n=r.getTextureQueue(e),i=r.getRetiredTextureQueue(e),s=0;s<i.length;s++){var u=i[s];if(u.width>=t)return u.retired=!1,u.usedWidth=0,u.invalidatedWidth=0,u.fullnessChecks=0,ES(u.eleCaches),u.context.setTransform(1,0,0,1,0,0),u.context.clearRect(0,0,u.width,u.height),nu(i,u),n.push(u),u}};Qn.queueElement=function(e,t){var r=this,n=r.getElementQueue(),i=r.getElementKeyToQueue(),s=this.getKey(e),u=i[s];if(u)u.level=Math.max(u.level,t),u.eles.merge(e),u.reqs++,n.updateItem(u);else{var a={eles:e.spawn().merge(e),level:t,reqs:1,key:s};n.push(a),i[s]=a}};Qn.dequeue=function(e){for(var t=this,r=t.getElementQueue(),n=t.getElementKeyToQueue(),i=[],s=t.lookup,u=0;u<EU&&r.size()>0;u++){var a=r.pop(),d=a.key,p=a.eles[0],g=s.hasCache(p,a.level);if(n[d]=null,g)continue;i.push(a);var v=t.getBoundingBox(p);t.getElement(p,v,e,a.level,ed.dequeue)}return i};Qn.removeFromQueue=function(e){var t=this,r=t.getElementQueue(),n=t.getElementKeyToQueue(),i=this.getKey(e),s=n[i];s!=null&&(s.eles.length===1?(s.reqs=bS,r.updateItem(s),r.pop(),n[i]=null):s.eles.unmerge(e))};Qn.onDequeue=function(e){this.onDequeues.push(e)};Qn.offDequeue=function(e){nu(this.onDequeues,e)};Qn.setupDequeueing=Jz.setupDequeueing({deqRedrawThreshold:SU,deqCost:xU,deqAvgCost:_U,deqNoDrawCost:wU,deqFastCost:bU,deq:function(t,r,n){return t.dequeue(r,n)},onDeqd:function(t,r){for(var n=0;n<t.onDequeues.length;n++){var i=t.onDequeues[n];i(r)}},shouldRedraw:function(t,r,n,i){for(var s=0;s<r.length;s++)for(var u=r[s].eles,a=0;a<u.length;a++){var d=u[a].boundingBox();if(kS(d,i))return!0}return!1},priority:function(t){return t.renderer.beforeRenderPriorities.eleTxrDeq}});var CU=1,Op=-4,Qy=2,kU=3.99,PU=50,IU=50,AU=.15,MU=.1,DU=.9,NU=.9,zU=1,II=250,RU=4e3*4e3,AI=32767,LU=!0,eR=function(t){var r=this,n=r.renderer=t,i=n.cy;r.layersByLevel={},r.firstGet=!0,r.lastInvalidationTime=Bo()-2*II,r.skipping=!1,r.eleTxrDeqs=i.collection(),r.scheduleElementRefinement=$m(function(){r.refineElementTextures(r.eleTxrDeqs),r.eleTxrDeqs.unmerge(r.eleTxrDeqs)},IU),n.beforeRender(function(u,a){a-r.lastInvalidationTime<=II?r.skipping=!0:r.skipping=!1},n.beforeRenderPriorities.lyrTxrSkip);var s=function(a,d){return d.reqs-a.reqs};r.layersQueue=new Vm(s),r.setupDequeueing()},Ci=eR.prototype,MI=0,BU=Math.pow(2,53)-1;Ci.makeLayer=function(e,t){var r=Math.pow(2,t),n=Math.ceil(e.w*r),i=Math.ceil(e.h*r),s=this.renderer.makeOffscreenCanvas(n,i),u={id:MI=++MI%BU,bb:e,level:t,width:n,height:i,canvas:s,context:s.getContext("2d"),eles:[],elesQueue:[],reqs:0},a=u.context,d=-u.bb.x1,p=-u.bb.y1;return a.scale(r,r),a.translate(d,p),u};Ci.getLayers=function(e,t,r){var n=this,i=n.renderer,s=i.cy,u=s.zoom(),a=n.firstGet;if(n.firstGet=!1,r==null){if(r=Math.ceil(TS(u*t)),r<Op)r=Op;else if(u>=kU||r>Qy)return null}n.validateLayersElesOrdering(r,e);var d=n.layersByLevel,p=Math.pow(2,r),g=d[r]=d[r]||[],v,_=n.levelIsComplete(r,e),b,k=function(){var Q=function(oe){if(n.validateLayersElesOrdering(oe,e),n.levelIsComplete(oe,e))return b=d[oe],!0},X=function(oe){if(!b)for(var se=r+oe;Op<=se&&se<=Qy&&!Q(se);se+=oe);};X(1),X(-1);for(var ie=g.length-1;ie>=0;ie--){var te=g[ie];te.invalid&&nu(g,te)}};if(!_)k();else return g;var A=function(){if(!v){v=ta();for(var Q=0;Q<e.length;Q++)z6(v,e[Q].boundingBox())}return v},M=function(Q){Q=Q||{};var X=Q.after;A();var ie=Math.ceil(v.w*p),te=Math.ceil(v.h*p);if(ie>AI||te>AI)return null;var W=ie*te;if(W>RU)return null;var oe=n.makeLayer(v,r);if(X!=null){var se=g.indexOf(X)+1;g.splice(se,0,oe)}else(Q.insert===void 0||Q.insert)&&g.unshift(oe);return oe};if(n.skipping&&!a)return null;for(var P=null,I=e.length/CU,z=!a,O=0;O<e.length;O++){var V=e[O],U=V._private.rscratch,$=U.imgLayerCaches=U.imgLayerCaches||{},G=$[r];if(G){P=G;continue}if((!P||P.eles.length>=I||!ZN(P.bb,V.boundingBox()))&&(P=M({insert:!0,after:P}),!P))return null;b||z?n.queueLayer(P,V):n.drawEleInLayer(P,V,r,t),P.eles.push(V),$[r]=P}return b||(z?null:g)};Ci.getEleLevelForLayerLevel=function(e,t){return e};Ci.drawEleInLayer=function(e,t,r,n){var i=this,s=this.renderer,u=e.context,a=t.boundingBox();a.w===0||a.h===0||!t.visible()||(r=i.getEleLevelForLayerLevel(r,n),s.setImgSmoothing(u,!1),s.drawCachedElement(u,t,null,null,r,LU),s.setImgSmoothing(u,!0))};Ci.levelIsComplete=function(e,t){var r=this,n=r.layersByLevel[e];if(!n||n.length===0)return!1;for(var i=0,s=0;s<n.length;s++){var u=n[s];if(u.reqs>0||u.invalid)return!1;i+=u.eles.length}return i===t.length};Ci.validateLayersElesOrdering=function(e,t){var r=this.layersByLevel[e];if(r)for(var n=0;n<r.length;n++){for(var i=r[n],s=-1,u=0;u<t.length;u++)if(i.eles[0]===t[u]){s=u;break}if(s<0){this.invalidateLayer(i);continue}for(var a=s,u=0;u<i.eles.length;u++)if(i.eles[u]!==t[a+u]){this.invalidateLayer(i);break}}};Ci.updateElementsInLayers=function(e,t){for(var r=this,n=Bm(e[0]),i=0;i<e.length;i++)for(var s=n?null:e[i],u=n?e[i]:e[i].ele,a=u._private.rscratch,d=a.imgLayerCaches=a.imgLayerCaches||{},p=Op;p<=Qy;p++){var g=d[p];g&&(s&&r.getEleLevelForLayerLevel(g.level)!==s.level||t(g,u,s))}};Ci.haveLayers=function(){for(var e=this,t=!1,r=Op;r<=Qy;r++){var n=e.layersByLevel[r];if(n&&n.length>0){t=!0;break}}return t};Ci.invalidateElements=function(e){var t=this;e.length!==0&&(t.lastInvalidationTime=Bo(),!(e.length===0||!t.haveLayers())&&t.updateElementsInLayers(e,function(n,i,s){t.invalidateLayer(n)}))};Ci.invalidateLayer=function(e){if(this.lastInvalidationTime=Bo(),!e.invalid){var t=e.level,r=e.eles,n=this.layersByLevel[t];nu(n,e),e.elesQueue=[],e.invalid=!0,e.replacement&&(e.replacement.invalid=!0);for(var i=0;i<r.length;i++){var s=r[i]._private.rscratch.imgLayerCaches;s&&(s[t]=null)}}};Ci.refineElementTextures=function(e){var t=this;t.updateElementsInLayers(e,function(n,i,s){var u=n.replacement;if(u||(u=n.replacement=t.makeLayer(n.bb,n.level),u.replaces=n,u.eles=n.eles),!u.reqs)for(var a=0;a<u.eles.length;a++)t.queueLayer(u,u.eles[a])})};Ci.enqueueElementRefinement=function(e){this.eleTxrDeqs.merge(e),this.scheduleElementRefinement()};Ci.queueLayer=function(e,t){var r=this,n=r.layersQueue,i=e.elesQueue,s=i.hasId=i.hasId||{};if(!e.replacement){if(t){if(s[t.id()])return;i.push(t),s[t.id()]=!0}e.reqs?(e.reqs++,n.updateItem(e)):(e.reqs=1,n.push(e))}};Ci.dequeue=function(e){for(var t=this,r=t.layersQueue,n=[],i=0;i<zU&&r.size()!==0;){var s=r.peek();if(s.replacement){r.pop();continue}if(s.replaces&&s!==s.replaces.replacement){r.pop();continue}if(s.invalid){r.pop();continue}var u=s.elesQueue.shift();u&&(t.drawEleInLayer(s,u,s.level,e),i++),n.length===0&&n.push(!0),s.elesQueue.length===0&&(r.pop(),s.reqs=0,s.replaces&&t.applyLayerReplacement(s),t.requestRedraw())}return n};Ci.applyLayerReplacement=function(e){var t=this,r=t.layersByLevel[e.level],n=e.replaces,i=r.indexOf(n);if(!(i<0||n.invalid)){r[i]=e;for(var s=0;s<e.eles.length;s++){var u=e.eles[s]._private,a=u.imgLayerCaches=u.imgLayerCaches||{};a&&(a[e.level]=e)}t.requestRedraw()}};Ci.requestRedraw=$m(function(){var e=this.renderer;e.redrawHint("eles",!0),e.redrawHint("drag",!0),e.redraw()},100);Ci.setupDequeueing=Jz.setupDequeueing({deqRedrawThreshold:PU,deqCost:AU,deqAvgCost:MU,deqNoDrawCost:DU,deqFastCost:NU,deq:function(t,r){return t.dequeue(r)},onDeqd:SS,shouldRedraw:VN,priority:function(t){return t.renderer.beforeRenderPriorities.lyrTxrDeq}});var tR={},DI;function OU(e,t){for(var r=0;r<t.length;r++){var n=t[r];e.lineTo(n.x,n.y)}}function FU(e,t,r){for(var n,i=0;i<t.length;i++){var s=t[i];i===0&&(n=s),e.lineTo(s.x,s.y)}e.quadraticCurveTo(r.x,r.y,n.x,n.y)}function NI(e,t,r){e.beginPath&&e.beginPath();for(var n=t,i=0;i<n.length;i++){var s=n[i];e.lineTo(s.x,s.y)}var u=r,a=r[0];e.moveTo(a.x,a.y);for(var i=1;i<u.length;i++){var s=u[i];e.lineTo(s.x,s.y)}e.closePath&&e.closePath()}function jU(e,t,r,n,i){e.beginPath&&e.beginPath(),e.arc(r,n,i,0,Math.PI*2,!1);var s=t,u=s[0];e.moveTo(u.x,u.y);for(var a=0;a<s.length;a++){var d=s[a];e.lineTo(d.x,d.y)}e.closePath&&e.closePath()}function $U(e,t,r,n){e.arc(t,r,n,0,Math.PI*2,!1)}tR.arrowShapeImpl=function(e){return(DI||(DI={polygon:OU,"triangle-backcurve":FU,"triangle-tee":NI,"circle-triangle":jU,"triangle-cross":NI,circle:$U}))[e]};var Js={};Js.drawElement=function(e,t,r,n,i,s){var u=this;t.isNode()?u.drawNode(e,t,r,n,i,s):u.drawEdge(e,t,r,n,i,s)};Js.drawElementOverlay=function(e,t){var r=this;t.isNode()?r.drawNodeOverlay(e,t):r.drawEdgeOverlay(e,t)};Js.drawElementUnderlay=function(e,t){var r=this;t.isNode()?r.drawNodeUnderlay(e,t):r.drawEdgeUnderlay(e,t)};Js.drawCachedElementPortion=function(e,t,r,n,i,s,u,a){var d=this,p=r.getBoundingBox(t);if(!(p.w===0||p.h===0)){var g=r.getElement(t,p,n,i,s);if(g!=null){var v=a(d,t);if(v===0)return;var _=u(d,t),b=p.x1,k=p.y1,A=p.w,M=p.h,P,I,z,O,V;if(_!==0){var U=r.getRotationPoint(t);z=U.x,O=U.y,e.translate(z,O),e.rotate(_),V=d.getImgSmoothing(e),V||d.setImgSmoothing(e,!0);var $=r.getRotationOffset(t);P=$.x,I=$.y}else P=b,I=k;var G;v!==1&&(G=e.globalAlpha,e.globalAlpha=G*v),e.drawImage(g.texture.canvas,g.x,0,g.width,g.height,P,I,A,M),v!==1&&(e.globalAlpha=G),_!==0&&(e.rotate(-_),e.translate(-z,-O),V||d.setImgSmoothing(e,!1))}else r.drawElement(e,t)}};var VU=function(){return 0},UU=function(t,r){return t.getTextAngle(r,null)},qU=function(t,r){return t.getTextAngle(r,"source")},HU=function(t,r){return t.getTextAngle(r,"target")},GU=function(t,r){return r.effectiveOpacity()},bb=function(t,r){return r.pstyle("text-opacity").pfValue*r.effectiveOpacity()};Js.drawCachedElement=function(e,t,r,n,i,s){var u=this,a=u.data,d=a.eleTxrCache,p=a.lblTxrCache,g=a.slbTxrCache,v=a.tlbTxrCache,_=t.boundingBox(),b=s===!0?d.reasons.highQuality:null;if(!(_.w===0||_.h===0||!t.visible())&&(!n||kS(_,n))){var k=t.isEdge(),A=t.element()._private.rscratch.badLine;u.drawElementUnderlay(e,t),u.drawCachedElementPortion(e,t,d,r,i,b,VU,GU),(!k||!A)&&u.drawCachedElementPortion(e,t,p,r,i,b,UU,bb),k&&!A&&(u.drawCachedElementPortion(e,t,g,r,i,b,qU,bb),u.drawCachedElementPortion(e,t,v,r,i,b,HU,bb)),u.drawElementOverlay(e,t)}};Js.drawElements=function(e,t){for(var r=this,n=0;n<t.length;n++){var i=t[n];r.drawElement(e,i)}};Js.drawCachedElements=function(e,t,r,n){for(var i=this,s=0;s<t.length;s++){var u=t[s];i.drawCachedElement(e,u,r,n)}};Js.drawCachedNodes=function(e,t,r,n){for(var i=this,s=0;s<t.length;s++){var u=t[s];u.isNode()&&i.drawCachedElement(e,u,r,n)}};Js.drawLayeredElements=function(e,t,r,n){var i=this,s=i.data.lyrTxrCache.getLayers(t,r);if(s)for(var u=0;u<s.length;u++){var a=s[u],d=a.bb;d.w===0||d.h===0||e.drawImage(a.canvas,d.x1,d.y1,d.w,d.h)}else i.drawCachedElements(e,t,r,n)};var Uo={};Uo.drawEdge=function(e,t,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,u=this,a=t._private.rscratch;if(!(s&&!t.visible())&&!(a.badLine||a.allpts==null||isNaN(a.allpts[0]))){var d;r&&(d=r,e.translate(-d.x1,-d.y1));var p=s?t.pstyle("opacity").value:1,g=s?t.pstyle("line-opacity").value:1,v=t.pstyle("curve-style").value,_=t.pstyle("line-style").value,b=t.pstyle("width").pfValue,k=t.pstyle("line-cap").value,A=t.pstyle("line-outline-width").value,M=t.pstyle("line-outline-color").value,P=p*g,I=p*g,z=function(){var oe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:P;v==="straight-triangle"?(u.eleStrokeStyle(e,t,oe),u.drawEdgeTrianglePath(t,e,a.allpts)):(e.lineWidth=b,e.lineCap=k,u.eleStrokeStyle(e,t,oe),u.drawEdgePath(t,e,a.allpts,_),e.lineCap="butt")},O=function(){var oe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:P;if(e.lineWidth=b+A,e.lineCap=k,A>0)u.colorStrokeStyle(e,M[0],M[1],M[2],oe);else{e.lineCap="butt";return}v==="straight-triangle"?u.drawEdgeTrianglePath(t,e,a.allpts):(u.drawEdgePath(t,e,a.allpts,_),e.lineCap="butt")},V=function(){i&&u.drawEdgeOverlay(e,t)},U=function(){i&&u.drawEdgeUnderlay(e,t)},$=function(){var oe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:I;u.drawArrowheads(e,t,oe)},G=function(){u.drawElementText(e,t,null,n)};e.lineJoin="round";var Z=t.pstyle("ghost").value==="yes";if(Z){var Q=t.pstyle("ghost-offset-x").pfValue,X=t.pstyle("ghost-offset-y").pfValue,ie=t.pstyle("ghost-opacity").value,te=P*ie;e.translate(Q,X),z(te),$(te),e.translate(-Q,-X)}else O();U(),z(),$(),V(),G(),r&&e.translate(d.x1,d.y1)}};var rR=function(t){if(!["overlay","underlay"].includes(t))throw new Error("Invalid state");return function(r,n){if(n.visible()){var i=n.pstyle("".concat(t,"-opacity")).value;if(i!==0){var s=this,u=s.usePaths(),a=n._private.rscratch,d=n.pstyle("".concat(t,"-padding")).pfValue,p=2*d,g=n.pstyle("".concat(t,"-color")).value;r.lineWidth=p,a.edgeType==="self"&&!u?r.lineCap="butt":r.lineCap="round",s.colorStrokeStyle(r,g[0],g[1],g[2],i),s.drawEdgePath(n,r,a.allpts,"solid")}}}};Uo.drawEdgeOverlay=rR("overlay");Uo.drawEdgeUnderlay=rR("underlay");Uo.drawEdgePath=function(e,t,r,n){var i=e._private.rscratch,s=t,u,a=!1,d=this.usePaths(),p=e.pstyle("line-dash-pattern").pfValue,g=e.pstyle("line-dash-offset").pfValue;if(d){var v=r.join("$"),_=i.pathCacheKey&&i.pathCacheKey===v;_?(u=t=i.pathCache,a=!0):(u=t=new Path2D,i.pathCacheKey=v,i.pathCache=u)}if(s.setLineDash)switch(n){case"dotted":s.setLineDash([1,1]);break;case"dashed":s.setLineDash(p),s.lineDashOffset=g;break;case"solid":s.setLineDash([]);break}if(!a&&!i.badLine)switch(t.beginPath&&t.beginPath(),t.moveTo(r[0],r[1]),i.edgeType){case"bezier":case"self":case"compound":case"multibezier":for(var b=2;b+3<r.length;b+=4)t.quadraticCurveTo(r[b],r[b+1],r[b+2],r[b+3]);break;case"straight":case"haystack":for(var k=2;k+1<r.length;k+=2)t.lineTo(r[k],r[k+1]);break;case"segments":if(i.isRound){var A=va(i.roundCorners),M;try{for(A.s();!(M=A.n()).done;){var P=M.value;qz(t,P)}}catch(z){A.e(z)}finally{A.f()}t.lineTo(r[r.length-2],r[r.length-1])}else for(var I=2;I+1<r.length;I+=2)t.lineTo(r[I],r[I+1]);break}t=s,d?t.stroke(u):t.stroke(),t.setLineDash&&t.setLineDash([])};Uo.drawEdgeTrianglePath=function(e,t,r){t.fillStyle=t.strokeStyle;for(var n=e.pstyle("width").pfValue,i=0;i+1<r.length;i+=2){var s=[r[i+2]-r[i],r[i+3]-r[i+1]],u=Math.sqrt(s[0]*s[0]+s[1]*s[1]),a=[s[1]/u,-s[0]/u],d=[a[0]*n/2,a[1]*n/2];t.beginPath(),t.moveTo(r[i]-d[0],r[i+1]-d[1]),t.lineTo(r[i]+d[0],r[i+1]+d[1]),t.lineTo(r[i+2],r[i+3]),t.closePath(),t.fill()}};Uo.drawArrowheads=function(e,t,r){var n=t._private.rscratch,i=n.edgeType==="haystack";i||this.drawArrowhead(e,t,"source",n.arrowStartX,n.arrowStartY,n.srcArrowAngle,r),this.drawArrowhead(e,t,"mid-target",n.midX,n.midY,n.midtgtArrowAngle,r),this.drawArrowhead(e,t,"mid-source",n.midX,n.midY,n.midsrcArrowAngle,r),i||this.drawArrowhead(e,t,"target",n.arrowEndX,n.arrowEndY,n.tgtArrowAngle,r)};Uo.drawArrowhead=function(e,t,r,n,i,s,u){if(!(isNaN(n)||n==null||isNaN(i)||i==null||isNaN(s)||s==null)){var a=this,d=t.pstyle(r+"-arrow-shape").value;if(d!=="none"){var p=t.pstyle(r+"-arrow-fill").value==="hollow"?"both":"filled",g=t.pstyle(r+"-arrow-fill").value,v=t.pstyle("width").pfValue,_=t.pstyle(r+"-arrow-width"),b=_.value==="match-line"?v:_.pfValue;_.units==="%"&&(b*=v);var k=t.pstyle("opacity").value;u===void 0&&(u=k);var A=e.globalCompositeOperation;(u!==1||g==="hollow")&&(e.globalCompositeOperation="destination-out",a.colorFillStyle(e,255,255,255,1),a.colorStrokeStyle(e,255,255,255,1),a.drawArrowShape(t,e,p,v,d,b,n,i,s),e.globalCompositeOperation=A);var M=t.pstyle(r+"-arrow-color").value;a.colorFillStyle(e,M[0],M[1],M[2],u),a.colorStrokeStyle(e,M[0],M[1],M[2],u),a.drawArrowShape(t,e,g,v,d,b,n,i,s)}}};Uo.drawArrowShape=function(e,t,r,n,i,s,u,a,d){var p=this,g=this.usePaths()&&i!=="triangle-cross",v=!1,_,b=t,k={x:u,y:a},A=e.pstyle("arrow-scale").value,M=this.getArrowWidth(n,A),P=p.arrowShapes[i];if(g){var I=p.arrowPathCache=p.arrowPathCache||[],z=gc(i),O=I[z];O!=null?(_=t=O,v=!0):(_=t=new Path2D,I[z]=_)}v||(t.beginPath&&t.beginPath(),g?P.draw(t,1,0,{x:0,y:0},1):P.draw(t,M,d,k,n),t.closePath&&t.closePath()),t=b,g&&(t.translate(u,a),t.rotate(d),t.scale(M,M)),(r==="filled"||r==="both")&&(g?t.fill(_):t.fill()),(r==="hollow"||r==="both")&&(t.lineWidth=s/(g?M:1),t.lineJoin="miter",g?t.stroke(_):t.stroke()),g&&(t.scale(1/M,1/M),t.rotate(-d),t.translate(-u,-a))};var $S={};$S.safeDrawImage=function(e,t,r,n,i,s,u,a,d,p){if(!(i<=0||s<=0||d<=0||p<=0))try{e.drawImage(t,r,n,i,s,u,a,d,p)}catch(g){Gr(g)}};$S.drawInscribedImage=function(e,t,r,n,i){var s=this,u=r.position(),a=u.x,d=u.y,p=r.cy().style(),g=p.getIndexedStyle.bind(p),v=g(r,"background-fit","value",n),_=g(r,"background-repeat","value",n),b=r.width(),k=r.height(),A=r.padding()*2,M=b+(g(r,"background-width-relative-to","value",n)==="inner"?0:A),P=k+(g(r,"background-height-relative-to","value",n)==="inner"?0:A),I=r._private.rscratch,z=g(r,"background-clip","value",n),O=z==="node",V=g(r,"background-image-opacity","value",n)*i,U=g(r,"background-image-smoothing","value",n),$=r.pstyle("corner-radius").value;$!=="auto"&&($=r.pstyle("corner-radius").pfValue);var G=t.width||t.cachedW,Z=t.height||t.cachedH;(G==null||Z==null)&&(document.body.appendChild(t),G=t.cachedW=t.width||t.offsetWidth,Z=t.cachedH=t.height||t.offsetHeight,document.body.removeChild(t));var Q=G,X=Z;if(g(r,"background-width","value",n)!=="auto"&&(g(r,"background-width","units",n)==="%"?Q=g(r,"background-width","pfValue",n)*M:Q=g(r,"background-width","pfValue",n)),g(r,"background-height","value",n)!=="auto"&&(g(r,"background-height","units",n)==="%"?X=g(r,"background-height","pfValue",n)*P:X=g(r,"background-height","pfValue",n)),!(Q===0||X===0)){if(v==="contain"){var ie=Math.min(M/Q,P/X);Q*=ie,X*=ie}else if(v==="cover"){var ie=Math.max(M/Q,P/X);Q*=ie,X*=ie}var te=a-M/2,W=g(r,"background-position-x","units",n),oe=g(r,"background-position-x","pfValue",n);W==="%"?te+=(M-Q)*oe:te+=oe;var se=g(r,"background-offset-x","units",n),de=g(r,"background-offset-x","pfValue",n);se==="%"?te+=(M-Q)*de:te+=de;var me=d-P/2,ae=g(r,"background-position-y","units",n),ve=g(r,"background-position-y","pfValue",n);ae==="%"?me+=(P-X)*ve:me+=ve;var pe=g(r,"background-offset-y","units",n),_e=g(r,"background-offset-y","pfValue",n);pe==="%"?me+=(P-X)*_e:me+=_e,I.pathCache&&(te-=a,me-=d,a=0,d=0);var De=e.globalAlpha;e.globalAlpha=V;var Le=s.getImgSmoothing(e),je=!1;if(U==="no"&&Le?(s.setImgSmoothing(e,!1),je=!0):U==="yes"&&!Le&&(s.setImgSmoothing(e,!0),je=!0),_==="no-repeat")O&&(e.save(),I.pathCache?e.clip(I.pathCache):(s.nodeShapes[s.getNodeShape(r)].draw(e,a,d,M,P,$,I),e.clip())),s.safeDrawImage(e,t,0,0,G,Z,te,me,Q,X),O&&e.restore();else{var Je=e.createPattern(t,_);e.fillStyle=Je,s.nodeShapes[s.getNodeShape(r)].draw(e,a,d,M,P,$,I),e.translate(te,me),e.fill(),e.translate(-te,-me)}e.globalAlpha=De,je&&s.setImgSmoothing(e,Le)}};var Pc={};Pc.eleTextBiggerThanMin=function(e,t){if(!t){var r=e.cy().zoom(),n=this.getPixelRatio(),i=Math.ceil(TS(r*n));t=Math.pow(2,i)}var s=e.pstyle("font-size").pfValue*t,u=e.pstyle("min-zoomed-font-size").pfValue;return!(s<u)};Pc.drawElementText=function(e,t,r,n,i){var s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,u=this;if(n==null){if(s&&!u.eleTextBiggerThanMin(t))return}else if(n===!1)return;if(t.isNode()){var a=t.pstyle("label");if(!a||!a.value)return;var d=u.getLabelJustification(t);e.textAlign=d,e.textBaseline="bottom"}else{var p=t.element()._private.rscratch.badLine,g=t.pstyle("label"),v=t.pstyle("source-label"),_=t.pstyle("target-label");if(p||(!g||!g.value)&&(!v||!v.value)&&(!_||!_.value))return;e.textAlign="center",e.textBaseline="bottom"}var b=!r,k;r&&(k=r,e.translate(-k.x1,-k.y1)),i==null?(u.drawText(e,t,null,b,s),t.isEdge()&&(u.drawText(e,t,"source",b,s),u.drawText(e,t,"target",b,s))):u.drawText(e,t,i,b,s),r&&e.translate(k.x1,k.y1)};Pc.getFontCache=function(e){var t;this.fontCaches=this.fontCaches||[];for(var r=0;r<this.fontCaches.length;r++)if(t=this.fontCaches[r],t.context===e)return t;return t={context:e},this.fontCaches.push(t),t};Pc.setupTextStyle=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,n=t.pstyle("font-style").strValue,i=t.pstyle("font-size").pfValue+"px",s=t.pstyle("font-family").strValue,u=t.pstyle("font-weight").strValue,a=r?t.effectiveOpacity()*t.pstyle("text-opacity").value:1,d=t.pstyle("text-outline-opacity").value*a,p=t.pstyle("color").value,g=t.pstyle("text-outline-color").value;e.font=n+" "+u+" "+i+" "+s,e.lineJoin="round",this.colorFillStyle(e,p[0],p[1],p[2],a),this.colorStrokeStyle(e,g[0],g[1],g[2],d)};function WU(e,t,r,n,i){var s=Math.min(n,i),u=s/2,a=t+n/2,d=r+i/2;e.beginPath(),e.arc(a,d,u,0,Math.PI*2),e.closePath()}function zI(e,t,r,n,i){var s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:5,u=Math.min(s,n/2,i/2);e.beginPath(),e.moveTo(t+u,r),e.lineTo(t+n-u,r),e.quadraticCurveTo(t+n,r,t+n,r+u),e.lineTo(t+n,r+i-u),e.quadraticCurveTo(t+n,r+i,t+n-u,r+i),e.lineTo(t+u,r+i),e.quadraticCurveTo(t,r+i,t,r+i-u),e.lineTo(t,r+u),e.quadraticCurveTo(t,r,t+u,r),e.closePath()}Pc.getTextAngle=function(e,t){var r,n=e._private,i=n.rscratch,s=t?t+"-":"",u=e.pstyle(s+"text-rotation");if(u.strValue==="autorotate"){var a=fa(i,"labelAngle",t);r=e.isEdge()?a:0}else u.strValue==="none"?r=0:r=u.pfValue;return r};Pc.drawText=function(e,t,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,s=t._private,u=s.rscratch,a=i?t.effectiveOpacity():1;if(!(i&&(a===0||t.pstyle("text-opacity").value===0))){r==="main"&&(r=null);var d=fa(u,"labelX",r),p=fa(u,"labelY",r),g,v,_=this.getLabelText(t,r);if(_!=null&&_!==""&&!isNaN(d)&&!isNaN(p)){this.setupTextStyle(e,t,i);var b=r?r+"-":"",k=fa(u,"labelWidth",r),A=fa(u,"labelHeight",r),M=t.pstyle(b+"text-margin-x").pfValue,P=t.pstyle(b+"text-margin-y").pfValue,I=t.isEdge(),z=t.pstyle("text-halign").value,O=t.pstyle("text-valign").value;I&&(z="center",O="center"),d+=M,p+=P;var V;switch(n?V=this.getTextAngle(t,r):V=0,V!==0&&(g=d,v=p,e.translate(g,v),e.rotate(V),d=0,p=0),O){case"top":break;case"center":p+=A/2;break;case"bottom":p+=A;break}var U=t.pstyle("text-background-opacity").value,$=t.pstyle("text-border-opacity").value,G=t.pstyle("text-border-width").pfValue,Z=t.pstyle("text-background-padding").pfValue,Q=t.pstyle("text-background-shape").strValue,X=Q==="round-rectangle"||Q==="roundrectangle",ie=Q==="circle",te=2;if(U>0||G>0&&$>0){var W=e.fillStyle,oe=e.strokeStyle,se=e.lineWidth,de=t.pstyle("text-background-color").value,me=t.pstyle("text-border-color").value,ae=t.pstyle("text-border-style").value,ve=U>0,pe=G>0&&$>0,_e=d-Z;switch(z){case"left":_e-=k;break;case"center":_e-=k/2;break}var De=p-A-Z,Le=k+2*Z,je=A+2*Z;if(ve&&(e.fillStyle="rgba(".concat(de[0],",").concat(de[1],",").concat(de[2],",").concat(U*a,")")),pe&&(e.strokeStyle="rgba(".concat(me[0],",").concat(me[1],",").concat(me[2],",").concat($*a,")"),e.lineWidth=G,e.setLineDash))switch(ae){case"dotted":e.setLineDash([1,1]);break;case"dashed":e.setLineDash([4,2]);break;case"double":e.lineWidth=G/4,e.setLineDash([]);break;case"solid":default:e.setLineDash([]);break}if(X?(e.beginPath(),zI(e,_e,De,Le,je,te)):ie?(e.beginPath(),WU(e,_e,De,Le,je)):(e.beginPath(),e.rect(_e,De,Le,je)),ve&&e.fill(),pe&&e.stroke(),pe&&ae==="double"){var Je=G/2;e.beginPath(),X?zI(e,_e+Je,De+Je,Le-2*Je,je-2*Je,te):e.rect(_e+Je,De+Je,Le-2*Je,je-2*Je),e.stroke()}e.fillStyle=W,e.strokeStyle=oe,e.lineWidth=se,e.setLineDash&&e.setLineDash([])}var et=2*t.pstyle("text-outline-width").pfValue;if(et>0&&(e.lineWidth=et),t.pstyle("text-wrap").value==="wrap"){var ft=fa(u,"labelWrapCachedLines",r),rt=fa(u,"labelLineHeight",r),Oe=k/2,Ge=this.getLabelJustification(t);switch(Ge==="auto"||(z==="left"?Ge==="left"?d+=-k:Ge==="center"&&(d+=-Oe):z==="center"?Ge==="left"?d+=-Oe:Ge==="right"&&(d+=Oe):z==="right"&&(Ge==="center"?d+=Oe:Ge==="right"&&(d+=k))),O){case"top":p-=(ft.length-1)*rt;break;case"center":case"bottom":p-=(ft.length-1)*rt;break}for(var Ze=0;Ze<ft.length;Ze++)et>0&&e.strokeText(ft[Ze],d,p),e.fillText(ft[Ze],d,p),p+=rt}else et>0&&e.strokeText(_,d,p),e.fillText(_,d,p);V!==0&&(e.rotate(-V),e.translate(-g,-v))}}};var pu={};pu.drawNode=function(e,t,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,u=this,a,d,p=t._private,g=p.rscratch,v=t.position();if(!(!Rt(v.x)||!Rt(v.y))&&!(s&&!t.visible())){var _=s?t.effectiveOpacity():1,b=u.usePaths(),k,A=!1,M=t.padding();a=t.width()+2*M,d=t.height()+2*M;var P;r&&(P=r,e.translate(-P.x1,-P.y1));for(var I=t.pstyle("background-image"),z=I.value,O=new Array(z.length),V=new Array(z.length),U=0,$=0;$<z.length;$++){var G=z[$],Z=O[$]=G!=null&&G!=="none";if(Z){var Q=t.cy().style().getIndexedStyle(t,"background-image-crossorigin","value",$);U++,V[$]=u.getCachedImage(G,Q,function(){p.backgroundTimestamp=Date.now(),t.emitAndNotify("background")})}}var X=t.pstyle("background-blacken").value,ie=t.pstyle("border-width").pfValue,te=t.pstyle("background-opacity").value*_,W=t.pstyle("border-color").value,oe=t.pstyle("border-style").value,se=t.pstyle("border-join").value,de=t.pstyle("border-cap").value,me=t.pstyle("border-position").value,ae=t.pstyle("border-dash-pattern").pfValue,ve=t.pstyle("border-dash-offset").pfValue,pe=t.pstyle("border-opacity").value*_,_e=t.pstyle("outline-width").pfValue,De=t.pstyle("outline-color").value,Le=t.pstyle("outline-style").value,je=t.pstyle("outline-opacity").value*_,Je=t.pstyle("outline-offset").value,et=t.pstyle("corner-radius").value;et!=="auto"&&(et=t.pstyle("corner-radius").pfValue);var ft=function(){var wt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:te;u.eleFillStyle(e,t,wt)},rt=function(){var wt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:pe;u.colorStrokeStyle(e,W[0],W[1],W[2],wt)},Oe=function(){var wt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:je;u.colorStrokeStyle(e,De[0],De[1],De[2],wt)},Ge=function(wt,at,le,Be){var Ue=u.nodePathCache=u.nodePathCache||[],tt=$N(le==="polygon"?le+","+Be.join(","):le,""+at,""+wt,""+et),st=Ue[tt],dt,ht=!1;return st!=null?(dt=st,ht=!0,g.pathCache=dt):(dt=new Path2D,Ue[tt]=g.pathCache=dt),{path:dt,cacheHit:ht}},Ze=t.pstyle("shape").strValue,it=t.pstyle("shape-polygon-points").pfValue;if(b){e.translate(v.x,v.y);var mt=Ge(a,d,Ze,it);k=mt.path,A=mt.cacheHit}var Tt=function(){if(!A){var wt=v;b&&(wt={x:0,y:0}),u.nodeShapes[u.getNodeShape(t)].draw(k||e,wt.x,wt.y,a,d,et,g)}b?e.fill(k):e.fill()},$e=function(){for(var wt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:_,at=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,le=p.backgrounding,Be=0,Ue=0;Ue<V.length;Ue++){var tt=t.cy().style().getIndexedStyle(t,"background-image-containment","value",Ue);if(at&&tt==="over"||!at&&tt==="inside"){Be++;continue}O[Ue]&&V[Ue].complete&&!V[Ue].error&&(Be++,u.drawInscribedImage(e,V[Ue],t,Ue,wt))}p.backgrounding=Be!==U,le!==p.backgrounding&&t.updateStyle(!1)},At=function(){var wt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,at=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_;u.hasPie(t)&&(u.drawPie(e,t,at),wt&&(b||u.nodeShapes[u.getNodeShape(t)].draw(e,v.x,v.y,a,d,et,g)))},pt=function(){var wt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,at=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_;u.hasStripe(t)&&(e.save(),b?e.clip(g.pathCache):(u.nodeShapes[u.getNodeShape(t)].draw(e,v.x,v.y,a,d,et,g),e.clip()),u.drawStripe(e,t,at),e.restore(),wt&&(b||u.nodeShapes[u.getNodeShape(t)].draw(e,v.x,v.y,a,d,et,g)))},yt=function(){var wt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:_,at=(X>0?X:-X)*wt,le=X>0?0:255;X!==0&&(u.colorFillStyle(e,le,le,le,at),b?e.fill(k):e.fill())},gt=function(){if(ie>0){if(e.lineWidth=ie,e.lineCap=de,e.lineJoin=se,e.setLineDash)switch(oe){case"dotted":e.setLineDash([1,1]);break;case"dashed":e.setLineDash(ae),e.lineDashOffset=ve;break;case"solid":case"double":e.setLineDash([]);break}if(me!=="center"){if(e.save(),e.lineWidth*=2,me==="inside")b?e.clip(k):e.clip();else{var wt=new Path2D;wt.rect(-a/2-ie,-d/2-ie,a+2*ie,d+2*ie),wt.addPath(k),e.clip(wt,"evenodd")}b?e.stroke(k):e.stroke(),e.restore()}else b?e.stroke(k):e.stroke();if(oe==="double"){e.lineWidth=ie/3;var at=e.globalCompositeOperation;e.globalCompositeOperation="destination-out",b?e.stroke(k):e.stroke(),e.globalCompositeOperation=at}e.setLineDash&&e.setLineDash([])}},qt=function(){if(_e>0){if(e.lineWidth=_e,e.lineCap="butt",e.setLineDash)switch(Le){case"dotted":e.setLineDash([1,1]);break;case"dashed":e.setLineDash([4,2]);break;case"solid":case"double":e.setLineDash([]);break}var wt=v;b&&(wt={x:0,y:0});var at=u.getNodeShape(t),le=ie;me==="inside"&&(le=0),me==="outside"&&(le*=2);var Be=(a+le+(_e+Je))/a,Ue=(d+le+(_e+Je))/d,tt=a*Be,st=d*Ue,dt=u.nodeShapes[at].points,ht;if(b){var Ot=Ge(tt,st,at,dt);ht=Ot.path}if(at==="ellipse")u.drawEllipsePath(ht||e,wt.x,wt.y,tt,st);else if(["round-diamond","round-heptagon","round-hexagon","round-octagon","round-pentagon","round-polygon","round-triangle","round-tag"].includes(at)){var Lt=0,Kt=0,Se=0;at==="round-diamond"?Lt=(le+Je+_e)*1.4:at==="round-heptagon"?(Lt=(le+Je+_e)*1.075,Se=-(le/2+Je+_e)/35):at==="round-hexagon"?Lt=(le+Je+_e)*1.12:at==="round-pentagon"?(Lt=(le+Je+_e)*1.13,Se=-(le/2+Je+_e)/15):at==="round-tag"?(Lt=(le+Je+_e)*1.12,Kt=(le/2+_e+Je)*.07):at==="round-triangle"&&(Lt=(le+Je+_e)*(Math.PI/2),Se=-(le+Je/2+_e)/Math.PI),Lt!==0&&(Be=(a+Lt)/a,tt=a*Be,["round-hexagon","round-tag"].includes(at)||(Ue=(d+Lt)/d,st=d*Ue)),et=et==="auto"?YN(tt,st):et;for(var re=tt/2,ee=st/2,fe=et+(le+_e+Je)/2,we=new Array(dt.length/2),Me=new Array(dt.length/2),Ne=0;Ne<dt.length/2;Ne++)we[Ne]={x:wt.x+Kt+re*dt[Ne*2],y:wt.y+Se+ee*dt[Ne*2+1]};var Ve,ke,Ye,ot,Xe=we.length;for(ke=we[Xe-1],Ve=0;Ve<Xe;Ve++)Ye=we[Ve%Xe],ot=we[(Ve+1)%Xe],Me[Ve]=FS(ke,Ye,ot,fe),ke=Ye,Ye=ot;u.drawRoundPolygonPath(ht||e,wt.x+Kt,wt.y+Se,a*Be,d*Ue,dt,Me)}else if(["roundrectangle","round-rectangle"].includes(at))et=et==="auto"?iu(tt,st):et,u.drawRoundRectanglePath(ht||e,wt.x,wt.y,tt,st,et+(le+_e+Je)/2);else if(["cutrectangle","cut-rectangle"].includes(at))et=et==="auto"?PS():et,u.drawCutRectanglePath(ht||e,wt.x,wt.y,tt,st,null,et+(le+_e+Je)/4);else if(["bottomroundrectangle","bottom-round-rectangle"].includes(at))et=et==="auto"?iu(tt,st):et,u.drawBottomRoundRectanglePath(ht||e,wt.x,wt.y,tt,st,et+(le+_e+Je)/2);else if(at==="barrel")u.drawBarrelPath(ht||e,wt.x,wt.y,tt,st);else if(at.startsWith("polygon")||["rhomboid","right-rhomboid","round-tag","tag","vee"].includes(at)){var xt=(le+_e+Je)/a;dt=Gy(Wy(dt,xt)),u.drawPolygonPath(ht||e,wt.x,wt.y,a,d,dt)}else{var Ct=(le+_e+Je)/a;dt=Gy(Wy(dt,-Ct)),u.drawPolygonPath(ht||e,wt.x,wt.y,a,d,dt)}if(b?e.stroke(ht):e.stroke(),Le==="double"){e.lineWidth=le/3;var Ut=e.globalCompositeOperation;e.globalCompositeOperation="destination-out",b?e.stroke(ht):e.stroke(),e.globalCompositeOperation=Ut}e.setLineDash&&e.setLineDash([])}},$t=function(){i&&u.drawNodeOverlay(e,t,v,a,d)},er=function(){i&&u.drawNodeUnderlay(e,t,v,a,d)},Vt=function(){u.drawElementText(e,t,null,n)},tr=t.pstyle("ghost").value==="yes";if(tr){var pr=t.pstyle("ghost-offset-x").pfValue,vr=t.pstyle("ghost-offset-y").pfValue,lt=t.pstyle("ghost-opacity").value,mr=lt*_;e.translate(pr,vr),Oe(),qt(),ft(lt*te),Tt(),$e(mr,!0),rt(lt*pe),gt(),At(X!==0||ie!==0),pt(X!==0||ie!==0),$e(mr,!1),yt(mr),e.translate(-pr,-vr)}b&&e.translate(-v.x,-v.y),er(),b&&e.translate(v.x,v.y),Oe(),qt(),ft(),Tt(),$e(_,!0),rt(),gt(),At(X!==0||ie!==0),pt(X!==0||ie!==0),$e(_,!1),yt(),b&&e.translate(-v.x,-v.y),Vt(),$t(),r&&e.translate(P.x1,P.y1)}};var nR=function(t){if(!["overlay","underlay"].includes(t))throw new Error("Invalid state");return function(r,n,i,s,u){var a=this;if(n.visible()){var d=n.pstyle("".concat(t,"-padding")).pfValue,p=n.pstyle("".concat(t,"-opacity")).value,g=n.pstyle("".concat(t,"-color")).value,v=n.pstyle("".concat(t,"-shape")).value,_=n.pstyle("".concat(t,"-corner-radius")).value;if(p>0){if(i=i||n.position(),s==null||u==null){var b=n.padding();s=n.width()+2*b,u=n.height()+2*b}a.colorFillStyle(r,g[0],g[1],g[2],p),a.nodeShapes[v].draw(r,i.x,i.y,s+d*2,u+d*2,_),r.fill()}}}};pu.drawNodeOverlay=nR("overlay");pu.drawNodeUnderlay=nR("underlay");pu.hasPie=function(e){return e=e[0],e._private.hasPie};pu.hasStripe=function(e){return e=e[0],e._private.hasStripe};pu.drawPie=function(e,t,r,n){t=t[0],n=n||t.position();var i=t.cy().style(),s=t.pstyle("pie-size"),u=t.pstyle("pie-hole"),a=t.pstyle("pie-start-angle").pfValue,d=n.x,p=n.y,g=t.width(),v=t.height(),_=Math.min(g,v)/2,b,k=0,A=this.usePaths();if(A&&(d=0,p=0),s.units==="%"?_=_*s.pfValue:s.pfValue!==void 0&&(_=s.pfValue/2),u.units==="%"?b=_*u.pfValue:u.pfValue!==void 0&&(b=u.pfValue/2),!(b>=_))for(var M=1;M<=i.pieBackgroundN;M++){var P=t.pstyle("pie-"+M+"-background-size").value,I=t.pstyle("pie-"+M+"-background-color").value,z=t.pstyle("pie-"+M+"-background-opacity").value*r,O=P/100;O+k>1&&(O=1-k);var V=1.5*Math.PI+2*Math.PI*k;V+=a;var U=2*Math.PI*O,$=V+U;P===0||k>=1||k+O>1||(b===0?(e.beginPath(),e.moveTo(d,p),e.arc(d,p,_,V,$),e.closePath()):(e.beginPath(),e.arc(d,p,_,V,$),e.arc(d,p,b,$,V,!0),e.closePath()),this.colorFillStyle(e,I[0],I[1],I[2],z),e.fill(),k+=O)}};pu.drawStripe=function(e,t,r,n){t=t[0],n=n||t.position();var i=t.cy().style(),s=n.x,u=n.y,a=t.width(),d=t.height(),p=0,g=this.usePaths();e.save();var v=t.pstyle("stripe-direction").value,_=t.pstyle("stripe-size");switch(v){case"vertical":break;case"righward":e.rotate(-Math.PI/2);break}var b=a,k=d;_.units==="%"?(b=b*_.pfValue,k=k*_.pfValue):_.pfValue!==void 0&&(b=_.pfValue,k=_.pfValue),g&&(s=0,u=0),u-=b/2,s-=k/2;for(var A=1;A<=i.stripeBackgroundN;A++){var M=t.pstyle("stripe-"+A+"-background-size").value,P=t.pstyle("stripe-"+A+"-background-color").value,I=t.pstyle("stripe-"+A+"-background-opacity").value*r,z=M/100;z+p>1&&(z=1-p),!(M===0||p>=1||p+z>1)&&(e.beginPath(),e.rect(s,u+k*p,b,k*z),e.closePath(),this.colorFillStyle(e,P[0],P[1],P[2],I),e.fill(),p+=z)}e.restore()};var ia={},ZU=100;ia.getPixelRatio=function(){var e=this.data.contexts[0];if(this.forcedPixelRatio!=null)return this.forcedPixelRatio;var t=this.cy.window(),r=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return(t.devicePixelRatio||1)/r};ia.paintCache=function(e){for(var t=this.paintCaches=this.paintCaches||[],r=!0,n,i=0;i<t.length;i++)if(n=t[i],n.context===e){r=!1;break}return r&&(n={context:e},t.push(n)),n};ia.createGradientStyleFor=function(e,t,r,n,i){var s,u=this.usePaths(),a=r.pstyle(t+"-gradient-stop-colors").value,d=r.pstyle(t+"-gradient-stop-positions").pfValue;if(n==="radial-gradient")if(r.isEdge()){var p=r.sourceEndpoint(),g=r.targetEndpoint(),v=r.midpoint(),_=vc(p,v),b=vc(g,v);s=e.createRadialGradient(v.x,v.y,0,v.x,v.y,Math.max(_,b))}else{var k=u?{x:0,y:0}:r.position(),A=r.paddedWidth(),M=r.paddedHeight();s=e.createRadialGradient(k.x,k.y,0,k.x,k.y,Math.max(A,M))}else if(r.isEdge()){var P=r.sourceEndpoint(),I=r.targetEndpoint();s=e.createLinearGradient(P.x,P.y,I.x,I.y)}else{var z=u?{x:0,y:0}:r.position(),O=r.paddedWidth(),V=r.paddedHeight(),U=O/2,$=V/2,G=r.pstyle("background-gradient-direction").value;switch(G){case"to-bottom":s=e.createLinearGradient(z.x,z.y-$,z.x,z.y+$);break;case"to-top":s=e.createLinearGradient(z.x,z.y+$,z.x,z.y-$);break;case"to-left":s=e.createLinearGradient(z.x+U,z.y,z.x-U,z.y);break;case"to-right":s=e.createLinearGradient(z.x-U,z.y,z.x+U,z.y);break;case"to-bottom-right":case"to-right-bottom":s=e.createLinearGradient(z.x-U,z.y-$,z.x+U,z.y+$);break;case"to-top-right":case"to-right-top":s=e.createLinearGradient(z.x-U,z.y+$,z.x+U,z.y-$);break;case"to-bottom-left":case"to-left-bottom":s=e.createLinearGradient(z.x+U,z.y-$,z.x-U,z.y+$);break;case"to-top-left":case"to-left-top":s=e.createLinearGradient(z.x+U,z.y+$,z.x-U,z.y-$);break}}if(!s)return null;for(var Z=d.length===a.length,Q=a.length,X=0;X<Q;X++)s.addColorStop(Z?d[X]:X/(Q-1),"rgba("+a[X][0]+","+a[X][1]+","+a[X][2]+","+i+")");return s};ia.gradientFillStyle=function(e,t,r,n){var i=this.createGradientStyleFor(e,"background",t,r,n);if(!i)return null;e.fillStyle=i};ia.colorFillStyle=function(e,t,r,n,i){e.fillStyle="rgba("+t+","+r+","+n+","+i+")"};ia.eleFillStyle=function(e,t,r){var n=t.pstyle("background-fill").value;if(n==="linear-gradient"||n==="radial-gradient")this.gradientFillStyle(e,t,n,r);else{var i=t.pstyle("background-color").value;this.colorFillStyle(e,i[0],i[1],i[2],r)}};ia.gradientStrokeStyle=function(e,t,r,n){var i=this.createGradientStyleFor(e,"line",t,r,n);if(!i)return null;e.strokeStyle=i};ia.colorStrokeStyle=function(e,t,r,n,i){e.strokeStyle="rgba("+t+","+r+","+n+","+i+")"};ia.eleStrokeStyle=function(e,t,r){var n=t.pstyle("line-fill").value;if(n==="linear-gradient"||n==="radial-gradient")this.gradientStrokeStyle(e,t,n,r);else{var i=t.pstyle("line-color").value;this.colorStrokeStyle(e,i[0],i[1],i[2],r)}};ia.matchCanvasSize=function(e){var t=this,r=t.data,n=t.findContainerClientCoords(),i=n[2],s=n[3],u=t.getPixelRatio(),a=t.motionBlurPxRatio;(e===t.data.bufferCanvases[t.MOTIONBLUR_BUFFER_NODE]||e===t.data.bufferCanvases[t.MOTIONBLUR_BUFFER_DRAG])&&(u=a);var d=i*u,p=s*u,g;if(!(d===t.canvasWidth&&p===t.canvasHeight)){t.fontCaches=null;var v=r.canvasContainer;v.style.width=i+"px",v.style.height=s+"px";for(var _=0;_<t.CANVAS_LAYERS;_++)g=r.canvases[_],g.width=d,g.height=p,g.style.width=i+"px",g.style.height=s+"px";for(var _=0;_<t.BUFFER_COUNT;_++)g=r.bufferCanvases[_],g.width=d,g.height=p,g.style.width=i+"px",g.style.height=s+"px";t.textureMult=1,u<=1&&(g=r.bufferCanvases[t.TEXTURE_BUFFER],t.textureMult=2,g.width=d*t.textureMult,g.height=p*t.textureMult),t.canvasWidth=d,t.canvasHeight=p,t.pixelRatio=u}};ia.renderTo=function(e,t,r,n){this.render({forcedContext:e,forcedZoom:t,forcedPan:r,drawAllLayers:!0,forcedPxRatio:n})};ia.clearCanvas=function(){var e=this,t=e.data;function r(n){n.clearRect(0,0,e.canvasWidth,e.canvasHeight)}r(t.contexts[e.NODE]),r(t.contexts[e.DRAG])};ia.render=function(e){var t=this;e=e||HN();var r=t.cy,n=e.forcedContext,i=e.drawAllLayers,s=e.drawOnlyNodeLayer,u=e.forcedZoom,a=e.forcedPan,d=e.forcedPxRatio===void 0?this.getPixelRatio():e.forcedPxRatio,p=t.data,g=p.canvasNeedsRedraw,v=t.textureOnViewport&&!n&&(t.pinching||t.hoverData.dragging||t.swipePanning||t.data.wheelZooming),_=e.motionBlur!==void 0?e.motionBlur:t.motionBlur,b=t.motionBlurPxRatio,k=r.hasCompoundNodes(),A=t.hoverData.draggingEles,M=!!(t.hoverData.selecting||t.touchData.selecting);_=_&&!n&&t.motionBlurEnabled&&!M;var P=_;n||(t.prevPxRatio!==d&&(t.invalidateContainerClientCoordsCache(),t.matchCanvasSize(t.container),t.redrawHint("eles",!0),t.redrawHint("drag",!0)),t.prevPxRatio=d),!n&&t.motionBlurTimeout&&clearTimeout(t.motionBlurTimeout),_&&(t.mbFrames==null&&(t.mbFrames=0),t.mbFrames++,t.mbFrames<3&&(P=!1),t.mbFrames>t.minMbLowQualFrames&&(t.motionBlurPxRatio=t.mbPxRBlurry)),t.clearingMotionBlur&&(t.motionBlurPxRatio=1),t.textureDrawLastFrame&&!v&&(g[t.NODE]=!0,g[t.SELECT_BOX]=!0);var I=r.style(),z=r.zoom(),O=u!==void 0?u:z,V=r.pan(),U={x:V.x,y:V.y},$={zoom:z,pan:{x:V.x,y:V.y}},G=t.prevViewport,Z=G===void 0||$.zoom!==G.zoom||$.pan.x!==G.pan.x||$.pan.y!==G.pan.y;!Z&&!(A&&!k)&&(t.motionBlurPxRatio=1),a&&(U=a),O*=d,U.x*=d,U.y*=d;var Q=t.getCachedZSortedEles();function X(rt,Oe,Ge,Ze,it){var mt=rt.globalCompositeOperation;rt.globalCompositeOperation="destination-out",t.colorFillStyle(rt,255,255,255,t.motionBlurTransparency),rt.fillRect(Oe,Ge,Ze,it),rt.globalCompositeOperation=mt}function ie(rt,Oe){var Ge,Ze,it,mt;!t.clearingMotionBlur&&(rt===p.bufferContexts[t.MOTIONBLUR_BUFFER_NODE]||rt===p.bufferContexts[t.MOTIONBLUR_BUFFER_DRAG])?(Ge={x:V.x*b,y:V.y*b},Ze=z*b,it=t.canvasWidth*b,mt=t.canvasHeight*b):(Ge=U,Ze=O,it=t.canvasWidth,mt=t.canvasHeight),rt.setTransform(1,0,0,1,0,0),Oe==="motionBlur"?X(rt,0,0,it,mt):!n&&(Oe===void 0||Oe)&&rt.clearRect(0,0,it,mt),i||(rt.translate(Ge.x,Ge.y),rt.scale(Ze,Ze)),a&&rt.translate(a.x,a.y),u&&rt.scale(u,u)}if(v||(t.textureDrawLastFrame=!1),v){if(t.textureDrawLastFrame=!0,!t.textureCache){t.textureCache={},t.textureCache.bb=r.mutableElements().boundingBox(),t.textureCache.texture=t.data.bufferCanvases[t.TEXTURE_BUFFER];var te=t.data.bufferContexts[t.TEXTURE_BUFFER];te.setTransform(1,0,0,1,0,0),te.clearRect(0,0,t.canvasWidth*t.textureMult,t.canvasHeight*t.textureMult),t.render({forcedContext:te,drawOnlyNodeLayer:!0,forcedPxRatio:d*t.textureMult});var $=t.textureCache.viewport={zoom:r.zoom(),pan:r.pan(),width:t.canvasWidth,height:t.canvasHeight};$.mpan={x:(0-$.pan.x)/$.zoom,y:(0-$.pan.y)/$.zoom}}g[t.DRAG]=!1,g[t.NODE]=!1;var W=p.contexts[t.NODE],oe=t.textureCache.texture,$=t.textureCache.viewport;W.setTransform(1,0,0,1,0,0),_?X(W,0,0,$.width,$.height):W.clearRect(0,0,$.width,$.height);var se=I.core("outside-texture-bg-color").value,de=I.core("outside-texture-bg-opacity").value;t.colorFillStyle(W,se[0],se[1],se[2],de),W.fillRect(0,0,$.width,$.height);var z=r.zoom();ie(W,!1),W.clearRect($.mpan.x,$.mpan.y,$.width/$.zoom/d,$.height/$.zoom/d),W.drawImage(oe,$.mpan.x,$.mpan.y,$.width/$.zoom/d,$.height/$.zoom/d)}else t.textureOnViewport&&!n&&(t.textureCache=null);var me=r.extent(),ae=t.pinching||t.hoverData.dragging||t.swipePanning||t.data.wheelZooming||t.hoverData.draggingEles||t.cy.animated(),ve=t.hideEdgesOnViewport&&ae,pe=[];if(pe[t.NODE]=!g[t.NODE]&&_&&!t.clearedForMotionBlur[t.NODE]||t.clearingMotionBlur,pe[t.NODE]&&(t.clearedForMotionBlur[t.NODE]=!0),pe[t.DRAG]=!g[t.DRAG]&&_&&!t.clearedForMotionBlur[t.DRAG]||t.clearingMotionBlur,pe[t.DRAG]&&(t.clearedForMotionBlur[t.DRAG]=!0),g[t.NODE]||i||s||pe[t.NODE]){var _e=_&&!pe[t.NODE]&&b!==1,W=n||(_e?t.data.bufferContexts[t.MOTIONBLUR_BUFFER_NODE]:p.contexts[t.NODE]),De=_&&!_e?"motionBlur":void 0;ie(W,De),ve?t.drawCachedNodes(W,Q.nondrag,d,me):t.drawLayeredElements(W,Q.nondrag,d,me),t.debug&&t.drawDebugPoints(W,Q.nondrag),!i&&!_&&(g[t.NODE]=!1)}if(!s&&(g[t.DRAG]||i||pe[t.DRAG])){var _e=_&&!pe[t.DRAG]&&b!==1,W=n||(_e?t.data.bufferContexts[t.MOTIONBLUR_BUFFER_DRAG]:p.contexts[t.DRAG]);ie(W,_&&!_e?"motionBlur":void 0),ve?t.drawCachedNodes(W,Q.drag,d,me):t.drawCachedElements(W,Q.drag,d,me),t.debug&&t.drawDebugPoints(W,Q.drag),!i&&!_&&(g[t.DRAG]=!1)}if(this.drawSelectionRectangle(e,ie),_&&b!==1){var Le=p.contexts[t.NODE],je=t.data.bufferCanvases[t.MOTIONBLUR_BUFFER_NODE],Je=p.contexts[t.DRAG],et=t.data.bufferCanvases[t.MOTIONBLUR_BUFFER_DRAG],ft=function(Oe,Ge,Ze){Oe.setTransform(1,0,0,1,0,0),Ze||!P?Oe.clearRect(0,0,t.canvasWidth,t.canvasHeight):X(Oe,0,0,t.canvasWidth,t.canvasHeight);var it=b;Oe.drawImage(Ge,0,0,t.canvasWidth*it,t.canvasHeight*it,0,0,t.canvasWidth,t.canvasHeight)};(g[t.NODE]||pe[t.NODE])&&(ft(Le,je,pe[t.NODE]),g[t.NODE]=!1),(g[t.DRAG]||pe[t.DRAG])&&(ft(Je,et,pe[t.DRAG]),g[t.DRAG]=!1)}t.prevViewport=$,t.clearingMotionBlur&&(t.clearingMotionBlur=!1,t.motionBlurCleared=!0,t.motionBlur=!0),_&&(t.motionBlurTimeout=setTimeout(function(){t.motionBlurTimeout=null,t.clearedForMotionBlur[t.NODE]=!1,t.clearedForMotionBlur[t.DRAG]=!1,t.motionBlur=!1,t.clearingMotionBlur=!v,t.mbFrames=0,g[t.NODE]=!0,g[t.DRAG]=!0,t.redraw()},ZU)),n||r.emit("render")};var sp;ia.drawSelectionRectangle=function(e,t){var r=this,n=r.cy,i=r.data,s=n.style(),u=e.drawOnlyNodeLayer,a=e.drawAllLayers,d=i.canvasNeedsRedraw,p=e.forcedContext;if(r.showFps||!u&&d[r.SELECT_BOX]&&!a){var g=p||i.contexts[r.SELECT_BOX];if(t(g),r.selection[4]==1&&(r.hoverData.selecting||r.touchData.selecting)){var v=r.cy.zoom(),_=s.core("selection-box-border-width").value/v;g.lineWidth=_,g.fillStyle="rgba("+s.core("selection-box-color").value[0]+","+s.core("selection-box-color").value[1]+","+s.core("selection-box-color").value[2]+","+s.core("selection-box-opacity").value+")",g.fillRect(r.selection[0],r.selection[1],r.selection[2]-r.selection[0],r.selection[3]-r.selection[1]),_>0&&(g.strokeStyle="rgba("+s.core("selection-box-border-color").value[0]+","+s.core("selection-box-border-color").value[1]+","+s.core("selection-box-border-color").value[2]+","+s.core("selection-box-opacity").value+")",g.strokeRect(r.selection[0],r.selection[1],r.selection[2]-r.selection[0],r.selection[3]-r.selection[1]))}if(i.bgActivePosistion&&!r.hoverData.selecting){var v=r.cy.zoom(),b=i.bgActivePosistion;g.fillStyle="rgba("+s.core("active-bg-color").value[0]+","+s.core("active-bg-color").value[1]+","+s.core("active-bg-color").value[2]+","+s.core("active-bg-opacity").value+")",g.beginPath(),g.arc(b.x,b.y,s.core("active-bg-size").pfValue/v,0,2*Math.PI),g.fill()}var k=r.lastRedrawTime;if(r.showFps&&k){k=Math.round(k);var A=Math.round(1e3/k),M="1 frame = "+k+" ms = "+A+" fps";if(g.setTransform(1,0,0,1,0,0),g.fillStyle="rgba(255, 0, 0, 0.75)",g.strokeStyle="rgba(255, 0, 0, 0.75)",g.font="30px Arial",!sp){var P=g.measureText(M);sp=P.actualBoundingBoxAscent}g.fillText(M,0,sp);var I=60;g.strokeRect(0,sp+10,250,20),g.fillRect(0,sp+10,250*Math.min(A/I,1),20)}a||(d[r.SELECT_BOX]=!1)}};function RI(e,t,r){var n=e.createShader(t);if(e.shaderSource(n,r),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(n));return n}function XU(e,t,r){var n=RI(e,e.VERTEX_SHADER,t),i=RI(e,e.FRAGMENT_SHADER,r),s=e.createProgram();if(e.attachShader(s,n),e.attachShader(s,i),e.linkProgram(s),!e.getProgramParameter(s,e.LINK_STATUS))throw new Error("Could not initialize shaders");return s}function KU(e,t,r){r===void 0&&(r=t);var n=e.makeOffscreenCanvas(t,r),i=n.context=n.getContext("2d");return n.clear=function(){return i.clearRect(0,0,n.width,n.height)},n.clear(),n}function VS(e){var t=e.pixelRatio,r=e.cy.zoom(),n=e.cy.pan();return{zoom:r*t,pan:{x:n.x*t,y:n.y*t}}}function YU(e){var t=e.pixelRatio,r=e.cy.zoom();return r*t}function JU(e,t,r,n,i){var s=n*r+t.x,u=i*r+t.y;return u=Math.round(e.canvasHeight-u),[s,u]}function QU(e){return e.pstyle("background-fill").value!=="solid"||e.pstyle("background-image").strValue!=="none"?!1:e.pstyle("border-width").value===0||e.pstyle("border-opacity").value===0?!0:e.pstyle("border-style").value==="solid"}function eq(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function Uu(e,t,r){var n=e[0]/255,i=e[1]/255,s=e[2]/255,u=t,a=r||new Array(4);return a[0]=n*u,a[1]=i*u,a[2]=s*u,a[3]=u,a}function Mh(e,t){var r=t||new Array(4);return r[0]=(e>>0&255)/255,r[1]=(e>>8&255)/255,r[2]=(e>>16&255)/255,r[3]=(e>>24&255)/255,r}function tq(e){return e[0]+(e[1]<<8)+(e[2]<<16)+(e[3]<<24)}function rq(e,t){var r=e.createTexture();return r.buffer=function(n){e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_NEAREST),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),e.generateMipmap(e.TEXTURE_2D),e.bindTexture(e.TEXTURE_2D,null)},r.deleteTexture=function(){e.deleteTexture(r)},r}function iR(e,t){switch(t){case"float":return[1,e.FLOAT,4];case"vec2":return[2,e.FLOAT,4];case"vec3":return[3,e.FLOAT,4];case"vec4":return[4,e.FLOAT,4];case"int":return[1,e.INT,4];case"ivec2":return[2,e.INT,4]}}function aR(e,t,r){switch(t){case e.FLOAT:return new Float32Array(r);case e.INT:return new Int32Array(r)}}function nq(e,t,r,n,i,s){switch(t){case e.FLOAT:return new Float32Array(r.buffer,s*n,i);case e.INT:return new Int32Array(r.buffer,s*n,i)}}function iq(e,t,r,n){var i=iR(e,t),s=Vn(i,2),u=s[0],a=s[1],d=aR(e,a,n),p=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,p),e.bufferData(e.ARRAY_BUFFER,d,e.STATIC_DRAW),a===e.FLOAT?e.vertexAttribPointer(r,u,a,!1,0,0):a===e.INT&&e.vertexAttribIPointer(r,u,a,0,0),e.enableVertexAttribArray(r),e.bindBuffer(e.ARRAY_BUFFER,null),p}function Vs(e,t,r,n){var i=iR(e,r),s=Vn(i,3),u=s[0],a=s[1],d=s[2],p=aR(e,a,t*u),g=u*d,v=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,v),e.bufferData(e.ARRAY_BUFFER,t*g,e.DYNAMIC_DRAW),e.enableVertexAttribArray(n),a===e.FLOAT?e.vertexAttribPointer(n,u,a,!1,g,0):a===e.INT&&e.vertexAttribIPointer(n,u,a,g,0),e.vertexAttribDivisor(n,1),e.bindBuffer(e.ARRAY_BUFFER,null);for(var _=new Array(t),b=0;b<t;b++)_[b]=nq(e,a,p,g,u,b);return v.dataArray=p,v.stride=g,v.size=u,v.getView=function(k){return _[k]},v.setPoint=function(k,A,M){var P=_[k];P[0]=A,P[1]=M},v.bufferSubData=function(k){e.bindBuffer(e.ARRAY_BUFFER,v),k?e.bufferSubData(e.ARRAY_BUFFER,0,p,0,k*u):e.bufferSubData(e.ARRAY_BUFFER,0,p)},v}function aq(e,t,r){for(var n=9,i=new Float32Array(t*n),s=new Array(t),u=0;u<t;u++){var a=u*n*4;s[u]=new Float32Array(i.buffer,a,n)}var d=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,d),e.bufferData(e.ARRAY_BUFFER,i.byteLength,e.DYNAMIC_DRAW);for(var p=0;p<3;p++){var g=r+p;e.enableVertexAttribArray(g),e.vertexAttribPointer(g,3,e.FLOAT,!1,3*12,p*12),e.vertexAttribDivisor(g,1)}return e.bindBuffer(e.ARRAY_BUFFER,null),d.getMatrixView=function(v){return s[v]},d.setData=function(v,_){s[_].set(v,0)},d.bufferSubData=function(){e.bindBuffer(e.ARRAY_BUFFER,d),e.bufferSubData(e.ARRAY_BUFFER,0,i)},d}function sq(e){var t=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,t);var r=e.createTexture();return e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0),e.bindFramebuffer(e.FRAMEBUFFER,null),t.setFramebufferAttachmentSizes=function(n,i){e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n,i,0,e.RGBA,e.UNSIGNED_BYTE,null)},t}var LI=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function Sb(){var e=new LI(9);return LI!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function BI(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function oq(e,t,r){var n=t[0],i=t[1],s=t[2],u=t[3],a=t[4],d=t[5],p=t[6],g=t[7],v=t[8],_=r[0],b=r[1],k=r[2],A=r[3],M=r[4],P=r[5],I=r[6],z=r[7],O=r[8];return e[0]=_*n+b*u+k*p,e[1]=_*i+b*a+k*g,e[2]=_*s+b*d+k*v,e[3]=A*n+M*u+P*p,e[4]=A*i+M*a+P*g,e[5]=A*s+M*d+P*v,e[6]=I*n+z*u+O*p,e[7]=I*i+z*a+O*g,e[8]=I*s+z*d+O*v,e}function fy(e,t,r){var n=t[0],i=t[1],s=t[2],u=t[3],a=t[4],d=t[5],p=t[6],g=t[7],v=t[8],_=r[0],b=r[1];return e[0]=n,e[1]=i,e[2]=s,e[3]=u,e[4]=a,e[5]=d,e[6]=_*n+b*u+p,e[7]=_*i+b*a+g,e[8]=_*s+b*d+v,e}function OI(e,t,r){var n=t[0],i=t[1],s=t[2],u=t[3],a=t[4],d=t[5],p=t[6],g=t[7],v=t[8],_=Math.sin(r),b=Math.cos(r);return e[0]=b*n+_*u,e[1]=b*i+_*a,e[2]=b*s+_*d,e[3]=b*u-_*n,e[4]=b*a-_*i,e[5]=b*d-_*s,e[6]=p,e[7]=g,e[8]=v,e}function t2(e,t,r){var n=r[0],i=r[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function lq(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}var uq=function(){function e(t,r,n,i){hu(this,e),this.debugID=Math.floor(Math.random()*1e4),this.r=t,this.texSize=r,this.texRows=n,this.texHeight=Math.floor(r/n),this.enableWrapping=!0,this.locked=!1,this.texture=null,this.needsBuffer=!0,this.freePointer={x:0,row:0},this.keyToLocation=new Map,this.canvas=i(t,r,r),this.scratch=i(t,r,this.texHeight,"scratch")}return du(e,[{key:"lock",value:function(){this.locked=!0}},{key:"getKeys",value:function(){return new Set(this.keyToLocation.keys())}},{key:"getScale",value:function(r){var n=r.w,i=r.h,s=this.texHeight,u=this.texSize,a=s/i,d=n*a,p=i*a;return d>u&&(a=u/n,d=n*a,p=i*a),{scale:a,texW:d,texH:p}}},{key:"draw",value:function(r,n,i){var s=this;if(this.locked)throw new Error("can't draw, atlas is locked");var u=this.texSize,a=this.texRows,d=this.texHeight,p=this.getScale(n),g=p.scale,v=p.texW,_=p.texH,b=function(z,O){if(i&&O){var V=O.context,U=z.x,$=z.row,G=U,Z=d*$;V.save(),V.translate(G,Z),V.scale(g,g),i(V,n),V.restore()}},k=[null,null],A=function(){b(s.freePointer,s.canvas),k[0]={x:s.freePointer.x,y:s.freePointer.row*d,w:v,h:_},k[1]={x:s.freePointer.x+v,y:s.freePointer.row*d,w:0,h:_},s.freePointer.x+=v,s.freePointer.x==u&&(s.freePointer.x=0,s.freePointer.row++)},M=function(){var z=s.scratch,O=s.canvas;z.clear(),b({x:0,row:0},z);var V=u-s.freePointer.x,U=v-V,$=d;{var G=s.freePointer.x,Z=s.freePointer.row*d,Q=V;O.context.drawImage(z,0,0,Q,$,G,Z,Q,$),k[0]={x:G,y:Z,w:Q,h:_}}{var X=V,ie=(s.freePointer.row+1)*d,te=U;O&&O.context.drawImage(z,X,0,te,$,0,ie,te,$),k[1]={x:0,y:ie,w:te,h:_}}s.freePointer.x=U,s.freePointer.row++},P=function(){s.freePointer.x=0,s.freePointer.row++};if(this.freePointer.x+v<=u)A();else{if(this.freePointer.row>=a-1)return!1;this.freePointer.x===u?(P(),A()):this.enableWrapping?M():(P(),A())}return this.keyToLocation.set(r,k),this.needsBuffer=!0,k}},{key:"getOffsets",value:function(r){return this.keyToLocation.get(r)}},{key:"isEmpty",value:function(){return this.freePointer.x===0&&this.freePointer.row===0}},{key:"canFit",value:function(r){if(this.locked)return!1;var n=this.texSize,i=this.texRows,s=this.getScale(r),u=s.texW;return this.freePointer.x+u>n?this.freePointer.row<i-1:!0}},{key:"bufferIfNeeded",value:function(r){this.texture||(this.texture=rq(r,this.debugID)),this.needsBuffer&&(this.texture.buffer(this.canvas),this.needsBuffer=!1,this.locked&&(this.canvas=null,this.scratch=null))}},{key:"dispose",value:function(){this.texture&&(this.texture.deleteTexture(),this.texture=null),this.canvas=null,this.scratch=null,this.locked=!0}}])}(),cq=function(){function e(t,r,n,i){hu(this,e),this.r=t,this.texSize=r,this.texRows=n,this.createTextureCanvas=i,this.atlases=[],this.styleKeyToAtlas=new Map,this.markedKeys=new Set}return du(e,[{key:"getKeys",value:function(){return new Set(this.styleKeyToAtlas.keys())}},{key:"_createAtlas",value:function(){var r=this.r,n=this.texSize,i=this.texRows,s=this.createTextureCanvas;return new uq(r,n,i,s)}},{key:"_getScratchCanvas",value:function(){if(!this.scratch){var r=this.r,n=this.texSize,i=this.texRows,s=this.createTextureCanvas,u=Math.floor(n/i);this.scratch=s(r,n,u,"scratch")}return this.scratch}},{key:"draw",value:function(r,n,i){var s=this.styleKeyToAtlas.get(r);return s||(s=this.atlases[this.atlases.length-1],(!s||!s.canFit(n))&&(s&&s.lock(),s=this._createAtlas(),this.atlases.push(s)),s.draw(r,n,i),this.styleKeyToAtlas.set(r,s)),s}},{key:"getAtlas",value:function(r){return this.styleKeyToAtlas.get(r)}},{key:"hasAtlas",value:function(r){return this.styleKeyToAtlas.has(r)}},{key:"markKeyForGC",value:function(r){this.markedKeys.add(r)}},{key:"gc",value:function(){var r=this,n=this.markedKeys;if(n.size===0){console.log("nothing to garbage collect");return}var i=[],s=new Map,u=null,a=va(this.atlases),d;try{var p=function(){var v=d.value,_=v.getKeys(),b=hq(n,_);if(b.size===0)return i.push(v),_.forEach(function(V){return s.set(V,v)}),1;u||(u=r._createAtlas(),i.push(u));var k=va(_),A;try{for(k.s();!(A=k.n()).done;){var M=A.value;if(!b.has(M)){var P=v.getOffsets(M),I=Vn(P,2),z=I[0],O=I[1];u.canFit({w:z.w+O.w,h:z.h})||(u.lock(),u=r._createAtlas(),i.push(u)),v.canvas&&(r._copyTextureToNewAtlas(M,v,u),s.set(M,u))}}}catch(V){k.e(V)}finally{k.f()}v.dispose()};for(a.s();!(d=a.n()).done;)p()}catch(g){a.e(g)}finally{a.f()}this.atlases=i,this.styleKeyToAtlas=s,this.markedKeys=new Set}},{key:"_copyTextureToNewAtlas",value:function(r,n,i){var s=n.getOffsets(r),u=Vn(s,2),a=u[0],d=u[1];if(d.w===0)i.draw(r,a,function(_){_.drawImage(n.canvas,a.x,a.y,a.w,a.h,0,0,a.w,a.h)});else{var p=this._getScratchCanvas();p.clear(),p.context.drawImage(n.canvas,a.x,a.y,a.w,a.h,0,0,a.w,a.h),p.context.drawImage(n.canvas,d.x,d.y,d.w,d.h,a.w,0,d.w,d.h);var g=a.w+d.w,v=a.h;i.draw(r,{w:g,h:v},function(_){_.drawImage(p,0,0,g,v,0,0,g,v)})}}},{key:"getCounts",value:function(){return{keyCount:this.styleKeyToAtlas.size,atlasCount:new Set(this.styleKeyToAtlas.values()).size}}}])}();function hq(e,t){return e.intersection?e.intersection(t):new Set(Vy(e).filter(function(r){return t.has(r)}))}var dq=function(){function e(t,r){hu(this,e),this.r=t,this.globalOptions=r,this.atlasSize=r.webglTexSize,this.maxAtlasesPerBatch=r.webglTexPerBatch,this.renderTypes=new Map,this.collections=new Map,this.typeAndIdToKey=new Map}return du(e,[{key:"getAtlasSize",value:function(){return this.atlasSize}},{key:"addAtlasCollection",value:function(r,n){var i=this.globalOptions,s=i.webglTexSize,u=i.createTextureCanvas,a=n.texRows,d=this._cacheScratchCanvas(u),p=new cq(this.r,s,a,d);this.collections.set(r,p)}},{key:"addRenderType",value:function(r,n){var i=n.collection;if(!this.collections.has(i))throw new Error("invalid atlas collection name '".concat(i,"'"));var s=this.collections.get(i),u=dr({type:r,atlasCollection:s},n);this.renderTypes.set(r,u)}},{key:"getRenderTypeOpts",value:function(r){return this.renderTypes.get(r)}},{key:"getAtlasCollection",value:function(r){return this.collections.get(r)}},{key:"_cacheScratchCanvas",value:function(r){var n=-1,i=-1,s=null;return function(u,a,d,p){return p?((!s||a!=n||d!=i)&&(n=a,i=d,s=r(u,a,d)),s):r(u,a,d)}}},{key:"_key",value:function(r,n){return"".concat(r,"-").concat(n)}},{key:"invalidate",value:function(r){var n=this,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=i.forceRedraw,u=s===void 0?!1:s,a=i.filterEle,d=a===void 0?function(){return!0}:a,p=i.filterType,g=p===void 0?function(){return!0}:p,v=!1,_=!1,b=va(r),k;try{for(b.s();!(k=b.n()).done;){var A=k.value;if(d(A)){var M=va(this.renderTypes.values()),P;try{var I=function(){var O=P.value,V=O.type;if(g(V)){var U=n.collections.get(O.collection),$=O.getKey(A),G=Array.isArray($)?$:[$];if(u)G.forEach(function(ie){return U.markKeyForGC(ie)}),_=!0;else{var Z=O.getID?O.getID(A):A.id(),Q=n._key(V,Z),X=n.typeAndIdToKey.get(Q);X!==void 0&&!eq(G,X)&&(v=!0,n.typeAndIdToKey.delete(Q),X.forEach(function(ie){return U.markKeyForGC(ie)}))}}};for(M.s();!(P=M.n()).done;)I()}catch(z){M.e(z)}finally{M.f()}}}}catch(z){b.e(z)}finally{b.f()}return _&&(this.gc(),v=!1),v}},{key:"gc",value:function(){var r=va(this.collections.values()),n;try{for(r.s();!(n=r.n()).done;){var i=n.value;i.gc()}}catch(s){r.e(s)}finally{r.f()}}},{key:"getOrCreateAtlas",value:function(r,n,i,s){var u=this.renderTypes.get(n),a=this.collections.get(u.collection),d=!1,p=a.draw(s,i,function(_){u.drawClipped?(_.save(),_.beginPath(),_.rect(0,0,i.w,i.h),_.clip(),u.drawElement(_,r,i,!0,!0),_.restore()):u.drawElement(_,r,i,!0,!0),d=!0});if(d){var g=u.getID?u.getID(r):r.id(),v=this._key(n,g);this.typeAndIdToKey.has(v)?this.typeAndIdToKey.get(v).push(s):this.typeAndIdToKey.set(v,[s])}return p}},{key:"getAtlasInfo",value:function(r,n){var i=this,s=this.renderTypes.get(n),u=s.getKey(r),a=Array.isArray(u)?u:[u];return a.map(function(d){var p=s.getBoundingBox(r,d),g=i.getOrCreateAtlas(r,n,p,d),v=g.getOffsets(d),_=Vn(v,2),b=_[0],k=_[1];return{atlas:g,tex:b,tex1:b,tex2:k,bb:p}})}},{key:"getDebugInfo",value:function(){var r=[],n=va(this.collections),i;try{for(n.s();!(i=n.n()).done;){var s=Vn(i.value,2),u=s[0],a=s[1],d=a.getCounts(),p=d.keyCount,g=d.atlasCount;r.push({type:u,keyCount:p,atlasCount:g})}}catch(v){n.e(v)}finally{n.f()}return r}}])}(),fq=function(){function e(t){hu(this,e),this.globalOptions=t,this.atlasSize=t.webglTexSize,this.maxAtlasesPerBatch=t.webglTexPerBatch,this.batchAtlases=[]}return du(e,[{key:"getMaxAtlasesPerBatch",value:function(){return this.maxAtlasesPerBatch}},{key:"getAtlasSize",value:function(){return this.atlasSize}},{key:"getIndexArray",value:function(){return Array.from({length:this.maxAtlasesPerBatch},function(r,n){return n})}},{key:"startBatch",value:function(){this.batchAtlases=[]}},{key:"getAtlasCount",value:function(){return this.batchAtlases.length}},{key:"getAtlases",value:function(){return this.batchAtlases}},{key:"canAddToCurrentBatch",value:function(r){return this.batchAtlases.length===this.maxAtlasesPerBatch?this.batchAtlases.includes(r):!0}},{key:"getAtlasIndexForBatch",value:function(r){var n=this.batchAtlases.indexOf(r);if(n<0){if(this.batchAtlases.length===this.maxAtlasesPerBatch)throw new Error("cannot add more atlases to batch");this.batchAtlases.push(r),n=this.batchAtlases.length-1}return n}}])}(),pq=`
  float circleSD(vec2 p, float r) {
    return distance(vec2(0), p) - r; // signed distance
  }
`,mq=`
  float rectangleSD(vec2 p, vec2 b) {
    vec2 d = abs(p)-b;
    return distance(vec2(0),max(d,0.0)) + min(max(d.x,d.y),0.0);
  }
`,gq=`
  float roundRectangleSD(vec2 p, vec2 b, vec4 cr) {
    cr.xy = (p.x > 0.0) ? cr.xy : cr.zw;
    cr.x  = (p.y > 0.0) ? cr.x  : cr.y;
    vec2 q = abs(p) - b + cr.x;
    return min(max(q.x, q.y), 0.0) + distance(vec2(0), max(q, 0.0)) - cr.x;
  }
`,vq=`
  float ellipseSD(vec2 p, vec2 ab) {
    p = abs( p ); // symmetry

    // find root with Newton solver
    vec2 q = ab*(p-ab);
    float w = (q.x<q.y)? 1.570796327 : 0.0;
    for( int i=0; i<5; i++ ) {
      vec2 cs = vec2(cos(w),sin(w));
      vec2 u = ab*vec2( cs.x,cs.y);
      vec2 v = ab*vec2(-cs.y,cs.x);
      w = w + dot(p-u,v)/(dot(p-u,u)+dot(v,v));
    }
    
    // compute final point and distance
    float d = length(p-ab*vec2(cos(w),sin(w)));
    
    // return signed distance
    return (dot(p/ab,p/ab)>1.0) ? d : -d;
  }
`,Fp={SCREEN:{name:"screen",screen:!0},PICKING:{name:"picking",picking:!0}},e0={IGNORE:1,USE_BB:2},Eb=0,FI=1,jI=2,Tb=3,Dh=4,Av=5,op=6,lp=7,yq=function(){function e(t,r,n){hu(this,e),this.r=t,this.gl=r,this.maxInstances=n.webglBatchSize,this.atlasSize=n.webglTexSize,this.bgColor=n.bgColor,this.debug=n.webglDebug,this.batchDebugInfo=[],n.enableWrapping=!0,n.createTextureCanvas=KU,this.atlasManager=new dq(t,n),this.batchManager=new fq(n),this.simpleShapeOptions=new Map,this.program=this._createShaderProgram(Fp.SCREEN),this.pickingProgram=this._createShaderProgram(Fp.PICKING),this.vao=this._createVAO()}return du(e,[{key:"addAtlasCollection",value:function(r,n){this.atlasManager.addAtlasCollection(r,n)}},{key:"addTextureAtlasRenderType",value:function(r,n){this.atlasManager.addRenderType(r,n)}},{key:"addSimpleShapeRenderType",value:function(r,n){this.simpleShapeOptions.set(r,n)}},{key:"invalidate",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.type,s=this.atlasManager;return i?s.invalidate(r,{filterType:function(a){return a===i},forceRedraw:!0}):s.invalidate(r)}},{key:"gc",value:function(){this.atlasManager.gc()}},{key:"_createShaderProgram",value:function(r){var n=this.gl,i=`#version 300 es
      precision highp float;

      uniform mat3 uPanZoomMatrix;
      uniform int  uAtlasSize;
      
      // instanced
      in vec2 aPosition; // a vertex from the unit square
      
      in mat3 aTransform; // used to transform verticies, eg into a bounding box
      in int aVertType; // the type of thing we are rendering

      // the z-index that is output when using picking mode
      in vec4 aIndex;
      
      // For textures
      in int aAtlasId; // which shader unit/atlas to use
      in vec4 aTex; // x/y/w/h of texture in atlas

      // for edges
      in vec4 aPointAPointB;
      in vec4 aPointCPointD;
      in vec2 aLineWidth; // also used for node border width

      // simple shapes
      in vec4 aCornerRadius; // for round-rectangle [top-right, bottom-right, top-left, bottom-left]
      in vec4 aColor; // also used for edges
      in vec4 aBorderColor; // aLineWidth is used for border width

      // output values passed to the fragment shader
      out vec2 vTexCoord;
      out vec4 vColor;
      out vec2 vPosition;
      // flat values are not interpolated
      flat out int vAtlasId; 
      flat out int vVertType;
      flat out vec2 vTopRight;
      flat out vec2 vBotLeft;
      flat out vec4 vCornerRadius;
      flat out vec4 vBorderColor;
      flat out vec2 vBorderWidth;
      flat out vec4 vIndex;
      
      void main(void) {
        int vid = gl_VertexID;
        vec2 position = aPosition; // TODO make this a vec3, simplifies some code below

        if(aVertType == `.concat(Eb,`) {
          float texX = aTex.x; // texture coordinates
          float texY = aTex.y;
          float texW = aTex.z;
          float texH = aTex.w;

          if(vid == 1 || vid == 2 || vid == 4) {
            texX += texW;
          }
          if(vid == 2 || vid == 4 || vid == 5) {
            texY += texH;
          }

          float d = float(uAtlasSize);
          vTexCoord = vec2(texX / d, texY / d); // tex coords must be between 0 and 1

          gl_Position = vec4(uPanZoomMatrix * aTransform * vec3(position, 1.0), 1.0);
        }
        else if(aVertType == `).concat(Dh," || aVertType == ").concat(lp,` 
             || aVertType == `).concat(Av," || aVertType == ").concat(op,`) { // simple shapes

          // the bounding box is needed by the fragment shader
          vBotLeft  = (aTransform * vec3(0, 0, 1)).xy; // flat
          vTopRight = (aTransform * vec3(1, 1, 1)).xy; // flat
          vPosition = (aTransform * vec3(position, 1)).xy; // will be interpolated

          // calculations are done in the fragment shader, just pass these along
          vColor = aColor;
          vCornerRadius = aCornerRadius;
          vBorderColor = aBorderColor;
          vBorderWidth = aLineWidth;

          gl_Position = vec4(uPanZoomMatrix * aTransform * vec3(position, 1.0), 1.0);
        }
        else if(aVertType == `).concat(FI,`) {
          vec2 source = aPointAPointB.xy;
          vec2 target = aPointAPointB.zw;

          // adjust the geometry so that the line is centered on the edge
          position.y = position.y - 0.5;

          // stretch the unit square into a long skinny rectangle
          vec2 xBasis = target - source;
          vec2 yBasis = normalize(vec2(-xBasis.y, xBasis.x));
          vec2 point = source + xBasis * position.x + yBasis * aLineWidth[0] * position.y;

          gl_Position = vec4(uPanZoomMatrix * vec3(point, 1.0), 1.0);
          vColor = aColor;
        } 
        else if(aVertType == `).concat(jI,`) {
          vec2 pointA = aPointAPointB.xy;
          vec2 pointB = aPointAPointB.zw;
          vec2 pointC = aPointCPointD.xy;
          vec2 pointD = aPointCPointD.zw;

          // adjust the geometry so that the line is centered on the edge
          position.y = position.y - 0.5;

          vec2 p0, p1, p2, pos;
          if(position.x == 0.0) { // The left side of the unit square
            p0 = pointA;
            p1 = pointB;
            p2 = pointC;
            pos = position;
          } else { // The right side of the unit square, use same approach but flip the geometry upside down
            p0 = pointD;
            p1 = pointC;
            p2 = pointB;
            pos = vec2(0.0, -position.y);
          }

          vec2 p01 = p1 - p0;
          vec2 p12 = p2 - p1;
          vec2 p21 = p1 - p2;

          // Find the normal vector.
          vec2 tangent = normalize(normalize(p12) + normalize(p01));
          vec2 normal = vec2(-tangent.y, tangent.x);

          // Find the vector perpendicular to p0 -> p1.
          vec2 p01Norm = normalize(vec2(-p01.y, p01.x));

          // Determine the bend direction.
          float sigma = sign(dot(p01 + p21, normal));
          float width = aLineWidth[0];

          if(sign(pos.y) == -sigma) {
            // This is an intersecting vertex. Adjust the position so that there's no overlap.
            vec2 point = 0.5 * width * normal * -sigma / dot(normal, p01Norm);
            gl_Position = vec4(uPanZoomMatrix * vec3(p1 + point, 1.0), 1.0);
          } else {
            // This is a non-intersecting vertex. Treat it like a mitre join.
            vec2 point = 0.5 * width * normal * sigma * dot(normal, p01Norm);
            gl_Position = vec4(uPanZoomMatrix * vec3(p1 + point, 1.0), 1.0);
          }

          vColor = aColor;
        } 
        else if(aVertType == `).concat(Tb,` && vid < 3) {
          // massage the first triangle into an edge arrow
          if(vid == 0)
            position = vec2(-0.15, -0.3);
          if(vid == 1)
            position = vec2(  0.0,  0.0);
          if(vid == 2)
            position = vec2( 0.15, -0.3);

          gl_Position = vec4(uPanZoomMatrix * aTransform * vec3(position, 1.0), 1.0);
          vColor = aColor;
        }
        else {
          gl_Position = vec4(2.0, 0.0, 0.0, 1.0); // discard vertex by putting it outside webgl clip space
        }

        vAtlasId = aAtlasId;
        vVertType = aVertType;
        vIndex = aIndex;
      }
    `),s=this.batchManager.getIndexArray(),u=`#version 300 es
      precision highp float;

      // declare texture unit for each texture atlas in the batch
      `.concat(s.map(function(p){return"uniform sampler2D uTexture".concat(p,";")}).join(`
	`),`

      uniform vec4 uBGColor;
      uniform float uZoom;

      in vec2 vTexCoord;
      in vec4 vColor;
      in vec2 vPosition; // model coordinates

      flat in int vAtlasId;
      flat in vec4 vIndex;
      flat in int vVertType;
      flat in vec2 vTopRight;
      flat in vec2 vBotLeft;
      flat in vec4 vCornerRadius;
      flat in vec4 vBorderColor;
      flat in vec2 vBorderWidth;

      out vec4 outColor;

      `).concat(pq,`
      `).concat(mq,`
      `).concat(gq,`
      `).concat(vq,`

      vec4 blend(vec4 top, vec4 bot) { // blend colors with premultiplied alpha
        return vec4( 
          top.rgb + (bot.rgb * (1.0 - top.a)),
          top.a   + (bot.a   * (1.0 - top.a)) 
        );
      }

      vec4 distInterp(vec4 cA, vec4 cB, float d) { // interpolate color using Signed Distance
        // scale to the zoom level so that borders don't look blurry when zoomed in
        // note 1.5 is an aribitrary value chosen because it looks good
        return mix(cA, cB, 1.0 - smoothstep(0.0, 1.5 / uZoom, abs(d))); 
      }

      void main(void) {
        if(vVertType == `).concat(Eb,`) {
          // look up the texel from the texture unit
          `).concat(s.map(function(p){return"if(vAtlasId == ".concat(p,") outColor = texture(uTexture").concat(p,", vTexCoord);")}).join(`
	else `),`
        } 
        else if(vVertType == `).concat(Tb,`) {
          // mimics how canvas renderer uses context.globalCompositeOperation = 'destination-out';
          outColor = blend(vColor, uBGColor);
          outColor.a = 1.0; // make opaque, masks out line under arrow
        }
        else if(vVertType == `).concat(Dh,` && vBorderWidth == vec2(0.0)) { // simple rectangle with no border
          outColor = vColor; // unit square is already transformed to the rectangle, nothing else needs to be done
        }
        else if(vVertType == `).concat(Dh," || vVertType == ").concat(lp,` 
          || vVertType == `).concat(Av," || vVertType == ").concat(op,`) { // use SDF

          float outerBorder = vBorderWidth[0];
          float innerBorder = vBorderWidth[1];
          float borderPadding = outerBorder * 2.0;
          float w = vTopRight.x - vBotLeft.x - borderPadding;
          float h = vTopRight.y - vBotLeft.y - borderPadding;
          vec2 b = vec2(w/2.0, h/2.0); // half width, half height
          vec2 p = vPosition - vec2(vTopRight.x - b[0] - outerBorder, vTopRight.y - b[1] - outerBorder); // translate to center

          float d; // signed distance
          if(vVertType == `).concat(Dh,`) {
            d = rectangleSD(p, b);
          } else if(vVertType == `).concat(lp,` && w == h) {
            d = circleSD(p, b.x); // faster than ellipse
          } else if(vVertType == `).concat(lp,`) {
            d = ellipseSD(p, b);
          } else {
            d = roundRectangleSD(p, b, vCornerRadius.wzyx);
          }

          // use the distance to interpolate a color to smooth the edges of the shape, doesn't need multisampling
          // we must smooth colors inwards, because we can't change pixels outside the shape's bounding box
          if(d > 0.0) {
            if(d > outerBorder) {
              discard;
            } else {
              outColor = distInterp(vBorderColor, vec4(0), d - outerBorder);
            }
          } else {
            if(d > innerBorder) {
              vec4 outerColor = outerBorder == 0.0 ? vec4(0) : vBorderColor;
              vec4 innerBorderColor = blend(vBorderColor, vColor);
              outColor = distInterp(innerBorderColor, outerColor, d);
            } 
            else {
              vec4 outerColor;
              if(innerBorder == 0.0 && outerBorder == 0.0) {
                outerColor = vec4(0);
              } else if(innerBorder == 0.0) {
                outerColor = vBorderColor;
              } else {
                outerColor = blend(vBorderColor, vColor);
              }
              outColor = distInterp(vColor, outerColor, d - innerBorder);
            }
          }
        }
        else {
          outColor = vColor;
        }

        `).concat(r.picking?`if(outColor.a == 0.0) discard;
             else outColor = vIndex;`:"",`
      }
    `),a=XU(n,i,u);a.aPosition=n.getAttribLocation(a,"aPosition"),a.aIndex=n.getAttribLocation(a,"aIndex"),a.aVertType=n.getAttribLocation(a,"aVertType"),a.aTransform=n.getAttribLocation(a,"aTransform"),a.aAtlasId=n.getAttribLocation(a,"aAtlasId"),a.aTex=n.getAttribLocation(a,"aTex"),a.aPointAPointB=n.getAttribLocation(a,"aPointAPointB"),a.aPointCPointD=n.getAttribLocation(a,"aPointCPointD"),a.aLineWidth=n.getAttribLocation(a,"aLineWidth"),a.aColor=n.getAttribLocation(a,"aColor"),a.aCornerRadius=n.getAttribLocation(a,"aCornerRadius"),a.aBorderColor=n.getAttribLocation(a,"aBorderColor"),a.uPanZoomMatrix=n.getUniformLocation(a,"uPanZoomMatrix"),a.uAtlasSize=n.getUniformLocation(a,"uAtlasSize"),a.uBGColor=n.getUniformLocation(a,"uBGColor"),a.uZoom=n.getUniformLocation(a,"uZoom"),a.uTextures=[];for(var d=0;d<this.batchManager.getMaxAtlasesPerBatch();d++)a.uTextures.push(n.getUniformLocation(a,"uTexture".concat(d)));return a}},{key:"_createVAO",value:function(){var r=[0,0,1,0,1,1,0,0,1,1,0,1];this.vertexCount=r.length/2;var n=this.maxInstances,i=this.gl,s=this.program,u=i.createVertexArray();return i.bindVertexArray(u),iq(i,"vec2",s.aPosition,r),this.transformBuffer=aq(i,n,s.aTransform),this.indexBuffer=Vs(i,n,"vec4",s.aIndex),this.vertTypeBuffer=Vs(i,n,"int",s.aVertType),this.atlasIdBuffer=Vs(i,n,"int",s.aAtlasId),this.texBuffer=Vs(i,n,"vec4",s.aTex),this.pointAPointBBuffer=Vs(i,n,"vec4",s.aPointAPointB),this.pointCPointDBuffer=Vs(i,n,"vec4",s.aPointCPointD),this.lineWidthBuffer=Vs(i,n,"vec2",s.aLineWidth),this.colorBuffer=Vs(i,n,"vec4",s.aColor),this.cornerRadiusBuffer=Vs(i,n,"vec4",s.aCornerRadius),this.borderColorBuffer=Vs(i,n,"vec4",s.aBorderColor),i.bindVertexArray(null),u}},{key:"buffers",get:function(){var r=this;return this._buffers||(this._buffers=Object.keys(this).filter(function(n){return Fl(n,"Buffer")}).map(function(n){return r[n]})),this._buffers}},{key:"startFrame",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Fp.SCREEN;this.panZoomMatrix=r,this.renderTarget=n,this.batchDebugInfo=[],this.wrappedCount=0,this.simpleCount=0,this.startBatch()}},{key:"startBatch",value:function(){this.instanceCount=0,this.batchManager.startBatch()}},{key:"endFrame",value:function(){this.endBatch()}},{key:"_isVisible",value:function(r,n){return r.visible()?n&&n.isVisible?n.isVisible(r):!0:!1}},{key:"drawTexture",value:function(r,n,i){var s=this.atlasManager,u=this.batchManager,a=s.getRenderTypeOpts(i);if(this._isVisible(r,a)&&!(r.isEdge()&&!this._isValidEdge(r))){if(this.renderTarget.picking&&a.getTexPickingMode){var d=a.getTexPickingMode(r);if(d===e0.IGNORE)return;if(d==e0.USE_BB){this.drawPickingRectangle(r,n,i);return}}var p=s.getAtlasInfo(r,i),g=va(p),v;try{for(g.s();!(v=g.n()).done;){var _=v.value,b=_.atlas,k=_.tex1,A=_.tex2;u.canAddToCurrentBatch(b)||this.endBatch();for(var M=u.getAtlasIndexForBatch(b),P=0,I=[[k,!0],[A,!1]];P<I.length;P++){var z=Vn(I[P],2),O=z[0],V=z[1];if(O.w!=0){var U=this.instanceCount;this.vertTypeBuffer.getView(U)[0]=Eb;var $=this.indexBuffer.getView(U);Mh(n,$);var G=this.atlasIdBuffer.getView(U);G[0]=M;var Z=this.texBuffer.getView(U);Z[0]=O.x,Z[1]=O.y,Z[2]=O.w,Z[3]=O.h;var Q=this.transformBuffer.getMatrixView(U);this.setTransformMatrix(r,Q,a,_,V),this.instanceCount++,V||this.wrappedCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}}}catch(X){g.e(X)}finally{g.f()}}}},{key:"setTransformMatrix",value:function(r,n,i,s){var u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,a=0;if(i.shapeProps&&i.shapeProps.padding&&(a=r.pstyle(i.shapeProps.padding).pfValue),s){var d=s.bb,p=s.tex1,g=s.tex2,v=p.w/(p.w+g.w);u||(v=1-v);var _=this._getAdjustedBB(d,a,u,v);this._applyTransformMatrix(n,_,i,r)}else{var b=i.getBoundingBox(r),k=this._getAdjustedBB(b,a,!0,1);this._applyTransformMatrix(n,k,i,r)}}},{key:"_applyTransformMatrix",value:function(r,n,i,s){var u,a;BI(r);var d=i.getRotation?i.getRotation(s):0;if(d!==0){var p=i.getRotationPoint(s),g=p.x,v=p.y;fy(r,r,[g,v]),OI(r,r,d);var _=i.getRotationOffset(s);u=_.x+(n.xOffset||0),a=_.y+(n.yOffset||0)}else u=n.x1,a=n.y1;fy(r,r,[u,a]),t2(r,r,[n.w,n.h])}},{key:"_getAdjustedBB",value:function(r,n,i,s){var u=r.x1,a=r.y1,d=r.w,p=r.h,g=r.yOffset;n&&(u-=n,a-=n,d+=2*n,p+=2*n);var v=0,_=d*s;return i&&s<1?d=_:!i&&s<1&&(v=d-_,u+=v,d=_),{x1:u,y1:a,w:d,h:p,xOffset:v,yOffset:g}}},{key:"drawPickingRectangle",value:function(r,n,i){var s=this.atlasManager.getRenderTypeOpts(i),u=this.instanceCount;this.vertTypeBuffer.getView(u)[0]=Dh;var a=this.indexBuffer.getView(u);Mh(n,a);var d=this.colorBuffer.getView(u);Uu([0,0,0],1,d);var p=this.transformBuffer.getMatrixView(u);this.setTransformMatrix(r,p,s),this.simpleCount++,this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}},{key:"drawNode",value:function(r,n,i){var s=this.simpleShapeOptions.get(i);if(this._isVisible(r,s)){var u=s.shapeProps,a=this._getVertTypeForShape(r,u.shape);if(a===void 0||s.isSimple&&!s.isSimple(r)){this.drawTexture(r,n,i);return}var d=this.instanceCount;if(this.vertTypeBuffer.getView(d)[0]=a,a===Av||a===op){var p=s.getBoundingBox(r),g=this._getCornerRadius(r,u.radius,p),v=this.cornerRadiusBuffer.getView(d);v[0]=g,v[1]=g,v[2]=g,v[3]=g,a===op&&(v[0]=0,v[2]=0)}var _=this.indexBuffer.getView(d);Mh(n,_);var b=r.pstyle(u.color).value,k=r.pstyle(u.opacity).value,A=this.colorBuffer.getView(d);Uu(b,k,A);var M=this.lineWidthBuffer.getView(d);if(M[0]=0,M[1]=0,u.border){var P=r.pstyle("border-width").value;if(P>0){var I=r.pstyle("border-color").value,z=r.pstyle("border-opacity").value,O=this.borderColorBuffer.getView(d);Uu(I,z,O);var V=r.pstyle("border-position").value;if(V==="inside")M[0]=0,M[1]=-P;else if(V==="outside")M[0]=P,M[1]=0;else{var U=P/2;M[0]=U,M[1]=-U}}}var $=this.transformBuffer.getMatrixView(d);this.setTransformMatrix(r,$,s),this.simpleCount++,this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}},{key:"_getVertTypeForShape",value:function(r,n){var i=r.pstyle(n).value;switch(i){case"rectangle":return Dh;case"ellipse":return lp;case"roundrectangle":case"round-rectangle":return Av;case"bottom-round-rectangle":return op;default:return}}},{key:"_getCornerRadius",value:function(r,n,i){var s=i.w,u=i.h;if(r.pstyle(n).value==="auto")return iu(s,u);var a=r.pstyle(n).pfValue,d=s/2,p=u/2;return Math.min(a,p,d)}},{key:"drawEdgeArrow",value:function(r,n,i){if(r.visible()){var s=r._private.rscratch,u,a,d;if(i==="source"?(u=s.arrowStartX,a=s.arrowStartY,d=s.srcArrowAngle):(u=s.arrowEndX,a=s.arrowEndY,d=s.tgtArrowAngle),!(isNaN(u)||u==null||isNaN(a)||a==null||isNaN(d)||d==null)){var p=r.pstyle(i+"-arrow-shape").value;if(p!=="none"){var g=r.pstyle(i+"-arrow-color").value,v=r.pstyle("opacity").value,_=r.pstyle("line-opacity").value,b=v*_,k=r.pstyle("width").pfValue,A=r.pstyle("arrow-scale").value,M=this.r.getArrowWidth(k,A),P=this.instanceCount,I=this.transformBuffer.getMatrixView(P);BI(I),fy(I,I,[u,a]),t2(I,I,[M,M]),OI(I,I,d),this.vertTypeBuffer.getView(P)[0]=Tb;var z=this.indexBuffer.getView(P);Mh(n,z);var O=this.colorBuffer.getView(P);Uu(g,b,O),this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}}}},{key:"drawEdgeLine",value:function(r,n){if(r.visible()){var i=this._getEdgePoints(r);if(i){var s=r.pstyle("opacity").value,u=r.pstyle("line-opacity").value,a=r.pstyle("width").pfValue,d=r.pstyle("line-color").value,p=s*u;if(i.length/2+this.instanceCount>this.maxInstances&&this.endBatch(),i.length==4){var g=this.instanceCount;this.vertTypeBuffer.getView(g)[0]=FI;var v=this.indexBuffer.getView(g);Mh(n,v);var _=this.colorBuffer.getView(g);Uu(d,p,_);var b=this.lineWidthBuffer.getView(g);b[0]=a;var k=this.pointAPointBBuffer.getView(g);k[0]=i[0],k[1]=i[1],k[2]=i[2],k[3]=i[3],this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}else for(var A=0;A<i.length-2;A+=2){var M=this.instanceCount;this.vertTypeBuffer.getView(M)[0]=jI;var P=this.indexBuffer.getView(M);Mh(n,P);var I=this.colorBuffer.getView(M);Uu(d,p,I);var z=this.lineWidthBuffer.getView(M);z[0]=a;var O=i[A-2],V=i[A-1],U=i[A],$=i[A+1],G=i[A+2],Z=i[A+3],Q=i[A+4],X=i[A+5];A==0&&(O=2*U-G+.001,V=2*$-Z+.001),A==i.length-4&&(Q=2*G-U+.001,X=2*Z-$+.001);var ie=this.pointAPointBBuffer.getView(M);ie[0]=O,ie[1]=V,ie[2]=U,ie[3]=$;var te=this.pointCPointDBuffer.getView(M);te[0]=G,te[1]=Z,te[2]=Q,te[3]=X,this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}}}},{key:"_isValidEdge",value:function(r){var n=r._private.rscratch;return!(n.badLine||n.allpts==null||isNaN(n.allpts[0]))}},{key:"_getEdgePoints",value:function(r){var n=r._private.rscratch;if(this._isValidEdge(r)){var i=n.allpts;if(i.length==4)return i;var s=this._getNumSegments(r);return this._getCurveSegmentPoints(i,s)}}},{key:"_getNumSegments",value:function(r){var n=15;return Math.min(Math.max(n,5),this.maxInstances)}},{key:"_getCurveSegmentPoints",value:function(r,n){if(r.length==4)return r;for(var i=Array((n+1)*2),s=0;s<=n;s++)if(s==0)i[0]=r[0],i[1]=r[1];else if(s==n)i[s*2]=r[r.length-2],i[s*2+1]=r[r.length-1];else{var u=s/n;this._setCurvePoint(r,u,i,s*2)}return i}},{key:"_setCurvePoint",value:function(r,n,i,s){if(r.length<=2)i[s]=r[0],i[s+1]=r[1];else{for(var u=Array(r.length-2),a=0;a<u.length;a+=2){var d=(1-n)*r[a]+n*r[a+2],p=(1-n)*r[a+1]+n*r[a+3];u[a]=d,u[a+1]=p}return this._setCurvePoint(u,n,i,s)}}},{key:"endBatch",value:function(){var r=this.gl,n=this.vao,i=this.vertexCount,s=this.instanceCount;if(s!==0){var u=this.renderTarget.picking?this.pickingProgram:this.program;r.useProgram(u),r.bindVertexArray(n);var a=va(this.buffers),d;try{for(a.s();!(d=a.n()).done;){var p=d.value;p.bufferSubData(s)}}catch(k){a.e(k)}finally{a.f()}for(var g=this.batchManager.getAtlases(),v=0;v<g.length;v++)g[v].bufferIfNeeded(r);for(var _=0;_<g.length;_++)r.activeTexture(r.TEXTURE0+_),r.bindTexture(r.TEXTURE_2D,g[_].texture),r.uniform1i(u.uTextures[_],_);r.uniform1f(u.uZoom,YU(this.r)),r.uniformMatrix3fv(u.uPanZoomMatrix,!1,this.panZoomMatrix),r.uniform1i(u.uAtlasSize,this.batchManager.getAtlasSize());var b=Uu(this.bgColor,1);r.uniform4fv(u.uBGColor,b),r.drawArraysInstanced(r.TRIANGLES,0,i,s),r.bindVertexArray(null),r.bindTexture(r.TEXTURE_2D,null),this.debug&&this.batchDebugInfo.push({count:s,atlasCount:g.length}),this.startBatch()}}},{key:"getDebugInfo",value:function(){var r=this.atlasManager.getDebugInfo(),n=r.reduce(function(u,a){return u+a.atlasCount},0),i=this.batchDebugInfo,s=i.reduce(function(u,a){return u+a.count},0);return{atlasInfo:r,totalAtlases:n,wrappedCount:this.wrappedCount,simpleCount:this.simpleCount,batchCount:i.length,batchInfo:i,totalInstances:s}}}])}(),sR={};sR.initWebgl=function(e,t){var r=this,n=r.data.contexts[r.WEBGL];e.bgColor=xq(r),e.webglTexSize=Math.min(e.webglTexSize,n.getParameter(n.MAX_TEXTURE_SIZE)),e.webglTexRows=Math.min(e.webglTexRows,54),e.webglTexRowsNodes=Math.min(e.webglTexRowsNodes,54),e.webglBatchSize=Math.min(e.webglBatchSize,16384),e.webglTexPerBatch=Math.min(e.webglTexPerBatch,n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS)),r.webglDebug=e.webglDebug,r.webglDebugShowAtlases=e.webglDebugShowAtlases,r.pickingFrameBuffer=sq(n),r.pickingFrameBuffer.needsDraw=!0,r.drawing=new yq(r,n,e);var i=function(v){return function(_){return r.getTextAngle(_,v)}},s=function(v){return function(_){var b=_.pstyle(v);return b&&b.value}},u=function(v){return function(_){return _.pstyle("".concat(v,"-opacity")).value>0}},a=function(v){var _=v.pstyle("text-events").strValue==="yes";return _?e0.USE_BB:e0.IGNORE},d=function(v){var _=v.position(),b=_.x,k=_.y,A=v.outerWidth(),M=v.outerHeight();return{w:A,h:M,x1:b-A/2,y1:k-M/2}};r.drawing.addAtlasCollection("node",{texRows:e.webglTexRowsNodes}),r.drawing.addAtlasCollection("label",{texRows:e.webglTexRows}),r.drawing.addTextureAtlasRenderType("node-body",{collection:"node",getKey:t.getStyleKey,getBoundingBox:t.getElementBox,drawElement:t.drawElement}),r.drawing.addSimpleShapeRenderType("node-body",{getBoundingBox:d,isSimple:QU,shapeProps:{shape:"shape",color:"background-color",opacity:"background-opacity",radius:"corner-radius",border:!0}}),r.drawing.addSimpleShapeRenderType("node-overlay",{getBoundingBox:d,isVisible:u("overlay"),shapeProps:{shape:"overlay-shape",color:"overlay-color",opacity:"overlay-opacity",padding:"overlay-padding",radius:"overlay-corner-radius"}}),r.drawing.addSimpleShapeRenderType("node-underlay",{getBoundingBox:d,isVisible:u("underlay"),shapeProps:{shape:"underlay-shape",color:"underlay-color",opacity:"underlay-opacity",padding:"underlay-padding",radius:"underlay-corner-radius"}}),r.drawing.addTextureAtlasRenderType("label",{collection:"label",getTexPickingMode:a,getKey:Cb(t.getLabelKey,null),getBoundingBox:kb(t.getLabelBox,null),drawClipped:!0,drawElement:t.drawLabel,getRotation:i(null),getRotationPoint:t.getLabelRotationPoint,getRotationOffset:t.getLabelRotationOffset,isVisible:s("label")}),r.drawing.addTextureAtlasRenderType("edge-source-label",{collection:"label",getTexPickingMode:a,getKey:Cb(t.getSourceLabelKey,"source"),getBoundingBox:kb(t.getSourceLabelBox,"source"),drawClipped:!0,drawElement:t.drawSourceLabel,getRotation:i("source"),getRotationPoint:t.getSourceLabelRotationPoint,getRotationOffset:t.getSourceLabelRotationOffset,isVisible:s("source-label")}),r.drawing.addTextureAtlasRenderType("edge-target-label",{collection:"label",getTexPickingMode:a,getKey:Cb(t.getTargetLabelKey,"target"),getBoundingBox:kb(t.getTargetLabelBox,"target"),drawClipped:!0,drawElement:t.drawTargetLabel,getRotation:i("target"),getRotationPoint:t.getTargetLabelRotationPoint,getRotationOffset:t.getTargetLabelRotationOffset,isVisible:s("target-label")});var p=$m(function(){console.log("garbage collect flag set"),r.data.gc=!0},1e4);r.onUpdateEleCalcs(function(g,v){var _=!1;v&&v.length>0&&(_|=r.drawing.invalidate(v)),_&&p()}),_q(r)};function xq(e){var t=e.cy.container(),r=t&&t.style&&t.style.backgroundColor||"white";return zN(r)}function oR(e,t){var r=e._private.rscratch;return fa(r,"labelWrapCachedLines",t)||[]}var Cb=function(t,r){return function(n){var i=t(n),s=oR(n,r);return s.length>1?s.map(function(u,a){return"".concat(i,"_").concat(a)}):i}},kb=function(t,r){return function(n,i){var s=t(n);if(typeof i=="string"){var u=i.indexOf("_");if(u>0){var a=Number(i.substring(u+1)),d=oR(n,r),p=s.h/d.length,g=p*a,v=s.y1+g;return{x1:s.x1,w:s.w,y1:v,h:p,yOffset:g}}}return s}};function _q(e){{var t=e.render;e.render=function(s){s=s||{};var u=e.cy;e.webgl&&(u.zoom()>Qz?(wq(e),t.call(e,s)):(bq(e),uR(e,s,Fp.SCREEN)))}}{var r=e.matchCanvasSize;e.matchCanvasSize=function(s){r.call(e,s),e.pickingFrameBuffer.setFramebufferAttachmentSizes(e.canvasWidth,e.canvasHeight),e.pickingFrameBuffer.needsDraw=!0}}e.findNearestElements=function(s,u,a,d){return Pq(e,s,u)};{var n=e.invalidateCachedZSortedEles;e.invalidateCachedZSortedEles=function(){n.call(e),e.pickingFrameBuffer.needsDraw=!0}}{var i=e.notify;e.notify=function(s,u){i.call(e,s,u),s==="viewport"||s==="bounds"?e.pickingFrameBuffer.needsDraw=!0:s==="background"&&e.drawing.invalidate(u,{type:"node-body"})}}}function wq(e){var t=e.data.contexts[e.WEBGL];t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}function bq(e){var t=function(n){n.save(),n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,e.canvasWidth,e.canvasHeight),n.restore()};t(e.data.contexts[e.NODE]),t(e.data.contexts[e.DRAG])}function Sq(e){var t=e.canvasWidth,r=e.canvasHeight,n=VS(e),i=n.pan,s=n.zoom,u=Sb();fy(u,u,[i.x,i.y]),t2(u,u,[s,s]);var a=Sb();lq(a,t,r);var d=Sb();return oq(d,a,u),d}function lR(e,t){var r=e.canvasWidth,n=e.canvasHeight,i=VS(e),s=i.pan,u=i.zoom;t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,r,n),t.translate(s.x,s.y),t.scale(u,u)}function Eq(e,t){e.drawSelectionRectangle(t,function(r){return lR(e,r)})}function Tq(e){var t=e.data.contexts[e.NODE];t.save(),lR(e,t),t.strokeStyle="rgba(0, 0, 0, 0.3)",t.beginPath(),t.moveTo(-1e3,0),t.lineTo(1e3,0),t.stroke(),t.beginPath(),t.moveTo(0,-1e3),t.lineTo(0,1e3),t.stroke(),t.restore()}function Cq(e){var t=function(i,s,u){for(var a=i.atlasManager.getAtlasCollection(s),d=e.data.contexts[e.NODE],p=a.atlases,g=0;g<p.length;g++){var v=p[g],_=v.canvas;if(_){var b=_.width,k=_.height,A=b*g,M=_.height*u,P=.4;d.save(),d.scale(P,P),d.drawImage(_,A,M),d.strokeStyle="black",d.rect(A,M,b,k),d.stroke(),d.restore()}}},r=0;t(e.drawing,"node",r++),t(e.drawing,"label",r++)}function kq(e,t,r,n,i){var s,u,a,d,p=VS(e),g=p.pan,v=p.zoom;{var _=JU(e,g,v,t,r),b=Vn(_,2),k=b[0],A=b[1],M=6;s=k-M/2,u=A-M/2,a=M,d=M}if(a===0||d===0)return[];var P=e.data.contexts[e.WEBGL];P.bindFramebuffer(P.FRAMEBUFFER,e.pickingFrameBuffer),e.pickingFrameBuffer.needsDraw&&(P.viewport(0,0,P.canvas.width,P.canvas.height),uR(e,null,Fp.PICKING),e.pickingFrameBuffer.needsDraw=!1);var I=a*d,z=new Uint8Array(I*4);P.readPixels(s,u,a,d,P.RGBA,P.UNSIGNED_BYTE,z),P.bindFramebuffer(P.FRAMEBUFFER,null);for(var O=new Set,V=0;V<I;V++){var U=z.slice(V*4,V*4+4),$=tq(U)-1;$>=0&&O.add($)}return O}function Pq(e,t,r){var n=kq(e,t,r),i=e.getCachedZSortedEles(),s,u,a=va(n),d;try{for(a.s();!(d=a.n()).done;){var p=d.value,g=i[p];if(!s&&g.isNode()&&(s=g),!u&&g.isEdge()&&(u=g),s&&u)break}}catch(v){a.e(v)}finally{a.f()}return[s,u].filter(Boolean)}function Pb(e,t,r){var n=e.drawing;t+=1,r.isNode()?(n.drawNode(r,t,"node-underlay"),n.drawNode(r,t,"node-body"),n.drawTexture(r,t,"label"),n.drawNode(r,t,"node-overlay")):(n.drawEdgeLine(r,t),n.drawEdgeArrow(r,t,"source"),n.drawEdgeArrow(r,t,"target"),n.drawTexture(r,t,"label"),n.drawTexture(r,t,"edge-source-label"),n.drawTexture(r,t,"edge-target-label"))}function uR(e,t,r){var n;e.webglDebug&&(n=performance.now());var i=e.drawing,s=0;if(r.screen&&e.data.canvasNeedsRedraw[e.SELECT_BOX]&&Eq(e,t),e.data.canvasNeedsRedraw[e.NODE]||r.picking){var u=e.data.contexts[e.WEBGL];r.screen?(u.clearColor(0,0,0,0),u.enable(u.BLEND),u.blendFunc(u.ONE,u.ONE_MINUS_SRC_ALPHA)):u.disable(u.BLEND),u.clear(u.COLOR_BUFFER_BIT|u.DEPTH_BUFFER_BIT),u.viewport(0,0,u.canvas.width,u.canvas.height);var a=Sq(e),d=e.getCachedZSortedEles();if(s=d.length,i.startFrame(a,r),r.screen){for(var p=0;p<d.nondrag.length;p++)Pb(e,p,d.nondrag[p]);for(var g=0;g<d.drag.length;g++)Pb(e,g,d.drag[g])}else if(r.picking)for(var v=0;v<d.length;v++)Pb(e,v,d[v]);i.endFrame(),r.screen&&e.webglDebugShowAtlases&&(Tq(e),Cq(e)),e.data.canvasNeedsRedraw[e.NODE]=!1,e.data.canvasNeedsRedraw[e.DRAG]=!1}if(e.webglDebug){var _=performance.now(),b=!1,k=Math.ceil(_-n),A=i.getDebugInfo(),M=["".concat(s," elements"),"".concat(A.totalInstances," instances"),"".concat(A.batchCount," batches"),"".concat(A.totalAtlases," atlases"),"".concat(A.wrappedCount," wrapped textures"),"".concat(A.simpleCount," simple shapes")].join(", ");if(b)console.log("WebGL (".concat(r.name,") - time ").concat(k,"ms, ").concat(M));else{console.log("WebGL (".concat(r.name,") - frame time ").concat(k,"ms")),console.log("Totals:"),console.log("  ".concat(M)),console.log("Texture Atlases Used:");var P=A.atlasInfo,I=va(P),z;try{for(I.s();!(z=I.n()).done;){var O=z.value;console.log("  ".concat(O.type,": ").concat(O.keyCount," keys, ").concat(O.atlasCount," atlases"))}}catch(V){I.e(V)}finally{I.f()}console.log("")}}e.data.gc&&(console.log("Garbage Collect!"),e.data.gc=!1,i.gc())}var mu={};mu.drawPolygonPath=function(e,t,r,n,i,s){var u=n/2,a=i/2;e.beginPath&&e.beginPath(),e.moveTo(t+u*s[0],r+a*s[1]);for(var d=1;d<s.length/2;d++)e.lineTo(t+u*s[d*2],r+a*s[d*2+1]);e.closePath()};mu.drawRoundPolygonPath=function(e,t,r,n,i,s,u){u.forEach(function(a){return qz(e,a)}),e.closePath()};mu.drawRoundRectanglePath=function(e,t,r,n,i,s){var u=n/2,a=i/2,d=s==="auto"?iu(n,i):Math.min(s,a,u);e.beginPath&&e.beginPath(),e.moveTo(t,r-a),e.arcTo(t+u,r-a,t+u,r,d),e.arcTo(t+u,r+a,t,r+a,d),e.arcTo(t-u,r+a,t-u,r,d),e.arcTo(t-u,r-a,t,r-a,d),e.lineTo(t,r-a),e.closePath()};mu.drawBottomRoundRectanglePath=function(e,t,r,n,i,s){var u=n/2,a=i/2,d=s==="auto"?iu(n,i):s;e.beginPath&&e.beginPath(),e.moveTo(t,r-a),e.lineTo(t+u,r-a),e.lineTo(t+u,r),e.arcTo(t+u,r+a,t,r+a,d),e.arcTo(t-u,r+a,t-u,r,d),e.lineTo(t-u,r-a),e.lineTo(t,r-a),e.closePath()};mu.drawCutRectanglePath=function(e,t,r,n,i,s,u){var a=n/2,d=i/2,p=u==="auto"?PS():u;e.beginPath&&e.beginPath(),e.moveTo(t-a+p,r-d),e.lineTo(t+a-p,r-d),e.lineTo(t+a,r-d+p),e.lineTo(t+a,r+d-p),e.lineTo(t+a-p,r+d),e.lineTo(t-a+p,r+d),e.lineTo(t-a,r+d-p),e.lineTo(t-a,r-d+p),e.closePath()};mu.drawBarrelPath=function(e,t,r,n,i){var s=n/2,u=i/2,a=t-s,d=t+s,p=r-u,g=r+u,v=$1(n,i),_=v.widthOffset,b=v.heightOffset,k=v.ctrlPtOffsetPct*_;e.beginPath&&e.beginPath(),e.moveTo(a,p+b),e.lineTo(a,g-b),e.quadraticCurveTo(a+k,g,a+_,g),e.lineTo(d-_,g),e.quadraticCurveTo(d-k,g,d,g-b),e.lineTo(d,p+b),e.quadraticCurveTo(d-k,p,d-_,p),e.lineTo(a+_,p),e.quadraticCurveTo(a+k,p,a,p+b),e.closePath()};var $I=Math.sin(0),VI=Math.cos(0),r2={},n2={},cR=Math.PI/40;for(var Nh=0*Math.PI;Nh<2*Math.PI;Nh+=cR)r2[Nh]=Math.sin(Nh),n2[Nh]=Math.cos(Nh);mu.drawEllipsePath=function(e,t,r,n,i){if(e.beginPath&&e.beginPath(),e.ellipse)e.ellipse(t,r,n/2,i/2,0,0,2*Math.PI);else for(var s,u,a=n/2,d=i/2,p=0*Math.PI;p<2*Math.PI;p+=cR)s=t-a*r2[p]*$I+a*n2[p]*VI,u=r+d*n2[p]*$I+d*r2[p]*VI,p===0?e.moveTo(s,u):e.lineTo(s,u);e.closePath()};var Wm={};Wm.createBuffer=function(e,t){var r=document.createElement("canvas");return r.width=e,r.height=t,[r,r.getContext("2d")]};Wm.bufferCanvasImage=function(e){var t=this.cy,r=t.mutableElements(),n=r.boundingBox(),i=this.findContainerClientCoords(),s=e.full?Math.ceil(n.w):i[2],u=e.full?Math.ceil(n.h):i[3],a=Rt(e.maxWidth)||Rt(e.maxHeight),d=this.getPixelRatio(),p=1;if(e.scale!==void 0)s*=e.scale,u*=e.scale,p=e.scale;else if(a){var g=1/0,v=1/0;Rt(e.maxWidth)&&(g=p*e.maxWidth/s),Rt(e.maxHeight)&&(v=p*e.maxHeight/u),p=Math.min(g,v),s*=p,u*=p}a||(s*=d,u*=d,p*=d);var _=document.createElement("canvas");_.width=s,_.height=u,_.style.width=s+"px",_.style.height=u+"px";var b=_.getContext("2d");if(s>0&&u>0){b.clearRect(0,0,s,u),b.globalCompositeOperation="source-over";var k=this.getCachedZSortedEles();if(e.full)b.translate(-n.x1*p,-n.y1*p),b.scale(p,p),this.drawElements(b,k),b.scale(1/p,1/p),b.translate(n.x1*p,n.y1*p);else{var A=t.pan(),M={x:A.x*p,y:A.y*p};p*=t.zoom(),b.translate(M.x,M.y),b.scale(p,p),this.drawElements(b,k),b.scale(1/p,1/p),b.translate(-M.x,-M.y)}e.bg&&(b.globalCompositeOperation="destination-over",b.fillStyle=e.bg,b.rect(0,0,s,u),b.fill())}return _};function Iq(e,t){for(var r=atob(e),n=new ArrayBuffer(r.length),i=new Uint8Array(n),s=0;s<r.length;s++)i[s]=r.charCodeAt(s);return new Blob([n],{type:t})}function UI(e){var t=e.indexOf(",");return e.substr(t+1)}function hR(e,t,r){var n=function(){return t.toDataURL(r,e.quality)};switch(e.output){case"blob-promise":return new Bd(function(i,s){try{t.toBlob(function(u){u!=null?i(u):s(new Error("`canvas.toBlob()` sent a null value in its callback"))},r,e.quality)}catch(u){s(u)}});case"blob":return Iq(UI(n()),r);case"base64":return UI(n());case"base64uri":default:return n()}}Wm.png=function(e){return hR(e,this.bufferCanvasImage(e),"image/png")};Wm.jpg=function(e){return hR(e,this.bufferCanvasImage(e),"image/jpeg")};var dR={};dR.nodeShapeImpl=function(e,t,r,n,i,s,u,a){switch(e){case"ellipse":return this.drawEllipsePath(t,r,n,i,s);case"polygon":return this.drawPolygonPath(t,r,n,i,s,u);case"round-polygon":return this.drawRoundPolygonPath(t,r,n,i,s,u,a);case"roundrectangle":case"round-rectangle":return this.drawRoundRectanglePath(t,r,n,i,s,a);case"cutrectangle":case"cut-rectangle":return this.drawCutRectanglePath(t,r,n,i,s,u,a);case"bottomroundrectangle":case"bottom-round-rectangle":return this.drawBottomRoundRectanglePath(t,r,n,i,s,a);case"barrel":return this.drawBarrelPath(t,r,n,i,s)}};var Aq=fR,Pr=fR.prototype;Pr.CANVAS_LAYERS=3;Pr.SELECT_BOX=0;Pr.DRAG=1;Pr.NODE=2;Pr.WEBGL=3;Pr.CANVAS_TYPES=["2d","2d","2d","webgl2"];Pr.BUFFER_COUNT=3;Pr.TEXTURE_BUFFER=0;Pr.MOTIONBLUR_BUFFER_NODE=1;Pr.MOTIONBLUR_BUFFER_DRAG=2;function fR(e){var t=this,r=t.cy.window(),n=r.document;e.webgl&&(Pr.CANVAS_LAYERS=t.CANVAS_LAYERS=4,console.log("webgl rendering enabled")),t.data={canvases:new Array(Pr.CANVAS_LAYERS),contexts:new Array(Pr.CANVAS_LAYERS),canvasNeedsRedraw:new Array(Pr.CANVAS_LAYERS),bufferCanvases:new Array(Pr.BUFFER_COUNT),bufferContexts:new Array(Pr.CANVAS_LAYERS)};var i="-webkit-tap-highlight-color",s="rgba(0,0,0,0)";t.data.canvasContainer=n.createElement("div");var u=t.data.canvasContainer.style;t.data.canvasContainer.style[i]=s,u.position="relative",u.zIndex="0",u.overflow="hidden";var a=e.cy.container();a.appendChild(t.data.canvasContainer),a.style[i]=s;var d={"-webkit-user-select":"none","-moz-user-select":"-moz-none","user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)","outline-style":"none"};Ej()&&(d["-ms-touch-action"]="none",d["touch-action"]="none");for(var p=0;p<Pr.CANVAS_LAYERS;p++){var g=t.data.canvases[p]=n.createElement("canvas"),v=Pr.CANVAS_TYPES[p];t.data.contexts[p]=g.getContext(v),t.data.contexts[p]||_n("Could not create canvas of type "+v),Object.keys(d).forEach(function(rt){g.style[rt]=d[rt]}),g.style.position="absolute",g.setAttribute("data-id","layer"+p),g.style.zIndex=String(Pr.CANVAS_LAYERS-p),t.data.canvasContainer.appendChild(g),t.data.canvasNeedsRedraw[p]=!1}t.data.topCanvas=t.data.canvases[0],t.data.canvases[Pr.NODE].setAttribute("data-id","layer"+Pr.NODE+"-node"),t.data.canvases[Pr.SELECT_BOX].setAttribute("data-id","layer"+Pr.SELECT_BOX+"-selectbox"),t.data.canvases[Pr.DRAG].setAttribute("data-id","layer"+Pr.DRAG+"-drag"),t.data.canvases[Pr.WEBGL]&&t.data.canvases[Pr.WEBGL].setAttribute("data-id","layer"+Pr.WEBGL+"-webgl");for(var p=0;p<Pr.BUFFER_COUNT;p++)t.data.bufferCanvases[p]=n.createElement("canvas"),t.data.bufferContexts[p]=t.data.bufferCanvases[p].getContext("2d"),t.data.bufferCanvases[p].style.position="absolute",t.data.bufferCanvases[p].setAttribute("data-id","buffer"+p),t.data.bufferCanvases[p].style.zIndex=String(-p-1),t.data.bufferCanvases[p].style.visibility="hidden";t.pathsEnabled=!0;var _=ta(),b=function(Oe){return{x:(Oe.x1+Oe.x2)/2,y:(Oe.y1+Oe.y2)/2}},k=function(Oe){return{x:-Oe.w/2,y:-Oe.h/2}},A=function(Oe){var Ge=Oe[0]._private,Ze=Ge.oldBackgroundTimestamp===Ge.backgroundTimestamp;return!Ze},M=function(Oe){return Oe[0]._private.nodeKey},P=function(Oe){return Oe[0]._private.labelStyleKey},I=function(Oe){return Oe[0]._private.sourceLabelStyleKey},z=function(Oe){return Oe[0]._private.targetLabelStyleKey},O=function(Oe,Ge,Ze,it,mt){return t.drawElement(Oe,Ge,Ze,!1,!1,mt)},V=function(Oe,Ge,Ze,it,mt){return t.drawElementText(Oe,Ge,Ze,it,"main",mt)},U=function(Oe,Ge,Ze,it,mt){return t.drawElementText(Oe,Ge,Ze,it,"source",mt)},$=function(Oe,Ge,Ze,it,mt){return t.drawElementText(Oe,Ge,Ze,it,"target",mt)},G=function(Oe){return Oe.boundingBox(),Oe[0]._private.bodyBounds},Z=function(Oe){return Oe.boundingBox(),Oe[0]._private.labelBounds.main||_},Q=function(Oe){return Oe.boundingBox(),Oe[0]._private.labelBounds.source||_},X=function(Oe){return Oe.boundingBox(),Oe[0]._private.labelBounds.target||_},ie=function(Oe,Ge){return Ge},te=function(Oe){return b(G(Oe))},W=function(Oe,Ge,Ze){var it=Oe?Oe+"-":"";return{x:Ge.x+Ze.pstyle(it+"text-margin-x").pfValue,y:Ge.y+Ze.pstyle(it+"text-margin-y").pfValue}},oe=function(Oe,Ge,Ze){var it=Oe[0]._private.rscratch;return{x:it[Ge],y:it[Ze]}},se=function(Oe){return W("",oe(Oe,"labelX","labelY"),Oe)},de=function(Oe){return W("source",oe(Oe,"sourceLabelX","sourceLabelY"),Oe)},me=function(Oe){return W("target",oe(Oe,"targetLabelX","targetLabelY"),Oe)},ae=function(Oe){return k(G(Oe))},ve=function(Oe){return k(Q(Oe))},pe=function(Oe){return k(X(Oe))},_e=function(Oe){var Ge=Z(Oe),Ze=k(Z(Oe));if(Oe.isNode()){switch(Oe.pstyle("text-halign").value){case"left":Ze.x=-Ge.w-(Ge.leftPad||0);break;case"right":Ze.x=-(Ge.rightPad||0);break}switch(Oe.pstyle("text-valign").value){case"top":Ze.y=-Ge.h-(Ge.topPad||0);break;case"bottom":Ze.y=-(Ge.botPad||0);break}}return Ze},De=t.data.eleTxrCache=new Sp(t,{getKey:M,doesEleInvalidateKey:A,drawElement:O,getBoundingBox:G,getRotationPoint:te,getRotationOffset:ae,allowEdgeTxrCaching:!1,allowParentTxrCaching:!1}),Le=t.data.lblTxrCache=new Sp(t,{getKey:P,drawElement:V,getBoundingBox:Z,getRotationPoint:se,getRotationOffset:_e,isVisible:ie}),je=t.data.slbTxrCache=new Sp(t,{getKey:I,drawElement:U,getBoundingBox:Q,getRotationPoint:de,getRotationOffset:ve,isVisible:ie}),Je=t.data.tlbTxrCache=new Sp(t,{getKey:z,drawElement:$,getBoundingBox:X,getRotationPoint:me,getRotationOffset:pe,isVisible:ie}),et=t.data.lyrTxrCache=new eR(t);t.onUpdateEleCalcs(function(Oe,Ge){De.invalidateElements(Ge),Le.invalidateElements(Ge),je.invalidateElements(Ge),Je.invalidateElements(Ge),et.invalidateElements(Ge);for(var Ze=0;Ze<Ge.length;Ze++){var it=Ge[Ze]._private;it.oldBackgroundTimestamp=it.backgroundTimestamp}});var ft=function(Oe){for(var Ge=0;Ge<Oe.length;Ge++)et.enqueueElementRefinement(Oe[Ge].ele)};De.onDequeue(ft),Le.onDequeue(ft),je.onDequeue(ft),Je.onDequeue(ft),e.webgl&&t.initWebgl(e,{getStyleKey:M,getLabelKey:P,getSourceLabelKey:I,getTargetLabelKey:z,drawElement:O,drawLabel:V,drawSourceLabel:U,drawTargetLabel:$,getElementBox:G,getLabelBox:Z,getSourceLabelBox:Q,getTargetLabelBox:X,getElementRotationPoint:te,getElementRotationOffset:ae,getLabelRotationPoint:se,getSourceLabelRotationPoint:de,getTargetLabelRotationPoint:me,getLabelRotationOffset:_e,getSourceLabelRotationOffset:ve,getTargetLabelRotationOffset:pe})}Pr.redrawHint=function(e,t){var r=this;switch(e){case"eles":r.data.canvasNeedsRedraw[Pr.NODE]=t;break;case"drag":r.data.canvasNeedsRedraw[Pr.DRAG]=t;break;case"select":r.data.canvasNeedsRedraw[Pr.SELECT_BOX]=t;break;case"gc":r.data.gc=!0;break}};var Mq=typeof Path2D<"u";Pr.path2dEnabled=function(e){if(e===void 0)return this.pathsEnabled;this.pathsEnabled=!!e};Pr.usePaths=function(){return Mq&&this.pathsEnabled};Pr.setImgSmoothing=function(e,t){e.imageSmoothingEnabled!=null?e.imageSmoothingEnabled=t:(e.webkitImageSmoothingEnabled=t,e.mozImageSmoothingEnabled=t,e.msImageSmoothingEnabled=t)};Pr.getImgSmoothing=function(e){return e.imageSmoothingEnabled!=null?e.imageSmoothingEnabled:e.webkitImageSmoothingEnabled||e.mozImageSmoothingEnabled||e.msImageSmoothingEnabled};Pr.makeOffscreenCanvas=function(e,t){var r;if((typeof OffscreenCanvas>"u"?"undefined":Jn(OffscreenCanvas))!=="undefined")r=new OffscreenCanvas(e,t);else{var n=this.cy.window(),i=n.document;r=i.createElement("canvas"),r.width=e,r.height=t}return r};[tR,Js,Uo,$S,Pc,pu,ia,sR,mu,Wm,dR].forEach(function(e){dr(Pr,e)});var Dq=[{name:"null",impl:$z},{name:"base",impl:Yz},{name:"canvas",impl:Aq}],Nq=[{type:"layout",extensions:iU},{type:"renderer",extensions:Dq}],pR={},mR={};function gR(e,t,r){var n=r,i=function(G){Gr("Can not register `"+t+"` for `"+e+"` since `"+G+"` already exists in the prototype and can not be overridden")};if(e==="core"){if(pm.prototype[t])return i(t);pm.prototype[t]=r}else if(e==="collection"){if(Si.prototype[t])return i(t);Si.prototype[t]=r}else if(e==="layout"){for(var s=function(G){this.options=G,r.call(this,G),Fr(this._private)||(this._private={}),this._private.cy=G.cy,this._private.listeners=[],this.createEmitter()},u=s.prototype=Object.create(r.prototype),a=[],d=0;d<a.length;d++){var p=a[d];u[p]=u[p]||function(){return this}}u.start&&!u.run?u.run=function(){return this.start(),this}:!u.start&&u.run&&(u.start=function(){return this.run(),this});var g=r.prototype.stop;u.stop=function(){var $=this.options;if($&&$.animate){var G=this.animations;if(G)for(var Z=0;Z<G.length;Z++)G[Z].stop()}return g?g.call(this):this.emit("layoutstop"),this},u.destroy||(u.destroy=function(){return this}),u.cy=function(){return this._private.cy};var v=function(G){return G._private.cy},_={addEventFields:function(G,Z){Z.layout=G,Z.cy=v(G),Z.target=G},bubble:function(){return!0},parent:function(G){return v(G)}};dr(u,{createEmitter:function(){return this._private.emitter=new H0(_,this),this},emitter:function(){return this._private.emitter},on:function(G,Z){return this.emitter().on(G,Z),this},one:function(G,Z){return this.emitter().one(G,Z),this},once:function(G,Z){return this.emitter().one(G,Z),this},removeListener:function(G,Z){return this.emitter().removeListener(G,Z),this},removeAllListeners:function(){return this.emitter().removeAllListeners(),this},emit:function(G,Z){return this.emitter().emit(G,Z),this}}),Hr.eventAliasesOn(u),n=s}else if(e==="renderer"&&t!=="null"&&t!=="base"){var b=vR("renderer","base"),k=b.prototype,A=r,M=r.prototype,P=function(){b.apply(this,arguments),A.apply(this,arguments)},I=P.prototype;for(var z in k){var O=k[z],V=M[z]!=null;if(V)return i(z);I[z]=O}for(var U in M)I[U]=M[U];k.clientFunctions.forEach(function($){I[$]=I[$]||function(){_n("Renderer does not implement `renderer."+$+"()` on its prototype")}}),n=P}else if(e==="__proto__"||e==="constructor"||e==="prototype")return _n(e+" is an illegal type to be registered, possibly lead to prototype pollutions");return RN({map:pR,keys:[e,t],value:n})}function vR(e,t){return LN({map:pR,keys:[e,t]})}function zq(e,t,r,n,i){return RN({map:mR,keys:[e,t,r,n],value:i})}function Rq(e,t,r,n){return LN({map:mR,keys:[e,t,r,n]})}var i2=function(){if(arguments.length===2)return vR.apply(null,arguments);if(arguments.length===3)return gR.apply(null,arguments);if(arguments.length===4)return Rq.apply(null,arguments);if(arguments.length===5)return zq.apply(null,arguments);_n("Invalid extension access syntax")};pm.prototype.extension=i2;Nq.forEach(function(e){e.extensions.forEach(function(t){gR(e.type,t.name,t.impl)})});var t0=function(){if(!(this instanceof t0))return new t0;this.length=0},_c=t0.prototype;_c.instanceString=function(){return"stylesheet"};_c.selector=function(e){var t=this.length++;return this[t]={selector:e,properties:[]},this};_c.css=function(e,t){var r=this.length-1;if(sr(e))this[r].properties.push({name:e,value:t});else if(Fr(e))for(var n=e,i=Object.keys(n),s=0;s<i.length;s++){var u=i[s],a=n[u];if(a!=null){var d=fi.properties[u]||fi.properties[R0(u)];if(d!=null){var p=d.name,g=a;this[r].properties.push({name:p,value:g})}}}return this};_c.style=_c.css;_c.generateStyle=function(e){var t=new fi(e);return this.appendToStyle(t)};_c.appendToStyle=function(e){for(var t=0;t<this.length;t++){var r=this[t],n=r.selector,i=r.properties;e.selector(n);for(var s=0;s<i.length;s++){var u=i[s];e.css(u.name,u.value)}}return e};var Lq="3.33.1",wc=function(t){if(t===void 0&&(t={}),Fr(t))return new pm(t);if(sr(t))return i2.apply(i2,arguments)};wc.use=function(e){var t=Array.prototype.slice.call(arguments,1);return t.unshift(wc),e.apply(null,t),this};wc.warnings=function(e){return UN(e)};wc.version=Lq;wc.stylesheet=wc.Stylesheet=t0;function yR({elements:e,followLive:t=!1,latestEntity:r=null,layout:n="breadthfirst",showEdgeLabels:i=!0}){const s=ce.useRef(null),u=ce.useRef(null),[a,d]=ce.useState(!1),p=ce.useRef(null),g=N0(b=>b.set),v=ce.useRef(null);ce.useEffect(()=>{if(!s.current||u.current||a)return;const b=()=>{if(!s.current)return;const k=s.current.offsetWidth,A=s.current.offsetHeight;if(k===0||A===0){setTimeout(b,100);return}try{const M=wc({container:s.current,elements:[],style:[{selector:"node",style:{"background-color":"#22d3ee",label:"data(label)",color:"#cbd5e1","font-size":12}},{selector:"edge",style:{"line-color":"#64748b","target-arrow-color":"#64748b","target-arrow-shape":"triangle","curve-style":"bezier",label:"data(label)","font-size":10}},{selector:".selected",style:{"border-width":4,"border-color":"#fff"}}]});M.style().selector("edge").style("label",i?"data(label)":"").update(),M.on("tap","node",P=>{const I=P.target.id(),z=P.target.data("type");p.current=I,g({id:I,type:z}),M.elements().removeClass("selected"),P.target.addClass("selected")}),u.current=M,d(!0)}catch(M){console.error("Failed to initialize graph:",M)}};setTimeout(b,50)},[a,g]),ce.useEffect(()=>{if(!(!u.current||!a))try{u.current.style().selector("edge").style("label",i?"data(label)":"").update()}catch(b){console.error("Failed to update edge labels:",b)}},[i,a]),ce.useEffect(()=>{if(!(!u.current||!a))return v.current&&clearTimeout(v.current),v.current=window.setTimeout(()=>{if(u.current)try{const b=p.current;if(u.current.elements().remove(),e.nodes.length>0||e.edges.length>0){if(u.current.add([...e.nodes,...e.edges]),b){const k=u.current.getElementById(b);k&&k.nonempty()&&k.addClass("selected")}u.current.layout({name:n,animate:!0,animationDuration:500}).run()}}catch(b){console.error("Failed to update graph:",b)}},500),()=>{v.current&&clearTimeout(v.current)}},[e,n,a]),ce.useEffect(()=>{if(!u.current||!a)return;const b=new ResizeObserver(()=>{u.current&&u.current.resize()});return s.current&&b.observe(s.current),()=>{b.disconnect()}},[a]),ce.useEffect(()=>a?vN(({id:k})=>{if(!u.current)return;const A=u.current.getElementById(k);A&&A.nonempty()&&(u.current.elements().removeClass("selected"),A.addClass("selected"),u.current.animate({fit:{eles:A,padding:50},duration:250}))}):void 0,[a]);const _=ce.useRef(0);return ce.useEffect(()=>{if(!t||!r||!u.current||!a)return;const b=u.current.getElementById(r.id);if(!b||b.empty())return;const k=Date.now();if(k-_.current<2e3){lr(`New event: ${r.type||r.id}`);return}_.current=k,u.current.elements().removeClass("selected"),b.addClass("selected"),u.current.animate({fit:{eles:b,padding:50},duration:250})},[t,r,a]),D.jsx("div",{ref:s,className:"rounded-lg bg-black/20",style:{width:"100%",height:"100%",minHeight:"300px",position:"absolute",top:0,left:0,right:0,bottom:0}})}const Bq="http://localhost:8089",Oq="halcyon-dev",r0="halcyon-ui",Fq=`${Bq}/realms/${Oq}/.well-known/openid-configuration`,Q0="halcyon_token",n0="halcyon_refresh_token",ex="halcyon_user";let Mv=null,Ju=null;async function xR(){return Mv||(Mv=await(await fetch(Fq)).json(),Mv)}async function _R(e,t){var v,_,b;const n=(await xR()).token_endpoint,i=new URLSearchParams({grant_type:"password",client_id:r0,username:e,password:t}),s=await fetch(n,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i});if(!s.ok)throw new Error("Login failed");const u=await s.json(),a=u.access_token,d=u.refresh_token,p=JSON.parse(atob(a.split(".")[1])),g={sub:p.sub,email:p.email,roles:((v=p.realm_access)==null?void 0:v.roles)||((b=(_=p.resource_access)==null?void 0:_[r0])==null?void 0:b.roles)||[]};localStorage.setItem(Q0,a),localStorage.setItem(ex,JSON.stringify(g)),d&&localStorage.setItem(n0,d),Ju=null;try{sessionStorage.removeItem("halcyon_redirecting_to_login")}catch{}return{token:a,user:g,refreshToken:d}}async function US(){return Ju||(Ju=(async()=>{var e,t,r;try{const n=localStorage.getItem(n0);if(!n)throw new Error("No refresh token available");const s=(await xR()).token_endpoint,u=new URLSearchParams({grant_type:"refresh_token",client_id:r0,refresh_token:n}),a=await fetch(s,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:u});if(!a.ok)throw qS(),new Error("Token refresh failed");const d=await a.json(),p=d.access_token,g=d.refresh_token,v=JSON.parse(atob(p.split(".")[1])),_={sub:v.sub,email:v.email,roles:((e=v.realm_access)==null?void 0:e.roles)||((r=(t=v.resource_access)==null?void 0:t[r0])==null?void 0:r.roles)||[]};return localStorage.setItem(Q0,p),localStorage.setItem(ex,JSON.stringify(_)),g&&localStorage.setItem(n0,g),{token:p,user:_}}finally{Ju=null}})(),Ju)}function qS(){localStorage.removeItem(Q0),localStorage.removeItem(n0),localStorage.removeItem(ex),Ju=null,window.location.href="/"}function ma(){return localStorage.getItem(Q0)}function HS(){const e=localStorage.getItem(ex);return e?JSON.parse(e):null}function Ln(e){const t=HS();return t?t.roles.includes(e):!1}function wR(){return!!ma()}const gm=Object.freeze(Object.defineProperty({__proto__:null,getToken:ma,getUser:HS,hasRole:Ln,isAuthenticated:wR,login:_R,logout:qS,refresh:US},Symbol.toStringTag,{value:"Module"})),bR="halcyon_redirecting_to_login";function Fh(){try{return sessionStorage.getItem(bR)==="true"}catch{return!1}}function gs(e){try{e&&sessionStorage.setItem(bR,"true")}catch{}}function vs(){return!(typeof window>"u"||window.location.pathname==="/login"||window.location.pathname.includes("/login")||Fh())}async function tx(e,t){const r=ma(),n={"Content-Type":"application/json"};r&&(n.Authorization=`Bearer ${r}`);let i=await fetch("http://localhost:8088/graphql",{method:"POST",headers:n,body:JSON.stringify({query:e,variables:t})});if(i.status===401&&vs())throw gs(!0),window.location.href="/login",new Error("Unauthorized");const s=await i.json();if(s.errors)throw new Error(s.errors[0].message);if(!s.data)throw new Error("No data returned");return s.data}const Ib="http://localhost:8088/graphql",up=Ib.includes("/graphql")?Ib.replace("/graphql",""):Ib.replace(/\/$/,"")||"http://localhost:8088",nn={async get(e,t){if(Fh())throw new Error("Unauthorized");const r=ma();if(!r)throw vs()&&(gs(!0),window.location.href="/login"),new Error("Unauthorized");const n={Authorization:`Bearer ${r}`};let i=`${up}${e}`;if(t!=null&&t.params){const a=new URLSearchParams;Object.entries(t.params).forEach(([d,p])=>{p!=null&&a.append(d,String(p))}),a.toString()&&(i+=`?${a.toString()}`)}const s=await fetch(i,{headers:n});if(s.status===401&&vs())throw gs(!0),window.location.href="/login",new Error("Unauthorized");if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);return{data:await s.json()}},async delete(e){if(Fh())throw new Error("Unauthorized");const t=ma();if(!t)throw vs()&&(gs(!0),window.location.href="/login"),new Error("Unauthorized");const r={Authorization:`Bearer ${t}`},n=await fetch(`${up}${e}`,{method:"DELETE",headers:r});if(n.status===401&&vs())throw gs(!0),window.location.href="/login",new Error("Unauthorized");if(n.status===403){const s=await n.json().catch(()=>({detail:n.statusText}));throw new Error(`HTTP ${n.status}: ${s.detail||n.statusText}`)}if(!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);const i=await n.text();return{data:i?JSON.parse(i):{}}},async put(e,t){if(Fh())throw new Error("Unauthorized");const r=ma();if(!r)throw vs()&&(gs(!0),window.location.href="/login"),new Error("Unauthorized");const n={"Content-Type":"application/json",Authorization:`Bearer ${r}`},i=await fetch(`${up}${e}`,{method:"PUT",headers:n,body:t?JSON.stringify(t):void 0});if(i.status===401&&vs())throw gs(!0),window.location.href="/login",new Error("Unauthorized");if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);return{data:await i.json()}},async patch(e,t){if(Fh())throw new Error("Unauthorized");const r=ma();if(!r)throw vs()&&(gs(!0),window.location.href="/login"),new Error("Unauthorized");const n={"Content-Type":"application/json",Authorization:`Bearer ${r}`},i=await fetch(`${up}${e}`,{method:"PATCH",headers:n,body:t?JSON.stringify(t):void 0});if(i.status===401&&vs())throw gs(!0),window.location.href="/login",new Error("Unauthorized");if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);return{data:await i.json()}},async post(e,t){if(Fh())throw new Error("Unauthorized");const r=ma();if(!r)throw vs()&&(gs(!0),window.location.href="/login"),new Error("Unauthorized");const n={"Content-Type":"application/json",Authorization:`Bearer ${r}`},i=await fetch(`${up}${e}`,{method:"POST",headers:n,body:t?JSON.stringify(t):void 0});if(i.status===401&&vs())throw gs(!0),window.location.href="/login",new Error("Unauthorized");if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);return{data:await i.json()}}};function jq(){const[e,t]=ce.useState([]),[r,n]=ce.useState(!0),[i,s]=ce.useState(null),u=ce.useRef(new Map);return ce.useEffect(()=>((async()=>{n(!0),s(null);try{const g=await tx("query { relationships { type fromId toId attrs } }");u.current=new Map(g.relationships.map((v,_)=>[`${v.fromId}-${v.type}-${v.toId}`,v])),t(g.relationships)}catch(p){s(p.message)}finally{n(!1)}})(),vS(p=>{if(p.t==="relationship.upsert"&&p.data){const g=p.data,v=`${g.fromId}-${g.type}-${g.toId}`;u.current.set(v,g),t(Array.from(u.current.values()))}})),[]),{relationships:e,loading:r,error:i}}function $q(e,t){const{entities:r,loading:n,error:i}=z0(),{relationships:s,loading:u,error:a}=jq();return{elements:ce.useMemo(()=>{const p=Date.now(),g={"1h":60*60*1e3,"6h":6*60*60*1e3,"24h":24*60*60*1e3};let v=r.filter(P=>{var I,z,O;if(e.entityType!=="all"&&P.type!==e.entityType||e.severity!=="all"&&((z=(I=P.attrs)==null?void 0:I.severity)==null?void 0:z.toLowerCase())!==e.severity)return!1;if(e.timeWindow!=="all"){const V=(O=P.attrs)==null?void 0:O.timestamp;if(!V)return!1;const U=new Date(V).getTime(),$=g[e.timeWindow];if(p-U>$)return!1}return!0});const _=v.slice(0,t),b=new Set(_.map(P=>P.id)),k=s.filter(P=>b.has(P.fromId)&&b.has(P.toId)),A=_.map(P=>({data:{id:P.id,label:P.type==="Location"&&P.attrs.name?P.attrs.name:P.id,type:P.type}})),M=k.map((P,I)=>({data:{id:`edge-${I}`,source:P.fromId,target:P.toId,label:P.type}}));return{nodes:A,edges:M,totalFiltered:v.length,hasMore:v.length>t}},[r,s,e,t]),loading:n||u,error:i||a}}const Ab=200,Vq=()=>{const{onNewEntity:e}=z0(),{followLiveGraph:t,setFollowLiveGraph:r}=TN(),[n,i]=ce.useState(null),[s,u]=ce.useState("all"),[a,d]=ce.useState("all"),[p,g]=ce.useState("all"),[v,_]=ce.useState(Ab),[b,k]=ce.useState("breadthfirst"),[A,M]=ce.useState(!0);ce.useEffect(()=>{e(U=>{i(U)})},[e]),ce.useEffect(()=>{_(Ab)},[s,a,p]);const{elements:P,loading:I,error:z,hasMore:O}=$q({entityType:s,severity:a,timeWindow:p},v),V=ce.useCallback(()=>{_(U=>U+Ab)},[]);return D.jsxs(lc,{title:"Graph",children:[D.jsxs("div",{className:"px-3 py-2 border-b border-white/10 space-y-2",children:[D.jsxs("div",{className:"flex items-center justify-between",children:[D.jsx("div",{className:"text-sm opacity-80",children:"Graph"}),D.jsxs("label",{className:"flex items-center gap-2 text-xs cursor-pointer",children:[D.jsx("input",{type:"checkbox",checked:t,onChange:U=>r(U.target.checked),className:"w-3 h-3"}),"Follow Live"]})]}),D.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[D.jsxs("select",{value:s,onChange:U=>u(U.target.value),className:"px-2 py-1 rounded bg-white/10 border border-white/20 text-white",children:[D.jsx("option",{value:"all",children:"All Types"}),D.jsx("option",{value:"Event",children:"Events"}),D.jsx("option",{value:"Asset",children:"Assets"}),D.jsx("option",{value:"Location",children:"Locations"}),D.jsx("option",{value:"Anomaly",children:"Anomalies"})]}),D.jsxs("select",{value:a,onChange:U=>d(U.target.value),className:"px-2 py-1 rounded bg-white/10 border border-white/20 text-white",children:[D.jsx("option",{value:"all",children:"All Severities"}),D.jsx("option",{value:"low",children:"Low"}),D.jsx("option",{value:"medium",children:"Medium"}),D.jsx("option",{value:"high",children:"High"})]}),D.jsxs("select",{value:p,onChange:U=>g(U.target.value),className:"px-2 py-1 rounded bg-white/10 border border-white/20 text-white",children:[D.jsx("option",{value:"all",children:"All Time"}),D.jsx("option",{value:"1h",children:"Last 1h"}),D.jsx("option",{value:"6h",children:"Last 6h"}),D.jsx("option",{value:"24h",children:"Last 24h"})]}),D.jsxs("select",{value:b,onChange:U=>k(U.target.value),className:"px-2 py-1 rounded bg-white/10 border border-white/20 text-white",children:[D.jsx("option",{value:"breadthfirst",children:"Breadthfirst"}),D.jsx("option",{value:"cose",children:"Cose"})]}),D.jsxs("label",{className:"flex items-center gap-1 px-2 py-1 rounded bg-white/10 border border-white/20 cursor-pointer",children:[D.jsx("input",{type:"checkbox",checked:A,onChange:U=>M(U.target.checked),className:"w-3 h-3"}),"Edge Labels"]}),O&&D.jsxs("button",{onClick:V,className:"px-2 py-1 rounded bg-teal-600 hover:bg-teal-700 text-white text-xs",children:["Load More (",P.totalFiltered-v," remaining)"]})]})]}),I&&D.jsx("div",{className:"text-sm text-muted mb-2 flex-shrink-0 p-3",children:"Loading..."}),z&&D.jsxs("div",{className:"text-sm text-red-400 mb-2 flex-shrink-0 p-3",children:["Error: ",z]}),!I&&D.jsx("div",{className:"flex-1 min-h-0 p-3",style:{position:"relative",height:"100%"},children:D.jsx(yR,{elements:P,followLive:t,latestEntity:n,layout:b,showEdgeLabels:A})})]})},cp=20,Uq=()=>{const{entities:e,loading:t,error:r}=z0(),n=N0(d=>d.set),[i,s]=ce.useState(1),u=ce.useMemo(()=>{const d=(i-1)*cp;return e.slice(d,d+cp)},[e,i]),a=Math.ceil(e.length/cp);return D.jsxs(lc,{title:"Entities",children:[t&&D.jsx("div",{className:"text-sm text-muted flex-shrink-0 p-3",children:"Loading..."}),r&&D.jsxs("div",{className:"text-sm text-red-400 flex-shrink-0 p-3",children:["Error: ",r]}),!t&&!r&&D.jsxs(D.Fragment,{children:[D.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto p-3",children:D.jsx("ul",{className:"space-y-2 text-sm",children:u.length===0?D.jsx("li",{className:"opacity-70",children:"No entities found. Run the seed script to add sample data."}):u.map(d=>D.jsxs("li",{className:"p-2 rounded bg-black/20 cursor-pointer hover:bg-black/40 transition-colors",onClick:()=>n({id:d.id,type:d.type}),children:[D.jsxs("div",{className:"font-medium",children:[d.type,": ",d.id]}),D.jsx("div",{className:"text-xs text-muted mt-1",children:Object.entries(d.attrs).map(([p,g])=>D.jsxs("div",{children:[p,": ",String(g)]},p))})]},d.id))})}),a>1&&D.jsxs("div",{className:"flex items-center justify-between p-3 border-t border-white/10 flex-shrink-0",children:[D.jsxs("div",{className:"text-xs text-muted",children:["Showing ",(i-1)*cp+1,"-",Math.min(i*cp,e.length)," of ",e.length]}),D.jsxs("div",{className:"flex gap-2",children:[D.jsx("button",{onClick:()=>s(d=>Math.max(1,d-1)),disabled:i===1,className:"px-2 py-1 text-xs rounded bg-white/10 hover:bg-white/20 disabled:opacity-50 disabled:cursor-not-allowed",children:"Prev"}),D.jsxs("span",{className:"px-2 py-1 text-xs opacity-70",children:[i," / ",a]}),D.jsx("button",{onClick:()=>s(d=>Math.min(a,d+1)),disabled:i===a,className:"px-2 py-1 text-xs rounded bg-white/10 hover:bg-white/20 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})]})]})};function qq(e="hour"){const[t,r]=ce.useState([]),[n,i]=ce.useState(!1),[s,u]=ce.useState(null);return ce.useEffect(()=>{i(!0),u(null),fetch(`http://localhost:8081/events/counts?bucket=${e}`).then(d=>{if(!d.ok)throw new Error(`HTTP ${d.status}`);return d.json()}).then(d=>{r(d),i(!1)}).catch(d=>{u(String(d)),i(!1)})},[e]),{data:t,loading:n,error:s}}const vm=ls(e=>({playing:!1,speed:1,cursor:null,rangeStart:null,rangeEnd:null,setRange:(t,r)=>e({rangeStart:t,rangeEnd:r,cursor:t}),play:()=>e({playing:!0}),pause:()=>e({playing:!1}),seek:t=>e({cursor:t}),setSpeed:t=>e({speed:t})}));function Hq(){const{playing:e,speed:t,pause:r,play:n,seek:i,setSpeed:s,cursor:u,rangeStart:a,rangeEnd:d}=vm(),p=_=>{s(parseFloat(_.target.value))},g=_=>{if(a&&d){const b=new Date(a).getTime(),k=new Date(d).getTime(),A=parseFloat(_.target.value)/100,M=new Date(b+(k-b)*A);i(M.toISOString())}},v=()=>{if(!u||!a||!d)return 0;const _=new Date(a).getTime(),b=new Date(d).getTime(),k=new Date(u).getTime();return b===_?0:(k-_)/(b-_)*100};return D.jsx("div",{className:"bg-panel rounded-lg p-3 border border-white/10",children:D.jsxs("div",{className:"flex items-center gap-3",children:[D.jsx("button",{onClick:e?r:n,className:"px-4 py-2 bg-white/10 hover:bg-white/20 rounded transition-colors",children:e?" Pause":" Play"}),D.jsxs("div",{className:"flex items-center gap-2",children:[D.jsx("label",{className:"text-sm opacity-80",children:"Speed:"}),D.jsxs("select",{value:t,onChange:p,className:"px-2 py-1 bg-black/20 border border-white/10 rounded text-sm",children:[D.jsx("option",{value:.25,children:"0.25x"}),D.jsx("option",{value:.5,children:"0.5x"}),D.jsx("option",{value:1,children:"1x"}),D.jsx("option",{value:2,children:"2x"}),D.jsx("option",{value:4,children:"4x"})]})]}),u&&D.jsx("div",{className:"text-sm opacity-60",children:new Date(u).toLocaleString()}),a&&d&&D.jsx("div",{className:"flex-1",children:D.jsx("input",{type:"range",min:"0",max:"100",value:v(),onChange:g,className:"w-full"})})]})})}function Gq(){const{rangeStart:e,rangeEnd:t,setRange:r}=vm(),[n,i]=ce.useState(e?e.slice(0,16):""),[s,u]=ce.useState(t?t.slice(0,16):""),a=()=>{const d=n?new Date(n).toISOString():null,p=s?new Date(s).toISOString():null;r(d,p)};return D.jsx("div",{className:"bg-panel rounded-lg p-3 border border-white/10",children:D.jsxs("div",{className:"flex items-center gap-3",children:[D.jsxs("div",{className:"flex items-center gap-2",children:[D.jsx("label",{className:"text-sm opacity-80",children:"From:"}),D.jsx("input",{type:"datetime-local",value:n,onChange:d=>i(d.target.value),className:"px-2 py-1 bg-black/20 border border-white/10 rounded text-sm"})]}),D.jsxs("div",{className:"flex items-center gap-2",children:[D.jsx("label",{className:"text-sm opacity-80",children:"To:"}),D.jsx("input",{type:"datetime-local",value:s,onChange:d=>u(d.target.value),className:"px-2 py-1 bg-black/20 border border-white/10 rounded text-sm"})]}),D.jsx("button",{onClick:a,className:"px-3 py-1 bg-white/10 hover:bg-white/20 rounded text-sm transition-colors",children:"Set Range"})]})})}function Wq(){const{playing:e,speed:t,cursor:r,rangeStart:n,rangeEnd:i,seek:s,pause:u}=vm(),a=ce.useRef(Date.now());ce.useEffect(()=>{if(!e||!r||!n||!i){a.current=Date.now();return}new Date(n).getTime();const d=new Date(i).getTime(),p=new Date(r).getTime();if(p>=d){u();return}const g=setInterval(()=>{const v=Date.now(),_=(v-a.current)/1e3;a.current=v;const b=_*t,k=p+b*1e3;k>=d?(s(new Date(d).toISOString()),u()):s(new Date(k).toISOString())},100);return()=>clearInterval(g)},[e,t,r,n,i,s,u])}const SR=()=>{Wq();const{cursor:e}=vm(),{data:t,loading:r,error:n}=qq("hour");if(r)return D.jsx(lc,{title:"Timeline",children:D.jsx("div",{className:"h-28 rounded-lg bg-black/20 flex items-center justify-center text-muted",children:"Loading..."})});if(n)return D.jsx(lc,{title:"Timeline",children:D.jsxs("div",{className:"h-28 rounded-lg bg-black/20 flex items-center justify-center text-red-400 text-sm",children:["Error: ",n]})});const i=t.length>0?Math.max(...t.map(s=>s.c)):1;return D.jsx(lc,{title:"Timeline",children:D.jsxs("div",{className:"space-y-3",children:[D.jsx(Gq,{}),D.jsx(Hq,{}),D.jsxs("div",{className:"h-28 rounded-lg bg-black/20 p-3 relative",children:[e&&D.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 bg-yellow-400 z-10",style:{left:`${(()=>{if(!t.length)return 0;const s=new Date(e).getTime(),u=new Date(t[0].ts).getTime(),a=new Date(t[t.length-1].ts).getTime();if(a===u)return 0;const d=(s-u)/(a-u)*100;return Math.max(0,Math.min(100,d))})()}%`}}),t.length===0?D.jsx("div",{className:"h-full flex items-center justify-center text-muted text-sm",children:"No event data"}):D.jsx("div",{className:"h-full flex items-end gap-[2px] relative",children:t.map((s,u)=>{const a=i>0?s.c/i*100:0,d=new Date(s.ts).getTime(),p=e&&Math.abs(new Date(e).getTime()-d)<36e5;return D.jsx("div",{className:`flex-1 rounded-t-sm transition-all cursor-pointer ${p?"bg-yellow-500/80 hover:bg-yellow-400":"bg-teal-500/80 hover:bg-teal-400"}`,style:{height:`${Math.max(a,s.c>0?10:0)}%`,minWidth:t.length>20?"1px":"2px",maxWidth:t.length===1?"20%":"none"},title:`${s.ts}: ${s.c} event${s.c!==1?"s":""}`,onClick:()=>{const{seek:g}=vm.getState();g(new Date(s.ts).toISOString())}},u)})})]})]})})};function Zq(){const{id:e,type:t,clear:r}=N0(),[n,i]=Qe.useState(null);return Qe.useEffect(()=>{if(!e)return i(null);tx("query($id:ID!){ entityById(id:$id){ id type attrs } }",{id:e}).then(s=>i(s.entityById)).catch(()=>i(null))},[e]),e?D.jsxs("aside",{className:"fixed right-0 top-0 h-full w-[380px] bg-panel/95 border-l border-white/10 p-4",children:[D.jsxs("div",{className:"flex items-center justify-between mb-3",children:[D.jsxs("h3",{className:"font-semibold",children:[t,"  ",e]}),D.jsx("button",{className:"text-sm opacity-70 hover:opacity-100",onClick:r,children:"Close"})]}),D.jsx("pre",{className:"text-xs opacity-80 overflow-auto max-h-[70vh]",children:JSON.stringify((n==null?void 0:n.attrs)??{},null,2)}),D.jsx("div",{className:"mt-3 flex gap-2",children:D.jsx("button",{className:"px-2 py-1 rounded bg-white/10",onClick:()=>{var s,u;hk({id:e,type:t}),(s=n==null?void 0:n.attrs)!=null&&s.lat&&((u=n==null?void 0:n.attrs)!=null&&u.lon)&&setTimeout(()=>hk({id:e,type:t}),50)},children:"Focus on Map/Graph"})})]}):null}const Ic=ls(e=>({token:null,user:null,loading:!1,login:async(t,r)=>{e({loading:!0});try{const{token:n,user:i}=await _R(t,r);e({token:n,user:i,loading:!1})}catch(n){throw e({loading:!1}),n}},refresh:async()=>{try{const{token:t,user:r}=await US();e({token:t,user:r})}catch(t){throw e({token:null,user:null}),t}},logout:()=>{qS(),e({token:null,user:null})},initialize:()=>{const t=ma(),r=HS();e({token:t,user:r})}}));function Xq(){const[e,t]=ce.useState(""),[r,n]=ce.useState(""),[i,s]=ce.useState(null),{login:u,loading:a}=Ic(),d=async p=>{p.preventDefault(),s(null);try{await u(e,r)}catch(g){s(g instanceof Error?g.message:"Login failed")}};return D.jsx("div",{className:"min-h-screen bg-surface flex items-center justify-center",children:D.jsxs("div",{className:"bg-panel rounded-xl p-8 w-96 border border-white/10",children:[D.jsxs("div",{className:"flex flex-col items-center mb-6",children:[D.jsx("img",{src:"/logo.png",alt:"HALCYON Logo",className:"h-16 w-16 object-contain mb-4"}),D.jsx("h2",{className:"text-2xl font-semibold",children:"HALCYON Console"})]}),D.jsxs("form",{onSubmit:d,className:"space-y-4",children:[D.jsxs("div",{children:[D.jsx("label",{className:"block text-sm mb-1 opacity-80",children:"Username"}),D.jsx("input",{type:"text",value:e,onChange:p=>t(p.target.value),className:"w-full px-3 py-2 bg-black/20 border border-white/10 rounded focus:outline-none focus:border-white/30",required:!0})]}),D.jsxs("div",{children:[D.jsx("label",{className:"block text-sm mb-1 opacity-80",children:"Password"}),D.jsx("input",{type:"password",value:r,onChange:p=>n(p.target.value),className:"w-full px-3 py-2 bg-black/20 border border-white/10 rounded focus:outline-none focus:border-white/30",required:!0})]}),i&&D.jsx("div",{className:"text-red-400 text-sm",children:i}),D.jsx("button",{type:"submit",disabled:a,className:"w-full px-4 py-2 bg-white/10 hover:bg-white/20 rounded transition-colors disabled:opacity-50",children:a?"Logging in...":"Login"})]}),D.jsx("div",{className:"mt-4 text-xs opacity-60",children:"Dev users: admin/admin, analyst/analyst"})]})})}function Kq(){const{user:e,logout:t}=Ic();return e?D.jsxs("div",{className:"flex items-center gap-3",children:[D.jsxs("div",{className:"text-sm opacity-80",children:[D.jsx("div",{className:"font-medium",children:e.email||e.sub}),D.jsx("div",{className:"text-xs opacity-60",children:e.roles.join(", ")})]}),D.jsx("button",{onClick:t,className:"px-3 py-1 text-sm bg-white/10 hover:bg-white/20 rounded transition-colors",children:"Logout"})]}):null}const Za="http://localhost:8088";async function wo(e){if(!e.ok){if(e.status===401)try{await US()}catch{}throw new Error(`${e.status} ${e.statusText}`)}return e.json()}function Xa(){const e={"Content-Type":"application/json"},t=ma();return t&&(e.Authorization=`Bearer ${t}`),e}const fn={getQueries:()=>fetch(`${Za}/saved-queries`,{headers:Xa()}).then(wo),createQuery:e=>fetch(`${Za}/saved-queries`,{method:"POST",headers:Xa(),body:JSON.stringify(e)}).then(wo),updateQuery:(e,t)=>fetch(`${Za}/saved-queries/${e}`,{method:"PUT",headers:Xa(),body:JSON.stringify(t)}).then(wo),deleteQuery:e=>fetch(`${Za}/saved-queries/${e}`,{method:"DELETE",headers:Xa()}).then(()=>{}),getDashboards:()=>fetch(`${Za}/dashboards`,{headers:Xa()}).then(wo),createDashboard:e=>fetch(`${Za}/dashboards`,{method:"POST",headers:Xa(),body:JSON.stringify(e)}).then(wo),updateDashboard:(e,t)=>fetch(`${Za}/dashboards/${e}`,{method:"PUT",headers:Xa(),body:JSON.stringify(t)}).then(wo),deleteDashboard:e=>fetch(`${Za}/dashboards/${e}`,{method:"DELETE",headers:Xa()}).then(()=>{}),getDashboard:e=>fetch(`${Za}/dashboards/${e}`,{headers:Xa()}).then(wo).then(t=>({...t,panels:(t.panels||[]).map(r=>{var n,i,s,u;return{...r,queryId:((n=r.config)==null?void 0:n.queryId)||((i=r.config_json)==null?void 0:i.queryId),refreshSec:((s=r.config)==null?void 0:s.refreshSec)||((u=r.config_json)==null?void 0:u.refreshSec),config:r.config||r.config_json||{}}})})),createPanel:(e,t)=>fetch(`${Za}/dashboards/${e}/panels`,{method:"POST",headers:Xa(),body:JSON.stringify({dashboard_id:e,title:t.title,type:t.type,position:t.position??0,config_json:{...t.config||{},queryId:t.queryId,refreshSec:t.refreshSec}})}).then(wo).then(r=>{var n,i,s,u;return{...r,queryId:((n=r.config)==null?void 0:n.queryId)||((i=r.config_json)==null?void 0:i.queryId),refreshSec:((s=r.config)==null?void 0:s.refreshSec)||((u=r.config_json)==null?void 0:u.refreshSec),config:r.config||r.config_json||{}}}),updatePanel:(e,t,r)=>fetch(`${Za}/dashboards/${e}/panels/${t}`,{method:"PUT",headers:Xa(),body:JSON.stringify({...r.title!==void 0&&{title:r.title},...r.type!==void 0&&{type:r.type},...r.position!==void 0&&{position:r.position},...(r.config!==void 0||r.queryId!==void 0||r.refreshSec!==void 0)&&{config_json:{...r.config||{},...r.queryId!==void 0&&{queryId:r.queryId},...r.refreshSec!==void 0&&{refreshSec:r.refreshSec}}}})}).then(wo).then(n=>{var i,s,u,a;return{...n,queryId:((i=n.config)==null?void 0:i.queryId)||((s=n.config_json)==null?void 0:s.queryId),refreshSec:((u=n.config)==null?void 0:u.refreshSec)||((a=n.config_json)==null?void 0:a.refreshSec),config:n.config||n.config_json||{}}}),deletePanel:(e,t)=>fetch(`${Za}/dashboards/${e}/panels/${t}`,{method:"DELETE",headers:Xa()}).then(()=>{})},ER=ls((e,t)=>({queries:[],dashboards:[],panels:{},loading:!1,async loadAll(){e({loading:!0});try{const[r,n]=await Promise.all([fn.getQueries(),fn.getDashboards()]);e({queries:r,dashboards:n,loading:!1})}catch(r){e({loading:!1,error:String((r==null?void 0:r.message)||r)})}},async loadQueries(){try{e({queries:await fn.getQueries()})}catch(r){e({error:String((r==null?void 0:r.message)||r)})}},async loadDashboards(){try{e({dashboards:await fn.getDashboards()})}catch(r){e({error:String((r==null?void 0:r.message)||r)})}},async loadPanels(r){try{const n=await fn.getDashboard(r);e({panels:{...t().panels,[r]:n.panels||[]}})}catch(n){e({error:String((n==null?void 0:n.message)||n)})}}})),rx=({isOpen:e,onClose:t,title:r,children:n,className:i=""})=>e?D.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:t,children:D.jsxs("div",{className:`bg-panel rounded-xl border border-white/10 p-6 w-full max-w-md ${i}`,onClick:s=>s.stopPropagation(),children:[D.jsxs("div",{className:"flex items-center justify-between mb-4",children:[D.jsx("h3",{className:"text-lg font-semibold text-white",children:r}),D.jsx("button",{onClick:t,className:"text-white/70 hover:text-white text-xl leading-none",children:""})]}),n]})}):null,Qs=({isOpen:e,onClose:t,title:r,message:n,buttonText:i="OK",variant:s="info"})=>{const u={error:"bg-red-600 hover:bg-red-700",info:"bg-teal-600 hover:bg-teal-700",success:"bg-green-600 hover:bg-green-700"};return D.jsx(rx,{isOpen:e,onClose:t,title:r,children:D.jsxs("div",{className:"space-y-4",children:[D.jsx("p",{className:`text-white/80 ${s==="error"?"text-red-200":""}`,children:n}),D.jsx("div",{className:"flex justify-end",children:D.jsx("button",{onClick:t,className:`px-4 py-2 rounded text-white text-sm ${u[s]}`,children:i})})]})})},TR=({isOpen:e,onClose:t,onConfirm:r,title:n,message:i,confirmText:s="Confirm",cancelText:u="Cancel",danger:a=!1})=>{const d=()=>{r(),t()};return D.jsx(rx,{isOpen:e,onClose:t,title:n,children:D.jsxs("div",{className:"space-y-4",children:[D.jsx("p",{className:"text-white/80",children:i}),D.jsxs("div",{className:"flex gap-2 justify-end",children:[D.jsx("button",{onClick:t,className:"px-4 py-2 bg-white/10 hover:bg-white/20 rounded text-white text-sm",children:u}),D.jsx("button",{onClick:d,className:`px-4 py-2 rounded text-white text-sm ${a?"bg-red-600 hover:bg-red-700":"bg-teal-600 hover:bg-teal-700"}`,children:s})]})]})})};function Yq(){const{queries:e,loadQueries:t}=ER(),[r,n]=Qe.useState(""),[i,s]=Qe.useState("query { health }"),[u,a]=Qe.useState(!1),[d,p]=Qe.useState(null),[g,v]=Qe.useState({isOpen:!1,title:"",message:""}),[_,b]=Qe.useState({isOpen:!1,queryId:null});Qe.useEffect(()=>{t()},[t]);const k=async()=>{a(!0);try{await fn.createQuery({name:r||"Untitled",gql:i}),await t(),n(""),s("query { health }")}catch(P){v({isOpen:!0,title:"Error",message:P.message||"Failed to save query"})}finally{a(!1)}},A=async P=>{a(!0);try{const I=await tx(P,{});p(I)}catch(I){v({isOpen:!0,title:"Error",message:I.message||"Failed to run query"})}finally{a(!1)}},M=async()=>{if(_.queryId){const P=_.queryId;await fn.deleteQuery(P),await t(),b({isOpen:!1,queryId:null})}};return D.jsxs("div",{className:"space-y-3 p-4",children:[D.jsxs("div",{className:"flex gap-2",children:[D.jsx("input",{className:"bg-black/30 rounded px-2 py-1 w-60 text-white",placeholder:"Name",value:r,onChange:P=>n(P.target.value)}),D.jsx("button",{className:"px-3 py-1 bg-white/10 rounded hover:bg-white/20 disabled:opacity-50",onClick:k,disabled:u||!i.trim(),children:"Save Query"})]}),D.jsx("textarea",{className:"w-full h-40 bg-black/30 rounded p-2 font-mono text-white",value:i,onChange:P=>s(P.target.value)}),D.jsx("div",{className:"flex gap-2 items-center",children:D.jsx("button",{className:"px-3 py-1 bg-white/10 rounded hover:bg-white/20 disabled:opacity-50",onClick:()=>A(i),disabled:u,children:"Run"})}),D.jsx("h4",{className:"mt-4 opacity-70 text-white",children:"Saved"}),D.jsx("ul",{className:"space-y-1",children:e.map(P=>D.jsxs("li",{className:"flex items-center justify-between bg-black/20 rounded p-2",children:[D.jsx("div",{className:"opacity-90 text-white",children:P.name}),D.jsxs("div",{className:"flex gap-2",children:[D.jsx("button",{className:"text-xs opacity-80 hover:opacity-100 text-white",onClick:()=>A(P.gql),children:"Run"}),D.jsx("button",{className:"text-xs opacity-80 hover:opacity-100 text-white",onClick:()=>{b({isOpen:!0,queryId:P.id})},children:"Delete"})]})]},P.id))}),d&&D.jsxs("div",{className:"mt-3",children:[D.jsx("h4",{className:"opacity-70 text-white",children:"Result"}),D.jsx("pre",{className:"text-xs bg-black/30 rounded p-2 overflow-auto max-h-64 text-white",children:JSON.stringify(d,null,2)})]}),D.jsx(Qs,{isOpen:g.isOpen,onClose:()=>v({isOpen:!1,title:"",message:""}),title:g.title,message:g.message,variant:"error"}),D.jsx(TR,{isOpen:_.isOpen,onClose:()=>b({isOpen:!1,queryId:null}),onConfirm:M,title:"Delete Query",message:"Delete this query? This cannot be undone.",confirmText:"Delete",cancelText:"Cancel",danger:!0})]})}const Jq=[{type:"map",title:"Map",desc:"Geospatial markers"},{type:"graph",title:"Graph",desc:"Entity relationships"},{type:"list",title:"List",desc:"Tabular entity listing"},{type:"timeline",title:"Timeline",desc:"Time buckets & playback"},{type:"metric",title:"Metric",desc:"Single numeric KPI"},{type:"table",title:"Table",desc:"Sortable table view"},{type:"topbar",title:"Top-N Bars",desc:"Categorical metrics"},{type:"geoheat",title:"Geo Heat",desc:"Spatial density map"}];function Qq({onPick:e}){return D.jsx("div",{className:"grid grid-cols-4 gap-2",children:Jq.map(t=>D.jsxs("button",{className:"bg-black/20 rounded p-3 text-left hover:bg-white/5 text-white",onClick:()=>e(t.type),children:[D.jsx("div",{className:"font-semibold",children:t.title}),D.jsx("div",{className:"text-xs opacity-70",children:t.desc})]},t.type))})}const eH=({data:e,config:t})=>{const[r,n]=ce.useState(null),[i,s]=ce.useState("asc"),[u,a]=ce.useState(""),[d,p]=ce.useState(1),g=(t==null?void 0:t.pageSize)||20,v=ce.useMemo(()=>{if(!e)return[];if(Array.isArray(e))return e;if(Array.isArray(e.entities))return e.entities;if(Array.isArray(e.relationships))return e.relationships;const I=Object.values(e).find(z=>Array.isArray(z));return I||[e]},[e]),_=ce.useMemo(()=>{if(t!=null&&t.columns)return t.columns;if(v.length===0)return[];const I=v[0];return Object.keys(I).filter(O=>{const V=I[O];return V!=null&&(typeof V!="object"||Array.isArray(V))})},[v,t==null?void 0:t.columns]),b=ce.useMemo(()=>{let I=v;if(u){const z=u.toLowerCase();I=I.filter(O=>Object.values(O).some(V=>String(V).toLowerCase().includes(z)))}return r&&(I=[...I].sort((z,O)=>{const V=z[r],U=O[r],$=V<U?-1:V>U?1:0;return i==="asc"?$:-$})),I},[v,u,r,i]),k=ce.useMemo(()=>{const I=(d-1)*g;return b.slice(I,I+g)},[b,d,g]),A=Math.ceil(b.length/g),M=I=>{r===I?s(i==="asc"?"desc":"asc"):(n(I),s("asc")),p(1)},P=I=>I==null?"":typeof I=="object"?JSON.stringify(I):String(I);return v.length===0?D.jsx("div",{className:"text-sm text-white/70 p-4",children:"No data to display"}):D.jsxs("div",{className:"flex flex-col h-full",children:[D.jsx("div",{className:"p-2 border-b border-white/10",children:D.jsx("input",{type:"text",placeholder:"Filter rows...",value:u,onChange:I=>{a(I.target.value),p(1)},className:"w-full bg-black/30 rounded px-2 py-1 text-white text-xs"})}),D.jsx("div",{className:"flex-1 overflow-auto",children:D.jsxs("table",{className:"w-full text-xs",children:[D.jsx("thead",{className:"sticky top-0 bg-black/50",children:D.jsx("tr",{children:_.map(I=>D.jsx("th",{className:"px-2 py-1 text-left border-b border-white/10 cursor-pointer hover:bg-white/10 text-white/80",onClick:()=>M(I),children:D.jsxs("div",{className:"flex items-center gap-1",children:[I,r===I&&D.jsx("span",{className:"text-xs",children:i==="asc"?"":""})]})},I))})}),D.jsx("tbody",{children:k.map((I,z)=>D.jsx("tr",{className:"border-b border-white/5 hover:bg-white/5",children:_.map(O=>D.jsx("td",{className:"px-2 py-1 text-white/80",children:P(I[O])},O))},z))})]})}),A>1&&D.jsxs("div",{className:"flex items-center justify-between p-2 border-t border-white/10 text-xs text-white/70",children:[D.jsxs("div",{children:["Showing ",(d-1)*g+1,"-",Math.min(d*g,b.length)," of ",b.length]}),D.jsxs("div",{className:"flex gap-2",children:[D.jsx("button",{onClick:()=>p(I=>Math.max(1,I-1)),disabled:d===1,className:"px-2 py-1 rounded bg-white/10 hover:bg-white/20 disabled:opacity-50 disabled:cursor-not-allowed",children:"Prev"}),D.jsxs("span",{className:"px-2 py-1",children:[d," / ",A]}),D.jsx("button",{onClick:()=>p(I=>Math.min(A,I+1)),disabled:d===A,className:"px-2 py-1 rounded bg-white/10 hover:bg-white/20 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})]})},tH=({data:e,config:t})=>{const r=ce.useMemo(()=>{if(e!=null&&e.items&&Array.isArray(e.items))return e.items.map(v=>({label:String(v.label||v.name||"Unknown"),value:typeof v.value=="number"?v.value:0}));let i=[];if(t!=null&&t.sourcePath){const v=t.sourcePath.split(".");let _=e;for(const b of v)_=_==null?void 0:_[b];Array.isArray(_)&&(i=_)}else Array.isArray(e)?i=e:Array.isArray(e==null?void 0:e.entities)?i=e.entities:Array.isArray(e==null?void 0:e.relationships)&&(i=e.relationships);if(i.length===0)return[];const s=(t==null?void 0:t.labelKey)||"type",u=(t==null?void 0:t.valueMode)||"count",a=t==null?void 0:t.valueKey,d=new Map;for(const v of i){const _=String(v[s]||v.type||"Unknown");if(u==="count")d.set(_,(d.get(_)||0)+1);else if(a){const b=typeof v[a]=="number"?v[a]:0;if(u==="sum")d.set(_,(d.get(_)||0)+b);else if(u==="avg"){const k=d.get(_)||0;d.set(_,k+b)}}}let p=Array.from(d.entries()).map(([v,_])=>({label:v,value:u==="avg"?_/i.filter(b=>String(b[s]||b.type||"Unknown")===v).length:_}));p.sort((v,_)=>_.value-v.value);const g=(t==null?void 0:t.limit)||10;return p.slice(0,g)},[e,t]);if(r.length===0)return D.jsx("div",{className:"text-sm text-white/70 p-4",children:"No data to display"});const n=Math.max(...r.map(i=>i.value));return D.jsx("div",{className:"flex flex-col gap-2 p-3",children:r.map((i,s)=>D.jsxs("div",{className:"flex items-center gap-2",children:[D.jsx("div",{className:"text-xs text-white/80 w-24 truncate",title:i.label,children:i.label}),D.jsx("div",{className:"flex-1 relative",children:D.jsx("div",{className:"h-6 bg-teal-600 rounded transition-all",style:{width:`${i.value/n*100}%`}})}),D.jsx("div",{className:"text-xs text-white/90 w-16 text-right",children:typeof i.value=="number"?i.value.toLocaleString():i.value})]},s))})},rH=({data:e,config:t})=>{const r=ce.useRef(null),n=ce.useRef(null),i=(t==null?void 0:t.styleUrl)||void 0||"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json";return ce.useEffect(()=>{if(!(!r.current||n.current))return n.current=new ud.Map({container:r.current,style:i,center:[0,20],zoom:2}),n.current.addControl(new ud.NavigationControl,"top-right"),()=>{n.current&&(n.current.remove(),n.current=null)}},[i]),ce.useEffect(()=>{if(!n.current||!e)return;const s=(t==null?void 0:t.latKey)||"lat",u=(t==null?void 0:t.lonKey)||"lon",a=t==null?void 0:t.intensityKey;let d=[];const p=_=>{if(Array.isArray(_))_.forEach(b=>p(b));else if(_&&typeof _=="object")if(typeof _[s]=="number"&&typeof _[u]=="number"){const b=a&&typeof _[a]=="number"?_[a]:_.intensity||1;d.push([_[u],_[s],b])}else Object.values(_).forEach(b=>{b&&typeof b=="object"&&p(b)})};if(p(e),d.length===0)return;const g={type:"FeatureCollection",features:d.map(([_,b,k])=>({type:"Feature",geometry:{type:"Point",coordinates:[_,b]},properties:{intensity:k}}))};if(n.current.getSource("heat-source")&&(n.current.getLayer("heat-layer")&&n.current.removeLayer("heat-layer"),n.current.removeSource("heat-source")),n.current.addSource("heat-source",{type:"geojson",data:g}),n.current.addLayer({id:"heat-layer",type:"heatmap",source:"heat-source",maxzoom:15,paint:{"heatmap-weight":{property:"intensity",type:"exponential",stops:[[0,0],[1,1]]},"heatmap-intensity":["interpolate",["linear"],["zoom"],0,1,9,3],"heatmap-color":["interpolate",["linear"],["heatmap-density"],0,"rgba(33,102,172,0)",.2,"rgb(103,169,207)",.4,"rgb(209,229,240)",.6,"rgb(253,219,199)",.8,"rgb(239,138,98)",1,"rgb(178,24,43)"],"heatmap-radius":["interpolate",["linear"],["zoom"],0,2,9,20],"heatmap-opacity":.6}}),d.length>0){const _=new ud.LngLatBounds;d.forEach(([b,k])=>_.extend([b,k])),n.current.fitBounds(_,{padding:50,duration:1e3})}},[e,t,n.current]),D.jsxs("div",{className:"w-full h-full rounded-lg overflow-hidden relative",style:{minHeight:"300px"},children:[D.jsx("div",{ref:r,className:"w-full h-full"}),!e&&D.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 text-white/70",children:"No coordinate data available"})]})},qI=({title:e,message:t,actionLabel:r,onAction:n,icon:i})=>D.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center min-h-[200px]",children:[i&&D.jsx("div",{className:"mb-4 text-white/40",children:i}),D.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:e}),D.jsx("p",{className:"text-sm text-white/70 mb-4 max-w-md",children:t}),r&&n&&D.jsx("button",{onClick:n,className:"px-4 py-2 bg-teal-600 hover:bg-teal-700 rounded text-white text-sm font-medium transition-colors",children:r})]});function nH(e){var r,n;if(!e||typeof e!="object")return{shape:"unknown",confidence:"low"};if(Array.isArray(e.entities)&&e.entities.length>0){const i=e.entities[0];if(i&&typeof i=="object"&&(i.id||i.type))return(r=i.attrs)!=null&&r.lat&&((n=i.attrs)!=null&&n.lon)?{shape:"geo",confidence:"high",hint:"entities[] with lat/lon"}:{shape:"entities",confidence:"high",hint:"entities[]"}}if(Array.isArray(e.buckets)||Array.isArray(e.counts)){const i=e.buckets||e.counts;if(i.length>0&&i[0]&&typeof i[0]=="object"&&(i[0].ts||i[0].bucket||i[0].count!==void 0))return{shape:"counts",confidence:"high",hint:"buckets[] or counts[]"}}if(typeof e.value=="number"||e.data&&typeof e.data.value=="number")return{shape:"metric",confidence:"high",hint:"value: number"};if(typeof e.count=="number"||e.data&&typeof e.data.count=="number")return{shape:"metric",confidence:"high",hint:"count: number"};if(Array.isArray(e.items)&&e.items.length>0){const i=e.items[0];if(i&&typeof i=="object"&&(i.label!==void 0||i.value!==void 0))return{shape:"items",confidence:"high",hint:"items[] with label/value"}}if(Array.isArray(e.points)&&e.points.length>0){const i=e.points[0];if(i&&typeof i=="object"&&i.lat!==void 0&&i.lon!==void 0)return{shape:"geo",confidence:"high",hint:"points[] with lat/lon"}}const t=Object.values(e).filter(i=>Array.isArray(i));if(t.length>0){const i=t[0];if(i.length>0&&i[0]&&typeof i[0]=="object"&&(i[0].id||i[0].type))return{shape:"entities",confidence:"medium",hint:"array[] (entities-like)"}}return{shape:"unknown",confidence:"low"}}function GS(e){switch(e){case"map":case"list":case"table":case"graph":return"entities";case"timeline":return"counts";case"metric":return"metric";case"topbar":return"items";case"geoheat":return"geo";default:return"unknown"}}function CR(e,t){const r=GS(t);return Array.isArray(r)?r.includes(e):r===e||e==="unknown"}function Al(e){switch(e){case"entities":return"entities[]";case"counts":return"counts[]";case"metric":return"metric";case"geo":return"geo[]";case"items":return"items[]";default:return"?"}}function kR(e){switch(e){case"map":return"Pick a query that returns entities[] with lat/lon for this panel.";case"list":case"table":return"Pick a query that returns entities[] for this panel.";case"graph":return"Pick a query that returns entities[] (and optionally relationships[]) for this panel.";case"timeline":return"Pick a query that returns counts[] or buckets[] for this panel.";case"metric":return"Pick a query that returns a numeric value or count for this panel.";case"topbar":return"Pick a query that returns items[] or entities[] (will rollup) for this panel.";case"geoheat":return"Pick a query that returns geo[] or entities[] with lat/lon for this panel.";default:return"Pick a compatible query for this panel."}}function iH({type:e,query:t,refreshSec:r=30,config:n,onQueryChange:i}){var A,M,P;const[s,u]=Qe.useState(null),[a,d]=Qe.useState(null),[p,g]=Qe.useState(!1),[v,_]=Qe.useState(null),[b,k]=Qe.useState({isOpen:!1,title:"",message:""});if(Qe.useEffect(()=>{if(!t){u(null),d(null),g(!1),_(null);return}let I=!1,z;const O=async()=>{g(!0),d(null);try{const V=await tx(t.gql,{});if(!I){u(V);const U=nH(V),$=GS(e);if(!CR(U.shape,e)&&U.confidence==="high"){_({detected:U.shape,expected:$});const Z=Array.isArray($)?$.map(Q=>Al(Q)).join(" or "):Al($);if(k({isOpen:!0,title:"Query Shape Mismatch",message:`This query returns ${Al(U.shape)}; this panel expects ${Z}. The panel will show an empty state until you change the query.`}),!t.shapeHint&&t.id)try{await fn.updateQuery(t.id,{shapeHint:U.shape})}catch{}}else if(_(null),!t.shapeHint&&t.id&&U.confidence==="high")try{await fn.updateQuery(t.id,{shapeHint:U.shape})}catch{}g(!1)}}catch(V){I||(d(V.message),u(null),_(null),g(!1))}};return O(),r&&r>=5&&(z=window.setInterval(O,r*1e3)),()=>{I=!0,z&&clearInterval(z)}},[t==null?void 0:t.gql,t==null?void 0:t.id,r,e]),!t)return D.jsx(qI,{title:"No Query Selected",message:kR(e),actionLabel:i?"Select Query":void 0,onAction:i});if(p)return D.jsx("div",{className:"text-sm text-muted p-4",children:"Loading..."});if(a)return D.jsxs("div",{className:"p-4",children:[D.jsxs("div",{className:"text-red-400 text-sm mb-2",children:["Error: ",a]}),i&&D.jsx("button",{onClick:i,className:"text-xs text-teal-400 hover:text-teal-300 underline",children:"Change query"})]});if(v){const I=Array.isArray(v.expected)?v.expected.map(z=>Al(z)).join(" or "):Al(v.expected);return D.jsxs(D.Fragment,{children:[D.jsx(qI,{title:"Query Shape Mismatch",message:`This query returns ${Al(v.detected)}, but this panel expects ${I}. Please select a compatible query.`,actionLabel:i?"Change Query":void 0,onAction:i}),D.jsx(Qs,{isOpen:b.isOpen,onClose:()=>k({isOpen:!1,title:"",message:""}),title:b.title,message:b.message,variant:"info"})]})}if(e==="metric"){let I="";if(s)if(typeof s.value=="number")I=s.value;else if((A=s.result)!=null&&A.value&&typeof s.result.value=="number")I=s.result.value;else if(Array.isArray(s.entities))I=s.entities.length;else if(Array.isArray(s.relationships))I=s.relationships.length;else{const z=Object.values(s).find(O=>Array.isArray(O));if(z)I=z.length;else{const O=Object.values(s)[0];O!=null&&(I=String(O))}}return D.jsx("div",{className:"text-center p-4",children:D.jsx("div",{className:"text-3xl font-bold text-white",children:String(I)})})}if(e==="list")return D.jsx("pre",{className:"text-xs overflow-auto max-h-64 text-white bg-black/20 p-2 rounded",children:JSON.stringify(s,null,2)});if(e==="graph"){const I=(s==null?void 0:s.entities)||[],z=(s==null?void 0:s.relationships)||[],O=I.length>0?I:((M=s==null?void 0:s.data)==null?void 0:M.entities)||Object.values(s||{}).flat().filter(Z=>Z&&typeof Z=="object"&&Z.id&&Z.type),V=z.length>0?z:((P=s==null?void 0:s.data)==null?void 0:P.relationships)||[],U=O.map(Z=>{var Q;return{data:{id:Z.id,label:Z.type==="Location"&&((Q=Z.attrs)!=null&&Q.name)?Z.attrs.name:Z.id,type:Z.type}}}),$=new Set(U.map(Z=>Z.data.id)),G=V.filter(Z=>$.has(Z.fromId)&&$.has(Z.toId)).map((Z,Q)=>({data:{id:`edge-${Q}`,source:Z.fromId,target:Z.toId,label:Z.type}}));return D.jsx(lc,{title:"Graph",children:D.jsx(yR,{elements:{nodes:U,edges:G}})})}return e==="timeline"?D.jsx(SR,{}):e==="map"?D.jsx(CN,{}):e==="table"?D.jsx(eH,{data:s,config:n}):e==="topbar"?D.jsx(tH,{data:s,config:n}):e==="geoheat"?D.jsx(rH,{data:s,config:n}):D.jsxs("div",{className:"text-white opacity-70",children:["Unknown panel type: ",e]})}function aH(e){if(typeof e!="object"||e===null)return{ok:!1,errors:[{path:"",message:"Input must be an object"}]};const t=e;if(t.version!==1)return{ok:!1,errors:[{path:"/version",message:"Unsupported version (expected 1)"}]};if(!t.dashboard||typeof t.dashboard!="object")return{ok:!1,errors:[{path:"/dashboard",message:"Missing or invalid dashboard"}]};const r=t.dashboard;if(!r.name||typeof r.name!="string")return{ok:!1,errors:[{path:"/dashboard/name",message:"Dashboard name is required"}]};if(!Array.isArray(t.panels))return{ok:!1,errors:[{path:"/panels",message:"Panels must be an array"}]};for(let n=0;n<t.panels.length;n++){const i=t.panels[n];if(typeof i!="object"||i===null)return{ok:!1,errors:[{path:`/panels/${n}`,message:"Panel must be an object"}]};const s=i;if(!s.title||typeof s.title!="string")return{ok:!1,errors:[{path:`/panels/${n}/title`,message:"Panel title is required"}]};if(!s.type||typeof s.type!="string")return{ok:!1,errors:[{path:`/panels/${n}/type`,message:"Panel type is required"}]}}return{ok:!0,data:e}}function sH(e,t){return t.length===0?!0:t.some(r=>e.includes(r))}function oH(e){if(e!=null)return e<5?5:e>86400?86400:e}async function lH(e){const t=await fn.getDashboard(e),r=t.panels||[],n=await fn.getQueries(),i=new Map(n.map(s=>[s.id,s.name]));return{version:1,exportedAt:new Date().toISOString(),meta:{notes:`Exported from ${location.host}`},dashboard:{id:t.id,name:t.name,visibilityRoles:t.visibilityRoles??[],config:t.config??{}},panels:r.map(s=>({id:s.id,title:s.title,type:s.type,queryRef:s.queryId?i.has(s.queryId)?{name:i.get(s.queryId)}:{id:s.queryId}:void 0,refreshSec:s.refreshSec,config:s.config??{}}))}}async function uH(e){const t=aH(e);if(!t.ok){const a=t.errors.map(d=>`${d.path}: ${d.message}`).join("; ");throw new Error(`Invalid dashboard export: ${a}`)}const r=t.data,n=await fn.createDashboard({name:r.dashboard.name,visibilityRoles:r.dashboard.visibilityRoles??[],config:r.dashboard.config??{}});r.dashboard.visibilityRoles&&r.dashboard.visibilityRoles.length>0&&await fn.updateDashboard(n.id,{visibilityRoles:r.dashboard.visibilityRoles});const i=await fn.getQueries(),s=[];function u(a){if(a){if("id"in a&&a.id&&i.some(p=>p.id===a.id))return a.id;if("name"in a&&a.name){const d=i.find(p=>{var g;return((g=p.name)==null?void 0:g.toLowerCase())===a.name.toLowerCase()});if(d)return d.id;s.push(a.name)}}}for(const a of r.panels){const d=u(a.queryRef);await fn.createPanel(n.id,{title:a.title,type:a.type,queryId:d,refreshSec:oH(a.refreshSec),config:a.config??{}})}return{dashboardId:n.id,unresolvedQueries:s}}function cH(e,t){return e.filter(r=>{const n=r.visibilityRoles??[];return n.length===0||sH(t,n)})}const hH=({isOpen:e,onClose:t,onConfirm:r,title:n,message:i,defaultValue:s="",placeholder:u="",confirmText:a="OK",cancelText:d="Cancel"})=>{const[p,g]=ce.useState(s);ce.useEffect(()=>{e&&g(s)},[e,s]);const v=()=>{r(p),t()},_=b=>{b.key==="Enter"?v():b.key==="Escape"&&t()};return D.jsx(rx,{isOpen:e,onClose:t,title:n,children:D.jsxs("div",{className:"space-y-4",children:[D.jsx("p",{className:"text-white/80",children:i}),D.jsx("input",{type:"text",value:p,onChange:b=>g(b.target.value),onKeyDown:_,placeholder:u,className:"w-full px-3 py-2 bg-black/20 border border-white/10 rounded focus:outline-none focus:border-white/30 text-white",autoFocus:!0}),D.jsxs("div",{className:"flex gap-2 justify-end",children:[D.jsx("button",{onClick:t,className:"px-4 py-2 bg-white/10 hover:bg-white/20 rounded text-white text-sm",children:d}),D.jsx("button",{onClick:v,className:"px-4 py-2 bg-teal-600 hover:bg-teal-700 rounded text-white text-sm",children:a})]})]})})};function dH(){var me;const{dashboards:e,panels:t,queries:r,loadDashboards:n,loadPanels:i,loadQueries:s}=ER(),{user:u}=Ic(),[a,d]=Qe.useState(null),[p,g]=Qe.useState(!1),[v,_]=Qe.useState(null),[b,k]=Qe.useState(""),[A,M]=Qe.useState({isOpen:!1,title:"",message:"",variant:"info"}),[P,I]=Qe.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{},danger:!1}),[z,O]=Qe.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{},defaultValue:""}),V=(u==null?void 0:u.roles)||[],U=Qe.useMemo(()=>cH(e,V),[e,V]);Qe.useEffect(()=>{n(),s()},[n,s]),Qe.useEffect(()=>{a&&i(a)},[a,i]);const $=a?t[a]||[]:[],G=async(ae,ve)=>{if(a){g(!0);try{await fn.createPanel(a,{title:`${ae} panel`,type:ae,queryId:ve,refreshSec:30,position:$.length}),await i(a)}catch(pe){M({isOpen:!0,title:"Error",message:pe.message,variant:"error"})}finally{g(!1)}}},Z=async(ae,ve)=>{if(a)try{await fn.updatePanel(a,ae,{queryId:ve}),await i(a)}catch(pe){M({isOpen:!0,title:"Error",message:pe.message,variant:"error"})}},Q=async(ae,ve)=>{if(!a)return;const pe=ve?Math.max(5,Math.min(86400,ve)):void 0;try{await fn.updatePanel(a,ae,{refreshSec:pe}),await i(a)}catch(_e){M({isOpen:!0,title:"Error",message:_e.message,variant:"error"})}},X=async(ae,ve)=>{try{await fn.updateDashboard(ae,{name:ve}),await n(),_(null)}catch(pe){M({isOpen:!0,title:"Error",message:pe.message,variant:"error"})}},ie=async ae=>{g(!0);try{const ve=await fn.getDashboard(ae),pe=await fn.createDashboard({name:`${ve.name} (copy)`,visibilityRoles:ve.visibilityRoles,config:ve.config});for(const _e of ve.panels)await fn.createPanel(pe.id,{title:_e.title,type:_e.type,queryId:_e.queryId,refreshSec:_e.refreshSec,config:_e.config,position:_e.position});await n(),d(pe.id),lr("Dashboard duplicated")}catch(ve){M({isOpen:!0,title:"Error",message:ve.message,variant:"error"})}finally{g(!1)}},te=async ae=>{I({isOpen:!0,title:"Delete Dashboard",message:"Delete this dashboard? This cannot be undone.",danger:!0,onConfirm:async()=>{g(!0);try{await fn.deleteDashboard(ae),await n(),a===ae&&d(null),lr("Dashboard deleted")}catch(ve){M({isOpen:!0,title:"Error",message:ve.message,variant:"error"})}finally{g(!1)}}})},W=async ae=>{try{const ve=await lH(ae),pe=new Blob([JSON.stringify(ve,null,2)],{type:"application/json"}),_e=URL.createObjectURL(pe),De=document.createElement("a");De.href=_e;const Le=e.find(je=>je.id===ae);De.download=`${((Le==null?void 0:Le.name)||"dashboard").replace(/\s+/g,"_")}_export.json`,De.click(),URL.revokeObjectURL(_e),lr("Dashboard exported")}catch(ve){M({isOpen:!0,title:"Export Error",message:ve.message,variant:"error"})}},oe=async ae=>{g(!0);try{const ve=await ae.text(),pe=JSON.parse(ve),{dashboardId:_e,unresolvedQueries:De}=await uH(pe);await n(),await s(),d(_e),De.length>0?lr(`Imported with ${De.length} unresolved queries`):lr("Dashboard imported successfully")}catch(ve){M({isOpen:!0,title:"Import Error",message:ve.message,variant:"error"})}finally{g(!1)}},se=async ae=>{if(a){g(!0);try{await fn.deletePanel(a,ae),await i(a)}catch(ve){M({isOpen:!0,title:"Error",message:ve.message,variant:"error"})}finally{g(!1)}}},de=async()=>{O({isOpen:!0,title:"New Dashboard",message:"Name your dashboard",defaultValue:"",onConfirm:async ae=>{const ve=ae.trim()||"Untitled";g(!0);try{const pe=await fn.createDashboard({name:ve});await n(),d(pe.id)}catch(pe){M({isOpen:!0,title:"Error",message:pe.message,variant:"error"})}finally{g(!1)}}})};return D.jsxs("div",{className:"space-y-4 p-4",children:[D.jsxs("div",{className:"flex gap-2 items-center flex-wrap",children:[D.jsxs("select",{className:"bg-black/30 rounded px-2 py-1 text-white",value:a??"",onChange:ae=>{d(ae.target.value||null),_(null)},children:[D.jsx("option",{value:"",children:" Select dashboard "}),U.map(ae=>D.jsx("option",{value:ae.id,children:ae.name},ae.id))]}),D.jsx("button",{className:"px-2 py-1 bg-white/10 rounded hover:bg-white/20 disabled:opacity-50 text-white text-sm",onClick:de,disabled:p,children:"New Dashboard"}),a&&D.jsxs(D.Fragment,{children:[D.jsx("button",{className:"px-2 py-1 bg-teal-600 hover:bg-teal-700 rounded disabled:opacity-50 text-white text-sm",onClick:()=>W(a),disabled:p,children:"Export"}),D.jsx("button",{className:"px-2 py-1 bg-blue-600 hover:bg-blue-700 rounded disabled:opacity-50 text-white text-sm",onClick:()=>ie(a),disabled:p,children:"Duplicate"}),D.jsx("button",{className:"px-2 py-1 bg-red-600 hover:bg-red-700 rounded disabled:opacity-50 text-white text-sm",onClick:()=>te(a),disabled:p,children:"Delete"}),D.jsx("input",{type:"file",accept:"application/json",className:"hidden",id:"import-dashboard",onChange:ae=>{var pe;const ve=(pe=ae.target.files)==null?void 0:pe[0];ve&&oe(ve),ae.target.value=""}}),D.jsx("label",{htmlFor:"import-dashboard",className:"px-2 py-1 bg-purple-600 hover:bg-purple-700 rounded cursor-pointer disabled:opacity-50 text-white text-sm",children:"Import"})]})]}),a&&D.jsx("div",{className:"flex gap-2 items-center",children:v===a?D.jsx(D.Fragment,{children:D.jsx("input",{type:"text",value:b,onChange:ae=>k(ae.target.value),onBlur:()=>{b.trim()?X(a,b.trim()):_(null)},onKeyDown:ae=>{ae.key==="Enter"?b.trim()&&X(a,b.trim()):ae.key==="Escape"&&_(null)},className:"bg-black/30 rounded px-2 py-1 text-white",autoFocus:!0})}):D.jsxs(D.Fragment,{children:[D.jsx("span",{className:"font-semibold text-white cursor-pointer hover:underline",onClick:()=>{const ae=e.find(ve=>ve.id===a);k((ae==null?void 0:ae.name)||""),_(a)},children:((me=e.find(ae=>ae.id===a))==null?void 0:me.name)||"Untitled"}),D.jsx("span",{className:"text-xs opacity-70 text-white",children:"(click to rename)"})]})}),a&&D.jsxs(D.Fragment,{children:[D.jsxs("div",{className:"bg-black/20 rounded p-3",children:[D.jsx("div",{className:"font-semibold mb-2 text-white",children:"Add panel"}),D.jsxs("div",{className:"flex gap-2 items-center",children:[D.jsx(Qq,{onPick:ae=>{var ve;G(ae,(ve=r[0])==null?void 0:ve.id)}}),D.jsx("div",{className:"text-xs opacity-70 text-white",children:"Panel query can be assigned after creation."})]})]}),D.jsx("div",{className:"grid grid-cols-2 gap-3",children:$.map(ae=>{const ve=r.find(pe=>pe.id===ae.queryId);return D.jsxs("div",{className:"bg-black/20 rounded p-3",children:[D.jsxs("div",{className:"flex items-center justify-between mb-2",children:[D.jsx("div",{className:"font-semibold text-white",children:ae.title}),D.jsx("div",{className:"flex gap-2",children:D.jsx("button",{className:"text-xs opacity-80 hover:opacity-100 text-white",onClick:()=>{I({isOpen:!0,title:"Remove Panel",message:"Remove this panel?",danger:!1,onConfirm:()=>se(ae.id)})},children:"Remove"})})]}),D.jsx("div",{className:"mb-2 space-y-1",children:D.jsxs("div",{className:"space-y-1",children:[D.jsx("label",{className:"text-xs text-white/70 block",children:"Query:"}),D.jsxs("select",{"data-panel-id":ae.id,value:ae.queryId||"",onChange:pe=>Z(ae.id,pe.target.value||void 0),className:"w-full bg-black/30 rounded px-2 py-1 text-white text-xs",children:[D.jsx("option",{value:"",children:" No query "}),(()=>{GS(ae.type);const pe=[],_e=[];return r.forEach(De=>{const Le=De.shapeHint||"unknown";CR(Le,ae.type)?pe.push(De):_e.push(De)}),D.jsxs(D.Fragment,{children:[pe.length>0&&D.jsx("optgroup",{label:" Compatible",children:pe.map(De=>D.jsxs("option",{value:De.id,children:[De.name," ",De.shapeHint&&`[${Al(De.shapeHint)}]`]},De.id))}),_e.length>0&&D.jsx("optgroup",{label:" Incompatible",children:_e.map(De=>D.jsxs("option",{value:De.id,disabled:!1,children:[De.name," ",De.shapeHint&&`[${Al(De.shapeHint)}]`]},De.id))})]})})()]}),!ae.queryId&&D.jsx("p",{className:"text-xs text-white/50 italic mt-1",children:kR(ae.type)})]})}),D.jsxs("div",{className:"mb-2",children:[D.jsx("label",{className:"text-xs text-white/70 block",children:"Refresh (sec):"}),D.jsx("input",{type:"number",min:"5",max:"86400",value:ae.refreshSec||30,onChange:pe=>Q(ae.id,pe.target.value?parseInt(pe.target.value):void 0),className:"w-full bg-black/30 rounded px-2 py-1 text-white text-xs"})]}),D.jsx(iH,{type:ae.type,query:ve||null,refreshSec:ae.refreshSec,config:ae.config,onQueryChange:()=>{const pe=document.querySelector(`select[data-panel-id="${ae.id}"]`);pe&&(pe.focus(),pe.scrollIntoView({behavior:"smooth",block:"center"}))}})]},ae.id)})})]}),D.jsx(Qs,{isOpen:A.isOpen,onClose:()=>M({...A,isOpen:!1}),title:A.title,message:A.message,variant:A.variant}),D.jsx(TR,{isOpen:P.isOpen,onClose:()=>I({...P,isOpen:!1}),onConfirm:P.onConfirm,title:P.title,message:P.message,danger:P.danger}),D.jsx(hH,{isOpen:z.isOpen,onClose:()=>O({...z,isOpen:!1}),onConfirm:z.onConfirm,title:z.title,message:z.message,defaultValue:z.defaultValue})]})}const Io=ls((e,t)=>({alerts:[],unread:0,filters:{},load:async()=>{try{const{status:r,severity:n}=t().filters,i=await nn.get("/alerts",{params:{status:r,severity:n}});e({alerts:i.data})}catch(r){const n=(r==null?void 0:r.message)||"";if(n.includes("Unauthorized")||n.includes("403")||n.includes("404")||n.includes("Not Found")){e({alerts:[]});return}throw r}},setFilters:r=>e({filters:{...t().filters,...r}}),ack:async r=>{try{await nn.post(`/alerts/${r}/ack`),await t().load()}catch(n){const i=(n==null?void 0:n.message)||"";if(i.includes("Unauthorized")||i.includes("403")||i.includes("404")||i.includes("Not Found"))return;throw n}},resolve:async r=>{try{await nn.post(`/alerts/${r}/resolve`),await t().load()}catch(n){const i=(n==null?void 0:n.message)||"";if(i.includes("Unauthorized")||i.includes("403")||i.includes("404")||i.includes("Not Found"))return;throw n}}}));vS(e=>{if((e==null?void 0:e.t)==="alert.created"){const t=e.data;t.suppressedByKind&&(t.suppressedBy={kind:t.suppressedByKind,id:t.suppressedById||0,name:t.suppressedByName||""}),Io.setState(r=>({alerts:[t,...r.alerts],unread:r.unread+(e.data.status==="open"?1:0)}))}else if((e==null?void 0:e.t)==="alert.updated"){const t=e.data;t.suppressedByKind&&(t.suppressedBy={kind:t.suppressedByKind,id:t.suppressedById||0,name:t.suppressedByName||""}),Io.setState(r=>({alerts:r.alerts.map(n=>n.id===e.data.id?{...n,...t}:n)}))}});const fH="modulepreload",pH=function(e){return"/"+e},HI={},ym=function(t,r,n){let i=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),a=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));i=Promise.allSettled(r.map(d=>{if(d=pH(d),d in HI)return;HI[d]=!0;const p=d.endsWith(".css"),g=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${g}`))return;const v=document.createElement("link");if(v.rel=p?"stylesheet":fH,p||(v.as="script"),v.crossOrigin="",v.href=d,a&&v.setAttribute("nonce",a),document.head.appendChild(v),p)return new Promise((_,b)=>{v.addEventListener("load",_),v.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${d}`)))})}))}function s(u){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=u,window.dispatchEvent(a),!a.defaultPrevented)throw u}return i.then(u=>{for(const a of u||[])a.status==="rejected"&&s(a.reason);return t().catch(s)})},qu=e=>({...e,createdBy:e.createdBy||e.created_by,createdAt:e.createdAt||e.created_at,updatedAt:e.updatedAt||e.updated_at,resolvedAt:e.resolvedAt||e.resolved_at,prioritySuggestion:e.prioritySuggestion||e.priority_suggestion,ownerSuggestion:e.ownerSuggestion||e.owner_suggestion,similarCaseIds:e.similarCaseIds||e.similar_case_ids,mlVersion:e.mlVersion||e.ml_version}),qo=ls((e,t)=>({loading:!1,items:[],selected:null,setSelected:r=>e({selected:r}),list:async(r={})=>{e({loading:!0});try{const i=((await nn.get("/cases",{params:r})).data??[]).map(qu);e({items:i})}catch(n){const i=(n==null?void 0:n.message)||"";if(i.includes("404")||i.includes("Not Found")){e({items:[]});return}if(i.includes("401")||i.includes("Unauthorized"))try{const{refresh:s}=await ym(async()=>{const{refresh:d}=await Promise.resolve().then(()=>gm);return{refresh:d}},void 0);await s();const a=((await nn.get("/cases",{params:r})).data??[]).map(qu);e({items:a});return}catch{throw n}throw n}finally{e({loading:!1})}},get:async r=>{try{const n=await nn.get(`/cases/${r}`);return qu(n.data)}catch(n){const i=(n==null?void 0:n.message)||"";throw i.includes("401")||i.includes("403")||i.includes("404")||i.includes("Unauthorized")||i.includes("Not Found")?new Error("Case not found"):n}},create:async r=>{var u,a;const n={...r,priority:(u=r.priority)==null?void 0:u.toLowerCase(),status:(a=r.status)==null?void 0:a.toLowerCase()},i=await nn.post("/cases",n),s=qu(i.data);return await t().list(),s},update:async(r,n)=>{var i,s;try{const u={...n,priority:(i=n.priority)==null?void 0:i.toLowerCase(),status:(s=n.status)==null?void 0:s.toLowerCase()},a=await nn.patch(`/cases/${r}`,u),d=qu(a.data);return e(p=>{var g;return{items:p.items.map(v=>v.id===r?d:v),selected:((g=p.selected)==null?void 0:g.id)===r?d:p.selected}}),d}catch(u){const a=(u==null?void 0:u.message)||"";throw a.includes("401")||a.includes("403")||a.includes("404")||a.includes("Unauthorized")||a.includes("Not Found")?new Error("Failed to update case"):u}},listNotes:async r=>{try{return(await nn.get(`/cases/${r}/notes`)).data??[]}catch(n){const i=(n==null?void 0:n.message)||"";if(i.includes("401")||i.includes("403")||i.includes("404")||i.includes("Unauthorized")||i.includes("Not Found"))return[];throw n}},addNote:async(r,n)=>(await nn.post(`/cases/${r}/notes`,{body:n})).data,assignAlerts:async(r,n)=>{try{await nn.post(`/cases/${r}/alerts:assign`,{alertIds:n})}catch(i){const s=(i==null?void 0:i.message)||"";throw s.includes("401")||s.includes("403")||s.includes("404")||s.includes("Unauthorized")||s.includes("Not Found")?new Error("Failed to assign alerts"):i}},adoptPriority:async r=>{try{const n=await nn.patch(`/cases/${r}/adopt/priority`),i=qu(n.data);return e(s=>{var u;return{items:s.items.map(a=>a.id===r?i:a),selected:((u=s.selected)==null?void 0:u.id)===r?i:s.selected}}),i}catch(n){const i=(n==null?void 0:n.message)||"";throw i.includes("401")||i.includes("403")||i.includes("404")||i.includes("Unauthorized")||i.includes("Not Found")?new Error("Failed to adopt priority suggestion"):n}},adoptOwner:async r=>{try{const n=await nn.patch(`/cases/${r}/adopt/owner`),i=qu(n.data);return e(s=>{var u;return{items:s.items.map(a=>a.id===r?i:a),selected:((u=s.selected)==null?void 0:u.id)===r?i:s.selected}}),i}catch(n){const i=(n==null?void 0:n.message)||"";throw i.includes("401")||i.includes("403")||i.includes("404")||i.includes("Unauthorized")||i.includes("Not Found")?new Error("Failed to adopt owner suggestion"):n}}}));function PR({isOpen:e,onClose:t,case:r,onSubmit:n}){const[i,s]=ce.useState(""),[u,a]=ce.useState(""),[d,p]=ce.useState("medium"),[g,v]=ce.useState("open"),[_,b]=ce.useState(""),[k,A]=ce.useState(!1),[M,P]=ce.useState(null);ce.useEffect(()=>{r&&r.id?(s(r.title||""),a(r.description||""),p(r.priority||"medium"),v(r.status||"open"),b(r.owner||"")):r&&r.title?(s(r.title||""),a(""),p("medium"),v("open"),b("")):(s(""),a(""),p("medium"),v("open"),b("")),P(null)},[r,e]);const I=async z=>{if(z.preventDefault(),!i.trim()){P("Title is required");return}A(!0),P(null);try{await n({title:i.trim(),description:u.trim()||null,priority:d.toLowerCase(),status:g.toLowerCase(),owner:_.trim()||null}),t()}catch(O){P((O==null?void 0:O.message)||"Failed to save case")}finally{A(!1)}};return D.jsx(rx,{isOpen:e,onClose:t,title:r&&r.id?"Edit Case":"Create Case",children:D.jsxs("form",{onSubmit:I,className:"space-y-4",children:[M&&D.jsx("div",{className:"bg-red-600/20 border border-red-600 rounded px-3 py-2 text-red-200 text-sm",children:M}),D.jsxs("div",{children:[D.jsxs("label",{className:"block text-sm font-medium text-white/80 mb-1",children:["Title ",D.jsx("span",{className:"text-red-400",children:"*"})]}),D.jsx("input",{type:"text",className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white focus:outline-none focus:border-teal-500",value:i,onChange:z=>s(z.target.value),required:!0,autoFocus:!0})]}),D.jsxs("div",{children:[D.jsx("label",{className:"block text-sm font-medium text-white/80 mb-1",children:"Description"}),D.jsx("textarea",{className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white focus:outline-none focus:border-teal-500 h-24 resize-none",value:u,onChange:z=>a(z.target.value)})]}),D.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[D.jsxs("div",{children:[D.jsx("label",{className:"block text-sm font-medium text-white/80 mb-1",children:"Priority"}),D.jsxs("select",{className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white focus:outline-none focus:border-teal-500",value:d,onChange:z=>p(z.target.value),children:[D.jsx("option",{value:"low",children:"Low"}),D.jsx("option",{value:"medium",children:"Medium"}),D.jsx("option",{value:"high",children:"High"}),D.jsx("option",{value:"critical",children:"Critical"})]})]}),D.jsxs("div",{children:[D.jsx("label",{className:"block text-sm font-medium text-white/80 mb-1",children:"Status"}),D.jsxs("select",{className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white focus:outline-none focus:border-teal-500",value:g,onChange:z=>v(z.target.value),children:[D.jsx("option",{value:"open",children:"Open"}),D.jsx("option",{value:"in_progress",children:"In Progress"}),D.jsx("option",{value:"resolved",children:"Resolved"}),D.jsx("option",{value:"closed",children:"Closed"})]})]})]}),D.jsxs("div",{children:[D.jsx("label",{className:"block text-sm font-medium text-white/80 mb-1",children:"Owner"}),D.jsx("input",{type:"text",className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white focus:outline-none focus:border-teal-500",value:_,onChange:z=>b(z.target.value),placeholder:"user@example.com"})]}),D.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[D.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 rounded text-white/80 hover:text-white hover:bg-white/10",disabled:k,children:"Cancel"}),D.jsx("button",{type:"submit",className:"px-4 py-2 rounded bg-teal-600 hover:bg-teal-700 text-white",disabled:k,children:k?"Saving...":r?"Update":"Create"})]})]})})}const IR=ls(()=>({loadLogs:async e=>{var t;try{return(await nn.get(`/alerts/${e}/actions/logs`)).data||[]}catch(r){const n=(t=r==null?void 0:r.response)==null?void 0:t.status,i=(r==null?void 0:r.message)||"";return n===401||n===403||n===404||i.includes("Unauthorized")||i.includes("Forbidden")||i.includes("Not Found")?[]:(console.error("Failed to load action logs:",i),[])}},previewRoutes:async e=>{var t;try{return(await nn.post(`/alerts/${e}/actions/preview`)).data||[]}catch(r){const n=(t=r==null?void 0:r.response)==null?void 0:t.status,i=(r==null?void 0:r.message)||"";return n===401||n===403||n===404||i.includes("Unauthorized")||i.includes("Forbidden")||i.includes("Not Found")?[]:(console.error("Failed to preview routes:",i),[])}},retry:async(e,t)=>{var r;try{return(await nn.post(`/alerts/${e}/actions/retry`,{dest:t})).data}catch(n){const i=(r=n==null?void 0:n.response)==null?void 0:r.status,s=(n==null?void 0:n.message)||"";throw i===401||i===403||i===404||s.includes("Unauthorized")||s.includes("Forbidden")||s.includes("Not Found")||console.error("Failed to retry action:",s),n}},retryAllFailed:async e=>{var t;try{return(await nn.post(`/alerts/${e}/actions/retry-all-failed`)).data||[]}catch(r){const n=(t=r==null?void 0:r.response)==null?void 0:t.status,i=(r==null?void 0:r.message)||"";throw n===401||n===403||n===404||i.includes("Unauthorized")||i.includes("Forbidden")||i.includes("Not Found")||console.error("Failed to retry all failed actions:",i),r}}}));function WS({className:e="",variant:t="default",...r}){const n="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold transition-colors",i={default:"bg-primary text-primary-foreground",secondary:"bg-secondary text-secondary-foreground",destructive:"bg-destructive text-destructive-foreground",outline:"border border-input bg-background"};return D.jsx("div",{className:`${n} ${i[t]} ${e}`.trim(),...r})}function mH({alertId:e}){const{loadLogs:t,retryAllFailed:r}=IR(),[n,i]=ce.useState([]),[s,u]=ce.useState(!0),[a,d]=ce.useState(!1),p=Ln("analyst")||Ln("admin");ce.useEffect(()=>{g();const A=setInterval(()=>{document.hidden||g()},1e4);return()=>clearInterval(A)},[e]);const g=async()=>{u(!0);try{const A=await t(e);i(A)}catch{}finally{u(!1)}},v=async()=>{d(!0);try{await r(e),lr("Retry scheduled for all failed destinations"),await g()}catch{}finally{d(!1)}},_=A=>A==="success"?"bg-green-600":A==="failed"?"bg-red-600":A==="retry"||A==="retry_scheduled"?"bg-amber-600":"bg-gray-600",b=A=>{if(!A)return null;const M=new Date(A),P=new Date,I=M.getTime()-P.getTime();if(I<=0)return"Now";const z=Math.floor(I/6e4);return z<1?"<1m":z<60?`~${z}m`:`~${Math.floor(z/60)}h`};if(s&&n.length===0)return D.jsx("div",{className:"text-white/60 text-sm",children:"Loading delivery trace..."});if(n.length===0)return D.jsx("div",{className:"text-white/60 text-sm",children:"No delivery attempts yet"});const k=n.some(A=>A.status==="failed"||A.status==="retry");return D.jsxs("div",{className:"space-y-4",children:[D.jsxs("div",{className:"flex items-center justify-between",children:[D.jsx("h3",{className:"text-lg font-semibold text-white",children:"Delivery Trace"}),D.jsxs("div",{className:"flex gap-2",children:[D.jsx("button",{onClick:g,className:"px-3 py-1.5 text-sm text-white/80 hover:text-white bg-white/5 hover:bg-white/10 rounded border border-white/20",children:"Refresh"}),p&&k&&D.jsx("button",{onClick:v,disabled:a,className:"px-3 py-1.5 text-sm bg-teal-600 hover:bg-teal-700 disabled:opacity-50 text-white rounded",children:a?"Retrying...":"Retry Failed"})]})]}),D.jsx("div",{className:"space-y-2",children:n.map(A=>D.jsxs("div",{className:"bg-white/5 rounded-lg p-3 border border-white/10",children:[D.jsxs("div",{className:"flex items-start justify-between mb-2",children:[D.jsxs("div",{className:"flex items-center gap-2",children:[D.jsx(WS,{className:`${_(A.status)} text-white text-xs`,children:A.status}),D.jsx("span",{className:"text-sm font-medium text-white",children:A.dest}),D.jsxs("span",{className:"text-xs text-white/60",children:["Attempt #",A.attempt]})]}),A.status==="retry"&&A.scheduledAt&&D.jsxs("span",{className:"text-xs text-amber-400",children:["Next retry in ",b(A.scheduledAt)]})]}),A.httpStatus&&D.jsxs("div",{className:"text-xs text-white/60 mb-1",children:["HTTP ",A.httpStatus]}),A.error&&D.jsx("div",{className:"text-xs text-red-400 mb-1 truncate",title:A.error,children:A.error}),D.jsx("div",{className:"text-xs text-white/40",children:A.sentAt?`Sent: ${new Date(A.sentAt).toLocaleString()}`:`Created: ${new Date(A.createdAt).toLocaleString()}`})]},A.id))})]})}function gH({alertId:e}){const{previewRoutes:t,retry:r}=IR(),[n,i]=ce.useState([]),[s,u]=ce.useState(!0),[a,d]=ce.useState(null),p=Ln("analyst")||Ln("admin");ce.useEffect(()=>{g()},[e]);const g=async()=>{u(!0);try{const _=await t(e);i(_)}catch{}finally{u(!1)}},v=async _=>{d(_);try{const b=_.split(":")[0];await r(e,b),lr(`Retry scheduled for ${b}`),await g()}catch{}finally{d(null)}};return s&&n.length===0?D.jsx("div",{className:"text-white/60 text-sm",children:"Loading routing preview..."}):n.length===0?D.jsx("div",{className:"text-white/60 text-sm",children:"No routes configured"}):D.jsxs("div",{className:"space-y-4",children:[D.jsxs("div",{className:"flex items-center justify-between",children:[D.jsx("h3",{className:"text-lg font-semibold text-white",children:"Routing Preview"}),D.jsx("button",{onClick:g,className:"px-3 py-1.5 text-sm text-white/80 hover:text-white bg-white/5 hover:bg-white/10 rounded border border-white/20",children:"Refresh"})]}),D.jsx("div",{className:"space-y-2",children:n.map((_,b)=>D.jsxs("div",{className:"bg-white/5 rounded-lg p-3 border border-white/10",children:[D.jsxs("div",{className:"flex items-start justify-between mb-2",children:[D.jsxs("div",{className:"flex items-center gap-2",children:[_.wouldSend?D.jsx("span",{className:"text-green-400 text-lg",children:""}):_.suppressed?D.jsx("span",{className:"text-purple-400 text-lg",children:""}):D.jsx("span",{className:"text-gray-400 text-lg",children:""}),D.jsx("span",{className:"text-sm font-medium text-white",children:_.dest})]}),p&&!_.wouldSend&&!_.suppressed&&D.jsx("button",{onClick:()=>v(_.dest),disabled:a===_.dest,className:"px-3 py-1.5 text-sm bg-teal-600 hover:bg-teal-700 disabled:opacity-50 text-white rounded",children:a===_.dest?"Retrying...":"Retry Now"})]}),D.jsx("div",{className:"text-sm text-white/70 mb-1",children:_.reason}),_.suppressed&&D.jsx("div",{className:"text-xs text-purple-400",children:"Alert is suppressed"})]},b))})]})}const hp=(e,t)=>`${e}:${t}`,AR=ls((e,t)=>({actions:[],playbooks:[],runs:{},loading:!1,error:null,listActions:async()=>{try{const r="http://localhost:8091",n=ma(),i={};n&&(i.Authorization=`Bearer ${n}`);const s=await fetch(`${r}/enrich/actions`,{headers:i});if(!s.ok){if(s.status===404){e({actions:[]});return}throw new Error(`HTTP ${s.status}: ${s.statusText}`)}const u=await s.json();e({actions:u||[]})}catch(r){const n=(r==null?void 0:r.message)||"";if(n.includes("404")||n.includes("Not Found")){e({actions:[]});return}console.error("Failed to load actions:",n),e({error:n,actions:[]})}},listPlaybooks:async()=>{try{const r="http://localhost:8091",n=ma(),i={};n&&(i.Authorization=`Bearer ${n}`);const s=await fetch(`${r}/enrich/playbooks`,{headers:i});if(!s.ok){if(s.status===404){e({playbooks:[]});return}throw new Error(`HTTP ${s.status}: ${s.statusText}`)}const u=await s.json();e({playbooks:u||[]})}catch(r){const n=(r==null?void 0:r.message)||"";if(n.includes("404")||n.includes("Not Found")){e({playbooks:[]});return}console.error("Failed to load playbooks:",n),e({error:n,playbooks:[]})}},runAction:async(r,n,i,s=!1)=>{try{const u="http://localhost:8091",a=(await ym(async()=>{const{getToken:b}=await Promise.resolve().then(()=>gm);return{getToken:b}},void 0)).getToken(),d={"Content-Type":"application/json"};a&&(d.Authorization=`Bearer ${a}`);const p=await fetch(`${u}/enrich/run`,{method:"POST",headers:d,body:JSON.stringify({subjectKind:r,subjectId:n,actionId:i,attachAsNote:s})});if(!p.ok){const b=await p.json().catch(()=>({detail:p.statusText}));throw new Error(`HTTP ${p.status}: ${b.detail||p.statusText}`)}const g=await p.json(),v=hp(r,n),_=t().runs[v]||[];return e({runs:{...t().runs,[v]:[g,..._]}}),typeof localStorage<"u"&&localStorage.setItem("halcyon:lastEnrichAction",i),g}catch(u){const a=(u==null?void 0:u.message)||"Failed to run action";throw e({error:a}),u}},runPlaybook:async(r,n,i,s=!1)=>{try{const u="http://localhost:8091",a=(await ym(async()=>{const{getToken:b}=await Promise.resolve().then(()=>gm);return{getToken:b}},void 0)).getToken(),d={"Content-Type":"application/json"};a&&(d.Authorization=`Bearer ${a}`);const p=await fetch(`${u}/enrich/playbooks/run`,{method:"POST",headers:d,body:JSON.stringify({subjectKind:r,subjectId:n,playbookId:i,attachAsNote:s})});if(!p.ok){const b=await p.json().catch(()=>({detail:p.statusText}));throw new Error(`HTTP ${p.status}: ${b.detail||p.statusText}`)}const g=await p.json(),v=hp(r,n),_=t().runs[v]||[];return e({runs:{...t().runs,[v]:[g,..._]}}),typeof localStorage<"u"&&localStorage.setItem("halcyon:lastEnrichPlaybook",i),g}catch(u){const a=(u==null?void 0:u.message)||"Failed to run playbook";throw e({error:a}),u}},listRuns:async(r,n)=>{try{const i="http://localhost:8091",s=ma(),u={};s&&(u.Authorization=`Bearer ${s}`);const a=`${i}/enrich/runs?subjectKind=${r}&subjectId=${n}`,d=await fetch(a,{headers:u});if(!d.ok){if(d.status===404){const v=hp(r,n);e({runs:{...t().runs,[v]:[]}});return}throw new Error(`HTTP ${d.status}: ${d.statusText}`)}const p=await d.json(),g=hp(r,n);e({runs:{...t().runs,[g]:p||[]}})}catch(i){const s=(i==null?void 0:i.message)||"";if(s.includes("404")||s.includes("Not Found")){const u=hp(r,n);e({runs:{...t().runs,[u]:[]}});return}console.error("Failed to load runs:",s),e({error:s})}}}));function MR({run:e,onClose:t,onAttachAsNote:r,canAttachAsNote:n=!1}){const[i,s]=ce.useState(!1),u=()=>{const d=JSON.stringify(e.output||e,null,2);navigator.clipboard.writeText(d),s(!0),setTimeout(()=>s(!1),2e3)},a=d=>d==="success"?"text-green-400":d==="failed"?"text-red-400":d==="running"?"text-yellow-400":"text-gray-400";return D.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center",children:D.jsxs("div",{className:"bg-panel border border-white/20 rounded-lg w-full max-w-3xl max-h-[90vh] flex flex-col",children:[D.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/10",children:[D.jsx("h2",{className:"text-xl font-semibold text-white",children:"Run Output"}),D.jsxs("div",{className:"flex items-center gap-2",children:[n&&r&&D.jsx("button",{onClick:r,className:"px-3 py-1 text-sm bg-teal-600 hover:bg-teal-700 rounded text-white",children:"Attach as Note"}),D.jsx("button",{onClick:u,className:"px-3 py-1 text-sm bg-gray-600 hover:bg-gray-700 rounded text-white",children:i?"Copied!":"Copy"}),D.jsx("button",{onClick:t,className:"text-white/60 hover:text-white text-2xl",children:""})]})]}),D.jsxs("div",{className:"flex-1 overflow-auto p-6",children:[e.error&&D.jsxs("div",{className:"mb-4 p-3 bg-red-900/20 border border-red-500/50 rounded",children:[D.jsx("h3",{className:"text-sm font-semibold text-red-400 mb-1",children:"Error"}),D.jsx("p",{className:"text-white text-sm",children:e.error})]}),e.steps&&e.steps.length>0&&D.jsxs("div",{className:"mb-4",children:[D.jsx("h3",{className:"text-sm font-semibold text-white/60 mb-2",children:"Steps"}),D.jsx("div",{className:"space-y-2",children:e.steps.map((d,p)=>D.jsxs("div",{className:"p-3 bg-white/5 rounded border border-white/10",children:[D.jsxs("div",{className:"flex items-center justify-between mb-2",children:[D.jsx("span",{className:"text-sm font-medium text-white",children:d.stepId||d.kind}),D.jsx("span",{className:`text-xs ${a(d.status)}`,children:d.status})]}),d.output&&D.jsxs("details",{className:"mt-2",children:[D.jsx("summary",{className:"text-xs text-white/60 cursor-pointer",children:"Output"}),D.jsx("pre",{className:"mt-2 p-2 bg-black/30 rounded text-xs text-white overflow-auto max-h-40",children:JSON.stringify(d.output,null,2)})]}),d.error&&D.jsx("p",{className:"mt-2 text-xs text-red-400",children:d.error}),D.jsxs("p",{className:"mt-1 text-xs text-white/40",children:["Duration: ",d.durationMs,"ms"]})]},p))})]}),e.output&&D.jsxs("div",{children:[D.jsx("h3",{className:"text-sm font-semibold text-white/60 mb-2",children:"Output"}),D.jsx("pre",{className:"p-4 bg-black/30 rounded text-sm text-white overflow-auto max-h-96",children:JSON.stringify(e.output,null,2)})]}),!e.output&&!e.error&&!e.steps&&D.jsx("div",{className:"text-center text-white/60 py-8",children:"No output available"})]})]})})}function DR({subjectKind:e,subjectId:t}){const{actions:r,runs:n,loading:i,listActions:s,runAction:u,listRuns:a}=AR(),[d,p]=ce.useState(""),[g,v]=ce.useState(null),[_,b]=ce.useState(null),k=Ln("analyst")||Ln("admin"),A=String(t),M=`${e}:${A}`,P=n[M]||[],I=typeof localStorage<"u"?localStorage.getItem("halcyon:lastEnrichAction"):null;ce.useEffect(()=>{s(),a(e,A)},[e,A,s,a]);const z=async $=>{if(k){b($);try{await u(e,A,$,!1),lr("Action completed successfully"),await a(e,A)}catch(G){lr(`Failed to run action: ${(G==null?void 0:G.message)||"Unknown error"}`)}finally{b(null)}}},O=r.filter($=>$.name.toLowerCase().includes(d.toLowerCase())||$.kind.toLowerCase().includes(d.toLowerCase())),V=$=>$==="success"?"bg-green-600":$==="failed"?"bg-red-600":$==="running"?"bg-yellow-600":"bg-gray-600",U=$=>$?$<1e3?`${$}ms`:`${($/1e3).toFixed(2)}s`:"N/A";return D.jsxs("div",{className:"space-y-4",children:[D.jsxs("div",{children:[D.jsxs("div",{className:"flex items-center justify-between mb-3",children:[D.jsx("h3",{className:"text-sm font-semibold text-white",children:"Actions"}),D.jsx("input",{type:"text",placeholder:"Search actions...",value:d,onChange:$=>p($.target.value),className:"bg-panel border border-white/20 rounded px-3 py-1 text-sm text-white placeholder-white/40 focus:outline-none focus:border-teal-500"})]}),i&&r.length===0?D.jsx("div",{className:"text-center text-white/60 py-4",children:"Loading actions..."}):O.length===0?D.jsx("div",{className:"text-center text-white/60 py-4",children:"No actions found"}):D.jsx("div",{className:"space-y-2",children:O.map($=>D.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded border border-white/10",children:[D.jsxs("div",{className:"flex-1",children:[D.jsxs("div",{className:"flex items-center gap-2",children:[D.jsx("span",{className:"text-sm font-medium text-white",children:$.name}),I===$.id&&D.jsx("span",{className:"text-xs bg-teal-600 px-2 py-0.5 rounded",children:"Last used"})]}),D.jsx("span",{className:"text-xs text-white/60",children:$.kind})]}),k&&D.jsx("button",{onClick:()=>z($.id),disabled:_===$.id,className:"px-3 py-1 text-sm bg-teal-600 hover:bg-teal-700 disabled:bg-gray-600 disabled:cursor-not-allowed rounded text-white",children:_===$.id?"Running...":"Run"})]},$.id))})]}),D.jsxs("div",{children:[D.jsx("h3",{className:"text-sm font-semibold text-white mb-3",children:"History"}),P.length===0?D.jsx("div",{className:"text-center text-white/60 py-4",children:"No runs yet"}):D.jsx("div",{className:"space-y-2",children:P.filter($=>$.kind==="action").map($=>{var G,Z;return D.jsxs("div",{className:"p-3 bg-white/5 rounded border border-white/10 cursor-pointer hover:bg-white/10",onClick:()=>v($),children:[D.jsxs("div",{className:"flex items-center justify-between mb-1",children:[D.jsx("span",{className:"text-sm font-medium text-white",children:((G=$.ref)==null?void 0:G.actionId)||"Unknown action"}),D.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${V($.status)}`,children:$.status})]}),D.jsxs("div",{className:"flex items-center gap-4 text-xs text-white/60",children:[D.jsx("span",{children:$.startedAt?new Date($.startedAt).toLocaleString():"N/A"}),((Z=$.metrics)==null?void 0:Z.latencyMs)&&D.jsxs("span",{children:["Duration: ",U($.metrics.latencyMs)]})]})]},$.id)})})]}),g&&D.jsx(MR,{run:g,onClose:()=>v(null),canAttachAsNote:e==="case"||e==="alert"&&g.subjectId})]})}function NR({subjectKind:e,subjectId:t}){const{playbooks:r,runs:n,loading:i,listPlaybooks:s,runPlaybook:u,listRuns:a}=AR(),[d,p]=ce.useState(null),[g,v]=ce.useState(null),_=Ln("analyst")||Ln("admin"),b=String(t),k=`${e}:${b}`,A=n[k]||[],M=typeof localStorage<"u"?localStorage.getItem("halcyon:lastEnrichPlaybook"):null;ce.useEffect(()=>{s(),a(e,b)},[e,b,s,a]);const P=async O=>{if(_){v(O);try{await u(e,b,O,!1),lr("Playbook completed successfully"),await a(e,b)}catch(V){lr(`Failed to run playbook: ${(V==null?void 0:V.message)||"Unknown error"}`)}finally{v(null)}}},I=O=>O==="success"?"text-green-400":O==="failed"?"text-red-400":O==="running"?"text-yellow-400":"text-gray-400",z=O=>O==="success"?"bg-green-600":O==="failed"?"bg-red-600":O==="running"||O==="pending"?"bg-yellow-600":"bg-gray-600";return D.jsxs("div",{className:"space-y-4",children:[D.jsxs("div",{children:[D.jsx("h3",{className:"text-sm font-semibold text-white mb-3",children:"Playbooks"}),i&&r.length===0?D.jsx("div",{className:"text-center text-white/60 py-4",children:"Loading playbooks..."}):r.length===0?D.jsx("div",{className:"text-center text-white/60 py-4",children:"No playbooks available"}):D.jsx("div",{className:"space-y-2",children:r.map(O=>D.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded border border-white/10",children:[D.jsxs("div",{className:"flex-1",children:[D.jsxs("div",{className:"flex items-center gap-2",children:[D.jsx("span",{className:"text-sm font-medium text-white",children:O.name}),M===O.id&&D.jsx("span",{className:"text-xs bg-teal-600 px-2 py-0.5 rounded",children:"Last used"})]}),D.jsxs("span",{className:"text-xs text-white/60",children:["v",O.version]})]}),_&&D.jsx("button",{onClick:()=>P(O.id),disabled:g===O.id,className:"px-3 py-1 text-sm bg-teal-600 hover:bg-teal-700 disabled:bg-gray-600 disabled:cursor-not-allowed rounded text-white",children:g===O.id?"Running...":"Run"})]},O.id))})]}),D.jsxs("div",{children:[D.jsx("h3",{className:"text-sm font-semibold text-white mb-3",children:"Playbook Runs"}),A.length===0?D.jsx("div",{className:"text-center text-white/60 py-4",children:"No runs yet"}):D.jsx("div",{className:"space-y-3",children:A.filter(O=>O.kind==="playbook").map(O=>{var V,U;return D.jsxs("div",{className:"p-3 bg-white/5 rounded border border-white/10 cursor-pointer hover:bg-white/10",onClick:()=>p(O),children:[D.jsxs("div",{className:"flex items-center justify-between mb-2",children:[D.jsx("span",{className:"text-sm font-medium text-white",children:((V=O.ref)==null?void 0:V.playbookId)||"Unknown playbook"}),D.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${I(O.status)}`,children:O.status})]}),O.steps&&O.steps.length>0&&D.jsx("div",{className:"flex gap-2 flex-wrap mb-2",children:O.steps.map(($,G)=>D.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${z($.status)}`,title:`${$.stepId||$.kind}: ${$.status}`,children:$.stepId||$.kind},G))}),D.jsxs("div",{className:"flex items-center gap-4 text-xs text-white/60",children:[D.jsx("span",{children:O.startedAt?new Date(O.startedAt).toLocaleString():"N/A"}),((U=O.metrics)==null?void 0:U.durationMs)&&D.jsxs("span",{children:["Duration: ",O.metrics.durationMs,"ms"]})]})]},O.id)})})]}),d&&D.jsx(MR,{run:d,onClose:()=>p(null),canAttachAsNote:e==="case"||e==="alert"&&d.subjectId})]})}function vH({alert:e,onClose:t}){const[r,n]=ce.useState("details"),i=[{id:"details",label:"Details"},{id:"trace",label:"Trace"},{id:"preview",label:"Preview"},{id:"enrich",label:"Enrich"},{id:"playbooks",label:"Playbooks"}];return D.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center",children:D.jsxs("div",{className:"bg-panel border border-white/20 rounded-lg w-full max-w-4xl max-h-[90vh] flex flex-col",children:[D.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/10",children:[D.jsxs("h2",{className:"text-xl font-semibold text-white",children:["Alert #",e.id]}),D.jsx("button",{onClick:t,className:"text-white/60 hover:text-white text-2xl",children:""})]}),D.jsx("div",{className:"flex border-b border-white/10",children:i.map(s=>D.jsx("button",{onClick:()=>n(s.id),className:`px-4 py-2 text-sm font-medium transition-colors ${r===s.id?"text-white border-b-2 border-teal-500":"text-white/60 hover:text-white/80"}`,children:s.label},s.id))}),D.jsxs("div",{className:"flex-1 overflow-auto p-6",children:[r==="details"&&D.jsxs("div",{className:"space-y-4",children:[D.jsxs("div",{children:[D.jsx("h3",{className:"text-sm text-white/60 mb-1",children:"Message"}),D.jsx("p",{className:"text-white",children:e.message})]}),D.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[D.jsxs("div",{children:[D.jsx("h3",{className:"text-sm text-white/60 mb-1",children:"Severity"}),D.jsx("p",{className:"text-white",children:e.severity})]}),D.jsxs("div",{children:[D.jsx("h3",{className:"text-sm text-white/60 mb-1",children:"Status"}),D.jsx("p",{className:"text-white",children:e.status})]}),e.count&&D.jsxs("div",{children:[D.jsx("h3",{className:"text-sm text-white/60 mb-1",children:"Count"}),D.jsx("p",{className:"text-white",children:e.count})]}),e.entityId&&D.jsxs("div",{children:[D.jsx("h3",{className:"text-sm text-white/60 mb-1",children:"Entity ID"}),D.jsx("p",{className:"text-white",children:e.entityId})]})]}),e.fingerprint&&D.jsxs("div",{children:[D.jsx("h3",{className:"text-sm text-white/60 mb-1",children:"Fingerprint"}),D.jsx("p",{className:"text-white font-mono text-xs",children:e.fingerprint})]}),e.suppressedBy&&D.jsxs("div",{children:[D.jsx("h3",{className:"text-sm text-white/60 mb-1",children:"Suppressed"}),D.jsxs("p",{className:"text-purple-400",children:[e.suppressedBy.kind,": ",e.suppressedBy.name]})]}),D.jsxs("div",{children:[D.jsx("h3",{className:"text-sm text-white/60 mb-1",children:"Created"}),D.jsx("p",{className:"text-white text-sm",children:(()=>{try{if(!e.createdAt)return"N/A";const s=new Date(e.createdAt);return isNaN(s.getTime())?"Invalid Date":s.toLocaleString()}catch{return"Invalid Date"}})()})]})]}),r==="trace"&&D.jsx(mH,{alertId:e.id}),r==="preview"&&D.jsx(gH,{alertId:e.id}),r==="enrich"&&D.jsx(DR,{subjectKind:"alert",subjectId:e.id}),r==="playbooks"&&D.jsx(NR,{subjectKind:"alert",subjectId:e.id})]})]})})}function yH({onCaseChipClick:e}){const{alerts:t,filters:r,setFilters:n,load:i,ack:s,resolve:u}=Io(),{create:a,assignAlerts:d}=qo(),[p,g]=ce.useState({isOpen:!1,message:""}),[v,_]=ce.useState(new Set),[b,k]=ce.useState(!1),[A,M]=ce.useState(""),[P,I]=ce.useState(null),z=Ln("analyst")||Ln("admin");ce.useEffect(()=>{i()},[i,r.status,r.severity]);const O=X=>X==="high"?"text-red-400":X==="medium"?"text-yellow-400":"text-blue-400",V=X=>X==="open"?"bg-blue-600":X==="ack"?"bg-yellow-600":"bg-gray-600",U=async X=>{try{await s(X)}catch(ie){const te=(ie==null?void 0:ie.message)||"";if(te.includes("Unauthorized")||te.includes("403")||te.includes("404")||te.includes("Not Found"))return;g({isOpen:!0,message:te||"Failed to acknowledge alert"})}},$=async X=>{try{await u(X)}catch(ie){const te=(ie==null?void 0:ie.message)||"";if(te.includes("Unauthorized")||te.includes("403")||te.includes("404")||te.includes("Not Found"))return;g({isOpen:!0,message:te||"Failed to resolve alert"})}},G=X=>{_(ie=>{const te=new Set(ie);return te.has(X)?te.delete(X):te.add(X),te})},Z=async X=>{try{const ie=await a(X);await d(ie.id,Array.from(v)),_(new Set),k(!1),await i(),lr("Case created and alerts assigned")}catch(ie){const te=(ie==null?void 0:ie.message)||"";!te.includes("401")&&!te.includes("403")&&!te.includes("404")&&!te.includes("Unauthorized")&&!te.includes("Not Found")&&g({isOpen:!0,message:te||"Failed to create case"})}},Q=async X=>{if(!X.title||X.title.trim()===""){if(v.size===0)throw new Error("No alerts selected");const ie=t.filter(se=>v.has(se.id));if(ie.length===0)throw new Error("No alerts selected");const te=ie[0],W=te.severity.toUpperCase(),oe=te.message||te.fingerprint||"Alert";X.title=`[${W}] ${oe}`}await Z(X)};return D.jsxs(D.Fragment,{children:[D.jsxs("div",{className:"space-y-3",children:[D.jsxs("div",{className:"flex gap-2 items-center",children:[D.jsxs("select",{className:"bg-panel border border-white/20 rounded px-3 py-2 text-white focus:outline-none focus:border-teal-500",value:r.status??"",onChange:X=>n({status:X.target.value||void 0}),children:[D.jsx("option",{value:"",className:"bg-panel text-white",children:"All Status"}),D.jsx("option",{value:"open",className:"bg-panel text-white",children:"Open"}),D.jsx("option",{value:"ack",className:"bg-panel text-white",children:"Acknowledged"}),D.jsx("option",{value:"resolved",className:"bg-panel text-white",children:"Resolved"})]}),D.jsxs("select",{className:"bg-panel border border-white/20 rounded px-3 py-2 text-white focus:outline-none focus:border-teal-500",value:r.severity??"",onChange:X=>n({severity:X.target.value||void 0}),children:[D.jsx("option",{value:"",className:"bg-panel text-white",children:"All Severity"}),D.jsx("option",{value:"low",className:"bg-panel text-white",children:"Low"}),D.jsx("option",{value:"medium",className:"bg-panel text-white",children:"Medium"}),D.jsx("option",{value:"high",className:"bg-panel text-white",children:"High"})]}),z&&v.size>0&&D.jsxs("button",{onClick:()=>{const X=t.filter(ie=>v.has(ie.id));if(X.length>0){const ie=X[0],te=ie.severity.toUpperCase(),W=ie.message||ie.fingerprint||"Alert";M(`[${te}] ${W}`)}k(!0)},className:"px-3 py-2 text-sm bg-teal-600 hover:bg-teal-700 rounded text-white",children:["Open as Case (",v.size,")"]})]}),D.jsx("div",{className:"rounded border border-gray-800 divide-y divide-gray-800",children:t.length===0?D.jsxs("div",{className:"p-6 text-center text-gray-500",children:[D.jsx("div",{className:"mb-2",children:"No alerts found"}),D.jsx("div",{className:"text-xs text-gray-600",children:"Create a rule or generate events to see alerts here"})]}):t.map(X=>D.jsxs("div",{className:"p-3 flex items-center gap-3 cursor-pointer hover:bg-white/5",onClick:()=>I(X),children:[z&&D.jsx("input",{type:"checkbox",checked:v.has(X.id),onChange:ie=>{ie.stopPropagation(),G(X.id)},onClick:ie=>ie.stopPropagation(),className:"w-4 h-4"}),D.jsxs("div",{className:"flex-1",children:[D.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[D.jsx("div",{className:"text-xs text-gray-400",children:(()=>{try{const ie=X.firstSeen||X.createdAt;if(!ie)return"N/A";const te=new Date(ie);return isNaN(te.getTime())?"Invalid Date":te.toLocaleString()}catch{return"Invalid Date"}})()}),X.count&&X.count>1&&D.jsxs("div",{className:"text-xs bg-yellow-600 px-2 py-0.5 rounded cursor-help",title:`Deduped ${X.count-1} time(s) in mute window. First seen: ${(()=>{try{if(!X.firstSeen)return"N/A";const ie=new Date(X.firstSeen);return isNaN(ie.getTime())?"Invalid Date":ie.toLocaleString()}catch{return"Invalid Date"}})()}, Last seen: ${(()=>{try{if(!X.lastSeen)return"N/A";const ie=new Date(X.lastSeen);return isNaN(ie.getTime())?"Invalid Date":ie.toLocaleString()}catch{return"Invalid Date"}})()}`,children:["",X.count]})]}),D.jsx("div",{className:"font-medium",children:X.message}),D.jsxs("div",{className:"text-xs text-gray-500 flex gap-3 mt-1 flex-wrap",children:[D.jsxs("span",{className:O(X.severity),children:["severity: ",X.severity]}),D.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${V(X.status)}`,children:X.status}),X.caseId&&D.jsxs("span",{className:"px-2 py-0.5 rounded text-xs bg-teal-600/30 text-teal-300 border border-teal-500/50 cursor-pointer hover:bg-teal-600/40",onClick:ie=>{ie.stopPropagation(),e==null||e(X.caseId)},children:["Case #",X.caseId]}),X.suppressedBy&&D.jsxs("span",{className:"px-2 py-0.5 rounded text-xs bg-purple-600/30 text-purple-300 border border-purple-500/50 cursor-help",title:`Suppressed by ${X.suppressedBy.kind}: ${X.suppressedBy.name}`,children:["Suppressed by: ",X.suppressedBy.name]}),X.entityId&&D.jsxs("span",{children:["entity: ",X.entityId]}),X.lastSeen&&X.count&&X.count>1&&D.jsxs("span",{className:"text-gray-600",title:`Last seen: ${(()=>{try{const ie=new Date(X.lastSeen);return isNaN(ie.getTime())?"Invalid Date":ie.toLocaleString()}catch{return"Invalid Date"}})()}`,children:["last: ",(()=>{try{const ie=new Date(X.lastSeen);return isNaN(ie.getTime())?"N/A":ie.toLocaleTimeString()}catch{return"N/A"}})()]})]})]}),D.jsxs("div",{className:"flex gap-2",children:[X.status==="open"&&D.jsx("button",{className:"btn btn-sm",onClick:ie=>{ie.stopPropagation(),U(X.id)},children:"Acknowledge"}),(X.status==="open"||X.status==="ack")&&D.jsx("button",{className:"btn btn-sm",onClick:ie=>{ie.stopPropagation(),$(X.id)},children:"Resolve"})]})]},X.id))})]}),D.jsx(PR,{isOpen:b,onClose:()=>{k(!1),_(new Set),M("")},onSubmit:Q,case:A?{title:A}:null}),D.jsx(Qs,{isOpen:p.isOpen,onClose:()=>g({isOpen:!1,message:""}),title:"Error",message:p.message,variant:"error"}),P&&D.jsx(vH,{alert:P,onClose:()=>I(null)})]})}function xH(){const[e,t]=ce.useState(`{
  "match": { "type": "Event", "attrs.severity": "high" },
  "window": "5m",
  "threshold": 3,
  "group_by": "attrs.source",
  "message": "High severity burst from \${attrs.source}"
}`),[r,n]=ce.useState("High severity burst"),[i,s]=ce.useState("high"),[u,a]=ce.useState(!1),[d,p]=ce.useState(""),[g,v]=ce.useState({isOpen:!1,message:""});async function _(){var b,k;a(!0),p("");try{let A;try{A=JSON.parse(e)}catch(P){v({isOpen:!0,message:`Invalid JSON: ${P.message}`}),a(!1);return}const M={name:r,severity:i,conditionJson:A,actionsJson:[{type:"slack",config:{}}],enabled:!0};await nn.post("/alerts/rules",M),lr("Rule saved successfully!"),n(""),t(`{
  "match": { "type": "Event", "attrs.severity": "high" },
  "window": "5m",
  "threshold": 3,
  "group_by": "attrs.source",
  "message": "High severity burst from \${attrs.source}"
}`),p("")}catch(A){const M=((k=(b=A.response)==null?void 0:b.data)==null?void 0:k.detail)||A.message||"Unknown error occurred";if(M.includes("404")||M.includes("Not Found")){p("Rules API not available - backend routes may not be configured"),a(!1);return}v({isOpen:!0,message:M}),a(!1)}finally{a(!1)}}return D.jsxs(D.Fragment,{children:[D.jsxs("div",{className:"space-y-3",children:[D.jsxs("div",{className:"text-xs text-gray-500 p-2 bg-panel/50 rounded border border-gray-700",children:[" Use ",D.jsx("strong",{children:"Silences"})," for ad-hoc suppression and ",D.jsx("strong",{children:"Maintenance"})," for scheduled windows. Suppressed alerts do not notify but still stream to UI."]}),D.jsxs("div",{children:[D.jsx("label",{className:"block text-sm font-medium mb-1 text-white",children:"Rule Name"}),D.jsx("input",{type:"text",className:"bg-panel border border-white/20 rounded px-3 py-2 text-white placeholder-gray-400 focus:outline-none focus:border-teal-500 w-full",value:r,onChange:b=>n(b.target.value),placeholder:"High severity burst"})]}),D.jsxs("div",{children:[D.jsx("label",{className:"block text-sm font-medium mb-1 text-white",children:"Severity"}),D.jsxs("select",{className:"bg-panel border border-white/20 rounded px-3 py-2 text-white focus:outline-none focus:border-teal-500",value:i,onChange:b=>s(b.target.value),children:[D.jsx("option",{value:"low",className:"bg-panel text-white",children:"Low"}),D.jsx("option",{value:"medium",className:"bg-panel text-white",children:"Medium"}),D.jsx("option",{value:"high",className:"bg-panel text-white",children:"High"})]})]}),D.jsxs("div",{children:[D.jsx("label",{className:"block text-sm font-medium mb-1 text-white",children:"Condition JSON"}),D.jsx("textarea",{className:"w-full h-56 font-mono p-2 bg-black/40 border border-gray-800 rounded text-sm text-white placeholder-gray-400 focus:outline-none focus:border-teal-500",value:e,onChange:b=>t(b.target.value)})]}),D.jsxs("div",{className:"flex items-center gap-2",children:[D.jsx("button",{className:"bg-teal-600 hover:bg-teal-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white px-4 py-2 rounded transition-colors",onClick:_,disabled:u,children:u?"Saving...":"Save Rule"}),d&&D.jsx("span",{className:"text-xs text-yellow-400 italic",children:d})]})]}),D.jsx(Qs,{isOpen:g.isOpen,onClose:()=>v({isOpen:!1,message:""}),title:"Error",message:g.message,variant:"error"})]})}const zR=ls((e,t)=>({silences:[],maintenance:[],loading:!1,error:null,loadSilences:async(r=!1)=>{e({loading:!0,error:null});try{const n=await nn.get(`/silences?include_expired=${r}`);e({silences:n.data,loading:!1})}catch(n){const i=(n==null?void 0:n.message)||"";if(i.includes("404")||i.includes("Not Found"))e({silences:[],loading:!1,error:null});else if(i.includes("401")||i.includes("Unauthorized"))try{const{refresh:s}=await ym(async()=>{const{refresh:a}=await Promise.resolve().then(()=>gm);return{refresh:a}},void 0);await s();const u=await nn.get(`/silences?include_expired=${r}`);e({silences:u.data,loading:!1})}catch{e({error:"Unauthorized - please log in again",loading:!1})}else e({error:(n==null?void 0:n.message)||"Failed to load silences",loading:!1})}},createSilence:async r=>{e({error:null});try{const n=await nn.post("/silences",r);return await t().loadSilences(),n.data.id}catch(n){throw e({error:(n==null?void 0:n.message)||"Failed to create silence"}),n}},deleteSilence:async r=>{e({error:null});try{await nn.delete(`/silences/${r}`),await t().loadSilences()}catch(n){if((n==null?void 0:n.status)===404)await t().loadSilences();else throw e({error:(n==null?void 0:n.message)||"Failed to delete silence"}),n}},loadMaintenance:async(r=!1)=>{e({loading:!0,error:null});try{const n=await nn.get(`/maintenance?include_expired=${r}`);e({maintenance:n.data,loading:!1})}catch(n){const i=(n==null?void 0:n.message)||"";if(i.includes("404")||i.includes("Not Found"))e({maintenance:[],loading:!1,error:null});else if(i.includes("401")||i.includes("Unauthorized"))try{const{refresh:s}=await ym(async()=>{const{refresh:a}=await Promise.resolve().then(()=>gm);return{refresh:a}},void 0);await s();const u=await nn.get(`/maintenance?include_expired=${r}`);e({maintenance:u.data,loading:!1})}catch{e({error:"Unauthorized - please log in again",loading:!1})}else e({error:(n==null?void 0:n.message)||"Failed to load maintenance windows",loading:!1})}},createMaintenance:async r=>{e({error:null});try{const n=await nn.post("/maintenance",r);return await t().loadMaintenance(),n.data.id}catch(n){throw e({error:(n==null?void 0:n.message)||"Failed to create maintenance window"}),n}},deleteMaintenance:async r=>{e({error:null});try{await nn.delete(`/maintenance/${r}`),await t().loadMaintenance()}catch(n){if((n==null?void 0:n.status)===404)await t().loadMaintenance();else throw e({error:(n==null?void 0:n.message)||"Failed to delete maintenance window"}),n}},reset:()=>{e({silences:[],maintenance:[],loading:!1,error:null})}}));function _H(){const{silences:e,loading:t,error:r,loadSilences:n,createSilence:i,deleteSilence:s}=zR(),[u,a]=ce.useState(!1),[d,p]=ce.useState({name:"",match_json:"{}",starts_at:"",ends_at:"",reason:""}),[g,v]=ce.useState({isOpen:!1,message:""});ce.useEffect(()=>{n()},[n]);const _=async()=>{try{const M=JSON.parse(d.match_json);await i({name:d.name,match_json:M,starts_at:d.starts_at||new Date().toISOString(),ends_at:d.ends_at||new Date(Date.now()+36e5).toISOString(),reason:d.reason||void 0}),lr("Silence created"),a(!1),p({name:"",match_json:"{}",starts_at:"",ends_at:"",reason:""})}catch(M){v({isOpen:!0,message:(M==null?void 0:M.message)||"Failed to create silence"})}},b=async M=>{try{await s(M),lr("Silence deleted")}catch(P){v({isOpen:!0,message:(P==null?void 0:P.message)||"Failed to delete silence"})}},k=new Date,A=e.filter(M=>new Date(M.ends_at)>=k);return D.jsxs(D.Fragment,{children:[D.jsxs("div",{className:"space-y-3",children:[D.jsxs("div",{className:"flex justify-between items-center",children:[D.jsx("h3",{className:"text-sm font-medium",children:"Alert Silences"}),D.jsx("button",{onClick:()=>a(!u),className:"px-3 py-1.5 bg-teal-600 hover:bg-teal-700 rounded text-sm",children:u?"Cancel":"Create Silence"})]}),u&&D.jsxs("div",{className:"p-4 border border-gray-700 rounded space-y-3",children:[D.jsx("input",{type:"text",placeholder:"Name",value:d.name,onChange:M=>p({...d,name:M.target.value}),className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white focus:outline-none focus:border-teal-500"}),D.jsx("textarea",{placeholder:'Match JSON (e.g., {"type":"Event","attrs.source":"edge-1"})',value:d.match_json,onChange:M=>p({...d,match_json:M.target.value}),className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white focus:outline-none focus:border-teal-500",rows:3}),D.jsx("input",{type:"datetime-local",placeholder:"Start time",value:d.starts_at,onChange:M=>p({...d,starts_at:M.target.value}),className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white focus:outline-none focus:border-teal-500"}),D.jsx("input",{type:"datetime-local",placeholder:"End time",value:d.ends_at,onChange:M=>p({...d,ends_at:M.target.value}),className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white focus:outline-none focus:border-teal-500"}),D.jsx("input",{type:"text",placeholder:"Reason (optional)",value:d.reason,onChange:M=>p({...d,reason:M.target.value}),className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white focus:outline-none focus:border-teal-500"}),D.jsx("button",{onClick:_,className:"px-4 py-2 bg-teal-600 hover:bg-teal-700 rounded",children:"Create"})]}),t&&D.jsx("div",{className:"text-gray-500 text-sm",children:"Loading..."}),r&&!t&&D.jsx("div",{className:"text-red-500 text-sm",children:r}),!t&&A.length===0&&D.jsxs("div",{className:"p-6 text-center text-gray-500",children:[D.jsx("div",{className:"mb-2",children:"No active silences"}),D.jsx("div",{className:"text-xs text-gray-600",children:"Create a silence to suppress matching alerts"})]}),A.length>0&&D.jsx("div",{className:"rounded border border-gray-800 divide-y divide-gray-800",children:A.map(M=>D.jsxs("div",{className:"p-3 flex items-center justify-between",children:[D.jsxs("div",{className:"flex-1",children:[D.jsx("div",{className:"font-medium",children:M.name}),D.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[D.jsxs("div",{children:["Match: ",JSON.stringify(M.match_json)]}),D.jsxs("div",{children:["Active: ",new Date(M.starts_at).toLocaleString(),"  ",new Date(M.ends_at).toLocaleString()]}),M.reason&&D.jsxs("div",{children:["Reason: ",M.reason]})]})]}),D.jsx("button",{onClick:()=>b(M.id),className:"px-3 py-1.5 bg-red-600/20 hover:bg-red-600/30 rounded text-sm text-red-400",children:"Delete"})]},M.id))})]}),D.jsx(Qs,{isOpen:g.isOpen,title:"Error",message:g.message,onClose:()=>v({isOpen:!1,message:""})})]})}function wH(){const{maintenance:e,loading:t,error:r,loadMaintenance:n,createMaintenance:i,deleteMaintenance:s}=zR(),[u,a]=ce.useState(!1),[d,p]=ce.useState({name:"",match_json:"{}",starts_at:"",ends_at:"",reason:""}),[g,v]=ce.useState({isOpen:!1,message:""});ce.useEffect(()=>{n()},[n]);const _=async()=>{try{const M=JSON.parse(d.match_json);await i({name:d.name,match_json:M,starts_at:d.starts_at||new Date().toISOString(),ends_at:d.ends_at||new Date(Date.now()+36e5).toISOString(),reason:d.reason||void 0}),lr("Maintenance window created"),a(!1),p({name:"",match_json:"{}",starts_at:"",ends_at:"",reason:""})}catch(M){v({isOpen:!0,message:(M==null?void 0:M.message)||"Failed to create maintenance window"})}},b=async M=>{try{await s(M),lr("Maintenance window deleted")}catch(P){v({isOpen:!0,message:(P==null?void 0:P.message)||"Failed to delete maintenance window"})}},k=new Date,A=e.filter(M=>new Date(M.ends_at)>=k);return D.jsxs(D.Fragment,{children:[D.jsxs("div",{className:"space-y-3",children:[D.jsxs("div",{className:"flex justify-between items-center",children:[D.jsx("h3",{className:"text-sm font-medium",children:"Maintenance Windows"}),D.jsx("button",{onClick:()=>a(!u),className:"px-3 py-1.5 bg-teal-600 hover:bg-teal-700 rounded text-sm",children:u?"Cancel":"Create Window"})]}),u&&D.jsxs("div",{className:"p-4 border border-gray-700 rounded space-y-3",children:[D.jsx("input",{type:"text",placeholder:"Name",value:d.name,onChange:M=>p({...d,name:M.target.value}),className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white focus:outline-none focus:border-teal-500"}),D.jsx("textarea",{placeholder:'Match JSON (e.g., {"type":"Event","attrs.source":"edge-1"})',value:d.match_json,onChange:M=>p({...d,match_json:M.target.value}),className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white focus:outline-none focus:border-teal-500",rows:3}),D.jsx("input",{type:"datetime-local",placeholder:"Start time",value:d.starts_at,onChange:M=>p({...d,starts_at:M.target.value}),className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white focus:outline-none focus:border-teal-500"}),D.jsx("input",{type:"datetime-local",placeholder:"End time",value:d.ends_at,onChange:M=>p({...d,ends_at:M.target.value}),className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white focus:outline-none focus:border-teal-500"}),D.jsx("input",{type:"text",placeholder:"Reason (optional)",value:d.reason,onChange:M=>p({...d,reason:M.target.value}),className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white focus:outline-none focus:border-teal-500"}),D.jsx("button",{onClick:_,className:"px-4 py-2 bg-teal-600 hover:bg-teal-700 rounded",children:"Create"})]}),t&&D.jsx("div",{className:"text-gray-500 text-sm",children:"Loading..."}),r&&!t&&D.jsx("div",{className:"text-red-500 text-sm",children:r}),!t&&A.length===0&&D.jsxs("div",{className:"p-6 text-center text-gray-500",children:[D.jsx("div",{className:"mb-2",children:"No active maintenance windows"}),D.jsx("div",{className:"text-xs text-gray-600",children:"Create a window to suppress matching alerts during maintenance"})]}),A.length>0&&D.jsx("div",{className:"rounded border border-gray-800 divide-y divide-gray-800",children:A.map(M=>D.jsxs("div",{className:"p-3 flex items-center justify-between",children:[D.jsxs("div",{className:"flex-1",children:[D.jsx("div",{className:"font-medium",children:M.name}),D.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[D.jsxs("div",{children:["Match: ",JSON.stringify(M.match_json)]}),D.jsxs("div",{children:["Active: ",new Date(M.starts_at).toLocaleString(),"  ",new Date(M.ends_at).toLocaleString()]}),M.reason&&D.jsxs("div",{children:["Reason: ",M.reason]})]})]}),D.jsx("button",{onClick:()=>b(M.id),className:"px-3 py-1.5 bg-red-600/20 hover:bg-red-600/30 rounded text-sm text-red-400",children:"Delete"})]},M.id))})]}),D.jsx(Qs,{isOpen:g.isOpen,title:"Error",message:g.message,onClose:()=>v({isOpen:!1,message:""})})]})}function bH(){const[e,t]=ce.useState("list"),r=Io(s=>s.load),n=Io(s=>s.setFilters),i=()=>Io.setState({unread:0});return ce.useEffect(()=>{r().finally(i),n({})},[]),ce.useEffect(()=>{const s=()=>{document.hidden||Io.setState({unread:0})};return document.addEventListener("visibilitychange",s),()=>document.removeEventListener("visibilitychange",s)},[]),D.jsxs("div",{className:"h-full flex flex-col p-4",children:[D.jsxs("div",{className:"flex gap-4 border-b border-gray-800 mb-4",children:[D.jsx("button",{onClick:()=>t("list"),className:`px-4 py-2 text-sm font-medium ${e==="list"?"border-b-2 border-teal-500 text-teal-400":"text-gray-400 hover:text-white"}`,children:"List"}),D.jsx("button",{onClick:()=>t("rules"),className:`px-4 py-2 text-sm font-medium ${e==="rules"?"border-b-2 border-teal-500 text-teal-400":"text-gray-400 hover:text-white"}`,children:"Rules"}),D.jsx("button",{onClick:()=>t("silences"),className:`px-4 py-2 text-sm font-medium ${e==="silences"?"border-b-2 border-teal-500 text-teal-400":"text-gray-400 hover:text-white"}`,children:"Silences"}),D.jsx("button",{onClick:()=>t("maintenance"),className:`px-4 py-2 text-sm font-medium ${e==="maintenance"?"border-b-2 border-teal-500 text-teal-400":"text-gray-400 hover:text-white"}`,children:"Maintenance"})]}),D.jsxs("div",{className:"flex-1 overflow-auto",children:[e==="list"&&D.jsx(yH,{onCaseChipClick:s=>{window.dispatchEvent(new CustomEvent("navigate-to-cases",{detail:{caseId:s}}))}}),e==="rules"&&D.jsx(xH,{}),e==="silences"&&D.jsx(_H,{}),e==="maintenance"&&D.jsx(wH,{})]})]})}function RR({score:e,className:t=""}){if(e==null)return null;let r="bg-slate-500";e>=.8?r="bg-green-600":e>=.5&&(r="bg-amber-500");const n=Math.round(e*100);return D.jsxs(WS,{className:`${r} text-white text-xs ${t}`,title:`Confidence: ${n}%`,children:[n,"%"]})}function SH({onSelect:e}){const{items:t,loading:r,list:n,selected:i}=qo(),[s,u]=ce.useState(""),[a,d]=ce.useState(""),[p,g]=ce.useState(""),[v,_]=ce.useState("");ce.useEffect(()=>{const A={};s&&(A.status=s),a&&(A.priority=a),p.trim()&&(A.owner=p.trim()),v.trim()&&(A.search=v.trim()),n(A)},[s,a,p,v,n]);const b=A=>A==="open"?"bg-blue-600":A==="in_progress"?"bg-yellow-600":A==="resolved"?"bg-green-600":"bg-gray-600",k=A=>A==="critical"?"text-red-400":A==="high"?"text-orange-400":A==="medium"?"text-yellow-400":"text-blue-400";return D.jsxs("div",{className:"space-y-3",children:[D.jsxs("div",{className:"space-y-2",children:[D.jsx("input",{type:"text",className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white text-sm focus:outline-none focus:border-teal-500",placeholder:"Search cases...",value:v,onChange:A=>_(A.target.value)}),D.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[D.jsxs("select",{className:"bg-panel border border-white/20 rounded px-2 py-1 text-white text-sm focus:outline-none focus:border-teal-500",value:s,onChange:A=>u(A.target.value),children:[D.jsx("option",{value:"",children:"All Status"}),D.jsx("option",{value:"open",children:"Open"}),D.jsx("option",{value:"in_progress",children:"In Progress"}),D.jsx("option",{value:"resolved",children:"Resolved"}),D.jsx("option",{value:"closed",children:"Closed"})]}),D.jsxs("select",{className:"bg-panel border border-white/20 rounded px-2 py-1 text-white text-sm focus:outline-none focus:border-teal-500",value:a,onChange:A=>d(A.target.value),children:[D.jsx("option",{value:"",children:"All Priority"}),D.jsx("option",{value:"low",children:"Low"}),D.jsx("option",{value:"medium",children:"Medium"}),D.jsx("option",{value:"high",children:"High"}),D.jsx("option",{value:"critical",children:"Critical"})]})]}),D.jsx("input",{type:"text",className:"w-full bg-panel border border-white/20 rounded px-2 py-1 text-white text-sm focus:outline-none focus:border-teal-500",placeholder:"Filter by owner...",value:p,onChange:A=>g(A.target.value)})]}),r?D.jsx("div",{className:"text-white/60 text-sm text-center py-4",children:"Loading..."}):t.length===0?D.jsx("div",{className:"text-white/60 text-sm text-center py-4",children:"No cases found"}):D.jsx("div",{className:"space-y-1",children:t.map(A=>D.jsxs("div",{className:`p-3 rounded border cursor-pointer transition-colors ${(i==null?void 0:i.id)===A.id?"bg-teal-600/20 border-teal-500":"bg-white/5 border-white/10 hover:bg-white/10"}`,onClick:()=>e(A),children:[D.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1",children:[D.jsx("h4",{className:"font-medium text-white text-sm flex-1",children:A.title}),D.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${b(A.status)}`,children:A.status.replace("_"," ")})]}),D.jsxs("div",{className:"flex items-center gap-2 text-xs flex-wrap",children:[D.jsx("span",{className:k(A.priority),children:A.priority}),A.prioritySuggestion&&A.prioritySuggestion!==A.priority&&D.jsxs(D.Fragment,{children:[D.jsx("span",{className:"text-white/40",children:""}),D.jsxs("span",{className:"text-purple-400 flex items-center gap-1",title:"AI suggested priority",children:["AI: ",A.prioritySuggestion,D.jsx(RR,{score:A.priorityScore})]})]}),A.owner&&D.jsxs(D.Fragment,{children:[D.jsx("span",{className:"text-white/40",children:""}),D.jsx("span",{className:"text-white/60",children:A.owner})]})]}),A.description&&D.jsx("p",{className:"text-xs text-white/70 mt-1 line-clamp-2",children:A.description})]},A.id))})]})}function EH({caseData:e,onUpdate:t}){const[r,n]=ce.useState(null),[i,s]=ce.useState(""),{update:u}=qo(),a=Ln("analyst")||Ln("admin"),d=b=>b==="open"?"bg-blue-600":b==="in_progress"?"bg-yellow-600":b==="resolved"?"bg-green-600":"bg-gray-600",p=b=>b==="critical"?"text-red-400":b==="high"?"text-orange-400":b==="medium"?"text-yellow-400":"text-blue-400",g=b=>{a&&(n(b),s(b==="status"?e.status:b==="priority"?e.priority:e.owner||""))},v=async()=>{if(r)try{const b={};r==="status"?b.status=i:r==="priority"?b.priority=i:b.owner=i.trim()||null;const k=await u(e.id,b);t(k),n(null)}catch{n(null)}},_=()=>{n(null),s("")};return D.jsxs("div",{className:"space-y-3 pb-4 border-b border-white/10",children:[D.jsxs("div",{className:"flex items-center gap-2",children:[D.jsx("span",{className:"text-sm text-white/60",children:"Status:"}),r==="status"&&a?D.jsxs("div",{className:"flex items-center gap-2",children:[D.jsxs("select",{className:"bg-panel border border-white/20 rounded px-2 py-1 text-white text-sm focus:outline-none focus:border-teal-500",value:i,onChange:b=>s(b.target.value),autoFocus:!0,children:[D.jsx("option",{value:"open",children:"Open"}),D.jsx("option",{value:"in_progress",children:"In Progress"}),D.jsx("option",{value:"resolved",children:"Resolved"}),D.jsx("option",{value:"closed",children:"Closed"})]}),D.jsx("button",{onClick:v,className:"px-2 py-1 text-xs bg-teal-600 hover:bg-teal-700 rounded text-white",children:"Save"}),D.jsx("button",{onClick:_,className:"px-2 py-1 text-xs bg-white/10 hover:bg-white/20 rounded text-white/80",children:"Cancel"})]}):D.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${d(e.status)} ${a?"cursor-pointer hover:opacity-80":""}`,onClick:()=>g("status"),children:e.status.replace("_"," ")})]}),D.jsxs("div",{className:"flex items-center gap-2",children:[D.jsx("span",{className:"text-sm text-white/60",children:"Priority:"}),r==="priority"&&a?D.jsxs("div",{className:"flex items-center gap-2",children:[D.jsxs("select",{className:"bg-panel border border-white/20 rounded px-2 py-1 text-white text-sm focus:outline-none focus:border-teal-500",value:i,onChange:b=>s(b.target.value),autoFocus:!0,children:[D.jsx("option",{value:"low",children:"Low"}),D.jsx("option",{value:"medium",children:"Medium"}),D.jsx("option",{value:"high",children:"High"}),D.jsx("option",{value:"critical",children:"Critical"})]}),D.jsx("button",{onClick:v,className:"px-2 py-1 text-xs bg-teal-600 hover:bg-teal-700 rounded text-white",children:"Save"}),D.jsx("button",{onClick:_,className:"px-2 py-1 text-xs bg-white/10 hover:bg-white/20 rounded text-white/80",children:"Cancel"})]}):D.jsx("span",{className:`font-medium ${p(e.priority)} ${a?"cursor-pointer hover:underline":""}`,onClick:()=>g("priority"),children:e.priority})]}),D.jsxs("div",{className:"flex items-center gap-2",children:[D.jsx("span",{className:"text-sm text-white/60",children:"Owner:"}),r==="owner"&&a?D.jsxs("div",{className:"flex items-center gap-2",children:[D.jsx("input",{type:"text",className:"bg-panel border border-white/20 rounded px-2 py-1 text-white text-sm focus:outline-none focus:border-teal-500",value:i,onChange:b=>s(b.target.value),placeholder:"user@example.com",autoFocus:!0}),D.jsx("button",{onClick:v,className:"px-2 py-1 text-xs bg-teal-600 hover:bg-teal-700 rounded text-white",children:"Save"}),D.jsx("button",{onClick:_,className:"px-2 py-1 text-xs bg-white/10 hover:bg-white/20 rounded text-white/80",children:"Cancel"})]}):D.jsx("span",{className:`text-white/80 ${a&&!e.owner?"cursor-pointer hover:underline":""}`,onClick:()=>e.owner||a?g("owner"):void 0,children:e.owner||(a?"Click to assign":"Unassigned")})]}),e.resolvedAt&&D.jsxs("div",{className:"text-sm text-white/60",children:["Resolved: ",new Date(e.resolvedAt).toLocaleString()]})]})}function TH({caseId:e}){const[t,r]=ce.useState([]),[n,i]=ce.useState(!1),[s,u]=ce.useState(""),[a,d]=ce.useState(!1),{listNotes:p,addNote:g}=qo(),v=Ln("analyst")||Ln("admin");ce.useEffect(()=>{_()},[e]);const _=async()=>{i(!0);try{const k=await p(e);r(k)}catch{r([])}finally{i(!1)}},b=async k=>{if(k.preventDefault(),!(!s.trim()||!v)){d(!0);try{await g(e,s.trim()),u(""),await _()}catch{}finally{d(!1)}}};return n?D.jsx("div",{className:"text-white/60 text-sm",children:"Loading notes..."}):D.jsxs("div",{className:"space-y-4",children:[D.jsx("h3",{className:"text-lg font-semibold text-white",children:"Notes"}),t.length===0?D.jsx("div",{className:"text-white/60 text-sm",children:"No notes yet"}):D.jsx("div",{className:"space-y-3",children:t.map(k=>D.jsxs("div",{className:"bg-white/5 rounded p-3 border border-white/10",children:[D.jsxs("div",{className:"flex items-center justify-between mb-2",children:[D.jsx("span",{className:"text-sm font-medium text-white/80",children:k.author||"Unknown"}),D.jsx("span",{className:"text-xs text-white/60",children:new Date(k.createdAt).toLocaleString()})]}),D.jsx("p",{className:"text-sm text-white/90 whitespace-pre-wrap",children:k.body})]},k.id))}),v&&D.jsxs("form",{onSubmit:b,className:"space-y-2",children:[D.jsx("textarea",{className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white text-sm focus:outline-none focus:border-teal-500 h-24 resize-none",value:s,onChange:k=>u(k.target.value),placeholder:"Add a note...",disabled:a}),D.jsx("div",{className:"flex justify-end",children:D.jsx("button",{type:"submit",className:"px-4 py-2 rounded bg-teal-600 hover:bg-teal-700 text-white text-sm",disabled:!s.trim()||a,children:a?"Adding...":"Add Note"})})]})]})}function CH({caseId:e,onAlertClick:t}){const[r,n]=ce.useState([]),[i,s]=ce.useState(!1),{alerts:u}=Io();ce.useEffect(()=>{const p=u.filter(g=>g.caseId===e);n(p)},[e,u]);const a=p=>p==="high"?"text-red-400":p==="medium"?"text-yellow-400":"text-blue-400",d=p=>p==="open"?"bg-blue-600":p==="ack"?"bg-yellow-600":"bg-gray-600";return i?D.jsx("div",{className:"text-white/60 text-sm",children:"Loading alerts..."}):D.jsxs("div",{className:"space-y-4",children:[D.jsxs("h3",{className:"text-lg font-semibold text-white",children:["Linked Alerts ",r.length>0&&D.jsxs("span",{className:"text-white/60 text-sm",children:["(",r.length,")"]})]}),r.length===0?D.jsx("div",{className:"text-white/60 text-sm",children:"No alerts linked to this case"}):D.jsx("div",{className:"space-y-2",children:r.map(p=>D.jsx("div",{className:"bg-white/5 rounded p-3 border border-white/10 hover:bg-white/10 cursor-pointer transition-colors",onClick:()=>t==null?void 0:t(p.id),children:D.jsx("div",{className:"flex items-start justify-between gap-2",children:D.jsxs("div",{className:"flex-1",children:[D.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[D.jsx("span",{className:`text-sm font-medium ${a(p.severity)}`,children:p.severity}),D.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${d(p.status)}`,children:p.status}),p.count&&p.count>1&&D.jsxs("span",{className:"text-xs text-white/60",children:["",p.count]})]}),D.jsx("p",{className:"text-sm text-white/90",children:p.message}),D.jsx("p",{className:"text-xs text-white/60 mt-1",children:new Date(p.createdAt).toLocaleString()})]})})},p.id))})]})}const LR=ls(()=>({provideFeedback:async e=>{var t;try{return(await nn.post(`/ml/cases/${e.caseId}/feedback`,{suggestionType:e.suggestionType,suggestedValue:e.suggestedValue,finalValue:e.finalValue||null,action:e.action,score:e.score||null})).data}catch(r){const n=(t=r==null?void 0:r.response)==null?void 0:t.status,i=(r==null?void 0:r.message)||"";throw n===401||n===403||n===404||i.includes("Unauthorized")||i.includes("Forbidden")||i.includes("Not Found")||console.error("Failed to submit feedback:",i),r}},getFeedback:async e=>{var t;try{return(await nn.get(`/ml/cases/${e}/feedback`)).data||[]}catch(r){const n=(t=r==null?void 0:r.response)==null?void 0:t.status,i=(r==null?void 0:r.message)||"";return n===401||n===403||n===404||i.includes("Unauthorized")||i.includes("Forbidden")||i.includes("Not Found")?[]:(console.error("Failed to load feedback:",i),[])}}}));function GI({caseData:e,suggestionType:t,suggestedValue:r,score:n,onFeedbackSubmitted:i}){const{provideFeedback:s}=LR(),[u,a]=ce.useState(!1),[d,p]=ce.useState(!1),[g,v]=ce.useState("");if(!Ln("analyst")&&!Ln("admin"))return null;const _=async(M,P)=>{a(!0);try{await s({caseId:e.id,suggestionType:t,suggestedValue:r,finalValue:P,action:M,score:n||void 0}),lr("Feedback submitted","success"),p(!1),i==null||i()}catch{}finally{a(!1)}},b=()=>{_("accepted")},k=()=>{p(!0)},A=()=>{g?_("overridden",g):_("rejected")};return d?D.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[D.jsx("span",{className:"text-muted",children:"What did you choose?"}),t==="priority"?D.jsxs("select",{value:g,onChange:M=>v(M.target.value),className:"px-2 py-1 bg-gray-800 border border-gray-700 rounded text-white text-sm",children:[D.jsx("option",{value:"",children:"Rejected"}),D.jsx("option",{value:"low",children:"Low"}),D.jsx("option",{value:"medium",children:"Medium"}),D.jsx("option",{value:"high",children:"High"}),D.jsx("option",{value:"critical",children:"Critical"})]}):D.jsx("input",{type:"text",value:g,onChange:M=>v(M.target.value),placeholder:"Owner email",className:"px-2 py-1 bg-gray-800 border border-gray-700 rounded text-white text-sm w-32"}),D.jsx("button",{onClick:A,disabled:u,className:"px-2 py-1 text-xs bg-teal-600 hover:bg-teal-700 rounded text-white disabled:opacity-50",children:"Submit"}),D.jsx("button",{onClick:()=>{p(!1),v("")},className:"px-2 py-1 text-xs bg-gray-600 hover:bg-gray-700 rounded text-white",children:"Cancel"})]}):D.jsxs("div",{className:"flex items-center gap-2",children:[D.jsx("span",{className:"text-sm text-muted",children:"Was this helpful?"}),D.jsx("button",{onClick:b,disabled:u,className:"w-7 h-7 p-0 bg-transparent hover:bg-white/10 rounded disabled:opacity-50",title:"Mark as helpful",children:""}),D.jsx("button",{onClick:k,disabled:u,className:"w-7 h-7 p-0 bg-transparent hover:bg-white/10 rounded disabled:opacity-50",title:"Mark as not helpful",children:""})]})}function kH({caseData:e,onUpdate:t}){const{adoptPriority:r,adoptOwner:n,get:i}=qo(),[s,u]=ce.useState(null),a=Ln("analyst")||Ln("admin"),d=async()=>{if(e.prioritySuggestion){u("priority");try{const _=await r(e.id);t(_),lr("Priority suggestion adopted")}catch{}finally{u(null)}}},p=async()=>{if(e.ownerSuggestion){u("owner");try{const _=await n(e.id);t(_),lr("Owner suggestion adopted")}catch{}finally{u(null)}}},g=async _=>{try{const b=await i(_);window.dispatchEvent(new CustomEvent("navigate-to-cases",{detail:{caseId:_}}))}catch{}},v=_=>_?_==="critical"?"text-red-400":_==="high"?"text-orange-400":_==="medium"?"text-yellow-400":"text-blue-400":"text-white/60";return!e.prioritySuggestion&&!e.ownerSuggestion&&(!e.similarCaseIds||e.similarCaseIds.length===0)?null:D.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[D.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Insights (AI)"}),D.jsxs("div",{className:"space-y-4",children:[e.prioritySuggestion&&D.jsxs("div",{className:"space-y-2",children:[D.jsxs("div",{className:"flex items-center justify-between",children:[D.jsxs("div",{className:"flex items-center gap-2",children:[D.jsxs("div",{children:[D.jsx("div",{className:"text-sm text-white/60 mb-1",children:"Suggested Priority"}),D.jsx("div",{className:`text-lg font-medium ${v(e.prioritySuggestion)}`,children:e.prioritySuggestion})]}),D.jsx(RR,{score:e.priorityScore})]}),a&&D.jsx("button",{onClick:d,disabled:s==="priority",className:"px-3 py-1.5 text-sm bg-teal-600 hover:bg-teal-700 rounded text-white disabled:opacity-50",children:s==="priority"?"Adopting...":"Adopt"})]}),D.jsx(GI,{caseData:e,suggestionType:"priority",suggestedValue:e.prioritySuggestion,score:e.priorityScore,onFeedbackSubmitted:t})]}),e.ownerSuggestion&&D.jsxs("div",{className:"space-y-2",children:[D.jsxs("div",{className:"flex items-center justify-between",children:[D.jsxs("div",{children:[D.jsx("div",{className:"text-sm text-white/60 mb-1",children:"Suggested Owner"}),D.jsx("div",{className:"text-lg text-white/90",children:e.ownerSuggestion})]}),a&&D.jsx("button",{onClick:p,disabled:s==="owner",className:"px-3 py-1.5 text-sm bg-teal-600 hover:bg-teal-700 rounded text-white disabled:opacity-50",children:s==="owner"?"Adopting...":"Adopt"})]}),D.jsx(GI,{caseData:e,suggestionType:"owner",suggestedValue:e.ownerSuggestion,onFeedbackSubmitted:t})]}),e.similarCaseIds&&e.similarCaseIds.length>0&&D.jsxs("div",{children:[D.jsx("div",{className:"text-sm text-white/60 mb-2",children:"Related Cases"}),D.jsx("div",{className:"flex gap-2 flex-wrap",children:e.similarCaseIds.map(_=>D.jsxs("button",{onClick:()=>g(_),className:"px-2 py-1 text-xs bg-teal-600/30 hover:bg-teal-600/40 border border-teal-500/50 rounded text-teal-300 cursor-pointer transition-colors",children:["#",_]},_))})]}),e.mlVersion&&D.jsxs("div",{className:"text-xs text-white/40 pt-2 border-t border-white/10",children:["ML Model: v",e.mlVersion]})]})]})}function PH({caseId:e}){const{getFeedback:t}=LR(),[r,n]=ce.useState([]),[i,s]=ce.useState(!0),[u,a]=ce.useState(!1);ce.useEffect(()=>{d()},[e]);const d=async()=>{s(!0);try{const g=await t(e);n(g)}catch{}finally{s(!1)}};if(i||r.length===0)return null;const p=g=>g==="accepted"?"bg-green-600":g==="rejected"?"bg-red-600":"bg-amber-600";return D.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[D.jsxs("button",{onClick:()=>a(!u),className:"flex items-center justify-between w-full text-left",children:[D.jsxs("h3",{className:"text-lg font-semibold text-white",children:["Feedback History (",r.length,")"]}),D.jsx("span",{className:"text-white/60 text-sm",children:u?"":""})]}),u&&D.jsx("div",{className:"mt-4 space-y-3",children:r.map(g=>D.jsxs("div",{className:"bg-white/5 rounded p-3 border border-white/5",children:[D.jsxs("div",{className:"flex items-start justify-between mb-2",children:[D.jsxs("div",{className:"flex items-center gap-2",children:[D.jsx(WS,{className:`${p(g.action)} text-white text-xs`,children:g.action}),D.jsx("span",{className:"text-sm text-white/80 capitalize",children:g.suggestionType})]}),D.jsx("span",{className:"text-xs text-white/40",children:new Date(g.createdAt).toLocaleString()})]}),D.jsxs("div",{className:"text-sm text-white/70",children:["Suggested: ",D.jsx("span",{className:"font-medium",children:g.suggestedValue}),g.finalValue&&D.jsxs(D.Fragment,{children:["  ",D.jsx("span",{className:"font-medium",children:g.finalValue})]})]}),g.userId&&D.jsxs("div",{className:"text-xs text-white/40 mt-1",children:["By: ",g.userId]})]},g.id))})]})}function IH({caseId:e,onAlertClick:t}){const[r,n]=ce.useState(null),[i,s]=ce.useState(!1),{get:u}=qo();ce.useEffect(()=>{a()},[e]);const a=async()=>{s(!0);try{const p=await u(e);n(p)}catch{n(null)}finally{s(!1)}},d=p=>{n(p),a()};return i?D.jsx("div",{className:"text-white/60 text-sm",children:"Loading case..."}):r?D.jsxs("div",{className:"space-y-6",children:[D.jsxs("div",{children:[D.jsx("h2",{className:"text-2xl font-semibold text-white mb-2",children:r.title}),r.description&&D.jsx("p",{className:"text-white/80 text-sm",children:r.description}),D.jsxs("div",{className:"text-xs text-white/60 mt-2",children:["Created ",new Date(r.createdAt).toLocaleString()," by ",r.createdBy||"Unknown"]})]}),D.jsx(EH,{caseData:r,onUpdate:d}),D.jsx(kH,{caseData:r,onUpdate:d}),D.jsx(PH,{caseId:e}),D.jsx(CH,{caseId:e,onAlertClick:t}),D.jsx(TH,{caseId:e}),D.jsxs("div",{className:"border-t border-white/10 pt-6",children:[D.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Enrichment"}),D.jsx(DR,{subjectKind:"case",subjectId:e})]}),D.jsxs("div",{className:"border-t border-white/10 pt-6",children:[D.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Playbooks"}),D.jsx(NR,{subjectKind:"case",subjectId:e})]})]}):D.jsx("div",{className:"text-white/60 text-sm",children:"Case not found"})}function AH(){return D.jsx("div",{className:"h-full flex items-center justify-center text-white/60",children:D.jsxs("div",{className:"text-center",children:[D.jsx("p",{className:"text-lg mb-2",children:"No case selected"}),D.jsx("p",{className:"text-sm",children:"Select a case from the list to view details"})]})})}function MH({onCreated:e}){const[t,r]=ce.useState(!1),{create:n}=qo(),i=async s=>{await n(s),e()};return D.jsxs(D.Fragment,{children:[D.jsx("button",{onClick:()=>r(!0),className:"px-3 py-1.5 text-sm bg-teal-600 hover:bg-teal-700 rounded text-white",children:"New Case"}),D.jsx(PR,{isOpen:t,onClose:()=>r(!1),onSubmit:i})]})}function DH(){const{list:e,selected:t,setSelected:r}=qo(),[n,i]=ce.useState(null),s=Ln("analyst")||Ln("admin");ce.useEffect(()=>{e().catch(d=>{const p=(d==null?void 0:d.message)||"";!p.includes("401")&&!p.includes("403")&&!p.includes("404")&&!p.includes("Unauthorized")&&!p.includes("Not Found")&&i(p)})},[e]);const u=()=>{e()},a=d=>{window.dispatchEvent(new CustomEvent("navigate-to-alerts",{detail:{alertId:d}}))};return D.jsxs("div",{className:"h-full grid grid-cols-12 gap-3 p-3",children:[D.jsxs("div",{className:"col-span-4 bg-panel rounded-2xl p-3 overflow-auto",children:[D.jsxs("div",{className:"flex items-center justify-between mb-3",children:[D.jsx("h2",{className:"text-lg font-semibold text-white",children:"Cases"}),s&&D.jsx(MH,{onCreated:u})]}),D.jsx(SH,{onSelect:r})]}),D.jsx("div",{className:"col-span-8 bg-panel rounded-2xl p-3 overflow-auto",children:t?D.jsx(IH,{caseId:t.id,onAlertClick:a}):D.jsx(AH,{})}),n&&D.jsx(Qs,{isOpen:!0,title:"Error",message:n,onClose:()=>i(null),variant:"error"})]})}const NH={};function zH(e,t){let r;try{r=e()}catch{return}return{getItem:i=>{var s;const u=d=>d===null?null:JSON.parse(d,void 0),a=(s=r.getItem(i))!=null?s:null;return a instanceof Promise?a.then(u):u(a)},setItem:(i,s)=>r.setItem(i,JSON.stringify(s,void 0)),removeItem:i=>r.removeItem(i)}}const xm=e=>t=>{try{const r=e(t);return r instanceof Promise?r:{then(n){return xm(n)(r)},catch(n){return this}}}catch(r){return{then(n){return this},catch(n){return xm(n)(r)}}}},RH=(e,t)=>(r,n,i)=>{let s={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:M=>M,version:0,merge:(M,P)=>({...P,...M}),...t},u=!1;const a=new Set,d=new Set;let p;try{p=s.getStorage()}catch{}if(!p)return e((...M)=>{console.warn(`[zustand persist middleware] Unable to update item '${s.name}', the given storage is currently unavailable.`),r(...M)},n,i);const g=xm(s.serialize),v=()=>{const M=s.partialize({...n()});let P;const I=g({state:M,version:s.version}).then(z=>p.setItem(s.name,z)).catch(z=>{P=z});if(P)throw P;return I},_=i.setState;i.setState=(M,P)=>{_(M,P),v()};const b=e((...M)=>{r(...M),v()},n,i);let k;const A=()=>{var M;if(!p)return;u=!1,a.forEach(I=>I(n()));const P=((M=s.onRehydrateStorage)==null?void 0:M.call(s,n()))||void 0;return xm(p.getItem.bind(p))(s.name).then(I=>{if(I)return s.deserialize(I)}).then(I=>{if(I)if(typeof I.version=="number"&&I.version!==s.version){if(s.migrate)return s.migrate(I.state,I.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return I.state}).then(I=>{var z;return k=s.merge(I,(z=n())!=null?z:b),r(k,!0),v()}).then(()=>{P==null||P(k,void 0),u=!0,d.forEach(I=>I(k))}).catch(I=>{P==null||P(void 0,I)})};return i.persist={setOptions:M=>{s={...s,...M},M.getStorage&&(p=M.getStorage())},clearStorage:()=>{p==null||p.removeItem(s.name)},getOptions:()=>s,rehydrate:()=>A(),hasHydrated:()=>u,onHydrate:M=>(a.add(M),()=>{a.delete(M)}),onFinishHydration:M=>(d.add(M),()=>{d.delete(M)})},A(),k||b},LH=(e,t)=>(r,n,i)=>{let s={storage:zH(()=>localStorage),partialize:A=>A,version:0,merge:(A,M)=>({...M,...A}),...t},u=!1;const a=new Set,d=new Set;let p=s.storage;if(!p)return e((...A)=>{console.warn(`[zustand persist middleware] Unable to update item '${s.name}', the given storage is currently unavailable.`),r(...A)},n,i);const g=()=>{const A=s.partialize({...n()});return p.setItem(s.name,{state:A,version:s.version})},v=i.setState;i.setState=(A,M)=>{v(A,M),g()};const _=e((...A)=>{r(...A),g()},n,i);i.getInitialState=()=>_;let b;const k=()=>{var A,M;if(!p)return;u=!1,a.forEach(I=>{var z;return I((z=n())!=null?z:_)});const P=((M=s.onRehydrateStorage)==null?void 0:M.call(s,(A=n())!=null?A:_))||void 0;return xm(p.getItem.bind(p))(s.name).then(I=>{if(I)if(typeof I.version=="number"&&I.version!==s.version){if(s.migrate)return[!0,s.migrate(I.state,I.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,I.state];return[!1,void 0]}).then(I=>{var z;const[O,V]=I;if(b=s.merge(V,(z=n())!=null?z:_),r(b,!0),O)return g()}).then(()=>{P==null||P(b,void 0),b=n(),u=!0,d.forEach(I=>I(b))}).catch(I=>{P==null||P(void 0,I)})};return i.persist={setOptions:A=>{s={...s,...A},A.storage&&(p=A.storage)},clearStorage:()=>{p==null||p.removeItem(s.name)},getOptions:()=>s,rehydrate:()=>k(),hasHydrated:()=>u,onHydrate:A=>(a.add(A),()=>{a.delete(A)}),onFinishHydration:A=>(d.add(A),()=>{d.delete(A)})},s.skipHydration||k(),b||_},BH=(e,t)=>"getStorage"in t||"serialize"in t||"deserialize"in t?((NH?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),RH(e,t)):LH(e,t),OH=BH,FH="http://localhost:8091";async function Ka(e,t,r){const n=ma(),i={"Content-Type":"application/json"};n&&(i.Authorization=`Bearer ${n}`);const s=`${FH}${t}`,u={method:e,headers:i};r&&(e==="POST"||e==="PUT")&&(u.body=JSON.stringify(r));const a=await fetch(s,u);if(!a.ok){const p=await a.text();throw new Error(`HTTP ${a.status}: ${p||a.statusText}`)}return{data:await a.json()}}function Dv(e){return{steps:e.steps.map(r=>{var s;let n;["geoip","whois","virustotal","reverse_geocode","keyword_match","http_get","http_post"].includes(r.type)?n="enrich":r.type==="output"?n="attach_note":n=r.type||r.kind||"enrich";const i={kind:n,actionId:["geoip","whois","virustotal","reverse_geocode","keyword_match","http_get","http_post"].includes(r.type)?r.type:void 0,stepId:r.id||r.stepId,onError:r.onFail==="stop"?"fail":r.onFail==="continue"?"continue":r.onError||"continue",config:r.params||r.config||{},next:r.next||[],name:r.name};return n==="attach_note"&&(i.text=((s=r.params)==null?void 0:s.text)||r.text||r.name||"Enrichment summary attached by playbook"),i}),version:e.version||"1.0.0",entry:e.entry}}const Ac=ls()(OH((e,t)=>({items:[],versions:[],selection:[],isDirty:!1,load:async r=>{try{const n=r?{status:r}:{},i=r?`?status=${r}`:"",s=await Ka("GET",`/playbooks${i}`);e({items:s.data})}catch(n){lr(`Failed to load playbooks: ${n.message}`),console.error("Failed to load playbooks:",n)}},open:async r=>{var n,i,s,u;try{const d=(await Ka("GET",`/playbooks/${r}`)).data,g=(((n=d.jsonBody)==null?void 0:n.steps)||d.steps||[]).map(b=>{const k={id:b.stepId||b.id||`step-${Date.now()}-${Math.random()}`,type:b.actionId||b.kind||b.type,name:b.name||b.stepId,params:b.config||b.params||{},onFail:b.onError==="fail"?"stop":"continue",next:b.next||[]};return b.kind==="attach_note"&&b.text&&(k.params={...k.params,text:b.text}),k}),v={...d,jsonBody:{steps:g,version:((i=d.jsonBody)==null?void 0:i.version)||d.version||"1.0.0",entry:((s=d.jsonBody)==null?void 0:s.entry)||((u=g[0])==null?void 0:u.id)}};e({current:v,isDirty:!1});const _=await Ka("GET",`/playbooks/${r}/versions`);e({versions:_.data})}catch(a){lr(`Failed to open playbook: ${a.message}`),console.error("Failed to open playbook:",a)}},createDraft:async r=>{try{const n=r.jsonBody||{steps:[],version:"1.0.0"},i=Dv(n),s={name:r.name||"Untitled Playbook",description:r.description,jsonBody:i,status:"draft"},u=await Ka("POST","/playbooks",s);return await t().load("draft"),lr("Draft created"),u.data}catch(n){throw lr(`Failed to create draft: ${n.message}`),n}},update:async(r,n)=>{var i,s,u,a;try{const d={};n.name!==void 0&&(d.name=n.name),n.description!==void 0&&(d.description=n.description),n.status!==void 0&&(d.status=n.status),n.releaseNotes!==void 0&&(d.releaseNotes=n.releaseNotes),n.jsonBody!==void 0&&(d.jsonBody=Dv(n.jsonBody));const g=(await Ka("PUT",`/playbooks/${r}`,d)).data,_=(((i=g.jsonBody)==null?void 0:i.steps)||g.steps||[]).map(k=>({id:k.stepId||k.id||`step-${Date.now()}-${Math.random()}`,type:k.actionId||k.kind||k.type,name:k.name||k.stepId,params:k.config||k.params||{},onFail:k.onError==="fail"?"stop":"continue",next:k.next||[]})),b={...g,jsonBody:{steps:_,version:((s=g.jsonBody)==null?void 0:s.version)||g.version||"1.0.0",entry:((u=g.jsonBody)==null?void 0:u.entry)||((a=_[0])==null?void 0:a.id)}};e({current:b,isDirty:!1}),lr("Playbook updated")}catch(d){throw lr(`Failed to update playbook: ${d.message}`),d}},del:async r=>{try{await Ka("DELETE",`/playbooks/${r}`),e({current:void 0}),await t().load(),lr("Playbook deleted")}catch(n){throw lr(`Failed to delete playbook: ${n.message}`),n}},validate:async r=>{try{const n=Dv(r),i=await Ka("POST","/playbooks/validate",{jsonBody:n});return{isValid:i.data.isValid,warnings:i.data.warnings||[],errors:i.data.error?[i.data.error]:[]}}catch(n){return{isValid:!1,errors:[n.message]}}},testRun:async r=>{try{const n=Dv(r),i=await Ka("POST","/playbooks/test-run",{jsonBody:n});return{logs:i.data.steps||[],success:i.data.status==="success"}}catch{return{logs:[],success:!1}}},listVersions:async r=>{try{const n=await Ka("GET",`/playbooks/${r}/versions`);e({versions:n.data})}catch(n){console.error("Failed to list versions:",n)}},rollback:async(r,n)=>{try{const i=await Ka("POST",`/playbooks/${r}/rollback/${n}`);e({current:i.data,isDirty:!1}),await t().listVersions(r),lr(`Rolled back to version ${n}`)}catch(i){throw lr(`Failed to rollback: ${i.message}`),i}},aiGenerate:async r=>{try{return(await Ka("POST","/playbooks/ai/generate",{prompt:r})).data.playbook}catch(n){throw lr(`AI generation failed: ${n.message}`),n}},aiExplain:async r=>{try{return(await Ka("POST","/playbooks/ai/explain",{step:r})).data.explanation}catch(n){throw new Error(`AI explanation failed: ${n.message}`)}},setCurrentJson:r=>{const n=t().current;if(!n)return;const i={...n,jsonBody:r(n.jsonBody)};e({current:i,isDirty:!0})},setSelection:r=>e({selection:r}),markDirty:r=>e({isDirty:r})}),{name:"playbooks"}));function ki(e){if(typeof e=="string"||typeof e=="number")return""+e;let t="";if(Array.isArray(e))for(let r=0,n;r<e.length;r++)(n=ki(e[r]))!==""&&(t+=(t&&" ")+n);else for(let r in e)e[r]&&(t+=(t&&" ")+r);return t}const{useDebugValue:jH}=Qe,{useSyncExternalStoreWithSelector:$H}=SN,VH=e=>e;function BR(e,t=VH,r){const n=$H(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,r);return jH(n),n}const WI=(e,t)=>{const r=yN(e),n=(i,s=t)=>BR(r,i,s);return Object.assign(n,r),n},UH=(e,t)=>e?WI(e,t):WI;function pi(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[n,i]of e)if(!Object.is(i,t.get(n)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}const r=Object.keys(e);if(r.length!==Object.keys(t).length)return!1;for(const n of r)if(!Object.prototype.hasOwnProperty.call(t,n)||!Object.is(e[n],t[n]))return!1;return!0}var qH={value:()=>{}};function nx(){for(var e=0,t=arguments.length,r={},n;e<t;++e){if(!(n=arguments[e]+"")||n in r||/[\s.]/.test(n))throw new Error("illegal type: "+n);r[n]=[]}return new py(r)}function py(e){this._=e}function HH(e,t){return e.trim().split(/^|\s+/).map(function(r){var n="",i=r.indexOf(".");if(i>=0&&(n=r.slice(i+1),r=r.slice(0,i)),r&&!t.hasOwnProperty(r))throw new Error("unknown type: "+r);return{type:r,name:n}})}py.prototype=nx.prototype={constructor:py,on:function(e,t){var r=this._,n=HH(e+"",r),i,s=-1,u=n.length;if(arguments.length<2){for(;++s<u;)if((i=(e=n[s]).type)&&(i=GH(r[i],e.name)))return i;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++s<u;)if(i=(e=n[s]).type)r[i]=ZI(r[i],e.name,t);else if(t==null)for(i in r)r[i]=ZI(r[i],e.name,null);return this},copy:function(){var e={},t=this._;for(var r in t)e[r]=t[r].slice();return new py(e)},call:function(e,t){if((i=arguments.length-2)>0)for(var r=new Array(i),n=0,i,s;n<i;++n)r[n]=arguments[n+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(s=this._[e],n=0,i=s.length;n<i;++n)s[n].value.apply(t,r)},apply:function(e,t,r){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var n=this._[e],i=0,s=n.length;i<s;++i)n[i].value.apply(t,r)}};function GH(e,t){for(var r=0,n=e.length,i;r<n;++r)if((i=e[r]).name===t)return i.value}function ZI(e,t,r){for(var n=0,i=e.length;n<i;++n)if(e[n].name===t){e[n]=qH,e=e.slice(0,n).concat(e.slice(n+1));break}return r!=null&&e.push({name:t,value:r}),e}var a2="http://www.w3.org/1999/xhtml";const XI={svg:"http://www.w3.org/2000/svg",xhtml:a2,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function ix(e){var t=e+="",r=t.indexOf(":");return r>=0&&(t=e.slice(0,r))!=="xmlns"&&(e=e.slice(r+1)),XI.hasOwnProperty(t)?{space:XI[t],local:e}:e}function WH(e){return function(){var t=this.ownerDocument,r=this.namespaceURI;return r===a2&&t.documentElement.namespaceURI===a2?t.createElement(e):t.createElementNS(r,e)}}function ZH(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function OR(e){var t=ix(e);return(t.local?ZH:WH)(t)}function XH(){}function ZS(e){return e==null?XH:function(){return this.querySelector(e)}}function KH(e){typeof e!="function"&&(e=ZS(e));for(var t=this._groups,r=t.length,n=new Array(r),i=0;i<r;++i)for(var s=t[i],u=s.length,a=n[i]=new Array(u),d,p,g=0;g<u;++g)(d=s[g])&&(p=e.call(d,d.__data__,g,s))&&("__data__"in d&&(p.__data__=d.__data__),a[g]=p);return new Oa(n,this._parents)}function YH(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function JH(){return[]}function FR(e){return e==null?JH:function(){return this.querySelectorAll(e)}}function QH(e){return function(){return YH(e.apply(this,arguments))}}function e9(e){typeof e=="function"?e=QH(e):e=FR(e);for(var t=this._groups,r=t.length,n=[],i=[],s=0;s<r;++s)for(var u=t[s],a=u.length,d,p=0;p<a;++p)(d=u[p])&&(n.push(e.call(d,d.__data__,p,u)),i.push(d));return new Oa(n,i)}function jR(e){return function(){return this.matches(e)}}function $R(e){return function(t){return t.matches(e)}}var t9=Array.prototype.find;function r9(e){return function(){return t9.call(this.children,e)}}function n9(){return this.firstElementChild}function i9(e){return this.select(e==null?n9:r9(typeof e=="function"?e:$R(e)))}var a9=Array.prototype.filter;function s9(){return Array.from(this.children)}function o9(e){return function(){return a9.call(this.children,e)}}function l9(e){return this.selectAll(e==null?s9:o9(typeof e=="function"?e:$R(e)))}function u9(e){typeof e!="function"&&(e=jR(e));for(var t=this._groups,r=t.length,n=new Array(r),i=0;i<r;++i)for(var s=t[i],u=s.length,a=n[i]=[],d,p=0;p<u;++p)(d=s[p])&&e.call(d,d.__data__,p,s)&&a.push(d);return new Oa(n,this._parents)}function VR(e){return new Array(e.length)}function c9(){return new Oa(this._enter||this._groups.map(VR),this._parents)}function i0(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}i0.prototype={constructor:i0,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function h9(e){return function(){return e}}function d9(e,t,r,n,i,s){for(var u=0,a,d=t.length,p=s.length;u<p;++u)(a=t[u])?(a.__data__=s[u],n[u]=a):r[u]=new i0(e,s[u]);for(;u<d;++u)(a=t[u])&&(i[u]=a)}function f9(e,t,r,n,i,s,u){var a,d,p=new Map,g=t.length,v=s.length,_=new Array(g),b;for(a=0;a<g;++a)(d=t[a])&&(_[a]=b=u.call(d,d.__data__,a,t)+"",p.has(b)?i[a]=d:p.set(b,d));for(a=0;a<v;++a)b=u.call(e,s[a],a,s)+"",(d=p.get(b))?(n[a]=d,d.__data__=s[a],p.delete(b)):r[a]=new i0(e,s[a]);for(a=0;a<g;++a)(d=t[a])&&p.get(_[a])===d&&(i[a]=d)}function p9(e){return e.__data__}function m9(e,t){if(!arguments.length)return Array.from(this,p9);var r=t?f9:d9,n=this._parents,i=this._groups;typeof e!="function"&&(e=h9(e));for(var s=i.length,u=new Array(s),a=new Array(s),d=new Array(s),p=0;p<s;++p){var g=n[p],v=i[p],_=v.length,b=g9(e.call(g,g&&g.__data__,p,n)),k=b.length,A=a[p]=new Array(k),M=u[p]=new Array(k),P=d[p]=new Array(_);r(g,v,A,M,P,b,t);for(var I=0,z=0,O,V;I<k;++I)if(O=A[I]){for(I>=z&&(z=I+1);!(V=M[z])&&++z<k;);O._next=V||null}}return u=new Oa(u,n),u._enter=a,u._exit=d,u}function g9(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function v9(){return new Oa(this._exit||this._groups.map(VR),this._parents)}function y9(e,t,r){var n=this.enter(),i=this,s=this.exit();return typeof e=="function"?(n=e(n),n&&(n=n.selection())):n=n.append(e+""),t!=null&&(i=t(i),i&&(i=i.selection())),r==null?s.remove():r(s),n&&i?n.merge(i).order():i}function x9(e){for(var t=e.selection?e.selection():e,r=this._groups,n=t._groups,i=r.length,s=n.length,u=Math.min(i,s),a=new Array(i),d=0;d<u;++d)for(var p=r[d],g=n[d],v=p.length,_=a[d]=new Array(v),b,k=0;k<v;++k)(b=p[k]||g[k])&&(_[k]=b);for(;d<i;++d)a[d]=r[d];return new Oa(a,this._parents)}function _9(){for(var e=this._groups,t=-1,r=e.length;++t<r;)for(var n=e[t],i=n.length-1,s=n[i],u;--i>=0;)(u=n[i])&&(s&&u.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(u,s),s=u);return this}function w9(e){e||(e=b9);function t(v,_){return v&&_?e(v.__data__,_.__data__):!v-!_}for(var r=this._groups,n=r.length,i=new Array(n),s=0;s<n;++s){for(var u=r[s],a=u.length,d=i[s]=new Array(a),p,g=0;g<a;++g)(p=u[g])&&(d[g]=p);d.sort(t)}return new Oa(i,this._parents).order()}function b9(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function S9(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function E9(){return Array.from(this)}function T9(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var n=e[t],i=0,s=n.length;i<s;++i){var u=n[i];if(u)return u}return null}function C9(){let e=0;for(const t of this)++e;return e}function k9(){return!this.node()}function P9(e){for(var t=this._groups,r=0,n=t.length;r<n;++r)for(var i=t[r],s=0,u=i.length,a;s<u;++s)(a=i[s])&&e.call(a,a.__data__,s,i);return this}function I9(e){return function(){this.removeAttribute(e)}}function A9(e){return function(){this.removeAttributeNS(e.space,e.local)}}function M9(e,t){return function(){this.setAttribute(e,t)}}function D9(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function N9(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttribute(e):this.setAttribute(e,r)}}function z9(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,r)}}function R9(e,t){var r=ix(e);if(arguments.length<2){var n=this.node();return r.local?n.getAttributeNS(r.space,r.local):n.getAttribute(r)}return this.each((t==null?r.local?A9:I9:typeof t=="function"?r.local?z9:N9:r.local?D9:M9)(r,t))}function UR(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function L9(e){return function(){this.style.removeProperty(e)}}function B9(e,t,r){return function(){this.style.setProperty(e,t,r)}}function O9(e,t,r){return function(){var n=t.apply(this,arguments);n==null?this.style.removeProperty(e):this.style.setProperty(e,n,r)}}function F9(e,t,r){return arguments.length>1?this.each((t==null?L9:typeof t=="function"?O9:B9)(e,t,r??"")):Pd(this.node(),e)}function Pd(e,t){return e.style.getPropertyValue(t)||UR(e).getComputedStyle(e,null).getPropertyValue(t)}function j9(e){return function(){delete this[e]}}function $9(e,t){return function(){this[e]=t}}function V9(e,t){return function(){var r=t.apply(this,arguments);r==null?delete this[e]:this[e]=r}}function U9(e,t){return arguments.length>1?this.each((t==null?j9:typeof t=="function"?V9:$9)(e,t)):this.node()[e]}function qR(e){return e.trim().split(/^|\s+/)}function XS(e){return e.classList||new HR(e)}function HR(e){this._node=e,this._names=qR(e.getAttribute("class")||"")}HR.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function GR(e,t){for(var r=XS(e),n=-1,i=t.length;++n<i;)r.add(t[n])}function WR(e,t){for(var r=XS(e),n=-1,i=t.length;++n<i;)r.remove(t[n])}function q9(e){return function(){GR(this,e)}}function H9(e){return function(){WR(this,e)}}function G9(e,t){return function(){(t.apply(this,arguments)?GR:WR)(this,e)}}function W9(e,t){var r=qR(e+"");if(arguments.length<2){for(var n=XS(this.node()),i=-1,s=r.length;++i<s;)if(!n.contains(r[i]))return!1;return!0}return this.each((typeof t=="function"?G9:t?q9:H9)(r,t))}function Z9(){this.textContent=""}function X9(e){return function(){this.textContent=e}}function K9(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function Y9(e){return arguments.length?this.each(e==null?Z9:(typeof e=="function"?K9:X9)(e)):this.node().textContent}function J9(){this.innerHTML=""}function Q9(e){return function(){this.innerHTML=e}}function e7(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function t7(e){return arguments.length?this.each(e==null?J9:(typeof e=="function"?e7:Q9)(e)):this.node().innerHTML}function r7(){this.nextSibling&&this.parentNode.appendChild(this)}function n7(){return this.each(r7)}function i7(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function a7(){return this.each(i7)}function s7(e){var t=typeof e=="function"?e:OR(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function o7(){return null}function l7(e,t){var r=typeof e=="function"?e:OR(e),n=t==null?o7:typeof t=="function"?t:ZS(t);return this.select(function(){return this.insertBefore(r.apply(this,arguments),n.apply(this,arguments)||null)})}function u7(){var e=this.parentNode;e&&e.removeChild(this)}function c7(){return this.each(u7)}function h7(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function d7(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function f7(e){return this.select(e?d7:h7)}function p7(e){return arguments.length?this.property("__data__",e):this.node().__data__}function m7(e){return function(t){e.call(this,t,this.__data__)}}function g7(e){return e.trim().split(/^|\s+/).map(function(t){var r="",n=t.indexOf(".");return n>=0&&(r=t.slice(n+1),t=t.slice(0,n)),{type:t,name:r}})}function v7(e){return function(){var t=this.__on;if(t){for(var r=0,n=-1,i=t.length,s;r<i;++r)s=t[r],(!e.type||s.type===e.type)&&s.name===e.name?this.removeEventListener(s.type,s.listener,s.options):t[++n]=s;++n?t.length=n:delete this.__on}}}function y7(e,t,r){return function(){var n=this.__on,i,s=m7(t);if(n){for(var u=0,a=n.length;u<a;++u)if((i=n[u]).type===e.type&&i.name===e.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=s,i.options=r),i.value=t;return}}this.addEventListener(e.type,s,r),i={type:e.type,name:e.name,value:t,listener:s,options:r},n?n.push(i):this.__on=[i]}}function x7(e,t,r){var n=g7(e+""),i,s=n.length,u;if(arguments.length<2){var a=this.node().__on;if(a){for(var d=0,p=a.length,g;d<p;++d)for(i=0,g=a[d];i<s;++i)if((u=n[i]).type===g.type&&u.name===g.name)return g.value}return}for(a=t?y7:v7,i=0;i<s;++i)this.each(a(n[i],t,r));return this}function ZR(e,t,r){var n=UR(e),i=n.CustomEvent;typeof i=="function"?i=new i(t,r):(i=n.document.createEvent("Event"),r?(i.initEvent(t,r.bubbles,r.cancelable),i.detail=r.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function _7(e,t){return function(){return ZR(this,e,t)}}function w7(e,t){return function(){return ZR(this,e,t.apply(this,arguments))}}function b7(e,t){return this.each((typeof t=="function"?w7:_7)(e,t))}function*S7(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var n=e[t],i=0,s=n.length,u;i<s;++i)(u=n[i])&&(yield u)}var XR=[null];function Oa(e,t){this._groups=e,this._parents=t}function Zm(){return new Oa([[document.documentElement]],XR)}function E7(){return this}Oa.prototype=Zm.prototype={constructor:Oa,select:KH,selectAll:e9,selectChild:i9,selectChildren:l9,filter:u9,data:m9,enter:c9,exit:v9,join:y9,merge:x9,selection:E7,order:_9,sort:w9,call:S9,nodes:E9,node:T9,size:C9,empty:k9,each:P9,attr:R9,style:F9,property:U9,classed:W9,text:Y9,html:t7,raise:n7,lower:a7,append:s7,insert:l7,remove:c7,clone:f7,datum:p7,on:x7,dispatch:b7,[Symbol.iterator]:S7};function ts(e){return typeof e=="string"?new Oa([[document.querySelector(e)]],[document.documentElement]):new Oa([[e]],XR)}function T7(e){let t;for(;t=e.sourceEvent;)e=t;return e}function ws(e,t){if(e=T7(e),t===void 0&&(t=e.currentTarget),t){var r=t.ownerSVGElement||t;if(r.createSVGPoint){var n=r.createSVGPoint();return n.x=e.clientX,n.y=e.clientY,n=n.matrixTransform(t.getScreenCTM().inverse()),[n.x,n.y]}if(t.getBoundingClientRect){var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]}}return[e.pageX,e.pageY]}const C7={passive:!1},_m={capture:!0,passive:!1};function Mb(e){e.stopImmediatePropagation()}function pd(e){e.preventDefault(),e.stopImmediatePropagation()}function KR(e){var t=e.document.documentElement,r=ts(e).on("dragstart.drag",pd,_m);"onselectstart"in t?r.on("selectstart.drag",pd,_m):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function YR(e,t){var r=e.document.documentElement,n=ts(e).on("dragstart.drag",null);t&&(n.on("click.drag",pd,_m),setTimeout(function(){n.on("click.drag",null)},0)),"onselectstart"in r?n.on("selectstart.drag",null):(r.style.MozUserSelect=r.__noselect,delete r.__noselect)}const Nv=e=>()=>e;function s2(e,{sourceEvent:t,subject:r,target:n,identifier:i,active:s,x:u,y:a,dx:d,dy:p,dispatch:g}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:r,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:u,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:d,enumerable:!0,configurable:!0},dy:{value:p,enumerable:!0,configurable:!0},_:{value:g}})}s2.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function k7(e){return!e.ctrlKey&&!e.button}function P7(){return this.parentNode}function I7(e,t){return t??{x:e.x,y:e.y}}function A7(){return navigator.maxTouchPoints||"ontouchstart"in this}function M7(){var e=k7,t=P7,r=I7,n=A7,i={},s=nx("start","drag","end"),u=0,a,d,p,g,v=0;function _(O){O.on("mousedown.drag",b).filter(n).on("touchstart.drag",M).on("touchmove.drag",P,C7).on("touchend.drag touchcancel.drag",I).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function b(O,V){if(!(g||!e.call(this,O,V))){var U=z(this,t.call(this,O,V),O,V,"mouse");U&&(ts(O.view).on("mousemove.drag",k,_m).on("mouseup.drag",A,_m),KR(O.view),Mb(O),p=!1,a=O.clientX,d=O.clientY,U("start",O))}}function k(O){if(pd(O),!p){var V=O.clientX-a,U=O.clientY-d;p=V*V+U*U>v}i.mouse("drag",O)}function A(O){ts(O.view).on("mousemove.drag mouseup.drag",null),YR(O.view,p),pd(O),i.mouse("end",O)}function M(O,V){if(e.call(this,O,V)){var U=O.changedTouches,$=t.call(this,O,V),G=U.length,Z,Q;for(Z=0;Z<G;++Z)(Q=z(this,$,O,V,U[Z].identifier,U[Z]))&&(Mb(O),Q("start",O,U[Z]))}}function P(O){var V=O.changedTouches,U=V.length,$,G;for($=0;$<U;++$)(G=i[V[$].identifier])&&(pd(O),G("drag",O,V[$]))}function I(O){var V=O.changedTouches,U=V.length,$,G;for(g&&clearTimeout(g),g=setTimeout(function(){g=null},500),$=0;$<U;++$)(G=i[V[$].identifier])&&(Mb(O),G("end",O,V[$]))}function z(O,V,U,$,G,Z){var Q=s.copy(),X=ws(Z||U,V),ie,te,W;if((W=r.call(O,new s2("beforestart",{sourceEvent:U,target:_,identifier:G,active:u,x:X[0],y:X[1],dx:0,dy:0,dispatch:Q}),$))!=null)return ie=W.x-X[0]||0,te=W.y-X[1]||0,function oe(se,de,me){var ae=X,ve;switch(se){case"start":i[G]=oe,ve=u++;break;case"end":delete i[G],--u;case"drag":X=ws(me||de,V),ve=u;break}Q.call(se,O,new s2(se,{sourceEvent:de,subject:W,target:_,identifier:G,active:ve,x:X[0]+ie,y:X[1]+te,dx:X[0]-ae[0],dy:X[1]-ae[1],dispatch:Q}),$)}}return _.filter=function(O){return arguments.length?(e=typeof O=="function"?O:Nv(!!O),_):e},_.container=function(O){return arguments.length?(t=typeof O=="function"?O:Nv(O),_):t},_.subject=function(O){return arguments.length?(r=typeof O=="function"?O:Nv(O),_):r},_.touchable=function(O){return arguments.length?(n=typeof O=="function"?O:Nv(!!O),_):n},_.on=function(){var O=s.on.apply(s,arguments);return O===s?_:O},_.clickDistance=function(O){return arguments.length?(v=(O=+O)*O,_):Math.sqrt(v)},_}function KS(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function JR(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function Xm(){}var wm=.7,a0=1/wm,md="\\s*([+-]?\\d+)\\s*",bm="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Xs="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",D7=/^#([0-9a-f]{3,8})$/,N7=new RegExp(`^rgb\\(${md},${md},${md}\\)$`),z7=new RegExp(`^rgb\\(${Xs},${Xs},${Xs}\\)$`),R7=new RegExp(`^rgba\\(${md},${md},${md},${bm}\\)$`),L7=new RegExp(`^rgba\\(${Xs},${Xs},${Xs},${bm}\\)$`),B7=new RegExp(`^hsl\\(${bm},${Xs},${Xs}\\)$`),O7=new RegExp(`^hsla\\(${bm},${Xs},${Xs},${bm}\\)$`),KI={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};KS(Xm,Sm,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:YI,formatHex:YI,formatHex8:F7,formatHsl:j7,formatRgb:JI,toString:JI});function YI(){return this.rgb().formatHex()}function F7(){return this.rgb().formatHex8()}function j7(){return QR(this).formatHsl()}function JI(){return this.rgb().formatRgb()}function Sm(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=D7.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?QI(t):r===3?new ya(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?zv(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?zv(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=N7.exec(e))?new ya(t[1],t[2],t[3],1):(t=z7.exec(e))?new ya(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=R7.exec(e))?zv(t[1],t[2],t[3],t[4]):(t=L7.exec(e))?zv(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=B7.exec(e))?rA(t[1],t[2]/100,t[3]/100,1):(t=O7.exec(e))?rA(t[1],t[2]/100,t[3]/100,t[4]):KI.hasOwnProperty(e)?QI(KI[e]):e==="transparent"?new ya(NaN,NaN,NaN,0):null}function QI(e){return new ya(e>>16&255,e>>8&255,e&255,1)}function zv(e,t,r,n){return n<=0&&(e=t=r=NaN),new ya(e,t,r,n)}function $7(e){return e instanceof Xm||(e=Sm(e)),e?(e=e.rgb(),new ya(e.r,e.g,e.b,e.opacity)):new ya}function o2(e,t,r,n){return arguments.length===1?$7(e):new ya(e,t,r,n??1)}function ya(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}KS(ya,o2,JR(Xm,{brighter(e){return e=e==null?a0:Math.pow(a0,e),new ya(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?wm:Math.pow(wm,e),new ya(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new ya(uc(this.r),uc(this.g),uc(this.b),s0(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:eA,formatHex:eA,formatHex8:V7,formatRgb:tA,toString:tA}));function eA(){return`#${nc(this.r)}${nc(this.g)}${nc(this.b)}`}function V7(){return`#${nc(this.r)}${nc(this.g)}${nc(this.b)}${nc((isNaN(this.opacity)?1:this.opacity)*255)}`}function tA(){const e=s0(this.opacity);return`${e===1?"rgb(":"rgba("}${uc(this.r)}, ${uc(this.g)}, ${uc(this.b)}${e===1?")":`, ${e})`}`}function s0(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function uc(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function nc(e){return e=uc(e),(e<16?"0":"")+e.toString(16)}function rA(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new Ss(e,t,r,n)}function QR(e){if(e instanceof Ss)return new Ss(e.h,e.s,e.l,e.opacity);if(e instanceof Xm||(e=Sm(e)),!e)return new Ss;if(e instanceof Ss)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,i=Math.min(t,r,n),s=Math.max(t,r,n),u=NaN,a=s-i,d=(s+i)/2;return a?(t===s?u=(r-n)/a+(r<n)*6:r===s?u=(n-t)/a+2:u=(t-r)/a+4,a/=d<.5?s+i:2-s-i,u*=60):a=d>0&&d<1?0:u,new Ss(u,a,d,e.opacity)}function U7(e,t,r,n){return arguments.length===1?QR(e):new Ss(e,t,r,n??1)}function Ss(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}KS(Ss,U7,JR(Xm,{brighter(e){return e=e==null?a0:Math.pow(a0,e),new Ss(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?wm:Math.pow(wm,e),new Ss(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,i=2*r-n;return new ya(Db(e>=240?e-240:e+120,i,n),Db(e,i,n),Db(e<120?e+240:e-120,i,n),this.opacity)},clamp(){return new Ss(nA(this.h),Rv(this.s),Rv(this.l),s0(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=s0(this.opacity);return`${e===1?"hsl(":"hsla("}${nA(this.h)}, ${Rv(this.s)*100}%, ${Rv(this.l)*100}%${e===1?")":`, ${e})`}`}}));function nA(e){return e=(e||0)%360,e<0?e+360:e}function Rv(e){return Math.max(0,Math.min(1,e||0))}function Db(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}const eL=e=>()=>e;function q7(e,t){return function(r){return e+r*t}}function H7(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function G7(e){return(e=+e)==1?tL:function(t,r){return r-t?H7(t,r,e):eL(isNaN(t)?r:t)}}function tL(e,t){var r=t-e;return r?q7(e,r):eL(isNaN(e)?t:e)}const iA=function e(t){var r=G7(t);function n(i,s){var u=r((i=o2(i)).r,(s=o2(s)).r),a=r(i.g,s.g),d=r(i.b,s.b),p=tL(i.opacity,s.opacity);return function(g){return i.r=u(g),i.g=a(g),i.b=d(g),i.opacity=p(g),i+""}}return n.gamma=e,n}(1);function Ml(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}var l2=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Nb=new RegExp(l2.source,"g");function W7(e){return function(){return e}}function Z7(e){return function(t){return e(t)+""}}function X7(e,t){var r=l2.lastIndex=Nb.lastIndex=0,n,i,s,u=-1,a=[],d=[];for(e=e+"",t=t+"";(n=l2.exec(e))&&(i=Nb.exec(t));)(s=i.index)>r&&(s=t.slice(r,s),a[u]?a[u]+=s:a[++u]=s),(n=n[0])===(i=i[0])?a[u]?a[u]+=i:a[++u]=i:(a[++u]=null,d.push({i:u,x:Ml(n,i)})),r=Nb.lastIndex;return r<t.length&&(s=t.slice(r),a[u]?a[u]+=s:a[++u]=s),a.length<2?d[0]?Z7(d[0].x):W7(t):(t=d.length,function(p){for(var g=0,v;g<t;++g)a[(v=d[g]).i]=v.x(p);return a.join("")})}var aA=180/Math.PI,u2={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function rL(e,t,r,n,i,s){var u,a,d;return(u=Math.sqrt(e*e+t*t))&&(e/=u,t/=u),(d=e*r+t*n)&&(r-=e*d,n-=t*d),(a=Math.sqrt(r*r+n*n))&&(r/=a,n/=a,d/=a),e*n<t*r&&(e=-e,t=-t,d=-d,u=-u),{translateX:i,translateY:s,rotate:Math.atan2(t,e)*aA,skewX:Math.atan(d)*aA,scaleX:u,scaleY:a}}var Lv;function K7(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?u2:rL(t.a,t.b,t.c,t.d,t.e,t.f)}function Y7(e){return e==null||(Lv||(Lv=document.createElementNS("http://www.w3.org/2000/svg","g")),Lv.setAttribute("transform",e),!(e=Lv.transform.baseVal.consolidate()))?u2:(e=e.matrix,rL(e.a,e.b,e.c,e.d,e.e,e.f))}function nL(e,t,r,n){function i(p){return p.length?p.pop()+" ":""}function s(p,g,v,_,b,k){if(p!==v||g!==_){var A=b.push("translate(",null,t,null,r);k.push({i:A-4,x:Ml(p,v)},{i:A-2,x:Ml(g,_)})}else(v||_)&&b.push("translate("+v+t+_+r)}function u(p,g,v,_){p!==g?(p-g>180?g+=360:g-p>180&&(p+=360),_.push({i:v.push(i(v)+"rotate(",null,n)-2,x:Ml(p,g)})):g&&v.push(i(v)+"rotate("+g+n)}function a(p,g,v,_){p!==g?_.push({i:v.push(i(v)+"skewX(",null,n)-2,x:Ml(p,g)}):g&&v.push(i(v)+"skewX("+g+n)}function d(p,g,v,_,b,k){if(p!==v||g!==_){var A=b.push(i(b)+"scale(",null,",",null,")");k.push({i:A-4,x:Ml(p,v)},{i:A-2,x:Ml(g,_)})}else(v!==1||_!==1)&&b.push(i(b)+"scale("+v+","+_+")")}return function(p,g){var v=[],_=[];return p=e(p),g=e(g),s(p.translateX,p.translateY,g.translateX,g.translateY,v,_),u(p.rotate,g.rotate,v,_),a(p.skewX,g.skewX,v,_),d(p.scaleX,p.scaleY,g.scaleX,g.scaleY,v,_),p=g=null,function(b){for(var k=-1,A=_.length,M;++k<A;)v[(M=_[k]).i]=M.x(b);return v.join("")}}}var J7=nL(K7,"px, ","px)","deg)"),Q7=nL(Y7,", ",")",")"),eG=1e-12;function sA(e){return((e=Math.exp(e))+1/e)/2}function tG(e){return((e=Math.exp(e))-1/e)/2}function rG(e){return((e=Math.exp(2*e))-1)/(e+1)}const nG=function e(t,r,n){function i(s,u){var a=s[0],d=s[1],p=s[2],g=u[0],v=u[1],_=u[2],b=g-a,k=v-d,A=b*b+k*k,M,P;if(A<eG)P=Math.log(_/p)/t,M=function($){return[a+$*b,d+$*k,p*Math.exp(t*$*P)]};else{var I=Math.sqrt(A),z=(_*_-p*p+n*A)/(2*p*r*I),O=(_*_-p*p-n*A)/(2*_*r*I),V=Math.log(Math.sqrt(z*z+1)-z),U=Math.log(Math.sqrt(O*O+1)-O);P=(U-V)/t,M=function($){var G=$*P,Z=sA(V),Q=p/(r*I)*(Z*rG(t*G+V)-tG(V));return[a+Q*b,d+Q*k,p*Z/sA(t*G+V)]}}return M.duration=P*1e3*t/Math.SQRT2,M}return i.rho=function(s){var u=Math.max(.001,+s),a=u*u,d=a*a;return e(u,a,d)},i}(Math.SQRT2,2,4);var Id=0,Ep=0,dp=0,iL=1e3,o0,Tp,l0=0,bc=0,ax=0,Em=typeof performance=="object"&&performance.now?performance:Date,aL=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function YS(){return bc||(aL(iG),bc=Em.now()+ax)}function iG(){bc=0}function u0(){this._call=this._time=this._next=null}u0.prototype=sL.prototype={constructor:u0,restart:function(e,t,r){if(typeof e!="function")throw new TypeError("callback is not a function");r=(r==null?YS():+r)+(t==null?0:+t),!this._next&&Tp!==this&&(Tp?Tp._next=this:o0=this,Tp=this),this._call=e,this._time=r,c2()},stop:function(){this._call&&(this._call=null,this._time=1/0,c2())}};function sL(e,t,r){var n=new u0;return n.restart(e,t,r),n}function aG(){YS(),++Id;for(var e=o0,t;e;)(t=bc-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Id}function oA(){bc=(l0=Em.now())+ax,Id=Ep=0;try{aG()}finally{Id=0,oG(),bc=0}}function sG(){var e=Em.now(),t=e-l0;t>iL&&(ax-=t,l0=e)}function oG(){for(var e,t=o0,r,n=1/0;t;)t._call?(n>t._time&&(n=t._time),e=t,t=t._next):(r=t._next,t._next=null,t=e?e._next=r:o0=r);Tp=e,c2(n)}function c2(e){if(!Id){Ep&&(Ep=clearTimeout(Ep));var t=e-bc;t>24?(e<1/0&&(Ep=setTimeout(oA,e-Em.now()-ax)),dp&&(dp=clearInterval(dp))):(dp||(l0=Em.now(),dp=setInterval(sG,iL)),Id=1,aL(oA))}}function lA(e,t,r){var n=new u0;return t=t==null?0:+t,n.restart(i=>{n.stop(),e(i+t)},t,r),n}var lG=nx("start","end","cancel","interrupt"),uG=[],oL=0,uA=1,h2=2,my=3,cA=4,d2=5,gy=6;function sx(e,t,r,n,i,s){var u=e.__transition;if(!u)e.__transition={};else if(r in u)return;cG(e,r,{name:t,index:n,group:i,on:lG,tween:uG,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:oL})}function JS(e,t){var r=As(e,t);if(r.state>oL)throw new Error("too late; already scheduled");return r}function eo(e,t){var r=As(e,t);if(r.state>my)throw new Error("too late; already running");return r}function As(e,t){var r=e.__transition;if(!r||!(r=r[t]))throw new Error("transition not found");return r}function cG(e,t,r){var n=e.__transition,i;n[t]=r,r.timer=sL(s,0,r.time);function s(p){r.state=uA,r.timer.restart(u,r.delay,r.time),r.delay<=p&&u(p-r.delay)}function u(p){var g,v,_,b;if(r.state!==uA)return d();for(g in n)if(b=n[g],b.name===r.name){if(b.state===my)return lA(u);b.state===cA?(b.state=gy,b.timer.stop(),b.on.call("interrupt",e,e.__data__,b.index,b.group),delete n[g]):+g<t&&(b.state=gy,b.timer.stop(),b.on.call("cancel",e,e.__data__,b.index,b.group),delete n[g])}if(lA(function(){r.state===my&&(r.state=cA,r.timer.restart(a,r.delay,r.time),a(p))}),r.state=h2,r.on.call("start",e,e.__data__,r.index,r.group),r.state===h2){for(r.state=my,i=new Array(_=r.tween.length),g=0,v=-1;g<_;++g)(b=r.tween[g].value.call(e,e.__data__,r.index,r.group))&&(i[++v]=b);i.length=v+1}}function a(p){for(var g=p<r.duration?r.ease.call(null,p/r.duration):(r.timer.restart(d),r.state=d2,1),v=-1,_=i.length;++v<_;)i[v].call(e,g);r.state===d2&&(r.on.call("end",e,e.__data__,r.index,r.group),d())}function d(){r.state=gy,r.timer.stop(),delete n[t];for(var p in n)return;delete e.__transition}}function vy(e,t){var r=e.__transition,n,i,s=!0,u;if(r){t=t==null?null:t+"";for(u in r){if((n=r[u]).name!==t){s=!1;continue}i=n.state>h2&&n.state<d2,n.state=gy,n.timer.stop(),n.on.call(i?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete r[u]}s&&delete e.__transition}}function hG(e){return this.each(function(){vy(this,e)})}function dG(e,t){var r,n;return function(){var i=eo(this,e),s=i.tween;if(s!==r){n=r=s;for(var u=0,a=n.length;u<a;++u)if(n[u].name===t){n=n.slice(),n.splice(u,1);break}}i.tween=n}}function fG(e,t,r){var n,i;if(typeof r!="function")throw new Error;return function(){var s=eo(this,e),u=s.tween;if(u!==n){i=(n=u).slice();for(var a={name:t,value:r},d=0,p=i.length;d<p;++d)if(i[d].name===t){i[d]=a;break}d===p&&i.push(a)}s.tween=i}}function pG(e,t){var r=this._id;if(e+="",arguments.length<2){for(var n=As(this.node(),r).tween,i=0,s=n.length,u;i<s;++i)if((u=n[i]).name===e)return u.value;return null}return this.each((t==null?dG:fG)(r,e,t))}function QS(e,t,r){var n=e._id;return e.each(function(){var i=eo(this,n);(i.value||(i.value={}))[t]=r.apply(this,arguments)}),function(i){return As(i,n).value[t]}}function lL(e,t){var r;return(typeof t=="number"?Ml:t instanceof Sm?iA:(r=Sm(t))?(t=r,iA):X7)(e,t)}function mG(e){return function(){this.removeAttribute(e)}}function gG(e){return function(){this.removeAttributeNS(e.space,e.local)}}function vG(e,t,r){var n,i=r+"",s;return function(){var u=this.getAttribute(e);return u===i?null:u===n?s:s=t(n=u,r)}}function yG(e,t,r){var n,i=r+"",s;return function(){var u=this.getAttributeNS(e.space,e.local);return u===i?null:u===n?s:s=t(n=u,r)}}function xG(e,t,r){var n,i,s;return function(){var u,a=r(this),d;return a==null?void this.removeAttribute(e):(u=this.getAttribute(e),d=a+"",u===d?null:u===n&&d===i?s:(i=d,s=t(n=u,a)))}}function _G(e,t,r){var n,i,s;return function(){var u,a=r(this),d;return a==null?void this.removeAttributeNS(e.space,e.local):(u=this.getAttributeNS(e.space,e.local),d=a+"",u===d?null:u===n&&d===i?s:(i=d,s=t(n=u,a)))}}function wG(e,t){var r=ix(e),n=r==="transform"?Q7:lL;return this.attrTween(e,typeof t=="function"?(r.local?_G:xG)(r,n,QS(this,"attr."+e,t)):t==null?(r.local?gG:mG)(r):(r.local?yG:vG)(r,n,t))}function bG(e,t){return function(r){this.setAttribute(e,t.call(this,r))}}function SG(e,t){return function(r){this.setAttributeNS(e.space,e.local,t.call(this,r))}}function EG(e,t){var r,n;function i(){var s=t.apply(this,arguments);return s!==n&&(r=(n=s)&&SG(e,s)),r}return i._value=t,i}function TG(e,t){var r,n;function i(){var s=t.apply(this,arguments);return s!==n&&(r=(n=s)&&bG(e,s)),r}return i._value=t,i}function CG(e,t){var r="attr."+e;if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;var n=ix(e);return this.tween(r,(n.local?EG:TG)(n,t))}function kG(e,t){return function(){JS(this,e).delay=+t.apply(this,arguments)}}function PG(e,t){return t=+t,function(){JS(this,e).delay=t}}function IG(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?kG:PG)(t,e)):As(this.node(),t).delay}function AG(e,t){return function(){eo(this,e).duration=+t.apply(this,arguments)}}function MG(e,t){return t=+t,function(){eo(this,e).duration=t}}function DG(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?AG:MG)(t,e)):As(this.node(),t).duration}function NG(e,t){if(typeof t!="function")throw new Error;return function(){eo(this,e).ease=t}}function zG(e){var t=this._id;return arguments.length?this.each(NG(t,e)):As(this.node(),t).ease}function RG(e,t){return function(){var r=t.apply(this,arguments);if(typeof r!="function")throw new Error;eo(this,e).ease=r}}function LG(e){if(typeof e!="function")throw new Error;return this.each(RG(this._id,e))}function BG(e){typeof e!="function"&&(e=jR(e));for(var t=this._groups,r=t.length,n=new Array(r),i=0;i<r;++i)for(var s=t[i],u=s.length,a=n[i]=[],d,p=0;p<u;++p)(d=s[p])&&e.call(d,d.__data__,p,s)&&a.push(d);return new Fo(n,this._parents,this._name,this._id)}function OG(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,r=e._groups,n=t.length,i=r.length,s=Math.min(n,i),u=new Array(n),a=0;a<s;++a)for(var d=t[a],p=r[a],g=d.length,v=u[a]=new Array(g),_,b=0;b<g;++b)(_=d[b]||p[b])&&(v[b]=_);for(;a<n;++a)u[a]=t[a];return new Fo(u,this._parents,this._name,this._id)}function FG(e){return(e+"").trim().split(/^|\s+/).every(function(t){var r=t.indexOf(".");return r>=0&&(t=t.slice(0,r)),!t||t==="start"})}function jG(e,t,r){var n,i,s=FG(t)?JS:eo;return function(){var u=s(this,e),a=u.on;a!==n&&(i=(n=a).copy()).on(t,r),u.on=i}}function $G(e,t){var r=this._id;return arguments.length<2?As(this.node(),r).on.on(e):this.each(jG(r,e,t))}function VG(e){return function(){var t=this.parentNode;for(var r in this.__transition)if(+r!==e)return;t&&t.removeChild(this)}}function UG(){return this.on("end.remove",VG(this._id))}function qG(e){var t=this._name,r=this._id;typeof e!="function"&&(e=ZS(e));for(var n=this._groups,i=n.length,s=new Array(i),u=0;u<i;++u)for(var a=n[u],d=a.length,p=s[u]=new Array(d),g,v,_=0;_<d;++_)(g=a[_])&&(v=e.call(g,g.__data__,_,a))&&("__data__"in g&&(v.__data__=g.__data__),p[_]=v,sx(p[_],t,r,_,p,As(g,r)));return new Fo(s,this._parents,t,r)}function HG(e){var t=this._name,r=this._id;typeof e!="function"&&(e=FR(e));for(var n=this._groups,i=n.length,s=[],u=[],a=0;a<i;++a)for(var d=n[a],p=d.length,g,v=0;v<p;++v)if(g=d[v]){for(var _=e.call(g,g.__data__,v,d),b,k=As(g,r),A=0,M=_.length;A<M;++A)(b=_[A])&&sx(b,t,r,A,_,k);s.push(_),u.push(g)}return new Fo(s,u,t,r)}var GG=Zm.prototype.constructor;function WG(){return new GG(this._groups,this._parents)}function ZG(e,t){var r,n,i;return function(){var s=Pd(this,e),u=(this.style.removeProperty(e),Pd(this,e));return s===u?null:s===r&&u===n?i:i=t(r=s,n=u)}}function uL(e){return function(){this.style.removeProperty(e)}}function XG(e,t,r){var n,i=r+"",s;return function(){var u=Pd(this,e);return u===i?null:u===n?s:s=t(n=u,r)}}function KG(e,t,r){var n,i,s;return function(){var u=Pd(this,e),a=r(this),d=a+"";return a==null&&(d=a=(this.style.removeProperty(e),Pd(this,e))),u===d?null:u===n&&d===i?s:(i=d,s=t(n=u,a))}}function YG(e,t){var r,n,i,s="style."+t,u="end."+s,a;return function(){var d=eo(this,e),p=d.on,g=d.value[s]==null?a||(a=uL(t)):void 0;(p!==r||i!==g)&&(n=(r=p).copy()).on(u,i=g),d.on=n}}function JG(e,t,r){var n=(e+="")=="transform"?J7:lL;return t==null?this.styleTween(e,ZG(e,n)).on("end.style."+e,uL(e)):typeof t=="function"?this.styleTween(e,KG(e,n,QS(this,"style."+e,t))).each(YG(this._id,e)):this.styleTween(e,XG(e,n,t),r).on("end.style."+e,null)}function QG(e,t,r){return function(n){this.style.setProperty(e,t.call(this,n),r)}}function eW(e,t,r){var n,i;function s(){var u=t.apply(this,arguments);return u!==i&&(n=(i=u)&&QG(e,u,r)),n}return s._value=t,s}function tW(e,t,r){var n="style."+(e+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;return this.tween(n,eW(e,t,r??""))}function rW(e){return function(){this.textContent=e}}function nW(e){return function(){var t=e(this);this.textContent=t??""}}function iW(e){return this.tween("text",typeof e=="function"?nW(QS(this,"text",e)):rW(e==null?"":e+""))}function aW(e){return function(t){this.textContent=e.call(this,t)}}function sW(e){var t,r;function n(){var i=e.apply(this,arguments);return i!==r&&(t=(r=i)&&aW(i)),t}return n._value=e,n}function oW(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,sW(e))}function lW(){for(var e=this._name,t=this._id,r=cL(),n=this._groups,i=n.length,s=0;s<i;++s)for(var u=n[s],a=u.length,d,p=0;p<a;++p)if(d=u[p]){var g=As(d,t);sx(d,e,r,p,u,{time:g.time+g.delay+g.duration,delay:0,duration:g.duration,ease:g.ease})}return new Fo(n,this._parents,e,r)}function uW(){var e,t,r=this,n=r._id,i=r.size();return new Promise(function(s,u){var a={value:u},d={value:function(){--i===0&&s()}};r.each(function(){var p=eo(this,n),g=p.on;g!==e&&(t=(e=g).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(d)),p.on=t}),i===0&&s()})}var cW=0;function Fo(e,t,r,n){this._groups=e,this._parents=t,this._name=r,this._id=n}function cL(){return++cW}var bo=Zm.prototype;Fo.prototype={constructor:Fo,select:qG,selectAll:HG,selectChild:bo.selectChild,selectChildren:bo.selectChildren,filter:BG,merge:OG,selection:WG,transition:lW,call:bo.call,nodes:bo.nodes,node:bo.node,size:bo.size,empty:bo.empty,each:bo.each,on:$G,attr:wG,attrTween:CG,style:JG,styleTween:tW,text:iW,textTween:oW,remove:UG,tween:pG,delay:IG,duration:DG,ease:zG,easeVarying:LG,end:uW,[Symbol.iterator]:bo[Symbol.iterator]};function hW(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var dW={time:null,delay:0,duration:250,ease:hW};function fW(e,t){for(var r;!(r=e.__transition)||!(r=r[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return r}function pW(e){var t,r;e instanceof Fo?(t=e._id,e=e._name):(t=cL(),(r=dW).time=YS(),e=e==null?null:e+"");for(var n=this._groups,i=n.length,s=0;s<i;++s)for(var u=n[s],a=u.length,d,p=0;p<a;++p)(d=u[p])&&sx(d,e,t,p,u,r||fW(d,t));return new Fo(n,this._parents,e,t)}Zm.prototype.interrupt=hG;Zm.prototype.transition=pW;const Bv=e=>()=>e;function mW(e,{sourceEvent:t,target:r,transform:n,dispatch:i}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},transform:{value:n,enumerable:!0,configurable:!0},_:{value:i}})}function Ao(e,t,r){this.k=e,this.x=t,this.y=r}Ao.prototype={constructor:Ao,scale:function(e){return e===1?this:new Ao(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new Ao(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Do=new Ao(1,0,0);Ao.prototype;function zb(e){e.stopImmediatePropagation()}function fp(e){e.preventDefault(),e.stopImmediatePropagation()}function gW(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function vW(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function hA(){return this.__zoom||Do}function yW(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function xW(){return navigator.maxTouchPoints||"ontouchstart"in this}function _W(e,t,r){var n=e.invertX(t[0][0])-r[0][0],i=e.invertX(t[1][0])-r[1][0],s=e.invertY(t[0][1])-r[0][1],u=e.invertY(t[1][1])-r[1][1];return e.translate(i>n?(n+i)/2:Math.min(0,n)||Math.max(0,i),u>s?(s+u)/2:Math.min(0,s)||Math.max(0,u))}function hL(){var e=gW,t=vW,r=_W,n=yW,i=xW,s=[0,1/0],u=[[-1/0,-1/0],[1/0,1/0]],a=250,d=nG,p=nx("start","zoom","end"),g,v,_,b=500,k=150,A=0,M=10;function P(W){W.property("__zoom",hA).on("wheel.zoom",G,{passive:!1}).on("mousedown.zoom",Z).on("dblclick.zoom",Q).filter(i).on("touchstart.zoom",X).on("touchmove.zoom",ie).on("touchend.zoom touchcancel.zoom",te).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}P.transform=function(W,oe,se,de){var me=W.selection?W.selection():W;me.property("__zoom",hA),W!==me?V(W,oe,se,de):me.interrupt().each(function(){U(this,arguments).event(de).start().zoom(null,typeof oe=="function"?oe.apply(this,arguments):oe).end()})},P.scaleBy=function(W,oe,se,de){P.scaleTo(W,function(){var me=this.__zoom.k,ae=typeof oe=="function"?oe.apply(this,arguments):oe;return me*ae},se,de)},P.scaleTo=function(W,oe,se,de){P.transform(W,function(){var me=t.apply(this,arguments),ae=this.__zoom,ve=se==null?O(me):typeof se=="function"?se.apply(this,arguments):se,pe=ae.invert(ve),_e=typeof oe=="function"?oe.apply(this,arguments):oe;return r(z(I(ae,_e),ve,pe),me,u)},se,de)},P.translateBy=function(W,oe,se,de){P.transform(W,function(){return r(this.__zoom.translate(typeof oe=="function"?oe.apply(this,arguments):oe,typeof se=="function"?se.apply(this,arguments):se),t.apply(this,arguments),u)},null,de)},P.translateTo=function(W,oe,se,de,me){P.transform(W,function(){var ae=t.apply(this,arguments),ve=this.__zoom,pe=de==null?O(ae):typeof de=="function"?de.apply(this,arguments):de;return r(Do.translate(pe[0],pe[1]).scale(ve.k).translate(typeof oe=="function"?-oe.apply(this,arguments):-oe,typeof se=="function"?-se.apply(this,arguments):-se),ae,u)},de,me)};function I(W,oe){return oe=Math.max(s[0],Math.min(s[1],oe)),oe===W.k?W:new Ao(oe,W.x,W.y)}function z(W,oe,se){var de=oe[0]-se[0]*W.k,me=oe[1]-se[1]*W.k;return de===W.x&&me===W.y?W:new Ao(W.k,de,me)}function O(W){return[(+W[0][0]+ +W[1][0])/2,(+W[0][1]+ +W[1][1])/2]}function V(W,oe,se,de){W.on("start.zoom",function(){U(this,arguments).event(de).start()}).on("interrupt.zoom end.zoom",function(){U(this,arguments).event(de).end()}).tween("zoom",function(){var me=this,ae=arguments,ve=U(me,ae).event(de),pe=t.apply(me,ae),_e=se==null?O(pe):typeof se=="function"?se.apply(me,ae):se,De=Math.max(pe[1][0]-pe[0][0],pe[1][1]-pe[0][1]),Le=me.__zoom,je=typeof oe=="function"?oe.apply(me,ae):oe,Je=d(Le.invert(_e).concat(De/Le.k),je.invert(_e).concat(De/je.k));return function(et){if(et===1)et=je;else{var ft=Je(et),rt=De/ft[2];et=new Ao(rt,_e[0]-ft[0]*rt,_e[1]-ft[1]*rt)}ve.zoom(null,et)}})}function U(W,oe,se){return!se&&W.__zooming||new $(W,oe)}function $(W,oe){this.that=W,this.args=oe,this.active=0,this.sourceEvent=null,this.extent=t.apply(W,oe),this.taps=0}$.prototype={event:function(W){return W&&(this.sourceEvent=W),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(W,oe){return this.mouse&&W!=="mouse"&&(this.mouse[1]=oe.invert(this.mouse[0])),this.touch0&&W!=="touch"&&(this.touch0[1]=oe.invert(this.touch0[0])),this.touch1&&W!=="touch"&&(this.touch1[1]=oe.invert(this.touch1[0])),this.that.__zoom=oe,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(W){var oe=ts(this.that).datum();p.call(W,this.that,new mW(W,{sourceEvent:this.sourceEvent,target:P,transform:this.that.__zoom,dispatch:p}),oe)}};function G(W,...oe){if(!e.apply(this,arguments))return;var se=U(this,oe).event(W),de=this.__zoom,me=Math.max(s[0],Math.min(s[1],de.k*Math.pow(2,n.apply(this,arguments)))),ae=ws(W);if(se.wheel)(se.mouse[0][0]!==ae[0]||se.mouse[0][1]!==ae[1])&&(se.mouse[1]=de.invert(se.mouse[0]=ae)),clearTimeout(se.wheel);else{if(de.k===me)return;se.mouse=[ae,de.invert(ae)],vy(this),se.start()}fp(W),se.wheel=setTimeout(ve,k),se.zoom("mouse",r(z(I(de,me),se.mouse[0],se.mouse[1]),se.extent,u));function ve(){se.wheel=null,se.end()}}function Z(W,...oe){if(_||!e.apply(this,arguments))return;var se=W.currentTarget,de=U(this,oe,!0).event(W),me=ts(W.view).on("mousemove.zoom",_e,!0).on("mouseup.zoom",De,!0),ae=ws(W,se),ve=W.clientX,pe=W.clientY;KR(W.view),zb(W),de.mouse=[ae,this.__zoom.invert(ae)],vy(this),de.start();function _e(Le){if(fp(Le),!de.moved){var je=Le.clientX-ve,Je=Le.clientY-pe;de.moved=je*je+Je*Je>A}de.event(Le).zoom("mouse",r(z(de.that.__zoom,de.mouse[0]=ws(Le,se),de.mouse[1]),de.extent,u))}function De(Le){me.on("mousemove.zoom mouseup.zoom",null),YR(Le.view,de.moved),fp(Le),de.event(Le).end()}}function Q(W,...oe){if(e.apply(this,arguments)){var se=this.__zoom,de=ws(W.changedTouches?W.changedTouches[0]:W,this),me=se.invert(de),ae=se.k*(W.shiftKey?.5:2),ve=r(z(I(se,ae),de,me),t.apply(this,oe),u);fp(W),a>0?ts(this).transition().duration(a).call(V,ve,de,W):ts(this).call(P.transform,ve,de,W)}}function X(W,...oe){if(e.apply(this,arguments)){var se=W.touches,de=se.length,me=U(this,oe,W.changedTouches.length===de).event(W),ae,ve,pe,_e;for(zb(W),ve=0;ve<de;++ve)pe=se[ve],_e=ws(pe,this),_e=[_e,this.__zoom.invert(_e),pe.identifier],me.touch0?!me.touch1&&me.touch0[2]!==_e[2]&&(me.touch1=_e,me.taps=0):(me.touch0=_e,ae=!0,me.taps=1+!!g);g&&(g=clearTimeout(g)),ae&&(me.taps<2&&(v=_e[0],g=setTimeout(function(){g=null},b)),vy(this),me.start())}}function ie(W,...oe){if(this.__zooming){var se=U(this,oe).event(W),de=W.changedTouches,me=de.length,ae,ve,pe,_e;for(fp(W),ae=0;ae<me;++ae)ve=de[ae],pe=ws(ve,this),se.touch0&&se.touch0[2]===ve.identifier?se.touch0[0]=pe:se.touch1&&se.touch1[2]===ve.identifier&&(se.touch1[0]=pe);if(ve=se.that.__zoom,se.touch1){var De=se.touch0[0],Le=se.touch0[1],je=se.touch1[0],Je=se.touch1[1],et=(et=je[0]-De[0])*et+(et=je[1]-De[1])*et,ft=(ft=Je[0]-Le[0])*ft+(ft=Je[1]-Le[1])*ft;ve=I(ve,Math.sqrt(et/ft)),pe=[(De[0]+je[0])/2,(De[1]+je[1])/2],_e=[(Le[0]+Je[0])/2,(Le[1]+Je[1])/2]}else if(se.touch0)pe=se.touch0[0],_e=se.touch0[1];else return;se.zoom("touch",r(z(ve,pe,_e),se.extent,u))}}function te(W,...oe){if(this.__zooming){var se=U(this,oe).event(W),de=W.changedTouches,me=de.length,ae,ve;for(zb(W),_&&clearTimeout(_),_=setTimeout(function(){_=null},b),ae=0;ae<me;++ae)ve=de[ae],se.touch0&&se.touch0[2]===ve.identifier?delete se.touch0:se.touch1&&se.touch1[2]===ve.identifier&&delete se.touch1;if(se.touch1&&!se.touch0&&(se.touch0=se.touch1,delete se.touch1),se.touch0)se.touch0[1]=this.__zoom.invert(se.touch0[0]);else if(se.end(),se.taps===2&&(ve=ws(ve,this),Math.hypot(v[0]-ve[0],v[1]-ve[1])<M)){var pe=ts(this).on("dblclick.zoom");pe&&pe.apply(this,arguments)}}}return P.wheelDelta=function(W){return arguments.length?(n=typeof W=="function"?W:Bv(+W),P):n},P.filter=function(W){return arguments.length?(e=typeof W=="function"?W:Bv(!!W),P):e},P.touchable=function(W){return arguments.length?(i=typeof W=="function"?W:Bv(!!W),P):i},P.extent=function(W){return arguments.length?(t=typeof W=="function"?W:Bv([[+W[0][0],+W[0][1]],[+W[1][0],+W[1][1]]]),P):t},P.scaleExtent=function(W){return arguments.length?(s[0]=+W[0],s[1]=+W[1],P):[s[0],s[1]]},P.translateExtent=function(W){return arguments.length?(u[0][0]=+W[0][0],u[1][0]=+W[1][0],u[0][1]=+W[0][1],u[1][1]=+W[1][1],P):[[u[0][0],u[0][1]],[u[1][0],u[1][1]]]},P.constrain=function(W){return arguments.length?(r=W,P):r},P.duration=function(W){return arguments.length?(a=+W,P):a},P.interpolate=function(W){return arguments.length?(d=W,P):d},P.on=function(){var W=p.on.apply(p,arguments);return W===p?P:W},P.clickDistance=function(W){return arguments.length?(A=(W=+W)*W,P):Math.sqrt(A)},P.tapDistance=function(W){return arguments.length?(M=+W,P):M},P}const ox=ce.createContext(null),wW=ox.Provider,jo={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,t)=>`Couldn't create edge for ${e?"target":"source"} handle id: "${e?t.targetHandle:t.sourceHandle}", edge id: ${t.id}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`},dL=jo.error001();function un(e,t){const r=ce.useContext(ox);if(r===null)throw new Error(dL);return BR(r,e,t)}const ei=()=>{const e=ce.useContext(ox);if(e===null)throw new Error(dL);return ce.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe,destroy:e.destroy}),[e])},bW=e=>e.userSelectionActive?"none":"all";function eE({position:e,children:t,className:r,style:n,...i}){const s=un(bW),u=`${e}`.split("-");return Qe.createElement("div",{className:ki(["react-flow__panel",r,...u]),style:{...n,pointerEvents:s},...i},t)}function SW({proOptions:e,position:t="bottom-right"}){return e!=null&&e.hideAttribution?null:Qe.createElement(eE,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://reactflow.dev/pro"},Qe.createElement("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution"},"React Flow"))}const EW=({x:e,y:t,label:r,labelStyle:n={},labelShowBg:i=!0,labelBgStyle:s={},labelBgPadding:u=[2,4],labelBgBorderRadius:a=2,children:d,className:p,...g})=>{const v=ce.useRef(null),[_,b]=ce.useState({x:0,y:0,width:0,height:0}),k=ki(["react-flow__edge-textwrapper",p]);return ce.useEffect(()=>{if(v.current){const A=v.current.getBBox();b({x:A.x,y:A.y,width:A.width,height:A.height})}},[r]),typeof r>"u"||!r?null:Qe.createElement("g",{transform:`translate(${e-_.width/2} ${t-_.height/2})`,className:k,visibility:_.width?"visible":"hidden",...g},i&&Qe.createElement("rect",{width:_.width+2*u[0],x:-u[0],y:-u[1],height:_.height+2*u[1],className:"react-flow__edge-textbg",style:s,rx:a,ry:a}),Qe.createElement("text",{className:"react-flow__edge-text",y:_.height/2,dy:"0.3em",ref:v,style:n},r),d)};var TW=ce.memo(EW);const tE=e=>({width:e.offsetWidth,height:e.offsetHeight}),Ad=(e,t=0,r=1)=>Math.min(Math.max(e,t),r),rE=(e={x:0,y:0},t)=>({x:Ad(e.x,t[0][0],t[1][0]),y:Ad(e.y,t[0][1],t[1][1])}),dA=(e,t,r)=>e<t?Ad(Math.abs(e-t),1,50)/50:e>r?-Ad(Math.abs(e-r),1,50)/50:0,fL=(e,t)=>{const r=dA(e.x,35,t.width-35)*20,n=dA(e.y,35,t.height-35)*20;return[r,n]},pL=e=>{var t;return((t=e.getRootNode)==null?void 0:t.call(e))||(window==null?void 0:window.document)},mL=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),Tm=({x:e,y:t,width:r,height:n})=>({x:e,y:t,x2:e+r,y2:t+n}),gL=({x:e,y:t,x2:r,y2:n})=>({x:e,y:t,width:r-e,height:n-t}),fA=e=>({...e.positionAbsolute||{x:0,y:0},width:e.width||0,height:e.height||0}),CW=(e,t)=>gL(mL(Tm(e),Tm(t))),f2=(e,t)=>{const r=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),n=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(r*n)},kW=e=>is(e.width)&&is(e.height)&&is(e.x)&&is(e.y),is=e=>!isNaN(e)&&isFinite(e),Mn=Symbol.for("internals"),vL=["Enter"," ","Escape"],PW=(e,t)=>{},IW=e=>"nativeEvent"in e;function p2(e){var i,s;const t=IW(e)?e.nativeEvent:e,r=((s=(i=t.composedPath)==null?void 0:i.call(t))==null?void 0:s[0])||e.target;return["INPUT","SELECT","TEXTAREA"].includes(r==null?void 0:r.nodeName)||(r==null?void 0:r.hasAttribute("contenteditable"))||!!(r!=null&&r.closest(".nokey"))}const yL=e=>"clientX"in e,Jl=(e,t)=>{var s,u;const r=yL(e),n=r?e.clientX:(s=e.touches)==null?void 0:s[0].clientX,i=r?e.clientY:(u=e.touches)==null?void 0:u[0].clientY;return{x:n-((t==null?void 0:t.left)??0),y:i-((t==null?void 0:t.top)??0)}},c0=()=>{var e;return typeof navigator<"u"&&((e=navigator==null?void 0:navigator.userAgent)==null?void 0:e.indexOf("Mac"))>=0},Km=({id:e,path:t,labelX:r,labelY:n,label:i,labelStyle:s,labelShowBg:u,labelBgStyle:a,labelBgPadding:d,labelBgBorderRadius:p,style:g,markerEnd:v,markerStart:_,interactionWidth:b=20})=>Qe.createElement(Qe.Fragment,null,Qe.createElement("path",{id:e,style:g,d:t,fill:"none",className:"react-flow__edge-path",markerEnd:v,markerStart:_}),b&&Qe.createElement("path",{d:t,fill:"none",strokeOpacity:0,strokeWidth:b,className:"react-flow__edge-interaction"}),i&&is(r)&&is(n)?Qe.createElement(TW,{x:r,y:n,label:i,labelStyle:s,labelShowBg:u,labelBgStyle:a,labelBgPadding:d,labelBgBorderRadius:p}):null);Km.displayName="BaseEdge";function pp(e,t,r){return r===void 0?r:n=>{const i=t().edges.find(s=>s.id===e);i&&r(n,{...i})}}function xL({sourceX:e,sourceY:t,targetX:r,targetY:n}){const i=Math.abs(r-e)/2,s=r<e?r+i:r-i,u=Math.abs(n-t)/2,a=n<t?n+u:n-u;return[s,a,i,u]}function _L({sourceX:e,sourceY:t,targetX:r,targetY:n,sourceControlX:i,sourceControlY:s,targetControlX:u,targetControlY:a}){const d=e*.125+i*.375+u*.375+r*.125,p=t*.125+s*.375+a*.375+n*.125,g=Math.abs(d-e),v=Math.abs(p-t);return[d,p,g,v]}var Sc;(function(e){e.Strict="strict",e.Loose="loose"})(Sc||(Sc={}));var ic;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(ic||(ic={}));var Cm;(function(e){e.Partial="partial",e.Full="full"})(Cm||(Cm={}));var Rl;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(Rl||(Rl={}));var h0;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(h0||(h0={}));var or;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(or||(or={}));function pA({pos:e,x1:t,y1:r,x2:n,y2:i}){return e===or.Left||e===or.Right?[.5*(t+n),r]:[t,.5*(r+i)]}function wL({sourceX:e,sourceY:t,sourcePosition:r=or.Bottom,targetX:n,targetY:i,targetPosition:s=or.Top}){const[u,a]=pA({pos:r,x1:e,y1:t,x2:n,y2:i}),[d,p]=pA({pos:s,x1:n,y1:i,x2:e,y2:t}),[g,v,_,b]=_L({sourceX:e,sourceY:t,targetX:n,targetY:i,sourceControlX:u,sourceControlY:a,targetControlX:d,targetControlY:p});return[`M${e},${t} C${u},${a} ${d},${p} ${n},${i}`,g,v,_,b]}const nE=ce.memo(({sourceX:e,sourceY:t,targetX:r,targetY:n,sourcePosition:i=or.Bottom,targetPosition:s=or.Top,label:u,labelStyle:a,labelShowBg:d,labelBgStyle:p,labelBgPadding:g,labelBgBorderRadius:v,style:_,markerEnd:b,markerStart:k,interactionWidth:A})=>{const[M,P,I]=wL({sourceX:e,sourceY:t,sourcePosition:i,targetX:r,targetY:n,targetPosition:s});return Qe.createElement(Km,{path:M,labelX:P,labelY:I,label:u,labelStyle:a,labelShowBg:d,labelBgStyle:p,labelBgPadding:g,labelBgBorderRadius:v,style:_,markerEnd:b,markerStart:k,interactionWidth:A})});nE.displayName="SimpleBezierEdge";const mA={[or.Left]:{x:-1,y:0},[or.Right]:{x:1,y:0},[or.Top]:{x:0,y:-1},[or.Bottom]:{x:0,y:1}},AW=({source:e,sourcePosition:t=or.Bottom,target:r})=>t===or.Left||t===or.Right?e.x<r.x?{x:1,y:0}:{x:-1,y:0}:e.y<r.y?{x:0,y:1}:{x:0,y:-1},gA=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function MW({source:e,sourcePosition:t=or.Bottom,target:r,targetPosition:n=or.Top,center:i,offset:s}){const u=mA[t],a=mA[n],d={x:e.x+u.x*s,y:e.y+u.y*s},p={x:r.x+a.x*s,y:r.y+a.y*s},g=AW({source:d,sourcePosition:t,target:p}),v=g.x!==0?"x":"y",_=g[v];let b=[],k,A;const M={x:0,y:0},P={x:0,y:0},[I,z,O,V]=xL({sourceX:e.x,sourceY:e.y,targetX:r.x,targetY:r.y});if(u[v]*a[v]===-1){k=i.x??I,A=i.y??z;const $=[{x:k,y:d.y},{x:k,y:p.y}],G=[{x:d.x,y:A},{x:p.x,y:A}];u[v]===_?b=v==="x"?$:G:b=v==="x"?G:$}else{const $=[{x:d.x,y:p.y}],G=[{x:p.x,y:d.y}];if(v==="x"?b=u.x===_?G:$:b=u.y===_?$:G,t===n){const te=Math.abs(e[v]-r[v]);if(te<=s){const W=Math.min(s-1,s-te);u[v]===_?M[v]=(d[v]>e[v]?-1:1)*W:P[v]=(p[v]>r[v]?-1:1)*W}}if(t!==n){const te=v==="x"?"y":"x",W=u[v]===a[te],oe=d[te]>p[te],se=d[te]<p[te];(u[v]===1&&(!W&&oe||W&&se)||u[v]!==1&&(!W&&se||W&&oe))&&(b=v==="x"?$:G)}const Z={x:d.x+M.x,y:d.y+M.y},Q={x:p.x+P.x,y:p.y+P.y},X=Math.max(Math.abs(Z.x-b[0].x),Math.abs(Q.x-b[0].x)),ie=Math.max(Math.abs(Z.y-b[0].y),Math.abs(Q.y-b[0].y));X>=ie?(k=(Z.x+Q.x)/2,A=b[0].y):(k=b[0].x,A=(Z.y+Q.y)/2)}return[[e,{x:d.x+M.x,y:d.y+M.y},...b,{x:p.x+P.x,y:p.y+P.y},r],k,A,O,V]}function DW(e,t,r,n){const i=Math.min(gA(e,t)/2,gA(t,r)/2,n),{x:s,y:u}=t;if(e.x===s&&s===r.x||e.y===u&&u===r.y)return`L${s} ${u}`;if(e.y===u){const p=e.x<r.x?-1:1,g=e.y<r.y?1:-1;return`L ${s+i*p},${u}Q ${s},${u} ${s},${u+i*g}`}const a=e.x<r.x?1:-1,d=e.y<r.y?-1:1;return`L ${s},${u+i*d}Q ${s},${u} ${s+i*a},${u}`}function m2({sourceX:e,sourceY:t,sourcePosition:r=or.Bottom,targetX:n,targetY:i,targetPosition:s=or.Top,borderRadius:u=5,centerX:a,centerY:d,offset:p=20}){const[g,v,_,b,k]=MW({source:{x:e,y:t},sourcePosition:r,target:{x:n,y:i},targetPosition:s,center:{x:a,y:d},offset:p});return[g.reduce((M,P,I)=>{let z="";return I>0&&I<g.length-1?z=DW(g[I-1],P,g[I+1],u):z=`${I===0?"M":"L"}${P.x} ${P.y}`,M+=z,M},""),v,_,b,k]}const lx=ce.memo(({sourceX:e,sourceY:t,targetX:r,targetY:n,label:i,labelStyle:s,labelShowBg:u,labelBgStyle:a,labelBgPadding:d,labelBgBorderRadius:p,style:g,sourcePosition:v=or.Bottom,targetPosition:_=or.Top,markerEnd:b,markerStart:k,pathOptions:A,interactionWidth:M})=>{const[P,I,z]=m2({sourceX:e,sourceY:t,sourcePosition:v,targetX:r,targetY:n,targetPosition:_,borderRadius:A==null?void 0:A.borderRadius,offset:A==null?void 0:A.offset});return Qe.createElement(Km,{path:P,labelX:I,labelY:z,label:i,labelStyle:s,labelShowBg:u,labelBgStyle:a,labelBgPadding:d,labelBgBorderRadius:p,style:g,markerEnd:b,markerStart:k,interactionWidth:M})});lx.displayName="SmoothStepEdge";const iE=ce.memo(e=>{var t;return Qe.createElement(lx,{...e,pathOptions:ce.useMemo(()=>{var r;return{borderRadius:0,offset:(r=e.pathOptions)==null?void 0:r.offset}},[(t=e.pathOptions)==null?void 0:t.offset])})});iE.displayName="StepEdge";function NW({sourceX:e,sourceY:t,targetX:r,targetY:n}){const[i,s,u,a]=xL({sourceX:e,sourceY:t,targetX:r,targetY:n});return[`M ${e},${t}L ${r},${n}`,i,s,u,a]}const aE=ce.memo(({sourceX:e,sourceY:t,targetX:r,targetY:n,label:i,labelStyle:s,labelShowBg:u,labelBgStyle:a,labelBgPadding:d,labelBgBorderRadius:p,style:g,markerEnd:v,markerStart:_,interactionWidth:b})=>{const[k,A,M]=NW({sourceX:e,sourceY:t,targetX:r,targetY:n});return Qe.createElement(Km,{path:k,labelX:A,labelY:M,label:i,labelStyle:s,labelShowBg:u,labelBgStyle:a,labelBgPadding:d,labelBgBorderRadius:p,style:g,markerEnd:v,markerStart:_,interactionWidth:b})});aE.displayName="StraightEdge";function Ov(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function vA({pos:e,x1:t,y1:r,x2:n,y2:i,c:s}){switch(e){case or.Left:return[t-Ov(t-n,s),r];case or.Right:return[t+Ov(n-t,s),r];case or.Top:return[t,r-Ov(r-i,s)];case or.Bottom:return[t,r+Ov(i-r,s)]}}function bL({sourceX:e,sourceY:t,sourcePosition:r=or.Bottom,targetX:n,targetY:i,targetPosition:s=or.Top,curvature:u=.25}){const[a,d]=vA({pos:r,x1:e,y1:t,x2:n,y2:i,c:u}),[p,g]=vA({pos:s,x1:n,y1:i,x2:e,y2:t,c:u}),[v,_,b,k]=_L({sourceX:e,sourceY:t,targetX:n,targetY:i,sourceControlX:a,sourceControlY:d,targetControlX:p,targetControlY:g});return[`M${e},${t} C${a},${d} ${p},${g} ${n},${i}`,v,_,b,k]}const d0=ce.memo(({sourceX:e,sourceY:t,targetX:r,targetY:n,sourcePosition:i=or.Bottom,targetPosition:s=or.Top,label:u,labelStyle:a,labelShowBg:d,labelBgStyle:p,labelBgPadding:g,labelBgBorderRadius:v,style:_,markerEnd:b,markerStart:k,pathOptions:A,interactionWidth:M})=>{const[P,I,z]=bL({sourceX:e,sourceY:t,sourcePosition:i,targetX:r,targetY:n,targetPosition:s,curvature:A==null?void 0:A.curvature});return Qe.createElement(Km,{path:P,labelX:I,labelY:z,label:u,labelStyle:a,labelShowBg:d,labelBgStyle:p,labelBgPadding:g,labelBgBorderRadius:v,style:_,markerEnd:b,markerStart:k,interactionWidth:M})});d0.displayName="BezierEdge";const sE=ce.createContext(null),zW=sE.Provider;sE.Consumer;const RW=()=>ce.useContext(sE),LW=e=>"id"in e&&"source"in e&&"target"in e,BW=({source:e,sourceHandle:t,target:r,targetHandle:n})=>`reactflow__edge-${e}${t||""}-${r}${n||""}`,g2=(e,t)=>typeof e>"u"?"":typeof e=="string"?e:`${t?`${t}__`:""}${Object.keys(e).sort().map(n=>`${n}=${e[n]}`).join("&")}`,OW=(e,t)=>t.some(r=>r.source===e.source&&r.target===e.target&&(r.sourceHandle===e.sourceHandle||!r.sourceHandle&&!e.sourceHandle)&&(r.targetHandle===e.targetHandle||!r.targetHandle&&!e.targetHandle)),SL=(e,t)=>{if(!e.source||!e.target)return t;let r;return LW(e)?r={...e}:r={...e,id:BW(e)},OW(r,t)?t:t.concat(r)},v2=({x:e,y:t},[r,n,i],s,[u,a])=>{const d={x:(e-r)/i,y:(t-n)/i};return s?{x:u*Math.round(d.x/u),y:a*Math.round(d.y/a)}:d},EL=({x:e,y:t},[r,n,i])=>({x:e*i+r,y:t*i+n}),cc=(e,t=[0,0])=>{if(!e)return{x:0,y:0,positionAbsolute:{x:0,y:0}};const r=(e.width??0)*t[0],n=(e.height??0)*t[1],i={x:e.position.x-r,y:e.position.y-n};return{...i,positionAbsolute:e.positionAbsolute?{x:e.positionAbsolute.x-r,y:e.positionAbsolute.y-n}:i}},ux=(e,t=[0,0])=>{if(e.length===0)return{x:0,y:0,width:0,height:0};const r=e.reduce((n,i)=>{const{x:s,y:u}=cc(i,t).positionAbsolute;return mL(n,Tm({x:s,y:u,width:i.width||0,height:i.height||0}))},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return gL(r)},TL=(e,t,[r,n,i]=[0,0,1],s=!1,u=!1,a=[0,0])=>{const d={x:(t.x-r)/i,y:(t.y-n)/i,width:t.width/i,height:t.height/i},p=[];return e.forEach(g=>{const{width:v,height:_,selectable:b=!0,hidden:k=!1}=g;if(u&&!b||k)return!1;const{positionAbsolute:A}=cc(g,a),M={x:A.x,y:A.y,width:v||0,height:_||0},P=f2(d,M),I=typeof v>"u"||typeof _>"u"||v===null||_===null,z=s&&P>0,O=(v||0)*(_||0);(I||z||P>=O||g.dragging)&&p.push(g)}),p},CL=(e,t)=>{const r=e.map(n=>n.id);return t.filter(n=>r.includes(n.source)||r.includes(n.target))},kL=(e,t,r,n,i,s=.1)=>{const u=t/(e.width*(1+s)),a=r/(e.height*(1+s)),d=Math.min(u,a),p=Ad(d,n,i),g=e.x+e.width/2,v=e.y+e.height/2,_=t/2-g*p,b=r/2-v*p;return{x:_,y:b,zoom:p}},Xu=(e,t=0)=>e.transition().duration(t);function yA(e,t,r,n){return(t[r]||[]).reduce((i,s)=>{var u,a;return`${e.id}-${s.id}-${r}`!==n&&i.push({id:s.id||null,type:r,nodeId:e.id,x:(((u=e.positionAbsolute)==null?void 0:u.x)??0)+s.x+s.width/2,y:(((a=e.positionAbsolute)==null?void 0:a.y)??0)+s.y+s.height/2}),i},[])}function FW(e,t,r,n,i,s){const{x:u,y:a}=Jl(e),p=t.elementsFromPoint(u,a).find(k=>k.classList.contains("react-flow__handle"));if(p){const k=p.getAttribute("data-nodeid");if(k){const A=oE(void 0,p),M=p.getAttribute("data-handleid"),P=s({nodeId:k,id:M,type:A});if(P){const I=i.find(z=>z.nodeId===k&&z.type===A&&z.id===M);return{handle:{id:M,type:A,nodeId:k,x:(I==null?void 0:I.x)||r.x,y:(I==null?void 0:I.y)||r.y},validHandleResult:P}}}}let g=[],v=1/0;if(i.forEach(k=>{const A=Math.sqrt((k.x-r.x)**2+(k.y-r.y)**2);if(A<=n){const M=s(k);A<=v&&(A<v?g=[{handle:k,validHandleResult:M}]:A===v&&g.push({handle:k,validHandleResult:M}),v=A)}}),!g.length)return{handle:null,validHandleResult:PL()};if(g.length===1)return g[0];const _=g.some(({validHandleResult:k})=>k.isValid),b=g.some(({handle:k})=>k.type==="target");return g.find(({handle:k,validHandleResult:A})=>b?k.type==="target":_?A.isValid:!0)||g[0]}const jW={source:null,target:null,sourceHandle:null,targetHandle:null},PL=()=>({handleDomNode:null,isValid:!1,connection:jW,endHandle:null});function IL(e,t,r,n,i,s,u){const a=i==="target",d=u.querySelector(`.react-flow__handle[data-id="${e==null?void 0:e.nodeId}-${e==null?void 0:e.id}-${e==null?void 0:e.type}"]`),p={...PL(),handleDomNode:d};if(d){const g=oE(void 0,d),v=d.getAttribute("data-nodeid"),_=d.getAttribute("data-handleid"),b=d.classList.contains("connectable"),k=d.classList.contains("connectableend"),A={source:a?v:r,sourceHandle:a?_:n,target:a?r:v,targetHandle:a?n:_};p.connection=A,b&&k&&(t===Sc.Strict?a&&g==="source"||!a&&g==="target":v!==r||_!==n)&&(p.endHandle={nodeId:v,handleId:_,type:g},p.isValid=s(A))}return p}function $W({nodes:e,nodeId:t,handleId:r,handleType:n}){return e.reduce((i,s)=>{if(s[Mn]){const{handleBounds:u}=s[Mn];let a=[],d=[];u&&(a=yA(s,u,"source",`${t}-${r}-${n}`),d=yA(s,u,"target",`${t}-${r}-${n}`)),i.push(...a,...d)}return i},[])}function oE(e,t){return e||(t!=null&&t.classList.contains("target")?"target":t!=null&&t.classList.contains("source")?"source":null)}function Rb(e){e==null||e.classList.remove("valid","connecting","react-flow__handle-valid","react-flow__handle-connecting")}function VW(e,t){let r=null;return t?r="valid":e&&!t&&(r="invalid"),r}function AL({event:e,handleId:t,nodeId:r,onConnect:n,isTarget:i,getState:s,setState:u,isValidConnection:a,edgeUpdaterType:d,onReconnectEnd:p}){const g=pL(e.target),{connectionMode:v,domNode:_,autoPanOnConnect:b,connectionRadius:k,onConnectStart:A,panBy:M,getNodes:P,cancelConnection:I}=s();let z=0,O;const{x:V,y:U}=Jl(e),$=g==null?void 0:g.elementFromPoint(V,U),G=oE(d,$),Z=_==null?void 0:_.getBoundingClientRect();if(!Z||!G)return;let Q,X=Jl(e,Z),ie=!1,te=null,W=!1,oe=null;const se=$W({nodes:P(),nodeId:r,handleId:t,handleType:G}),de=()=>{if(!b)return;const[ve,pe]=fL(X,Z);M({x:ve,y:pe}),z=requestAnimationFrame(de)};u({connectionPosition:X,connectionStatus:null,connectionNodeId:r,connectionHandleId:t,connectionHandleType:G,connectionStartHandle:{nodeId:r,handleId:t,type:G},connectionEndHandle:null}),A==null||A(e,{nodeId:r,handleId:t,handleType:G});function me(ve){const{transform:pe}=s();X=Jl(ve,Z);const{handle:_e,validHandleResult:De}=FW(ve,g,v2(X,pe,!1,[1,1]),k,se,Le=>IL(Le,v,r,t,i?"target":"source",a,g));if(O=_e,ie||(de(),ie=!0),oe=De.handleDomNode,te=De.connection,W=De.isValid,u({connectionPosition:O&&W?EL({x:O.x,y:O.y},pe):X,connectionStatus:VW(!!O,W),connectionEndHandle:De.endHandle}),!O&&!W&&!oe)return Rb(Q);te.source!==te.target&&oe&&(Rb(Q),Q=oe,oe.classList.add("connecting","react-flow__handle-connecting"),oe.classList.toggle("valid",W),oe.classList.toggle("react-flow__handle-valid",W))}function ae(ve){var pe,_e;(O||oe)&&te&&W&&(n==null||n(te)),(_e=(pe=s()).onConnectEnd)==null||_e.call(pe,ve),d&&(p==null||p(ve)),Rb(Q),I(),cancelAnimationFrame(z),ie=!1,W=!1,te=null,oe=null,g.removeEventListener("mousemove",me),g.removeEventListener("mouseup",ae),g.removeEventListener("touchmove",me),g.removeEventListener("touchend",ae)}g.addEventListener("mousemove",me),g.addEventListener("mouseup",ae),g.addEventListener("touchmove",me),g.addEventListener("touchend",ae)}const xA=()=>!0,UW=e=>({connectionStartHandle:e.connectionStartHandle,connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName}),qW=(e,t,r)=>n=>{const{connectionStartHandle:i,connectionEndHandle:s,connectionClickStartHandle:u}=n;return{connecting:(i==null?void 0:i.nodeId)===e&&(i==null?void 0:i.handleId)===t&&(i==null?void 0:i.type)===r||(s==null?void 0:s.nodeId)===e&&(s==null?void 0:s.handleId)===t&&(s==null?void 0:s.type)===r,clickConnecting:(u==null?void 0:u.nodeId)===e&&(u==null?void 0:u.handleId)===t&&(u==null?void 0:u.type)===r}},ML=ce.forwardRef(({type:e="source",position:t=or.Top,isValidConnection:r,isConnectable:n=!0,isConnectableStart:i=!0,isConnectableEnd:s=!0,id:u,onConnect:a,children:d,className:p,onMouseDown:g,onTouchStart:v,..._},b)=>{var Z,Q;const k=u||null,A=e==="target",M=ei(),P=RW(),{connectOnClick:I,noPanClassName:z}=un(UW,pi),{connecting:O,clickConnecting:V}=un(qW(P,k,e),pi);P||(Q=(Z=M.getState()).onError)==null||Q.call(Z,"010",jo.error010());const U=X=>{const{defaultEdgeOptions:ie,onConnect:te,hasDefaultEdges:W}=M.getState(),oe={...ie,...X};if(W){const{edges:se,setEdges:de}=M.getState();de(SL(oe,se))}te==null||te(oe),a==null||a(oe)},$=X=>{if(!P)return;const ie=yL(X);i&&(ie&&X.button===0||!ie)&&AL({event:X,handleId:k,nodeId:P,onConnect:U,isTarget:A,getState:M.getState,setState:M.setState,isValidConnection:r||M.getState().isValidConnection||xA}),ie?g==null||g(X):v==null||v(X)},G=X=>{const{onClickConnectStart:ie,onClickConnectEnd:te,connectionClickStartHandle:W,connectionMode:oe,isValidConnection:se}=M.getState();if(!P||!W&&!i)return;if(!W){ie==null||ie(X,{nodeId:P,handleId:k,handleType:e}),M.setState({connectionClickStartHandle:{nodeId:P,type:e,handleId:k}});return}const de=pL(X.target),me=r||se||xA,{connection:ae,isValid:ve}=IL({nodeId:P,id:k,type:e},oe,W.nodeId,W.handleId||null,W.type,me,de);ve&&U(ae),te==null||te(X),M.setState({connectionClickStartHandle:null})};return Qe.createElement("div",{"data-handleid":k,"data-nodeid":P,"data-handlepos":t,"data-id":`${P}-${k}-${e}`,className:ki(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",z,p,{source:!A,target:A,connectable:n,connectablestart:i,connectableend:s,connecting:V,connectionindicator:n&&(i&&!O||s&&O)}]),onMouseDown:$,onTouchStart:$,onClick:I?G:void 0,ref:b,..._},d)});ML.displayName="Handle";var Md=ce.memo(ML);const DL=({data:e,isConnectable:t,targetPosition:r=or.Top,sourcePosition:n=or.Bottom})=>Qe.createElement(Qe.Fragment,null,Qe.createElement(Md,{type:"target",position:r,isConnectable:t}),e==null?void 0:e.label,Qe.createElement(Md,{type:"source",position:n,isConnectable:t}));DL.displayName="DefaultNode";var y2=ce.memo(DL);const NL=({data:e,isConnectable:t,sourcePosition:r=or.Bottom})=>Qe.createElement(Qe.Fragment,null,e==null?void 0:e.label,Qe.createElement(Md,{type:"source",position:r,isConnectable:t}));NL.displayName="InputNode";var zL=ce.memo(NL);const RL=({data:e,isConnectable:t,targetPosition:r=or.Top})=>Qe.createElement(Qe.Fragment,null,Qe.createElement(Md,{type:"target",position:r,isConnectable:t}),e==null?void 0:e.label);RL.displayName="OutputNode";var LL=ce.memo(RL);const lE=()=>null;lE.displayName="GroupNode";const HW=e=>({selectedNodes:e.getNodes().filter(t=>t.selected),selectedEdges:e.edges.filter(t=>t.selected).map(t=>({...t}))}),Fv=e=>e.id;function GW(e,t){return pi(e.selectedNodes.map(Fv),t.selectedNodes.map(Fv))&&pi(e.selectedEdges.map(Fv),t.selectedEdges.map(Fv))}const BL=ce.memo(({onSelectionChange:e})=>{const t=ei(),{selectedNodes:r,selectedEdges:n}=un(HW,GW);return ce.useEffect(()=>{const i={nodes:r,edges:n};e==null||e(i),t.getState().onSelectionChange.forEach(s=>s(i))},[r,n,e]),null});BL.displayName="SelectionListener";const WW=e=>!!e.onSelectionChange;function ZW({onSelectionChange:e}){const t=un(WW);return e||t?Qe.createElement(BL,{onSelectionChange:e}):null}const XW=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset});function zh(e,t){ce.useEffect(()=>{typeof e<"u"&&t(e)},[e])}function Ir(e,t,r){ce.useEffect(()=>{typeof t<"u"&&r({[e]:t})},[t])}const KW=({nodes:e,edges:t,defaultNodes:r,defaultEdges:n,onConnect:i,onConnectStart:s,onConnectEnd:u,onClickConnectStart:a,onClickConnectEnd:d,nodesDraggable:p,nodesConnectable:g,nodesFocusable:v,edgesFocusable:_,edgesUpdatable:b,elevateNodesOnSelect:k,minZoom:A,maxZoom:M,nodeExtent:P,onNodesChange:I,onEdgesChange:z,elementsSelectable:O,connectionMode:V,snapGrid:U,snapToGrid:$,translateExtent:G,connectOnClick:Z,defaultEdgeOptions:Q,fitView:X,fitViewOptions:ie,onNodesDelete:te,onEdgesDelete:W,onNodeDrag:oe,onNodeDragStart:se,onNodeDragStop:de,onSelectionDrag:me,onSelectionDragStart:ae,onSelectionDragStop:ve,noPanClassName:pe,nodeOrigin:_e,rfId:De,autoPanOnConnect:Le,autoPanOnNodeDrag:je,onError:Je,connectionRadius:et,isValidConnection:ft,nodeDragThreshold:rt})=>{const{setNodes:Oe,setEdges:Ge,setDefaultNodesAndEdges:Ze,setMinZoom:it,setMaxZoom:mt,setTranslateExtent:Tt,setNodeExtent:$e,reset:At}=un(XW,pi),pt=ei();return ce.useEffect(()=>{const yt=n==null?void 0:n.map(gt=>({...gt,...Q}));return Ze(r,yt),()=>{At()}},[]),Ir("defaultEdgeOptions",Q,pt.setState),Ir("connectionMode",V,pt.setState),Ir("onConnect",i,pt.setState),Ir("onConnectStart",s,pt.setState),Ir("onConnectEnd",u,pt.setState),Ir("onClickConnectStart",a,pt.setState),Ir("onClickConnectEnd",d,pt.setState),Ir("nodesDraggable",p,pt.setState),Ir("nodesConnectable",g,pt.setState),Ir("nodesFocusable",v,pt.setState),Ir("edgesFocusable",_,pt.setState),Ir("edgesUpdatable",b,pt.setState),Ir("elementsSelectable",O,pt.setState),Ir("elevateNodesOnSelect",k,pt.setState),Ir("snapToGrid",$,pt.setState),Ir("snapGrid",U,pt.setState),Ir("onNodesChange",I,pt.setState),Ir("onEdgesChange",z,pt.setState),Ir("connectOnClick",Z,pt.setState),Ir("fitViewOnInit",X,pt.setState),Ir("fitViewOnInitOptions",ie,pt.setState),Ir("onNodesDelete",te,pt.setState),Ir("onEdgesDelete",W,pt.setState),Ir("onNodeDrag",oe,pt.setState),Ir("onNodeDragStart",se,pt.setState),Ir("onNodeDragStop",de,pt.setState),Ir("onSelectionDrag",me,pt.setState),Ir("onSelectionDragStart",ae,pt.setState),Ir("onSelectionDragStop",ve,pt.setState),Ir("noPanClassName",pe,pt.setState),Ir("nodeOrigin",_e,pt.setState),Ir("rfId",De,pt.setState),Ir("autoPanOnConnect",Le,pt.setState),Ir("autoPanOnNodeDrag",je,pt.setState),Ir("onError",Je,pt.setState),Ir("connectionRadius",et,pt.setState),Ir("isValidConnection",ft,pt.setState),Ir("nodeDragThreshold",rt,pt.setState),zh(e,Oe),zh(t,Ge),zh(A,it),zh(M,mt),zh(G,Tt),zh(P,$e),null},_A={display:"none"},YW={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},OL="react-flow__node-desc",FL="react-flow__edge-desc",JW="react-flow__aria-live",QW=e=>e.ariaLiveMessage;function eZ({rfId:e}){const t=un(QW);return Qe.createElement("div",{id:`${JW}-${e}`,"aria-live":"assertive","aria-atomic":"true",style:YW},t)}function tZ({rfId:e,disableKeyboardA11y:t}){return Qe.createElement(Qe.Fragment,null,Qe.createElement("div",{id:`${OL}-${e}`,style:_A},"Press enter or space to select a node.",!t&&"You can then use the arrow keys to move the node around."," Press delete to remove it and escape to cancel."," "),Qe.createElement("div",{id:`${FL}-${e}`,style:_A},"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel."),!t&&Qe.createElement(eZ,{rfId:e}))}var km=(e=null,t={actInsideInputWithModifier:!0})=>{const[r,n]=ce.useState(!1),i=ce.useRef(!1),s=ce.useRef(new Set([])),[u,a]=ce.useMemo(()=>{if(e!==null){const p=(Array.isArray(e)?e:[e]).filter(v=>typeof v=="string").map(v=>v.split("+")),g=p.reduce((v,_)=>v.concat(..._),[]);return[p,g]}return[[],[]]},[e]);return ce.useEffect(()=>{const d=typeof document<"u"?document:null,p=(t==null?void 0:t.target)||d;if(e!==null){const g=b=>{if(i.current=b.ctrlKey||b.metaKey||b.shiftKey,(!i.current||i.current&&!t.actInsideInputWithModifier)&&p2(b))return!1;const A=bA(b.code,a);s.current.add(b[A]),wA(u,s.current,!1)&&(b.preventDefault(),n(!0))},v=b=>{if((!i.current||i.current&&!t.actInsideInputWithModifier)&&p2(b))return!1;const A=bA(b.code,a);wA(u,s.current,!0)?(n(!1),s.current.clear()):s.current.delete(b[A]),b.key==="Meta"&&s.current.clear(),i.current=!1},_=()=>{s.current.clear(),n(!1)};return p==null||p.addEventListener("keydown",g),p==null||p.addEventListener("keyup",v),window.addEventListener("blur",_),()=>{p==null||p.removeEventListener("keydown",g),p==null||p.removeEventListener("keyup",v),window.removeEventListener("blur",_)}}},[e,n]),r};function wA(e,t,r){return e.filter(n=>r||n.length===t.size).some(n=>n.every(i=>t.has(i)))}function bA(e,t){return t.includes(e)?"code":"key"}function jL(e,t,r,n){var a,d;const i=e.parentNode||e.parentId;if(!i)return r;const s=t.get(i),u=cc(s,n);return jL(s,t,{x:(r.x??0)+u.x,y:(r.y??0)+u.y,z:(((a=s[Mn])==null?void 0:a.z)??0)>(r.z??0)?((d=s[Mn])==null?void 0:d.z)??0:r.z??0},n)}function $L(e,t,r){e.forEach(n=>{var s;const i=n.parentNode||n.parentId;if(i&&!e.has(i))throw new Error(`Parent node ${i} not found`);if(i||r!=null&&r[n.id]){const{x:u,y:a,z:d}=jL(n,e,{...n.position,z:((s=n[Mn])==null?void 0:s.z)??0},t);n.positionAbsolute={x:u,y:a},n[Mn].z=d,r!=null&&r[n.id]&&(n[Mn].isParent=!0)}})}function Lb(e,t,r,n){const i=new Map,s={},u=n?1e3:0;return e.forEach(a=>{var b;const d=(is(a.zIndex)?a.zIndex:0)+(a.selected?u:0),p=t.get(a.id),g={...a,positionAbsolute:{x:a.position.x,y:a.position.y}},v=a.parentNode||a.parentId;v&&(s[v]=!0);const _=(p==null?void 0:p.type)&&(p==null?void 0:p.type)!==a.type;Object.defineProperty(g,Mn,{enumerable:!1,value:{handleBounds:_||(b=p==null?void 0:p[Mn])==null?void 0:b.handleBounds,z:d}}),i.set(a.id,g)}),$L(i,r,s),i}function VL(e,t={}){const{getNodes:r,width:n,height:i,minZoom:s,maxZoom:u,d3Zoom:a,d3Selection:d,fitViewOnInitDone:p,fitViewOnInit:g,nodeOrigin:v}=e(),_=t.initial&&!p&&g;if(a&&d&&(_||!t.initial)){const k=r().filter(M=>{var I;const P=t.includeHiddenNodes?M.width&&M.height:!M.hidden;return(I=t.nodes)!=null&&I.length?P&&t.nodes.some(z=>z.id===M.id):P}),A=k.every(M=>M.width&&M.height);if(k.length>0&&A){const M=ux(k,v),{x:P,y:I,zoom:z}=kL(M,n,i,t.minZoom??s,t.maxZoom??u,t.padding??.1),O=Do.translate(P,I).scale(z);return typeof t.duration=="number"&&t.duration>0?a.transform(Xu(d,t.duration),O):a.transform(d,O),!0}}return!1}function rZ(e,t){return e.forEach(r=>{const n=t.get(r.id);n&&t.set(n.id,{...n,[Mn]:n[Mn],selected:r.selected})}),new Map(t)}function nZ(e,t){return t.map(r=>{const n=e.find(i=>i.id===r.id);return n&&(r.selected=n.selected),r})}function jv({changedNodes:e,changedEdges:t,get:r,set:n}){const{nodeInternals:i,edges:s,onNodesChange:u,onEdgesChange:a,hasDefaultNodes:d,hasDefaultEdges:p}=r();e!=null&&e.length&&(d&&n({nodeInternals:rZ(e,i)}),u==null||u(e)),t!=null&&t.length&&(p&&n({edges:nZ(t,s)}),a==null||a(t))}const Rh=()=>{},iZ={zoomIn:Rh,zoomOut:Rh,zoomTo:Rh,getZoom:()=>1,setViewport:Rh,getViewport:()=>({x:0,y:0,zoom:1}),fitView:()=>!1,setCenter:Rh,fitBounds:Rh,project:e=>e,screenToFlowPosition:e=>e,flowToScreenPosition:e=>e,viewportInitialized:!1},aZ=e=>({d3Zoom:e.d3Zoom,d3Selection:e.d3Selection}),sZ=()=>{const e=ei(),{d3Zoom:t,d3Selection:r}=un(aZ,pi);return ce.useMemo(()=>r&&t?{zoomIn:i=>t.scaleBy(Xu(r,i==null?void 0:i.duration),1.2),zoomOut:i=>t.scaleBy(Xu(r,i==null?void 0:i.duration),1/1.2),zoomTo:(i,s)=>t.scaleTo(Xu(r,s==null?void 0:s.duration),i),getZoom:()=>e.getState().transform[2],setViewport:(i,s)=>{const[u,a,d]=e.getState().transform,p=Do.translate(i.x??u,i.y??a).scale(i.zoom??d);t.transform(Xu(r,s==null?void 0:s.duration),p)},getViewport:()=>{const[i,s,u]=e.getState().transform;return{x:i,y:s,zoom:u}},fitView:i=>VL(e.getState,i),setCenter:(i,s,u)=>{const{width:a,height:d,maxZoom:p}=e.getState(),g=typeof(u==null?void 0:u.zoom)<"u"?u.zoom:p,v=a/2-i*g,_=d/2-s*g,b=Do.translate(v,_).scale(g);t.transform(Xu(r,u==null?void 0:u.duration),b)},fitBounds:(i,s)=>{const{width:u,height:a,minZoom:d,maxZoom:p}=e.getState(),{x:g,y:v,zoom:_}=kL(i,u,a,d,p,(s==null?void 0:s.padding)??.1),b=Do.translate(g,v).scale(_);t.transform(Xu(r,s==null?void 0:s.duration),b)},project:i=>{const{transform:s,snapToGrid:u,snapGrid:a}=e.getState();return console.warn("[DEPRECATED] `project` is deprecated. Instead use `screenToFlowPosition`. There is no need to subtract the react flow bounds anymore! https://reactflow.dev/api-reference/types/react-flow-instance#screen-to-flow-position"),v2(i,s,u,a)},screenToFlowPosition:i=>{const{transform:s,snapToGrid:u,snapGrid:a,domNode:d}=e.getState();if(!d)return i;const{x:p,y:g}=d.getBoundingClientRect(),v={x:i.x-p,y:i.y-g};return v2(v,s,u,a)},flowToScreenPosition:i=>{const{transform:s,domNode:u}=e.getState();if(!u)return i;const{x:a,y:d}=u.getBoundingClientRect(),p=EL(i,s);return{x:p.x+a,y:p.y+d}},viewportInitialized:!0}:iZ,[t,r])};function uE(){const e=sZ(),t=ei(),r=ce.useCallback(()=>t.getState().getNodes().map(A=>({...A})),[]),n=ce.useCallback(A=>t.getState().nodeInternals.get(A),[]),i=ce.useCallback(()=>{const{edges:A=[]}=t.getState();return A.map(M=>({...M}))},[]),s=ce.useCallback(A=>{const{edges:M=[]}=t.getState();return M.find(P=>P.id===A)},[]),u=ce.useCallback(A=>{const{getNodes:M,setNodes:P,hasDefaultNodes:I,onNodesChange:z}=t.getState(),O=M(),V=typeof A=="function"?A(O):A;if(I)P(V);else if(z){const U=V.length===0?O.map($=>({type:"remove",id:$.id})):V.map($=>({item:$,type:"reset"}));z(U)}},[]),a=ce.useCallback(A=>{const{edges:M=[],setEdges:P,hasDefaultEdges:I,onEdgesChange:z}=t.getState(),O=typeof A=="function"?A(M):A;if(I)P(O);else if(z){const V=O.length===0?M.map(U=>({type:"remove",id:U.id})):O.map(U=>({item:U,type:"reset"}));z(V)}},[]),d=ce.useCallback(A=>{const M=Array.isArray(A)?A:[A],{getNodes:P,setNodes:I,hasDefaultNodes:z,onNodesChange:O}=t.getState();if(z){const U=[...P(),...M];I(U)}else if(O){const V=M.map(U=>({item:U,type:"add"}));O(V)}},[]),p=ce.useCallback(A=>{const M=Array.isArray(A)?A:[A],{edges:P=[],setEdges:I,hasDefaultEdges:z,onEdgesChange:O}=t.getState();if(z)I([...P,...M]);else if(O){const V=M.map(U=>({item:U,type:"add"}));O(V)}},[]),g=ce.useCallback(()=>{const{getNodes:A,edges:M=[],transform:P}=t.getState(),[I,z,O]=P;return{nodes:A().map(V=>({...V})),edges:M.map(V=>({...V})),viewport:{x:I,y:z,zoom:O}}},[]),v=ce.useCallback(({nodes:A,edges:M})=>{const{nodeInternals:P,getNodes:I,edges:z,hasDefaultNodes:O,hasDefaultEdges:V,onNodesDelete:U,onEdgesDelete:$,onNodesChange:G,onEdgesChange:Z}=t.getState(),Q=(A||[]).map(oe=>oe.id),X=(M||[]).map(oe=>oe.id),ie=I().reduce((oe,se)=>{const de=se.parentNode||se.parentId,me=!Q.includes(se.id)&&de&&oe.find(ve=>ve.id===de);return(typeof se.deletable=="boolean"?se.deletable:!0)&&(Q.includes(se.id)||me)&&oe.push(se),oe},[]),te=z.filter(oe=>typeof oe.deletable=="boolean"?oe.deletable:!0),W=te.filter(oe=>X.includes(oe.id));if(ie||W){const oe=CL(ie,te),se=[...W,...oe],de=se.reduce((me,ae)=>(me.includes(ae.id)||me.push(ae.id),me),[]);if((V||O)&&(V&&t.setState({edges:z.filter(me=>!de.includes(me.id))}),O&&(ie.forEach(me=>{P.delete(me.id)}),t.setState({nodeInternals:new Map(P)}))),de.length>0&&($==null||$(se),Z&&Z(de.map(me=>({id:me,type:"remove"})))),ie.length>0&&(U==null||U(ie),G)){const me=ie.map(ae=>({id:ae.id,type:"remove"}));G(me)}}},[]),_=ce.useCallback(A=>{const M=kW(A),P=M?null:t.getState().nodeInternals.get(A.id);return!M&&!P?[null,null,M]:[M?A:fA(P),P,M]},[]),b=ce.useCallback((A,M=!0,P)=>{const[I,z,O]=_(A);return I?(P||t.getState().getNodes()).filter(V=>{if(!O&&(V.id===z.id||!V.positionAbsolute))return!1;const U=fA(V),$=f2(U,I);return M&&$>0||$>=I.width*I.height}):[]},[]),k=ce.useCallback((A,M,P=!0)=>{const[I]=_(A);if(!I)return!1;const z=f2(I,M);return P&&z>0||z>=I.width*I.height},[]);return ce.useMemo(()=>({...e,getNodes:r,getNode:n,getEdges:i,getEdge:s,setNodes:u,setEdges:a,addNodes:d,addEdges:p,toObject:g,deleteElements:v,getIntersectingNodes:b,isNodeIntersecting:k}),[e,r,n,i,s,u,a,d,p,g,v,b,k])}const oZ={actInsideInputWithModifier:!1};var lZ=({deleteKeyCode:e,multiSelectionKeyCode:t})=>{const r=ei(),{deleteElements:n}=uE(),i=km(e,oZ),s=km(t);ce.useEffect(()=>{if(i){const{edges:u,getNodes:a}=r.getState(),d=a().filter(g=>g.selected),p=u.filter(g=>g.selected);n({nodes:d,edges:p}),r.setState({nodesSelectionActive:!1})}},[i]),ce.useEffect(()=>{r.setState({multiSelectionActive:s})},[s])};function uZ(e){const t=ei();ce.useEffect(()=>{let r;const n=()=>{var s,u;if(!e.current)return;const i=tE(e.current);(i.height===0||i.width===0)&&((u=(s=t.getState()).onError)==null||u.call(s,"004",jo.error004())),t.setState({width:i.width||500,height:i.height||500})};return n(),window.addEventListener("resize",n),e.current&&(r=new ResizeObserver(()=>n()),r.observe(e.current)),()=>{window.removeEventListener("resize",n),r&&e.current&&r.unobserve(e.current)}},[])}const cE={position:"absolute",width:"100%",height:"100%",top:0,left:0},cZ=(e,t)=>e.x!==t.x||e.y!==t.y||e.zoom!==t.k,$v=e=>({x:e.x,y:e.y,zoom:e.k}),Lh=(e,t)=>e.target.closest(`.${t}`),SA=(e,t)=>t===2&&Array.isArray(e)&&e.includes(2),EA=e=>{const t=e.ctrlKey&&c0()?10:1;return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*t},hZ=e=>({d3Zoom:e.d3Zoom,d3Selection:e.d3Selection,d3ZoomHandler:e.d3ZoomHandler,userSelectionActive:e.userSelectionActive}),dZ=({onMove:e,onMoveStart:t,onMoveEnd:r,onPaneContextMenu:n,zoomOnScroll:i=!0,zoomOnPinch:s=!0,panOnScroll:u=!1,panOnScrollSpeed:a=.5,panOnScrollMode:d=ic.Free,zoomOnDoubleClick:p=!0,elementsSelectable:g,panOnDrag:v=!0,defaultViewport:_,translateExtent:b,minZoom:k,maxZoom:A,zoomActivationKeyCode:M,preventScrolling:P=!0,children:I,noWheelClassName:z,noPanClassName:O})=>{const V=ce.useRef(),U=ei(),$=ce.useRef(!1),G=ce.useRef(!1),Z=ce.useRef(null),Q=ce.useRef({x:0,y:0,zoom:0}),{d3Zoom:X,d3Selection:ie,d3ZoomHandler:te,userSelectionActive:W}=un(hZ,pi),oe=km(M),se=ce.useRef(0),de=ce.useRef(!1),me=ce.useRef();return uZ(Z),ce.useEffect(()=>{if(Z.current){const ae=Z.current.getBoundingClientRect(),ve=hL().scaleExtent([k,A]).translateExtent(b),pe=ts(Z.current).call(ve),_e=Do.translate(_.x,_.y).scale(Ad(_.zoom,k,A)),De=[[0,0],[ae.width,ae.height]],Le=ve.constrain()(_e,De,b);ve.transform(pe,Le),ve.wheelDelta(EA),U.setState({d3Zoom:ve,d3Selection:pe,d3ZoomHandler:pe.on("wheel.zoom"),transform:[Le.x,Le.y,Le.k],domNode:Z.current.closest(".react-flow")})}},[]),ce.useEffect(()=>{ie&&X&&(u&&!oe&&!W?ie.on("wheel.zoom",ae=>{if(Lh(ae,z))return!1;ae.preventDefault(),ae.stopImmediatePropagation();const ve=ie.property("__zoom").k||1;if(ae.ctrlKey&&s){const ft=ws(ae),rt=EA(ae),Oe=ve*Math.pow(2,rt);X.scaleTo(ie,Oe,ft,ae);return}const pe=ae.deltaMode===1?20:1;let _e=d===ic.Vertical?0:ae.deltaX*pe,De=d===ic.Horizontal?0:ae.deltaY*pe;!c0()&&ae.shiftKey&&d!==ic.Vertical&&(_e=ae.deltaY*pe,De=0),X.translateBy(ie,-(_e/ve)*a,-(De/ve)*a,{internal:!0});const Le=$v(ie.property("__zoom")),{onViewportChangeStart:je,onViewportChange:Je,onViewportChangeEnd:et}=U.getState();clearTimeout(me.current),de.current||(de.current=!0,t==null||t(ae,Le),je==null||je(Le)),de.current&&(e==null||e(ae,Le),Je==null||Je(Le),me.current=setTimeout(()=>{r==null||r(ae,Le),et==null||et(Le),de.current=!1},150))},{passive:!1}):typeof te<"u"&&ie.on("wheel.zoom",function(ae,ve){if(!P&&ae.type==="wheel"&&!ae.ctrlKey||Lh(ae,z))return null;ae.preventDefault(),te.call(this,ae,ve)},{passive:!1}))},[W,u,d,ie,X,te,oe,s,P,z,t,e,r]),ce.useEffect(()=>{X&&X.on("start",ae=>{var _e,De;if(!ae.sourceEvent||ae.sourceEvent.internal)return null;se.current=(_e=ae.sourceEvent)==null?void 0:_e.button;const{onViewportChangeStart:ve}=U.getState(),pe=$v(ae.transform);$.current=!0,Q.current=pe,((De=ae.sourceEvent)==null?void 0:De.type)==="mousedown"&&U.setState({paneDragging:!0}),ve==null||ve(pe),t==null||t(ae.sourceEvent,pe)})},[X,t]),ce.useEffect(()=>{X&&(W&&!$.current?X.on("zoom",null):W||X.on("zoom",ae=>{var pe;const{onViewportChange:ve}=U.getState();if(U.setState({transform:[ae.transform.x,ae.transform.y,ae.transform.k]}),G.current=!!(n&&SA(v,se.current??0)),(e||ve)&&!((pe=ae.sourceEvent)!=null&&pe.internal)){const _e=$v(ae.transform);ve==null||ve(_e),e==null||e(ae.sourceEvent,_e)}}))},[W,X,e,v,n]),ce.useEffect(()=>{X&&X.on("end",ae=>{if(!ae.sourceEvent||ae.sourceEvent.internal)return null;const{onViewportChangeEnd:ve}=U.getState();if($.current=!1,U.setState({paneDragging:!1}),n&&SA(v,se.current??0)&&!G.current&&n(ae.sourceEvent),G.current=!1,(r||ve)&&cZ(Q.current,ae.transform)){const pe=$v(ae.transform);Q.current=pe,clearTimeout(V.current),V.current=setTimeout(()=>{ve==null||ve(pe),r==null||r(ae.sourceEvent,pe)},u?150:0)}})},[X,u,v,r,n]),ce.useEffect(()=>{X&&X.filter(ae=>{const ve=oe||i,pe=s&&ae.ctrlKey;if((v===!0||Array.isArray(v)&&v.includes(1))&&ae.button===1&&ae.type==="mousedown"&&(Lh(ae,"react-flow__node")||Lh(ae,"react-flow__edge")))return!0;if(!v&&!ve&&!u&&!p&&!s||W||!p&&ae.type==="dblclick"||Lh(ae,z)&&ae.type==="wheel"||Lh(ae,O)&&(ae.type!=="wheel"||u&&ae.type==="wheel"&&!oe)||!s&&ae.ctrlKey&&ae.type==="wheel"||!ve&&!u&&!pe&&ae.type==="wheel"||!v&&(ae.type==="mousedown"||ae.type==="touchstart")||Array.isArray(v)&&!v.includes(ae.button)&&ae.type==="mousedown")return!1;const _e=Array.isArray(v)&&v.includes(ae.button)||!ae.button||ae.button<=1;return(!ae.ctrlKey||ae.type==="wheel")&&_e})},[W,X,i,s,u,p,v,g,oe]),Qe.createElement("div",{className:"react-flow__renderer",ref:Z,style:cE},I)},fZ=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function pZ(){const{userSelectionActive:e,userSelectionRect:t}=un(fZ,pi);return e&&t?Qe.createElement("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}function TA(e,t){const r=t.parentNode||t.parentId,n=e.find(i=>i.id===r);if(n){const i=t.position.x+t.width-n.width,s=t.position.y+t.height-n.height;if(i>0||s>0||t.position.x<0||t.position.y<0){if(n.style={...n.style},n.style.width=n.style.width??n.width,n.style.height=n.style.height??n.height,i>0&&(n.style.width+=i),s>0&&(n.style.height+=s),t.position.x<0){const u=Math.abs(t.position.x);n.position.x=n.position.x-u,n.style.width+=u,t.position.x=0}if(t.position.y<0){const u=Math.abs(t.position.y);n.position.y=n.position.y-u,n.style.height+=u,t.position.y=0}n.width=n.style.width,n.height=n.style.height}}}function UL(e,t){if(e.some(n=>n.type==="reset"))return e.filter(n=>n.type==="reset").map(n=>n.item);const r=e.filter(n=>n.type==="add").map(n=>n.item);return t.reduce((n,i)=>{const s=e.filter(a=>a.id===i.id);if(s.length===0)return n.push(i),n;const u={...i};for(const a of s)if(a)switch(a.type){case"select":{u.selected=a.selected;break}case"position":{typeof a.position<"u"&&(u.position=a.position),typeof a.positionAbsolute<"u"&&(u.positionAbsolute=a.positionAbsolute),typeof a.dragging<"u"&&(u.dragging=a.dragging),u.expandParent&&TA(n,u);break}case"dimensions":{typeof a.dimensions<"u"&&(u.width=a.dimensions.width,u.height=a.dimensions.height),typeof a.updateStyle<"u"&&(u.style={...u.style||{},...a.dimensions}),typeof a.resizing=="boolean"&&(u.resizing=a.resizing),u.expandParent&&TA(n,u);break}case"remove":return n}return n.push(u),n},r)}function qL(e,t){return UL(e,t)}function mZ(e,t){return UL(e,t)}const Dl=(e,t)=>({id:e,type:"select",selected:t});function td(e,t){return e.reduce((r,n)=>{const i=t.includes(n.id);return!n.selected&&i?(n.selected=!0,r.push(Dl(n.id,!0))):n.selected&&!i&&(n.selected=!1,r.push(Dl(n.id,!1))),r},[])}const Bb=(e,t)=>r=>{r.target===t.current&&(e==null||e(r))},gZ=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,dragging:e.paneDragging}),HL=ce.memo(({isSelecting:e,selectionMode:t=Cm.Full,panOnDrag:r,onSelectionStart:n,onSelectionEnd:i,onPaneClick:s,onPaneContextMenu:u,onPaneScroll:a,onPaneMouseEnter:d,onPaneMouseMove:p,onPaneMouseLeave:g,children:v})=>{const _=ce.useRef(null),b=ei(),k=ce.useRef(0),A=ce.useRef(0),M=ce.useRef(),{userSelectionActive:P,elementsSelectable:I,dragging:z}=un(gZ,pi),O=()=>{b.setState({userSelectionActive:!1,userSelectionRect:null}),k.current=0,A.current=0},V=te=>{s==null||s(te),b.getState().resetSelectedElements(),b.setState({nodesSelectionActive:!1})},U=te=>{if(Array.isArray(r)&&(r!=null&&r.includes(2))){te.preventDefault();return}u==null||u(te)},$=a?te=>a(te):void 0,G=te=>{const{resetSelectedElements:W,domNode:oe}=b.getState();if(M.current=oe==null?void 0:oe.getBoundingClientRect(),!I||!e||te.button!==0||te.target!==_.current||!M.current)return;const{x:se,y:de}=Jl(te,M.current);W(),b.setState({userSelectionRect:{width:0,height:0,startX:se,startY:de,x:se,y:de}}),n==null||n(te)},Z=te=>{const{userSelectionRect:W,nodeInternals:oe,edges:se,transform:de,onNodesChange:me,onEdgesChange:ae,nodeOrigin:ve,getNodes:pe}=b.getState();if(!e||!M.current||!W)return;b.setState({userSelectionActive:!0,nodesSelectionActive:!1});const _e=Jl(te,M.current),De=W.startX??0,Le=W.startY??0,je={...W,x:_e.x<De?_e.x:De,y:_e.y<Le?_e.y:Le,width:Math.abs(_e.x-De),height:Math.abs(_e.y-Le)},Je=pe(),et=TL(oe,je,de,t===Cm.Partial,!0,ve),ft=CL(et,se).map(Oe=>Oe.id),rt=et.map(Oe=>Oe.id);if(k.current!==rt.length){k.current=rt.length;const Oe=td(Je,rt);Oe.length&&(me==null||me(Oe))}if(A.current!==ft.length){A.current=ft.length;const Oe=td(se,ft);Oe.length&&(ae==null||ae(Oe))}b.setState({userSelectionRect:je})},Q=te=>{if(te.button!==0)return;const{userSelectionRect:W}=b.getState();!P&&W&&te.target===_.current&&(V==null||V(te)),b.setState({nodesSelectionActive:k.current>0}),O(),i==null||i(te)},X=te=>{P&&(b.setState({nodesSelectionActive:k.current>0}),i==null||i(te)),O()},ie=I&&(e||P);return Qe.createElement("div",{className:ki(["react-flow__pane",{dragging:z,selection:e}]),onClick:ie?void 0:Bb(V,_),onContextMenu:Bb(U,_),onWheel:Bb($,_),onMouseEnter:ie?void 0:d,onMouseDown:ie?G:void 0,onMouseMove:ie?Z:p,onMouseUp:ie?Q:void 0,onMouseLeave:ie?X:g,ref:_,style:cE},v,Qe.createElement(pZ,null))});HL.displayName="Pane";function GL(e,t){const r=e.parentNode||e.parentId;if(!r)return!1;const n=t.get(r);return n?n.selected?!0:GL(n,t):!1}function CA(e,t,r){let n=e;do{if(n!=null&&n.matches(t))return!0;if(n===r.current)return!1;n=n.parentElement}while(n);return!1}function vZ(e,t,r,n){return Array.from(e.values()).filter(i=>(i.selected||i.id===n)&&(!i.parentNode||i.parentId||!GL(i,e))&&(i.draggable||t&&typeof i.draggable>"u")).map(i=>{var s,u;return{id:i.id,position:i.position||{x:0,y:0},positionAbsolute:i.positionAbsolute||{x:0,y:0},distance:{x:r.x-(((s=i.positionAbsolute)==null?void 0:s.x)??0),y:r.y-(((u=i.positionAbsolute)==null?void 0:u.y)??0)},delta:{x:0,y:0},extent:i.extent,parentNode:i.parentNode||i.parentId,parentId:i.parentNode||i.parentId,width:i.width,height:i.height,expandParent:i.expandParent}})}function yZ(e,t){return!t||t==="parent"?t:[t[0],[t[1][0]-(e.width||0),t[1][1]-(e.height||0)]]}function WL(e,t,r,n,i=[0,0],s){const u=yZ(e,e.extent||n);let a=u;const d=e.parentNode||e.parentId;if(e.extent==="parent"&&!e.expandParent)if(d&&e.width&&e.height){const v=r.get(d),{x:_,y:b}=cc(v,i).positionAbsolute;a=v&&is(_)&&is(b)&&is(v.width)&&is(v.height)?[[_+e.width*i[0],b+e.height*i[1]],[_+v.width-e.width+e.width*i[0],b+v.height-e.height+e.height*i[1]]]:a}else s==null||s("005",jo.error005()),a=u;else if(e.extent&&d&&e.extent!=="parent"){const v=r.get(d),{x:_,y:b}=cc(v,i).positionAbsolute;a=[[e.extent[0][0]+_,e.extent[0][1]+b],[e.extent[1][0]+_,e.extent[1][1]+b]]}let p={x:0,y:0};if(d){const v=r.get(d);p=cc(v,i).positionAbsolute}const g=a&&a!=="parent"?rE(t,a):t;return{position:{x:g.x-p.x,y:g.y-p.y},positionAbsolute:g}}function Ob({nodeId:e,dragItems:t,nodeInternals:r}){const n=t.map(i=>({...r.get(i.id),position:i.position,positionAbsolute:i.positionAbsolute}));return[e?n.find(i=>i.id===e):n[0],n]}const kA=(e,t,r,n)=>{const i=t.querySelectorAll(e);if(!i||!i.length)return null;const s=Array.from(i),u=t.getBoundingClientRect(),a={x:u.width*n[0],y:u.height*n[1]};return s.map(d=>{const p=d.getBoundingClientRect();return{id:d.getAttribute("data-handleid"),position:d.getAttribute("data-handlepos"),x:(p.left-u.left-a.x)/r,y:(p.top-u.top-a.y)/r,...tE(d)}})};function mp(e,t,r){return r===void 0?r:n=>{const i=t().nodeInternals.get(e);i&&r(n,{...i})}}function x2({id:e,store:t,unselect:r=!1,nodeRef:n}){const{addSelectedNodes:i,unselectNodesAndEdges:s,multiSelectionActive:u,nodeInternals:a,onError:d}=t.getState(),p=a.get(e);if(!p){d==null||d("012",jo.error012(e));return}t.setState({nodesSelectionActive:!1}),p.selected?(r||p.selected&&u)&&(s({nodes:[p],edges:[]}),requestAnimationFrame(()=>{var g;return(g=n==null?void 0:n.current)==null?void 0:g.blur()})):i([e])}function xZ(){const e=ei();return ce.useCallback(({sourceEvent:r})=>{const{transform:n,snapGrid:i,snapToGrid:s}=e.getState(),u=r.touches?r.touches[0].clientX:r.clientX,a=r.touches?r.touches[0].clientY:r.clientY,d={x:(u-n[0])/n[2],y:(a-n[1])/n[2]};return{xSnapped:s?i[0]*Math.round(d.x/i[0]):d.x,ySnapped:s?i[1]*Math.round(d.y/i[1]):d.y,...d}},[])}function Fb(e){return(t,r,n)=>e==null?void 0:e(t,n)}function ZL({nodeRef:e,disabled:t=!1,noDragClassName:r,handleSelector:n,nodeId:i,isSelectable:s,selectNodesOnDrag:u}){const a=ei(),[d,p]=ce.useState(!1),g=ce.useRef([]),v=ce.useRef({x:null,y:null}),_=ce.useRef(0),b=ce.useRef(null),k=ce.useRef({x:0,y:0}),A=ce.useRef(null),M=ce.useRef(!1),P=ce.useRef(!1),I=ce.useRef(!1),z=xZ();return ce.useEffect(()=>{if(e!=null&&e.current){const O=ts(e.current),V=({x:G,y:Z})=>{const{nodeInternals:Q,onNodeDrag:X,onSelectionDrag:ie,updateNodePositions:te,nodeExtent:W,snapGrid:oe,snapToGrid:se,nodeOrigin:de,onError:me}=a.getState();v.current={x:G,y:Z};let ae=!1,ve={x:0,y:0,x2:0,y2:0};if(g.current.length>1&&W){const _e=ux(g.current,de);ve=Tm(_e)}if(g.current=g.current.map(_e=>{const De={x:G-_e.distance.x,y:Z-_e.distance.y};se&&(De.x=oe[0]*Math.round(De.x/oe[0]),De.y=oe[1]*Math.round(De.y/oe[1]));const Le=[[W[0][0],W[0][1]],[W[1][0],W[1][1]]];g.current.length>1&&W&&!_e.extent&&(Le[0][0]=_e.positionAbsolute.x-ve.x+W[0][0],Le[1][0]=_e.positionAbsolute.x+(_e.width??0)-ve.x2+W[1][0],Le[0][1]=_e.positionAbsolute.y-ve.y+W[0][1],Le[1][1]=_e.positionAbsolute.y+(_e.height??0)-ve.y2+W[1][1]);const je=WL(_e,De,Q,Le,de,me);return ae=ae||_e.position.x!==je.position.x||_e.position.y!==je.position.y,_e.position=je.position,_e.positionAbsolute=je.positionAbsolute,_e}),!ae)return;te(g.current,!0,!0),p(!0);const pe=i?X:Fb(ie);if(pe&&A.current){const[_e,De]=Ob({nodeId:i,dragItems:g.current,nodeInternals:Q});pe(A.current,_e,De)}},U=()=>{if(!b.current)return;const[G,Z]=fL(k.current,b.current);if(G!==0||Z!==0){const{transform:Q,panBy:X}=a.getState();v.current.x=(v.current.x??0)-G/Q[2],v.current.y=(v.current.y??0)-Z/Q[2],X({x:G,y:Z})&&V(v.current)}_.current=requestAnimationFrame(U)},$=G=>{var de;const{nodeInternals:Z,multiSelectionActive:Q,nodesDraggable:X,unselectNodesAndEdges:ie,onNodeDragStart:te,onSelectionDragStart:W}=a.getState();P.current=!0;const oe=i?te:Fb(W);(!u||!s)&&!Q&&i&&((de=Z.get(i))!=null&&de.selected||ie()),i&&s&&u&&x2({id:i,store:a,nodeRef:e});const se=z(G);if(v.current=se,g.current=vZ(Z,X,se,i),oe&&g.current){const[me,ae]=Ob({nodeId:i,dragItems:g.current,nodeInternals:Z});oe(G.sourceEvent,me,ae)}};if(t)O.on(".drag",null);else{const G=M7().on("start",Z=>{const{domNode:Q,nodeDragThreshold:X}=a.getState();X===0&&$(Z),I.current=!1;const ie=z(Z);v.current=ie,b.current=(Q==null?void 0:Q.getBoundingClientRect())||null,k.current=Jl(Z.sourceEvent,b.current)}).on("drag",Z=>{var te,W;const Q=z(Z),{autoPanOnNodeDrag:X,nodeDragThreshold:ie}=a.getState();if(Z.sourceEvent.type==="touchmove"&&Z.sourceEvent.touches.length>1&&(I.current=!0),!I.current){if(!M.current&&P.current&&X&&(M.current=!0,U()),!P.current){const oe=Q.xSnapped-(((te=v==null?void 0:v.current)==null?void 0:te.x)??0),se=Q.ySnapped-(((W=v==null?void 0:v.current)==null?void 0:W.y)??0);Math.sqrt(oe*oe+se*se)>ie&&$(Z)}(v.current.x!==Q.xSnapped||v.current.y!==Q.ySnapped)&&g.current&&P.current&&(A.current=Z.sourceEvent,k.current=Jl(Z.sourceEvent,b.current),V(Q))}}).on("end",Z=>{if(!(!P.current||I.current)&&(p(!1),M.current=!1,P.current=!1,cancelAnimationFrame(_.current),g.current)){const{updateNodePositions:Q,nodeInternals:X,onNodeDragStop:ie,onSelectionDragStop:te}=a.getState(),W=i?ie:Fb(te);if(Q(g.current,!1,!1),W){const[oe,se]=Ob({nodeId:i,dragItems:g.current,nodeInternals:X});W(Z.sourceEvent,oe,se)}}}).filter(Z=>{const Q=Z.target;return!Z.button&&(!r||!CA(Q,`.${r}`,e))&&(!n||CA(Q,n,e))});return O.call(G),()=>{O.on(".drag",null)}}}},[e,t,r,n,s,a,i,u,z]),d}function XL(){const e=ei();return ce.useCallback(r=>{const{nodeInternals:n,nodeExtent:i,updateNodePositions:s,getNodes:u,snapToGrid:a,snapGrid:d,onError:p,nodesDraggable:g}=e.getState(),v=u().filter(I=>I.selected&&(I.draggable||g&&typeof I.draggable>"u")),_=a?d[0]:5,b=a?d[1]:5,k=r.isShiftPressed?4:1,A=r.x*_*k,M=r.y*b*k,P=v.map(I=>{if(I.positionAbsolute){const z={x:I.positionAbsolute.x+A,y:I.positionAbsolute.y+M};a&&(z.x=d[0]*Math.round(z.x/d[0]),z.y=d[1]*Math.round(z.y/d[1]));const{positionAbsolute:O,position:V}=WL(I,z,n,i,void 0,p);I.position=V,I.positionAbsolute=O}return I});s(P,!0,!1)},[])}const gd={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}};var gp=e=>{const t=({id:r,type:n,data:i,xPos:s,yPos:u,xPosOrigin:a,yPosOrigin:d,selected:p,onClick:g,onMouseEnter:v,onMouseMove:_,onMouseLeave:b,onContextMenu:k,onDoubleClick:A,style:M,className:P,isDraggable:I,isSelectable:z,isConnectable:O,isFocusable:V,selectNodesOnDrag:U,sourcePosition:$,targetPosition:G,hidden:Z,resizeObserver:Q,dragHandle:X,zIndex:ie,isParent:te,noDragClassName:W,noPanClassName:oe,initialized:se,disableKeyboardA11y:de,ariaLabel:me,rfId:ae,hasHandleBounds:ve})=>{const pe=ei(),_e=ce.useRef(null),De=ce.useRef(null),Le=ce.useRef($),je=ce.useRef(G),Je=ce.useRef(n),et=z||I||g||v||_||b,ft=XL(),rt=mp(r,pe.getState,v),Oe=mp(r,pe.getState,_),Ge=mp(r,pe.getState,b),Ze=mp(r,pe.getState,k),it=mp(r,pe.getState,A),mt=At=>{const{nodeDragThreshold:pt}=pe.getState();if(z&&(!U||!I||pt>0)&&x2({id:r,store:pe,nodeRef:_e}),g){const yt=pe.getState().nodeInternals.get(r);yt&&g(At,{...yt})}},Tt=At=>{if(!p2(At)&&!de)if(vL.includes(At.key)&&z){const pt=At.key==="Escape";x2({id:r,store:pe,unselect:pt,nodeRef:_e})}else I&&p&&Object.prototype.hasOwnProperty.call(gd,At.key)&&(pe.setState({ariaLiveMessage:`Moved selected node ${At.key.replace("Arrow","").toLowerCase()}. New position, x: ${~~s}, y: ${~~u}`}),ft({x:gd[At.key].x,y:gd[At.key].y,isShiftPressed:At.shiftKey}))};ce.useEffect(()=>()=>{De.current&&(Q==null||Q.unobserve(De.current),De.current=null)},[]),ce.useEffect(()=>{if(_e.current&&!Z){const At=_e.current;(!se||!ve||De.current!==At)&&(De.current&&(Q==null||Q.unobserve(De.current)),Q==null||Q.observe(At),De.current=At)}},[Z,se,ve]),ce.useEffect(()=>{const At=Je.current!==n,pt=Le.current!==$,yt=je.current!==G;_e.current&&(At||pt||yt)&&(At&&(Je.current=n),pt&&(Le.current=$),yt&&(je.current=G),pe.getState().updateNodeDimensions([{id:r,nodeElement:_e.current,forceUpdate:!0}]))},[r,n,$,G]);const $e=ZL({nodeRef:_e,disabled:Z||!I,noDragClassName:W,handleSelector:X,nodeId:r,isSelectable:z,selectNodesOnDrag:U});return Z?null:Qe.createElement("div",{className:ki(["react-flow__node",`react-flow__node-${n}`,{[oe]:I},P,{selected:p,selectable:z,parent:te,dragging:$e}]),ref:_e,style:{zIndex:ie,transform:`translate(${a}px,${d}px)`,pointerEvents:et?"all":"none",visibility:se?"visible":"hidden",...M},"data-id":r,"data-testid":`rf__node-${r}`,onMouseEnter:rt,onMouseMove:Oe,onMouseLeave:Ge,onContextMenu:Ze,onClick:mt,onDoubleClick:it,onKeyDown:V?Tt:void 0,tabIndex:V?0:void 0,role:V?"button":void 0,"aria-describedby":de?void 0:`${OL}-${ae}`,"aria-label":me},Qe.createElement(zW,{value:r},Qe.createElement(e,{id:r,data:i,type:n,xPos:s,yPos:u,selected:p,isConnectable:O,sourcePosition:$,targetPosition:G,dragging:$e,dragHandle:X,zIndex:ie})))};return t.displayName="NodeWrapper",ce.memo(t)};const _Z=e=>{const t=e.getNodes().filter(r=>r.selected);return{...ux(t,e.nodeOrigin),transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`,userSelectionActive:e.userSelectionActive}};function wZ({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:r}){const n=ei(),{width:i,height:s,x:u,y:a,transformString:d,userSelectionActive:p}=un(_Z,pi),g=XL(),v=ce.useRef(null);if(ce.useEffect(()=>{var k;r||(k=v.current)==null||k.focus({preventScroll:!0})},[r]),ZL({nodeRef:v}),p||!i||!s)return null;const _=e?k=>{const A=n.getState().getNodes().filter(M=>M.selected);e(k,A)}:void 0,b=k=>{Object.prototype.hasOwnProperty.call(gd,k.key)&&g({x:gd[k.key].x,y:gd[k.key].y,isShiftPressed:k.shiftKey})};return Qe.createElement("div",{className:ki(["react-flow__nodesselection","react-flow__container",t]),style:{transform:d}},Qe.createElement("div",{ref:v,className:"react-flow__nodesselection-rect",onContextMenu:_,tabIndex:r?void 0:-1,onKeyDown:r?void 0:b,style:{width:i,height:s,top:a,left:u}}))}var bZ=ce.memo(wZ);const SZ=e=>e.nodesSelectionActive,KL=({children:e,onPaneClick:t,onPaneMouseEnter:r,onPaneMouseMove:n,onPaneMouseLeave:i,onPaneContextMenu:s,onPaneScroll:u,deleteKeyCode:a,onMove:d,onMoveStart:p,onMoveEnd:g,selectionKeyCode:v,selectionOnDrag:_,selectionMode:b,onSelectionStart:k,onSelectionEnd:A,multiSelectionKeyCode:M,panActivationKeyCode:P,zoomActivationKeyCode:I,elementsSelectable:z,zoomOnScroll:O,zoomOnPinch:V,panOnScroll:U,panOnScrollSpeed:$,panOnScrollMode:G,zoomOnDoubleClick:Z,panOnDrag:Q,defaultViewport:X,translateExtent:ie,minZoom:te,maxZoom:W,preventScrolling:oe,onSelectionContextMenu:se,noWheelClassName:de,noPanClassName:me,disableKeyboardA11y:ae})=>{const ve=un(SZ),pe=km(v),_e=km(P),De=_e||Q,Le=_e||U,je=pe||_&&De!==!0;return lZ({deleteKeyCode:a,multiSelectionKeyCode:M}),Qe.createElement(dZ,{onMove:d,onMoveStart:p,onMoveEnd:g,onPaneContextMenu:s,elementsSelectable:z,zoomOnScroll:O,zoomOnPinch:V,panOnScroll:Le,panOnScrollSpeed:$,panOnScrollMode:G,zoomOnDoubleClick:Z,panOnDrag:!pe&&De,defaultViewport:X,translateExtent:ie,minZoom:te,maxZoom:W,zoomActivationKeyCode:I,preventScrolling:oe,noWheelClassName:de,noPanClassName:me},Qe.createElement(HL,{onSelectionStart:k,onSelectionEnd:A,onPaneClick:t,onPaneMouseEnter:r,onPaneMouseMove:n,onPaneMouseLeave:i,onPaneContextMenu:s,onPaneScroll:u,panOnDrag:De,isSelecting:!!je,selectionMode:b},e,ve&&Qe.createElement(bZ,{onSelectionContextMenu:se,noPanClassName:me,disableKeyboardA11y:ae})))};KL.displayName="FlowRenderer";var EZ=ce.memo(KL);function TZ(e){return un(ce.useCallback(r=>e?TL(r.nodeInternals,{x:0,y:0,width:r.width,height:r.height},r.transform,!0):r.getNodes(),[e]))}function CZ(e){const t={input:gp(e.input||zL),default:gp(e.default||y2),output:gp(e.output||LL),group:gp(e.group||lE)},r={},n=Object.keys(e).filter(i=>!["input","default","output","group"].includes(i)).reduce((i,s)=>(i[s]=gp(e[s]||y2),i),r);return{...t,...n}}const kZ=({x:e,y:t,width:r,height:n,origin:i})=>!r||!n?{x:e,y:t}:i[0]<0||i[1]<0||i[0]>1||i[1]>1?{x:e,y:t}:{x:e-r*i[0],y:t-n*i[1]},PZ=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,updateNodeDimensions:e.updateNodeDimensions,onError:e.onError}),YL=e=>{const{nodesDraggable:t,nodesConnectable:r,nodesFocusable:n,elementsSelectable:i,updateNodeDimensions:s,onError:u}=un(PZ,pi),a=TZ(e.onlyRenderVisibleElements),d=ce.useRef(),p=ce.useMemo(()=>{if(typeof ResizeObserver>"u")return null;const g=new ResizeObserver(v=>{const _=v.map(b=>({id:b.target.getAttribute("data-id"),nodeElement:b.target,forceUpdate:!0}));s(_)});return d.current=g,g},[]);return ce.useEffect(()=>()=>{var g;(g=d==null?void 0:d.current)==null||g.disconnect()},[]),Qe.createElement("div",{className:"react-flow__nodes",style:cE},a.map(g=>{var V,U,$;let v=g.type||"default";e.nodeTypes[v]||(u==null||u("003",jo.error003(v)),v="default");const _=e.nodeTypes[v]||e.nodeTypes.default,b=!!(g.draggable||t&&typeof g.draggable>"u"),k=!!(g.selectable||i&&typeof g.selectable>"u"),A=!!(g.connectable||r&&typeof g.connectable>"u"),M=!!(g.focusable||n&&typeof g.focusable>"u"),P=e.nodeExtent?rE(g.positionAbsolute,e.nodeExtent):g.positionAbsolute,I=(P==null?void 0:P.x)??0,z=(P==null?void 0:P.y)??0,O=kZ({x:I,y:z,width:g.width??0,height:g.height??0,origin:e.nodeOrigin});return Qe.createElement(_,{key:g.id,id:g.id,className:g.className,style:g.style,type:v,data:g.data,sourcePosition:g.sourcePosition||or.Bottom,targetPosition:g.targetPosition||or.Top,hidden:g.hidden,xPos:I,yPos:z,xPosOrigin:O.x,yPosOrigin:O.y,selectNodesOnDrag:e.selectNodesOnDrag,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,selected:!!g.selected,isDraggable:b,isSelectable:k,isConnectable:A,isFocusable:M,resizeObserver:p,dragHandle:g.dragHandle,zIndex:((V=g[Mn])==null?void 0:V.z)??0,isParent:!!((U=g[Mn])!=null&&U.isParent),noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,initialized:!!g.width&&!!g.height,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,ariaLabel:g.ariaLabel,hasHandleBounds:!!(($=g[Mn])!=null&&$.handleBounds)})}))};YL.displayName="NodeRenderer";var IZ=ce.memo(YL);const AZ=(e,t,r)=>r===or.Left?e-t:r===or.Right?e+t:e,MZ=(e,t,r)=>r===or.Top?e-t:r===or.Bottom?e+t:e,PA="react-flow__edgeupdater",IA=({position:e,centerX:t,centerY:r,radius:n=10,onMouseDown:i,onMouseEnter:s,onMouseOut:u,type:a})=>Qe.createElement("circle",{onMouseDown:i,onMouseEnter:s,onMouseOut:u,className:ki([PA,`${PA}-${a}`]),cx:AZ(t,n,e),cy:MZ(r,n,e),r:n,stroke:"transparent",fill:"transparent"}),DZ=()=>!0;var Bh=e=>{const t=({id:r,className:n,type:i,data:s,onClick:u,onEdgeDoubleClick:a,selected:d,animated:p,label:g,labelStyle:v,labelShowBg:_,labelBgStyle:b,labelBgPadding:k,labelBgBorderRadius:A,style:M,source:P,target:I,sourceX:z,sourceY:O,targetX:V,targetY:U,sourcePosition:$,targetPosition:G,elementsSelectable:Z,hidden:Q,sourceHandleId:X,targetHandleId:ie,onContextMenu:te,onMouseEnter:W,onMouseMove:oe,onMouseLeave:se,reconnectRadius:de,onReconnect:me,onReconnectStart:ae,onReconnectEnd:ve,markerEnd:pe,markerStart:_e,rfId:De,ariaLabel:Le,isFocusable:je,isReconnectable:Je,pathOptions:et,interactionWidth:ft,disableKeyboardA11y:rt})=>{const Oe=ce.useRef(null),[Ge,Ze]=ce.useState(!1),[it,mt]=ce.useState(!1),Tt=ei(),$e=ce.useMemo(()=>`url('#${g2(_e,De)}')`,[_e,De]),At=ce.useMemo(()=>`url('#${g2(pe,De)}')`,[pe,De]);if(Q)return null;const pt=wt=>{var st;const{edges:at,addSelectedEdges:le,unselectNodesAndEdges:Be,multiSelectionActive:Ue}=Tt.getState(),tt=at.find(dt=>dt.id===r);tt&&(Z&&(Tt.setState({nodesSelectionActive:!1}),tt.selected&&Ue?(Be({nodes:[],edges:[tt]}),(st=Oe.current)==null||st.blur()):le([r])),u&&u(wt,tt))},yt=pp(r,Tt.getState,a),gt=pp(r,Tt.getState,te),qt=pp(r,Tt.getState,W),$t=pp(r,Tt.getState,oe),er=pp(r,Tt.getState,se),Vt=(wt,at)=>{if(wt.button!==0)return;const{edges:le,isValidConnection:Be}=Tt.getState(),Ue=at?I:P,tt=(at?ie:X)||null,st=at?"target":"source",dt=Be||DZ,ht=at,Ot=le.find(Se=>Se.id===r);mt(!0),ae==null||ae(wt,Ot,st);const Lt=Se=>{mt(!1),ve==null||ve(Se,Ot,st)};AL({event:wt,handleId:tt,nodeId:Ue,onConnect:Se=>me==null?void 0:me(Ot,Se),isTarget:ht,getState:Tt.getState,setState:Tt.setState,isValidConnection:dt,edgeUpdaterType:st,onReconnectEnd:Lt})},tr=wt=>Vt(wt,!0),pr=wt=>Vt(wt,!1),vr=()=>Ze(!0),lt=()=>Ze(!1),mr=!Z&&!u,Ht=wt=>{var at;if(!rt&&vL.includes(wt.key)&&Z){const{unselectNodesAndEdges:le,addSelectedEdges:Be,edges:Ue}=Tt.getState();wt.key==="Escape"?((at=Oe.current)==null||at.blur(),le({edges:[Ue.find(st=>st.id===r)]})):Be([r])}};return Qe.createElement("g",{className:ki(["react-flow__edge",`react-flow__edge-${i}`,n,{selected:d,animated:p,inactive:mr,updating:Ge}]),onClick:pt,onDoubleClick:yt,onContextMenu:gt,onMouseEnter:qt,onMouseMove:$t,onMouseLeave:er,onKeyDown:je?Ht:void 0,tabIndex:je?0:void 0,role:je?"button":"img","data-testid":`rf__edge-${r}`,"aria-label":Le===null?void 0:Le||`Edge from ${P} to ${I}`,"aria-describedby":je?`${FL}-${De}`:void 0,ref:Oe},!it&&Qe.createElement(e,{id:r,source:P,target:I,selected:d,animated:p,label:g,labelStyle:v,labelShowBg:_,labelBgStyle:b,labelBgPadding:k,labelBgBorderRadius:A,data:s,style:M,sourceX:z,sourceY:O,targetX:V,targetY:U,sourcePosition:$,targetPosition:G,sourceHandleId:X,targetHandleId:ie,markerStart:$e,markerEnd:At,pathOptions:et,interactionWidth:ft}),Je&&Qe.createElement(Qe.Fragment,null,(Je==="source"||Je===!0)&&Qe.createElement(IA,{position:$,centerX:z,centerY:O,radius:de,onMouseDown:tr,onMouseEnter:vr,onMouseOut:lt,type:"source"}),(Je==="target"||Je===!0)&&Qe.createElement(IA,{position:G,centerX:V,centerY:U,radius:de,onMouseDown:pr,onMouseEnter:vr,onMouseOut:lt,type:"target"})))};return t.displayName="EdgeWrapper",ce.memo(t)};function NZ(e){const t={default:Bh(e.default||d0),straight:Bh(e.bezier||aE),step:Bh(e.step||iE),smoothstep:Bh(e.step||lx),simplebezier:Bh(e.simplebezier||nE)},r={},n=Object.keys(e).filter(i=>!["default","bezier"].includes(i)).reduce((i,s)=>(i[s]=Bh(e[s]||d0),i),r);return{...t,...n}}function AA(e,t,r=null){const n=((r==null?void 0:r.x)||0)+t.x,i=((r==null?void 0:r.y)||0)+t.y,s=(r==null?void 0:r.width)||t.width,u=(r==null?void 0:r.height)||t.height;switch(e){case or.Top:return{x:n+s/2,y:i};case or.Right:return{x:n+s,y:i+u/2};case or.Bottom:return{x:n+s/2,y:i+u};case or.Left:return{x:n,y:i+u/2}}}function MA(e,t){return e?e.length===1||!t?e[0]:t&&e.find(r=>r.id===t)||null:null}const zZ=(e,t,r,n,i,s)=>{const u=AA(r,e,t),a=AA(s,n,i);return{sourceX:u.x,sourceY:u.y,targetX:a.x,targetY:a.y}};function RZ({sourcePos:e,targetPos:t,sourceWidth:r,sourceHeight:n,targetWidth:i,targetHeight:s,width:u,height:a,transform:d}){const p={x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x+r,t.x+i),y2:Math.max(e.y+n,t.y+s)};p.x===p.x2&&(p.x2+=1),p.y===p.y2&&(p.y2+=1);const g=Tm({x:(0-d[0])/d[2],y:(0-d[1])/d[2],width:u/d[2],height:a/d[2]}),v=Math.max(0,Math.min(g.x2,p.x2)-Math.max(g.x,p.x)),_=Math.max(0,Math.min(g.y2,p.y2)-Math.max(g.y,p.y));return Math.ceil(v*_)>0}function DA(e){var n,i,s,u,a;const t=((n=e==null?void 0:e[Mn])==null?void 0:n.handleBounds)||null,r=t&&(e==null?void 0:e.width)&&(e==null?void 0:e.height)&&typeof((i=e==null?void 0:e.positionAbsolute)==null?void 0:i.x)<"u"&&typeof((s=e==null?void 0:e.positionAbsolute)==null?void 0:s.y)<"u";return[{x:((u=e==null?void 0:e.positionAbsolute)==null?void 0:u.x)||0,y:((a=e==null?void 0:e.positionAbsolute)==null?void 0:a.y)||0,width:(e==null?void 0:e.width)||0,height:(e==null?void 0:e.height)||0},t,!!r]}const LZ=[{level:0,isMaxLevel:!0,edges:[]}];function BZ(e,t,r=!1){let n=-1;const i=e.reduce((u,a)=>{var g,v;const d=is(a.zIndex);let p=d?a.zIndex:0;if(r){const _=t.get(a.target),b=t.get(a.source),k=a.selected||(_==null?void 0:_.selected)||(b==null?void 0:b.selected),A=Math.max(((g=b==null?void 0:b[Mn])==null?void 0:g.z)||0,((v=_==null?void 0:_[Mn])==null?void 0:v.z)||0,1e3);p=(d?a.zIndex:0)+(k?A:0)}return u[p]?u[p].push(a):u[p]=[a],n=p>n?p:n,u},{}),s=Object.entries(i).map(([u,a])=>{const d=+u;return{edges:a,level:d,isMaxLevel:d===n}});return s.length===0?LZ:s}function OZ(e,t,r){const n=un(ce.useCallback(i=>e?i.edges.filter(s=>{const u=t.get(s.source),a=t.get(s.target);return(u==null?void 0:u.width)&&(u==null?void 0:u.height)&&(a==null?void 0:a.width)&&(a==null?void 0:a.height)&&RZ({sourcePos:u.positionAbsolute||{x:0,y:0},targetPos:a.positionAbsolute||{x:0,y:0},sourceWidth:u.width,sourceHeight:u.height,targetWidth:a.width,targetHeight:a.height,width:i.width,height:i.height,transform:i.transform})}):i.edges,[e,t]));return BZ(n,t,r)}const FZ=({color:e="none",strokeWidth:t=1})=>Qe.createElement("polyline",{style:{stroke:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",fill:"none",points:"-5,-4 0,0 -5,4"}),jZ=({color:e="none",strokeWidth:t=1})=>Qe.createElement("polyline",{style:{stroke:e,fill:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"}),NA={[h0.Arrow]:FZ,[h0.ArrowClosed]:jZ};function $Z(e){const t=ei();return ce.useMemo(()=>{var i,s;return Object.prototype.hasOwnProperty.call(NA,e)?NA[e]:((s=(i=t.getState()).onError)==null||s.call(i,"009",jo.error009(e)),null)},[e])}const VZ=({id:e,type:t,color:r,width:n=12.5,height:i=12.5,markerUnits:s="strokeWidth",strokeWidth:u,orient:a="auto-start-reverse"})=>{const d=$Z(t);return d?Qe.createElement("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${n}`,markerHeight:`${i}`,viewBox:"-10 -10 20 20",markerUnits:s,orient:a,refX:"0",refY:"0"},Qe.createElement(d,{color:r,strokeWidth:u})):null},UZ=({defaultColor:e,rfId:t})=>r=>{const n=[];return r.edges.reduce((i,s)=>([s.markerStart,s.markerEnd].forEach(u=>{if(u&&typeof u=="object"){const a=g2(u,t);n.includes(a)||(i.push({id:a,color:u.color||e,...u}),n.push(a))}}),i),[]).sort((i,s)=>i.id.localeCompare(s.id))},JL=({defaultColor:e,rfId:t})=>{const r=un(ce.useCallback(UZ({defaultColor:e,rfId:t}),[e,t]),(n,i)=>!(n.length!==i.length||n.some((s,u)=>s.id!==i[u].id)));return Qe.createElement("defs",null,r.map(n=>Qe.createElement(VZ,{id:n.id,key:n.id,type:n.type,color:n.color,width:n.width,height:n.height,markerUnits:n.markerUnits,strokeWidth:n.strokeWidth,orient:n.orient})))};JL.displayName="MarkerDefinitions";var qZ=ce.memo(JL);const HZ=e=>({nodesConnectable:e.nodesConnectable,edgesFocusable:e.edgesFocusable,edgesUpdatable:e.edgesUpdatable,elementsSelectable:e.elementsSelectable,width:e.width,height:e.height,connectionMode:e.connectionMode,nodeInternals:e.nodeInternals,onError:e.onError}),QL=({defaultMarkerColor:e,onlyRenderVisibleElements:t,elevateEdgesOnSelect:r,rfId:n,edgeTypes:i,noPanClassName:s,onEdgeContextMenu:u,onEdgeMouseEnter:a,onEdgeMouseMove:d,onEdgeMouseLeave:p,onEdgeClick:g,onEdgeDoubleClick:v,onReconnect:_,onReconnectStart:b,onReconnectEnd:k,reconnectRadius:A,children:M,disableKeyboardA11y:P})=>{const{edgesFocusable:I,edgesUpdatable:z,elementsSelectable:O,width:V,height:U,connectionMode:$,nodeInternals:G,onError:Z}=un(HZ,pi),Q=OZ(t,G,r);return V?Qe.createElement(Qe.Fragment,null,Q.map(({level:X,edges:ie,isMaxLevel:te})=>Qe.createElement("svg",{key:X,style:{zIndex:X},width:V,height:U,className:"react-flow__edges react-flow__container"},te&&Qe.createElement(qZ,{defaultColor:e,rfId:n}),Qe.createElement("g",null,ie.map(W=>{const[oe,se,de]=DA(G.get(W.source)),[me,ae,ve]=DA(G.get(W.target));if(!de||!ve)return null;let pe=W.type||"default";i[pe]||(Z==null||Z("011",jo.error011(pe)),pe="default");const _e=i[pe]||i.default,De=$===Sc.Strict?ae.target:(ae.target??[]).concat(ae.source??[]),Le=MA(se.source,W.sourceHandle),je=MA(De,W.targetHandle),Je=(Le==null?void 0:Le.position)||or.Bottom,et=(je==null?void 0:je.position)||or.Top,ft=!!(W.focusable||I&&typeof W.focusable>"u"),rt=W.reconnectable||W.updatable,Oe=typeof _<"u"&&(rt||z&&typeof rt>"u");if(!Le||!je)return Z==null||Z("008",jo.error008(Le,W)),null;const{sourceX:Ge,sourceY:Ze,targetX:it,targetY:mt}=zZ(oe,Le,Je,me,je,et);return Qe.createElement(_e,{key:W.id,id:W.id,className:ki([W.className,s]),type:pe,data:W.data,selected:!!W.selected,animated:!!W.animated,hidden:!!W.hidden,label:W.label,labelStyle:W.labelStyle,labelShowBg:W.labelShowBg,labelBgStyle:W.labelBgStyle,labelBgPadding:W.labelBgPadding,labelBgBorderRadius:W.labelBgBorderRadius,style:W.style,source:W.source,target:W.target,sourceHandleId:W.sourceHandle,targetHandleId:W.targetHandle,markerEnd:W.markerEnd,markerStart:W.markerStart,sourceX:Ge,sourceY:Ze,targetX:it,targetY:mt,sourcePosition:Je,targetPosition:et,elementsSelectable:O,onContextMenu:u,onMouseEnter:a,onMouseMove:d,onMouseLeave:p,onClick:g,onEdgeDoubleClick:v,onReconnect:_,onReconnectStart:b,onReconnectEnd:k,reconnectRadius:A,rfId:n,ariaLabel:W.ariaLabel,isFocusable:ft,isReconnectable:Oe,pathOptions:"pathOptions"in W?W.pathOptions:void 0,interactionWidth:W.interactionWidth,disableKeyboardA11y:P})})))),M):null};QL.displayName="EdgeRenderer";var GZ=ce.memo(QL);const WZ=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function ZZ({children:e}){const t=un(WZ);return Qe.createElement("div",{className:"react-flow__viewport react-flow__container",style:{transform:t}},e)}function XZ(e){const t=uE(),r=ce.useRef(!1);ce.useEffect(()=>{!r.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),r.current=!0)},[e,t.viewportInitialized])}const KZ={[or.Left]:or.Right,[or.Right]:or.Left,[or.Top]:or.Bottom,[or.Bottom]:or.Top},eB=({nodeId:e,handleType:t,style:r,type:n=Rl.Bezier,CustomComponent:i,connectionStatus:s})=>{var U,$,G;const{fromNode:u,handleId:a,toX:d,toY:p,connectionMode:g}=un(ce.useCallback(Z=>({fromNode:Z.nodeInternals.get(e),handleId:Z.connectionHandleId,toX:(Z.connectionPosition.x-Z.transform[0])/Z.transform[2],toY:(Z.connectionPosition.y-Z.transform[1])/Z.transform[2],connectionMode:Z.connectionMode}),[e]),pi),v=(U=u==null?void 0:u[Mn])==null?void 0:U.handleBounds;let _=v==null?void 0:v[t];if(g===Sc.Loose&&(_=_||(v==null?void 0:v[t==="source"?"target":"source"])),!u||!_)return null;const b=a?_.find(Z=>Z.id===a):_[0],k=b?b.x+b.width/2:(u.width??0)/2,A=b?b.y+b.height/2:u.height??0,M=((($=u.positionAbsolute)==null?void 0:$.x)??0)+k,P=(((G=u.positionAbsolute)==null?void 0:G.y)??0)+A,I=b==null?void 0:b.position,z=I?KZ[I]:null;if(!I||!z)return null;if(i)return Qe.createElement(i,{connectionLineType:n,connectionLineStyle:r,fromNode:u,fromHandle:b,fromX:M,fromY:P,toX:d,toY:p,fromPosition:I,toPosition:z,connectionStatus:s});let O="";const V={sourceX:M,sourceY:P,sourcePosition:I,targetX:d,targetY:p,targetPosition:z};return n===Rl.Bezier?[O]=bL(V):n===Rl.Step?[O]=m2({...V,borderRadius:0}):n===Rl.SmoothStep?[O]=m2(V):n===Rl.SimpleBezier?[O]=wL(V):O=`M${M},${P} ${d},${p}`,Qe.createElement("path",{d:O,fill:"none",className:"react-flow__connection-path",style:r})};eB.displayName="ConnectionLine";const YZ=e=>({nodeId:e.connectionNodeId,handleType:e.connectionHandleType,nodesConnectable:e.nodesConnectable,connectionStatus:e.connectionStatus,width:e.width,height:e.height});function JZ({containerStyle:e,style:t,type:r,component:n}){const{nodeId:i,handleType:s,nodesConnectable:u,width:a,height:d,connectionStatus:p}=un(YZ,pi);return!(i&&s&&a&&u)?null:Qe.createElement("svg",{style:e,width:a,height:d,className:"react-flow__edges react-flow__connectionline react-flow__container"},Qe.createElement("g",{className:ki(["react-flow__connection",p])},Qe.createElement(eB,{nodeId:i,handleType:s,style:t,type:r,CustomComponent:n,connectionStatus:p})))}function zA(e,t){return ce.useRef(null),ei(),ce.useMemo(()=>t(e),[e])}const tB=({nodeTypes:e,edgeTypes:t,onMove:r,onMoveStart:n,onMoveEnd:i,onInit:s,onNodeClick:u,onEdgeClick:a,onNodeDoubleClick:d,onEdgeDoubleClick:p,onNodeMouseEnter:g,onNodeMouseMove:v,onNodeMouseLeave:_,onNodeContextMenu:b,onSelectionContextMenu:k,onSelectionStart:A,onSelectionEnd:M,connectionLineType:P,connectionLineStyle:I,connectionLineComponent:z,connectionLineContainerStyle:O,selectionKeyCode:V,selectionOnDrag:U,selectionMode:$,multiSelectionKeyCode:G,panActivationKeyCode:Z,zoomActivationKeyCode:Q,deleteKeyCode:X,onlyRenderVisibleElements:ie,elementsSelectable:te,selectNodesOnDrag:W,defaultViewport:oe,translateExtent:se,minZoom:de,maxZoom:me,preventScrolling:ae,defaultMarkerColor:ve,zoomOnScroll:pe,zoomOnPinch:_e,panOnScroll:De,panOnScrollSpeed:Le,panOnScrollMode:je,zoomOnDoubleClick:Je,panOnDrag:et,onPaneClick:ft,onPaneMouseEnter:rt,onPaneMouseMove:Oe,onPaneMouseLeave:Ge,onPaneScroll:Ze,onPaneContextMenu:it,onEdgeContextMenu:mt,onEdgeMouseEnter:Tt,onEdgeMouseMove:$e,onEdgeMouseLeave:At,onReconnect:pt,onReconnectStart:yt,onReconnectEnd:gt,reconnectRadius:qt,noDragClassName:$t,noWheelClassName:er,noPanClassName:Vt,elevateEdgesOnSelect:tr,disableKeyboardA11y:pr,nodeOrigin:vr,nodeExtent:lt,rfId:mr})=>{const Ht=zA(e,CZ),wt=zA(t,NZ);return XZ(s),Qe.createElement(EZ,{onPaneClick:ft,onPaneMouseEnter:rt,onPaneMouseMove:Oe,onPaneMouseLeave:Ge,onPaneContextMenu:it,onPaneScroll:Ze,deleteKeyCode:X,selectionKeyCode:V,selectionOnDrag:U,selectionMode:$,onSelectionStart:A,onSelectionEnd:M,multiSelectionKeyCode:G,panActivationKeyCode:Z,zoomActivationKeyCode:Q,elementsSelectable:te,onMove:r,onMoveStart:n,onMoveEnd:i,zoomOnScroll:pe,zoomOnPinch:_e,zoomOnDoubleClick:Je,panOnScroll:De,panOnScrollSpeed:Le,panOnScrollMode:je,panOnDrag:et,defaultViewport:oe,translateExtent:se,minZoom:de,maxZoom:me,onSelectionContextMenu:k,preventScrolling:ae,noDragClassName:$t,noWheelClassName:er,noPanClassName:Vt,disableKeyboardA11y:pr},Qe.createElement(ZZ,null,Qe.createElement(GZ,{edgeTypes:wt,onEdgeClick:a,onEdgeDoubleClick:p,onlyRenderVisibleElements:ie,onEdgeContextMenu:mt,onEdgeMouseEnter:Tt,onEdgeMouseMove:$e,onEdgeMouseLeave:At,onReconnect:pt,onReconnectStart:yt,onReconnectEnd:gt,reconnectRadius:qt,defaultMarkerColor:ve,noPanClassName:Vt,elevateEdgesOnSelect:!!tr,disableKeyboardA11y:pr,rfId:mr},Qe.createElement(JZ,{style:I,type:P,component:z,containerStyle:O})),Qe.createElement("div",{className:"react-flow__edgelabel-renderer"}),Qe.createElement(IZ,{nodeTypes:Ht,onNodeClick:u,onNodeDoubleClick:d,onNodeMouseEnter:g,onNodeMouseMove:v,onNodeMouseLeave:_,onNodeContextMenu:b,selectNodesOnDrag:W,onlyRenderVisibleElements:ie,noPanClassName:Vt,noDragClassName:$t,disableKeyboardA11y:pr,nodeOrigin:vr,nodeExtent:lt,rfId:mr})))};tB.displayName="GraphView";var QZ=ce.memo(tB);const _2=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],Tl={rfId:"1",width:0,height:0,transform:[0,0,1],nodeInternals:new Map,edges:[],onNodesChange:null,onEdgesChange:null,hasDefaultNodes:!1,hasDefaultEdges:!1,d3Zoom:null,d3Selection:null,d3ZoomHandler:void 0,minZoom:.5,maxZoom:2,translateExtent:_2,nodeExtent:_2,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionNodeId:null,connectionHandleId:null,connectionHandleType:"source",connectionPosition:{x:0,y:0},connectionStatus:null,connectionMode:Sc.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:[0,0],nodeDragThreshold:0,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesUpdatable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,fitViewOnInit:!1,fitViewOnInitDone:!1,fitViewOnInitOptions:void 0,onSelectionChange:[],multiSelectionActive:!1,connectionStartHandle:null,connectionEndHandle:null,connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,connectionRadius:20,onError:PW,isValidConnection:void 0},eX=()=>UH((e,t)=>({...Tl,setNodes:r=>{const{nodeInternals:n,nodeOrigin:i,elevateNodesOnSelect:s}=t();e({nodeInternals:Lb(r,n,i,s)})},getNodes:()=>Array.from(t().nodeInternals.values()),setEdges:r=>{const{defaultEdgeOptions:n={}}=t();e({edges:r.map(i=>({...n,...i}))})},setDefaultNodesAndEdges:(r,n)=>{const i=typeof r<"u",s=typeof n<"u",u=i?Lb(r,new Map,t().nodeOrigin,t().elevateNodesOnSelect):new Map;e({nodeInternals:u,edges:s?n:[],hasDefaultNodes:i,hasDefaultEdges:s})},updateNodeDimensions:r=>{const{onNodesChange:n,nodeInternals:i,fitViewOnInit:s,fitViewOnInitDone:u,fitViewOnInitOptions:a,domNode:d,nodeOrigin:p}=t(),g=d==null?void 0:d.querySelector(".react-flow__viewport");if(!g)return;const v=window.getComputedStyle(g),{m22:_}=new window.DOMMatrixReadOnly(v.transform),b=r.reduce((A,M)=>{const P=i.get(M.id);if(P!=null&&P.hidden)i.set(P.id,{...P,[Mn]:{...P[Mn],handleBounds:void 0}});else if(P){const I=tE(M.nodeElement);!!(I.width&&I.height&&(P.width!==I.width||P.height!==I.height||M.forceUpdate))&&(i.set(P.id,{...P,[Mn]:{...P[Mn],handleBounds:{source:kA(".source",M.nodeElement,_,p),target:kA(".target",M.nodeElement,_,p)}},...I}),A.push({id:P.id,type:"dimensions",dimensions:I}))}return A},[]);$L(i,p);const k=u||s&&!u&&VL(t,{initial:!0,...a});e({nodeInternals:new Map(i),fitViewOnInitDone:k}),(b==null?void 0:b.length)>0&&(n==null||n(b))},updateNodePositions:(r,n=!0,i=!1)=>{const{triggerNodeChanges:s}=t(),u=r.map(a=>{const d={id:a.id,type:"position",dragging:i};return n&&(d.positionAbsolute=a.positionAbsolute,d.position=a.position),d});s(u)},triggerNodeChanges:r=>{const{onNodesChange:n,nodeInternals:i,hasDefaultNodes:s,nodeOrigin:u,getNodes:a,elevateNodesOnSelect:d}=t();if(r!=null&&r.length){if(s){const p=qL(r,a()),g=Lb(p,i,u,d);e({nodeInternals:g})}n==null||n(r)}},addSelectedNodes:r=>{const{multiSelectionActive:n,edges:i,getNodes:s}=t();let u,a=null;n?u=r.map(d=>Dl(d,!0)):(u=td(s(),r),a=td(i,[])),jv({changedNodes:u,changedEdges:a,get:t,set:e})},addSelectedEdges:r=>{const{multiSelectionActive:n,edges:i,getNodes:s}=t();let u,a=null;n?u=r.map(d=>Dl(d,!0)):(u=td(i,r),a=td(s(),[])),jv({changedNodes:a,changedEdges:u,get:t,set:e})},unselectNodesAndEdges:({nodes:r,edges:n}={})=>{const{edges:i,getNodes:s}=t(),u=r||s(),a=n||i,d=u.map(g=>(g.selected=!1,Dl(g.id,!1))),p=a.map(g=>Dl(g.id,!1));jv({changedNodes:d,changedEdges:p,get:t,set:e})},setMinZoom:r=>{const{d3Zoom:n,maxZoom:i}=t();n==null||n.scaleExtent([r,i]),e({minZoom:r})},setMaxZoom:r=>{const{d3Zoom:n,minZoom:i}=t();n==null||n.scaleExtent([i,r]),e({maxZoom:r})},setTranslateExtent:r=>{var n;(n=t().d3Zoom)==null||n.translateExtent(r),e({translateExtent:r})},resetSelectedElements:()=>{const{edges:r,getNodes:n}=t(),s=n().filter(a=>a.selected).map(a=>Dl(a.id,!1)),u=r.filter(a=>a.selected).map(a=>Dl(a.id,!1));jv({changedNodes:s,changedEdges:u,get:t,set:e})},setNodeExtent:r=>{const{nodeInternals:n}=t();n.forEach(i=>{i.positionAbsolute=rE(i.position,r)}),e({nodeExtent:r,nodeInternals:new Map(n)})},panBy:r=>{const{transform:n,width:i,height:s,d3Zoom:u,d3Selection:a,translateExtent:d}=t();if(!u||!a||!r.x&&!r.y)return!1;const p=Do.translate(n[0]+r.x,n[1]+r.y).scale(n[2]),g=[[0,0],[i,s]],v=u==null?void 0:u.constrain()(p,g,d);return u.transform(a,v),n[0]!==v.x||n[1]!==v.y||n[2]!==v.k},cancelConnection:()=>e({connectionNodeId:Tl.connectionNodeId,connectionHandleId:Tl.connectionHandleId,connectionHandleType:Tl.connectionHandleType,connectionStatus:Tl.connectionStatus,connectionStartHandle:Tl.connectionStartHandle,connectionEndHandle:Tl.connectionEndHandle}),reset:()=>e({...Tl})}),Object.is),rB=({children:e})=>{const t=ce.useRef(null);return t.current||(t.current=eX()),Qe.createElement(wW,{value:t.current},e)};rB.displayName="ReactFlowProvider";const nB=({children:e})=>ce.useContext(ox)?Qe.createElement(Qe.Fragment,null,e):Qe.createElement(rB,null,e);nB.displayName="ReactFlowWrapper";const tX={input:zL,default:y2,output:LL,group:lE},rX={default:d0,straight:aE,step:iE,smoothstep:lx,simplebezier:nE},nX=[0,0],iX=[15,15],aX={x:0,y:0,zoom:1},sX={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0},iB=ce.forwardRef(({nodes:e,edges:t,defaultNodes:r,defaultEdges:n,className:i,nodeTypes:s=tX,edgeTypes:u=rX,onNodeClick:a,onEdgeClick:d,onInit:p,onMove:g,onMoveStart:v,onMoveEnd:_,onConnect:b,onConnectStart:k,onConnectEnd:A,onClickConnectStart:M,onClickConnectEnd:P,onNodeMouseEnter:I,onNodeMouseMove:z,onNodeMouseLeave:O,onNodeContextMenu:V,onNodeDoubleClick:U,onNodeDragStart:$,onNodeDrag:G,onNodeDragStop:Z,onNodesDelete:Q,onEdgesDelete:X,onSelectionChange:ie,onSelectionDragStart:te,onSelectionDrag:W,onSelectionDragStop:oe,onSelectionContextMenu:se,onSelectionStart:de,onSelectionEnd:me,connectionMode:ae=Sc.Strict,connectionLineType:ve=Rl.Bezier,connectionLineStyle:pe,connectionLineComponent:_e,connectionLineContainerStyle:De,deleteKeyCode:Le="Backspace",selectionKeyCode:je="Shift",selectionOnDrag:Je=!1,selectionMode:et=Cm.Full,panActivationKeyCode:ft="Space",multiSelectionKeyCode:rt=c0()?"Meta":"Control",zoomActivationKeyCode:Oe=c0()?"Meta":"Control",snapToGrid:Ge=!1,snapGrid:Ze=iX,onlyRenderVisibleElements:it=!1,selectNodesOnDrag:mt=!0,nodesDraggable:Tt,nodesConnectable:$e,nodesFocusable:At,nodeOrigin:pt=nX,edgesFocusable:yt,edgesUpdatable:gt,elementsSelectable:qt,defaultViewport:$t=aX,minZoom:er=.5,maxZoom:Vt=2,translateExtent:tr=_2,preventScrolling:pr=!0,nodeExtent:vr,defaultMarkerColor:lt="#b1b1b7",zoomOnScroll:mr=!0,zoomOnPinch:Ht=!0,panOnScroll:wt=!1,panOnScrollSpeed:at=.5,panOnScrollMode:le=ic.Free,zoomOnDoubleClick:Be=!0,panOnDrag:Ue=!0,onPaneClick:tt,onPaneMouseEnter:st,onPaneMouseMove:dt,onPaneMouseLeave:ht,onPaneScroll:Ot,onPaneContextMenu:Lt,children:Kt,onEdgeContextMenu:Se,onEdgeDoubleClick:re,onEdgeMouseEnter:ee,onEdgeMouseMove:fe,onEdgeMouseLeave:we,onEdgeUpdate:Me,onEdgeUpdateStart:Ne,onEdgeUpdateEnd:Ve,onReconnect:ke,onReconnectStart:Ye,onReconnectEnd:ot,reconnectRadius:Xe=10,edgeUpdaterRadius:xt=10,onNodesChange:Ct,onEdgesChange:Ut,noDragClassName:gr="nodrag",noWheelClassName:ar="nowheel",noPanClassName:xr="nopan",fitView:fr=!1,fitViewOptions:kr,connectOnClick:_r=!0,attributionPosition:rr,proOptions:Er,defaultEdgeOptions:br,elevateNodesOnSelect:cn=!0,elevateEdgesOnSelect:wn=!1,disableKeyboardA11y:Pn=!1,autoPanOnConnect:$a=!0,autoPanOnNodeDrag:Mr=!0,connectionRadius:to=20,isValidConnection:ro,onError:Hn,style:bn,id:Ms,nodeDragThreshold:Nn,...Bn},ba)=>{const qi=Ms||"1";return Qe.createElement("div",{...Bn,style:{...bn,...sX},ref:ba,className:ki(["react-flow",i]),"data-testid":"rf__wrapper",id:Ms},Qe.createElement(nB,null,Qe.createElement(QZ,{onInit:p,onMove:g,onMoveStart:v,onMoveEnd:_,onNodeClick:a,onEdgeClick:d,onNodeMouseEnter:I,onNodeMouseMove:z,onNodeMouseLeave:O,onNodeContextMenu:V,onNodeDoubleClick:U,nodeTypes:s,edgeTypes:u,connectionLineType:ve,connectionLineStyle:pe,connectionLineComponent:_e,connectionLineContainerStyle:De,selectionKeyCode:je,selectionOnDrag:Je,selectionMode:et,deleteKeyCode:Le,multiSelectionKeyCode:rt,panActivationKeyCode:ft,zoomActivationKeyCode:Oe,onlyRenderVisibleElements:it,selectNodesOnDrag:mt,defaultViewport:$t,translateExtent:tr,minZoom:er,maxZoom:Vt,preventScrolling:pr,zoomOnScroll:mr,zoomOnPinch:Ht,zoomOnDoubleClick:Be,panOnScroll:wt,panOnScrollSpeed:at,panOnScrollMode:le,panOnDrag:Ue,onPaneClick:tt,onPaneMouseEnter:st,onPaneMouseMove:dt,onPaneMouseLeave:ht,onPaneScroll:Ot,onPaneContextMenu:Lt,onSelectionContextMenu:se,onSelectionStart:de,onSelectionEnd:me,onEdgeContextMenu:Se,onEdgeDoubleClick:re,onEdgeMouseEnter:ee,onEdgeMouseMove:fe,onEdgeMouseLeave:we,onReconnect:ke??Me,onReconnectStart:Ye??Ne,onReconnectEnd:ot??Ve,reconnectRadius:Xe??xt,defaultMarkerColor:lt,noDragClassName:gr,noWheelClassName:ar,noPanClassName:xr,elevateEdgesOnSelect:wn,rfId:qi,disableKeyboardA11y:Pn,nodeOrigin:pt,nodeExtent:vr}),Qe.createElement(KW,{nodes:e,edges:t,defaultNodes:r,defaultEdges:n,onConnect:b,onConnectStart:k,onConnectEnd:A,onClickConnectStart:M,onClickConnectEnd:P,nodesDraggable:Tt,nodesConnectable:$e,nodesFocusable:At,edgesFocusable:yt,edgesUpdatable:gt,elementsSelectable:qt,elevateNodesOnSelect:cn,minZoom:er,maxZoom:Vt,nodeExtent:vr,onNodesChange:Ct,onEdgesChange:Ut,snapToGrid:Ge,snapGrid:Ze,connectionMode:ae,translateExtent:tr,connectOnClick:_r,defaultEdgeOptions:br,fitView:fr,fitViewOptions:kr,onNodesDelete:Q,onEdgesDelete:X,onNodeDragStart:$,onNodeDrag:G,onNodeDragStop:Z,onSelectionDrag:W,onSelectionDragStart:te,onSelectionDragStop:oe,noPanClassName:xr,nodeOrigin:pt,rfId:qi,autoPanOnConnect:$a,autoPanOnNodeDrag:Mr,onError:Hn,connectionRadius:to,isValidConnection:ro,nodeDragThreshold:Nn}),Qe.createElement(ZW,{onSelectionChange:ie}),Kt,Qe.createElement(SW,{proOptions:Er,position:rr}),Qe.createElement(tZ,{rfId:qi,disableKeyboardA11y:Pn})))});iB.displayName="ReactFlow";function aB(e){return t=>{const[r,n]=ce.useState(t),i=ce.useCallback(s=>n(u=>e(s,u)),[]);return[r,n,i]}}const oX=aB(qL),lX=aB(mZ),sB=({id:e,x:t,y:r,width:n,height:i,style:s,color:u,strokeColor:a,strokeWidth:d,className:p,borderRadius:g,shapeRendering:v,onClick:_,selected:b})=>{const{background:k,backgroundColor:A}=s||{},M=u||k||A;return Qe.createElement("rect",{className:ki(["react-flow__minimap-node",{selected:b},p]),x:t,y:r,rx:g,ry:g,width:n,height:i,fill:M,stroke:a,strokeWidth:d,shapeRendering:v,onClick:_?P=>_(P,e):void 0})};sB.displayName="MiniMapNode";var uX=ce.memo(sB);const cX=e=>e.nodeOrigin,hX=e=>e.getNodes().filter(t=>!t.hidden&&t.width&&t.height),jb=e=>e instanceof Function?e:()=>e;function dX({nodeStrokeColor:e="transparent",nodeColor:t="#e2e2e2",nodeClassName:r="",nodeBorderRadius:n=5,nodeStrokeWidth:i=2,nodeComponent:s=uX,onClick:u}){const a=un(hX,pi),d=un(cX),p=jb(t),g=jb(e),v=jb(r),_=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return Qe.createElement(Qe.Fragment,null,a.map(b=>{const{x:k,y:A}=cc(b,d).positionAbsolute;return Qe.createElement(s,{key:b.id,x:k,y:A,width:b.width,height:b.height,style:b.style,selected:b.selected,className:v(b),color:p(b),borderRadius:n,strokeColor:g(b),strokeWidth:i,shapeRendering:_,onClick:u,id:b.id})}))}var fX=ce.memo(dX);const pX=200,mX=150,gX=e=>{const t=e.getNodes(),r={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:r,boundingRect:t.length>0?CW(ux(t,e.nodeOrigin),r):r,rfId:e.rfId}},vX="react-flow__minimap-desc";function oB({style:e,className:t,nodeStrokeColor:r="transparent",nodeColor:n="#e2e2e2",nodeClassName:i="",nodeBorderRadius:s=5,nodeStrokeWidth:u=2,nodeComponent:a,maskColor:d="rgb(240, 240, 240, 0.6)",maskStrokeColor:p="none",maskStrokeWidth:g=1,position:v="bottom-right",onClick:_,onNodeClick:b,pannable:k=!1,zoomable:A=!1,ariaLabel:M="React Flow mini map",inversePan:P=!1,zoomStep:I=10,offsetScale:z=5}){const O=ei(),V=ce.useRef(null),{boundingRect:U,viewBB:$,rfId:G}=un(gX,pi),Z=(e==null?void 0:e.width)??pX,Q=(e==null?void 0:e.height)??mX,X=U.width/Z,ie=U.height/Q,te=Math.max(X,ie),W=te*Z,oe=te*Q,se=z*te,de=U.x-(W-U.width)/2-se,me=U.y-(oe-U.height)/2-se,ae=W+se*2,ve=oe+se*2,pe=`${vX}-${G}`,_e=ce.useRef(0);_e.current=te,ce.useEffect(()=>{if(V.current){const je=ts(V.current),Je=rt=>{const{transform:Oe,d3Selection:Ge,d3Zoom:Ze}=O.getState();if(rt.sourceEvent.type!=="wheel"||!Ge||!Ze)return;const it=-rt.sourceEvent.deltaY*(rt.sourceEvent.deltaMode===1?.05:rt.sourceEvent.deltaMode?1:.002)*I,mt=Oe[2]*Math.pow(2,it);Ze.scaleTo(Ge,mt)},et=rt=>{const{transform:Oe,d3Selection:Ge,d3Zoom:Ze,translateExtent:it,width:mt,height:Tt}=O.getState();if(rt.sourceEvent.type!=="mousemove"||!Ge||!Ze)return;const $e=_e.current*Math.max(1,Oe[2])*(P?-1:1),At={x:Oe[0]-rt.sourceEvent.movementX*$e,y:Oe[1]-rt.sourceEvent.movementY*$e},pt=[[0,0],[mt,Tt]],yt=Do.translate(At.x,At.y).scale(Oe[2]),gt=Ze.constrain()(yt,pt,it);Ze.transform(Ge,gt)},ft=hL().on("zoom",k?et:null).on("zoom.wheel",A?Je:null);return je.call(ft),()=>{je.on("zoom",null)}}},[k,A,P,I]);const De=_?je=>{const Je=ws(je);_(je,{x:Je[0],y:Je[1]})}:void 0,Le=b?(je,Je)=>{const et=O.getState().nodeInternals.get(Je);b(je,et)}:void 0;return Qe.createElement(eE,{position:v,style:e,className:ki(["react-flow__minimap",t]),"data-testid":"rf__minimap"},Qe.createElement("svg",{width:Z,height:Q,viewBox:`${de} ${me} ${ae} ${ve}`,role:"img","aria-labelledby":pe,ref:V,onClick:De},M&&Qe.createElement("title",{id:pe},M),Qe.createElement(fX,{onClick:Le,nodeColor:n,nodeStrokeColor:r,nodeBorderRadius:s,nodeClassName:i,nodeStrokeWidth:u,nodeComponent:a}),Qe.createElement("path",{className:"react-flow__minimap-mask",d:`M${de-se},${me-se}h${ae+se*2}v${ve+se*2}h${-ae-se*2}z
        M${$.x},${$.y}h${$.width}v${$.height}h${-$.width}z`,fill:d,fillRule:"evenodd",stroke:p,strokeWidth:g,pointerEvents:"none"})))}oB.displayName="MiniMap";var yX=ce.memo(oB);function xX(){return Qe.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},Qe.createElement("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"}))}function _X(){return Qe.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},Qe.createElement("path",{d:"M0 0h32v4.2H0z"}))}function wX(){return Qe.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},Qe.createElement("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"}))}function bX(){return Qe.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},Qe.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"}))}function SX(){return Qe.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},Qe.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"}))}const Cp=({children:e,className:t,...r})=>Qe.createElement("button",{type:"button",className:ki(["react-flow__controls-button",t]),...r},e);Cp.displayName="ControlButton";const EX=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom}),lB=({style:e,showZoom:t=!0,showFitView:r=!0,showInteractive:n=!0,fitViewOptions:i,onZoomIn:s,onZoomOut:u,onFitView:a,onInteractiveChange:d,className:p,children:g,position:v="bottom-left"})=>{const _=ei(),[b,k]=ce.useState(!1),{isInteractive:A,minZoomReached:M,maxZoomReached:P}=un(EX,pi),{zoomIn:I,zoomOut:z,fitView:O}=uE();if(ce.useEffect(()=>{k(!0)},[]),!b)return null;const V=()=>{I(),s==null||s()},U=()=>{z(),u==null||u()},$=()=>{O(i),a==null||a()},G=()=>{_.setState({nodesDraggable:!A,nodesConnectable:!A,elementsSelectable:!A}),d==null||d(!A)};return Qe.createElement(eE,{className:ki(["react-flow__controls",p]),position:v,style:e,"data-testid":"rf__controls"},t&&Qe.createElement(Qe.Fragment,null,Qe.createElement(Cp,{onClick:V,className:"react-flow__controls-zoomin",title:"zoom in","aria-label":"zoom in",disabled:P},Qe.createElement(xX,null)),Qe.createElement(Cp,{onClick:U,className:"react-flow__controls-zoomout",title:"zoom out","aria-label":"zoom out",disabled:M},Qe.createElement(_X,null))),r&&Qe.createElement(Cp,{className:"react-flow__controls-fitview",onClick:$,title:"fit view","aria-label":"fit view"},Qe.createElement(wX,null)),n&&Qe.createElement(Cp,{className:"react-flow__controls-interactive",onClick:G,title:"toggle interactivity","aria-label":"toggle interactivity"},A?Qe.createElement(SX,null):Qe.createElement(bX,null)),g)};lB.displayName="Controls";var TX=ce.memo(lB),ks;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(ks||(ks={}));function CX({color:e,dimensions:t,lineWidth:r}){return Qe.createElement("path",{stroke:e,strokeWidth:r,d:`M${t[0]/2} 0 V${t[1]} M0 ${t[1]/2} H${t[0]}`})}function kX({color:e,radius:t}){return Qe.createElement("circle",{cx:t,cy:t,r:t,fill:e})}const PX={[ks.Dots]:"#91919a",[ks.Lines]:"#eee",[ks.Cross]:"#e2e2e2"},IX={[ks.Dots]:1,[ks.Lines]:1,[ks.Cross]:6},AX=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function uB({id:e,variant:t=ks.Dots,gap:r=20,size:n,lineWidth:i=1,offset:s=2,color:u,style:a,className:d}){const p=ce.useRef(null),{transform:g,patternId:v}=un(AX,pi),_=u||PX[t],b=n||IX[t],k=t===ks.Dots,A=t===ks.Cross,M=Array.isArray(r)?r:[r,r],P=[M[0]*g[2]||1,M[1]*g[2]||1],I=b*g[2],z=A?[I,I]:P,O=k?[I/s,I/s]:[z[0]/s,z[1]/s];return Qe.createElement("svg",{className:ki(["react-flow__background",d]),style:{...a,position:"absolute",width:"100%",height:"100%",top:0,left:0},ref:p,"data-testid":"rf__background"},Qe.createElement("pattern",{id:v+e,x:g[0]%P[0],y:g[1]%P[1],width:P[0],height:P[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${O[0]},-${O[1]})`},k?Qe.createElement(kX,{color:_,radius:I/s}):Qe.createElement(CX,{dimensions:z,color:_,lineWidth:i})),Qe.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${v+e})`}))}uB.displayName="Background";var MX=ce.memo(uB);const DX={default:({data:e})=>D.jsxs("div",{className:"px-4 py-2 bg-surface border border-white/20 rounded shadow-lg text-white min-w-[120px]",children:[D.jsx(Md,{type:"target",position:or.Top,className:"w-3 h-3"}),D.jsx("div",{className:"font-semibold text-sm",children:e.label}),e.type&&D.jsx("div",{className:"text-xs text-white/60 mt-1",children:e.type}),D.jsx(Md,{type:"source",position:or.Bottom,className:"w-3 h-3"})]})},NX=({onNodeClick:e})=>{var M;const{current:t,setCurrentJson:r,setSelection:n}=Ac(),i=((M=t==null?void 0:t.jsonBody)==null?void 0:M.steps)||[],s=ce.useMemo(()=>i.map((P,I)=>({id:P.id,type:"default",position:{x:200+I%3*200,y:100+Math.floor(I/3)*150},data:{label:P.name||P.type,type:P.type}})),[i]),u=ce.useMemo(()=>{const P=[];return i.forEach(I=>{I.next&&I.next.forEach(z=>{P.push({id:`${I.id}-${z}`,source:I.id,target:z})})}),P},[i]),[a,d,p]=oX(s),[g,v,_]=lX(u);Qe.useEffect(()=>{d(s),v(u)},[s,u,d,v]);const b=ce.useCallback(P=>{!P.source||!P.target||(r(I=>{const z=[...I.steps],O=z.find(V=>V.id===P.source);if(O){const V=O.next||[];V.includes(P.target)||(O.next=[...V,P.target])}return{...I,steps:z}}),v(I=>I.some(O=>O.source===P.source&&O.target===P.target)?I:SL(P,I)))},[r,v]),k=ce.useCallback((P,I)=>{n([I.id]),e==null||e(I.id)},[e,n]),A=ce.useCallback(P=>{r(I=>{const z=new Set(P.map(V=>V.id)),O=I.steps.filter(V=>!z.has(V.id)).map(V=>{var U;return{...V,next:(U=V.next)==null?void 0:U.filter($=>!z.has($))}});return{...I,steps:O}})},[r]);return D.jsx("div",{className:"w-full h-full",style:{width:"100%",height:"100%",minHeight:"400px"},children:D.jsxs(iB,{nodes:a,edges:g,onNodesChange:p,onEdgesChange:_,onConnect:b,onNodeClick:k,onNodesDelete:A,nodeTypes:DX,fitView:!0,className:"bg-surface",children:[D.jsx(MX,{}),D.jsx(TX,{}),D.jsx(yX,{})]})})},zX=[{type:"geoip",label:"GeoIP",color:"bg-blue-500"},{type:"whois",label:"WHOIS",color:"bg-green-500"},{type:"virustotal",label:"VirusTotal",color:"bg-red-500"},{type:"reverse_geocode",label:"Reverse Geocode",color:"bg-purple-500"},{type:"keyword_match",label:"Keyword Match",color:"bg-yellow-500"},{type:"http_get",label:"HTTP GET",color:"bg-teal-500"},{type:"http_post",label:"HTTP POST",color:"bg-orange-500"},{type:"branch",label:"Branch",color:"bg-pink-500"},{type:"wait",label:"Wait",color:"bg-gray-500"},{type:"output",label:"Output",color:"bg-indigo-500"}],RX=({onAddNode:e})=>D.jsxs("div",{className:"p-4 bg-surface-dark border-r border-white/10",children:[D.jsx("h3",{className:"text-sm font-semibold mb-3 text-white/80",children:"Node Palette"}),D.jsx("div",{className:"space-y-2",children:zX.map(t=>D.jsx("button",{onClick:()=>e(t.type),className:`w-full px-3 py-2 rounded text-sm text-white ${t.color} hover:opacity-80 transition-opacity text-left`,children:t.label},t.type))})]});function RA(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function LX(e){if(Array.isArray(e))return e}function BX(e,t,r){return(t=qX(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function OX(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,i,s,u,a=[],d=!0,p=!1;try{if(s=(r=r.call(e)).next,t!==0)for(;!(d=(n=s.call(r)).done)&&(a.push(n.value),a.length!==t);d=!0);}catch(g){p=!0,i=g}finally{try{if(!d&&r.return!=null&&(u=r.return(),Object(u)!==u))return}finally{if(p)throw i}}return a}}function FX(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function LA(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function BA(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?LA(Object(r),!0).forEach(function(n){BX(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):LA(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function jX(e,t){if(e==null)return{};var r,n,i=$X(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function $X(e,t){if(e==null)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(t.indexOf(n)!==-1)continue;r[n]=e[n]}return r}function VX(e,t){return LX(e)||OX(e,t)||HX(e,t)||FX()}function UX(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function qX(e){var t=UX(e,"string");return typeof t=="symbol"?t:t+""}function HX(e,t){if(e){if(typeof e=="string")return RA(e,t);var r={}.toString.call(e).slice(8,-1);return r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set"?Array.from(e):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?RA(e,t):void 0}}function GX(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function OA(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function FA(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?OA(Object(r),!0).forEach(function(n){GX(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):OA(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function WX(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(n){return t.reduceRight(function(i,s){return s(i)},n)}}function kp(e){return function t(){for(var r=this,n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];return i.length>=e.length?e.apply(this,i):function(){for(var u=arguments.length,a=new Array(u),d=0;d<u;d++)a[d]=arguments[d];return t.apply(r,[].concat(i,a))}}}function f0(e){return{}.toString.call(e).includes("Object")}function ZX(e){return!Object.keys(e).length}function Pm(e){return typeof e=="function"}function XX(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function KX(e,t){return f0(t)||Ql("changeType"),Object.keys(t).some(function(r){return!XX(e,r)})&&Ql("changeField"),t}function YX(e){Pm(e)||Ql("selectorType")}function JX(e){Pm(e)||f0(e)||Ql("handlerType"),f0(e)&&Object.values(e).some(function(t){return!Pm(t)})&&Ql("handlersType")}function QX(e){e||Ql("initialIsRequired"),f0(e)||Ql("initialType"),ZX(e)&&Ql("initialContent")}function eK(e,t){throw new Error(e[t]||e.default)}var tK={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},Ql=kp(eK)(tK),Vv={changes:KX,selector:YX,handler:JX,initial:QX};function rK(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Vv.initial(e),Vv.handler(t);var r={current:e},n=kp(aK)(r,t),i=kp(iK)(r),s=kp(Vv.changes)(e),u=kp(nK)(r);function a(){var p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(g){return g};return Vv.selector(p),p(r.current)}function d(p){WX(n,i,s,u)(p)}return[a,d]}function nK(e,t){return Pm(t)?t(e.current):t}function iK(e,t){return e.current=FA(FA({},e.current),t),t}function aK(e,t,r){return Pm(t)?t(e.current):Object.keys(r).forEach(function(n){var i;return(i=t[n])===null||i===void 0?void 0:i.call(t,e.current[n])}),r}var sK={create:rK},oK={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.54.0/min/vs"}};function lK(e){return function t(){for(var r=this,n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];return i.length>=e.length?e.apply(this,i):function(){for(var u=arguments.length,a=new Array(u),d=0;d<u;d++)a[d]=arguments[d];return t.apply(r,[].concat(i,a))}}}function uK(e){return{}.toString.call(e).includes("Object")}function cK(e){return e||jA("configIsRequired"),uK(e)||jA("configType"),e.urls?(hK(),{paths:{vs:e.urls.monacoBase}}):e}function hK(){console.warn(cB.deprecation)}function dK(e,t){throw new Error(e[t]||e.default)}var cB={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:`Deprecation warning!
    You are using deprecated way of configuration.

    Instead of using
      monaco.config({ urls: { monacoBase: '...' } })
    use
      monaco.config({ paths: { vs: '...' } })

    For more please check the link https://github.com/suren-atoyan/monaco-loader#config
  `},jA=lK(dK)(cB),fK={config:cK},pK=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return function(i){return r.reduceRight(function(s,u){return u(s)},i)}};function hB(e,t){return Object.keys(t).forEach(function(r){t[r]instanceof Object&&e[r]&&Object.assign(t[r],hB(e[r],t[r]))}),BA(BA({},e),t)}var mK={type:"cancelation",msg:"operation is manually canceled"};function $b(e){var t=!1,r=new Promise(function(n,i){e.then(function(s){return t?i(mK):n(s)}),e.catch(i)});return r.cancel=function(){return t=!0},r}var gK=["monaco"],vK=sK.create({config:oK,isInitialized:!1,resolve:null,reject:null,monaco:null}),dB=VX(vK,2),Ym=dB[0],cx=dB[1];function yK(e){var t=fK.config(e),r=t.monaco,n=jX(t,gK);cx(function(i){return{config:hB(i.config,n),monaco:r}})}function xK(){var e=Ym(function(t){var r=t.monaco,n=t.isInitialized,i=t.resolve;return{monaco:r,isInitialized:n,resolve:i}});if(!e.isInitialized){if(cx({isInitialized:!0}),e.monaco)return e.resolve(e.monaco),$b(Vb);if(window.monaco&&window.monaco.editor)return fB(window.monaco),e.resolve(window.monaco),$b(Vb);pK(_K,bK)(SK)}return $b(Vb)}function _K(e){return document.body.appendChild(e)}function wK(e){var t=document.createElement("script");return e&&(t.src=e),t}function bK(e){var t=Ym(function(n){var i=n.config,s=n.reject;return{config:i,reject:s}}),r=wK("".concat(t.config.paths.vs,"/loader.js"));return r.onload=function(){return e()},r.onerror=t.reject,r}function SK(){var e=Ym(function(r){var n=r.config,i=r.resolve,s=r.reject;return{config:n,resolve:i,reject:s}}),t=window.require;t.config(e.config),t(["vs/editor/editor.main"],function(r){var n=r.m;fB(n),e.resolve(n)},function(r){e.reject(r)})}function fB(e){Ym().monaco||cx({monaco:e})}function EK(){return Ym(function(e){var t=e.monaco;return t})}var Vb=new Promise(function(e,t){return cx({resolve:e,reject:t})}),pB={config:yK,init:xK,__getMonacoInstance:EK},TK={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}},Ub=TK,CK={container:{display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"}},kK=CK;function PK({children:e}){return Qe.createElement("div",{style:kK.container},e)}var IK=PK,AK=IK;function MK({width:e,height:t,isEditorReady:r,loading:n,_ref:i,className:s,wrapperProps:u}){return Qe.createElement("section",{style:{...Ub.wrapper,width:e,height:t},...u},!r&&Qe.createElement(AK,null,n),Qe.createElement("div",{ref:i,style:{...Ub.fullWidth,...!r&&Ub.hide},className:s}))}var DK=MK,mB=ce.memo(DK);function NK(e){ce.useEffect(e,[])}var gB=NK;function zK(e,t,r=!0){let n=ce.useRef(!0);ce.useEffect(n.current||!r?()=>{n.current=!1}:e,t)}var Na=zK;function jp(){}function rd(e,t,r,n){return RK(e,n)||LK(e,t,r,n)}function RK(e,t){return e.editor.getModel(vB(e,t))}function LK(e,t,r,n){return e.editor.createModel(t,r,n?vB(e,n):void 0)}function vB(e,t){return e.Uri.parse(t)}function BK({original:e,modified:t,language:r,originalLanguage:n,modifiedLanguage:i,originalModelPath:s,modifiedModelPath:u,keepCurrentOriginalModel:a=!1,keepCurrentModifiedModel:d=!1,theme:p="light",loading:g="Loading...",options:v={},height:_="100%",width:b="100%",className:k,wrapperProps:A={},beforeMount:M=jp,onMount:P=jp}){let[I,z]=ce.useState(!1),[O,V]=ce.useState(!0),U=ce.useRef(null),$=ce.useRef(null),G=ce.useRef(null),Z=ce.useRef(P),Q=ce.useRef(M),X=ce.useRef(!1);gB(()=>{let oe=pB.init();return oe.then(se=>($.current=se)&&V(!1)).catch(se=>(se==null?void 0:se.type)!=="cancelation"&&console.error("Monaco initialization: error:",se)),()=>U.current?W():oe.cancel()}),Na(()=>{if(U.current&&$.current){let oe=U.current.getOriginalEditor(),se=rd($.current,e||"",n||r||"text",s||"");se!==oe.getModel()&&oe.setModel(se)}},[s],I),Na(()=>{if(U.current&&$.current){let oe=U.current.getModifiedEditor(),se=rd($.current,t||"",i||r||"text",u||"");se!==oe.getModel()&&oe.setModel(se)}},[u],I),Na(()=>{let oe=U.current.getModifiedEditor();oe.getOption($.current.editor.EditorOption.readOnly)?oe.setValue(t||""):t!==oe.getValue()&&(oe.executeEdits("",[{range:oe.getModel().getFullModelRange(),text:t||"",forceMoveMarkers:!0}]),oe.pushUndoStop())},[t],I),Na(()=>{var oe,se;(se=(oe=U.current)==null?void 0:oe.getModel())==null||se.original.setValue(e||"")},[e],I),Na(()=>{let{original:oe,modified:se}=U.current.getModel();$.current.editor.setModelLanguage(oe,n||r||"text"),$.current.editor.setModelLanguage(se,i||r||"text")},[r,n,i],I),Na(()=>{var oe;(oe=$.current)==null||oe.editor.setTheme(p)},[p],I),Na(()=>{var oe;(oe=U.current)==null||oe.updateOptions(v)},[v],I);let ie=ce.useCallback(()=>{var de;if(!$.current)return;Q.current($.current);let oe=rd($.current,e||"",n||r||"text",s||""),se=rd($.current,t||"",i||r||"text",u||"");(de=U.current)==null||de.setModel({original:oe,modified:se})},[r,t,i,e,n,s,u]),te=ce.useCallback(()=>{var oe;!X.current&&G.current&&(U.current=$.current.editor.createDiffEditor(G.current,{automaticLayout:!0,...v}),ie(),(oe=$.current)==null||oe.editor.setTheme(p),z(!0),X.current=!0)},[v,p,ie]);ce.useEffect(()=>{I&&Z.current(U.current,$.current)},[I]),ce.useEffect(()=>{!O&&!I&&te()},[O,I,te]);function W(){var se,de,me,ae;let oe=(se=U.current)==null?void 0:se.getModel();a||((de=oe==null?void 0:oe.original)==null||de.dispose()),d||((me=oe==null?void 0:oe.modified)==null||me.dispose()),(ae=U.current)==null||ae.dispose()}return Qe.createElement(mB,{width:b,height:_,isEditorReady:I,loading:g,_ref:G,className:k,wrapperProps:A})}var OK=BK;ce.memo(OK);function FK(e){let t=ce.useRef();return ce.useEffect(()=>{t.current=e},[e]),t.current}var jK=FK,Uv=new Map;function $K({defaultValue:e,defaultLanguage:t,defaultPath:r,value:n,language:i,path:s,theme:u="light",line:a,loading:d="Loading...",options:p={},overrideServices:g={},saveViewState:v=!0,keepCurrentModel:_=!1,width:b="100%",height:k="100%",className:A,wrapperProps:M={},beforeMount:P=jp,onMount:I=jp,onChange:z,onValidate:O=jp}){let[V,U]=ce.useState(!1),[$,G]=ce.useState(!0),Z=ce.useRef(null),Q=ce.useRef(null),X=ce.useRef(null),ie=ce.useRef(I),te=ce.useRef(P),W=ce.useRef(),oe=ce.useRef(n),se=jK(s),de=ce.useRef(!1),me=ce.useRef(!1);gB(()=>{let pe=pB.init();return pe.then(_e=>(Z.current=_e)&&G(!1)).catch(_e=>(_e==null?void 0:_e.type)!=="cancelation"&&console.error("Monaco initialization: error:",_e)),()=>Q.current?ve():pe.cancel()}),Na(()=>{var _e,De,Le,je;let pe=rd(Z.current,e||n||"",t||i||"",s||r||"");pe!==((_e=Q.current)==null?void 0:_e.getModel())&&(v&&Uv.set(se,(De=Q.current)==null?void 0:De.saveViewState()),(Le=Q.current)==null||Le.setModel(pe),v&&((je=Q.current)==null||je.restoreViewState(Uv.get(s))))},[s],V),Na(()=>{var pe;(pe=Q.current)==null||pe.updateOptions(p)},[p],V),Na(()=>{!Q.current||n===void 0||(Q.current.getOption(Z.current.editor.EditorOption.readOnly)?Q.current.setValue(n):n!==Q.current.getValue()&&(me.current=!0,Q.current.executeEdits("",[{range:Q.current.getModel().getFullModelRange(),text:n,forceMoveMarkers:!0}]),Q.current.pushUndoStop(),me.current=!1))},[n],V),Na(()=>{var _e,De;let pe=(_e=Q.current)==null?void 0:_e.getModel();pe&&i&&((De=Z.current)==null||De.editor.setModelLanguage(pe,i))},[i],V),Na(()=>{var pe;a!==void 0&&((pe=Q.current)==null||pe.revealLine(a))},[a],V),Na(()=>{var pe;(pe=Z.current)==null||pe.editor.setTheme(u)},[u],V);let ae=ce.useCallback(()=>{var pe;if(!(!X.current||!Z.current)&&!de.current){te.current(Z.current);let _e=s||r,De=rd(Z.current,n||e||"",t||i||"",_e||"");Q.current=(pe=Z.current)==null?void 0:pe.editor.create(X.current,{model:De,automaticLayout:!0,...p},g),v&&Q.current.restoreViewState(Uv.get(_e)),Z.current.editor.setTheme(u),a!==void 0&&Q.current.revealLine(a),U(!0),de.current=!0}},[e,t,r,n,i,s,p,g,v,u,a]);ce.useEffect(()=>{V&&ie.current(Q.current,Z.current)},[V]),ce.useEffect(()=>{!$&&!V&&ae()},[$,V,ae]),oe.current=n,ce.useEffect(()=>{var pe,_e;V&&z&&((pe=W.current)==null||pe.dispose(),W.current=(_e=Q.current)==null?void 0:_e.onDidChangeModelContent(De=>{me.current||z(Q.current.getValue(),De)}))},[V,z]),ce.useEffect(()=>{if(V){let pe=Z.current.editor.onDidChangeMarkers(_e=>{var Le;let De=(Le=Q.current.getModel())==null?void 0:Le.uri;if(De&&_e.find(je=>je.path===De.path)){let je=Z.current.editor.getModelMarkers({resource:De});O==null||O(je)}});return()=>{pe==null||pe.dispose()}}return()=>{}},[V,O]);function ve(){var pe,_e;(pe=W.current)==null||pe.dispose(),_?v&&Uv.set(s,Q.current.saveViewState()):(_e=Q.current.getModel())==null||_e.dispose(),Q.current.dispose()}return Qe.createElement(mB,{width:b,height:k,isEditorReady:V,loading:d,_ref:X,className:A,wrapperProps:M})}var VK=$K,UK=ce.memo(VK),qK=UK;const HK=({onPublish:e,onRollback:t})=>{const{current:r,update:n,validate:i,isDirty:s}=Ac(),[u,a]=ce.useState(null),[d,p]=ce.useState(!1),[g,v]=ce.useState(!1),[_,b]=ce.useState(""),[k,A]=ce.useState(null),M=JSON.stringify((r==null?void 0:r.jsonBody)||{},null,2),P=()=>{if(!r)return;const G=O(r.jsonBody);A({hasEntry:!!r.jsonBody.entry&&r.jsonBody.steps.some(Z=>Z.id===r.jsonBody.entry),hasDanglingEdges:G.errors.some(Z=>Z.includes("references non-existent step")),hasUnconnectedSteps:G.warnings.some(Z=>Z.includes("not connected")),hasSteps:r.jsonBody.steps.length>0})};ce.useEffect(()=>{P()},[r==null?void 0:r.jsonBody]);const I=async()=>{if(!r)return;const G=await i(r.jsonBody);a(G),P(),G.isValid?lr("Playbook is valid"):lr("Validation failed - check errors")},z=async()=>{if(r)try{await n(r.id,{jsonBody:r.jsonBody,status:"draft"}),lr("Draft saved")}catch(G){lr(`Failed to save: ${G.message}`)}},O=G=>{const Z=[],Q=[];G.entry?G.steps.some(te=>te.id===G.entry)||Z.push(`Entry step "${G.entry}" not found in steps.`):Z.push("No entry step defined. Set an entry point before publishing.");const X=new Set(G.steps.map(ie=>ie.id));if(G.steps.forEach((ie,te)=>{ie.next&&ie.next.length>0&&ie.next.forEach(W=>{X.has(W)||Z.push(`Step "${ie.name||ie.id||`Step ${te+1}`}" references non-existent step "${W}"`)})}),G.steps.length>1){const ie=new Set;G.entry&&ie.add(G.entry),G.steps.forEach(te=>{te.next&&te.next.forEach(W=>ie.add(W))}),G.steps.forEach(te=>{!ie.has(te.id)&&te.id!==G.entry&&Q.push(`Step "${te.name||te.id}" is not connected to the playbook flow`)})}return G.steps.length===0&&Z.push("Playbook must have at least one step"),{canPublish:Z.length===0,errors:Z,warnings:Q}},V=async()=>{if(!r)return;const G=O(r.jsonBody);if(!G.canPublish){a({isValid:!1,errors:G.errors,warnings:G.warnings}),lr("Cannot publish - check errors");return}const Z=await i(r.jsonBody);if(!Z.isValid){a({isValid:!1,errors:[...G.errors,...Z.errors||[]],warnings:[...G.warnings,...Z.warnings||[]]}),lr("Cannot publish - validation failed");return}G.warnings.length>0&&a({isValid:!0,warnings:G.warnings});try{await n(r.id,{jsonBody:r.jsonBody,status:"published",releaseNotes:_.trim()||void 0}),p(!1),b(""),lr("Playbook published"),e==null||e()}catch(Q){lr(`Failed to publish: ${Q.message}`)}},U=()=>{if(!r)return;const G={name:r.name,description:r.description,version:r.jsonBody.version||"1.0.0",...r.jsonBody},Z=new Blob([JSON.stringify(G,null,2)],{type:"application/json"}),Q=URL.createObjectURL(Z),X=document.createElement("a");X.href=Q,X.download=`${r.name.replace(/[^a-z0-9]/gi,"_").toLowerCase()}.json`,document.body.appendChild(X),X.click(),document.body.removeChild(X),URL.revokeObjectURL(Q),lr("Playbook exported")},$=()=>{if(!r){lr("Please select a playbook first");return}const G=document.createElement("input");G.type="file",G.accept=".json",G.onchange=async Z=>{var X,ie;const Q=(X=Z.target.files)==null?void 0:X[0];if(Q)try{const te=await Q.text(),W=JSON.parse(te),de={steps:(W.steps||[]).map(ae=>ae.type?ae:{id:ae.stepId||ae.id||`step-${Date.now()}-${Math.random()}`,type:ae.actionId||ae.kind||ae.type,name:ae.name||ae.stepId,params:ae.config||ae.params||(ae.kind==="attach_note"&&ae.text?{text:ae.text}:{}),onFail:ae.onError==="fail"?"stop":"continue",next:ae.next||[]}),version:W.version||"1.0.0",entry:W.entry},me=await i(de);if(!me.isValid){a(me),lr(`Import failed: ${((ie=me.errors)==null?void 0:ie.join(", "))||"Invalid playbook format"}`);return}await n(r.id,{name:W.name||r.name,description:W.description||r.description,jsonBody:de}),lr("Playbook imported successfully")}catch(te){lr(`Import failed: ${te.message}`)}},G.click()};return D.jsxs("div",{className:"flex flex-col h-full",children:[D.jsxs("div",{className:"p-4 border-b border-white/10 flex items-center gap-2 flex-wrap",children:[D.jsx("button",{onClick:I,className:"px-3 py-1.5 bg-teal-600 hover:bg-teal-700 text-white text-sm rounded",children:"Validate"}),D.jsx("button",{onClick:z,disabled:!s,className:"px-3 py-1.5 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white text-sm rounded",children:"Save Draft"}),D.jsx("button",{onClick:()=>p(!0),className:"px-3 py-1.5 bg-green-600 hover:bg-green-700 text-white text-sm rounded",children:"Publish"}),D.jsx("button",{onClick:U,className:"px-3 py-1.5 bg-purple-600 hover:bg-purple-700 text-white text-sm rounded",children:"Export"}),D.jsx("button",{onClick:$,className:"px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 text-white text-sm rounded",children:"Import"}),D.jsx("button",{onClick:()=>v(!0),className:"px-3 py-1.5 bg-gray-600 hover:bg-gray-700 text-white text-sm rounded",children:"Rollback"})]}),k&&D.jsxs("div",{className:"p-3 border-b border-white/10 bg-surface-dark",children:[D.jsx("div",{className:"text-xs font-semibold text-white/80 mb-2",children:"Preflight Checklist"}),D.jsxs("div",{className:"space-y-1 text-xs",children:[D.jsxs("div",{className:`flex items-center ${k.hasSteps?"text-green-400":"text-red-400"}`,children:[k.hasSteps?"":""," At least one step"]}),D.jsxs("div",{className:`flex items-center ${k.hasEntry?"text-green-400":"text-red-400"}`,children:[k.hasEntry?"":""," Entry step defined"]}),D.jsxs("div",{className:`flex items-center ${k.hasDanglingEdges?"text-red-400":"text-green-400"}`,children:[k.hasDanglingEdges?"":""," No dangling edges"]}),D.jsxs("div",{className:`flex items-center ${k.hasUnconnectedSteps?"text-yellow-400":"text-green-400"}`,children:[k.hasUnconnectedSteps?"":""," All steps connected"]})]})]}),u&&D.jsxs("div",{className:`p-3 border-b ${u.isValid?"bg-green-900/20 border-green-500":"bg-red-900/20 border-red-500"}`,children:[D.jsx("div",{className:"text-sm font-semibold mb-1",children:u.isValid?" Valid":" Invalid"}),u.errors&&u.errors.length>0&&D.jsx("div",{className:"text-red-300 text-xs",children:u.errors.map((G,Z)=>D.jsx("div",{children:G},Z))}),u.warnings&&u.warnings.length>0&&D.jsx("div",{className:"text-yellow-300 text-xs mt-1",children:u.warnings.map((G,Z)=>D.jsxs("div",{children:[" ",G]},Z))})]}),D.jsx("div",{className:"flex-1 overflow-hidden",children:D.jsx(qK,{height:"100%",defaultLanguage:"json",value:M,theme:"vs-dark",options:{readOnly:!0,minimap:{enabled:!1},fontSize:12}})}),d&&D.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:D.jsxs("div",{className:"bg-panel rounded-xl border border-white/10 p-6 w-full max-w-md",children:[D.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Publish Playbook"}),D.jsx("p",{className:"text-white/80 mb-4",children:"Are you sure you want to publish this playbook? Published playbooks are available to all users."}),D.jsxs("div",{className:"mb-4",children:[D.jsx("label",{className:"block text-xs text-white/80 mb-2",children:"Release Notes (optional)"}),D.jsx("textarea",{value:_,onChange:G=>b(G.target.value),placeholder:"What's new in this version?",className:"w-full h-20 bg-panel border border-white/20 rounded px-3 py-2 text-white placeholder-gray-400 focus:outline-none focus:border-teal-500 text-sm"})]}),D.jsxs("div",{className:"flex justify-end gap-2",children:[D.jsx("button",{onClick:()=>{p(!1),b("")},className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded",children:"Cancel"}),D.jsx("button",{onClick:V,className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded",children:"Publish"})]})]})}),D.jsx(Qs,{isOpen:g,onClose:()=>v(!1),title:"Rollback Playbook",message:"Select a version to rollback to from the Versions tab.",variant:"info",buttonText:"OK"})]})},GK=JSON.stringify({id:"test-alert-1",message:"Suspicious IP 8.8.8.8 detected",attrs:{ip:"8.8.8.8",domain:"example.com",hash:"abc123def456"}},null,2),WK=()=>{const{current:e,testRun:t}=Ac(),[r,n]=ce.useState(GK),[i,s]=ce.useState([]),[u,a]=ce.useState(!1),[d,p]=ce.useState(!1),[g,v]=ce.useState(""),_=async()=>{if(!e){lr("No playbook selected");return}a(!0),s([]);try{let b;try{b=JSON.parse(r)}catch{v("Invalid JSON in mock alert"),p(!0),a(!1);return}const k=await t(e.jsonBody);s(k.logs),k.success?lr("Test run completed successfully"):lr("Test run completed with errors")}catch(b){v(b.message||"Test run failed"),p(!0)}finally{a(!1)}};return D.jsxs("div",{className:"flex flex-col h-full",children:[D.jsxs("div",{className:"p-4 border-b border-white/10",children:[D.jsx("h3",{className:"text-sm font-semibold mb-2 text-white",children:"Test Run"}),D.jsx("p",{className:"text-xs text-white/60 mb-4",children:"Test this playbook with mock alert data. No external HTTP calls will be made."}),D.jsxs("div",{className:"mb-4",children:[D.jsx("label",{className:"block text-xs text-white/80 mb-2",children:"Mock Alert JSON"}),D.jsx("textarea",{value:r,onChange:b=>n(b.target.value),className:"w-full h-32 bg-panel border border-white/20 rounded p-2 text-white placeholder-gray-400 focus:outline-none focus:border-teal-500 text-xs font-mono",placeholder:"Enter mock alert JSON..."})]}),D.jsx("button",{onClick:_,disabled:u||!e,className:"px-4 py-2 bg-teal-600 hover:bg-teal-700 disabled:opacity-50 disabled:cursor-not-allowed text-white text-sm rounded",children:u?"Running...":"Run Test"})]}),D.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[i.length===0&&!u&&D.jsx("div",{className:"text-white/60 text-sm text-center py-8",children:'Click "Run Test" to execute the playbook'}),u&&D.jsx("div",{className:"text-white/60 text-sm text-center py-8",children:"Running test..."}),i.length>0&&D.jsx("div",{className:"space-y-2",children:i.map((b,k)=>D.jsxs("div",{className:`p-3 rounded border ${b.status==="success"?"bg-green-900/20 border-green-500/50":"bg-red-900/20 border-red-500/50"}`,children:[D.jsxs("div",{className:"flex items-center justify-between mb-1",children:[D.jsx("span",{className:"text-sm font-semibold text-white",children:b.stepId||`Step ${k+1}`}),D.jsx("span",{className:`text-xs px-2 py-1 rounded ${b.status==="success"?"bg-green-600 text-white":"bg-red-600 text-white"}`,children:b.status||"unknown"})]}),b.kind&&D.jsxs("div",{className:"text-xs text-white/60 mb-1",children:["Kind: ",b.kind]}),b.output&&D.jsx("pre",{className:"text-xs text-white/80 mt-2 bg-black/20 p-2 rounded overflow-x-auto",children:JSON.stringify(b.output,null,2)}),b.error&&D.jsx("div",{className:"text-xs text-red-300 mt-2",children:b.error})]},k))})]}),D.jsx(Qs,{isOpen:d,onClose:()=>p(!1),title:"Test Run Error",message:g,variant:"error",buttonText:"OK"})]})},ZK=()=>{const{current:e,aiGenerate:t,setCurrentJson:r,markDirty:n}=Ac(),[i,s]=ce.useState(""),[u,a]=ce.useState(!1),[d,p]=ce.useState(!1),[g,v]=ce.useState(null),_=async()=>{if(!i.trim()){lr("Please enter a prompt");return}a(!0);try{const k=await t(i);v(k),p(!0)}catch(k){lr(`AI generation failed: ${k.message}`)}finally{a(!1)}},b=()=>{!e||!g||(r(()=>g),n(!0),p(!1),s(""),v(null),lr("Playbook replaced with AI-generated draft"))};return D.jsxs("div",{className:"flex flex-col h-full",children:[D.jsxs("div",{className:"p-4 border-b border-white/10",children:[D.jsx("h3",{className:"text-sm font-semibold mb-2 text-white",children:"AI Assist"}),D.jsx("p",{className:"text-xs text-white/60 mb-4",children:"Generate a playbook from natural language description"}),D.jsx("textarea",{value:i,onChange:k=>s(k.target.value),placeholder:"e.g., Create a playbook that looks up GeoIP, WHOIS, and sends Slack message",className:"w-full h-24 bg-panel border border-white/20 rounded p-2 text-white placeholder-gray-400 focus:outline-none focus:border-teal-500 text-sm"}),D.jsx("button",{onClick:_,disabled:u||!i.trim(),className:"mt-2 px-4 py-2 bg-teal-600 hover:bg-teal-700 disabled:opacity-50 disabled:cursor-not-allowed text-white text-sm rounded",children:u?"Generating...":"Generate Draft"})]}),D.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:D.jsxs("div",{className:"text-white/60 text-sm",children:[D.jsx("p",{className:"mb-2",children:"Examples:"}),D.jsxs("ul",{className:"list-disc list-inside space-y-1 text-xs",children:[D.jsx("li",{children:'"Create a playbook that looks up GeoIP and WHOIS"'}),D.jsx("li",{children:'"Enrich IP addresses with VirusTotal hash check"'}),D.jsx("li",{children:'"Get geolocation and reverse geocode coordinates"'})]})]})}),d&&g&&D.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:D.jsxs("div",{className:"bg-panel rounded-xl border border-white/10 p-6 w-full max-w-md",children:[D.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Replace Current Playbook?"}),D.jsx("p",{className:"text-white/80 mb-4",children:"This will replace your current playbook with the AI-generated version. Continue?"}),D.jsxs("div",{className:"flex justify-end gap-2",children:[D.jsx("button",{onClick:()=>{p(!1),v(null)},className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded",children:"Cancel"}),D.jsx("button",{onClick:b,className:"px-4 py-2 bg-teal-600 hover:bg-teal-700 text-white rounded",children:"Replace"})]})]})})]})},XK=({isOpen:e,onClose:t})=>{var A,M;const{current:r,versions:n,rollback:i}=Ac(),{user:s}=Ic(),[u,a]=ce.useState(null),[d,p]=ce.useState(!1),g=((A=s==null?void 0:s.roles)==null?void 0:A.includes("admin"))||((M=s==null?void 0:s.roles)==null?void 0:M.includes("analyst")),v=async()=>{if(!(!r||!u))try{await i(r.id,u),t()}catch(P){lr(`Rollback failed: ${P.message}`)}};if(!e)return null;const _=r!=null&&r.jsonBody?JSON.stringify(r.jsonBody,null,2):"",b=n.find(P=>P.version===u),k=b!=null&&b.jsonBody?JSON.stringify(b.jsonBody,null,2):"";return D.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:t,children:D.jsxs("div",{className:"bg-panel rounded-xl border border-white/10 p-6 w-full max-w-4xl max-h-[90vh] flex flex-col",onClick:P=>P.stopPropagation(),children:[D.jsxs("div",{className:"flex items-center justify-between mb-4",children:[D.jsx("h3",{className:"text-lg font-semibold text-white",children:"Version History"}),D.jsx("button",{onClick:t,className:"text-white/70 hover:text-white text-xl leading-none",children:""})]}),D.jsx("div",{className:"flex-1 overflow-y-auto",children:D.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[D.jsxs("div",{children:[D.jsx("h4",{className:"text-sm font-semibold text-white mb-2",children:"Versions"}),D.jsx("div",{className:"space-y-2",children:n.map(P=>D.jsxs("div",{onClick:()=>{a(P.version),p(!0)},className:`p-3 rounded border cursor-pointer ${u===P.version?"border-teal-500 bg-teal-900/20":"border-white/20 bg-surface-dark hover:bg-surface"}`,children:[D.jsxs("div",{className:"text-sm font-semibold text-white",children:["Version ",P.version]}),D.jsx("div",{className:"text-xs text-white/60 mt-1",children:new Date(P.createdAt).toLocaleString()}),P.createdBy&&D.jsxs("div",{className:"text-xs text-white/60 mt-1",children:["By: ",P.createdBy]}),P.releaseNotes&&D.jsxs("div",{className:"text-xs text-white/80 mt-2 italic border-l-2 border-teal-500 pl-2",children:['"',P.releaseNotes,'"']})]},P.version))})]}),d&&u&&D.jsxs("div",{children:[D.jsxs("h4",{className:"text-sm font-semibold text-white mb-2",children:["Version ",u," vs Current"]}),D.jsxs("div",{className:"grid grid-cols-2 gap-2 h-96",children:[D.jsxs("div",{className:"bg-surface-dark rounded p-2 overflow-auto",children:[D.jsxs("div",{className:"text-xs text-white/60 mb-2",children:["Version ",u]}),D.jsx("pre",{className:"text-xs text-white font-mono whitespace-pre-wrap",children:k})]}),D.jsxs("div",{className:"bg-surface-dark rounded p-2 overflow-auto",children:[D.jsx("div",{className:"text-xs text-white/60 mb-2",children:"Current"}),D.jsx("pre",{className:"text-xs text-white font-mono whitespace-pre-wrap",children:_})]})]})]})]})}),g&&u&&D.jsxs("div",{className:"flex justify-end gap-2 mt-4 pt-4 border-t border-white/10",children:[D.jsx("button",{onClick:t,className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded",children:"Cancel"}),D.jsxs("button",{onClick:v,className:"px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded",children:["Rollback to Version ",u]})]})]})})},KK=({nodeId:e})=>{var d;const{current:t,setCurrentJson:r,selection:n}=Ac(),i=t==null?void 0:t.jsonBody.steps.find(p=>p.id===e);if(!i||!n.includes(e))return null;const s=p=>{r(g=>{const v=g.steps.map(_=>_.id===e?{..._,...p}:_);return{...g,steps:v}})},u=()=>{r(p=>({...p,entry:e}))},a=(t==null?void 0:t.jsonBody.entry)===e;return D.jsxs("div",{className:"p-4 bg-surface-dark border border-white/20 rounded",children:[D.jsxs("div",{className:"flex items-center justify-between mb-3",children:[D.jsxs("h4",{className:"text-sm font-semibold text-white",children:["Edit Step: ",i.name||i.type]}),!a&&D.jsx("button",{onClick:u,className:"px-2 py-1 text-xs bg-teal-600 hover:bg-teal-700 text-white rounded",children:"Set as Entry"}),a&&D.jsx("span",{className:"px-2 py-1 text-xs bg-green-600 text-white rounded",children:"Entry Point"})]}),D.jsxs("div",{className:"space-y-2",children:[D.jsxs("div",{children:[D.jsx("label",{className:"block text-xs text-white/80 mb-1",children:"Name"}),D.jsx("input",{type:"text",value:i.name||"",onChange:p=>s({name:p.target.value}),className:"w-full bg-panel border border-white/20 rounded px-2 py-1 text-white placeholder-gray-400 focus:outline-none focus:border-teal-500 text-sm",placeholder:i.type})]}),i.type==="output"&&D.jsxs("div",{children:[D.jsx("label",{className:"block text-xs text-white/80 mb-1",children:"Note Text"}),D.jsx("textarea",{value:((d=i.params)==null?void 0:d.text)||"",onChange:p=>s({params:{...i.params,text:p.target.value}}),className:"w-full bg-panel border border-white/20 rounded px-2 py-1 text-white placeholder-gray-400 focus:outline-none focus:border-teal-500 text-sm",placeholder:"Enter note text to attach...",rows:3})]}),D.jsxs("div",{children:[D.jsx("label",{className:"block text-xs text-white/80 mb-1",children:"On Fail"}),D.jsxs("select",{value:i.onFail||"continue",onChange:p=>s({onFail:p.target.value}),className:"w-full bg-panel border border-white/20 rounded px-2 py-1 text-white focus:outline-none focus:border-teal-500 text-sm",children:[D.jsx("option",{value:"continue",className:"bg-panel text-white",children:"Continue"}),D.jsx("option",{value:"stop",className:"bg-panel text-white",children:"Stop"})]})]})]})]})},$A=[{id:"ip-enrichment",name:"IP Enrichment",description:"Enrich IP addresses with GeoIP and WHOIS lookup",jsonBody:{version:"1.0.0",entry:"geoip-1",steps:[{id:"geoip-1",type:"geoip",name:"GeoIP Lookup",next:["whois-1"]},{id:"whois-1",type:"whois",name:"WHOIS Lookup",next:["output-1"]},{id:"output-1",type:"output",name:"Attach Results",params:{text:"IP enrichment completed: GeoIP and WHOIS data attached"},next:[]}]}},{id:"full-enrichment",name:"Full Enrichment",description:"Comprehensive enrichment: GeoIP, WHOIS, VirusTotal, and Reverse Geocode",jsonBody:{version:"1.0.0",entry:"geoip-1",steps:[{id:"geoip-1",type:"geoip",name:"GeoIP Lookup",next:["whois-1"]},{id:"whois-1",type:"whois",name:"WHOIS Lookup",next:["vt-1"]},{id:"vt-1",type:"virustotal",name:"VirusTotal Check",next:["reverse-geo-1"]},{id:"reverse-geo-1",type:"reverse_geocode",name:"Reverse Geocode",next:["output-1"]},{id:"output-1",type:"output",name:"Attach Results",params:{text:"Full enrichment completed: GeoIP, WHOIS, VirusTotal, and Reverse Geocode data attached"},next:[]}]}},{id:"webhook-notify",name:"Webhook Notify",description:"Enrich IP and send results to webhook",jsonBody:{version:"1.0.0",entry:"geoip-1",steps:[{id:"geoip-1",type:"geoip",name:"GeoIP Lookup",next:["webhook-1"]},{id:"webhook-1",type:"http_post",name:"Send to Webhook",params:{url:"https://webhook.example.com/api/endpoint",headers:{"Content-Type":"application/json"}},next:["output-1"]},{id:"output-1",type:"output",name:"Attach Note",params:{text:"Enrichment completed and webhook notified"},next:[]}]}}],YK=()=>{var Q,X,ie;const{items:e,current:t,load:r,open:n,createDraft:i,setCurrentJson:s,setSelection:u,isDirty:a,selection:d}=Ac(),{user:p}=Ic(),[g,v]=ce.useState("json"),[_,b]=ce.useState(!1),[k,A]=ce.useState(!1),[M,P]=ce.useState(!1),[I,z]=ce.useState(""),V=!(((Q=p==null?void 0:p.roles)==null?void 0:Q.includes("viewer"))&&!((X=p==null?void 0:p.roles)!=null&&X.includes("analyst"))&&!((ie=p==null?void 0:p.roles)!=null&&ie.includes("admin")));ce.useEffect(()=>{r()},[r]);const U=async te=>{if(!I.trim()){lr("Please enter a name");return}try{let W;if(te){const se=$A.find(de=>de.id===te);se?W=JSON.parse(JSON.stringify(se.jsonBody)):W={steps:[],version:"1.0.0"}}else W={steps:[],version:"1.0.0"};const oe=await i({name:I,jsonBody:W});await n(oe.id),A(!1),P(!1),z("")}catch(W){lr(`Failed to create draft: ${W.message}`)}},$=te=>{if(!t||!V)return;const W=`step-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,oe={id:W,type:te,name:te,next:[]};te==="output"&&(oe.params={text:"Enrichment summary attached by playbook"}),s(se=>{const de=[...se.steps,oe],me=se.entry||(de.length===1?W:se.entry);return{...se,steps:de,entry:me}})},G=te=>{u([te])},Z=()=>{r()};return D.jsxs("div",{className:"flex flex-col h-full bg-surface",children:[D.jsx("div",{className:"px-4 py-3 border-b border-white/10 flex items-center justify-between",children:D.jsxs("div",{className:"flex items-center gap-4",children:[D.jsxs("select",{value:(t==null?void 0:t.id)||"",onChange:te=>{te.target.value&&n(te.target.value)},className:"bg-panel border border-white/20 rounded px-3 py-2 text-white text-sm focus:outline-none focus:border-teal-500",children:[D.jsx("option",{value:"",className:"bg-panel text-white",children:"Select Playbook..."}),e.map(te=>D.jsxs("option",{value:te.id,className:"bg-panel text-white",children:[te.name," (",te.status,")"]},te.id))]}),V&&D.jsxs(D.Fragment,{children:[D.jsx("button",{onClick:()=>A(!0),className:"px-3 py-1.5 bg-teal-600 hover:bg-teal-700 text-white text-sm rounded",children:"New Draft"}),D.jsx("button",{onClick:()=>P(!0),className:"px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded",children:"New from Template"})]}),t&&D.jsxs(D.Fragment,{children:[D.jsx("span",{className:`px-2 py-1 rounded text-xs ${t.status==="published"?"bg-green-600 text-white":"bg-gray-600 text-white"}`,children:t.status}),a&&D.jsx("span",{className:"px-2 py-1 rounded text-xs bg-yellow-600 text-white",children:"Unsaved"})]})]})}),D.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[D.jsxs("div",{className:"flex flex-col w-1/2 border-r border-white/10 min-h-0",children:[V&&D.jsx(RX,{onAddNode:$}),D.jsxs("div",{className:"flex-1 relative min-h-0",style:{minHeight:"400px"},children:[D.jsx(NX,{onNodeClick:G}),d.length>0&&V&&D.jsx("div",{className:"absolute top-4 right-4 w-64 z-10",children:D.jsx(KK,{nodeId:d[0]})})]})]}),D.jsxs("div",{className:"w-1/2 flex flex-col",children:[D.jsxs("div",{className:"flex border-b border-white/10",children:[D.jsx("button",{onClick:()=>v("json"),className:`px-4 py-2 text-sm font-medium ${g==="json"?"border-b-2 border-white text-white":"opacity-70 hover:opacity-100 text-white"}`,children:"JSON"}),V&&D.jsxs(D.Fragment,{children:[D.jsx("button",{onClick:()=>v("test"),className:`px-4 py-2 text-sm font-medium ${g==="test"?"border-b-2 border-white text-white":"opacity-70 hover:opacity-100 text-white"}`,children:"Test Run"}),D.jsx("button",{onClick:()=>v("ai"),className:`px-4 py-2 text-sm font-medium ${g==="ai"?"border-b-2 border-white text-white":"opacity-70 hover:opacity-100 text-white"}`,children:"AI Assist"})]}),D.jsx("button",{onClick:()=>{v("versions"),b(!0)},className:`px-4 py-2 text-sm font-medium ${g==="versions"?"border-b-2 border-white text-white":"opacity-70 hover:opacity-100 text-white"}`,children:"Versions"})]}),D.jsxs("div",{className:"flex-1 overflow-hidden",children:[g==="json"&&D.jsx(HK,{onPublish:Z,onRollback:()=>b(!0)}),g==="test"&&V&&D.jsx(WK,{}),g==="ai"&&V&&D.jsx(ZK,{}),g==="versions"&&D.jsx("div",{className:"p-4 text-white/60 text-sm",children:'Click "Versions" tab to view version history'})]})]})]}),k&&D.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:D.jsxs("div",{className:"bg-panel rounded-xl border border-white/10 p-6 w-full max-w-md",children:[D.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"New Draft"}),D.jsx("input",{type:"text",value:I,onChange:te=>z(te.target.value),placeholder:"Playbook name",className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white placeholder-gray-400 focus:outline-none focus:border-teal-500 mb-4",onKeyPress:te=>{te.key==="Enter"&&U()}}),D.jsxs("div",{className:"flex justify-end gap-2",children:[D.jsx("button",{onClick:()=>{A(!1),z("")},className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded",children:"Cancel"}),D.jsx("button",{onClick:U,className:"px-4 py-2 bg-teal-600 hover:bg-teal-700 text-white rounded",children:"Create"})]})]})}),M&&D.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:D.jsxs("div",{className:"bg-panel rounded-xl border border-white/10 p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[D.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"New from Template"}),D.jsx("input",{type:"text",value:I,onChange:te=>z(te.target.value),placeholder:"Playbook name",className:"w-full bg-panel border border-white/20 rounded px-3 py-2 text-white placeholder-gray-400 focus:outline-none focus:border-teal-500 mb-4"}),D.jsx("div",{className:"space-y-3 mb-4",children:$A.map(te=>D.jsxs("div",{className:"p-4 bg-surface-dark border border-white/10 rounded cursor-pointer hover:border-teal-500 transition-colors",onClick:()=>{I.trim()?U(te.id):z(te.name)},children:[D.jsx("div",{className:"font-semibold text-white mb-1",children:te.name}),D.jsx("div",{className:"text-sm text-white/60",children:te.description}),D.jsxs("div",{className:"text-xs text-white/40 mt-2",children:[te.jsonBody.steps.length," steps"]})]},te.id))}),D.jsx("div",{className:"flex justify-end gap-2",children:D.jsx("button",{onClick:()=>{P(!1),z("")},className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded",children:"Cancel"})})]})}),D.jsx(XK,{isOpen:_,onClose:()=>{b(!1),v("json")}})]})};function JK(){const e=Io(t=>t.unread);return D.jsxs("div",{className:"relative cursor-pointer",children:[D.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-400",children:D.jsx("path",{d:"M12 2a7 7 0 0 0-7 7v3l-2 2v2h18v-2l-2-2V9a7 7 0 0 0-7-7zm0 20a3 3 0 0 0 3-3H9a3 3 0 0 0 3 3z"})}),e>0&&D.jsx("span",{className:"absolute -top-1 -right-1 text-[10px] bg-red-600 text-white rounded-full px-1.5 min-w-[18px] text-center",children:e>99?"99+":e})]})}function QK(){const{user:e}=Ic(),{setSelected:t,get:r}=qo(),n=hN(),i=M0(),[s,u]=ce.useState(null),a=g=>e?e.roles.includes(g):!1,p=(()=>{const g=i.pathname;return g==="/saved"?"saved":g==="/dashboards"?"dashboards":g==="/alerts"?"alerts":g==="/cases"?"cases":g==="/playbooks"?"playbooks":"console"})();return ce.useEffect(()=>ij(v=>{u(v),setTimeout(()=>u(null),3e3)}),[]),ce.useEffect(()=>{const g=async _=>{var k;const b=_;if(n("/cases"),(k=b.detail)!=null&&k.caseId)try{const A=await r(b.detail.caseId);t(A)}catch{}},v=_=>{n("/alerts")};return window.addEventListener("navigate-to-cases",g),window.addEventListener("navigate-to-alerts",v),()=>{window.removeEventListener("navigate-to-cases",g),window.removeEventListener("navigate-to-alerts",v)}},[r,t,n]),D.jsxs("div",{className:"min-h-screen bg-surface text-white",children:[D.jsxs("header",{className:"px-4 py-3 border-b border-white/10 flex items-center justify-between",children:[D.jsxs("div",{className:"flex items-center gap-3",children:[D.jsx("img",{src:"/logo.png",alt:"HALCYON Logo",className:"h-8 w-8 object-contain"}),D.jsx("h1",{className:"text-xl font-semibold",children:"HALCYON Console"})]}),D.jsxs("div",{className:"flex items-center gap-4",children:[D.jsx("div",{className:"relative cursor-pointer",onClick:()=>{n("/alerts")},title:"Open Alerts",children:D.jsx(JK,{})}),D.jsx(Kq,{})]})]}),D.jsxs("div",{className:"border-b border-white/10 flex gap-2 px-4",children:[D.jsx("button",{className:`px-3 py-2 text-sm font-medium ${p==="console"?"border-b-2 border-white text-white":"opacity-70 hover:opacity-100 text-white"}`,onClick:()=>n("/"),children:"Console"}),D.jsx("button",{className:`px-3 py-2 text-sm font-medium ${p==="saved"?"border-b-2 border-white text-white":"opacity-70 hover:opacity-100 text-white"}`,onClick:()=>n("/saved"),children:"Saved Queries"}),D.jsx("button",{className:`px-3 py-2 text-sm font-medium ${p==="dashboards"?"border-b-2 border-white text-white":"opacity-70 hover:opacity-100 text-white"}`,onClick:()=>n("/dashboards"),children:"Dashboards"}),(a("analyst")||a("admin"))&&D.jsx("button",{className:`px-3 py-2 text-sm font-medium ${p==="alerts"?"border-b-2 border-white text-white":"opacity-70 hover:opacity-100 text-white"}`,onClick:()=>n("/alerts"),children:"Alerts"}),(a("analyst")||a("admin")||a("viewer"))&&D.jsx("button",{className:`px-3 py-2 text-sm font-medium ${p==="cases"?"border-b-2 border-white text-white":"opacity-70 hover:opacity-100 text-white"}`,onClick:()=>n("/cases"),children:"Cases"}),(a("analyst")||a("admin")||a("viewer"))&&D.jsx("button",{className:`px-3 py-2 text-sm font-medium ${p==="playbooks"?"border-b-2 border-white text-white":"opacity-70 hover:opacity-100 text-white"}`,onClick:()=>n("/playbooks"),children:"Playbooks"})]}),D.jsxs(PF,{children:[D.jsx(Cl,{path:"/",element:D.jsxs(D.Fragment,{children:[D.jsxs("div",{className:"grid grid-cols-2 grid-rows-2 h-[calc(100vh-8rem)] gap-4 p-4",children:[D.jsx("div",{className:"border-r border-white/10 pr-4 flex flex-col min-h-0",children:D.jsx(CN,{})}),D.jsx("div",{className:"pl-4 flex flex-col min-h-0",children:D.jsx(Vq,{})}),D.jsx("div",{className:"border-r border-white/10 pr-4 flex flex-col min-h-0 border-t border-white/10 pt-4",children:D.jsx(Uq,{})}),D.jsx("div",{className:"pl-4 flex flex-col min-h-0 border-t border-white/10 pt-4",children:D.jsx(SR,{})})]}),D.jsx(Zq,{})]})}),D.jsx(Cl,{path:"/saved",element:D.jsx("div",{className:"h-[calc(100vh-8rem)] overflow-auto",children:D.jsx(Yq,{})})}),D.jsx(Cl,{path:"/dashboards",element:D.jsx("div",{className:"h-[calc(100vh-8rem)] overflow-auto",children:D.jsx(dH,{})})}),D.jsx(Cl,{path:"/alerts",element:a("analyst")||a("admin")?D.jsx("div",{className:"h-[calc(100vh-8rem)] overflow-auto",children:D.jsx(bH,{})}):D.jsx(vv,{to:"/",replace:!0})}),D.jsx(Cl,{path:"/cases",element:a("analyst")||a("admin")||a("viewer")?D.jsx("div",{className:"h-[calc(100vh-8rem)] overflow-auto",children:D.jsx(DH,{})}):D.jsx(vv,{to:"/",replace:!0})}),D.jsx(Cl,{path:"/playbooks",element:a("analyst")||a("admin")||a("viewer")?D.jsx("div",{className:"h-[calc(100vh-8rem)] overflow-hidden",children:D.jsx(YK,{})}):D.jsx(vv,{to:"/",replace:!0})}),D.jsx(Cl,{path:"*",element:D.jsx(vv,{to:"/",replace:!0})})]}),s&&D.jsx(nj,{message:s,onClose:()=>u(null)})]})}function eY(){const{user:e,initialize:t,loading:r}=Ic(),[n,i]=ce.useState(!1);ce.useEffect(()=>{t(),i(!0)},[t]);const s=n&&(e||wR());return!n||r?D.jsx("div",{className:"min-h-screen bg-surface text-white flex items-center justify-center",children:D.jsx("div",{className:"text-lg",children:"Loading..."})}):s?D.jsx(QK,{}):D.jsx(Xq,{})}eN(document.getElementById("root")).render(D.jsx(MF,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:D.jsx(eY,{})}));
